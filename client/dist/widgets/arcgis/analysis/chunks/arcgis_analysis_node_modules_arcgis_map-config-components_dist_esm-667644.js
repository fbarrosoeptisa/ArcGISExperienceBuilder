/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-667644.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-667644"],{14100:(e,t,a)=>{a.r(t),a.d(t,{arcgis_app_print:()=>y});var i=a(28614),s=a(71480),r=a(68180),o=a(89826),n=a(43666),l=a(44021),c=a(97127),p=a(50063),d=a(42444);function u(e){return e.credential?.token||e.token||e.user?.credential?.token||e.portalUser?.token||""}const m=["tiff","gif","jpg","pdf","png"],g="arcgis-app-print-custom-templates-storage-infos",f="arcgis-app-print-export-links-storage-infos",y=class{constructor(e){(0,i.r)(this,e),this.arcgisSaveItem=(0,i.c)(this,"arcgisSaveItem",7),this.arcgisAppPrintSaveItem=(0,i.c)(this,"arcgisAppPrintSaveItem",7),this.arcgisClose=(0,i.c)(this,"arcgisClose",7),this.manager=(0,c.u)(this),this.strings=(0,p.u)({blocking:!0}),this.mapView=void 0,this.portal=void 0,this.templateOptions=void 0,this.showPrintAreaEnabled=!1,this.showHeading=!1,this.closable=!1}async setShowPrintAreaEnabled(e){this.printWidget.showPrintAreaEnabled=e}async updateTemplateOptions(e){this.printWidget.templateOptions=e}async processNewItem(e,t){const{modules:a,portal:i,printWidget:s}=this,r=(0,n.g)(i.user),l=new a.PortalItem({id:e});await l.load();s.exportedLinks.find((e=>e.url===t)).portalItem=l;const c=(0,o.g)(f,!0)||{},p=c[r],d=p?.find((e=>e.url===t));d&&(d.portalItemId=l.id,(0,o.s)(f,c,!0))}async componentWillLoad(){await this.loadAllModules(),this.blockBetaApps=await this.orgBlocksBetaApps()}async componentDidLoad(){const{modules:e}=this;(0,d.i)(this.el.shadowRoot,e.config)}disconnectedCallback(){this.printWidget?.destroy()}render(){const{strings:e,showHeading:t,closable:a}=this;return(0,i.h)(i.H,{key:"35c8732cef23d078f7571cd108bb6e6db1996a57"},(0,i.h)("calcite-panel",{key:"ccc7ba497e4c82ad339d4098719a12f3c11cf396",heading:t?e.print:void 0,closable:a,onCalcitePanelClose:()=>this.arcgisClose.emit()},(0,i.h)("div",{key:"5f4ad021e7f65d5c4a53a31852b2fbdbc3a414be",ref:e=>{this.afterCreateDiv(e)}})))}async loadAllModules(){const[e,t,a,i,r,o,n]=await Promise.all([(0,s.i)(),(0,s.a)(),(0,s.b)(),(0,s.c)(),(0,s.d)(),(0,s.e)(),(0,s.f)()]);this.modules={config:e,Print:t,reactiveUtils:a,PortalItem:i,Collection:r,esriLang:o,request:n}}async afterCreateDiv(e){const t=window.customElements?.get("arcgis-item-browser"),a=window.customElements?.get("arcgis-new-item"),{modules:i,mapView:s,portal:r,templateOptions:l,showPrintAreaEnabled:c,blockBetaApps:p}=this,d=await this.getEligibleExportLinks(),u=(0,n.g)(r.user),f=new i.Print({view:s,portal:r,templateOptions:l,showPrintAreaEnabled:c,container:e,headerVisible:!1,includeOrganizationTemplates:!p,exportedLinks:d,saveExportHidden:!0,allowedFormatsForSaving:m});this.printWidget=f,u&&a&&(f.saveAsButtonCallback=e=>{this.arcgisAppPrintSaveItem.emit(e),this.arcgisSaveItem.emit(e)});const y=new Set(["GISProfessionalStdUT","GISProfessionalAdvUT"]);t&&r.user&&!p&&y.has(r.user.sourceJSON.userLicenseTypeId)&&(f.viewModel.when((()=>this.populateCustomTemplates())),f.browseTemplateButtonOnClick=e=>{const t=e.target;t.disabled=!0;const a=document.createElement("arcgis-app-print-browse-templates");a.portal=r,a.strings=this.strings,document.body.appendChild(a),a.addEventListener("arcgisClose",(e=>{if(e.detail?.length){e.detail.forEach((e=>{const t=new i.PortalItem({id:e.id,title:e.title,portal:r});f.viewModel.addPortalTemplate(t)}))}document.body.removeChild(a),t.disabled=!1}))}),i.reactiveUtils.watch((()=>f.viewModel.browseTemplates?.items?.length),(()=>{const e=(0,n.g)(r.user),t=f.viewModel.browseTemplates.items.map((e=>({itemId:e.layoutItem.id,title:e.layoutItem.title}))),a=(0,o.g)(g,!0)||{};t.length?a[e]=t:delete a[e],(0,o.s)(g,a,!0)})),f.on("submit",(async()=>await this.checkPortalItemValidity())),f.on("complete",(async e=>{const t=e.link.url;await this.updateLocalStorageExportLinks({filterByTime:!0,completedExportUrl:t})})),i.reactiveUtils.watch((()=>f.exportedLinks.items?.length),(async(e,t)=>{e<t&&await this.updateLocalStorageExportLinks({filterByTime:!1})}))}populateCustomTemplates(){const{modules:e,portal:t,printWidget:a}=this,i=(0,n.g)(t.user),s=((0,o.g)(g,!0)||{})[i];s?.forEach((async i=>{try{const s=new e.PortalItem({id:i.itemId,title:i.title,portal:t});await s.load(),a.viewModel.addPortalTemplate(s)}catch(e){}}))}async getEligibleExportLinks(){const{modules:e,portal:t}=this,a=(0,n.g)(t.user);if(!a)return new e.Collection;const i=(0,o.g)(f,!0)||{},s=i[a];if(!s?.length)return new e.Collection;const r=s.filter((e=>!this.isTooOld(e)));await Promise.all(r.map((async t=>{if(t.portalItemId)try{const a=new e.PortalItem({id:t.portalItemId});await a.load()}catch{t.portalItem=void 0,t.portalItemId=void 0}}))),r.length?i[a]=r:delete i[a],(0,o.s)(f,i,!0);return await this.getExportLinkCollectionWithPortalItems(r)}async updateLocalStorageExportLinks(e){const{portal:t,printWidget:a}=this,i=(0,n.g)(t.user);if(!i)return;const s=(0,o.g)(f,!0)||{},l=a.exportedLinks.map((t=>{const a=s[i]?.find((e=>e.url===t.url));return a||(t.url===e?.completedExportUrl?{count:t.count,error:t.error,extension:t.extension,name:t.name,portalItem:void 0,portalItemId:void 0,state:t.state,timestamp:(new Date).getTime(),url:t.url}:void 0)})).filter((e=>(0,r.i)(e))),c=e?.filterByTime?l.filter((e=>!this.isTooOld(e))):l;c.length?s[i]=c.filter((e=>"ready"===e.state)):delete s[i];if(!a.exportedLinks.some((e=>"pending"===e.state))){const e=await this.getExportLinkCollectionWithPortalItems(c),t=a.exportedLinks.map((t=>e.find((e=>t.url===e.url))));a.exportedLinks=t.filter((e=>(0,r.i)(e)))}(0,o.s)(f,s,!0)}isTooOld(e){return((new Date).getTime()-e.timestamp)/6e4>10}async getExportLinkCollectionWithPortalItems(e){const{modules:t}=this,a=new t.Collection;if(!e.length)return a;const i=t.esriLang.clone(e);return await Promise.all(i.map((async e=>{let t;if(e.portalItemId)try{const{modules:a}=this;t=new a.PortalItem({id:e.portalItemId}),await t.load()}catch{t=void 0}e.portalItem=t}))),a.addMany(i.map((e=>({count:e.count,error:e.error,extension:e.extension,name:e.name,portalItem:e.portalItem,state:e.state,url:e.url})))),a}async checkPortalItemValidity(){const{modules:e,portal:t,printWidget:a}=this,i=(0,n.g)(t.user),s=(0,o.g)(f,!0)||{},r=s[i];await Promise.all(a.exportedLinks.map((async t=>{if("ready"===t.state&&t.portalItem?.id)try{const a=new e.PortalItem({id:t.portalItem.id});await a.load()}catch{t.portalItem=void 0;const e=r.find((e=>e.url===t.url));e.portalItem=void 0,e.portalItemId=void 0}}))),(0,o.s)(f,s,!0)}async orgBlocksBetaApps(){const{modules:e,portal:t}=this;if(!t.user)return await Promise.resolve(!1);const a=`${function(e){return(0,l.a)(e.restUrl)}(t)}portals/self/signinSettings`,i=await e.request(a,{query:{f:"json",token:u(t),async:!1},responseType:"json"});return(0,r.i)(i?.data?.blockBetaApps)?await Promise.resolve(i.data.blockBetaApps):await Promise.resolve(!0)}static get assetsDirs(){return["assets"]}get el(){return(0,i.g)(this)}};y.style=":host{height:100%;width:100%}.flow{height:100%}"},68180:(e,t,a)=>{a.d(t,{a:()=>i,b:()=>h,c:()=>v,d:()=>u,e:()=>d,f:()=>o,g:()=>p,h:()=>k,i:()=>l,j:()=>c,k:()=>g,l:()=>s,m:()=>m,n:()=>y,o:()=>w,p:()=>x,q:()=>I,s:()=>r,t:()=>f});var i,s,r,o,n=a(71480);function l(e){return null!=e}function c(e,t){const a=e.fieldName;if(a.includes(i.expression)){const e=t.get(a);return e?.title?e.title:a}return e.label?e.label:a}async function p(e){return new Map((await async function(e){return await new Promise(((t,a)=>{switch(u(e)){case r.feature:case r.ogcFeature:case r.stream:t(e.fields);break;case r.mapImage:{const i=e,s=i?.layer;s?.portalItem&&s.url.includes("https://demographics")&&s.url.includes(".arcgis.com")?s.portalItem?.fetchData().then((e=>{if(e?.thematicGroup){const a=new Map(i.fields.map((e=>[e.name,e]))),s=e.thematicGroup.fieldNames,r=[];s.forEach((e=>{a.has(e)&&r.push(a.get(e))})),t(r)}else t(i.fields)})).catch((e=>{a(new Error(e))})):t(i.fields);break}case r.imagery:{const a=e;t((a.fields||[]).concat(a.rasterFields||[]));break}case r.imageryTile:case r.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}}))}(e)).filter((e=>e.visible)).map((e=>[e.name,e])))}function d(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach((e=>{const a=`${i.expression}${e.name}`;t.set(a,e)})),t}function u(e){return"map-image"===e?.layer?.type?r.mapImage:"subtype-sublayer"===e?.type?r.subtype:"tile"===e?.layer?.type?r.tile:"scene"===e?.type?r.scene:"ogc-feature"===e?.type?r.ogcFeature:"imagery"===e?.type?r.imagery:"imagery-tile"===e?.type?r.imageryTile:"wfs"===e?.type?r.wfs:"wcs"===e?.type?r.wcs:"wms"===e?.layer?.type?r.wms:"csv"===e?.type?r.csv:"geojson"===e?.type?r.geojson:"stream"===e?.type?r.stream:"oriented-imagery"===e?.type?r.orientedImagery:"catalog"===e?.type?r.catalog:"catalog-footprint"===e?.type?r.catalogFootprint:"knowledge-graph-sublayer"===e?.type?r.knowledgeGraphSublayer:"voxel"===e?.type?r.voxel:r.feature}function m(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function g(e){return Number((100*(1-e)).toFixed(1))}function f(e){return Number((1-e/100).toFixed(3))}!function(e){e.expression="expression/",e.raster="Raster.",e.relationship="relationships/"}(i||(i={})),function(e){e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes"}(s||(s={})),function(e){e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms"}(r||(r={})),function(e){e.bigInteger="big-integer",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset"}(o||(o={}));const y=(e,t)=>{const a=[];return e?.fieldInfos?.forEach((e=>{e.fieldName?.includes(i.expression)?t&&a.push({name:e.fieldName.slice(i.expression.length),alias:e.fieldName.slice(i.expression.length),type:"string"}):a.push({name:e.fieldName,alias:e.label,type:"string"})})),a},h=async(e,t)=>{const[a,i]=await Promise.all([(0,n.g)(),(0,n.h)()]),s=new i;s.geometry=t.extent,s.mapExtent=t.extent,s.returnGeometry=!0,s.tolerance=6,s.layerOption="popup",s.width=t.width,s.height=t.height,s.layerIds=[e.id];const r=(await a.identify(e.layer.url,s))?.results,o=r?.[0]?.feature;return o},w=async(e,t,a)=>{const i=await e.whenLayerView(t),s=await i.queryAggregates();return await b(a,s.features?.[0])},b=async(e,t)=>{const a=await(0,n.j)(),i=await(0,n.k)();let s;if(t)s=t.clone();else{s=new a;const t=y(e,!1);if(t?.length){const e={};t.forEach((t=>{e[t.name]=""})),s.attributes=e}const r=new i;s.geometry=r}return s};function I(e,t){const a=t.startsWith("#"),i=t.startsWith(".");for((i||a)&&(t=t.slice(1));e;){if(a){if(e.id===t)return e}else if(i){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function v(e){if(u(e)===r.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(u(e)===r.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find((t=>{if(t.id===e.id)return t}))?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function k(e,t,a){let i="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))i="number";else if(t.has(e)){const a=t.get(e);i=a.type?a.type.toLowerCase():""}else if(a.has(e)){const t=a.get(e);i=t.returnType?t.returnType.toLowerCase():""}else i="number";return i}async function x(e,t){return"feature"!==e.type||e.url?"feature"===e.type||"csv"===e.type||"scene"===e.type||"wfs"===e.type||"geojson"===e.type||"oriented-imagery"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"catalog"===e.type||"catalog-footprint"===e.type?await e.queryFeatureCount():!t||"stream"!==e.type&&"ogc-feature"!==e.type?await Promise.reject(new Error(`Can't get feature count for layer of type ${e.type}.`)):await async function(e,t){const a=await t.whenLayerView(e);return await a.queryFeatureCount()}(e,t):await async function(e){const t=e.createQuery();t.outFields=["*"];const a=await e.queryFeatures(t);if(a.features?.length)return a.features.length;throw new Error("could not get feature count")}(e)}},89826:(e,t,a)=>{function i(e,t,a){window.localStorage.setItem(e,a?JSON.stringify(t):t)}function s(e){window.localStorage.removeItem(e)}function r(e,t){const a=window.localStorage.getItem(e);return a&&t?JSON.parse(a):a}function o(e,t,a){window.sessionStorage.setItem(e,a?JSON.stringify(t):t)}function n(e,t){const a=window.sessionStorage.getItem(e);return a&&t?JSON.parse(a):a}a.d(t,{a:()=>n,b:()=>o,g:()=>r,r:()=>s,s:()=>i})},42444:(e,t,a)=>{function i(e,t){if(!e||!t)return;let a=t.assetsPath;a.endsWith("/")||(a+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${a}esri/themes/light/main.css" />`)}a.d(t,{i:()=>i})},44021:(e,t,a)=>{a.d(t,{a:()=>i});const i=e=>e&&!e.endsWith("/")?`${e}/`:e},50063:(e,t,a)=>{a.d(t,{u:()=>r});var i=a(97127),s=a(28614);const r=(0,i.m)(s.a)},43666:(e,t,a)=>{function i(e){return e?.sourceJSON?.id}a.d(t,{g:()=>i})}}]);