/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-b19dbf.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-b19dbf"],{41185:(e,t,i)=>{i.r(t),i.d(t,{arcgis_popup:()=>j,arcgis_popup_arcade:()=>W,arcgis_popup_association_config_popover:()=>J,arcgis_popup_associations:()=>G,arcgis_popup_attachments:()=>te,arcgis_popup_attributes:()=>oe,arcgis_popup_chart:()=>ue,arcgis_popup_expressions:()=>me,arcgis_popup_field_pick_list:()=>fe,arcgis_popup_image:()=>be,arcgis_popup_main_contentpopover:()=>Pe,arcgis_popup_multimedia:()=>we,arcgis_popup_relationship:()=>xe,arcgis_popup_richtext:()=>Le,arcgis_popup_title:()=>Te});var s=i(19564),o=i(66507),a=i(12350),n=i(9421),l=i(98034),r=i(46227),p=i(9433),c=i(89261),d=i(62273),h=i(26408);i(91102),i(73807),i(99004),i(18991);const u="enable-popup",m="component-ul",f="summary-et",g="summary-et-label",v="summary-et-action",y="imagery-options",b="notice",P=(e,t,i)=>e||(t===a.l.cluster?x(i):""),C=async(e,t,i,s,o)=>o===a.l.cluster?{id:"popup-feature-reduction",definitions:{$feature:{fields:(0,n.l)(s,!1)},$aggregatedFeatures:await w(t,e,s)}}:i===a.s.voxel?{id:"popup-voxel",definitions:{$voxel:e}}:Object.assign(Object.assign(Object.assign({id:"popup"},(i===a.s.mapImage||i===a.s.scene||i===a.s.tile)&&{disabledVariables:["$layer","$map","$datastore"]}),(i===a.s.geojson||i===a.s.wfs||i===a.s.csv)&&{disabledVariables:["$datastore"]}),{definitions:{$feature:e,$layer:e,$map:t.map,$datastore:e}}),k=async(e,t,i,s)=>{var o;try{if("subtype-sublayer"!==e.type&&"voxel"!==e.type&&i===a.l.cluster)return{profileVariableInstances:{$feature:await(0,n.m)(t,e,s),$aggregatedFeatures:await w(t,e,s),$view:{scale:"scale"in t?t.scale:void 0,timeProperties:t.timeExtent?{currentStart:t.timeExtent.start,currentEnd:t.timeExtent.end,startIncluded:!0,endIncluded:!0}:void 0}},spatialReference:t.spatialReference,timeZone:t.timeZone};if("voxel"===e.type)return;return{profileVariableInstances:{$feature:(await(0,n.n)(e,t)).features[0],$layer:e,$map:t.map,$view:{scale:"scale"in t?t.scale:void 0,timeProperties:t.timeExtent?{currentStart:t.timeExtent.start,currentEnd:t.timeExtent.end,startIncluded:!0,endIncluded:!0}:void 0},$datastore:"subtype-sublayer"===e.type?e.parent.url:e.url,$userInput:null===(o=t.extent)||void 0===o?void 0:o.center},spatialReference:t.spatialReference,timeZone:t.timeZone}}catch(e){console.log(e)}},I=(e,t,i)=>{let s;return"popupElement"===i&&(s=[{label:t.chartTemplate,code:E()},{label:t.fieldsListTemplate,code:T()},{label:t.richText,code:F()}]),"hasM"in e&&e.hasM&&(s=s||[],s.push({label:t.mValueTemplate,code:M()})),(null==s?void 0:s.length)?[{label:t.templates,suggestions:s}]:void 0},w=async(e,t,i)=>{const s=await e.whenLayerView(t),o=s.createQuery();return o.aggregateIds=[(await(0,n.m)(e,t,i)).getObjectId()],s.queryFeatures(o)},x=e=>`// ${e.clusterArcadeScriptLine3} \nExpects($aggregatedFeatures, "field1", "field2")\n`,L=(e,t)=>{const i=`// ${t.arcadeContentClusterScriptLine} \nExpects($aggregatedFeatures, "field1", "field2")\n\n`,s=`/* \n${t.arcadeContentScriptLine1} \n${t.arcadeContentScriptLine2} \nhttps://developers.arcgis.com/arcade/guide/profiles/#popup-element \n*/\n\n${F()}`;return e===a.l.cluster?i+s:s},F=()=>"return { \n\ttype : 'text', \n\ttext : 'place your text or html here' //this property supports html tags \n}",T=()=>"return {\n    type: 'fields',\n    //title: '',\n    //description : '',\n    fieldInfos:  [{\n          fieldName: \"att1\"  // fieldName should match the key in the attributes dictionary\n        },\n        {\n          fieldName: \"att2\"  // fieldName should match the key in the attributes dictionary\n        },\n        {\n          fieldName: \"att3\"  // fieldName should match the key in the attributes dictionary\n        }],\n    attributes : {att1 : 2, att2 : 3, att3 : 4}  // replace this dictionary with your own key-value pairs\n  }",E=()=>"return {\n    type: 'media',\n    // title : 'The title for all media in the element',\n    // description : '',\n    attributes : {att1 : 2, att2 : 3, att3 : 4},  // replace this dictionary with your own key-value pairs,\n    mediaInfos: [{\n        type : 'piechart', //linechart | barchart | piechart | columnchart\n        title : 'give your chart a title',\n        // caption : '',\n        altText : '', //altText will be read by screen readers\n        value : {\n          fields: [\"att1\", \"att2\", \"att3\"],  // choose what attributes to use in the chart\n          /* colors: [  // values must be an array of [r, g, b, a] values (0-255)\n            [122, 190, 229, 255],\n            [179, 155, 213, 255],\n            [248, 174, 131, 255]\n          ], */\n          //normalizeField : '',  // the name of the attribute to normalize by or value\n        }\n      }]\n  }",M=()=>"if (TypeOf($userInput) == \"Point\") {\n  var result = PointToCoordinate($feature, $userInput);\n  return Text(result.coordinate.m, '#,###.00');\n}",S=(e,t,i,s)=>{const o=t,a=new i;return a.expression=e.script,a.title=e.title,a.name=((e,t)=>{var i;if(t)return t;if(null===(i=e.expressionInfos)||void 0===i?void 0:i.length){const t=e.expressionInfos[e.expressionInfos.length-1].name.match(/\d+$/);return(null==t?void 0:t[0])?`expr${Number(t[0])+1}`:`expr${e.expressionInfos.length}`}return"expr0"})(s,o),a.returnType="number"===e.predictOutputType?"number":"string",s.expressionInfos?o?s.expressionInfos.find(((e,t)=>{e.name===o&&(s.expressionInfos[t]=a)})):s.expressionInfos.push(a):s.expressionInfos=[a],a},R=async(e,t,i,s)=>{t===a.l.cluster?(i.featureReduction.popupTemplate.expressionInfos=[...e.expressionInfos],e.fieldInfos=((e,t)=>{var i;const s=[];return e.fieldInfos.forEach((e=>{e.fieldName.includes(a.f.expression)||s.push(e)})),null===(i=e.expressionInfos)||void 0===i||i.forEach((async e=>{const i=new t;i.fieldName=`${a.f.expression}${e.name}`,i.visible=!1,s.push(i)})),s})(e,s)):(i.popupTemplate.expressionInfos=[...e.expressionInfos],e.fieldInfos=[...await(0,p.g)(i,e)])};const D=(e,t)=>{var i,s;const o=null===(s=null===(i=null==e?void 0:e.shadowRoot)||void 0===i?void 0:i.querySelector("input"))||void 0===s?void 0:s.selectionStart;return A(o)?[e.value.slice(0,o),`{${t}}`,e.value.slice(o)].join(""):`${e.value}{${t}}`},A=e=>null!=e,N=async(e,t,i)=>{var s,o,n,l,r;const p=null===(o=null===(s=e.capabilities)||void 0===s?void 0:s.queryRelated)||void 0===o?void 0:o.supportsCount,c=null===(l=null===(n=e.capabilities)||void 0===n?void 0:n.queryRelated)||void 0===l?void 0:l.supportsPagination;if([a.s.feature,a.s.scene,a.s.mapImage,a.s.subtype].indexOf(i)>-1&&(null===(r=null==e?void 0:e.relationships)||void 0===r?void 0:r.length)&&p&&c)for(const i of e.relationships){const s=U(t);for(const t of s){const s=t;if("subtype-sublayer"!==s.type&&"subtype-group"!==s.type&&await B(e,s,i))return await s.load(),Promise.resolve(!0)}}return Promise.resolve(!1)};function O(e){return["feature","subtype-sublayer"].indexOf(e.type)&&e.url.toLocaleLowerCase().endsWith("/featureserver")?e.url.substring(0,e.url.length-14):["feature","map-image","sublayer"].indexOf(e.type)>-1&&e.url.toLocaleLowerCase().endsWith("/mapserver")?e.url.substring(0,e.url.length-10):["feature","map-image","sublayer"].indexOf(e.type)>-1&&e.url.toLocaleLowerCase().indexOf("/mapserver/")>-1?e.url.substring(0,e.url.toLocaleLowerCase().indexOf("/mapserver/")):"scene"===e.type&&e.url.toLocaleLowerCase().endsWith("/sceneserver")?e.url.substring(0,e.url.length-12):e.url}async function B(e,t,i){var s,o,a;const n=t.url?t.url===e.url||O(t)===O(e):"type"in t.parent&&"group"===t.parent.type&&"portalItem"in e&&(null===(o=null===(s=t.parent)||void 0===s?void 0:s.portalItem)||void 0===o?void 0:o.id)===(null===(a=e.portalItem)||void 0===a?void 0:a.id);["feature","scene"].indexOf(t.type)>-1&&n&&"layerId"in t&&!A(t.layerId)&&await t.load();const l="sublayer"===t.type||"subtype-sublayer"===t.type;return Promise.resolve(["feature","scene","sublayer","subtype-sublayer"].indexOf(t.type)>-1&&n&&(!l&&t.layerId===i.relatedTableId||l&&t.id===i.relatedTableId))}function H(e,t,i){var s,o,a;const n=t.url?t.url===e.url||O(t)===O(e):"type"in t.parent&&"group"===t.parent.type&&"portalItem"in e&&(null===(o=null===(s=t.parent)||void 0===s?void 0:s.portalItem)||void 0===o?void 0:o.id)===(null===(a=e.portalItem)||void 0===a?void 0:a.id),l="sublayer"===t.type||"subtype-sublayer"===t.type;return["feature","scene","sublayer","subtype-sublayer"].indexOf(t.type)>-1&&n&&(!l&&t.layerId===i.relatedTableId||l&&t.id===i.relatedTableId)}function U(e){let t=[...e.map.allLayers,...e.map.allTables];return t.forEach((e=>{if("map-image"===e.type){const i=e;t=t.concat([...i.sublayers])}})),t}var V,$,_;function z(e){return"subtype-sublayer"===e.type?e.parent.serviceItemId:e.serviceItemId}!function(e){e.attributes="attributes",e.attachments="attachments",e.charts="charts",e.images="images",e.richText="richText",e.summaryET="summaryET",e.arcade="arcade",e.relationship="relationship",e.associations="associations"}(V||(V={})),function(e){e.image="image",e.barChart="bar-chart",e.columnChart="column-chart",e.lineChart="line-chart",e.pieChart="pie-chart"}($||($={})),function(e){e.preview="preview",e.list="list",e.auto="auto"}(_||(_={}));const j=class{constructor(e){(0,s.r)(this,e),this.popupUpdated=(0,s.c)(this,"popupUpdated",7),this.bulkPopupUpdated=(0,s.c)(this,"bulkPopupUpdated",7),this.arcgisPopupDismissedChange=(0,s.c)(this,"arcgisPopupDismissedChange",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.resetMultiMediaIndex=(0,s.c)(this,"resetMultiMediaIndex",7),this.mainPopupReRender=(0,s.c)(this,"mainPopupReRender",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.closeAttributePopovers=(0,s.c)(this,"closeAttributePopovers",7),this.attributesChangeNotification=(0,s.c)(this,"attributesChangeNotification",7),this.arcadeChangeNotification=(0,s.c)(this,"arcadeChangeNotification",7),this.attributeData=[],this.fieldData=[],this.richTextElements=[],this.popupHasAttachment=!1,this.layerHasAttributes=!0,this.layerHasCharts=!0,this.layerHasImages=!0,this.layerHasText=!0,this.isPopupOpenForCurrentLayer=!1,this.relatedRecordsDefaultCount=1,this.guidList=[],this.debouncedPopupUpdates=(0,h.d)((e=>{var t,i,s,o,n;if((null===(t=this.mapView.popup)||void 0===t?void 0:t.selectedFeature)&&(null===(o=null===(s=null===(i=this.mapView.popup)||void 0===i?void 0:i.selectedFeatureWidget)||void 0===s?void 0:s.flowItems)||void 0===o?void 0:o.length)){const e=this.mapView.popup.selectedFeature;this.mapView.popup.features=void 0,setTimeout((()=>this.mapView.popup.features=[e]),1e3)}this.multiplePopupsSelected&&this.bulkPopupUpdated.emit(),this.disableEditing||(this.serviceType!==a.s.wms&&(e&&(null===(n=this.layer)||void 0===n?void 0:n.popupTemplate)||(this.layerDisplayType===a.l.feature?this.layer.popupEnabled===this.enableSwitchEl.checked&&(this.layer.popupTemplate=this.popupTemplate.clone()):this.layerDisplayType===a.l.cluster&&(this.layer.featureReduction.popupTemplate=this.popupTemplate.clone()))),this.popupUpdated.emit(this.layerDisplayType===a.l.mapNotes&&{mapNotesPopuptemplate:this.mapNotesPopupEnabled?this.popupTemplate.clone():null}),this.disableEditing=this.multiplePopupsSelected)}),1e3),this.manageExpressionBtnClick=e=>{e.stopPropagation(),this.closePopupPopovers.emit();const t=document.createElement("calcite-flow-item");t.heading=this.strings.manageExpressions,t.selected=!0;const i=document.createElement("arcgis-popup-expressions");t.appendChild(i),t.addEventListener("calciteFlowItemBack",(()=>{this.calciteFlowProps?this.calciteFlowProps.flow.removeChild(t):this.hostElement.shadowRoot.getElementById("popupFlow_Id").removeChild(t),this.popupPanel.selected=!0})),this.calciteFlowProps?this.calciteFlowProps.flow.appendChild(t):this.hostElement.shadowRoot.getElementById("popupFlow_Id").appendChild(t),this.popupPanel.selected=!1,setTimeout((()=>requestAnimationFrame((()=>i.setFocus()))),200)},this.popupTitleComponent=()=>(0,s.h)("arcgis-popup-title",{popupFlowItem:this.popupPanel,popupTemplate:this.popupTemplate}),this.fieldComponent=(e,t,i)=>(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-attributes",{guid:e,popupContent:t,popupFlowItem:this.popupPanel,blockOpen:i})),this.attachmentComponent=(e,t,i)=>{var o,a,n,l,r,p,c,d,h;return(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-attachments",{guid:e,attachmentContent:t,layerSupportsResizeAttachments:A(null===(n=null===(a=null===(o=this.layer)||void 0===o?void 0:o.capabilities)||void 0===a?void 0:a.attachment)||void 0===n?void 0:n.supportsResize)?this.layer.capabilities.attachment.supportsResize:!!(null===(p=null===(r=null===(l=this.layer)||void 0===l?void 0:l.capabilities)||void 0===r?void 0:r.operations)||void 0===p?void 0:p.supportsResizeAttachments),layerSupportsOrderingAttachments:!!(null===(h=null===(d=null===(c=this.layer)||void 0===c?void 0:c.sourceJSON)||void 0===d?void 0:d.advancedQueryCapabilities)||void 0===h?void 0:h.supportsQueryAttachmentOrderByFields),popupFlowItem:this.popupPanel,blockOpen:i}))},this.richtextComponent=(e,t,i)=>{var o,a;const n=null===(o=this.popupTemplate.toJSON().fieldInfos)||void 0===o?void 0:o.map((({fieldName:e,label:t})=>({name:e,alias:t||e})));this.fieldData=n||[];const l=null===(a=this.popupTemplate)||void 0===a?void 0:a.toJSON().expressionInfos,r=null==l?void 0:l.map((({expression:e,name:t,returnType:i,title:s})=>({name:`expression/${t}`,alias:"New expression"===s?" ":s,type:i,description:e})));return(null==r?void 0:r.length)&&(this.fieldData=this.fieldData.filter((e=>!r.some((t=>t.name===e.name))))),this.attributeData=r?[...r,...this.fieldData]:this.fieldData,(0,s.h)("div",{key:e,id:e,ref:e=>{e&&(this.richTextElements=[...this.richTextElements,e])}},(0,s.h)("arcgis-popup-richtext",{fieldExpressionData:{data:this.attributeData,placeholderText:this.strings.searchFields,heading:this.strings.selectField,label:this.strings.fieldsListPluginName,mapView:this.mapView,layer:this.layer},arcgisColorPickerData:{data:this.attributeData,filterPlaceholder:this.strings.searchAttributes,label:this.strings.colorPicker,doneText:this.strings.done,customText:this.strings.customText,attributeText:this.strings.attributeText},guid:e,richtextContent:t,popupFlowItem:this.popupPanel,blockOpen:i}))},this.multimediaComponent=(e,t,i)=>(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-multimedia",{guid:e,multimediaContent:t,popupFlowItem:this.popupPanel,blockOpen:i})),this.arcadeComponent=(e,t,i)=>(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-arcade",{guid:e,arcadeContent:t,blockOpen:i})),this.relationshipComponent=(e,t,i)=>(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-relationship",{guid:e,relatedRecordsContent:t,popupFlowItem:this.popupPanel,blockOpen:i})),this.associationsComponent=(e,t,i)=>(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-associations",{guid:e,associationsContent:t,popupFlowItem:this.popupPanel,blockOpen:i})),this.mapView=void 0,this.layer=void 0,this.portal=void 0,this.displayPopup=!0,this.config=void 0,this.layerDisplayType=a.l.feature,this.dismissible=!1,this.backButton=!1,this.hideLayerTitle=!1,this.showConfigureFields=!1,this.showManageExpressions=!0,this.disableEditing=!1,this.multiplePopupsSelected=!1,this.calciteFlowProps=null,this.mapNotesPopupTemplate=void 0,this.mapNotesGraphic=void 0,this.reRender=void 0,this.popupComponents=[],this.hasError=!1}async componentWillLoad(){var e,t,i,s,r,c;if((0,d.c)(d.p),[this.strings,this.currentLanguage,this.currentLanguageIntl]=await(0,o.g)(this.hostElement),this.serviceType=(0,n.d)(this.layer),await this.loadAllModules(),this.layer&&"load"in this.layer&&await this.layer.load(),this.supportsArcade=this.showManageExpressions&&(this.layerDisplayType===a.l.feature||this.layerDisplayType===a.l.cluster)&&this.serviceType!==a.s.ogcFeature&&this.serviceType!==a.s.imagery&&this.serviceType!==a.s.imageryTile&&this.serviceType!==a.s.wcs,this.serviceType===a.s.tile&&"url"in this.layer&&!("type"in this.layer)&&this.layer.url.indexOf(this.layer.layer.url)>-1)this.hasError=!0,console.error("popups not supported, no related feature service");else if(this.serviceType!==a.s.wms)if(this.layerDisplayType===a.l.feature){const s="type"in this.layer?this.layer.type:"sublayer",o=this.mapView.popup.visible?null===(e=this.mapView.popup.selectedFeature)||void 0===e?void 0:e.sourceLayer:void 0;this.isPopupOpenForCurrentLayer="subtype-sublayer"===s?(null==o?void 0:o.subtypeCode)===this.layer.subtypeCode&&(null==o?void 0:o.parent.id)===this.layer.parent.id:"sublayer"===s?(null==o?void 0:o.id)===this.layer.id&&(null==o?void 0:o.layer.id)===this.layer.layer.id:"id"in this.layer&&(null==o?void 0:o.id)===this.layer.id,A(null===(i=null===(t=this.layer.capabilities)||void 0===t?void 0:t.data)||void 0===i?void 0:i.supportsAttachment)&&(this.layerHasAttachment=this.layer.capabilities.data.supportsAttachment),this.layerHasET=!!this.layer.editFieldsInfo,d.p.layerHasRelatedRecords=await N(this.layer,this.mapView,this.serviceType),this.serviceType!==a.s.mapImage||this.layer.popupTemplate||(this.layer.popupEnabled=!1),this.popupTemplate=this.layer.popupTemplate?this.layer.popupTemplate.clone():this.layer.createPopupTemplate(),this.popupTemplate.fieldInfos=[...await(0,p.g)(this.layer,this.popupTemplate)]}else if(this.layerDisplayType===a.l.cluster)this.layerHasAttachment=!1,this.layerHasET=!1,this.popupTemplate=this.layer.featureReduction.popupTemplate.clone();else if(this.layerDisplayType===a.l.mapNotes){if(this.mapNotesPopupTemplate)this.mapNotesPopupEnabled=!0,this.popupTemplate=this.mapNotesPopupTemplate.clone();else{this.mapNotesPopupEnabled=!1;const[e]=await(0,l.l)(["esri/PopupTemplate"]);this.popupTemplate=new e}this.layerHasAttachment=!1,this.layerHasET=!1,this.layerHasAttributes=!1,this.layerHasCharts=!1}this.layerIsUNLayer=this.isUNLayer(this.layer),d.p.layer=this.layer,d.p.mapView=this.mapView,d.p.portal=this.portal,d.p.config=this.config,d.p.strings=this.strings,d.p.currentLanguage=this.currentLanguage,d.p.currentLanguageIntl=this.currentLanguageIntl,d.p.serviceType=this.serviceType,d.p.popupTemplate=this.popupTemplate,d.p.layerHasAttachment=this.layerHasAttachment,d.p.layerHasET=this.layerHasET,d.p.layerIsUNLayer=this.layerIsUNLayer,d.p.layerHasAttributes=this.layerHasAttributes,d.p.layerHasCharts=this.layerHasCharts,d.p.layerHasImages=this.layerHasImages,d.p.layerHasText=this.layerHasText,d.p.layerDisplayType=this.layerDisplayType,d.p.supportsArcade=this.supportsArcade,d.p.blockFeatureReductionArcade=function(){const{layer:e,mapView:t,layerDisplayType:i}=d.p;return i===a.l.cluster&&e.featureReduction.maxScale>=t.scale}(),this.layerDisplayType===a.l.cluster&&(this.featureReductionArcadeHandle=(r=this.layer,c=this.mapView,this.reactiveUtils.watch((()=>c.scale),(()=>{const e=r.featureReduction;c.scale<=e.maxScale&&!d.p.blockFeatureReductionArcade?d.p.blockFeatureReductionArcade=!0:c.scale>e.maxScale&&d.p.blockFeatureReductionArcade&&(d.p.blockFeatureReductionArcade=!1)})))),(null===(s=this.calciteFlowProps)||void 0===s?void 0:s.calciteFab)&&!this.getPopupEnabledProp()&&(this.calciteFlowProps.calciteFab.hidden=!0)}async componentDidLoad(){var e;if(this.popupTemplate){if("string"==typeof this.popupTemplate.content){const e=await(0,l.l)(["esri/popup/content/TextContent"]).then((([e])=>new e({text:this.popupTemplate.content})));this.popupTemplate.content=[e]}Array.isArray(this.popupTemplate.content)?this.popupTemplate.content.forEach(((e,t)=>{"attachments"!==e.type||this.layerHasAttachment?this.addToPopupComponents(e):this.popupTemplate.content.splice(t,1)})):console.error("content not supported"),this.reRender=!this.reRender}this.serviceType!==a.s.wms&&(this.layerDisplayType===a.l.feature&&this.watchForChangesToLayersList(),this.sortableComponents=this.hostElement.shadowRoot.getElementById("SortableComponents_Id"),this.calciteFab=(null===(e=this.calciteFlowProps)||void 0===e?void 0:e.calciteFab)||this.hostElement.shadowRoot.getElementById("addComponentBtn_Id"),this.setupResizeObserver(),this.calciteFab.onclick=e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.contentPopover||(this.contentPopover=document.createElement("arcgis-popup-main-contentpopover"),this.contentPopover.contentPopoverRefElement=this.calciteFab,this.contentPopover.popupHasAttachment=this.popupHasAttachment,this.contentPopover.popoverPanelWidth=this.hostElement.getBoundingClientRect().width,document.body.appendChild(this.contentPopover),this.calciteFab.disabled=!0,this.disablePopupPanel.emit(!0))}),requestAnimationFrame((()=>this.popupPanel.setFocus()))}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){var e,t,i;null===(e=this.featureReductionArcadeHandle)||void 0===e||e.remove(),null===(t=this.parentShellObserver)||void 0===t||t.disconnect(),null===(i=this.watchLayersAndTables)||void 0===i||i.remove(),this.contentPopover&&document.body.removeChild(this.contentPopover)}async done(){var e;this.resetMultiMediaIndex.emit(),this.closePopupPopovers.emit(),null===(e=this.attributesComponent)||void 0===e||e.done(),this.showPreviewPopup(!1)}async setFocus(e){var t;null===(t=this.calciteFab)||void 0===t||t.setFocus()}async update(){this.internalPopupUpdated.emit()}calciteFlowItemBackHandler(e){e.stopPropagation(),this.closePopupPopovers.emit()}mainPopupReRenderHandler(e){e.stopPropagation(),this.reRender=!this.reRender}internalPopupUpdatedHandler(e){e.stopPropagation(),this.debouncedPopupUpdates(e.detail)}deleteComponentHandler(e){e.stopPropagation(),this.closePopupPopovers.emit();const t=this.sortableComponents.getElementsByTagName("div");for(let i=0;i<t.length;i++)if(t[i].id===e.detail){this.popupTemplate.content.splice(i,1),this.popupComponents.splice(i,1),this.guidList.splice(i,1);break}if(this.popupHasAttachment=this.popupTemplate.content.some((e=>{if("attachments"===e.type)return!0})),this.richTextElements){const t=this.richTextElements.filter((t=>t.id!==e.detail));this.richTextElements=t}this.mainPopupReRender.emit(),this.calciteFab.setFocus()}duplicateComponentHandler(e){e.stopPropagation(),this.closePopupPopovers.emit();const t=this.sortableComponents.getElementsByTagName("div");for(let i=0;i<t.length;i++)if(t[i].id===e.detail){const e=this.popupTemplate.content[i].clone();this.popupTemplate.content.push(e),this.addToPopupComponents(e,!0);break}}closePopupPopoversHandler(){this.contentPopover&&(document.body.removeChild(this.contentPopover),this.contentPopover=null,this.calciteFab.disabled=!1,requestAnimationFrame((()=>this.calciteFab.setFocus())),this.disablePopupPanel.emit(!1))}notifyAddContentSelectionHandler(e){e.stopPropagation(),this.closePopupPopovers.emit(),e.detail===V.summaryET?(this.popupTemplate.lastEditInfoEnabled=!0,this.mainPopupReRender.emit(),this.summaryETDiv.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),this.calciteFab.setFocus()):this.addPopupContents(e.detail)}disablePopupPanelHandler(e){var t;e.stopPropagation();((null===(t=this.calciteFlowProps)||void 0===t?void 0:t.calciteFlowItem)||this.popupPanel).disabled=e.detail}arcadeChangeNotificationHandler(){var e;if(this.richTextElements){const t=null===(e=this.popupTemplate)||void 0===e?void 0:e.toJSON().expressionInfos.map((({expression:e,name:t,returnType:i,title:s})=>({name:`expression/${t}`,alias:"New expression"===s?" ":s,type:i,description:e})));this.attributeData=t?[...t,...this.fieldData]:this.fieldData,this.richTextElements.forEach((e=>{const t=e.firstChild;t.arcgisColorPickerData.data=this.attributeData,t.fieldExpressionData.data=this.attributeData}))}this.mainPopupReRender.emit()}async loadAllModules(){[this.LayerOptions,this.reactiveUtils]=await(0,l.l)(["esri/popup/LayerOptions","esri/core/reactiveUtils"])}watchForChangesToLayersList(){var e,t;this.layerDisplayType===a.l.feature&&[a.s.feature,a.s.mapImage].indexOf(this.serviceType)>-1&&(null===(t=null===(e=this.layer)||void 0===e?void 0:e.relationships)||void 0===t?void 0:t.length)&&(this.watchLayersAndTables=this.reactiveUtils.watch((()=>[this.mapView.map.allLayers.length,this.mapView.map.allTables.length]),(async()=>{d.p.layerHasRelatedRecords=await N(this.layer,this.mapView,this.serviceType)})))}enableDisablePopup(e){if(this.serviceType!==a.s.wms){this.hostElement.shadowRoot.getElementById("popupDiv_Id").style.display=e?"block":"none",this.calciteFab.style.display=e?"block":"none"}this.closePopupPopovers.emit()}getPopupEnabledProp(){switch(this.layerDisplayType){case a.l.feature:return(this.serviceType===a.s.wms||!!this.layer.popupTemplate)&&this.layer.popupEnabled;case a.l.cluster:return this.layer.featureReduction.popupEnabled;case a.l.mapNotes:return this.mapNotesPopupEnabled;default:return this.layer.popupEnabled}}reorder(e,t,i){const s=[...e];e.length=0,s.forEach(((s,o)=>{let a;i.forEach(((e,i)=>{t[o]===e&&(a=i)})),e[a]=s}))}addToPopupComponents(e,t=!1){const i=(0,r.g)();"fields"===e.type?(this.popupComponents=[...this.popupComponents,this.fieldComponent(i,e,t)],this.guidList=[...this.guidList,i]):"attachments"===e.type?(this.popupComponents=[...this.popupComponents,this.attachmentComponent(i,e,t)],this.popupHasAttachment=!0,this.guidList=[...this.guidList,i]):"media"===e.type?(this.popupComponents=[...this.popupComponents,this.multimediaComponent(i,e,t)],this.guidList=[...this.guidList,i]):"text"===e.type?(this.popupComponents=[...this.popupComponents,this.richtextComponent(i,e,t)],this.guidList=[...this.guidList,i]):"expression"===e.type?(this.popupComponents=[...this.popupComponents,this.arcadeComponent(i,e,t)],this.guidList=[...this.guidList,i]):"relationship"===e.type?(this.popupComponents=[...this.popupComponents,this.relationshipComponent(i,e,t)],this.guidList=[...this.guidList,i]):"utility-network-associations"===e.type&&(this.popupComponents=[...this.popupComponents,this.associationsComponent(i,e,t)],this.guidList=[...this.guidList,i])}async addPopupContents(e){const[t,i,s,o,n,r,p,c,d,h,u]=await(0,l.l)(["esri/popup/content/FieldsContent","esri/popup/content/AttachmentsContent","esri/popup/content/TextContent","esri/popup/content/MediaContent","esri/popup/content/ImageMediaInfo","esri/popup/content/ColumnChartMediaInfo","esri/popup/content/support/ImageMediaInfoValue","esri/popup/content/support/ChartMediaInfoValue","esri/popup/content/ExpressionContent","esri/popup/content/RelationshipContent","esri/popup/content/UtilityNetworkAssociationsContent"]);let m=null;if(e===V.attributes)m=new t({fieldInfos:null});else if(e===V.attachments)m=new i({displayType:null});else if(e===V.richText)m=new s({text:null});else if(e===V.images){m=new o({mediaInfos:[new n({title:"",caption:"",altText:"",value:new p({sourceURL:"",linkURL:""})})]})}else if(e===V.charts){m=new o({mediaInfos:[new r({title:"",caption:"",altText:"",value:new c({fields:[]})})]})}else if(e===V.arcade)m=new d({expressionInfo:{expression:L(this.layerDisplayType,this.strings)}});else if(e===V.relationship){const e=await(async(e,t,i)=>{var s;if([a.s.feature,a.s.scene,a.s.mapImage,a.s.subtype].indexOf(i)>-1&&(null===(s=null==e?void 0:e.relationships)||void 0===s?void 0:s.length))for(const i of e.relationships){const s=U(t);for(const t of s){const s=t;if("subtype-sublayer"!==s.type&&"subtype-group"!==s.type&&await B(e,s,i))return await s.load(),{relationship:i,currLayer:s}}}})(this.layer,this.mapView,this.serviceType);let t=e.currLayer.fields.find((e=>e.visible&&"date"===e.type));t||(t=e.currLayer.fields.find((e=>e.visible))),m=new h({displayCount:this.relatedRecordsDefaultCount,relationshipId:e.relationship.id,orderByFields:[{field:t.name,order:"asc"}]})}else if(e===V.associations){m=new u({associationTypes:[{type:"attachment"}],displayCount:1,title:"",description:""})}this.popupTemplate.content.push(m),this.addToPopupComponents(m,!0)}async showPreviewPopup(e){var t,i,s;this.displayPopup&&this.layerDisplayType===a.l.feature&&!this.isPopupOpenForCurrentLayer?e&&this.layer.popupEnabled&&this.layer.popupTemplate?((null===(i=null===(t=this.mapView.popup)||void 0===t?void 0:t.features)||void 0===i?void 0:i.length)&&(this.mapView.closePopup(),this.mapView.popup.features=void 0),this.previewPopupController=new AbortController,this.singleFeature=await(0,p.p)(this.mapView,this.layer,this.previewPopupController)):(null===(s=this.previewPopupController)||void 0===s||s.abort(),this.mapView.closePopup()):this.layerDisplayType===a.l.mapNotes&&(e&&this.mapNotesGraphic?this.mapView.openPopup({features:[this.mapNotesGraphic],location:(0,n.o)(this.mapNotesGraphic.geometry)}):this.mapView.closePopup())}setupResizeObserver(){var e;const t=null===(e=this.hostElement)||void 0===e?void 0:e.parentElement;if("CALCITE-SHELL-PANEL"===(null==t?void 0:t.tagName)){const e=t;A(e.collapsed)&&(this.parentShellObserver=new ResizeObserver((()=>{e.collapsed?this.done():this.showPreviewPopup(!0)})),this.parentShellObserver.observe(e))}else(this.layerDisplayType!==a.l.mapNotes||A(this.mapNotesPopupTemplate))&&this.showPreviewPopup(!0)}createLayerOptions(){var e,t;const i=this.popupTemplate.layerOptions||new this.LayerOptions;i.showNoDataRecords=null!==(e=i.showNoDataRecords)&&void 0!==e&&e,i.returnTopmostRaster=null===(t=i.returnTopmostRaster)||void 0===t||t,this.popupTemplate.layerOptions=i}isUNLayer(e){const{mapView:t,portal:i}=this,{portalHostname:s}=i,{map:o}=t,{utilityNetworks:a}=o;if(!a)return!1;const n=i.isPortal,l="1"===window.localStorage.getItem("utility-networks-agol")&&("devext.arcgis.com"===s||"qaext.arcgis.com"===s);if(!n&&!l)return!1;const r=z(e),p=a.find((e=>{var t;return(null===(t=e.sourceJSON)||void 0===t?void 0:t.serviceItemId)===r}));if(!p)return!1;return p.isUtilityLayer(e)}render(){var e,t,i,o,l,r;if(this.hasError)return this.renderPopupError();const p=(0,s.h)("calcite-label",{class:u,alignment:"start",layout:"inline-space-between"},this.strings.enablePopup,(0,s.h)("calcite-switch",{scale:"s",checked:this.getPopupEnabledProp(),ref:e=>this.enableSwitchEl=e,onCalciteSwitchChange:e=>{const t=e.target.checked;switch(this.layerDisplayType){case a.l.feature:this.layer.popupEnabled=t;break;case a.l.cluster:this.layer.featureReduction.popupEnabled=t;break;case a.l.mapNotes:this.mapNotesPopupEnabled=t;break;default:this.layer.popupEnabled=t}this.enableDisablePopup(t),this.internalPopupUpdated.emit(!0),this.layerDisplayType!==a.l.mapNotes&&t&&!this.layer.popupTemplate&&(this.layer.popupTemplate=this.popupTemplate),this.showPreviewPopup(t)}})),h=(0,s.h)("calcite-button",{alignment:"icon-end-space-between",appearance:"transparent",kind:"neutral",iconEnd:"rtl"===(0,c.g)(this.hostElement)?"chevron-left":"chevron-right",label:this.strings.manageExpressions,width:"full",onClick:this.manageExpressionBtnClick},this.strings.manageExpressions),b=(0,s.h)("calcite-label",{alignment:"start",layout:"inline-space-between"},this.strings.ignoreNoData,(0,s.h)("calcite-switch",{scale:"s",checked:!(null!==(i=null===(t=null===(e=this.popupTemplate)||void 0===e?void 0:e.layerOptions)||void 0===t?void 0:t.showNoDataRecords)&&void 0!==i&&i),onCalciteSwitchChange:e=>{var t;const i=e.target.checked;(null===(t=this.popupTemplate)||void 0===t?void 0:t.layerOptions)||this.createLayerOptions(),this.popupTemplate.layerOptions.showNoDataRecords=!i,this.internalPopupUpdated.emit()}})),P=(0,s.h)("calcite-label",{alignment:"start",layout:"inline-space-between"},this.strings.displayTopmost,(0,s.h)("calcite-switch",{scale:"s",checked:null===(r=null===(l=null===(o=this.popupTemplate)||void 0===o?void 0:o.layerOptions)||void 0===l?void 0:l.returnTopmostRaster)||void 0===r||r,onCalciteSwitchChange:e=>{var t;const i=e.target.checked;(null===(t=this.popupTemplate)||void 0===t?void 0:t.layerOptions)||this.createLayerOptions(),this.popupTemplate.layerOptions.returnTopmostRaster=i,this.internalPopupUpdated.emit()}})),C=(0,s.h)("section",{class:f},(0,s.h)("calcite-icon",{scale:"m",icon:"user"}),(0,s.h)("label",{class:g},this.strings.summaryETHeading),(0,s.h)("calcite-action",{text:this.strings.remove,appearance:"transparent",icon:"x",class:v,onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.popupTemplate.lastEditInfoEnabled=!1,this.mainPopupReRender.emit(),this.calciteFab.setFocus()}})),k=(0,s.h)("calcite-fab",{hidden:!this.getPopupEnabledProp(),id:"addComponentBtn_Id",icon:"plus",slot:"fab",scale:"s",appearance:"outline-fill",kind:"neutral",label:this.strings.addContent,text:this.strings.addContent,"text-enabled":!0}),I=(0,s.h)("calcite-button",{alignment:"icon-end-space-between",appearance:"transparent",kind:"neutral",iconEnd:"rtl"===(0,c.g)(this.hostElement)?"chevron-left":"chevron-right",label:this.strings.configureFields,width:"full",onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit();const t=document.createElement("calcite-flow-item");t.heading=this.strings.attributes,t.description=this.hideLayerTitle?void 0:this.layer.title,t.selected=!0,this.popupPanel.selected=!1,this.attributesComponent=document.createElement("arcgis-attributes"),this.attributesComponent.lang=this.currentLanguage,this.attributesComponent.layer=this.layer,this.attributesComponent.mapView=this.mapView,this.attributesComponent.portal=this.portal,this.attributesComponent.layerDisplayType=this.layerDisplayType,this.attributesComponent.config=this.config,this.attributesComponent.calciteFlowProps=!0,this.attributesComponent.displayPopup=!1,this.attributesComponent.addEventListener("attributesUpdated",(async e=>{e.stopPropagation(),this.popupTemplate=this.layer.popupTemplate.clone(),d.p.popupTemplate=this.popupTemplate,this.popupComponents=[],this.guidList=[],this.popupTemplate.content.forEach((e=>this.addToPopupComponents(e))),this.attributesChangeNotification.emit(),this.mainPopupReRender.emit()})),t.appendChild(this.attributesComponent),t.beforeBack=async()=>{this.closeAttributePopovers.emit()},t.addEventListener("calciteFlowItemBack",(()=>{this.calciteFlowProps?this.calciteFlowProps.flow.removeChild(t):this.hostElement.shadowRoot.getElementById("popupFlow_Id").removeChild(t),this.popupPanel.selected=!0})),this.calciteFlowProps?this.calciteFlowProps.flow.appendChild(t):this.hostElement.shadowRoot.getElementById("popupFlow_Id").appendChild(t),setTimeout((()=>requestAnimationFrame((()=>t.setFocus()))),200)}},this.strings.configureFields),w=()=>{var e,t,i;const o=this.layer,a=!!(null===(t=null===(e=o.capabilities)||void 0===e?void 0:e.operations)||void 0===t?void 0:t.supportsQuery)&&(null===(i=o.fields)||void 0===i?void 0:i.length),l=o.hasMultidimensions;return(0,s.h)("div",{class:y},b,(0,n.p)(o)>=10.8&&(a||l)&&P)},x=(0,s.h)("div",null,p,(0,s.h)("div",{id:"popupDiv_Id",hidden:!this.getPopupEnabledProp()},(()=>{const e=this.showConfigureFields,t=this.serviceType===a.s.imagery;if(e||this.supportsArcade||t)return(0,s.h)("calcite-block",{heading:this.strings.options,open:!0,collapsible:!0},t&&w(),this.supportsArcade&&h,e&&I)})(),this.popupTitleComponent(),(0,s.h)("div",{class:m},(0,s.h)("calcite-sortable-list",{id:"SortableComponents_Id",class:"sortable-list",handleSelector:"calcite-sort-handle",onCalciteListOrderChange:e=>{e.stopPropagation(),this.sortableComponents=this.hostElement.shadowRoot.getElementById("SortableComponents_Id");const t=[],i=this.sortableComponents.getElementsByTagName("div");for(let e=0;e<i.length;e++)t.push(i[e].id);this.reorder(this.popupTemplate.content,this.guidList,t),this.reorder(this.popupComponents,this.guidList,t),this.guidList=t,this.internalPopupUpdated.emit()}},this.popupComponents)),(0,s.h)("div",{ref:e=>this.summaryETDiv=e},this.layerHasET&&this.popupTemplate.lastEditInfoEnabled&&C))),L=(0,s.h)("calcite-action",{text:this.strings.back,scale:"s",slot:"header-actions-start",ref:e=>this.backButtonEl=e,onClick:e=>{e.stopPropagation(),this.done(),this.arcgisPopupDismissedChange.emit()}},(0,s.h)("calcite-icon",{icon:"rtl"===(0,c.g)(this.hostElement)?"chevron-right":"chevron-left"}));return(0,s.h)(s.H,{style:this.calciteFlowProps?{}:{display:"flex",flex:"1 1 auto",overflow:"hidden"}},this.calciteFlowProps?(0,s.h)("div",{dir:(0,c.g)(this.hostElement),ref:()=>this.popupPanel=this.calciteFlowProps.calciteFlowItem},this.serviceType===a.s.wms?p:x):(0,s.h)("calcite-flow",{id:"popupFlow_Id",dir:(0,c.g)(this.hostElement),customItemSelectors:"arcgis-popup-expressions"},(0,s.h)("calcite-flow-item",{ref:e=>this.popupPanel=e,heading:this.strings.popupHeading,description:this.hideLayerTitle?void 0:this.layer.title,closable:this.dismissible,onCalciteFlowItemClose:e=>{e.stopPropagation(),this.done(),this.arcgisPopupDismissedChange.emit()}},this.serviceType===a.s.wms?p:x,this.serviceType!==a.s.wms&&k,this.backButton&&L)))}renderPopupError(){const e=(0,s.h)("div",{class:b},(0,s.h)("calcite-notice",{open:!0,closable:!1,icon:"exclamation-mark-triangle",scale:"s"},(0,s.h)("div",{slot:"message"}," ",this.strings.popupTileError)));return(0,s.h)(s.H,{style:this.calciteFlowProps?{}:{display:"flex",flex:"1 1 auto",overflow:"hidden"}},this.calciteFlowProps?(0,s.h)("div",{dir:(0,c.g)(this.hostElement),ref:()=>this.popupPanel=this.calciteFlowProps.calciteFlowItem},e):(0,s.h)("calcite-flow",{id:"popupFlow_Id",dir:(0,c.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{ref:e=>this.popupPanel=e,heading:this.strings.popupHeading,description:this.hideLayerTitle?void 0:this.layer.title,closable:this.dismissible,onCalciteFlowItemClose:e=>{e.stopPropagation(),this.done(),this.arcgisPopupDismissedChange.emit()}},e)))}get hostElement(){return(0,s.d)(this)}};j.style=".enable-popup{background-color:var(--arcgis-app-background);display:flex;padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-cap-spacing-half) var(--arcgis-app-cap-spacing-quarter);border-bottom:solid 1px var(--arcgis-app-border)}.component-ul{margin:0 0 var(--arcgis-app-cap-spacing);padding:0}.summary-et{display:flex;align-items:center;padding:0% var(--arcgis-app-cap-spacing-three-quarters)}.summary-et-label{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden;padding:0% var(--arcgis-app-cap-spacing-half);font-size:medium}.summary-et-action{margin:0;flex:0 0 0%;justify-self:flex-end}.notice{margin:0.5rem}.imagery-options{padding:0 var(--arcgis-app-cap-spacing-three-quarters)}.sortable-list{display:block}";const W=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.guid=void 0,this.arcadeContent=void 0,this.blockOpen=!1,this.reRender=void 0}async componentWillLoad(){this.layer=d.p.layer,this.mapView=d.p.mapView,this.portal=d.p.portal,this.config=d.p.config,this.strings=d.p.strings,this.currentLanguage=d.p.currentLanguage,this.serviceType=d.p.serviceType,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType}async componentDidLoad(){this.blockOpen&&(this.blockOptions.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),await this.launchArcade())}async launchArcade(){var e,t,i;this.arcadeEditor||(this.disablePopupPanel.emit(!0),this.arcadeEditor=document.createElement("arcgis-modal-arcade"),this.arcadeEditor.arcadeScript=P(null===(e=this.arcadeContent.expressionInfo)||void 0===e?void 0:e.expression,this.layerDisplayType,this.strings),this.arcadeEditor.arcadeProfile=await C(this.layer,this.mapView,this.serviceType,this.popupTemplate,this.layerDisplayType),this.arcadeEditor.testData=await k(this.layer,this.mapView,this.layerDisplayType,this.popupTemplate),this.arcadeEditor.suggestions=I(this.layer,this.strings,"popupElement"),this.arcadeEditor.addExistingExpressions=!0,this.arcadeEditor.layer=this.layer,this.arcadeEditor.arcadeTitle=(null===(t=this.arcadeContent.expressionInfo)||void 0===t?void 0:t.title)||this.strings.arcadeDefaultTitle,this.arcadeEditor.arcadeTitleEditable=!0,this.arcadeEditor.returnPredictOutputType=!1,this.arcadeEditor.arcadeTitleEditingEnabled=!(null===(i=this.arcadeContent.expressionInfo)||void 0===i?void 0:i.title),document.body.appendChild(this.arcadeEditor),this.arcadeEditor.addEventListener("arcgisModalArcadeClose",(e=>this.arcadeSetup(e.detail))))}async arcadeSetup(e){e&&(this.arcadeContent.expressionInfo.expression=e.script,this.arcadeContent.expressionInfo.title=e.title,this.reRender=!this.reRender,this.internalPopupUpdated.emit()),this.disablePopupPanel.emit(!1),document.body.removeChild(this.arcadeEditor),this.arcadeEditor=null}render(){return(0,s.h)(s.H,{key:"2fe995cce3cec8646409d74ec109736c9f018b76"},(0,s.h)("calcite-block",{key:"332a6bb95f1c7c0e609acc59adc9e4d0d27d9cc3",dir:(0,c.g)(this.hostElement),heading:this.strings.arcade,description:this.arcadeContent.expressionInfo.title,collapsible:!0,open:this.blockOpen,dragHandle:!0},(0,s.h)("div",{key:"66fdbbd8e6c03aca9a93dc62437a442009a70c5e",class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{key:"2e4bcb80e51151b6592dac9706ead5e1a22ae024",ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:!0,disableDuplicate:d.p.blockFeatureReductionArcade}})),(0,s.h)("div",{key:"427bd2c9070494c2d5ac4423038b7d0b5fc1b3f1",slot:"icon"},(0,s.h)("calcite-icon",{key:"30c7526cd9b672ec1aa90fe6b4bbc0e0a763b967",scale:"m",icon:"code"})),(0,s.h)("div",{key:"586070d24a67d197547f677b5d6ae7c42c67a29a",class:"ignore-elements-sortable"},(0,s.h)("calcite-button",{key:"55a503630f4e06321e8f6c6aaa9583d1ab133b2b",disabled:d.p.blockFeatureReductionArcade,appearance:"transparent",width:"full",onClick:async()=>await this.launchArcade()},this.strings.editExpression))))}get hostElement(){return(0,s.d)(this)}},q=["attachment","connectivity","container","content","structure"];var Q;!function(e){e.title="title",e.description="description",e.displayCount="displayCount"}(Q||(Q={}));const J=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.notifyAssociationsChange=(0,s.c)(this,"notifyAssociationsChange",7),this.sourceUtilityNetworkLayerList=[],this.utilityNetworkLayerIdMap=new Map,this.refElement=void 0,this.associationsContent=void 0,this.associationType=void 0}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}async reposition(){var e;null===(e=this.popoverNode)||void 0===e||e.reposition()}async componentWillLoad(){this.allUtilityNetworkLayers=await this.getAllUtilityNetworkLayers();const{mapView:e,layer:t}=d.p,{map:i}=e,{utilityNetworks:o}=i,a=z(t);this.currentUtilityNetwork=o.find((e=>{var t;return(null===(t=e.sourceJSON)||void 0===t?void 0:t.serviceItemId)===a})),this.syncUtilityNetworkLayerIdMap();const[n]=await(0,l.l)(["esri/core/reactiveUtils"]);this.layerListHandle=n.watch((()=>i.allLayers.filter((e=>z(e)===a)).length),(()=>{this.syncUtilityNetworkLayerIdMap(),(0,s.f)(this.hostElement)}))}componentDidLoad(){var e;this.notifyAssociationsChange.emit(),null===(e=this.panelNode)||void 0===e||e.setFocus()}componentDidUpdate(){this.notifyAssociationsChange.emit()}disconnectedCallback(){var e;null===(e=this.layerListHandle)||void 0===e||e.remove()}render(){const{strings:e}=d.p;return(0,s.h)(s.H,{key:"3048cafbe13cd8f19b1feea375f5bc0dafdb6751",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"a8c0ddab70e5cbddf400b0841de36e5893f0db05",dir:(0,c.g)(this.hostElement),class:"popover",placement:"leading-start",open:!0,pointerDisabled:!0,referenceElement:this.refElement,offsetDistance:-Math.round(this.refElement.getBoundingClientRect().width),offsetSkidding:50,label:e.associations.configureType,triggerDisabled:!0,ref:e=>this.popoverNode=e},(0,s.h)("calcite-panel",{key:"18b9f2a5095440eb7885c897373e51af0450497d",ref:e=>this.panelNode=e,closable:!0,style:{width:`${this.refElement.getBoundingClientRect().width}px`},onCalcitePanelClose:()=>this.closePopupPopovers.emit()},(0,s.h)("div",{key:"9bf85a6879cc69948b63ca210d972e3d760205e6",slot:"header-content"},e.associations.configureType),this.renderDoneButton(),(0,s.h)("div",{key:"93a09d0b9781cd84ca8f3222a0fa3cfdbc652563",class:"associations-div"},this.renderAssociationsTypeSelection(),this.renderAssociationsFilterForLayerSelection(),this.renderAssociationsDisplayOptions()))))}renderAssociationsTypeSelection(){const{strings:e}=d.p,{associationsContent:t,associationType:i}=this,o=t.associationTypes.map((e=>e.type)),a=q.filter((e=>i.type===e||!o.includes(e))).map((e=>{const t=this.getAssociationText(e);return(0,s.h)("calcite-combobox-item",{value:e,heading:t,textLabel:t,selected:e===i.type})}));return(0,s.h)("calcite-label",null,e.associations.type,(0,s.h)("calcite-combobox",{label:e.associations.type,scale:"s",selectionMode:"single-persist",clearDisabled:!0,onCalciteComboboxChange:e=>{e.preventDefault(),e.stopPropagation(),this.changeAssociationProperties()},ref:e=>this.typeComboboxNode=e,overlayPositioning:"fixed"},a))}renderAssociationsFilterForLayerSelection(){const{strings:e}=d.p;return this.syncUtilityNetworkLayerIdMap(),this.setSourceLayerList(),(0,s.h)("calcite-label",null,e.associations.layer,(0,s.h)("calcite-combobox",{label:e.associations.layer,scale:"s",selectionMode:"single-persist",placeholder:e.associations.optionalLayerSelection,onCalciteComboboxChange:e=>{e.preventDefault(),e.stopPropagation(),this.changeAssociationProperties()},ref:e=>this.layerComboboxNode=e,overlayPositioning:"fixed"},this.sourceUtilityNetworkLayerList))}renderAssociationsDisplayOptions(){const{strings:e}=d.p;return(0,s.h)("div",null,(0,s.h)("calcite-block-section",{open:!0,text:e.options},(0,s.h)("div",{class:"options-block"},this.renderTitle(),this.renderDescription())))}renderTitle(){const{strings:e}=d.p;return(0,s.h)("calcite-label",{scale:"s"},e.title,(0,s.h)("div",{class:"form-input-button"},(0,s.h)("calcite-input",{type:"text",ref:e=>this.editAssociationTitle=e,value:this.associationType.title,placeholder:e.enterTitle,onCalciteInputInput:(0,h.d)((e=>{e.preventDefault(),e.stopPropagation(),this.changeAssociationProperties()}),300)})))}renderDescription(){const{strings:e}=d.p;return(0,s.h)("calcite-label",{scale:"s"},e.desc,(0,s.h)("div",{class:"form-input-button"},(0,s.h)("calcite-input",{type:"text",ref:e=>this.editAssociationDescription=e,value:this.associationType.description,placeholder:e.enterDescription,onCalciteInputInput:(0,h.d)((e=>{e.preventDefault(),e.stopPropagation(),this.changeAssociationProperties()}),300)})))}renderDoneButton(){const{strings:e}=d.p;return(0,s.h)("calcite-button",{appearance:"outline-fill",slot:"footer",width:"full",onClick:()=>this.closePopupPopovers.emit()},e.done)}async getAllUtilityNetworkLayers(){var e,t;const{layer:i}=d.p,s=`${"url"in i&&i.url||"portalItem"in i&&(null===(e=i.portalItem)||void 0===e?void 0:e.url)}/layers`;try{const[e]=await(0,l.l)(["esri/request"]),i=await e(s,{responseType:"json",method:"auto",query:{f:"json"}}),o=null===(t=null==i?void 0:i.data)||void 0===t?void 0:t.layers;return Promise.resolve(o)}catch(e){return Promise.resolve([])}}syncUtilityNetworkLayerIdMap(){const{mapView:e,layer:t}=d.p,{map:i}=e,{allUtilityNetworkLayers:s,currentUtilityNetwork:o}=this;this.utilityNetworkLayerIdMap.clear();const a=z(t),n=i.allLayers.flatten((e=>"sublayers"in e?e.sublayers:null)),l=n.filter((e=>z(e)===a));l.forEach((e=>{const t="subtype-sublayer"===e.type?e.parent.layerId:e.layerId,i=s.find((e=>e.id===t)).name;this.utilityNetworkLayerIdMap.set(t,i)}));const r=this.associationType.associatedNetworkSourceId,p=o.getLayerIdBySourceId(r);this.utilityNetworkLayerIdMap.has(p)||(this.associationType.associatedNetworkSourceId=null)}setSourceLayerList(){const{allUtilityNetworkLayers:e,currentUtilityNetwork:t,associationType:i}=this;this.sourceUtilityNetworkLayerList=e.filter((e=>(0,h.e)(this.utilityNetworkLayerIdMap.get(e.id))&&(0,h.e)(t.getSourceIdByLayerId(e.id)))).map((e=>{const o=this.utilityNetworkLayerIdMap.get(e.id),a=t.getSourceIdByLayerId(e.id);return(0,s.h)("calcite-combobox-item",{value:a,heading:o,textLabel:o,selected:i.associatedNetworkSourceId===a})}))}changeAssociationProperties(){var e,t,i;this.associationType.title=this.editAssociationTitle.value,this.associationType.description=this.editAssociationDescription.value,this.associationType.type=null===(e=this.typeComboboxNode.selectedItems[0])||void 0===e?void 0:e.value,this.associationType.associatedNetworkSourceId=null!==(i=null===(t=this.layerComboboxNode.selectedItems[0])||void 0===t?void 0:t.value)&&void 0!==i?i:null,(0,s.f)(this.hostElement)}getAssociationText(e){const{strings:t}=d.p;switch(e){case"attachment":return t.associations.attachment;case"connectivity":return t.associations.connectivity;case"container":return t.associations.container;case"content":return t.associations.content;case"structure":return t.associations.structure}}get hostElement(){return(0,s.d)(this)}};J.style=".popover{--calcite-popover-z-index:100}.associations-div{background-color:var(--arcgis-app-background);padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-side-spacing-half);max-height:calc(60vh - 102px);}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}.options-block{margin-top:8px}";const G=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.deleteComponent=(0,s.c)(this,"deleteComponent",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.guid=void 0,this.popupFlowItem=void 0,this.blockOpen=!1,this.associationsContent=void 0}closePopupPopoversHandler(e){var t,i,s;(null==e?void 0:e.detail)!==this.guid&&this.associationConfigPopover&&(null===(i=null===(t=this.associationConfigPopover)||void 0===t?void 0:t.parentElement)||void 0===i||i.removeChild(this.associationConfigPopover),this.associationConfigPopover=void 0,null===(s=this.addAssociationsButtonNode)||void 0===s||s.setFocus()),this.popupFieldSelectionPickList&&(this.popupFieldSelectionPickList.parentElement.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=void 0),this.disablePopupPanel.emit(!1)}async componentWillLoad(){const{mapView:e,layer:t}=d.p,{map:i}=e,[s]=await(0,l.l)(["esri/core/reactiveUtils"]);this.utilityNetworkWatchHandle=s.watch((()=>i.utilityNetworks.length),(e=>{if(e){const e=z(t),s=i.utilityNetworks.find((t=>{var i;return(null===(i=t.sourceJSON)||void 0===i?void 0:i.serviceItemId)===e}));d.p.layerIsUNLayer=(0,h.e)(s)}else d.p.layerIsUNLayer=!1;d.p.layerIsUNLayer||this.closePopupPopovers.emit()}))}componentDidLoad(){var e,t;const{blockOpen:i,associationsContent:s}=this;i&&(null===(e=this.addAssociationsButtonNode)||void 0===e||e.scrollIntoView({behavior:"auto",block:"nearest",inline:"start"}),1===s.associationTypes.length?this.openAssociationConfigPopover(s.associationTypes[0]):null===(t=this.blockOptionsNode)||void 0===t||t.setFocus())}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){var e;null===(e=this.utilityNetworkWatchHandle)||void 0===e||e.remove()}render(){var e;const{strings:t,layerIsUNLayer:i}=d.p,{associationsContent:o}=this,a=q.every((e=>(0,h.e)(o.associationTypes.find((t=>t.type===e)))));return(0,s.h)(s.H,{key:"4c22fe842024ee25e673970649cf992c4ebb43be"},(0,s.h)("calcite-block",{key:"c02db716d38c5aaba5fb5c89f2b2df70f4ffe38e",disabled:!i,dir:(0,c.g)(this.hostElement),heading:t.associations.associations,description:o.title?this.getAssociationsBlockCustomDescription(o.title):this.getAssociationsBlockDefaultDescription(),collapsible:!0,open:this.blockOpen,dragHandle:!0,ref:e=>this.blockNode=e},(0,s.h)("div",{key:"d6c7c9ddfe49baf83831639f0da6b05dbda74dbd",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{key:"56c68ec6080fbd979fe34bb73d353f72d24ced2c",ref:e=>this.blockOptionsNode=e,guid:this.guid,intlOptions:t.options,intlDelete:t.delete,intlDuplicate:t.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:!1}})),(0,s.h)("div",{key:"bf677f2cc4e81b322de13d041f0e5ad8abfc272a",slot:"icon"},(0,s.h)("calcite-icon",{key:"d12fe4d88839c4e99ae92e1ab5840c258d07771a",icon:"view-associations"})),(0,s.h)("div",{key:"851a39cab8a27f128084c6968f3e7f4c871d0de8"},this.renderFormInput(Q.title,t.title,(e=>this.contentTitle=e),o.title,t.enterTitle),this.renderFormInput(Q.description,t.desc,(e=>this.contentDescription=e),o.description,t.enterDescription),this.renderFormInput(Q.displayCount,t.associations.previewCount,void 0,`${null!==(e=o.displayCount)&&void 0!==e?e:""}`,t.associations.enterPreviewCount)),(0,s.h)("calcite-label",{key:"c069a918b23fd76552e5fba6de5d890096fa9205",class:"disable-spacing",scale:"s"},t.associations.types),(0,s.h)("calcite-list",{key:"b1b8136d5bb94d8b6bee222ceb60980d738557cb",label:t.associations.types,dragEnabled:!0,onCalciteListOrderChange:e=>{const t=e.detail.oldIndex,i=e.detail.newIndex;this.handleListOrderChange(t,i)}},this.associationsContent.associationTypes.map(((e,i)=>(0,s.h)("calcite-list-item",{key:`${e.type}`,label:e.title?this.getAssociationsBlockCustomDescription(e.title):t.noTitle,description:this.getAssociationText(e.type),onClick:t=>{t.stopPropagation(),this.closePopupPopovers.emit(),this.openAssociationConfigPopover(e)}},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:t.remove,onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.associationsContent.associationTypes.splice(i,1),0===this.associationsContent.associationTypes.length?this.deleteComponent.emit(this.guid):this.internalPopupUpdated.emit(),(0,s.f)(this.hostElement)}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))))),a?(0,s.h)(s.F,null):(0,s.h)("calcite-button",{ref:e=>this.addAssociationsButtonNode=e,title:t.associations.addAssociation,appearance:"outline-fill",round:!0,scale:"s",class:"add-association-button",iconStart:"plus",onClick:e=>{if(e.stopPropagation(),this.closePopupPopovers.emit(),!this.associationConfigPopover){const e=this.associationsContent.associationTypes.map((e=>e.type)),t={type:q.filter((t=>!e.includes(t)))[0]};this.associationsContent.associationTypes.push(t),this.openAssociationConfigPopover(t),this.internalPopupUpdated.emit()}}})))}renderFormInput(e,t,i,o,a){var n;const{strings:l,popupTemplate:r}=d.p;return(0,s.h)("calcite-label",{scale:"s"},t,e===Q.displayCount?(0,s.h)("calcite-input-number",{autofocus:!0,integer:!0,min:0,max:100,value:o,placeholder:a,onCalciteInputNumberInput:e=>{e.stopPropagation();const t=e.target,i=t.value,s=this.associationsContent.displayCount,o=parseInt(i);s!==o&&(Number.isNaN(o)?(this.associationsContent.displayCount=null,t.value=""):o>t.max?(this.associationsContent.displayCount=t.max,t.value=`${t.max}`):o<t.min?(this.associationsContent.displayCount=t.min,t.value=`${t.min}`):this.associationsContent.displayCount=o,this.internalPopupUpdated.emit())},onClick:()=>this.closePopupPopovers.emit()}):(0,s.h)("div",{class:"form-input-button"},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i,value:o,placeholder:a,onCalciteInputInput:t=>{t.stopPropagation();const i=t.target.value;e===Q.title?(this.associationsContent.title=i,this.associationsContent.title?this.blockNode.description=this.getAssociationsBlockCustomDescription(this.associationsContent.title):this.blockNode.description=this.getAssociationsBlockDefaultDescription()):this.associationsContent.description=i,this.internalPopupUpdated.emit()},onClick:()=>this.closePopupPopovers.emit()}),(null===(n=r.fieldInfos)||void 0===n?void 0:n.length)?(0,s.h)("calcite-action",{text:l.attributes,scale:"s",icon:"brackets-curly",onClick:()=>{this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem,offsetSkidding:50},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=l.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>this.closePopupPopovers.emit())),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))}}):(0,s.h)(s.F,null)))}openAssociationConfigPopover(e){this.associationConfigPopover=document.createElement("arcgis-popup-association-config-popover"),this.associationConfigPopover.refElement=this.popupFlowItem,this.associationConfigPopover.associationsContent=this.associationsContent,this.associationConfigPopover.associationType=e,this.associationConfigPopover.addEventListener("notifyAssociationsChange",(()=>(0,s.f)(this.hostElement))),document.body.appendChild(this.associationConfigPopover),this.disablePopupPanel.emit(!0)}handleListOrderChange(e,t){const i=this.associationsContent.associationTypes[e];this.associationsContent.associationTypes.splice(e,1),this.associationsContent.associationTypes.splice(t,0,i),this.internalPopupUpdated.emit(),this.closePopupPopovers.emit(),(0,s.f)(this.hostElement)}getAssociationsBlockDefaultDescription(){const{strings:e}=d.p,{associationsContent:t}=this;return 1===t.associationTypes.length?this.getAssociationText(t.associationTypes[0].type):`${e.multiple} (${t.associationTypes.length})`}getAssociationsBlockCustomDescription(e){return`${e.substring(0,25)}${e.length>25?"...":""}`}getAssociationText(e){const{strings:t}=d.p;switch(e){case"attachment":return t.associations.attachment;case"connectivity":return t.associations.connectivity;case"container":return t.associations.container;case"content":return t.associations.content;case"structure":return t.associations.structure}}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];t===Q.title?(this.contentTitle.value=D(this.contentTitle,i),this.contentTitle.setFocus(),this.associationsContent.title=this.contentTitle.value,this.blockNode.description=this.getAssociationsBlockCustomDescription(this.associationsContent.title)):(this.contentDescription.value=D(this.contentDescription,i),this.contentDescription.setFocus(),this.associationsContent.description=this.contentDescription.value),this.closePopupPopovers.emit(),this.internalPopupUpdated.emit()}get hostElement(){return(0,s.d)(this)}};G.style=".add-association-button{display:flex;justify-content:center;padding:var(--arcgis-app-cap-spacing-half) 0 0 0}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}.disable-spacing{--calcite-label-margin-bottom:0}";const K="list-warning-div",Z="list-warning-icon",Y="list-warning-label",X="list-warning-text",ee="form-input-button",te=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.attachmentSortByMap=new Map,this.formInput=(e,t,i,o,a)=>{var n;return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:ee},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i,value:o,placeholder:a,onCalciteInputInput:t=>{t.stopPropagation();const i=t.target.value;"title"===e?this.attachmentContent.title=i:this.attachmentContent.description=i,this.reRender=!this.reRender},onClick:()=>this.closePopupPopovers.emit()}),(null===(n=this.popupTemplate.fieldInfos)||void 0===n?void 0:n.length)>0&&(0,s.h)("calcite-action",{text:this.strings.attributes,onClick:()=>{this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},scale:"s",icon:"brackets-curly"})))},this.guid=void 0,this.attachmentContent=void 0,this.layerSupportsResizeAttachments=void 0,this.layerSupportsOrderingAttachments=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0}componentWillLoad(){this.strings=d.p.strings,this.view=d.p.mapView,this.layer=d.p.layer,this.popupTemplate=d.p.popupTemplate,this.setUpAttachmentSortByMap(),this.layerSupportsResizeAttachments?this.attachmentContent.displayType||(this.attachmentContent.displayType=_.auto,this.internalPopupUpdated.emit()):this.attachmentContent.displayType=_.list,this.attachmentContent.title||(this.attachmentContent.title=""),this.attachmentContent.description||(this.attachmentContent.description="")}componentDidLoad(){this.blockOpen&&(this.blockOptions.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),this.blockOptions.setFocus())}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList)}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}closePopupPopoversHandler(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.disablePopupPanel.emit(!1))}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];"title"===t?(this.contentTitle.value=D(this.contentTitle,i),this.contentTitle.setFocus(),this.attachmentContent.title=this.contentTitle.value):"description"===t&&(this.contentDescription.value=D(this.contentDescription,i),this.contentDescription.setFocus(),this.attachmentContent.description=this.contentDescription.value),this.closePopupPopovers.emit(),this.reRender=!this.reRender}setUpAttachmentSortByMap(){const{layer:e}=this;if(this.attachmentSortByMap.set("id","ATTACHMENTID"),this.attachmentSortByMap.set("contentType","CONTENT_TYPE"),this.attachmentSortByMap.set("name","ATT_NAME"),this.attachmentSortByMap.set("size","DATA_SIZE"),"fields"in e){e.fields.find((e=>"global-id"===e.type))&&this.attachmentSortByMap.set("globalId","AttachmentGlobalId")}}render(){const e=(0,s.h)("calcite-label",null,this.strings.displayAttachmentsAs,(0,s.h)("calcite-segmented-control",{width:"full",scale:"s",disabled:!this.layerSupportsResizeAttachments,onCalciteSegmentedControlChange:e=>{const t=e.target.selectedItem;this.attachmentContent.displayType=t.value,this.reRender=!this.reRender}},(0,s.h)("calcite-segmented-control-item",{value:_.auto,iconStart:"check",checked:this.attachmentContent.displayType===_.auto},this.strings.auto),(0,s.h)("calcite-segmented-control-item",{value:_.list,iconStart:"list",checked:this.attachmentContent.displayType===_.list},this.strings.list),(0,s.h)("calcite-segmented-control-item",{value:_.preview,iconStart:"image",checked:this.attachmentContent.displayType===_.preview},this.strings.gallery)),(0,s.h)("calcite-label",{scale:"s"},(()=>{switch(this.attachmentContent.displayType){case _.auto:return this.strings.autoDisplayMessage;case _.list:return this.strings.listDisplayMessage;case _.preview:return this.strings.previewDisplayMessage;default:return this.strings.listDisplayMessage}})())),t=(0,s.h)("div",{class:K},(0,s.h)("label",{class:Y},(0,s.h)("span",{class:Z},(0,s.h)("calcite-icon",{scale:"s",icon:"exclamation-mark-triangle"})),(0,s.h)("span",{class:X},this.strings.layerOnlySupportsListView)));return(0,s.h)(s.H,null,(0,s.h)("calcite-block",{dir:(0,c.g)(this.hostElement),heading:this.strings.attachments,description:this.attachmentContent.title&&`${this.attachmentContent.title.substring(0,25)}${this.attachmentContent.title.length>25?"...":""}`||(()=>{switch(this.attachmentContent.displayType){case _.auto:return this.strings.auto;case _.list:return this.strings.list;case _.preview:return this.strings.gallery;default:return this.strings.list}})(),collapsible:!0,open:this.blockOpen,dragHandle:!0},e,(0,s.h)("div",{class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,calciteBlockOptions:{hasDelete:!0}})),(0,s.h)("div",{slot:"icon"},(0,s.h)("calcite-icon",{scale:"m",icon:"attachment"})),(0,s.h)("div",{class:"ignore-elements-sortable"},this.formInput("title",this.strings.title,(e=>this.contentTitle=e),this.attachmentContent.title,this.strings.enterTitle),this.formInput("description",this.strings.desc,(e=>this.contentDescription=e),this.attachmentContent.description,this.strings.enterDescription),this.layerSupportsOrderingAttachments&&this.renderSortBy(),this.layerSupportsOrderingAttachments&&this.renderSortOrder(),this.layerSupportsResizeAttachments?null:t)))}renderSortBy(){var e,t;const{strings:i,attachmentSortByMap:o}=this,a=(0,n.i)(null===(e=this.attachmentContent.orderByFields)||void 0===e?void 0:e[0]),l=Array.from(o.entries()).map((([e,t])=>{const o=a?this.attachmentContent.orderByFields[0].field===t:"id"===e;return(0,s.h)("calcite-dropdown-item",{selected:o,onClick:()=>{a?this.attachmentContent.orderByFields[0].field=t:this.attachmentContent.orderByFields=[{field:t,order:"ascending"}],this.reRender=!this.reRender}},i[e])}));return(0,s.h)("calcite-label",null,i.sortBy,(0,s.h)("calcite-dropdown",{overlayPositioning:"fixed"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full"},a?i[null===(t=Array.from(o.entries()).find((([,e])=>this.attachmentContent.orderByFields[0].field===e)))||void 0===t?void 0:t[0]]:i.id),l))}renderSortOrder(){var e,t,i;const{strings:o}=this,a=(0,n.i)(null===(e=this.attachmentContent.orderByFields)||void 0===e?void 0:e[0]);return(0,s.h)("calcite-label",null,o.sortOrder,(0,s.h)("calcite-dropdown",{overlayPositioning:"fixed"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full"},a?o[this.attachmentContent.orderByFields[0].order]:o.ascending),(0,s.h)("calcite-dropdown-item",{selected:!a||"ascending"===this.attachmentContent.orderByFields[0].order,onClick:()=>{a?this.attachmentContent.orderByFields[0].order="ascending":this.attachmentContent.orderByFields=[{field:this.attachmentSortByMap.get("id"),order:"ascending"}],this.reRender=!this.reRender}},o.ascending),(0,s.h)("calcite-dropdown-item",{selected:"descending"===(null===(i=null===(t=this.attachmentContent.orderByFields)||void 0===t?void 0:t[0])||void 0===i?void 0:i.order),onClick:()=>{a?this.attachmentContent.orderByFields[0].order="descending":this.attachmentContent.orderByFields=[{field:this.attachmentSortByMap.get("id"),order:"descending"}],this.reRender=!this.reRender}},o.descending)))}get hostElement(){return(0,s.d)(this)}};te.style=".list-warning-div{background-color:var(--arcgis-app-background)}.list-warning-label{align-items:stretch;background-color:var(--arcgis-app-background);border-radius:var(--arcgis-app-border-radius);border:1px solid var(--arcgis-app-border);display:flex;font-size:var(--arcgis-app-font-size--2)}.list-warning-icon{align-items:center;background-color:var(--arcgis-app-background-content);display:flex;padding:0 var(--arcgis-app-side-spacing-half)}.list-warning-text{padding:var(--arcgis-app-cap-spacing-quarter) var(--arcgis-app-side-spacing-half)}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}";const ie="manage-btn",se="form-input-button",oe=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.pickList=[],this.arcadeExpMap=new Map,this.manageBtnClick=e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.popupFieldManagePickList||(this.popupFieldManagePickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldManagePickList.popoverProps={refElement:this.popupFlowItem},this.popupFieldManagePickList.selectedFields=this.getSelectedFields(),this.popupFieldManagePickList.showCancel=!1,this.popupFieldManagePickList.multiple=!0,this.popupFieldManagePickList.heading=this.strings.selectFields,this.popupFieldManagePickList.okBtnText=this.strings.done,this.popupFieldManagePickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldManagePickList.addEventListener("arcgisPopupPickListChange",this.popupFieldManagePickListChanges),document.body.appendChild(this.popupFieldManagePickList),this.disablePopupPanel.emit(!0))},this.popupFieldManagePickListChanges=e=>{var t;e.stopPropagation();const i=null===(t=e.detail)||void 0===t?void 0:t.selectedFields,s=[];this.setupFieldMapInfo(),i.forEach((e=>{var t;if(this.fieldInfoMap.has(e)){const i=null===(t=this.fieldInfoMap.get(e))||void 0===t?void 0:t.clone();i.visible=!0,s.push(i)}})),this.popupContent.fieldInfos=[...s],this.reRender=!this.reRender},this.calcitePickList=e=>(0,s.h)("calcite-list-item",{key:e.fieldName,label:(0,n.c)(e,this.arcadeExpMap),value:e.fieldName},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.strings.remove,onClick:()=>this.removeBtnClick(e.fieldName)},(0,s.h)("calcite-icon",{scale:"s",icon:"x"}))),this.formInput=(e,t,i,o,a)=>{var n;return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:se},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i,value:o,placeholder:a,onCalciteInputInput:t=>{t.stopPropagation();const i=t.target.value;"title"===e?this.popupContent.title=i:this.popupContent.description=i,this.reRender=!this.reRender},onClick:()=>this.closePopupPopovers.emit()}),(null===(n=this.popupTemplate.fieldInfos)||void 0===n?void 0:n.length)>0&&(0,s.h)("calcite-action",{text:this.strings.attributes,onClick:()=>{this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem,offsetSkidding:50},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},scale:"s",icon:"brackets-curly"})))},this.guid=void 0,this.popupContent=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0}async componentWillLoad(){this.layer=d.p.layer,this.strings=d.p.strings,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType,this.popupContent.fieldInfos||(this.popupContent.fieldInfos=await this.getFieldsContent()),this.popupContent.title||(this.popupContent.title=""),this.popupContent.description||(this.popupContent.description="")}componentDidLoad(){this.blockOpen&&(this.blockOptions.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),this.blockOptions.setFocus(),this.internalPopupUpdated.emit())}componentWillRender(){this.arcadeExpMap=(0,n.f)(this.popupTemplate),this.setupFieldMapInfo(),this.pickList=[],this.popupContent.fieldInfos.forEach((e=>{this.pickList.push(this.calcitePickList(e))}))}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){this.popupFieldManagePickList&&document.body.removeChild(this.popupFieldManagePickList),this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList)}arcadeChangeNotificationHandler(){this.reRender=!this.reRender}async attributesChangeNotificationHandler(){this.popupContent.fieldInfos.forEach(((e,t)=>{this.fieldInfoMap.has(e.fieldName)&&(this.popupContent.fieldInfos[t]=this.fieldInfoMap.get(e.fieldName).clone(),this.popupContent.fieldInfos[t].visible=!0)})),this.reRender=!this.reRender}closePopupPopoversHandler(){this.popupFieldManagePickList&&(document.body.removeChild(this.popupFieldManagePickList),this.popupFieldManagePickList=null,this.blockOptions.setFocus(),this.disablePopupPanel.emit(!1)),this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.disablePopupPanel.emit(!1))}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}async getFieldsContent(){var e,t;let i=[];if(this.checkForCreateFieldsContent()){const[s]=await(0,l.l)(["esri/support/popupUtils"]),o=null===(t=s.createFieldsContent({fields:await(0,n.k)(this.layer),objectIdField:this.layer.objectIdField,editFieldsInfo:(null===(e=this.layer)||void 0===e?void 0:e.editFieldsInfo)||null}))||void 0===t?void 0:t.fieldInfos;!this.fieldInfoMap&&this.setupFieldMapInfo(),o.forEach((e=>{if(this.fieldInfoMap.has(e.fieldName)){const t=this.fieldInfoMap.get(e.fieldName);i.push(t.clone()),i[i.length-1].visible=!0}})),this.popupTemplate.fieldInfos.forEach((e=>{(e.fieldName.includes(a.f.expression)||e.fieldName.includes(a.f.relationship))&&e.visible&&i.push(e.clone())}))}else this.popupTemplate.fieldInfos.forEach((e=>{e.visible&&i.push(e.clone())}));return i}checkForCreateFieldsContent(){var e,t,i;return this.layerDisplayType===a.l.feature&&("fields"!==(null===(t=null===(e=this.popupTemplate)||void 0===e?void 0:e.content[0])||void 0===t?void 0:t.type)||!!(null===(i=this.popupTemplate.content[0])||void 0===i?void 0:i.fieldInfos))}removeBtnClick(e){this.closePopupPopovers.emit(),this.popupContent.fieldInfos.find(((t,i)=>{if(t.fieldName===e)return this.popupContent.fieldInfos.splice(i,1)})),this.reRender=!this.reRender}getSelectedFields(){const e=[];return this.popupContent.fieldInfos.forEach((t=>{e.push(t.fieldName)})),e}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];"title"===t?(this.contentTitle.value=D(this.contentTitle,i),this.contentTitle.setFocus(),this.popupContent.title=this.contentTitle.value):"description"===t&&(this.contentDescription.value=D(this.contentDescription,i),this.contentDescription.setFocus(),this.popupContent.description=this.contentDescription.value),this.closePopupPopovers.emit(),this.reRender=!this.reRender}setupFieldMapInfo(){this.fieldInfoMap=new Map(this.popupTemplate.fieldInfos.map((e=>[e.fieldName,e])))}render(){return(0,s.h)(s.H,{key:"ffac5e06d28dd37d6158d669c5b9f76ead206aa0"},(0,s.h)("calcite-block",{key:"8d8a31d7bf77b3f2bfd9cd8e1dad140d2c277ab9",dir:(0,c.g)(this.hostElement),heading:this.strings.fieldsList,description:this.popupContent.title&&`${this.popupContent.title.substring(0,25)}${this.popupContent.title.length>25?"...":""}`||`${this.popupContent.fieldInfos.length}/${this.popupTemplate.fieldInfos.length} ${this.strings.attributes_L}`,collapsible:!0,open:this.blockOpen,dragHandle:!0},(0,s.h)("div",{key:"9cc37ac4c19d5eb5ae3ebec5d3bae78444a0ef22",class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{key:"a279be407efebf43984b19d935761d8d4fd1cc32",ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:!0}})),(0,s.h)("div",{key:"073502c02782d8c2d025d50ef00d6f0ffafeeed7",slot:"icon"},(0,s.h)("calcite-icon",{key:"41800598a6ad1fa7fa925b940b341a5f3211e347",scale:"m",icon:"feature-details"})),(0,s.h)("div",{key:"6692adc1207d3ca85075c4ce7d86fa68a72690d6",class:"ignore-elements-sortable"},this.formInput("title",this.strings.title,(e=>this.contentTitle=e),this.popupContent.title,this.strings.enterTitle),this.formInput("description",this.strings.desc,(e=>this.contentDescription=e),this.popupContent.description,this.strings.enterDescription),(0,s.h)("calcite-button",{key:"bcd35f4ef0c9a0a8cfabc9abc71e26f6caaccd0d",class:ie,appearance:"transparent",scale:"m",width:"full",id:"openManageAttributes_Id",onClick:this.manageBtnClick},this.strings.selectAttributes),(0,s.h)("calcite-list",{key:"684e6bedc64dd75ff613789b2153b9761bc13dea",label:this.strings.attributes,"drag-enabled":!0,onCalciteListOrderChange:e=>{const t=e.target,i=[];t.childNodes.forEach((e=>{this.popupContent.fieldInfos.find((t=>{if(t.fieldName===e.value)return i.push(t)}))})),this.popupContent.fieldInfos=i,this.internalPopupUpdated.emit()}},this.pickList))))}get hostElement(){return(0,s.d)(this)}};oe.style=".manage-btn{justify-content:flex-end;margin:4px 0}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}";const ae="manage-btn",ne="normalize-content-btn-section",le="normalize-content-btn",re="normalize-content-btn-text",pe="normalize-content-btn-icon",ce="popover-chart-div",de="form-input-button",he="chart-group",ue=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.chartChangedReRender=(0,s.c)(this,"chartChangedReRender",7),this.notifyMultiMediaChange=(0,s.c)(this,"notifyMultiMediaChange",7),this.lastColors={},this.pickList=[],this.arcadeExpMap=new Map,this.colorNodes=[],this.popupFieldManagePickListChanges=e=>{var t,i,o,a,n,l,r,p,c,d;const{esriLang:h,esriColor:u,rendererColors:m}=this;e.stopPropagation();const f=this.chartMediaInfo.value.fields,g=e.detail.selectedFields;if(this.chartMediaInfo.value.fields=g,this.chartMediaInfo.type===$.lineChart){if((null===(t=this.chartMediaInfo.value.fields)||void 0===t?void 0:t.length)&&!(null===(i=this.chartMediaInfo.value.colors)||void 0===i?void 0:i.length)){const e=this.getDefaultColorScheme();this.colors=[e.colors[0]],this.chartMediaInfo.value.colors=h.clone(this.colors),(0,s.f)(this.hostElement)}else!(null===(o=this.chartMediaInfo.value.fields)||void 0===o?void 0:o.length)&&(null===(a=this.chartMediaInfo.value.colors)||void 0===a?void 0:a.length)&&(this.colors=void 0,this.chartMediaInfo.value.colors=void 0,(0,s.f)(this.hostElement));if(null===(n=this.lastColors.rampColors)||void 0===n?void 0:n.length){const e=this.getDefaultColorScheme();this.lastColors.rampColors=null===(l=this.chartMediaInfo)||void 0===l?void 0:l.value.fields.map(((t,i)=>{var s;const o=f.indexOf(t);return o>-1&&(null===(s=this.lastColors.rampColors)||void 0===s?void 0:s[o])||new u(e.colors[i%10])||new u([0,0,0,1])}))}}else if(null===(r=this.chartMediaInfo.value.fields)||void 0===r?void 0:r.length){const e=this.getDefaultColorScheme();this.colors=null===(p=this.chartMediaInfo)||void 0===p?void 0:p.value.fields.map(((t,i)=>{var s,o,a;const n=f.indexOf(t);return n>-1&&(null===(s=this.colors)||void 0===s?void 0:s[n])||((null===(o=null==m?void 0:m.get(t))||void 0===o?void 0:o[0])?h.clone(m.get(t)[0]):null!==(a=new u(e.colors[i%10]))&&void 0!==a?a:new u([0,0,0,1]))})),(null===(c=this.chartMediaInfo.value.colors)||void 0===c?void 0:c.length)?this.chartMediaInfo.value.colors=h.clone(this.colors):(this.colors=[],this.setColors(),(0,s.f)(this.hostElement)),(null==f?void 0:f.length)?this.colorButtonNode&&(0,s.f)(this.colorButtonNode):(0,s.f)(this.hostElement)}else this.colors=void 0,this.chartMediaInfo.value.colors=void 0,(0,s.f)(this.hostElement);this.chartChangedReRender.emit(),(null==f?void 0:f.length)&&(null===(d=this.chartMediaInfo.value.fields)||void 0===d?void 0:d.length)||(0,s.f)(this.hostElement)},this.fieldPickListChanges=e=>{var t,i;e.stopPropagation();const s=null===(i=null===(t=e.detail)||void 0===t?void 0:t.selectedFields)||void 0===i?void 0:i[0];s&&(this.chartMediaInfo.value.normalizeField=s,this.chartChangedReRender.emit()),this.removeAttributesSelectionPopover(),this.normalizeBtn.focus()},this.popupFieldSelectionPickListChanges=(e,t)=>{const i=e.detail.selectedFields[0];"title"===t?(this.editChartTitle.value=D(this.editChartTitle,i),this.chartMediaInfo.title=this.editChartTitle.value,this.editChartTitle.setFocus()):"caption"===t?(this.editChartCaption.value=D(this.editChartCaption,i),this.chartMediaInfo.caption=this.editChartCaption.value,this.editChartCaption.setFocus()):"altText"===t&&(this.editAltText.value=D(this.editAltText,i),this.chartMediaInfo.altText=this.editAltText.value,this.editAltText.setFocus()),this.removeAttributesSelectionPopover(),this.chartChangedReRender.emit()},this.chartFormInput=e=>{var t;const{strings:i}=this;return(0,s.h)("calcite-label",{scale:"s"},"title"===e?i.title:"caption"===e?i.caption:"altText"===e?i.description:void 0,(0,s.h)("div",{class:de},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:t=>"title"===e?this.editChartTitle=t:"caption"===e?this.editChartCaption=t:"altText"===e?this.editAltText=t:void 0,value:(()=>"title"===e?this.chartMediaInfo.title:"caption"===e?this.chartMediaInfo.caption:"altText"===e?this.chartMediaInfo.altText:void 0)(),placeholder:"title"===e?i.imageTitlePlaceHolder:"caption"===e?i.imageCaptionPlaceHolder:"altText"===e?i.describeChart:void 0,onCalciteInputInput:(0,h.d)((e=>{e.preventDefault(),e.stopPropagation(),this.changeChartProperties()}),300)}),(null===(t=this.popupTemplate.fieldInfos)||void 0===t?void 0:t.length)>0&&(0,s.h)("calcite-action",{text:i.attributes,"text-display":"hidden",onClick:()=>{var t;this.removeAttributesSelectionPopover(),null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.panelElement},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=i.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>this.removeAttributesSelectionPopover())),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.panelElement.disabled=!0)},scale:"s",icon:"brackets-curly"})))},this.calcitePickList=(e,t)=>(0,s.h)("calcite-list-item",{key:e.fieldName,label:(0,n.c)(e,this.arcadeExpMap),value:e.fieldName},this.renderColorIcon(t),(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.strings.remove,onClick:()=>{var t,i,o;this.removeAttributesSelectionPopover(),null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),(null===(i=this.chartMediaInfo.value.colors)||void 0===i?void 0:i.length)?this.chartMediaInfo.value.fields.forEach(((t,i)=>{var o;t===e.fieldName&&(this.chartMediaInfo.value.fields.splice(i,1),this.chartMediaInfo.type!==$.lineChart&&(this.chartMediaInfo.value.colors.splice(i,1),this.colors.splice(i,1),this.colorButtonNode&&(0,s.f)(this.colorButtonNode)),(null===(o=this.lastColors.rampColors)||void 0===o?void 0:o.length)&&this.lastColors.rampColors.splice(i,1))})):(this.chartMediaInfo.value.fields.forEach(((t,i)=>{t===e.fieldName&&this.chartMediaInfo.value.fields.splice(i,1)})),this.colors=[],this.setColors(),(0,s.f)(this.hostElement)),this.chartChangedReRender.emit(),(null===(o=this.chartMediaInfo.value.fields)||void 0===o?void 0:o.length)||(0,s.f)(this.hostElement)}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"}))),this.guid=void 0,this.chartMediaInfo=void 0,this.mediaContent=void 0,this.mediaIndexPosition=void 0,this.refElement=void 0,this.isOpen=!1,this.reRender=void 0}async componentWillLoad(){var e;this.layer=d.p.layer,this.mapView=d.p.mapView,this.strings=d.p.strings,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType,this.chartMediaInfo.title=this.chartMediaInfo.title||"",this.chartMediaInfo.altText=this.chartMediaInfo.altText||"",this.chartMediaInfo.caption=this.chartMediaInfo.caption||"";const[t,i,s,o]=await(0,l.l)(["esri/core/lang","esri/Color","esri/smartMapping/symbology/pieChart","esri/renderers/support/utils"]);if(this.esriLang=t,this.esriColor=i,this.pieChartSchemes=s,this.rendererUtils=o,"renderer"in this.layer){let e;e=this.layerDisplayType===a.l.cluster?this.layer.featureReduction.renderer:this.layer.renderer,["class-breaks","dot-density","heatmap","pie-chart","simple","unique-value"].indexOf(null==e?void 0:e.type)>-1&&(this.rendererColors=await this.rendererUtils.getColorsFromRenderer(e))}this.colors=t.clone(null===(e=this.chartMediaInfo)||void 0===e?void 0:e.value.colors)||[],this.setColors()}componentDidLoad(){this.isOpen=!0,setTimeout((()=>requestAnimationFrame((()=>this.panelElement.setFocus()))),300)}async componentWillRender(){this.fieldInfoMap=new Map(this.popupTemplate.fieldInfos.map((e=>[e.fieldName,e]))),this.layerFieldsMap=await(0,n.e)(this.layer),this.arcadeExpMap=(0,n.f)(this.popupTemplate),this.pickList=[],this.chartMediaInfo.value.fields.forEach(((e,t)=>{var i,s;if(this.fieldInfoMap.has(e)){const i=this.fieldInfoMap.get(e);this.pickList.push(this.calcitePickList(i,t))}else if(this.chartMediaInfo.value.fields.splice(t,1),this.chartMediaInfo.type!==$.lineChart)if(null===(i=this.chartMediaInfo.value.colors)||void 0===i?void 0:i.length)this.chartMediaInfo.value.colors.splice(t,1),this.colors.splice(t,1);else{const e=this.getDefaultColorScheme();this.colors=null===(s=this.chartMediaInfo)||void 0===s?void 0:s.value.fields.map(((t,i)=>{var s,o;return(null===(s=this.rendererColors)||void 0===s?void 0:s.get(t))?this.esriLang.clone(this.rendererColors.get(t)[0]):(null===(o=this.colors)||void 0===o?void 0:o[i])||new this.esriColor(e.colors[i%10])||new this.esriColor([0,0,0,1])}))}}))}componentDidUpdate(){this.notifyMultiMediaChange.emit({guid:this.guid,mediaIndexPosition:this.mediaIndexPosition}),this.chartPopover.reposition()}disconnectedCallback(){var e;this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldManagePickList&&document.body.removeChild(this.popupFieldManagePickList),this.arcgisFieldPickList&&document.body.removeChild(this.arcgisFieldPickList),null===(e=this.colorButtonNode)||void 0===e||e.closePopover()}async reposition(){this.chartPopover.reposition()}chartChangedReRenderHandler(e){e.stopPropagation(),this.reRender=!this.reRender}closePopupPopoversHandler(){this.removeAttributesSelectionPopover()}closeMultiMediaPopoverHandler(){this.removeAttributesSelectionPopover()}arcadeChangeNotificationHandler(){this.chartChangedReRender.emit()}removeAttributesSelectionPopover(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null),this.popupFieldManagePickList&&(document.body.removeChild(this.popupFieldManagePickList),this.popupFieldManagePickList=null),this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=null),this.colorPopoverNode&&(document.body.removeChild(this.colorPopoverNode),this.colorPopoverNode=null),this.panelElement.disabled=!1}async chartSelection(e){const[t,i,s,o]=await(0,l.l)(["esri/popup/content/BarChartMediaInfo","esri/popup/content/ColumnChartMediaInfo","esri/popup/content/LineChartMediaInfo","esri/popup/content/PieChartMediaInfo"]);let a=null;e===$.barChart&&(a=new t({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),e===$.columnChart&&(a=new i({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),e===$.lineChart&&(a=new s({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),e===$.pieChart&&(a=new o({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),this.chartMediaInfo=a.clone(),this.mediaContent.mediaInfos[this.mediaIndexPosition]=this.chartMediaInfo,this.chartChangedReRender.emit()}getSummaryString(){const{strings:e}=this;return this.chartMediaInfo.type===$.barChart?e.bar:this.chartMediaInfo.type===$.columnChart?e.column:this.chartMediaInfo.type===$.lineChart?e.line:this.chartMediaInfo.type===$.pieChart?e.pie:void 0}changeChartProperties(){this.chartMediaInfo.title=this.editChartTitle.value,this.chartMediaInfo.caption=this.editChartCaption.value,this.chartMediaInfo.altText=this.editAltText.value,(0,s.f)(this.hostElement)}render(){var e,t;const i=!!(null===(e=this.chartMediaInfo.value.fields)||void 0===e?void 0:e.length),o=(0,s.h)("calcite-segmented-control",{key:"4cdec4c6f151360abfc2fc91cb65adae8132e4d4",width:"full",scale:"s",class:he,onCalciteSegmentedControlChange:async e=>{var t;null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover();const i=e.target.selectedItem;if(this.chartMediaInfo.type===$.lineChart&&i.value!==$.lineChart||this.chartMediaInfo.type!==$.lineChart&&i.value===$.lineChart){const e=this.chartMediaInfo.value.colors;this.chartMediaInfo.type===$.lineChart?(this.lastColors.lineColors=e&&this.esriLang.clone(e),this.colors=void 0,this.chartMediaInfo.value.colors=void 0):(this.lastColors.rampColors=e&&this.esriLang.clone(e),i.value===$.lineChart&&(this.colors=void 0,this.chartMediaInfo.value.colors=void 0))}i.value!==this.chartMediaInfo.type&&(i.value!==$.columnChart||this.chartMediaInfo.type!==$.barChart)&&await this.chartSelection(i.value),this.setColors()}},(0,s.h)("calcite-segmented-control-item",{key:"cf4b468808ec0d8c3cae8cbf446a088102850883",value:$.columnChart,iconStart:"graph-bar",checked:this.chartMediaInfo.type===$.columnChart||this.chartMediaInfo.type===$.barChart},this.strings.bar),(0,s.h)("calcite-segmented-control-item",{key:"54a87473ba8fc54940b16915cbafb202a07dab11",value:$.lineChart,iconStart:"graph-time-series",checked:this.chartMediaInfo.type===$.lineChart},this.strings.line),(0,s.h)("calcite-segmented-control-item",{key:"8840f0d8633a07af7a198000368b9d306b833c3a",value:$.pieChart,iconStart:"pie-chart",checked:this.chartMediaInfo.type===$.pieChart},this.strings.pie)),a=(0,s.h)("arcgis-popup-color-button",{key:"8b9135f0a09f0b0b1ca85df7cc28e55b8e9f188b",chartMediaInfo:this.chartMediaInfo,colors:this.colors,popoverReferenceElement:this.panelElement,onArcgisPopupColorButtonChange:(0,h.d)((({detail:e})=>{this.colors=e,this.chartMediaInfo.value.colors=this.esriLang.clone(e),(0,s.f)(this.hostElement)}),300),onArcgisPopupColorButtonBeforeOpen:()=>this.closeColorPopover(),ref:e=>this.colorButtonNode=e}),l=(0,s.h)("calcite-label",{key:"aad8bb61044980a0cb8e33cd2f8eb9a8fd1e228e",layout:"inline-space-between"},this.strings.resetColors,(0,s.h)("calcite-action",{key:"49572e140d7e0a96764cb5c37641ed74cd19fdb4",appearance:"transparent",text:this.strings.resetColors,disabled:!(null===(t=this.chartMediaInfo.value.colors)||void 0===t?void 0:t.length),onClick:()=>{var e;null===(e=this.colorButtonNode)||void 0===e||e.closePopover(),this.closeColorPopover(),this.chartMediaInfo.value.colors=null,this.colors=[],this.chartMediaInfo.type===$.lineChart?this.lastColors.lineColors=void 0:this.lastColors.rampColors=void 0,this.setColors(),(0,s.f)(this.hostElement)}},(0,s.h)("calcite-icon",{key:"342b0ec93a754ffd6087ba1cfbc82ca1d6b556ea",scale:"s",icon:"reset"}))),r=(0,s.h)("div",{key:"2223185a1cf9268c3d5e5e6127a1bbc7afbb482d"},(0,s.h)("calcite-button",{key:"3a1d9dbed9f2bba2d33b90f9bf8d8e5e2995e1f5",class:ae,appearance:"transparent",scale:"m",width:"full",onClick:async e=>{var t,i,s;e.stopPropagation(),this.removeAttributesSelectionPopover(),null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),this.popupFieldManagePickList||(this.popupFieldManagePickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldManagePickList.popoverProps={refElement:this.panelElement},this.popupFieldManagePickList.selectedFields=(null===(s=null===(i=this.chartMediaInfo)||void 0===i?void 0:i.value)||void 0===s?void 0:s.fields)||[],this.popupFieldManagePickList.showCancel=!1,this.popupFieldManagePickList.multiple=!0,this.popupFieldManagePickList.heading=this.strings.selectFields,this.popupFieldManagePickList.okBtnText=this.strings.done,this.popupFieldManagePickList.numbersOnly=!0,this.popupFieldManagePickList.addEventListener("arcgisPopupPickListDismissed",(()=>this.removeAttributesSelectionPopover())),this.popupFieldManagePickList.addEventListener("arcgisPopupPickListChange",this.popupFieldManagePickListChanges),document.body.appendChild(this.popupFieldManagePickList),this.panelElement.disabled=!0)}},this.strings.selectAttributes),(0,s.h)("calcite-list",{key:"1c815ff37fee460498a19b4c5734d33a0044f2c4",label:this.strings.attributes,"drag-enabled":!0,onCalciteListOrderChange:async e=>{var t,i;e.stopPropagation();const s=e.target.querySelectorAll("calcite-list-item"),o=[];if(s.forEach((e=>{this.chartMediaInfo.value.fields.forEach(((t,i)=>{e.value===t&&o.push(i)}))})),this.chartMediaInfo.type===$.lineChart)this.chartMediaInfo.value.fields=Array.from(s).map((e=>e.value));else{(null===(t=this.chartMediaInfo.value.colors)||void 0===t?void 0:t.length)||(this.chartMediaInfo.value.colors=this.esriLang.clone(this.colors));const e=[],i=[];o.forEach((t=>{e.push(this.chartMediaInfo.value.fields[t]),i.push(this.esriLang.clone(this.chartMediaInfo.value.colors[t]))})),this.chartMediaInfo.value.fields=e,this.colors=i,this.chartMediaInfo.value.colors=this.esriLang.clone(i)}if(null===(i=this.lastColors.rampColors)||void 0===i?void 0:i.length){const e=[];o.forEach((t=>{e.push(this.lastColors.rampColors[t])})),this.lastColors.rampColors=e}this.chartChangedReRender.emit()}},this.pickList)),p=(this.chartMediaInfo.type===$.barChart||this.chartMediaInfo.type===$.columnChart)&&(0,s.h)("calcite-label",{key:"a620f177f14a99ee421513a35b6beede1856436b",class:"enable-column",layout:"inline-space-between"},this.strings.horizontalOrientation,(0,s.h)("calcite-switch",{key:"ee466face7e6525efe012f70243f1aef61636ca8",scale:"s",checked:this.chartMediaInfo.type===$.barChart,onCalciteSwitchChange:(0,h.d)((async()=>{await this.chartSelection(this.orientationSwitchNode.checked?$.barChart:$.columnChart)}),300),ref:e=>this.orientationSwitchNode=e})),d=(0,s.h)("calcite-block-section",{key:"4f0d9bedbc1e42a8d6baef6d29511fa8c4d73084",text:this.strings.normalize,toggleDisplay:"switch",open:!!this.chartMediaInfo.value.normalizeField,onCalciteBlockSectionToggle:(0,h.d)((()=>{this.normalizeBlockSectionNode.open?this.chartMediaInfo.value.normalizeField=this.tempNormalizedField:(this.tempNormalizedField=this.chartMediaInfo.value.normalizeField,this.chartMediaInfo.value.normalizeField=""),(0,s.f)(this.hostElement)}),300),ref:e=>this.normalizeBlockSectionNode=e},(0,s.h)("div",{key:"e0deee3d540adb1836036cd7f40b7048f6a405ef",class:ne},(0,s.h)("button",{key:"5703129808e9030408256466129bdd51a8113560",ref:e=>this.normalizeBtn=e,class:le,title:this.strings.normalizeBy,onClick:e=>{var t;e.stopPropagation(),this.removeAttributesSelectionPopover(),null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),this.arcgisFieldPickList||(this.arcgisFieldPickList=document.createElement("arcgis-popup-field-pick-list"),this.arcgisFieldPickList.popoverProps={refElement:this.panelElement},this.arcgisFieldPickList.selectedFields=this.chartMediaInfo.value.normalizeField?[this.chartMediaInfo.value.normalizeField]:[],this.arcgisFieldPickList.numbersOnly=!0,this.arcgisFieldPickList.addEventListener("arcgisPopupPickListDismissed",this.fieldPickListChanges),document.body.appendChild(this.arcgisFieldPickList),this.panelElement.disabled=!0)}},(0,s.h)("span",{key:"f5f24668e886f579becb6ea8095a53ab02d69247",class:re},this.fieldInfoMap.has(this.chartMediaInfo.value.normalizeField)?(0,n.c)(this.fieldInfoMap.get(this.chartMediaInfo.value.normalizeField),this.arcadeExpMap):this.strings.normalizeBy),(0,s.h)("span",{key:"42241ba5f09512237715eaa2f48739799c7935d3",class:pe},(0,s.h)("calcite-icon",{key:"0faf42d97cce63968c1ccad2feca701fcea13e76",scale:"s",icon:"pencil"}))))),u=(0,s.h)("calcite-button",{key:"d5a85879c613b65876097f5f41126fb3e2595b98",appearance:"outline-fill",scale:"m",slot:"footer",width:"full",onClick:()=>this.closePopupPopovers.emit()},this.strings.done);return(0,s.h)(s.H,{key:"10c83147a9bd1639f0a2be8cd1c0588040f78ca5",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"c0b5dd6554756ea486dd2af377ca4ce44084b8b8",dir:(0,c.g)(this.hostElement),class:"popover",ref:e=>this.chartPopover=e,placement:"leading-start",open:this.isOpen,pointerDisabled:!0,referenceElement:this.refElement,offsetDistance:-Math.round(this.refElement.getBoundingClientRect().width),offsetSkidding:50,label:this.strings.configureChart,triggerDisabled:!0},(0,s.h)("calcite-panel",{key:"0378243975e4ad605c3ae6edc1572e9cd2cec9f8",ref:e=>this.panelElement=e,closable:!0,style:{width:`${this.refElement.getBoundingClientRect().width}px`},onCalcitePanelClose:()=>this.closePopupPopovers.emit()},(0,s.h)("div",{key:"19695fd439defa27097ef7ec8b93a1c7b61ca4e3",slot:"header-content"},this.strings.configureChart),u,(0,s.h)("div",{key:"e73f02a954d667253ce154e7257bc0a485572e6b",class:ce},o,this.chartFormInput("title"),this.chartFormInput("caption"),this.chartFormInput("altText"),i&&a,i&&l,r,p,d))))}renderColorIcon(e){const{strings:t,selectedFieldIdx:i,colors:o}=this;if(this.chartMediaInfo.type!==$.lineChart)return(0,s.h)("div",{class:"color-icon",style:{backgroundColor:o[e].toHex()},slot:"content-start",onClick:()=>this.openColorPicker(e),role:"button",tabIndex:0,"aria-label":t.changeColor,"aria-haspopup":"true","aria-expanded":i===e,onKeyUp:t=>{" "!==t.key&&"Enter"!==t.key||this.openColorPicker(e)},ref:t=>{this.colorNodes[e]=t}})}openColorPicker(e){var t;const{colors:i,strings:o,esriColor:a}=this;null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),this.selectedFieldIdx=e;const n=document.createElement("arcgis-popup-color-popover");n.heading=o.selectColor,n.intlDone=o.done,n.label=o.selectColor,n.hexColor=i[e].toHex(),n.popoverProps={placement:"leading-start",offsetDistance:1,offsetSkidding:52,pointerDisabled:"true",popoverWidth:315,refElement:this.panelElement},n.addEventListener("arcgisPopupColorPopoverClose",(()=>{this.selectedFieldIdx=void 0,this.colorPopoverNode=null})),n.addEventListener("arcgisPopupColorPopoverChange",(({detail:t})=>{i[e]=new a(t),this.chartMediaInfo.value.colors=this.esriLang.clone(i),this.chartChangedReRender.emit(),(0,s.f)(this.colorButtonNode)})),document.body.appendChild(n),n.setOpen(!0),this.colorPopoverNode=n}setColors(){var e,t,i,s,o,a;const{esriColor:n,lastColors:l,rendererColors:r}=this;if(this.chartMediaInfo.type===$.lineChart)if(!(null===(e=this.colors)||void 0===e?void 0:e.length)&&l.lineColors&&(this.colors=l.lineColors,this.chartMediaInfo.value.colors=this.esriLang.clone(this.colors)),null===(t=this.colors)||void 0===t?void 0:t.length)this.colors.length>1&&(this.colors=[this.colors[0]]);else{const e=this.getDefaultColorScheme();this.colors=[e.colors[0]]}else if(!(null===(i=this.colors)||void 0===i?void 0:i.length)&&l.rampColors&&(this.colors=this.esriLang.clone(l.rampColors),this.chartMediaInfo.value.colors=this.esriLang.clone(this.colors)),!(null===(s=this.colors)||void 0===s?void 0:s.length)||this.colors.length!==(null===(o=this.chartMediaInfo)||void 0===o?void 0:o.value.fields.length)){const e=this.getDefaultColorScheme();this.colors=null===(a=this.chartMediaInfo)||void 0===a?void 0:a.value.fields.map(((t,i)=>{var s,o,a,l;return(null===(s=null==r?void 0:r.get(t))||void 0===s?void 0:s[0])?this.esriLang.clone(r.get(t)[0]):null!==(l=null!==(a=null===(o=this.colors)||void 0===o?void 0:o[i])&&void 0!==a?a:new n(e.colors[i%10]))&&void 0!==l?l:new n([0,0,0,1])}))}}getDefaultColorScheme(){const e=this.pieChartSchemes.getSchemes({basemap:this.mapView.map.basemap,geometryType:"polygon",numColors:Math.min(10,this.chartMediaInfo.value.fields.length)});return[e.primaryScheme].concat(e.secondarySchemes).find((e=>"Olympic Sunset"===e.name))||e.primaryScheme}closeColorPopover(){this.colorPopoverNode&&(document.body.removeChild(this.colorPopoverNode),this.colorPopoverNode=null)}get hostElement(){return(0,s.d)(this)}};ue.style=".popover{--calcite-popover-z-index:100}.manage-btn{justify-content:flex-end}.enable-column{padding-top:var(--calcite-spacing-sm)}.enable-column-label{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.column-switch{margin:0;flex:0 0 0%;justify-self:flex-end}.normalize-content-btn-section{background-color:var(--arcgis-app-background);min-width:100%}.normalize-content-btn{background:var(--arcgis-app-background-clear);border:1px solid var(--arcgis-app-border);border-radius:var(--arcgis-app-border-radius);display:flex;align-items:center;justify-content:space-between;padding:var(--arcgis-app-cap-spacing-half) var(--arcgis-app-side-spacing-quarter);cursor:pointer;width:100%;text-align:unset;transition:background-color var(--arcgis-app-animation-time-fast) var(--arcgis-app-easing-function), border-color var(--arcgis-app-animation-time-fast) var(--arcgis-app-easing-function)}.normalize-content-btn:hover{background-color:var(--arcgis-app-background-hover);border-color:var(--arcgis-app-border-hover)}.normalize-content-btn-text{font-family:var(--arcgis-app-font-family);font-size:var(--arcgis-app-font-size-0);flex:0 1 auto;overflow:hidden;padding:0 var(--arcgis-app-side-spacing-eighth);text-overflow:ellipsis;white-space:nowrap}.normalize-content-btn-icon{flex:0 0 0%;padding:0 var(--arcgis-app-side-spacing-half)}.popover-chart-div{background-color:var(--arcgis-app-background);padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-side-spacing-half);max-height:60vh}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}.chart-group{margin-bottom:var(--arcgis-app-cap-spacing-half)}.color-icon{width:18px;height:18px;border-radius:90%}";const me=class{constructor(e){(0,s.r)(this,e),this.arcadeChangeNotification=(0,s.c)(this,"arcadeChangeNotification",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.valueList=[],this.filterLength=5,this.calciteValueList=e=>(0,s.h)("calcite-list-item",{disabled:d.p.blockFeatureReductionArcade,label:e.title,description:`{${a.f.expression}${e.name}}`,value:e.name,metadata:{title:e.title,name:`{${a.f.expression}${e.name}}`},onClick:t=>this.launchArcade(t,e)},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.strings.remove,onClick:t=>this.removeBtnClick(t,e.name)},(0,s.h)("calcite-icon",{scale:"s",icon:"x"}))),this.reRender=void 0}componentWillLoad(){this.layer=d.p.layer,this.mapView=d.p.mapView,this.portal=d.p.portal,this.config=d.p.config,this.strings=d.p.strings,this.currentLanguage=d.p.currentLanguage,this.serviceType=d.p.serviceType,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType}async componentDidLoad(){await this.loadAllModules()}componentWillRender(){var e;this.valueList=[],(null===(e=this.popupTemplate.expressionInfos)||void 0===e?void 0:e.length)&&this.popupTemplate.expressionInfos.forEach((e=>{this.valueList.push(this.calciteValueList(e))}))}async setFocus(){this.expressionPanelItem.setFocus()}async loadAllModules(){[this.FieldInfo,this.PopupExpressionInfo]=await(0,l.l)(["esri/popup/FieldInfo","esri/popup/ExpressionInfo"])}async launchArcade(e,t){e.stopPropagation(),this.arcadeEditor||(this.expressionPanelItem.disabled=!0,this.arcadeEditor=document.createElement("arcgis-modal-arcade"),this.arcadeEditor.arcadeScript=P(null==t?void 0:t.expression,this.layerDisplayType,this.strings),this.arcadeEditor.arcadeProfile=await C(this.layer,this.mapView,this.serviceType,this.popupTemplate,this.layerDisplayType),this.arcadeEditor.testData=await k(this.layer,this.mapView,this.layerDisplayType,this.popupTemplate),this.arcadeEditor.suggestions=I(this.layer,this.strings,"attributeExpression"),this.arcadeEditor.addExistingExpressions=!0,this.arcadeEditor.layer=this.layer,this.arcadeEditor.arcadeTitle=(null==t?void 0:t.title)||this.strings.arcadeDefaultTitle,this.arcadeEditor.arcadeTitleEditable=!0,this.arcadeEditor.arcadeTitleEditingEnabled=!(null==t?void 0:t.title),document.body.appendChild(this.arcadeEditor),this.arcadeEditor.addEventListener("arcgisModalArcadeClose",(e=>{this.arcadeSetup(e.detail,t),setTimeout((()=>this.fabButtonNode.setFocus()),300)})))}async arcadeSetup(e,t){e&&(S(e,null==t?void 0:t.name,this.PopupExpressionInfo,this.popupTemplate),await this.popupExpressionSetup()),this.expressionPanelItem.disabled=!1,document.body.removeChild(this.arcadeEditor),this.arcadeEditor=null}async popupExpressionSetup(){await R(this.popupTemplate,this.layerDisplayType,this.layer,this.FieldInfo),this.arcadeChangeNotification.emit(),this.internalPopupUpdated.emit(),this.reRender=!this.reRender}removeBtnClick(e,t){e.stopPropagation();const i=this.popupTemplate.expressionInfos.find((e=>e.name===t));if(i){this.popupTemplate.expressionInfos.splice(this.popupTemplate.expressionInfos.indexOf(i),1);this.popupTemplate.content.filter((e=>"fields"===e.type)).forEach((e=>{const i=e.fieldInfos.find((e=>e.fieldName===`${a.f.expression}${t}`));i&&e.fieldInfos.splice(e.fieldInfos.indexOf(i),1)}))}this.popupExpressionSetup()}render(){var e;const t=(0,s.h)("calcite-fab",{key:"6cbd71600d893bbd317eb2661a9aa15281f29e38",disabled:d.p.blockFeatureReductionArcade,slot:"fab",class:"fab",icon:"plus",scale:"s",appearance:"outline-fill",kind:"neutral",label:this.strings.addExpression,text:this.strings.addExpression,"text-enabled":!0,onClick:e=>this.launchArcade(e),ref:e=>this.fabButtonNode=e});return(0,s.h)(s.H,{key:"dc0757d6607b6e5e57ddef246b8501aebe773c3d",class:"calcite-match-height"},(0,s.h)("calcite-panel",{key:"137843e607ce167df727f51398c622e155a7677e",dir:(0,c.g)(this.hostElement),ref:e=>this.expressionPanelItem=e},(null===(e=this.popupTemplate.expressionInfos)||void 0===e?void 0:e.length)>0&&(0,s.h)("calcite-list",{key:"a613c229f4aef088126af3bda9c0109f5b95a7ba",label:this.strings.manageExpressions,filterEnabled:this.valueList.length>=this.filterLength},this.valueList),t))}get hostElement(){return(0,s.d)(this)}},fe=class{constructor(e){(0,s.r)(this,e),this.arcgisPopupPickListDismissed=(0,s.c)(this,"arcgisPopupPickListDismissed",7),this.arcgisPopupPickListChange=(0,s.c)(this,"arcgisPopupPickListChange",7),this.arcadeChangeNotification=(0,s.c)(this,"arcadeChangeNotification",7),this.arcadeExpMap=new Map,this.calciteFieldOnlyValueList=e=>(0,s.h)("calcite-list-item",{key:e.name,label:e.alias||e.name,value:e.name,description:`{${e.name}}`,selected:!this.multiple&&e.name===this.selectedFields[0]||this.multiple&&this.selectedFields.indexOf(e.name)>-1,metadata:{label:e.alias,fieldName:e.name}},this.layerDisplayType===a.l.feature&&!e.name.includes(a.f.relationship)&&(0,s.h)("calcite-action",{slot:"actions-end",text:this.strings.info,title:this.strings.info,scale:"s",icon:"information",onClick:t=>{var i;t.stopPropagation();const s=t.target,o=document.createElement("calcite-flow-item");o.heading=null!==(i=e.alias)&&void 0!==i?i:e.name,o.description=e.name;const a=document.createElement("arcgis-field-info");a.lang=this.currentLanguageIntl,a.fieldName=e.name,a.layer=this.layer,a.view=this.mapView,a.classList.add("content"),o.addEventListener("calciteFlowItemBack",(()=>{this.flowElement.removeChild(o),this.flowItemElement.selected=!0,requestAnimationFrame((()=>s.setFocus()))})),o.appendChild(a),this.flowElement.appendChild(o),o.selected=!0,this.flowItemElement.selected=!1,setTimeout((()=>o.setFocus()),200)}})),this.calciteExpressionsOnlyValueList=e=>(0,s.h)("calcite-list-item",{key:e.name,label:e.alias||e.name,value:e.name,description:`{${e.name}}`,selected:!this.multiple&&e.name===this.selectedFields[0]||this.multiple&&this.selectedFields.indexOf(e.name)>-1,metadata:{label:e.alias,fieldName:e.name}},(0,s.h)("div",{class:"expression-actions",slot:"actions-end"},(0,s.h)("calcite-action",{disabled:d.p.blockFeatureReductionArcade,text:this.strings.edit,title:this.strings.edit,scale:"s",icon:this.numbersOnly&&e.type.toLowerCase()!==a.a.number?"exclamation-mark-triangle":"pencil",onClick:()=>{this.arcadeExpMap.has(e.name)&&this.launchArcade(this.arcadeExpMap.get(e.name))}}),(0,s.h)("calcite-action",{text:this.strings.remove,title:this.strings.remove,scale:"s",icon:"trash",onClick:async()=>{const t=this.popupTemplate.expressionInfos.find((t=>`${a.f.expression}${t.name}`===e.name));if(t){this.popupTemplate.expressionInfos.splice(this.popupTemplate.expressionInfos.indexOf(t),1);this.popupTemplate.content.filter((e=>"fields"===e.type)).forEach((t=>{const i=t.fieldInfos.find((t=>t.fieldName===e.name));i&&t.fieldInfos.splice(t.fieldInfos.indexOf(i),1)}))}await R(this.popupTemplate,this.layerDisplayType,this.layer,this.FieldInfo),this.fields=this.fields.filter((t=>t.name!==e.name)),this.selectedFields=[...this.selectedFields].filter((t=>t!==e.name)),this.multiple&&this.arcgisPopupPickListChange.emit({selectedFields:[...new Set(this.selectedFields)]}),this.arcadeChangeNotification.emit()}}))),this.selectedFields=[],this.popoverProps=void 0,this.showCancel=!0,this.multiple=!1,this.heading=void 0,this.okBtnText=void 0,this.showFilterLength=5,this.numbersOnly=!1,this.lastSortyBy=a.L.default,this.filterFields=null,this.arcadeEditor=void 0}async componentWillLoad(){this.layer=d.p.layer,this.mapView=d.p.mapView,this.portal=d.p.portal,this.config=d.p.config,this.strings=d.p.strings,this.currentLanguage=d.p.currentLanguage,this.currentLanguageIntl=d.p.currentLanguageIntl,this.serviceType=d.p.serviceType,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType,this.supportsArcade=d.p.supportsArcade,this.layerFieldsMap=await(0,n.e)(this.layer),this.arcadeExpMap=(0,n.f)(this.popupTemplate),this.fields=await this.getFields(),!this.multiple&&this.selectedFields.length>1&&(this.selectedFields=[this.selectedFields[0]])}async componentDidLoad(){await this.loadAllModules(),this.popoverNode.open=!0,setTimeout((()=>requestAnimationFrame((()=>this.flowItemElement.setFocus()))),200)}componentWillRender(){this.arcadeExpMap=(0,n.f)(this.popupTemplate),this.fieldsOnly=[...this.getSortedList()].filter((e=>!e.name.includes(a.f.expression))),this.expressionsOnly=[...this.getSortedList()].filter((e=>e.name.includes(a.f.expression)))}async reposition(){var e;null===(e=this.popoverNode)||void 0===e||e.reposition()}getSortedList(){const e=[...this.fields];return this.lastSortyBy===a.L.display?e.sort(((e,t)=>e.alias.localeCompare(t.alias))):this.lastSortyBy===a.L.field?e.sort(((e,t)=>e.name.localeCompare(t.name))):this.lastSortyBy===a.L.type&&e.sort(((e,t)=>e.type.localeCompare(t.type))),e}selectDeselect(){var e;return(null===(e=this.filterFields)||void 0===e?void 0:e.length)?this.filterContainsAll():this.selectedFields.length===this.fields.length}filterContainsAll(){return this.filterFields.every((e=>this.selectedFields.some((t=>t===e))))}async loadAllModules(){[this.PopupExpressionInfo,this.FieldInfo]=await(0,l.l)(["esri/popup/ExpressionInfo","esri/popup/FieldInfo"])}async launchArcade(e){this.arcadeEditor||(this.flowItemElement.disabled=!0,this.arcadeEditor=document.createElement("arcgis-modal-arcade"),this.arcadeEditor.arcadeScript=P(null==e?void 0:e.expression,this.layerDisplayType,this.strings),this.arcadeEditor.arcadeProfile=await C(this.layer,this.mapView,this.serviceType,this.popupTemplate,this.layerDisplayType),this.arcadeEditor.testData=await k(this.layer,this.mapView,this.layerDisplayType,this.popupTemplate),this.arcadeEditor.addExistingExpressions=!0,this.arcadeEditor.layer=this.layer,this.arcadeEditor.arcadeTitle=(null==e?void 0:e.title)||this.strings.arcadeDefaultTitle,this.arcadeEditor.arcadeTitleEditable=!0,this.arcadeEditor.arcadeTitleEditingEnabled=!(null==e?void 0:e.title),document.body.appendChild(this.arcadeEditor),this.arcadeEditor.addEventListener("arcgisModalArcadeClose",(t=>this.arcadeSetup(t.detail,e))))}async arcadeSetup(e,t){if(e){const i=S(e,null==t?void 0:t.name,this.PopupExpressionInfo,this.popupTemplate);await R(this.popupTemplate,this.layerDisplayType,this.layer,this.FieldInfo);const s=`${a.f.expression}${i.name}`;this.fields.push({name:s,alias:i.title,type:i.returnType}),this.fields=[...new Map(this.fields.map((e=>[e.name,e]))).values()],this.multiple?this.selectedFields.push(s):this.selectedFields=[s],this.arcgisPopupPickListChange.emit({selectedFields:[...new Set(this.selectedFields)]}),this.arcadeChangeNotification.emit()}this.flowItemElement.disabled=!1,document.body.removeChild(this.arcadeEditor),this.arcadeEditor=null}async getFields(){const e=[];let t=await(0,n.k)(this.layer);t=t.filter((e=>e.visible));const i=new Map(this.popupTemplate.fieldInfos.map((e=>[e.fieldName,e])));if(t.forEach((t=>{if(i.has(t.name)){const s=i.get(t.name);e.push({name:s.fieldName,alias:(0,n.c)(s,this.arcadeExpMap),type:(0,n.b)(s.fieldName,this.layerFieldsMap,this.arcadeExpMap)}),i.delete(t.name)}})),i.forEach((t=>{e.push({name:t.fieldName,alias:(0,n.c)(t,this.arcadeExpMap),type:(0,n.b)(t.fieldName,this.layerFieldsMap,this.arcadeExpMap)})})),this.numbersOnly){const t=new Set(this.selectedFields);return e.filter((e=>{const i=e.type.toLowerCase();if((t.has(e.name)||i===a.a.integer||i===a.a.smallInteger||i===a.a.bigInteger||i===a.a.single||i===a.a.double||i===a.a.long||i===a.a.number||i===a.a.oid)&&!e.name.includes(a.f.relationship))return e}))}return e}render(){const e=(0,s.h)("calcite-button",{appearance:this.showCancel?"solid":"outline-fill",width:this.showCancel?"half":"full",scale:"m",onClick:()=>{this.arcgisPopupPickListDismissed.emit({selectedFields:[...new Set(this.selectedFields)]})}},this.okBtnText||(this.multiple?this.strings.done:this.strings.ok)),t=(0,s.h)("calcite-button",{appearance:"outline-fill",width:this.multiple?"half":"full",scale:"m",onClick:()=>this.arcgisPopupPickListDismissed.emit()},this.strings.cancel),i=(0,s.h)("calcite-dropdown",{slot:"filter-actions-end",placement:"bottom-end",overlayPositioning:"fixed"},(0,s.h)("calcite-action",{slot:"trigger",text:this.strings.sort,title:this.strings.sort},(0,s.h)("calcite-icon",{scale:"s",icon:"sortDescending"})),(0,s.h)("calcite-dropdown-group",null,(0,s.h)("calcite-dropdown-item",{selected:this.lastSortyBy===a.L.default,onClick:()=>this.lastSortyBy=a.L.default,onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortyBy=a.L.default)}},this.strings.default),(0,s.h)("calcite-dropdown-item",{selected:this.lastSortyBy===a.L.display,onClick:()=>this.lastSortyBy=a.L.display,onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortyBy=a.L.display)}},this.strings.displayName),(0,s.h)("calcite-dropdown-item",{selected:this.lastSortyBy===a.L.type,onClick:()=>this.lastSortyBy=a.L.type,onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortyBy=a.L.type)}},this.strings.type),(0,s.h)("calcite-dropdown-item",{selected:this.lastSortyBy===a.L.field,onClick:()=>this.lastSortyBy=a.L.field,onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortyBy=a.L.field)}},this.strings.fieldName))),o=(0,s.h)("div",{class:"selection-button-div"},(0,s.h)("calcite-button",{appearance:"transparent",scale:"m",width:"full",class:"selection-button",onClick:()=>{var e,t;this.selectDeselect()?this.selectedFields=(null===(e=this.filterFields)||void 0===e?void 0:e.length)?this.selectedFields.filter((e=>!this.filterFields.includes(e))):[]:this.selectedFields=(null===(t=this.filterFields)||void 0===t?void 0:t.length)?[...new Set([...this.selectedFields,...this.filterFields])]:this.fields.map((e=>e.name)),this.arcgisPopupPickListChange.emit({selectedFields:this.selectedFields})}},this.selectDeselect()?this.strings.deselectAll:this.strings.selectAll)),n=(0,s.h)("calcite-button",{disabled:d.p.blockFeatureReductionArcade,appearance:"transparent",scale:"m",width:"full",iconStart:"plus",class:"add-expression-button",onClick:()=>{this.launchArcade()}},this.strings.addExpression);return(0,s.h)(s.H,{class:"js-app-flyout"},(0,s.h)("calcite-popover",{dir:(0,c.g)(this.hostElement),class:"popover",placement:this.popoverProps.placement||"leading-start",open:!1,pointerDisabled:!0,referenceElement:this.popoverProps.refElement,offsetDistance:this.popoverProps.offsetDistance||-Math.round(this.popoverProps.refElement.getBoundingClientRect().width),offsetSkidding:this.popoverProps.offsetSkidding||50,label:this.heading,triggerDisabled:!0,ref:e=>this.popoverNode=e},(0,s.h)("calcite-flow",{ref:e=>{this.flowElement=e},style:{width:`${this.popoverProps.popoverWidth||this.popoverProps.refElement.getBoundingClientRect().width}px`}},(0,s.h)("calcite-flow-item",{ref:e=>this.flowItemElement=e,class:"panel",heading:this.heading,closable:!0,onCalciteFlowItemClose:()=>this.arcgisPopupPickListDismissed.emit()},(0,s.h)("div",{class:"footer",slot:"footer"},this.supportsArcade&&n,this.multiple&&e,this.showCancel&&t),(0,s.h)("calcite-list",{label:this.heading,class:"content",selectionMode:this.multiple?"multiple":"single",ref:e=>{this.listNode=e},filterEnabled:this.fields.length>=this.showFilterLength,filterPlaceholder:this.strings.searchFields,onCalciteListFilter:e=>{var t;e.stopPropagation(),this.filterFields=null===(t=this.listNode.filteredItems)||void 0===t?void 0:t.map((e=>e.value))},onCalciteListChange:()=>{const e=this.listNode.selectedItems.map((e=>e.value)),t=this.selectedFields.filter((t=>e.includes(t))),i=e.filter((e=>!this.selectedFields.includes(e)));this.selectedFields=[...new Set([...t,...i])],this.arcgisPopupPickListChange.emit({selectedFields:this.selectedFields}),this.multiple||this.arcgisPopupPickListDismissed.emit({selectedFields:this.selectedFields})}},this.fields.length>=this.showFilterLength&&i,this.multiple&&o,this.supportsArcade&&(0,s.h)("calcite-list-item-group",{heading:this.strings.expressions},this.expressionsOnly.length?this.expressionsOnly.map((e=>this.calciteExpressionsOnlyValueList(e))):(0,s.h)("calcite-label",{alignment:"center"},this.strings.noExpressions)),(0,s.h)("calcite-list-item-group",{heading:this.supportsArcade?this.strings.attributes:null},this.fieldsOnly.map((e=>this.calciteFieldOnlyValueList(e)))))))))}get hostElement(){return(0,s.d)(this)}};fe.style=".popover{--calcite-popover-z-index:100}.panel{min-height:300px}.content{max-height:calc(60vh - 142px);}.selection-button-div{padding:4px 10px}.footer{width:100%}.expression-actions{display:flex}.add-expression-button{margin:4px 0 8px}";const ge="popover-image-div",ve="form-input-button",ye="refresh-image-input",be=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.notifyMultiMediaChange=(0,s.c)(this,"notifyMultiMediaChange",7),this.openAttributesList=e=>{const{strings:t}=this;this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.panelElement},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=t.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>this.removeAttributesSelectionPopover())),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>{t.preventDefault(),t.stopPropagation(),this.handleFieldPickListChange(t.detail.selectedFields[0],e)})),document.body.appendChild(this.popupFieldSelectionPickList),this.panelElement.disabled=!0)},this.imageFormInput=e=>{var t;const i=this.getImageInputObject(e);return(0,s.h)("calcite-label",{scale:"s"},i.inputLabel,(0,s.h)("div",{id:i.popoverId,class:ve},(0,s.h)("calcite-input",{type:"text",autofocus:!0,value:i.inputValue,placeholder:i.placeHolder,onCalciteInputInput:(0,h.d)((e=>{e.preventDefault(),e.stopPropagation(),this.changeImageProperties()}),300),ref:i.referenceElement}),(null===(t=this.popupTemplate.fieldInfos)||void 0===t?void 0:t.length)>0&&(0,s.h)("calcite-action",{text:this.strings.attributes,"text-display":"hidden",onClick:()=>this.openAttributesList(i.imageInput),scale:"s",icon:"brackets-curly"})))},this.getImageInputObject=e=>{const t=new class{};return t.imageInput=e,t.popoverId=`popoverId_${t.imageInput}`,e===a.i.sourceUrl?(t.inputLabel=this.strings.url,t.referenceElement=e=>this.editImageUrl=e,t.inputValue=this.imageMediaInfo.value.sourceURL,t.placeHolder=this.strings.imageUrlPlaceHolder):e===a.i.title?(t.inputLabel=this.strings.title,t.referenceElement=e=>this.editImageTitle=e,t.inputValue=this.imageMediaInfo.title,t.placeHolder=this.strings.imageTitlePlaceHolder):e===a.i.caption?(t.inputLabel=this.strings.caption,t.referenceElement=e=>this.editImageCaption=e,t.inputValue=this.imageMediaInfo.caption,t.placeHolder=this.strings.imageCaptionPlaceHolder):e===a.i.altText?(t.inputLabel=this.strings.description,t.referenceElement=e=>this.editAltText=e,t.inputValue=this.imageMediaInfo.altText,t.placeHolder=this.strings.describeImage):e===a.i.linkUrl&&(t.inputLabel=this.strings.link,t.referenceElement=e=>this.editImageLinkUrl=e,t.inputValue=this.imageMediaInfo.value.linkURL,t.placeHolder=this.strings.imageLinkUrlPlaceHolder),t},this.guid=void 0,this.imageMediaInfo=void 0,this.refElement=void 0,this.mediaIndexPosition=void 0,this.isOpen=!1,this.reRender=void 0}componentWillLoad(){this.strings=d.p.strings,this.popupTemplate=d.p.popupTemplate,this.imageMediaInfo.title=this.imageMediaInfo.title||"",this.imageMediaInfo.altText=this.imageMediaInfo.altText||"",this.imageMediaInfo.caption=this.imageMediaInfo.caption||"",this.imageMediaInfo.value.sourceURL=this.imageMediaInfo.value.sourceURL||"",this.imageMediaInfo.value.linkURL=this.imageMediaInfo.value.linkURL||""}componentDidLoad(){this.editImageUrl.value=this.imageMediaInfo.value.sourceURL,this.editImageTitle.value=this.imageMediaInfo.title,this.editRefreshImage.value=this.imageMediaInfo.refreshInterval?`${this.imageMediaInfo.refreshInterval}`:"0",this.editImageCaption.value=this.imageMediaInfo.caption,this.editImageLinkUrl.value=this.imageMediaInfo.value.linkURL,this.editAltText.value=this.imageMediaInfo.altText,this.isOpen=!0,setTimeout((()=>requestAnimationFrame((()=>this.panelElement.setFocus()))),300)}componentDidUpdate(){this.notifyMultiMediaChange.emit({guid:this.guid,mediaIndexPosition:this.mediaIndexPosition})}disconnectedCallback(){this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList)}async reposition(){var e;null===(e=this.popoverNode)||void 0===e||e.reposition()}closePopupPopoversHandler(){this.removeAttributesSelectionPopover()}closeMultiMediaPopoverHandler(){this.removeAttributesSelectionPopover()}removeAttributesSelectionPopover(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=void 0),this.panelElement.disabled=!1}changeImageProperties(){this.imageMediaInfo.value.sourceURL=this.editImageUrl.value,this.imageMediaInfo.title=this.editImageTitle.value,this.imageMediaInfo.refreshInterval=Number.isNaN(parseInt(this.editRefreshImage.value))?0:parseInt(this.editRefreshImage.value),this.imageMediaInfo.caption=this.editImageCaption.value,this.imageMediaInfo.altText=this.editAltText.value,this.imageMediaInfo.value.linkURL=this.editImageLinkUrl.value,(0,s.f)(this.hostElement)}handleFieldPickListChange(e,t){t===a.i.sourceUrl?(this.editImageUrl.value=D(this.editImageUrl,e),this.editImageUrl.setFocus()):t===a.i.title?(this.editImageTitle.value=D(this.editImageTitle,e),this.editImageTitle.setFocus()):t===a.i.caption?(this.editImageCaption.value=D(this.editImageCaption,e),this.editImageCaption.setFocus()):t===a.i.linkUrl?(this.editImageLinkUrl.value=D(this.editImageLinkUrl,e),this.editImageLinkUrl.setFocus()):t===a.i.altText&&(this.editAltText.value=D(this.editAltText,e),this.editAltText.setFocus()),this.changeImageProperties()}render(){const e=(0,s.h)("calcite-block-section",{key:"64a80ac288aca7603cba5c2af6adcf0802aef1f8",text:this.strings.refreshInterval,toggleDisplay:"switch",open:!!this.imageMediaInfo.refreshInterval,onCalciteBlockSectionToggle:(0,h.d)((e=>{e.preventDefault(),e.stopPropagation(),this.editRefreshImage.value="0",this.changeImageProperties()}),300)},(0,s.h)("div",{key:"51564c5cd227b64dec5298b2167cea7d99426f11",class:"refresh-label"},(0,s.h)("calcite-label",{key:"72a65fcf7053fa91239f191d42df795f68087af9",scale:"s",layout:"inline"},(0,s.h)("calcite-input",{key:"601543dbccb62adf0dff229f8f271f906edb0bfb",class:ye,type:"number",min:0,max:1440,ref:e=>this.editRefreshImage=e,value:this.imageMediaInfo.refreshInterval?`${this.imageMediaInfo.refreshInterval}`:"0",onCalciteInputInput:(0,h.d)((()=>{if(this.editRefreshImage.value){const e=parseInt(this.editRefreshImage.value);e<0?this.editRefreshImage.value="0":e>1440&&(this.editRefreshImage.value="1440")}this.changeImageProperties()}),300)}),this.strings.minutes))),t=(0,s.h)("div",{key:"a1b63aa2df577640250f325f152c2cbc5c97d208"},this.imageFormInput(a.i.sourceUrl),(0,s.h)("calcite-block-section",{key:"a1c22f54698acd0b9e918cbbfa1e89e94c947fce",open:!0,text:this.strings.options},this.imageFormInput(a.i.title),this.imageFormInput(a.i.caption),this.imageFormInput(a.i.altText),this.imageFormInput(a.i.linkUrl),e)),i=(0,s.h)("calcite-button",{key:"c93b554572a4f78bc4d02d2d100d6019bd361f49",appearance:"outline-fill",scale:"m",slot:"footer",width:"full",onClick:()=>this.closePopupPopovers.emit()},this.strings.done);return(0,s.h)(s.H,{key:"98c805632266dbe1ad3c91534527924877af78be",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"85300fb23c7a2381919bd2ab24977f7631059c82",dir:(0,c.g)(this.hostElement),class:"popover",id:"managePopover_Id",placement:"leading-start",open:this.isOpen,pointerDisabled:!0,referenceElement:this.refElement,offsetDistance:-Math.round(this.refElement.getBoundingClientRect().width),offsetSkidding:50,label:this.strings.configureImage,triggerDisabled:!0,ref:e=>this.popoverNode=e},(0,s.h)("calcite-panel",{key:"5cff0ac4ca8fe727419def67a525ea7689b1e49b",ref:e=>this.panelElement=e,closable:!0,style:{width:`${this.refElement.getBoundingClientRect().width}px`},onCalcitePanelClose:()=>this.closePopupPopovers.emit()},(0,s.h)("div",{key:"a61613b3726cb432a373f67a571253c97fdd6284",slot:"header-content"},this.strings.configureImage),i,(0,s.h)("div",{key:"4689f75d132e377531263f5c9e6d0b70ef824246",class:ge},t))))}get hostElement(){return(0,s.d)(this)}};be.style=".popover{--calcite-popover-z-index:100}.popover-image-div{background-color:var(--arcgis-app-background);padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-side-spacing-half);max-height:calc(60vh - 102px);}.refresh-label{margin-top:6px}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}.refresh-image-input{width:5rem}";const Pe=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.notifyAddContentSelection=(0,s.c)(this,"notifyAddContentSelection",7),this.notifyAddMultiMediaContentSelection=(0,s.c)(this,"notifyAddMultiMediaContentSelection",7),this.contentPopoverRefElement=void 0,this.popupHasAttachment=void 0,this.popoverPanelWidth=void 0,this.isMultimediaContent=!1,this.guid=void 0,this.isOpen=!1}async reposition(){var e;null===(e=this.popoverElement)||void 0===e||e.reposition()}componentWillLoad(){this.strings=d.p.strings,this.layerHasAttachment=d.p.layerHasAttachment,this.layerHasET=d.p.layerHasET,this.layerIsUNLayer=d.p.layerIsUNLayer,this.layerHasAttributes=d.p.layerHasAttributes,this.layerHasCharts=d.p.layerHasCharts,this.layerHasImages=d.p.layerHasImages,this.layerHasText=d.p.layerHasText,this.popupTemplate=d.p.popupTemplate,this.supportsArcade=d.p.supportsArcade}componentDidLoad(){this.hostElement.shadowRoot.getElementById("managePopover_Id").reposition(),this.isOpen=!0,setTimeout((()=>requestAnimationFrame((()=>this.panelElement.setFocus()))),300)}contentSelection(e){this.isMultimediaContent?this.notifyAddMultiMediaContentSelection.emit({guid:this.guid,content:e}):this.notifyAddContentSelection.emit(e)}render(){const e=(0,s.h)("calcite-action",{key:"9b9f800f58341f5996185a351f88110ec0ddec83",label:this.strings.fieldsList,text:this.strings.fieldsList,textEnabled:!0,onClick:()=>{this.contentSelection(V.attributes)}},(0,s.h)("calcite-icon",{key:"6a2547cd919eb321813597557ba5db174d46f09b",scale:"s",icon:"feature-details"})),t=(0,s.h)("calcite-action",{key:"f3742055b046d6e3db320a8938e5fcfa33f16cca",label:this.strings.attachments,text:this.strings.attachments,textEnabled:!0,onClick:()=>{this.contentSelection(V.attachments)},disabled:!!this.popupHasAttachment},(0,s.h)("calcite-icon",{key:"68d18f913d8cfb94784afdacf955dd8b70330f0d",scale:"s",icon:"attachment"})),i=(0,s.h)("calcite-action",{key:"62d63fd4c4f27598449e289657447361a65ee839",label:this.strings.chart,text:this.strings.chart,textEnabled:!0,onClick:()=>{this.contentSelection(V.charts)}},(0,s.h)("calcite-icon",{key:"53c7fa109b8ac03339dacfa732611c1c263bc311",scale:"s",icon:"graph-bar"})),o=(0,s.h)("calcite-action",{key:"c2c4347943bf39f3c15fba8374c48231b5fb6f84",label:this.strings.image,text:this.strings.image,textEnabled:!0,onClick:()=>{this.contentSelection(V.images)}},(0,s.h)("calcite-icon",{key:"2c04e1942d4d13b2ab14744e61d2d70eb80f38cc",scale:"s",icon:"image"})),a=(0,s.h)("calcite-action",{key:"23ab0d80006e5a5f1e5b303de5b126ff219cfa2b",label:this.strings.text,text:this.strings.text,textEnabled:!0,onClick:()=>{this.contentSelection(V.richText)}},(0,s.h)("calcite-icon",{key:"5d5ee6e39bb4a0c5bf28da7c14adb4460a1d6315",scale:"s",icon:"text"})),l=(0,s.h)("calcite-action",{key:"a86e8f5f108bd415c37d5e6188fc61946f6dcc80",disabled:d.p.blockFeatureReductionArcade,label:this.strings.arcade,text:this.strings.arcade,icon:"code",textEnabled:!0,onClick:()=>{this.contentSelection(V.arcade)}}),r=(0,s.h)("calcite-action",{key:"9e4b47879b8dfbab2f6cff31a89c42a5dd036039",label:this.strings.relatedRecords,text:this.strings.relatedRecords,textEnabled:!0,onClick:()=>{this.contentSelection(V.relationship)}},(0,s.h)("calcite-icon",{key:"4e2d337b974d19196572b9a09441e1756ef333e7",scale:"s",icon:"link"})),p=(0,s.h)("calcite-action",{key:"f07ee260d8247646153414bb09d5701b93b05880",label:this.strings.associations.associationsList,text:this.strings.associations.associationsList,textEnabled:!0,onClick:()=>this.contentSelection(V.associations)},(0,s.h)("calcite-icon",{key:"db1a053ae231d38780f75a1fe74347c7e5fff620",scale:"s",icon:"view-associations"})),h=(0,s.h)("calcite-action",{key:"9284eb149b62217b75b74478191fff594fbe0320",label:this.strings.summaryETHeading,text:this.strings.summaryETHeading,textEnabled:!0,onClick:()=>{this.contentSelection(V.summaryET)},disabled:!!this.popupTemplate.lastEditInfoEnabled},(0,s.h)("calcite-icon",{key:"6c9fea3ef3738be1888990d3a9b8a55b8cd6551e",scale:"s",icon:"user"})),u=(0,n.q)(this.contentPopoverRefElement,"calcite-flow-item"),m=(null==u?void 0:u.getBoundingClientRect().top)||56,f=(null==u?void 0:u.getBoundingClientRect().bottom)||0,g=this.contentPopoverRefElement.getBoundingClientRect().top,v=g-m<f-(g+25)?0:g-m-50-10,y={maxHeight:v>0?`${v}px`:"60vh"};return(0,s.h)(s.H,{key:"ff9fac06eaf268377c2caf44f3d7e5a4f0185656",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"2fb0d53147f86939450679478a71d75719c72571",ref:e=>this.popoverElement=e,class:"popover",dir:(0,c.g)(this.hostElement),id:"managePopover_Id",placement:"bottom",open:this.isOpen,referenceElement:this.contentPopoverRefElement,label:this.isMultimediaContent?this.strings.addMedia:this.strings.addContent,triggerDisabled:!0},(0,s.h)("calcite-panel",{key:"22f5ba7ad4e7c23a5ec071715a32690a2e96bc57",ref:e=>this.panelElement=e,closable:!0,style:{width:`${this.popoverPanelWidth}px`},onCalcitePanelClose:()=>this.closePopupPopovers.emit()},(0,s.h)("div",{key:"f85b3ea2ae2da97091e44a7ffc3c86ab4d4080d2",slot:"header-content"},this.isMultimediaContent?this.strings.addMedia:this.strings.content),this.isMultimediaContent?(0,s.h)("div",{style:y},this.layerHasCharts&&i,this.layerHasImages&&o):(0,s.h)("div",{style:y},this.layerHasAttributes&&e,this.layerHasAttachment&&t,this.layerHasCharts&&i,this.layerHasImages&&o,this.layerHasText&&a,this.supportsArcade&&l,d.p.layerHasRelatedRecords&&r,this.layerIsUNLayer&&p,this.layerHasET&&h))))}get hostElement(){return(0,s.d)(this)}};Pe.style=".popover{--calcite-popover-z-index:100}";const Ce="add-media-button",ke="form-input-button",Ie="disable-spacing",we=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.closeMultiMediaPopover=(0,s.c)(this,"closeMultiMediaPopover",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.deleteComponent=(0,s.c)(this,"deleteComponent",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.pickList=[],this.mediaMap=new Map,this.formInput=(e,t,i,o,a)=>{var n;return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:ke},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i,value:o,placeholder:a,onCalciteInputInput:t=>{t.stopPropagation();const i=t.target.value;"title"===e?this.multimediaContent.title=i:this.multimediaContent.description=i,this.reRender=!this.reRender},onClick:()=>this.closePopupPopovers.emit()}),(null===(n=this.popupTemplate.fieldInfos)||void 0===n?void 0:n.length)>0&&(0,s.h)("calcite-action",{text:this.strings.attributes,onClick:()=>{this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},scale:"s",icon:"brackets-curly"})))},this.guid=void 0,this.multimediaContent=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0}async componentWillLoad(){this.strings=d.p.strings,this.mapView=d.p.mapView,this.popupTemplate=d.p.popupTemplate;const[e]=await(0,l.l)(["esri/core/reactiveUtils"]);e.watch((()=>{var e;return null===(e=this.mapView.popup)||void 0===e?void 0:e.selectedFeature}),(()=>this.setActiveMediaInfoIndex(0))),e.watch((()=>{var e;return null===(e=this.mapView.popup)||void 0===e?void 0:e.visible}),(()=>this.setActiveMediaInfoIndex(0))),this.multimediaContent.title||(this.multimediaContent.title=""),this.multimediaContent.description||(this.multimediaContent.description="")}componentDidLoad(){this.blockOpen&&(this.addMediaBtn.scrollIntoView({behavior:"auto",block:"nearest",inline:"start"}),1===this.multimediaContent.mediaInfos.length?this.openMediaPopover(this.multimediaContent.mediaInfos[0],0):this.blockOptions.setFocus())}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){this.imagePopover&&document.body.removeChild(this.imagePopover),this.chartPopover&&document.body.removeChild(this.chartPopover),this.multimediaContentPopover&&document.body.removeChild(this.multimediaContentPopover),this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList)}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}resetMultiMediaIndexHandler(){this.setActiveMediaInfoIndex(0,!0)}closePopupPopoversHandler(e){(null==e?void 0:e.detail)!==this.guid&&this.imagePopover&&(this.closeMultiMediaPopover.emit(),document.body.removeChild(this.imagePopover),this.imagePopover=null,this.addMediaBtn.setFocus(),this.disablePopupPanel.emit(!1)),(null==e?void 0:e.detail)!==this.guid&&this.chartPopover&&(this.closeMultiMediaPopover.emit(),document.body.removeChild(this.chartPopover),this.chartPopover=null,this.addMediaBtn.setFocus(),this.disablePopupPanel.emit(!1)),this.multimediaContentPopover&&(document.body.removeChild(this.multimediaContentPopover),this.multimediaContentPopover=null,this.addMediaBtn.disabled=!1,requestAnimationFrame((()=>this.addMediaBtn.setFocus())),this.disablePopupPanel.emit(!1)),this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.disablePopupPanel.emit(!1))}notifyMultiMediaChangeHandler(e){var t,i;(null===(t=e.detail)||void 0===t?void 0:t.guid)===this.guid&&(this.setActiveMediaInfoIndex(null===(i=e.detail)||void 0===i?void 0:i.mediaIndexPosition),this.reRender=!this.reRender)}async notifyAddMultiMediaContentSelectionHandler(e){if(e.stopPropagation(),this.closePopupPopovers.emit(),e.detail.guid===this.guid){const t=e.detail.content,[i,s,o,a]=await(0,l.l)(["esri/popup/content/ImageMediaInfo","esri/popup/content/ColumnChartMediaInfo","esri/popup/content/support/ImageMediaInfoValue","esri/popup/content/support/ChartMediaInfoValue"]);let n;t===V.images?n=new i({title:"",caption:"",altText:"",value:new o({sourceURL:"",linkURL:""})}):t===V.charts&&(n=new s({title:"",caption:"",altText:"",value:new a({fields:[]})})),this.multimediaContent.mediaInfos.push(n),this.reRender=!this.reRender,this.openMediaPopover(n,this.multimediaContent.mediaInfos.length-1)}}setActiveMediaInfoIndex(e,t){this.multimediaContent.activeMediaInfoIndex=e||0,t&&this.internalPopupUpdated.emit()}findChartIndexPosition(e){const t=this.hostElement.shadowRoot.getElementById("list_Id").getElementsByTagName("calcite-list-item");for(let i=0;i<t.length;i++)if(t[i].id===e)return i}getMultiMediaText(e){return e===$.image?this.strings.image:e===$.barChart||e===$.columnChart?this.strings.barChart:e===$.lineChart?this.strings.lineChart:e===$.pieChart?this.strings.pieChart:this.strings.image}openMediaPopover(e,t){e.type===$.image?(this.imagePopover=document.createElement("arcgis-popup-image"),this.imagePopover.guid=this.guid,this.imagePopover.refElement=this.popupFlowItem,this.imagePopover.imageMediaInfo=e,this.imagePopover.mediaIndexPosition=t,document.body.appendChild(this.imagePopover)):(this.chartPopover=document.createElement("arcgis-popup-chart"),this.chartPopover.guid=this.guid,this.chartPopover.refElement=this.popupFlowItem,this.chartPopover.chartMediaInfo=e,this.chartPopover.mediaContent=this.multimediaContent,this.chartPopover.mediaIndexPosition=t,document.body.appendChild(this.chartPopover)),this.disablePopupPanel.emit(!0)}getDescription(){return this.multimediaContent.mediaInfos.length>1?`${this.strings.multiple} (${this.multimediaContent.mediaInfos.length})`:this.multimediaContent.mediaInfos.length?this.getMultiMediaText(this.multimediaContent.mediaInfos[0].type):""}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];"title"===t?(this.contentTitle.value=D(this.contentTitle,i),this.contentTitle.setFocus(),this.multimediaContent.title=this.contentTitle.value):"description"===t&&(this.contentDescription.value=D(this.contentDescription,i),this.contentDescription.setFocus(),this.multimediaContent.description=this.contentDescription.value),this.closePopupPopovers.emit(),this.reRender=!this.reRender}handleListOrderChange(e,t){const i=this.multimediaContent.mediaInfos[e];this.multimediaContent.mediaInfos.splice(e,1),this.multimediaContent.mediaInfos.splice(t,0,i),this.internalPopupUpdated.emit(),this.closePopupPopovers.emit(),this.setActiveMediaInfoIndex(0,!0),(0,s.f)(this.hostElement)}render(){return(0,s.h)(s.H,{key:"2fdc3c795ade507997713a176b5e61132dea6d38"},(0,s.h)("calcite-block",{key:"460be43c15d4cd4057c766fb5579bb4c9bdb79ce",dir:(0,c.g)(this.hostElement),heading:this.multimediaContent.mediaInfos.length>1?this.strings.mediaGroup:this.strings.media,description:this.multimediaContent.title&&`${this.multimediaContent.title.substring(0,25)}${this.multimediaContent.title.length>25?"...":""}`||this.getDescription(),collapsible:!0,open:this.blockOpen,dragHandle:!0},(0,s.h)("div",{key:"03364151603aedb506d9b18c923abc6203d69c4c",class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{key:"28c5017b28569f8e24cdb203b35fd609ec250f7e",ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:!0}})),(0,s.h)("div",{key:"90eec5284a0c755a61ab25e8277e95db8f6d9336",slot:"icon"},(0,s.h)("calcite-icon",{key:"d0399857a54e63f5a545be97e96e89f46478fabc",scale:"m",icon:"images"})),(0,s.h)("div",{key:"56011edaa086d43600a2a1d5459752e703e2f49e",class:"ignore-elements-sortable"},this.formInput("title",this.strings.title,(e=>this.contentTitle=e),this.multimediaContent.title,this.strings.enterTitle),this.formInput("description",this.strings.desc,(e=>this.contentDescription=e),this.multimediaContent.description,this.strings.enterDescription),(0,s.h)("calcite-label",{key:"6abb3760054edc001c67ddc0eef4ca293580acba",class:Ie,scale:"s"},this.strings.mediaContent),(0,s.h)("calcite-list",{key:"2f532d784efebee4bf2d6de0ccde6d88f0a08358",label:this.strings.mediaContent,id:"list_Id",dragEnabled:!0,onCalciteListOrderChange:e=>{const t=e.detail.oldIndex,i=e.detail.newIndex;this.handleListOrderChange(t,i)}},this.multimediaContent.mediaInfos.map(((e,t)=>(0,s.h)("calcite-list-item",{key:`${JSON.stringify(e)}`,label:e.title&&`${e.title.substring(0,25)}${e.title.length>25?"...":""}`||this.strings.noTitle,description:this.getMultiMediaText(e.type),onClick:i=>{i.stopPropagation(),this.closePopupPopovers.emit(),this.openMediaPopover(e,t)}},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.strings.remove,onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.multimediaContent.mediaInfos.splice(t,1),0===this.multimediaContent.mediaInfos.length?this.deleteComponent.emit(this.guid):(this.setActiveMediaInfoIndex(0),this.internalPopupUpdated.emit()),(0,s.f)(this.hostElement)}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))))),(0,s.h)("calcite-button",{key:"c25f7024773d1bc29197a4016d37db2351af48ef",ref:e=>this.addMediaBtn=e,title:this.strings.addMedia,appearance:"outline-fill",round:!0,scale:"s",class:Ce,iconStart:"plus",onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.multimediaContentPopover||(this.multimediaContentPopover=document.createElement("arcgis-popup-main-contentpopover"),this.multimediaContentPopover.contentPopoverRefElement=this.addMediaBtn,this.multimediaContentPopover.popoverPanelWidth=this.hostElement.getBoundingClientRect().width,this.multimediaContentPopover.isMultimediaContent=!0,this.multimediaContentPopover.guid=this.guid,document.body.appendChild(this.multimediaContentPopover),this.addMediaBtn.disabled=!0,this.disablePopupPanel.emit(!0))}}))))}get hostElement(){return(0,s.d)(this)}};we.style=".add-media-button{display:flex;justify-content:center;padding:var(--arcgis-app-cap-spacing-half) 0 0 0}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}.disable-spacing{--calcite-label-margin-bottom:0}";const xe=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.maxPreviewCount=11,this.fieldPickListChanges=e=>{var t,i;e.stopPropagation();const s=null===(i=null===(t=e.detail)||void 0===t?void 0:t.selectedFields)||void 0===i?void 0:i[0];s&&(this.relatedRecordsContent.orderByFields[0].field=s,this.reRender=!this.reRender),this.closePopupPopovers.emit()},this.formInput=(e,t,i,o,a)=>{var n;return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:"form-input-button"},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i,value:o,placeholder:a,disabled:!this.hasRelationshipLayer,onCalciteInputInput:t=>{t.stopPropagation();const i=t.target.value;"title"===e?this.relatedRecordsContent.title=i:this.relatedRecordsContent.description=i,this.reRender=!this.reRender},onClick:()=>this.closePopupPopovers.emit()}),(null===(n=this.popupTemplate.fieldInfos)||void 0===n?void 0:n.length)&&(0,s.h)("calcite-action",{text:this.strings.attributes,disabled:!this.hasRelationshipLayer,onClick:()=>{this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem,offsetSkidding:50},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},scale:"s",icon:"brackets-curly"})))},this.guid=void 0,this.relatedRecordsContent=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0,this.hasRelationshipLayer=!0}async componentWillLoad(){this.strings=d.p.strings,this.layer=d.p.layer,this.view=d.p.mapView,this.popupTemplate=d.p.popupTemplate,await this.loadAllModules(),this.hasRelationshipLayer=await this.checkIfRelationshipExists(),this.relatedRecordsContent.title||(this.relatedRecordsContent.title=""),this.relatedRecordsContent.description||(this.relatedRecordsContent.description="")}componentDidLoad(){this.blockOpen&&(this.blockOptions.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),this.blockOptions.setFocus()),this.watchForChangesToLayersList()}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){var e;null===(e=this.watchLayersTables)||void 0===e||e.remove(),this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList),this.arcgisFieldPickList&&document.body.removeChild(this.arcgisFieldPickList)}closePopupPopoversHandler(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.disablePopupPanel.emit(!1)),this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=null,this.disablePopupPanel.emit(!1))}async loadAllModules(){[this.RelatedRecordsInfoFieldOrder,this.reactiveUtils]=await(0,l.l)(["esri/popup/support/RelatedRecordsInfoFieldOrder","esri/core/reactiveUtils"])}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];"title"===t?(this.contentTitle.value=D(this.contentTitle,i),this.contentTitle.setFocus(),this.relatedRecordsContent.title=this.contentTitle.value):"description"===t&&(this.contentDescription.value=D(this.contentDescription,i),this.contentDescription.setFocus(),this.relatedRecordsContent.description=this.contentDescription.value),this.closePopupPopovers.emit(),this.reRender=!this.reRender}async openPickList(e){var t,i,s;this.closePopupPopovers.emit(),this.arcgisFieldPickList||(this.arcgisFieldPickList=document.createElement("arcgis-field-pick-list"),this.arcgisFieldPickList.popoverProps={refElement:this.popupFlowItem,offsetSkidding:50},this.arcgisFieldPickList.fields=e.fields.filter((e=>e.visible)),this.arcgisFieldPickList.layer=e,this.arcgisFieldPickList.mapView=this.view,this.arcgisFieldPickList.showFieldInfo=!0,this.arcgisFieldPickList.showFieldName=!0,this.arcgisFieldPickList.selectedFields=[null===(s=null===(i=null===(t=this.relatedRecordsContent)||void 0===t?void 0:t.orderByFields)||void 0===i?void 0:i[0])||void 0===s?void 0:s.field],this.arcgisFieldPickList.addEventListener("arcgisFieldPickListDismissed",this.fieldPickListChanges),document.body.appendChild(this.arcgisFieldPickList),this.disablePopupPanel.emit(!0))}async checkIfRelationshipExists(){var e;for(const t of null===(e=this.layer)||void 0===e?void 0:e.relationships)if(t.id===this.relatedRecordsContent.relationshipId){const e=U(this.view);for(const i of e){const e=i;if("subtype-sublayer"!==e.type&&"subtype-group"!==e.type&&await B(this.layer,e,t))return await e.load(),Promise.resolve(!0)}return Promise.resolve(!1)}return Promise.resolve(!1)}watchForChangesToLayersList(){this.watchLayersTables=this.reactiveUtils.watch((()=>[this.view.map.allLayers.length,this.view.map.allTables.length]),(async()=>{this.hasRelationshipLayer=await this.checkIfRelationshipExists()}))}render(){var e,t,i,o,a,n,l;const r=(0,s.h)("calcite-label",null,this.strings.relationship,(0,s.h)("calcite-dropdown",{disabled:!this.hasRelationshipLayer,overlayPositioning:"fixed",class:"dropdown"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full",scale:"m"},(()=>{for(const e of this.layer.relationships)if(e.id===this.relatedRecordsContent.relationshipId)return e.name||this.strings.relationship;return this.strings.relationship})()),(0,s.h)("calcite-dropdown-group",null,this.layer.relationships.map((e=>{const t=U(this.view);for(const i of t){const t=i;if(H(this.layer,t,e))return(0,s.h)("calcite-dropdown-item",{selected:this.relatedRecordsContent.relationshipId===e.id,onClick:async()=>{var i;await t.load(),this.relatedRecordsContent.relationshipId=e.id,this.relatedRecordsContent.orderByFields=[new this.RelatedRecordsInfoFieldOrder({field:t.fields.find((e=>e.visible)).name,order:(null===(i=this.relatedRecordsContent.orderByFields)||void 0===i?void 0:i[0].order)||"asc"})],this.reRender=!this.reRender}},e.name||this.strings.relationship)}}))))),p=(0,s.h)("calcite-label",null,this.strings.sortBy,(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full",scale:"m",disabled:!this.hasRelationshipLayer,onClick:async()=>{this.layer.relationships.map((async e=>{const t=U(this.view);for(const i of t){const t=i;this.relatedRecordsContent.relationshipId===e.id&&H(this.layer,t,e)&&this.openPickList(t)}}))}},(null===(i=null===(t=null===(e=this.relatedRecordsContent)||void 0===e?void 0:e.orderByFields)||void 0===t?void 0:t[0])||void 0===i?void 0:i.field)||this.strings.default)),d=(0,s.h)("calcite-label",null,this.strings.sortOrder,(0,s.h)("calcite-dropdown",{disabled:!this.hasRelationshipLayer,overlayPositioning:"fixed"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full",scale:"m"},"desc"===(null===(o=this.relatedRecordsContent.orderByFields)||void 0===o?void 0:o[0].order)?this.strings.descending:this.strings.ascending),(0,s.h)("calcite-dropdown-item",{selected:"asc"===(null===(a=this.relatedRecordsContent.orderByFields)||void 0===a?void 0:a[0].order),onClick:()=>{this.relatedRecordsContent.orderByFields[0].order="asc",this.reRender=!this.reRender}},this.strings.ascending),(0,s.h)("calcite-dropdown-item",{selected:"desc"===(null===(n=this.relatedRecordsContent.orderByFields)||void 0===n?void 0:n[0].order),onClick:()=>{this.relatedRecordsContent.orderByFields[0].order="desc",this.reRender=!this.reRender}},this.strings.descending))),h=(0,s.h)("calcite-label",null,this.strings.previewCount,(0,s.h)("calcite-dropdown",{disabled:!this.hasRelationshipLayer,overlayPositioning:"fixed"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full",scale:"m"},null!==(l=0===this.relatedRecordsContent.displayCount?this.strings.none:this.relatedRecordsContent.displayCount)&&void 0!==l?l:1),(0,s.h)("calcite-dropdown-group",null,[...Array(this.maxPreviewCount).keys()].map((e=>(0,s.h)("calcite-dropdown-item",{selected:this.relatedRecordsContent.displayCount===e,onClick:()=>{this.relatedRecordsContent.displayCount=e,this.reRender=!this.reRender}},0===e?this.strings.none:e))))));return(0,s.h)(s.H,null,(0,s.h)("calcite-block",{dir:(0,c.g)(this.hostElement),heading:this.strings.relatedRecords,description:this.relatedRecordsContent.title&&`${this.relatedRecordsContent.title.substring(0,25)}${this.relatedRecordsContent.title.length>25?"...":""}`||(()=>{for(const e of this.layer.relationships)if(e.id===this.relatedRecordsContent.relationshipId)return e.name;return this.strings.selectTable})(),collapsible:!0,open:this.blockOpen,dragHandle:!0,onCalciteBlockOpen:()=>this.closePopupPopovers.emit(),onCalciteBlockClose:()=>this.closePopupPopovers.emit()},(0,s.h)("div",{class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:this.hasRelationshipLayer}})),(0,s.h)("div",{slot:"icon"},(0,s.h)("calcite-icon",{scale:"m",icon:this.hasRelationshipLayer?"link":"exclamation-mark-triangle"})),(0,s.h)("div",{class:"ignore-elements-sortable"},this.formInput("title",this.strings.title,(e=>this.contentTitle=e),this.relatedRecordsContent.title,this.strings.enterTitle),this.formInput("description",this.strings.desc,(e=>this.contentDescription=e),this.relatedRecordsContent.description,this.strings.enterDescription),r,p,d,h)))}get hostElement(){return(0,s.d)(this)}};xe.style=".form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}.dropdown{width:100%}";const Le=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.richTextChangedReRender=(0,s.c)(this,"richTextChangedReRender",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.arcadeExpMap=new Map,this.guid=void 0,this.fieldExpressionData=void 0,this.arcgisColorPickerData=void 0,this.richtextContent=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0}componentWillLoad(){this.strings=d.p.strings,this.currentLanguage=d.p.currentLanguage,this.popupTemplate=d.p.popupTemplate}componentDidLoad(){if(this.ckEditorMentionFieldsSetup(),this.blockOpen){this.hostElement.shadowRoot.getElementById("content_Id").scrollIntoView({behavior:"auto",block:"nearest",inline:"start"}),this.showRichTextEditor()}}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){this.arcgisCkeditor5Popover&&document.body.removeChild(this.arcgisCkeditor5Popover)}richTextChangedReRenderHandler(e){e.stopPropagation(),this.reRender=!this.reRender}closeAllPopoversHandler(){this.arcgisCkeditor5Popover&&(document.body.removeChild(this.arcgisCkeditor5Popover),this.arcgisCkeditor5Popover=null,this.disablePopupPanel.emit(!1))}ckEditorPopoverClosedHandler(e){var t,i,s,o,a;(null===(t=e.detail)||void 0===t?void 0:t.guid)===this.guid&&(e.stopPropagation(),((null===(s=null===(i=e.detail)||void 0===i?void 0:i.data)||void 0===s?void 0:s.length)||0===(null===(a=null===(o=e.detail)||void 0===o?void 0:o.data)||void 0===a?void 0:a.length))&&(this.richtextContent.text=e.detail.data,this.reRender=!this.reRender,this.richTextChangedReRender.emit()),this.closePopupPopovers.emit())}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}arcadeChangeNotificationHandler(){this.ckEditorMentionFieldsSetup()}ckEditorMentionFieldsSetup(){var e;this.arcadeExpMap=(0,n.f)(this.popupTemplate),this.ckEditorMentionFields=[],null===(e=this.popupTemplate.fieldInfos)||void 0===e||e.forEach((e=>{e.fieldName&&this.ckEditorMentionFields.push({id:"{"+e.fieldName+"}",name:(0,n.c)(e,this.arcadeExpMap)})}))}getTextFromHtml(e){var t;const i=null!==(t=this.richtextContent.text)&&void 0!==t?t:"",s=document.createElement("div");s.innerHTML=i;const o=s.textContent||s.innerText||"";return`${o.substring(0,e)}${o.length>e?"...":""}`}showRichTextEditor(){var e,t;this.closePopupPopovers.emit(),this.arcgisCkeditor5Popover=document.createElement("arcgis-ckeditor5-popover"),this.arcgisCkeditor5Popover.guid=this.guid,this.arcgisCkeditor5Popover.refElement=this.popupFlowItem,this.arcgisCkeditor5Popover.intlOk=this.strings.ok,this.arcgisCkeditor5Popover.intlCancel=this.strings.cancel;const i=document.createElement("arcgis-ckeditor5");i.customConfig={FieldExpression:Object.assign(Object.assign({},this.fieldExpressionData),{layer:void 0,mapView:void 0}),ArcgisColorPicker:Object.assign(Object.assign({},this.arcgisColorPickerData),{enableFields:!(!this.arcgisColorPickerData.data||!this.arcgisColorPickerData.data.length)})},i.textData=null!==(e=this.richtextContent.text)&&void 0!==e?e:"",i.mentionFields=this.ckEditorMentionFields,i.intlTextPlaceHolder=(null===(t=this.popupTemplate.fieldInfos)||void 0===t?void 0:t.length)>0?this.strings.textPlaceHolder:this.strings.textPlaceHolderLabel,i.currentLanguage=this.currentLanguage,i.setFocus(),this.arcgisCkeditor5Popover.appendChild(i),document.body.appendChild(this.arcgisCkeditor5Popover),this.disablePopupPanel.emit(!0)}render(){return(0,s.h)(s.H,{key:"d4a1914338d4123d7ac07fbb84f7aa73d9181807"},(0,s.h)("calcite-block",{key:"9d10abb7c8cc5a90d5507d4634db06cf1af3ad68",dir:(0,c.g)(this.hostElement),id:"richText_Id",heading:this.strings.text,description:this.getTextFromHtml(25),open:this.blockOpen,collapsible:!0,dragHandle:!0},(0,s.h)("div",{key:"e570f4a5d66caefc992774a8f3d7d79b176a6fb5",class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{key:"d46147a2fddf22661b0905c6204bbd9b4e5f7a33",guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:!0}})),(0,s.h)("div",{key:"ad03bfb3decc89eb3b09546d8d63741c544b14fd",slot:"icon"},(0,s.h)("calcite-icon",{key:"c59da28eeff5c82da8699085084b07b33ab549c6",scale:"m",icon:"text"})),(0,s.h)("div",{key:"4d1f8d7b5f5da2cd36edc303b893e7b75500c077",class:"ignore-elements-sortable",id:"content_Id"},(0,s.h)("calcite-button",{key:"9aef371fd5e36a8afd63156f665c89f988d7cf49",appearance:"transparent",width:"full",onClick:()=>this.showRichTextEditor()},this.strings.editText))))}get hostElement(){return(0,s.d)(this)}},Fe="form-input-button",Te=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.titleChangedReRender=(0,s.c)(this,"titleChangedReRender",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.changeTitle=()=>{this.popupTemplate.title=this.titleInput.value,this.internalPopupUpdated.emit(),this.titleChangedReRender.emit()},this.openAttributesList=e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",this.popupFieldSelectionPickListChanges),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},this.popupFieldSelectionPickListChanges=e=>{const t=e.detail.selectedFields[0];this.titleInput.value=D(this.titleInput,t),this.titleInput.setFocus(),this.popupTemplate.title=this.titleInput.value,this.changeTitle(),this.closePopupPopovers.emit()},this.popupFlowItem=void 0,this.popupTemplate=void 0,this.reRender=void 0}componentWillLoad(){this.strings=d.p.strings}componentDidLoad(){this.guidForSelection=(0,r.g)()}titleChangedReRenderHandler(e){e.stopPropagation(),this.reRender=!this.reRender}closePopupPopoversHandler(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.titleInput.setFocus(),this.disablePopupPanel.emit(!1))}render(){var e;const t=this.popupTemplate.title;return(0,s.h)(s.H,{key:"e4f1cd52a0610d64b39a527d3ff3373624ada6bc"},(0,s.h)("calcite-block",{key:"629f13584c5fdc933b95318c92a9b5b2a40b9f6b",dir:(0,c.g)(this.hostElement),heading:this.strings.popupTitle,description:t&&`${t.substring(0,25)}${t.length>25?"...":""}`,collapsible:!0},(0,s.h)("div",{key:"fd936c07f64f3c366725effd5b0ecc37daecc93d",slot:"icon"},(0,s.h)("calcite-icon",{key:"faf50b76e78c8d2cd5569cfbdad1a290adb336a6",scale:"m",icon:"title"})),(0,s.h)("div",{key:"0c51a154bf4a6fc041fe9748b1dc14152ab93add",class:Fe},(0,s.h)("calcite-input",{key:"927301870973f70a5ebf3bcb6de300b2a0c3444d",type:"text",autofocus:!0,ref:e=>{this.titleInput=e},value:t,onCalciteInputInput:e=>{e.stopPropagation(),this.changeTitle()},onClick:()=>this.closePopupPopovers.emit()}),(null===(e=this.popupTemplate.fieldInfos)||void 0===e?void 0:e.length)>0&&(0,s.h)("calcite-action",{key:"029be0a4a8a03cd93895352a7f197af43186869f",scale:"s",text:this.strings.attributes,onClick:this.openAttributesList,icon:"brackets-curly"}))))}get hostElement(){return(0,s.d)(this)}};Te.style=".form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}"},26408:(e,t,i)=>{i.d(t,{a:()=>p,b:()=>h,c:()=>o,d:()=>s,e:()=>n,f:()=>a,g:()=>c,h:()=>u,i:()=>m,m:()=>l,t:()=>r,u:()=>d});const s=(e,t)=>{let i,s="idle";const o=(...o)=>new Promise((a=>{switch(s){case"flushed":s="idle",i?(clearTimeout(i),a(e(...o))):a(null);break;case"invoked":clearTimeout(i),s="idle",a(e(...o));break;case"cancelled":clearTimeout(i),s="idle",a(null);break;default:i&&clearTimeout(i),s="pending",i=setTimeout((()=>(s="idle",a(e(...o)))),t)}}));return o.flush=function(...e){return s="flushed",o(...e)},o.invoke=function(...e){return s="invoked",o(...e)},o.cancel=function(...e){return s="cancelled",o(...e)},o.getStatus=function(){return s},o},o=(e,t)=>{let i;return(...s)=>new Promise((o=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,o(e(...s))}),t))}))};function a(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function n(e){return null!=e}async function l(e,t){return await Promise.all([e,r(t)]),e}function r(e){return new Promise((t=>setTimeout(t,e)))}const p=(e,t)=>Object.fromEntries((e||[]).map((e=>{const{key:i,data:s}=t(e);return[i,s]}))),c=(e,t)=>e.length===t.length&&e.reduce(((e,i)=>e&&t.indexOf(i)>-1),!0);function d(e,t){const i=[],s={};return e.forEach((e=>{const o=t(e);null==s[o]&&(s[o]=e,i.push(e))})),i}function h(e){const t={boolean:{},number:{},string:{}},i=[];return e.filter((e=>{let s=typeof e;return s in t?!t[s].hasOwnProperty(e)&&(t[s][e]=!0):!(i.indexOf(e)>=0)&&i.push(e)}))}const u=(e,t)=>[...Array(Math.ceil(e.length/t))].map(((i,s)=>e.slice(t*s,t+t*s))),m=(e,t)=>e.includes(t)},46227:(e,t,i)=>{i.d(t,{g:()=>s});const s=()=>[2,1,1,1,3].map((e=>{let t="";for(let i=0;i<e;i++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t})).join("-")},18991:(e,t,i)=>{i.d(t,{c:()=>r});var s=i(19564);const o=e=>!("isConnected"in e)||e.isConnected,a=((e,t)=>{let i;return(...s)=>{i&&clearTimeout(i),i=setTimeout((()=>{i=0,e(...s)}),t)}})((e=>{for(let t of e.keys())e.set(t,e.get(t).filter(o))}),2e3),n=e=>"function"==typeof e?e():e,l=(e,t)=>{const i=e.indexOf(t);i>=0&&(e[i]=e[e.length-1],e.length--)},r=(e,t)=>{const i=((e,t=(e,t)=>e!==t)=>{const i=n(e);let s=new Map(Object.entries(null!=i?i:{}));const o={dispose:[],get:[],set:[],reset:[]},a=()=>{var t;s=new Map(Object.entries(null!==(t=n(e))&&void 0!==t?t:{})),o.reset.forEach((e=>e()))},r=e=>(o.get.forEach((t=>t(e))),s.get(e)),p=(e,i)=>{const a=s.get(e);t(i,a,e)&&(s.set(e,i),o.set.forEach((t=>t(e,i,a))))},c="undefined"==typeof Proxy?{}:new Proxy(i,{get:(e,t)=>r(t),ownKeys:e=>Array.from(s.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(e,t)=>s.has(t),set:(e,t,i)=>(p(t,i),!0)}),d=(e,t)=>(o[e].push(t),()=>{l(o[e],t)});return{state:c,get:r,set:p,on:d,onChange:(t,i)=>{const s=d("set",((e,s)=>{e===t&&i(s)})),o=d("reset",(()=>i(n(e)[t])));return()=>{s(),o()}},use:(...e)=>{const t=e.reduce(((e,t)=>(t.set&&e.push(d("set",t.set)),t.get&&e.push(d("get",t.get)),t.reset&&e.push(d("reset",t.reset)),t.dispose&&e.push(d("dispose",t.dispose)),e)),[]);return()=>t.forEach((e=>e()))},dispose:()=>{o.dispose.forEach((e=>e())),a()},reset:a,forceUpdate:e=>{const t=s.get(e);o.set.forEach((i=>i(e,t,t)))}}})(e,t);return i.use((()=>{if("function"!=typeof s.g)return{};const e=new Map;return{dispose:()=>e.clear(),get:t=>{const i=(0,s.g)();i&&((e,t,i)=>{const s=e.get(t);s?s.includes(i)||s.push(i):e.set(t,[i])})(e,t,i)},set:t=>{const i=e.get(t);i&&e.set(t,i.filter(s.f)),a(e)},reset:()=>{e.forEach((e=>e.forEach(s.f))),a(e)}}})()),i}},62273:(e,t,i)=>{i.d(t,{c:()=>s,p:()=>o});function s(e){e.layer=null,e.mapView=null,e.portal=null,e.config=null,e.strings=null,e.currentLanguage=null,e.currentLanguageIntl=null,e.serviceType=null,e.popupTemplate=null,e.layerHasAttachment=null,e.layerHasET=null,e.layerIsUNLayer=null,e.layerHasAttributes=null,e.layerHasCharts=null,e.layerHasImages=null,e.layerHasText=null,e.layerDisplayType=null,e.supportsArcade=null,e.blockFeatureReductionArcade=!1,e.layerHasRelatedRecords=!1}const o=(0,i(18991).c)({layer:null,mapView:null,portal:null,config:null,strings:null,currentLanguage:null,currentLanguageIntl:null,serviceType:null,popupTemplate:null,layerHasAttachment:null,layerHasET:null,layerIsUNLayer:null,layerHasAttributes:null,layerHasCharts:null,layerHasImages:null,layerHasText:null,layerDisplayType:null,supportsArcade:null,blockFeatureReductionArcade:!1,layerHasRelatedRecords:!1}).state},9433:(e,t,i)=>{i.d(t,{g:()=>n,p:()=>l});var s=i(98034),o=i(12350),a=i(9421);const n=(e,t)=>async function(e,t){return new Promise(((i,n)=>{(0,s.l)(["esri/popup/FieldInfo"]).then((async([s])=>{var n,l,r;const p=[],c=new Map(null===(n=null==t?void 0:t.fieldInfos)||void 0===n?void 0:n.map((e=>[e.fieldName,e]))),d=await(0,a.e)(e);(null==d?void 0:d.size)&&(c.forEach((e=>{d.has(e.fieldName)&&(p.push(e),d.delete(e.fieldName))})),d.forEach((e=>{if(-1===["geometry"].indexOf(e.type)){const t=new s;t.fieldName=e.name,t.label=e.alias,t.visible=!1,p.push(t)}})),d.clear()),(null==t?void 0:t.expressionInfos)&&(null===(l=t.expressionInfos)||void 0===l||l.forEach((e=>{const t=`${o.f.expression}${e.name}`;if(c.has(t))p.push(c.get(t));else{const e=new s;e.fieldName=t,e.visible=!1,p.push(e)}}))),null===(r=null==t?void 0:t.fieldInfos)||void 0===r||r.forEach((e=>{-1!==e.fieldName.indexOf(o.f.relationship)&&p.push(e)})),i(p)}),(e=>{n(e)}))}))}(e,t),l=async(e,t,i)=>{var s,n;e.closePopup();let l=null;const p=(0,a.d)(t);if(p!==o.s.voxel&&(p!==o.s.scene||(null==t?void 0:t.associatedLayer)))return l=await r(e,t,i,p),l?("dockEnabled"in e.popup&&(e.popup.dockEnabled=!0),e.openPopup({features:[l],location:(null===(n=null===(s=l.geometry)||void 0===s?void 0:s.extent)||void 0===n?void 0:n.center)||l.geometry}),l):void 0},r=async(e,t,i,n)=>{var l,r,d,h,u,m,f,g,v,y,b;try{let P,C=null;if(n===o.s.ogcFeature){C=await e.whenLayerView(t);const[i]=await(0,s.l)(["esri/core/reactiveUtils"]);await i.whenOnce((()=>!C.updating))}else if(n===o.s.stream){C=await e.whenLayerView(t);const[i]=await(0,s.l)(["esri/core/reactiveUtils"]);await i.whenOnce((()=>!C.updating))}else C=t;if(n===o.s.imageryTile||n===o.s.wcs){const i=e.allLayerViews.find((e=>e.layer.id===t.id)),s=await i.fetchPopupFeaturesAtLocation(t.fullExtent.center);return null==s?void 0:s[0]}if(n===o.s.mapImage&&t.layer.version>=10.5&&!(null===(r=null===(l=t.layer.capabilities)||void 0===l?void 0:l.operations)||void 0===r?void 0:r.supportsQuery)&&(null===(h=null===(d=t.layer.capabilities)||void 0===d?void 0:d.operations)||void 0===h?void 0:h.supportsIdentify)){const i=await(0,a.h)(t,e);return i&&(i.sourceLayer=t),i}const k="isTable"in t&&t.isTable,I=C.createQuery();k||(I.geometry=e.center,I.distance=e.resolution),I.outFields=["*"];const w=await C.queryFeatures(I,{signal:i.signal});if(0===(null===(u=null==w?void 0:w.features)||void 0===u?void 0:u.length)){const s=C.createQuery();s.geometry=e.extent,s.outFields=["*"];const a=await C.queryFeatures(s,{signal:i.signal});if((null===(m=null==a?void 0:a.features)||void 0===m?void 0:m.length)>0)P=await c(a,e,t);else{const s=C.createQuery();s.where=C.definitionExpression||"1=1",s.outFields=["*"],((null===(g=null===(f=t.sourceJSON)||void 0===f?void 0:f.advancedQueryCapabilities)||void 0===g?void 0:g.supportsPagination)||n===o.s.ogcFeature)&&(s.start=0,s.num=1),s.outSpatialReference=e.spatialReference,P=null===(y=null===(v=await C.queryFeatures(s,{signal:i.signal}))||void 0===v?void 0:v.features)||void 0===y?void 0:y[0]}}else P=null===(b=null==w?void 0:w.features)||void 0===b?void 0:b[0];return P&&n===o.s.imagery&&(P=await p(t,P)),P}catch(e){console.log(e)}},p=async(e,t)=>{var i;const s=e.createQuery();s.outFields=["*"].concat(e.rasterFields.map((e=>e.name)).filter((e=>e.startsWith("Raster.")))),s.geometry=t.geometry,s.outSpatialReference=t.geometry.spatialReference;const o=await e.queryVisibleRasters(s,{returnTopmostRaster:!0,returnDomainValues:!0});return null!==(i=null==o?void 0:o[0])&&void 0!==i?i:t},c=async(e,t,i)=>{const o=await(0,a.j)(i);if("point"===o){let i=null;for(let s=0;s<e.features.length;s++){const o=e.features[s].geometry.distance(t.center);(0===s||(null==i?void 0:i[1])>o)&&(i=[e.features[s],o])}return i[0]}if("polyline"===o){let i=null;const[o]=await(0,s.l)(["esri/geometry/geometryEngine"]);for(let s=0;s<e.features.length;s++){const a=o.nearestVertex(e.features[s].geometry,t.center).distance;(0===s||(null==i?void 0:i[1])>a)&&(i=[e.features[s],a])}return i[0]}if("polygon"===o||"imagery"===(0,a.d)(i)){let i=null;for(let s=0;s<e.features.length;s++){const o=e.features[s].geometry.centroid.distance(t.center);(0===s||(null==i?void 0:i[1])>o)&&(i=[e.features[s],o])}return i[0]}return e.features[0]}}}]);