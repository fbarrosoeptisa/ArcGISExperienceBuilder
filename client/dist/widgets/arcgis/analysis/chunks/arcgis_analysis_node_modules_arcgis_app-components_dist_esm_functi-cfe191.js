/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_functi-cfe191.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_functi-cfe191"],{26408:(e,t,n)=>{n.d(t,{a:()=>c,b:()=>m,c:()=>r,d:()=>a,e:()=>l,f:()=>i,g:()=>u,h:()=>p,i:()=>f,m:()=>s,t:()=>o,u:()=>d});const a=(e,t)=>{let n,a="idle";const r=(...r)=>new Promise((i=>{switch(a){case"flushed":a="idle",n?(clearTimeout(n),i(e(...r))):i(null);break;case"invoked":clearTimeout(n),a="idle",i(e(...r));break;case"cancelled":clearTimeout(n),a="idle",i(null);break;default:n&&clearTimeout(n),a="pending",n=setTimeout((()=>(a="idle",i(e(...r)))),t)}}));return r.flush=function(...e){return a="flushed",r(...e)},r.invoke=function(...e){return a="invoked",r(...e)},r.cancel=function(...e){return a="cancelled",r(...e)},r.getStatus=function(){return a},r},r=(e,t)=>{let n;return(...a)=>new Promise((r=>{n||(n=setTimeout((()=>{clearTimeout(n),n=void 0,r(e(...a))}),t))}))};function i(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function l(e){return null!=e}async function s(e,t){return await Promise.all([e,o(t)]),e}function o(e){return new Promise((t=>setTimeout(t,e)))}const c=(e,t)=>Object.fromEntries((e||[]).map((e=>{const{key:n,data:a}=t(e);return[n,a]}))),u=(e,t)=>e.length===t.length&&e.reduce(((e,n)=>e&&t.indexOf(n)>-1),!0);function d(e,t){const n=[],a={};return e.forEach((e=>{const r=t(e);null==a[r]&&(a[r]=e,n.push(e))})),n}function m(e){const t={boolean:{},number:{},string:{}},n=[];return e.filter((e=>{let a=typeof e;return a in t?!t[a].hasOwnProperty(e)&&(t[a][e]=!0):!(n.indexOf(e)>=0)&&n.push(e)}))}const p=(e,t)=>[...Array(Math.ceil(e.length/t))].map(((n,a)=>e.slice(t*a,t+t*a))),f=(e,t)=>e.includes(t)},18991:(e,t,n)=>{n.d(t,{c:()=>o});var a=n(19564);const r=e=>!("isConnected"in e)||e.isConnected,i=((e,t)=>{let n;return(...a)=>{n&&clearTimeout(n),n=setTimeout((()=>{n=0,e(...a)}),t)}})((e=>{for(let t of e.keys())e.set(t,e.get(t).filter(r))}),2e3),l=e=>"function"==typeof e?e():e,s=(e,t)=>{const n=e.indexOf(t);n>=0&&(e[n]=e[e.length-1],e.length--)},o=(e,t)=>{const n=((e,t=(e,t)=>e!==t)=>{const n=l(e);let a=new Map(Object.entries(null!=n?n:{}));const r={dispose:[],get:[],set:[],reset:[]},i=()=>{var t;a=new Map(Object.entries(null!==(t=l(e))&&void 0!==t?t:{})),r.reset.forEach((e=>e()))},o=e=>(r.get.forEach((t=>t(e))),a.get(e)),c=(e,n)=>{const i=a.get(e);t(n,i,e)&&(a.set(e,n),r.set.forEach((t=>t(e,n,i))))},u="undefined"==typeof Proxy?{}:new Proxy(n,{get:(e,t)=>o(t),ownKeys:e=>Array.from(a.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(e,t)=>a.has(t),set:(e,t,n)=>(c(t,n),!0)}),d=(e,t)=>(r[e].push(t),()=>{s(r[e],t)});return{state:u,get:o,set:c,on:d,onChange:(t,n)=>{const a=d("set",((e,a)=>{e===t&&n(a)})),r=d("reset",(()=>n(l(e)[t])));return()=>{a(),r()}},use:(...e)=>{const t=e.reduce(((e,t)=>(t.set&&e.push(d("set",t.set)),t.get&&e.push(d("get",t.get)),t.reset&&e.push(d("reset",t.reset)),t.dispose&&e.push(d("dispose",t.dispose)),e)),[]);return()=>t.forEach((e=>e()))},dispose:()=>{r.dispose.forEach((e=>e())),i()},reset:i,forceUpdate:e=>{const t=a.get(e);r.set.forEach((n=>n(e,t,t)))}}})(e,t);return n.use((()=>{if("function"!=typeof a.g)return{};const e=new Map;return{dispose:()=>e.clear(),get:t=>{const n=(0,a.g)();n&&((e,t,n)=>{const a=e.get(t);a?a.includes(n)||a.push(n):e.set(t,[n])})(e,t,n)},set:t=>{const n=e.get(t);n&&e.set(t,n.filter(a.f)),i(e)},reset:()=>{e.forEach((e=>e.forEach(a.f))),i(e)}}})()),n}},56759:(e,t,n)=>{n.d(t,{a:()=>c,b:()=>V,c:()=>o,d:()=>L,e:()=>x,f:()=>s,g:()=>p,h:()=>g,i:()=>F,p:()=>S,u:()=>D,v:()=>C});var a=n(18991),r=n(9421),i=n(19564),l=n(91102);const s=(0,a.c)({totalFeatureCount:null,layer:null,mapView:null,originalField:null,numRecords:null,modules:null,strings:null,arcadeExecutor:null,filteredFeatureCount:null,currentScript:null,registeredResultId:null,arcadeSupported:null,invalidScript:null,isTable:null,autoPreviewEnabled:null,selectedLanguage:null,features:null,sqlEngine:null}).state;function o(e){e.totalFeatureCount=void 0,e.mapView=void 0,e.numRecords=void 0,e.layer=void 0,e.originalField=void 0,e.arcadeExecutor=void 0,e.filteredFeatureCount=void 0,e.currentScript=void 0,e.registeredResultId=void 0,e.arcadeSupported=void 0,e.invalidScript=void 0,e.isTable=void 0,e.autoPreviewEnabled=void 0,e.selectedLanguage=void 0,e.features=void 0,e.sqlEngine=void 0}async function c(e){const{isTable:t,layer:n,mapView:a}=s;if(!("fields"in n))return Promise.reject("getOneFeature: wrong layer type");if(t)return u(e);{const t=await a.whenLayerView(n),r="hasM"in n&&n.hasM,i="hasZ"in n&&n.hasZ,l=t.availableFields.length===n.fields.length&&!r&&!i;if("createQuery"in n&&l){const a=n.createQuery();a.start=0,a.num=5,a.outFields=["*"],a.returnGeometry=!0,a.outSpatialReference=n.spatialReference;const r=await t.queryFeatures(a);return r.features&&r.features.length?Promise.resolve(r):await u(e)}return await u(e)}}async function u(e){const{layer:t,modules:n}=s;if(!("queryFeatures"in t))return Promise.resolve(m(t,n));try{const a=await d(e);return a?Promise.resolve(a):Promise.resolve(m(t,n))}catch(e){}}async function d(e){var t,n;const{layer:a,modules:r}=s,i=new r.Query({outFields:["*"],where:e||"1=1",outSpatialReference:a.spatialReference,returnGeometry:!0,returnM:"hasM"in a&&a.hasM,returnZ:"hasZ"in a&&a.hasZ});return(null===(n=null===(t=a.sourceJSON)||void 0===t?void 0:t.advancedQueryCapabilities)||void 0===n?void 0:n.supportsPagination)&&(i.num=1),await a.queryFeatures(i)}function m(e,t){const n={};"fields"in e&&e.fields.forEach((e=>{e.defaultValue?n[e.name]=e.defaultValue:["small-integer","big-integer","integer","single","double","long","date","oid"].indexOf(e.type)>-1?n[e.name]=0:"date-only"===e.type?n[e.name]=null:n[e.name]=""}));const a=new t.Graphic({geometry:void 0,symbol:void 0,attributes:n});return new t.FeatureSet({features:[a],fields:[],geometryType:e.geometryType,spatialReference:"spatialReference"in e&&e.spatialReference.clone()})}async function p(e="1=1"){const{layer:t,modules:n}=s,a=new n.Query({where:e});return await t.queryFeatureCount(a)}function f(e,t){const{modules:n}=s;return null!=e?y(e,t,Object.assign(Object.assign({},n.intl.convertDateFormatToIntlOptions("short-date-short-time")),{timeZone:"system"})):null}function g(e,t=s.originalField){if(null===e)return e;const{domain:n}=t,a=["date-only","time-only","timestamp-offset"];if(t.domain){const r=function(e,t){if(!t)return null;if("range"===t.type)return e;if("coded-value"===t.type){const n=t.codedValues.filter((t=>t.hasOwnProperty("code")&&t.code===e));return n&&n.length?n[0].name:e}return null}(e,t.domain);return"date"===t.type&&"range"===n.type?f(r,t):b(t)&&"range"===n.type?h(e,t):a.includes(t.type)&&"range"===n.type?y(r,t):r}return"date"===t.type||a.includes(t.type)||["esri.arcade.arcadedate","esri.core.sql.timeonly","esri.core.sql.dateonly"].includes(e.declaredRootClass)||e.isLuxonDateTime||e._timeStampOffset?f(e,t):b(t)?h(e,t):e}function y(e,t,n){const{selectedLanguage:a}=s;return"Arcade"===a?function(e,t,n){const{modules:a}=s;switch(t.type){case"date":return["esri.arcade.arcadedate","esri.core.sql.dateonly"].includes(e.declaredRootClass)?a.intl.formatDate(e.toJSDate(),Object.assign(Object.assign({},a.intl.convertDateFormatToIntlOptions("short-date-short-time")),{timeZone:"system"})):a.intl.formatDate(e,n);case"date-only":return"esri.core.sql.dateonly"===e.declaredRootClass?a.intl.formatDateOnly(e.toStorageFormat(),n):a.intl.formatDateOnly(e,n);case"time-only":return"esri.core.sql.timeonly"===e.declaredRootClass?a.intl.formatTimeOnly(e.toStorageString(),n):a.intl.formatTimeOnly(e,n);case"timestamp-offset":return"esri.arcade.arcadedate"===e.declaredRootClass?a.intl.formatTimestamp(e.toISOString(),Object.assign(Object.assign({},a.intl.convertDateFormatToIntlOptions("short-date-short-time")),{timeZone:"system"})):a.intl.formatTimestamp(e,n);default:return null}}(e,t,n):function(e,t){const{currentScript:n,modules:a}=s;let r=Object.assign(Object.assign({},a.intl.convertDateFormatToIntlOptions("short-date-short-time")),{timeZone:"system"}),i=e;if("esri.core.sql.timeonly"===e.declaredRootClass&&"time-only"!==t.type)if(n.includes("CURRENT_TIME")){const{day:t,month:n,year:a}=function(e=!0){const t=new Date;return{day:e?t.getDate():t.getUTCDate(),month:(e?t.getMonth():t.getUTCMonth())+1,year:e?t.getFullYear():t.getUTCFullYear()}}();i=e.toUTCDateTime().set({day:t,month:n,year:a})}else i=e.toUTCDateTime().set({year:1900});else"esri.core.sql.dateonly"===e.declaredRootClass?(i=e.toUTCDateTime(),["time-only","string"].includes(t.type)||(i=i.toLocal())):i=e._timeStampOffset?e.toDateTime():(e.isLuxonDateTime||t.type,e);switch(t.type){case"date":return i.isLuxonDateTime&&(i=i.ts),a.intl.formatDate(i,r);case"date-only":return i.isLuxonDateTime&&(i=i.toString()),a.intl.formatDateOnly(i,r);case"time-only":return i.isLuxonDateTime?i.toFormat("h:mm a"):a.intl.formatTimeOnly(i,r);case"timestamp-offset":return a.intl.formatTimestamp(i,r);case"string":return r=Object.assign(Object.assign({},a.intl.convertDateFormatToIntlOptions("short-date-short-time")),{timeZone:"UTC"}),"esri.core.sql.dateonly"===e.declaredRootClass?i.isLuxonDateTime?n.includes("CURRENT_DATE")?i.toFormat("LLL d yyyy h:mm a"):i.toFormat("yyyy-LL-dd HH:mm:ss"):a.intl.formatDateOnly(e.toString(),r):"esri.core.sql.timeonly"===e.declaredRootClass?i.isLuxonDateTime?e.toFormat("HH:mm:ss"):e.toStorageString():e._timeStampOffset?e.toSQLValue():e.isLuxonDateTime?e.toFormat("yyyy-LL-dd HH:mm:ss"):a.intl.formatDate(i,r);default:return null}}(e,t)}function h(e,t){const{modules:n}=s;return["single","double","long"].includes(t.type)?n.intl.formatNumber(parseFloat(e),n.intl.convertNumberFormatToIntlOptions({digitSeparator:!1,places:2})):["integer","small-integer","big-integer"].includes(t.type)?n.intl.formatNumber(parseFloat(e),n.intl.convertNumberFormatToIntlOptions({digitSeparator:!1,places:0})):void 0}function b(e){return["integer","small-integer","big-integer","single","double"].includes(e.type)}const v={double:{min:-Infinity,max:Infinity},integer:{min:-2147483648,max:2147483647},single:{min:-3402823e32,max:3402823e32},"small-integer":{min:-32768,max:32767},"big-integer":{min:-9007199254740991,max:9007199254740991}};function F(e){return(0,r.i)(e)&&(e instanceof Date||["esri.arcade.arcadedate","esri.core.sql.timeonly","esri.core.sql.dateonly"].includes(e.declaredRootClass)||e._timeStampOffset||e.isLuxonDateTime)}function T(e,t,n){return n>=e&&n<=t}function w(e){const{originalField:t,strings:n}=s;return["esri.arcade.arcadedate","esri.core.sql.dateonly"].includes(e.declaredRootClass)||e.isLuxonDateTime||e._timeStampOffset?{isFieldValid:e.isValid}:{isFieldValid:!1,errorMessage:n.invalidFieldType.replace("${fieldType}",`${t.type}`)}}function E(e){const{originalField:t}=s;return(!["integer","small-integer","big-integer"].includes(t.type)||e===parseInt(e,10))&&("number"==typeof e&&!isNaN(e)&&e!==1/0&&e!==-1/0)}function O(e){const{originalField:t,strings:n}=s,a=v[t.type];return E(e)?T(a.min,a.max,e)?function(e){var t;const{originalField:n}=s;return"range"!==(null===(t=n.domain)||void 0===t?void 0:t.type)||T(n.domain.minValue,n.domain.maxValue,e)}(e)?{isFieldValid:!0}:{isFieldValid:!1,errorMessage:n.domainOutOfRange.replace("${min}",`${t.domain.minValue}`).replace("${max}",`${t.domain.maxValue}`)}:{isFieldValid:!1,errorMessage:n.outOfRange.replace("${fieldType}",t.type).replace("${min}",`${a.min}`).replace("${max}",`${a.max}`)}:{isFieldValid:!1,errorMessage:n.invalidFieldType.replace("${fieldType}",`${t.type}`)}}function V(e){const{originalField:t}=s;return null===e?t.nullable:void 0!==e}function C(e){const{strings:t,originalField:n}=s;if(null===e&&!isNaN(e))return n.nullable?{isFieldValid:!0}:{isFieldValid:!1,errorMessage:t.nullNotAllowed};if(function(e){return null!==e&&!F(e)&&("function"==typeof e||"object"==typeof e)}(e))return{isFieldValid:!1,errorMessage:t.cannotInsertObject.replace("${fieldType}",`${n.type||t.commonUndefined}`)};switch(n.type){case"string":return function(e){const{originalField:t,strings:n}=s;return(w(e)||E(e))&&e.toString().length<=t.length||"string"==typeof e&&e.length<=t.length?{isFieldValid:!0}:{isFieldValid:!1,errorMessage:n.stringLengthError.replace("${maxStringLength}",`${t.length}`)}}(e);case"double":case"integer":case"single":case"small-integer":case"big-integer":return O(e);case"date":case"timestamp-offset":return w(e);case"date-only":case"time-only":return function(e){const{originalField:t,strings:n}=s;let a=!1;return"date-only"===t.type?a="esri.core.sql.dateonly"===e.declaredRootClass?e.isValid:/[1-9][0-9][0-9]{2}-([0][1-9]|[1][0-2])-([1-2][0-9]|[0][1-9]|[3][0-1])/gm.test(e):"time-only"===t.type&&(a="esri.core.sql.timeonly"===e.declaredRootClass||/^(([0-1][0-9])|([2][0-3])):([0-5][0-9])(:[0-5][0-9](?:[.]\d{1,3})?)?$/gm.test(e)),{isFieldValid:a,errorMessage:a?null:n.invalidFieldType.replace("${fieldType}",`${t.type}`)}}(e);default:return{isFieldValid:!1,errorMessage:t.unexpectedValue}}}function x(e){const{features:t,layer:n,selectedLanguage:a,strings:r}=s,i=e.attributes[n.objectIdField];try{if("Arcade"===a)return function(e,t){const{arcadeExecutor:n,features:a,layer:r}=s;try{let i=n.execute({$feature:e,$datastore:r.url},{spatialReference:r.spatialReference,rawOutput:!0});const s=C(i);return/<\/?[a-z][\s\S]*>/i.test(i)&&(i=(0,l.s)(i)),a[t].calculatedValue=i,a[t].passed=s.isFieldValid,s.isFieldValid?a[t].error=null:a[t].error=s.errorMessage,i}catch(e){throw e}}(e,i);if("SQL"===a)return function(e,t){const{features:n,sqlEngine:a}=s;try{let r=a.calculateValue(e);const i=C(r);return/<\/?[a-z][\s\S]*>/i.test(r)&&(r=(0,l.s)(r)),n[t].calculatedValue=r,n[t].passed=i.isFieldValid,i.isFieldValid?n[t].error=null:n[t].error=i.errorMessage,r}catch(e){throw e}}(e,i)}catch(e){t[i].calculatedValue=null,t[i].error=r.calculationErrorGeneral,t[i].passed=!1}}async function L(e){const{arcadeExecutor:t,features:n,layer:a,strings:r}=s,i=e.attributes[a.objectIdField];try{let r=await t.executeAsync({$feature:e,$datastore:a.url},{spatialReference:a.spatialReference,rawOutput:!0});const s=C(r);return/<\/?[a-z][\s\S]*>/i.test(r)&&(r=(0,l.s)(r)),n[i].calculatedValue=r,n[i].passed=s.isFieldValid,s.isFieldValid?n[i].error=null:n[i].error=s.errorMessage,r}catch(e){n[i].calculatedValue=null,n[i].error=r.calculationErrorGeneral,n[i].passed=!1}}async function S(e){const{arcadeExecutor:t,features:n,invalidScript:a,layer:r,sqlEngine:l}=s,o=(e.attributes||e.graphic.attributes)[r.objectIdField];if(!n[o]){const e=await d(`${r.objectIdField} = ${o}`);n[o]={feature:e.features[0],tableFeature:!1,calculatedValue:void 0,passed:!1}}return!t&&!l||V(n[o].calculatedValue)||n[o].error||((null==t?void 0:t.isAsync)?await L(n[o].feature):await x(n[o].feature)),a?function(){const{strings:e}=s,t=document.createElement("div");return t.style.textAlign="center",t.innerHTML=`<img class="popup-icon" src=${(0,i.a)("././assets/arcgis-field-calculate-icons/alert-48.svg")}></img>\n  <calcite-label>${e.popupError}</calcite-label>`,t}():V(n[o].calculatedValue)||n[o].error?function(e){const{arcadeExecutor:t,features:n,layer:a,originalField:r,strings:i,sqlEngine:l}=s,o={};for(const t in e)o[t.toLowerCase()]=e[t];const c=document.createElement("div"),u=e[a.objectIdField];if(n[u].error){const e=document.createElement("calcite-label");e.layout="inline";const t=document.createElement("calcite-icon");t.classList.add("popup-error-icon"),t.icon="exclamation-mark-triangle",e.append(t),e.append(n[u].error),c.append(e)}const d=V(n[u].calculatedValue)&&!n[u].error||F(n[u].calculatedValue)?g(n[u].calculatedValue):n[u].calculatedValue,m=document.createElement("calcite-table");m.caption=d;const p=document.createElement("calcite-table-row"),f=document.createElement("calcite-table-header");f.heading=r.alias,p.appendChild(f),m.appendChild(p);const y=document.createElement("calcite-table-row"),h=document.createElement("calcite-table-cell");h.innerHTML=d,y.appendChild(h),m.appendChild(y),c.appendChild(m),c.appendChild(document.createElement("br"));let b=[];const v=t?t.fieldsUsed:l?l.fieldNames:[];if(v.forEach((e=>{if(!Object.keys(o).includes(e.toLowerCase()))return;const t=document.createElement("calcite-table-row"),n=document.createElement("calcite-table-cell");n.innerHTML=e;const r=document.createElement("calcite-table-cell");r.innerHTML=g(o[e.toLowerCase()],a.fields.find((t=>t.name.toLowerCase()===e.toLowerCase()))),t.append(n,r),b.push(t)})),b.length){const e=document.createElement("calcite-label");e.innerHTML=i.fieldsInCalculation;const t=document.createElement("calcite-table");t.bordered=!0,t.append(...b),e.append(t),c.append(e)}return c}(n[o].feature.attributes):function(){const{strings:e}=s,t=document.createElement("div");return t.style.textAlign="center",t.innerHTML=`<img class="popup-icon" src=${(0,i.a)("././assets/arcgis-field-calculate-icons/edit-48.svg")}></img>\n  <calcite-label>${e.popupPreview}</calcite-label>`,t}()}function D(){var e;const{layer:t,mapView:n,modules:a}=s;(null===(e=null==n?void 0:n.popup)||void 0===e?void 0:e.visible)&&(t.popupTemplate=new a.PopupTemplate({title:t.displayField?`{${t.displayField}}`:`{${t.objectIdField}}`,content:S,lastEditInfoEnabled:!1}))}}}]);