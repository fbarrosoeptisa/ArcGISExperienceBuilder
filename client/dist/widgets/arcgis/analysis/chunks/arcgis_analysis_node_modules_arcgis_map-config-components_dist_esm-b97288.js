/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-b97288.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-b97288"],{20819:(e,t,i)=>{i.r(t),i.d(t,{arcgis_sketch_layer_editor:()=>p});var s=i(28614),o=i(98450),r=i(68180),h=i(48843),c=i(97127),n=i(50063),l=i(71480),a=i(62200);class d{constructor(e,t,i,s,o,r,h){this.mapNotesLayer=e,this.mapView=t,this.sketchViewModelPoint=new i({layer:this.mapNotesLayer.pointLayer??void 0,view:this.mapView,defaultCreateOptions:{hasZ:!1,mode:"hybrid"},updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},snappingOptions:s,tooltipOptions:o}),this.sketchViewModelPoint.on("create",(e=>r(e,this.sketchViewModelPoint))),this.sketchViewModelPoint.on("update",(e=>h(e))),this.sketchViewModelLine=new i({layer:this.mapNotesLayer.polylineLayer??void 0,view:this.mapView,defaultCreateOptions:{hasZ:!1,mode:"hybrid"},updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},snappingOptions:s,tooltipOptions:o}),this.sketchViewModelLine.on("create",(e=>r(e,this.sketchViewModelLine))),this.sketchViewModelLine.on("update",(e=>h(e))),this.sketchViewModelPolygon=new i({layer:this.mapNotesLayer.polygonLayer??void 0,view:this.mapView,defaultCreateOptions:{hasZ:!1,mode:"hybrid"},updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},snappingOptions:s,tooltipOptions:o}),this.sketchViewModelPolygon.on("create",(e=>r(e,this.sketchViewModelPolygon))),this.sketchViewModelPolygon.on("update",(e=>h(e))),this.sketchViewModelText=new i({layer:this.mapNotesLayer.textLayer??void 0,view:this.mapView,defaultCreateOptions:{hasZ:!1,mode:"hybrid"},updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},snappingOptions:s,tooltipOptions:o}),this.sketchViewModelText.on("create",(e=>r(e,this.sketchViewModelText))),this.sketchViewModelText.on("update",(e=>h(e)))}updateOnGraphicClick(e,t){this.hitTestHandle?.remove(),e&&(this.hitTestHandle=this.mapView.on("click",(async e=>{const i=(await this.mapView.hitTest(e,{include:this.mapNotesLayer})).results;if(i.length){const e=["point","polyline","polygon"];i.sort(((t,i)=>e.indexOf(t.graphic.geometry.type)-e.indexOf(i.graphic.geometry.type)));const t=i[0].graphic;switch(t.layer){case this.mapNotesLayer.pointLayer:await this.updatePoint([t]);break;case this.mapNotesLayer.textLayer:await this.updateText([t]);break;case this.mapNotesLayer.polylineLayer:await this.updateLine([t]);break;case this.mapNotesLayer.polygonLayer:await this.updatePolygon([t]);break;default:return}}else t&&t({state:"complete"})})))}duplicate(){this._duplicatePoint(),this._duplicateLine(),this._duplicatePolygon(),this._duplicateText()}delete(){this._deletePoint(),this._deleteLine(),this._deletePolygon(),this._deleteText()}cancel(){this._cancelPoint(),this._cancelLine(),this._cancelPolygon(),this._cancelText()}destroy(){this._destroyPoint(),this._destroyLine(),this._destroyPolygon(),this._destroyText()}getPointSVM(){return this.sketchViewModelPoint}getPoint(){return this.sketchViewModelPoint.pointSymbol}setPoint(e){this.sketchViewModelPoint.pointSymbol=e}createPoint(){this.sketchViewModelPoint.create("point")}async updatePoint(e){await this.sketchViewModelPoint.update(e)}_duplicatePoint(){this.sketchViewModelPoint.duplicate()}_deletePoint(){this.sketchViewModelPoint.delete()}_cancelPoint(){this.sketchViewModelPoint.cancel()}_destroyPoint(){this.sketchViewModelPoint.destroy()}getLineSVM(){return this.sketchViewModelLine}getLine(){return this.sketchViewModelLine.polylineSymbol}setLine(e){this.sketchViewModelLine.polylineSymbol=e}createLine(){this.sketchViewModelLine.create("polyline")}async updateLine(e){await this.sketchViewModelLine.update(e)}_duplicateLine(){this.sketchViewModelLine.duplicate()}_deleteLine(){this.sketchViewModelLine.delete()}_cancelLine(){this.sketchViewModelLine.cancel()}_destroyLine(){this.sketchViewModelLine.destroy()}getPolygonSVM(){return this.sketchViewModelPolygon}getPolygon(){return this.sketchViewModelPolygon.polygonSymbol}setPolygon(e){this.sketchViewModelPolygon.polygonSymbol=e}createPolygon(e){this.sketchViewModelPolygon.create(e)}async updatePolygon(e){await this.sketchViewModelPolygon.update(e)}_duplicatePolygon(){this.sketchViewModelPolygon.duplicate()}_deletePolygon(){this.sketchViewModelPolygon.delete()}_cancelPolygon(){this.sketchViewModelPolygon.cancel()}_destroyPolygon(){this.sketchViewModelPolygon.destroy()}getTextSVM(){return this.sketchViewModelText}getText(){return this.sketchViewModelText.pointSymbol}setText(e){this.sketchViewModelText.pointSymbol=e}createText(){this.sketchViewModelText.create("point")}async updateText(e){await this.sketchViewModelText.update(e)}_duplicateText(){this.sketchViewModelText.duplicate()}_deleteText(){this.sketchViewModelText.delete()}_cancelText(){this.sketchViewModelText.cancel()}_destroyText(){this.sketchViewModelText.destroy()}}const p=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.sketchUpdated=(0,s.c)(this,"sketchUpdated",7),this.arcgisContentReRender=(0,s.c)(this,"arcgisContentReRender",7),this.sketchContentReRender=(0,s.c)(this,"sketchContentReRender",7),this.arcgisCopyToNewSketchLayer=(0,s.c)(this,"arcgisCopyToNewSketchLayer",7),this.arcgisSketchCopyToNewSketchLayer=(0,s.c)(this,"arcgisSketchCopyToNewSketchLayer",7),this.arcgisRecentColorsUpdate=(0,s.c)(this,"arcgisRecentColorsUpdate",7),this.arcgisClose=(0,s.c)(this,"arcgisClose",7),this.arcgisSketchDismissedChange=(0,s.c)(this,"arcgisSketchDismissedChange",7),this.arcgisInternalSketchUpdated=(0,s.c)(this,"arcgisInternalSketchUpdated",7),this.arcgisDisablePanel=(0,s.c)(this,"arcgisDisablePanel",7),this.manager=(0,c.u)(this),this.strings=(0,n.u)({blocking:!0}),this.sketchLayerEditorState=(0,o.u)(),this.sketchMode="update",this.escKey=!1,this.deleteInProgress=!1,this.keepSelectionMessage="",this.keepSelectionTool=void 0,this.needsMapViewHandles=!1,this.onGraphicUpdate=async e=>{if("start"===e.state)if(this.mapView.closePopup(),this.multipleSelectedGraphics.length<=1&&1===e.graphics.length)this.currentSketchInfo.graphics=[e.graphics[0]],this.currentSketchInfo.symbol=this.currentSketchInfo.graphics[0].symbol,this.currentSketchInfo.tool=(0,o.g)(this.currentSketchInfo.graphics[0]),this.currentSketchInfo.title=this.currentSketchInfo.graphics[0].attributes?.title||this.getDefaultGraphicTitle(),this.currentSketchInfo.popup=this.currentSketchInfo.graphics[0].popupTemplate??void 0,this.multipleSelectedGraphics.length||this.multipleSelectedGraphics.push(this.currentSketchInfo.graphics[0]),await(this.sketchContentEl?.rerender()),this.showSketchContent=!0,this.sketchContentReRender.emit(),this.arcgisContentReRender.emit();else if(this.multipleSelectedGraphics.length){this.currentSketchInfo.graphics=this.multipleSelectedGraphics,this.currentSketchInfo.symbol=this.currentSketchInfo.graphics[0].symbol,this.currentSketchInfo.tool=(0,o.g)(this.currentSketchInfo.graphics[0]);const e=this.currentSketchInfo.graphics[0].attributes?.title||this.getDefaultGraphicTitle(),t=this.currentSketchInfo.graphics.every((t=>t.attributes?.title===e)),i=this.currentSketchInfo.graphics[0].popupTemplate,s=this.currentSketchInfo.graphics.every((e=>JSON.stringify(e.popupTemplate)===JSON.stringify(i)));this.currentSketchInfo.title=t?e:void 0,this.currentSketchInfo.popup=s?i??void 0:void 0,await(this.sketchContentEl?.rerender()),this.showSketchContent=!0,this.sketchContentReRender.emit(),this.arcgisContentReRender.emit()}else this.updateSketchMessage(void 0);if("complete"===e.state){const{keepSelectionTool:e}=this,t=e!==this.sketchToolsEl.activeSelectTool;!e||t?(this.currentSketchInfo.graphics=void 0,this.multipleSelectedGraphics=[],this.closeSketchPopovers(),this.arcgisInternalSketchUpdated.emit(),await(this.sketchContentEl?.rerender()),this.sketchContentReRender.emit(),this.arcgisContentReRender.emit()):this.deleteInProgress||this.keepSelectToolSelection()}},this.mapView=void 0,this.layer=void 0,this.portal=void 0,this.dismissible=!1,this.showSketchToolsOnly=!1,this.activeSketchTool=void 0,this.sketchToolsToHide=[],this.hideSelectionTools=!1,this.sketchToolsReferenceElement=void 0,this.selectedSketchFeaturesFeatures=void 0,this.snappingSessionStorageIds=void 0,this.sketchTooltipSessionStorageIds=void 0,this.hideSvgUploadSymbols=!1,this.hideAddStyles=!1,this.store=(0,a.c)({mapView:void 0,portal:void 0,layer:void 0,strings:void 0,currentLanguage:"",sketchMessage:"",sketchLayerEditorSVModel:void 0,snappingOptions:void 0,sketchTooltipOptions:void 0,snappingSessionStorageIds:void 0,sketchTooltipSessionStorageIds:void 0}),this.currentSketchInfo={tool:void 0,symbol:void 0,graphics:void 0,popup:void 0,title:void 0,sourceIds:{}},this.multipleSelectedGraphics=[],this.showSketchContent=!0}arcgisPanelLoaderHandler(e){e.stopPropagation(),this.sketchFlowItemEl.loading=e.detail}arcgisInternalSketchUpdatedHandler(e){e.stopPropagation(),this.sketchUpdated.emit(),this.arcgisChange.emit()}arcgisDisablePanelHandler(e){e.stopPropagation(),this.sketchFlowItemEl.disabled=e.detail}async arcgisActiveSymbolChangeHandler(){await(this.sketchContentEl?.rerender()),this.sketchContentReRender.emit(),this.arcgisContentReRender.emit()}arcgisGraphicUpdatesHandler(e){e.stopPropagation();const t=e.detail;if("symbol"===t.type&&t.symbolSwitchFromRecent){const e=(0,o.a)(this.currentSketchInfo.symbol.clone())?.toHex();e&&this.arcgisRecentColorsUpdate.emit(e)}if("update"===this.sketchMode&&this.currentSketchInfo.graphics?.length){const e=this.currentSketchInfo.graphics.length>1,i=this.currentSketchInfo.graphics[0].symbol.clone(),s=this.currentSketchInfo.symbol.clone(),h=this.getSymbolProps(i),c=this.getSymbolProps(s);this.currentSketchInfo.graphics.forEach(((i,s)=>{if("title"===t.type)i.attributes?this.currentSketchInfo.graphics[s].attributes.title=this.currentSketchInfo.title:this.currentSketchInfo.graphics[s].attributes={title:this.currentSketchInfo.title};else if("popup"===t.type)this.currentSketchInfo.graphics[s].popupTemplate=this.currentSketchInfo.popup;else if("symbol"===t.type)if(!e||t.symbolSwitchFromRecent){const e=this.currentSketchInfo.symbol.clone();"recent-text"===t.textProp&&(e.text=this.currentSketchInfo.graphics[s].symbol.clone().text),this.currentSketchInfo.graphics[s].symbol=e}else if(t.symbolSwitch){const e=this.currentSketchInfo.graphics[s].symbol.clone(),t=this.currentSketchInfo.symbol.clone(),i=this.getSymbolProps(e),h=this.getSymbolProps(t);(0,r.i)(i.size)&&(0,r.i)(h.size)&&(0,o.b)(t,i.size),(0,r.i)(i.rotation)&&(0,r.i)(h.rotation)&&(0,o.c)(t,i.rotation),this.currentSketchInfo.graphics[s].symbol=t}else{const e=this.currentSketchInfo.graphics[s].symbol.clone(),i=this.getSymbolProps(e);if(h.size!==c.size&&(0,o.b)(e,c.size),h.rotation!==c.rotation&&(0,o.c)(e,c.rotation),JSON.stringify(h.color)!==JSON.stringify(c.color)&&(h.color.a===c.color.a?(i.color.r=c.color.r,i.color.g=c.color.g,i.color.b=c.color.b):i.color.a=c.color.a,(0,o.d)(e,i.color)),(0,r.i)(h.outline)&&(0,r.i)(c.outline)&&JSON.stringify(h.outline)!==JSON.stringify(c.outline)){const t=h.outline.width===c.outline.width,s=h.outline.color.a===c.outline.color.a;t?s?(i.outline.color.r=c.outline.color.r,i.outline.color.g=c.outline.color.g,i.outline.color.b=c.outline.color.b):i.outline.color.a=c.outline.color.a:i.outline.width=c.outline.width,(0,o.e)(e,i.outline)}if(JSON.stringify(h.outlineStyle)!==JSON.stringify(c.outlineStyle)&&e.outline&&(e.outline.style=c.outlineStyle),JSON.stringify(h.strokeStyle)!==JSON.stringify(c.strokeStyle)&&(e.style=c.strokeStyle),JSON.stringify(h.marker)!==JSON.stringify(c.marker)&&(e.marker=c.marker),t.textProp){const i=this.currentSketchInfo.symbol.clone();switch(t.textProp){case"text":e.text=i.text;break;case"font":e.font.family=i.font.family,e.font.weight=i.font.weight,e.font.style=i.font.style;break;case"font-size":e.font.size=i.font.size;break;case"color":e.color.r=i.color.r,e.color.g=i.color.g,e.color.b=i.color.b;break;case"color-transparency":e.color.a=i.color.a;break;case"rotation":e.angle=i.angle;break;case"halo":e.haloColor=i.haloColor,e.haloSize=i.haloSize;break;case"halo-color":e.haloColor?(e.haloColor.r=i.haloColor.r,e.haloColor.g=i.haloColor.g,e.haloColor.b=i.haloColor.b):e.haloColor=i.haloColor;break;case"halo-color-transparency":e.haloColor&&(e.haloColor.a=i.haloColor.a);break;case"halo-size":e.haloSize=i.haloSize;break;case"background":e.backgroundColor=i.backgroundColor,e.borderLineColor=i.borderLineColor,e.borderLineSize=i.borderLineSize;break;case"background-color":e.backgroundColor?(e.backgroundColor.r=i.backgroundColor.r,e.backgroundColor.g=i.backgroundColor.g,e.backgroundColor.b=i.backgroundColor.b):e.backgroundColor=i.backgroundColor;break;case"background-color-transparency":e.backgroundColor&&(e.backgroundColor.a=i.backgroundColor.a);break;case"border-line-color":e.borderLineColor?(e.borderLineColor.r=i.borderLineColor.r,e.borderLineColor.g=i.borderLineColor.g,e.borderLineColor.b=i.borderLineColor.b):(e.backgroundColor=i.backgroundColor,e.borderLineColor=i.borderLineColor,e.borderLineSize=i.borderLineSize);break;case"border-line-color-transparency":e.borderLineColor&&(e.borderLineColor.a=i.borderLineColor.a);break;case"border-line-size":e.borderLineSize=i.borderLineSize}}this.currentSketchInfo.graphics[s].symbol=e}}))}else this.tempCreatedGraphic&&(this.tempCreatedGraphic.attributes?this.tempCreatedGraphic.attributes.title=this.currentSketchInfo.title:this.tempCreatedGraphic.attributes={title:this.currentSketchInfo.title},this.tempCreatedGraphic.popupTemplate=this.currentSketchInfo.popup,this.tempCreatedGraphic.symbol=this.currentSketchInfo.symbol);this.currentSketchInfo.graphics?.[0]&&this.mapView.popup&&(this.mapView.popup.features=[this.currentSketchInfo.graphics[0]]),this.setCurrentSketchSymbol(),this.arcgisInternalSketchUpdated.emit()}async setFocus(e){"dismiss-button"!==e||this.dismissButtonEl?.setFocus()}async done(){this.removeHighlight(),this.snappingSessionStorageIds?.current&&(0,o.s)(this.snappingOptions,this.snappingSessionStorageIds.current),this.sketchTooltipSessionStorageIds?.current&&(0,o.f)(this.sketchTooltipOptions,this.sketchTooltipSessionStorageIds.current),this.closeSketchPopovers(),this.sketchLayerEditorSVModel.destroy(),this.sketchToolsEl?.remove(),this.sketchToolsEl=void 0,this.removeSketchShortcuts(),this.mapView.popupEnabled=!0}async activateLayer(e,t){if(this.sketchLayerEditorSVModel?.destroy(),this.sketchLayerEditorSVModel?.updateOnGraphicClick(!1),this.layer=e,this.initializeSessionStorageOptions(),this.initializeSVModel(),t?.length){const e=t.map((e=>e.clone()));let i=[],s=[],r=[],h=[];e.forEach((e=>{switch((0,o.g)(e)){case"point":e.layer=this.layer.pointLayer,i=[...i,e];break;case"polyline":e.layer=this.layer.polylineLayer,s=[...s,e];break;case"polygon":e.layer=this.layer.polygonLayer,r=[...r,e];break;default:e.layer=this.layer.textLayer,h=[...h,e]}})),this.currentSketchInfo.graphics=e,this.updateCurrentSketchInfo(),setTimeout((()=>{this.multipleSelectedGraphics=[...i,...s,...r,...h],i.length&&this.sketchLayerEditorSVModel.updatePoint(i),s.length&&this.sketchLayerEditorSVModel.updateLine(s),r.length&&this.sketchLayerEditorSVModel.updatePolygon(r),h.length&&this.sketchLayerEditorSVModel.updateText(h),this.sketchMode="update"}),300)}}async updateSketchTools(){this.sketchToolsEl&&(this.sketchToolsEl.sketchToolsToHide=this.sketchToolsToHide,this.sketchToolsEl.hideSelectionTools=this.hideSelectionTools,this.sketchToolsEl.activeSketchTool=this.activeSketchTool)}async componentWillLoad(){this.currentLanguage=this.strings._t9nLocale;const{sketchLayerEditorState:e}=this;await this.loadAllModules(),this.initializeSessionStorageOptions(),this.initializeSVModel(),e.sketchLayerEditorSVModel=this.sketchLayerEditorSVModel,e.mapView=this.mapView,e.layer=this.layer,e.portal=this.portal,e.strings=this.strings,e.currentLanguage=this.currentLanguage,e.snappingOptions=this.snappingOptions,e.sketchTooltipOptions=this.sketchTooltipOptions,e.snappingSessionStorageIds=this.snappingSessionStorageIds,e.sketchTooltipSessionStorageIds=this.sketchTooltipSessionStorageIds,this.selectedSketchFeaturesFeatures?.length&&(this.multipleSelectedGraphics=this.selectedSketchFeaturesFeatures.filter((e=>(0,r.i)(e))),this.currentSketchInfo.graphics=this.multipleSelectedGraphics,this.updateCurrentSketchInfo())}componentDidLoad(){this.needsMapViewHandles&&(this.mapView.focus(),this.watchDeleteOnMapView(!0),this.watchEscapeOnMapView(!0)),this.mapView.popupEnabled=!1,this.createSketchTools()}disconnectedCallback(){this.watchEscapeOnMapView(!1),this.watchDeleteOnMapView(!1),this.removeSketchShortcuts(),this.removeSketchShortcutsTooltip(),this.selectorOperation?.cancel(),this.sketchLayerEditorSVModel.updateOnGraphicClick(!1)}render(){const{showSketchToolsOnly:e}=this;return(0,s.h)(s.H,{key:"172a9c90c9b978f6846bcf027510ae61ae9c2e79",class:"calcite-match-height"},!e&&this.renderSketchFlowPanel())}renderSketchFlowPanel(){const{sketchLayerEditorState:e,currentSketchInfo:t,showSketchContent:i,dismissible:o}=this,{strings:r,layer:h}=e;return(0,s.h)("calcite-flow",{ref:e=>this.flowEl=e},(0,s.h)("calcite-flow-item",{ref:e=>this.sketchFlowItemEl=e,heading:r.sketch,disabled:!h.capabilities.operations.supportsMapNotesEditing},o&&this.renderDismissButton(),this.renderShortcutAndSnapping(),this.renderSketchMessage(),t.graphics?.length?(0,s.h)("div",{class:"multiple-selection"},this.renderSelectionMultipleLabel(),(0,s.h)("div",{id:"multiple-selection-buttons",class:"buttons"},this.renderDuplicateMultiple(),this.renderCopyToNewSketchLayer(),this.renderDeleteMultiple())):null,i&&(0,s.h)("arcgis-sketch-layer-editor-content",{currentSketchInfo:t,flowEl:this.flowEl,symbolStylerRefElement:this.dismissButtonEl,hideSvgUploadSymbols:this.hideSvgUploadSymbols,hideAddStyles:this.hideAddStyles,ref:e=>this.sketchContentEl=e})))}renderDismissButton(){return(0,s.h)("calcite-action",{text:"close",icon:"x",slot:"header-actions-end",ref:e=>this.dismissButtonEl=e,onClick:e=>{e.stopPropagation(),this.updateSketchMessage(void 0),this.sketchLayerEditorSVModel.cancel(),this.clearHighlightAndPopup(),this.arcgisSketchDismissedChange.emit(),this.arcgisClose.emit()}})}renderShortcutAndSnapping(){const{sketchLayerEditorState:e}=this,{strings:t}=e;return(0,s.h)("div",{class:"snapping",ref:e=>this.shortcutSnappingEl=e},(0,s.h)("calcite-button",{class:"snapping-controls-button",alignment:"icon-end-space-between",appearance:"outline-fill",kind:"neutral",width:"full",iconStart:"gear",iconEnd:"chevron-down",label:t.sketchSettings,onClick:e=>{e.stopPropagation(),this.sketchSnappingEl||(this.sketchSnappingEl=document.createElement("arcgis-sketch-layer-editor-snapping"),this.sketchSnappingEl.sketchLayerEditorState=this.sketchLayerEditorState,this.sketchSnappingEl.refElement=this.shortcutSnappingEl,this.sketchSnappingEl.addEventListener("arcgisCloseSnappingPopovers",(()=>this.closeSnappingPopovers())),document.body.appendChild(this.sketchSnappingEl),this.arcgisDisablePanel.emit(!0))}},t.sketchSettings),(0,s.h)("calcite-button",{appearance:"outline-fill",class:"sketch-keyboard-button",kind:"neutral",iconStart:"keyboard",label:t.sketchShortcuts,onClick:()=>{this.removeSketchShortcutsTooltip(),this.arcgisSketchLayerEditorShortcutsEl||(this.arcgisSketchLayerEditorShortcutsEl=document.createElement("arcgis-sketch-layer-editor-shortcuts"),this.arcgisSketchLayerEditorShortcutsEl.sketchLayerEditorState=this.sketchLayerEditorState,this.arcgisSketchLayerEditorShortcutsEl.refElement=this.shortcutSnappingEl,document.body.appendChild(this.arcgisSketchLayerEditorShortcutsEl),this.arcgisSketchLayerEditorShortcutsEl.addEventListener("arcgisClose",(()=>this.removeSketchShortcuts())))},onMouseOver:()=>this.addSketchShortcutsTooltip(),onMouseOut:()=>this.removeSketchShortcutsTooltip(),ref:e=>this.sketchShortcutsButtonEl=e}))}renderSketchMessage(){const{sketchLayerEditorState:e}=this,{sketchMessage:t}=e,{currentSketchInfo:i}=this;return!(!t||i.graphics&&i.graphics.length>1)?(0,s.h)("div",{class:"sketch-message"},(0,s.h)("calcite-notice",{width:"full",open:!0},(0,s.h)("div",{slot:"message"},t))):(0,s.h)(s.F,null)}renderSelectionMultipleLabel(){const{sketchLayerEditorState:e,currentSketchInfo:t}=this,{strings:i}=e;return(0,s.h)("calcite-label",{alignment:"center",for:"multiple-selection-buttons"},t.graphics&&t.graphics.length<=1?i.singleFeatureSelected:i.featuresSelected.replace("${number}",t.graphics.length.toString()))}renderDuplicateMultiple(){const{sketchLayerEditorState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{appearance:"outline-fill",alignment:"center",iconStart:"duplicate",kind:"neutral",width:"full",onClick:e=>{e.stopPropagation(),this.sketchLayerEditorSVModel.duplicate(),this.offsetDuplicatedFeatures()}},t.duplicate)}renderCopyToNewSketchLayer(){const{sketchLayerEditorState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{appearance:"outline-fill",alignment:"center",iconStart:"copy",kind:"neutral",width:"full",onClick:e=>{e.stopPropagation();const t=this.currentSketchInfo.graphics.map((e=>e.clone()));this.arcgisSketchCopyToNewSketchLayer.emit({features:t}),this.arcgisCopyToNewSketchLayer.emit({features:t})}},t.copyToNewSketchLayer)}renderDeleteMultiple(){const{sketchLayerEditorState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{appearance:"outline-fill",alignment:"center",iconStart:"trash",kind:"danger",width:"full",onClick:e=>{e.stopPropagation();const{sketchLayerEditorSVModel:t}=this;this.deleteInProgress=!0,t.delete(),this.deleteInProgress=!1,this.multipleSelectedGraphics=[],this.keepSelectToolSelection()}},t.delete)}async loadAllModules(){await h.e.load();const[e,t,i,s,o,r,c,n]=await Promise.all([(0,l.y)(),(0,l.C)(),(0,l.s)(),(0,l.D)(),(0,l.B)(),(0,l.E)(),(0,l.A)(),(0,l.F)()]);this.modules={SketchViewModel:e,TextSymbol:t,ColorUtils:i,CIMSymbol:s,SnappingOptions:o,SketchTooltipOptions:r,drawUtils:c,SelectionOperation:n}}initializeSessionStorageOptions(){const{modules:e,layer:t,mapView:i,snappingSessionStorageIds:s,sketchTooltipSessionStorageIds:r}=this;this.snappingOptions=(0,o.h)(s,t,i,e.SnappingOptions),this.sketchTooltipOptions=(0,o.i)(r,e.SketchTooltipOptions)}initializeSVModel(){const{modules:e}=this;this.sketchLayerEditorSVModel=new d(this.layer,this.mapView,e.SketchViewModel,this.snappingOptions,this.sketchTooltipOptions,((e,t)=>this.onGraphicCreate(e,t)),this.onGraphicUpdate)}updateCurrentSketchInfo(){this.currentSketchInfo.symbol=this.currentSketchInfo.graphics[0].symbol,this.currentSketchInfo.tool=(0,o.g)(this.currentSketchInfo.graphics[0]);const e=this.currentSketchInfo.graphics[0].attributes?.title||this.getDefaultGraphicTitle(),t=this.currentSketchInfo.graphics.every((t=>t.attributes?.title===e)),i=this.currentSketchInfo.graphics[0].popupTemplate,s=this.currentSketchInfo.graphics.every((e=>JSON.stringify(e.popupTemplate)===JSON.stringify(i)));this.currentSketchInfo.title=t?e??void 0:void 0,this.currentSketchInfo.popup=s?i??void 0:void 0,this.showSketchContent=!0,this.sketchLayerEditorSVModel.updateOnGraphicClick(!0,this.onGraphicUpdate),this.needsMapViewHandles=!0}setCurrentSketchSymbol(){const{currentSketchInfo:e}=this;"point"===e.tool?this.sketchLayerEditorSVModel.setPoint(e.symbol):"polyline"===e.tool?this.sketchLayerEditorSVModel.setLine(e.symbol):["circle","polygon","rectangle"].includes(e.tool)?this.sketchLayerEditorSVModel.setPolygon(e.symbol):"text"===e.tool&&this.sketchLayerEditorSVModel.setText(e.symbol)}getDefaultGraphicTitle(){const{sketchLayerEditorState:e,currentSketchInfo:t}=this,{strings:i}=e;switch(t.tool){case"point":default:return i.point;case"polyline":return i.line;case"polygon":return i.polygon;case"rectangle":return i.rectangle;case"circle":return i.circle;case"text":return i.text}}createSketchTools(){const{sketchLayerEditorState:e}=this;this.sketchToolsEl=document.createElement("arcgis-sketch-layer-editor-tools"),this.sketchToolsEl.sketchLayerEditorState=e,this.sketchToolsEl.sketchToolsToHide=this.sketchToolsToHide,this.sketchToolsEl.activeSketchTool=this.activeSketchTool,this.sketchToolsEl.hideSelectionTools=this.hideSelectionTools,this.sketchToolsEl.refElement=this.sketchToolsReferenceElement??this.el,this.selectedSketchFeaturesFeatures&&(this.sketchToolsEl.mapNotesFeatures=this.selectedSketchFeaturesFeatures,this.sketchToolsEl.activeSelectTool=1===this.multipleSelectedGraphics.length?"select":"rectangle"),this.sketchToolsEl.addEventListener("arcgisActionOnSelectFeatures",(async e=>{const t=e.detail.sketchMessage,i=e.detail.multipleSelectTool;await this.handleSelectFeatures(t,i)})),this.sketchToolsEl.addEventListener("arcgisActionOnDrawFeatures",(async e=>{const t=e.detail.sketchMessage,i=e.detail.tool;await this.handleDrawFeatures(t,i)})),document.body.appendChild(this.sketchToolsEl),this.sketchContentEl&&!this.sketchContentEl.symbolStylerRefElement&&(this.sketchContentEl.symbolStylerRefElement=this.dismissButtonEl)}clearHighlightAndPopup(){const{mapView:e}=this;this.removeHighlight(),e.closePopup()}highlightGraphic(e){const{mapView:t}=this;this.removeHighlight();const i=t.allLayerViews?.items.find((({layer:e})=>e===this.layer));this.createdGraphicHighlightHandle=i?.highlight(e)}removeHighlight(){this.createdGraphicHighlightHandle?.remove(),this.createdGraphicHighlightHandle=void 0}watchEscapeOnMapView(e){e&&!this.watchEscapeHandle?this.watchEscapeHandle=this.mapView.on("key-down",(e=>{"Escape"!==e.key||"active"!==this.sketchLayerEditorSVModel.getPointSVM().state&&"active"!==this.sketchLayerEditorSVModel.getLineSVM().state&&"active"!==this.sketchLayerEditorSVModel.getPolygonSVM().state&&"active"!==this.sketchLayerEditorSVModel.getTextSVM().state||(e.stopPropagation(),this.escKey=!0,this.sketchLayerEditorSVModel.cancel())})):(this.watchEscapeHandle?.remove(),this.watchEscapeHandle=void 0)}watchDeleteOnMapView(e){e&&!this.watchDeleteHandle?this.watchDeleteHandle=this.mapView.on("key-down",(e=>{"Delete"!==e.key&&"Backspace"!==e.key||(this.deleteInProgress=!0,this.sketchLayerEditorSVModel.delete(),this.deleteInProgress=!1,this.keepSelectToolSelection())})):(this.watchDeleteHandle?.remove(),this.watchDeleteHandle=void 0)}onGraphicCreate(e,t){if("start"===e.state&&(this.tempCreatedGraphic=void 0,this.removeHighlight()),"cancel"===e.state&&this.escKey){this.escKey=!1;const e="text"===this.currentSketchInfo.tool?"point":this.currentSketchInfo.tool;t.create(e)}if("complete"===e.state){e.graphic&&(this.arcgisInternalSketchUpdated.emit(),e.graphic.popupTemplate=this.currentSketchInfo.popup,e.graphic.attributes={title:this.currentSketchInfo.title},this.currentSketchInfo.graphics=[e.graphic],this.tempCreatedGraphic=e.graphic,this.highlightGraphic(e.graphic));const i="text"===this.currentSketchInfo.tool?"point":this.currentSketchInfo.tool;t.create(i)}}async handleSelectFeatures(e,t){const{sketchLayerEditorSVModel:i,currentSketchInfo:s,selectedSketchFeaturesFeatures:o,selectorOperation:r}=this;this.keepSelectionMessage=e,this.keepSelectionTool=t,this.clearHighlightAndPopup(),this.watchEscapeOnMapView(!1),this.closeSketchPopovers(),this.updateSketchMessage(this.keepSelectionMessage),this.tempCreatedGraphic=void 0,s.graphics=void 0,s.symbol=void 0,s.tool=void 0,o?.length||(this.watchDeleteOnMapView(!1),this.multipleSelectedGraphics=[]),this.sketchMode="update",i.cancel(),this.keepSelectionTool?this.actionOnMultipleSelections(this.keepSelectionTool):(r?.cancel(),i.updateOnGraphicClick(!0)),await(this.sketchContentEl?.rerender()),this.sketchContentReRender.emit(),this.arcgisContentReRender.emit()}async handleDrawFeatures(e,t){const{sketchLayerEditorState:i,modules:s}=this,{strings:r}=i;switch(this.clearHighlightAndPopup(),this.watchEscapeOnMapView(!0),this.watchDeleteOnMapView(!1),this.updateSketchMessage(e),"update"===this.sketchMode&&this.closeSketchPopovers(),this.sketchMode="continuous",this.sketchLayerEditorSVModel.cancel(),this.sketchLayerEditorSVModel.updateOnGraphicClick(!1),this.tempCreatedGraphic=void 0,this.currentSketchInfo.graphics=void 0,this.currentSketchInfo.tool=t,t){case"point":this.sketchLayerEditorSVModel.setPoint(await(0,o.m)(s.CIMSymbol,this.mapView,s.ColorUtils)),this.currentSketchInfo.symbol=this.sketchLayerEditorSVModel.getPoint(),this.sketchLayerEditorSVModel.createPoint();break;case"polyline":this.sketchLayerEditorSVModel.setLine(await(0,o.l)(this.mapView,s.ColorUtils)),this.currentSketchInfo.symbol=this.sketchLayerEditorSVModel.getLine(),this.sketchLayerEditorSVModel.createLine();break;case"polygon":case"rectangle":case"circle":this.sketchLayerEditorSVModel.setPolygon(await(0,o.k)(this.mapView,s.ColorUtils)),this.currentSketchInfo.symbol=this.sketchLayerEditorSVModel.getPolygon(),this.sketchLayerEditorSVModel.createPolygon(t);break;case"text":this.sketchLayerEditorSVModel.setText(await(0,o.j)(this.mapView,s.ColorUtils,s.TextSymbol,r.textContentPlaceholder)),this.currentSketchInfo.symbol=this.sketchLayerEditorSVModel.getText(),this.sketchLayerEditorSVModel.createText()}this.currentSketchInfo.popup=void 0,this.currentSketchInfo.title=this.getDefaultGraphicTitle(),await(this.sketchContentEl?.rerender(t)),this.showSketchContent=!0,this.sketchContentReRender.emit(t),this.arcgisContentReRender.emit(t)}getSymbolProps(e){return{size:(0,o.n)(e),rotation:(0,o.o)(e),color:(0,o.a)(e),outline:(0,o.p)(e),outlineStyle:e.outline?.style,strokeStyle:e.style,marker:e.marker}}actionOnMultipleSelections(e){const{mapView:t,modules:i}=this;this.selectedSketchFeaturesFeatures=void 0;const s=[this.layer.pointLayer,this.layer.polylineLayer,this.layer.polygonLayer,this.layer.textLayer],r="rectangle"===e?{createTool:"rectangle"}:{createTool:"polygon",mode:"freehand"},h=new i.SelectionOperation.createSelectionOperation(t,s,r);this.selectorOperation=h,h.once("complete",(e=>{const{selection:t}=e;if(this.clearHighlightAndPopup(),!e.aborted&&t.length){let e=[],i=[],s=[],r=[];t.forEach((t=>{switch((0,o.g)(t)){case"point":default:e=[...e,t];break;case"polyline":i=[...i,t];break;case"polygon":s=[...s,t];break;case"text":r=[...r,t]}})),this.multipleSelectedGraphics=[...e,...i,...s,...r],e.length&&this.sketchLayerEditorSVModel.updatePoint(e),i.length&&this.sketchLayerEditorSVModel.updateLine(i),s.length&&this.sketchLayerEditorSVModel.updatePolygon(s),r.length&&this.sketchLayerEditorSVModel.updateText(r),this.watchDeleteOnMapView(!0)}})),this.sketchLayerEditorSVModel.updateOnGraphicClick(!1)}offsetDuplicatedFeatures(){const{modules:e,mapView:t}=this;this.multipleSelectedGraphics.forEach((i=>e.drawUtils.move(i.geometry,15*t.resolution,15*t.resolution)));let i=[],s=[],r=[],h=[];this.selectedSketchFeaturesFeatures=this.multipleSelectedGraphics,this.multipleSelectedGraphics.forEach((e=>{switch((0,o.g)(e)){case"polyline":s=[...s,e];break;case"polygon":r=[...r,e];break;case"text":h=[...h,e];break;default:i=[...i,e]}})),this.currentSketchInfo.graphics=this.multipleSelectedGraphics,i.length&&this.sketchLayerEditorSVModel.updatePoint(i),s.length&&this.sketchLayerEditorSVModel.updateLine(s),r.length&&this.sketchLayerEditorSVModel.updatePolygon(r),h.length&&this.sketchLayerEditorSVModel.updateText(h)}keepSelectToolSelection(){this.sketchToolsEl.activeSelectTool&&this.handleSelectFeatures(this.keepSelectionMessage,this.keepSelectionTool)}updateSketchMessage(e){const{sketchLayerEditorState:t}=this;t.sketchMessage=e}removeSketchShortcuts(){this.arcgisSketchLayerEditorShortcutsEl&&(this.arcgisSketchLayerEditorShortcutsEl.removeEventListener("arcgisClose",(()=>this.removeSketchShortcuts())),document.body.removeChild(this.arcgisSketchLayerEditorShortcutsEl),this.arcgisSketchLayerEditorShortcutsEl=void 0)}addSketchShortcutsTooltip(){const{sketchLayerEditorState:e}=this,{strings:t}=e,i=document.createElement("calcite-tooltip");i.referenceElement=this.sketchShortcutsButtonEl,i.open=!0,i.innerHTML=t.sketchShortcuts,this.sketchShortcutsTooltipEl=i,document.body.append(i)}removeSketchShortcutsTooltip(){this.sketchShortcutsTooltipEl&&(this.sketchShortcutsTooltipEl.parentElement?.removeChild(this.sketchShortcutsTooltipEl),this.sketchShortcutsTooltipEl=void 0)}closeSketchPopovers(){this.sketchToolsEl.activeSelectTool&&"select"!==this.sketchToolsEl.activeSelectTool&&this.updateSketchMessage(void 0),this.showSketchContent=!1,this.closeSnappingPopovers(),this.removeSketchShortcuts(),this.setFocus()}closeSnappingPopovers(){this.sketchSnappingEl&&(document.body.removeChild(this.sketchSnappingEl),this.sketchSnappingEl=void 0,this.arcgisDisablePanel.emit(!1)),this.setFocus()}static get assetsDirs(){return["assets"]}get el(){return(0,s.g)(this)}};p.style=":host {\n  display: flex;\n  flex: 1 1 auto;\n  overflow: hidden;\n}\n\n.snapping {\n  display: flex;\n  padding: var(--calcite-spacing-sm);\n  background-color: var(--calcite-color-foreground-1);\n}\n\n.snapping-controls-button {\n  min-width: 0px;\n}\n\n.sketch-message {\n  padding: var(--calcite-spacing-sm);\n}\n\n.sketch-keyboard-button {\n  margin-left: 0.3em;\n}\n\n.multiple-selection {\n  margin: 1em;\n}\n\n.multiple-selection calcite-button {\n  margin-top: 0.3em;\n}\n\n:dir(rtl) {\n  .sketch-keyboard-button {\n    margin-left: unset;\n    margin-right: 0.3em;\n  }\n}\n"},62200:(e,t,i)=>{i.d(t,{c:()=>n});var s=i(28614);const o=e=>!("isConnected"in e)||e.isConnected,r=((e,t)=>{let i;return(...s)=>{i&&clearTimeout(i),i=setTimeout((()=>{i=0,e(...s)}),t)}})((e=>{for(let t of e.keys())e.set(t,e.get(t).filter(o))}),2e3),h=e=>"function"==typeof e?e():e,c=(e,t)=>{const i=e.indexOf(t);i>=0&&(e[i]=e[e.length-1],e.length--)},n=(e,t)=>{const i=((e,t=(e,t)=>e!==t)=>{const i=h(e);let s=new Map(Object.entries(null!=i?i:{}));const o={dispose:[],get:[],set:[],reset:[]},r=()=>{var t;s=new Map(Object.entries(null!==(t=h(e))&&void 0!==t?t:{})),o.reset.forEach((e=>e()))},n=e=>(o.get.forEach((t=>t(e))),s.get(e)),l=(e,i)=>{const r=s.get(e);t(i,r,e)&&(s.set(e,i),o.set.forEach((t=>t(e,i,r))))},a="undefined"==typeof Proxy?{}:new Proxy(i,{get:(e,t)=>n(t),ownKeys:e=>Array.from(s.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(e,t)=>s.has(t),set:(e,t,i)=>(l(t,i),!0)}),d=(e,t)=>(o[e].push(t),()=>{c(o[e],t)});return{state:a,get:n,set:l,on:d,onChange:(t,i)=>{const s=d("set",((e,s)=>{e===t&&i(s)})),o=d("reset",(()=>i(h(e)[t])));return()=>{s(),o()}},use:(...e)=>{const t=e.reduce(((e,t)=>(t.set&&e.push(d("set",t.set)),t.get&&e.push(d("get",t.get)),t.reset&&e.push(d("reset",t.reset)),t.dispose&&e.push(d("dispose",t.dispose)),e)),[]);return()=>t.forEach((e=>e()))},dispose:()=>{o.dispose.forEach((e=>e())),r()},reset:r,forceUpdate:e=>{const t=s.get(e);o.set.forEach((i=>i(e,t,t)))}}})(e,t);return i.use((()=>{if("function"!=typeof s.d)return{};const e=new Map;return{dispose:()=>e.clear(),get:t=>{const i=(0,s.d)();i&&((e,t,i)=>{const s=e.get(t);s?s.includes(i)||s.push(i):e.set(t,[i])})(e,t,i)},set:t=>{const i=e.get(t);i&&e.set(t,i.filter(s.f)),r(e)},reset:()=>{e.forEach((e=>e.forEach(s.f))),r(e)}}})()),i}},50063:(e,t,i)=>{i.d(t,{u:()=>r});var s=i(97127),o=i(28614);const r=(0,s.m)(o.a)}}]);