"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-35c337"],{60567:(e,t,a)=>{a.d(t,{F:()=>i,N:()=>o,R:()=>s});const i={Mosaic:0,Item:1,ItemGroup:2},s={CORE:"CORE",STANDARD:"STANDARD"},o={INTEGER:"integer",FLOAT:"float"}},89186:(e,t,a)=>{function i(e){void 0!==e&&(e.open=!1,e.remove())}function s(e,t){!1===e.body.contains(t)&&(e.body.appendChild(t),t.open=!0)}function o(e,t){const{helpUrl:a,helpId:o,heading:r,referenceElement:n,portal:l,helpSrcdoc:d,helpFileName:c,learnMoreUrl:h,offsetDistance:m,offsetSkidding:p}=t;return void 0!==e&&(i(e),e=void 0),e=function(e){const{helpUrl:t,helpId:a,heading:i,referenceElement:s,portal:o,helpSrcdoc:r,learnMoreUrl:n,placement:l,offsetDistance:d,offsetSkidding:c}=e,h=document.createElement("rfx-help-popover");return h.helpUrl=t,h.helpId=a,h.heading=i,h.referenceElement=s,h.placement=l??"leading-start",h.portal=o,h.helpSrcdoc=r,h.learnMoreUrl=n,void 0!==d&&(h.offsetDistance=d),void 0!==c&&(h.offsetSkidding=c),h}({helpUrl:a,helpId:o,heading:r,referenceElement:n,portal:l,helpSrcdoc:d,helpFileName:c,learnMoreUrl:h,offsetDistance:m,offsetSkidding:p}),s(document,e),e}function r(e,t){const{referenceElement:a,label:o,direction:r,offsetDistance:n,offsetSkidding:l,showPropertiesAction:d,showRenameAction:c,handleNodeDuplicate:h,handleNodeRename:m,handleNodeDelete:p,handleNodeEditProperties:f}=t;void 0!==e&&(i(e),e=void 0),e=document.createElement("calcite-popover");const u={overlayPositioning:"fixed",autoClose:!0,dir:r,focusTrapDisabled:!0,triggerDisabled:!0,pointerDisabled:!0,placement:"bottom",closable:!1,open:!0,referenceElement:a,label:o,offsetDistance:n,offsetSkidding:l};Object.assign(e,u);const v=document.createElement("rfx-node-interaction-toolbar"),g={showPropertiesAction:d,showRenameAction:c,handleNodeDuplicate:h,handleNodeRename:m,handleNodeDelete:p,handleNodeEditProperties:f};return Object.assign(v,g),e.append(v),s(document,e),setTimeout((()=>requestAnimationFrame((()=>{e.open=!0}))),1),e}a.d(t,{c:()=>r,r:()=>i,s:()=>o})},81790:(e,t,a)=>{a.d(t,{R:()=>i});const i={header:"header",content:"content"}},22680:(e,t,a)=>{a.r(t),a.d(t,{rfx_editor_app:()=>O,rfx_editor_header_actions:()=>V});var i=a(6225),s=a(33752),o=a(91177),r=a(42776),n=a(25286),l=a(76529),d=a(22493),c=a(74229),h=(a(23795),a(17902),a(56451),a(93210)),m=a(17078),p=a(33968),f=a(37465),u=a(89186),v=a(61556),g=a(40861),C=a(60567),x=a(81790);a(5294),a(13661),a(18423),a(21255),a(35431),a(588),a(55448),a(2924),a(11840),a(52373),a(440),a(66744),a(44345),a(71802),a(32513),a(36596);function y(e,t){return(0,d.p)(t)?e:{...e,thumbnailEx:t.thumbnail,name:t.name,description:t.description??"",functionType:t.functionType,definition:t.definitionQuery,properties:t.properties}}function b(e){if((0,d.p)(e))return void console.warn("RFT Handler get RFT Blob: No model provided.");let t=JSON.stringify(e,null,2);t=t.replaceAll(/\??token=[^&"]+?\"/g,'"');return new Blob([t],{type:"text/json"})}const T="new-template",E="open-template",S="add-function",I="add-constant",R="add-raster",w="edit-template-properties",F="host",P="content",k="overlay-element",D="overlay-panel",L="list-wrapper",M="panel",N="arcgis--rtl",A="action-bar",O=class{constructor(e){(0,i.r)(this,e),this.analysisRFTLaunch=(0,i.c)(this,"analysisRFTLaunch",7),this.analysisTemplateSaved=(0,i.c)(this,"analysisTemplateSaved",7),this.analysisTemplateNameChanged=(0,i.c)(this,"analysisTemplateNameChanged",7),this.analysisRFTEditorClose=(0,i.c)(this,"analysisRFTEditorClose",7),this.analysisRFTFailedToLoad=(0,i.c)(this,"analysisRFTFailedToLoad",7),this.analysisRFTLoaded=(0,i.c)(this,"analysisRFTLoaded",7),this.analysisRFTItemCreated=(0,i.c)(this,"analysisRFTItemCreated",7),this.rftItemDetailsLinkClicked=(0,i.c)(this,"rftItemDetailsLinkClicked",7),this.analysisDeprecatedFunctionFound=(0,i.c)(this,"analysisDeprecatedFunctionFound",7),this.rfxCoreServices={diagramZoomInCommand:void 0,diagramZoomOutCommand:void 0,diagramAutoLayoutCommand:void 0,diagramStretchCommand:void 0,diagramPanCommand:void 0,diagramSelectCommand:void 0,addRFxFunctionCommand:void 0,addRasterNodeCommand:void 0,addScalarNodeCommand:void 0,addRFTPortalItemCommand:void 0,addRFTJSONCommand:void 0,getModelCommand:void 0,getDehydratedModelCommand:void 0,refreshDiagramViewCommand:void 0,deleteSelectedItemsCommand:void 0,getModelDisplayDataCommand:void 0},this.headerElement=null,this.overlayElementsConfig={leftToolBar:{slot:"left",visible:!0,builder:()=>(({handleDiagramZoomIn:e,handleDiagramZoomOut:t,handleDiagramAutoLayout:a,handleDiagramStretch:s,handleDiagramSelect:o,handleDiagramPan:n,handleDiagramDeleteSelected:l,slot:d,scale:c=r.C.s})=>(0,i.h)("div",{slot:d},(0,i.h)("rfx-diagram-interaction-toolbar",{handleDiagramZoomIn:e,handleDiagramZoomOut:t,handleDiagramAutoLayout:a,handleDiagramStretch:s,handleDiagramSelect:o,handleDiagramPan:n,handleDiagramDeleteSelected:l,scale:c})))({handleDiagramZoomIn:this.handleDiagramZoomIn,handleDiagramZoomOut:this.handleDiagramZoomOut,handleDiagramAutoLayout:this.handleDiagramAutoLayout,handleDiagramStretch:this.handleDiagramStretch,handleDiagramSelect:this.handleDiagramSelect,handleDiagramPan:this.handleDiagramPan,handleDiagramDeleteSelected:this.handleDiagramDeleteSelected,slot:"left",scale:this.scale}),type:"static"},rightToolBar:{slot:"right",visible:!0,builder:()=>(({handleRFTLaunch:e,handleRFTSave:t,handleRFTSaveAs:a,handleOpenTemplateEditor:s,handleRFTShare:o,slot:n,templateId:l,scale:d=r.C.s})=>(0,i.h)("div",{slot:n},(0,i.h)("rfx-rft-interaction-toolbar",{handleRFTLaunch:e,handleRFTSave:t,handleRFTSaveAs:a,handleOpenTemplateEditor:s,handleRFTShare:o,templateId:l,scale:d})))({handleRFTLaunch:this.handleRFTLaunch,handleRFTSave:this.handleRFTSave,handleRFTSaveAs:this.handleRFTSaveAs,handleOpenTemplateEditor:this.handleOpenTemplateEditor,handleRFTShare:this.handleRFTShare,slot:"right",templateId:this.rftItemId,scale:this.scale}),type:"static"},rfxListView:{slot:"left",visible:!1,builder:({addRasterFunctionTitle:e})=>(({slot:e,handleTriggerSelectFunction:t,handlePanelClose:a,heading:s})=>(0,i.h)("div",{slot:e,class:L},(0,i.h)("rfx-panel",{heading:s,closable:!0,showFooter:!1,closed:!1,class:{[k]:!0,[D]:!0},onCalcitePanelClose:a},(0,i.h)("rfx-list-view",{mode:C.R.CORE,onTriggerSelectFunction:t}))))({slot:"left",heading:e,handleTriggerSelectFunction:this.handleRFxListViewTriggerSelectFunction,handlePanelClose:this.handleRFxListViewPanelClose}),type:"static"}},this.showUnsavedChangesDialog=e=>void 0!==this.closeWithoutSavingModalElement?Promise.resolve(!1):new Promise((t=>{const a=document.createElement("rfx-close-without-saving-modal");a.rftTitle=e.rftProperties?.name||this.strings.newTemplate,a.handleCancel=()=>{a.remove(),this.closeWithoutSavingModalElement=void 0,t(!1)},a.handleDontSave=()=>{a.remove(),this.closeWithoutSavingModalElement=void 0,this.clearState(),t(!0)},a.handleSave=async()=>{a.remove(),this.closeWithoutSavingModalElement=void 0;const e=this.getTemplateInfo(this.rftItemId);if(void 0!==e?.portalItem&&!0===e?.canUpdateItem){try{await this.handleRFTSave(),this.analysisRFTEditorClose.emit()}catch{t(!1)}d.L.entryPoint===l.E.ITEM&&t(!0)}else t(await this.handleRFTSaveAs())},this.closeWithoutSavingModalElement=a,document.body.appendChild(a)})),this.showCloseWithoutSavingModal=(e,t)=>{const a=this.getTemplateInfo(),i=document.createElement("rfx-close-without-saving-modal");i.rftTitle=a.rftProperties?.name||this.strings.newTemplate,i.handleCancel=()=>{i.remove(),this.closeWithoutSavingModalElement=void 0},i.handleDontSave=e??this.handleDontSaveClick,i.handleSave=t??this.handleRFTSaveOnClose,this.closeWithoutSavingModalElement=i,document.body.appendChild(i)},this.handleRFTSaveOnClose=()=>{this.handleRFTSaveAs(),this.closeWithoutSavingModalElement.remove(),this.closeWithoutSavingModalElement=void 0},this.initializeRFxEditorCore=e=>{const t=e;var a;this.rfxEditorCoreElement=e,this.rfxCoreServices.diagramZoomInCommand=(a=t,{execute:async()=>{await a.zoomIn()}}),this.rfxCoreServices.diagramZoomOutCommand=(e=>({execute:async()=>{await e.zoomOut()}}))(t),this.rfxCoreServices.diagramAutoLayoutCommand=(e=>({execute:async()=>{await e.autoLayout()}}))(t),this.rfxCoreServices.diagramStretchCommand=(e=>({execute:async()=>{await e.stretch()}}))(t),this.rfxCoreServices.diagramPanCommand=(e=>({execute:async()=>{await e.pan()}}))(t),this.rfxCoreServices.diagramSelectCommand=(e=>({execute:async()=>{await e.select()}}))(t),this.rfxCoreServices.addRFxFunctionCommand=(e=>({execute:async t=>{await e.addRFxFunction(t)}}))(t),this.rfxCoreServices.addRasterNodeCommand=(e=>({execute:async t=>{const{value:a}=t||{};await e.addRasterNode({value:a})}}))(t),this.rfxCoreServices.addScalarNodeCommand=(e=>({execute:async t=>{const{value:a}=t||{};await e.addScalarNode({value:a})}}))(t),this.rfxCoreServices.addRFTPortalItemCommand=(e=>({execute:async t=>await e.addRFTPortalItem(t)}))(t),this.rfxCoreServices.addRFTJSONCommand=(e=>({execute:async t=>await e.addRFTJSON(t)}))(t),this.rfxCoreServices.getModelCommand=(e=>({execute:async()=>await e.getModel()}))(t),this.rfxCoreServices.getDehydratedModelCommand=(e=>({execute:async t=>await e.getDehydratedModel(t)}))(t),this.rfxCoreServices.refreshDiagramViewCommand=(e=>({execute:async()=>{await e.refreshDiagramView()}}))(t),this.rfxCoreServices.deleteSelectedItemsCommand=(e=>({execute:async()=>{await e.deleteSelected()}}))(t),this.rfxCoreServices.getModelDisplayDataCommand=(e=>({execute:async()=>{const{displayData:t}=await e.getModelDisplayData()||{};return t}}))(t)},this.handleNewTemplateClick=()=>{if(!0===this.getTemplateInfo(this.rftItemId).hasUnsavedChanges){const e=()=>{this.closeWithoutSavingModalElement?.remove(),this.closeWithoutSavingModalElement=void 0,this.clearState()};this.showCloseWithoutSavingModal(e)}else this.clearState()},this.handleOpenTemplateClick=()=>{const{portal:e}=this;this.itemBrowserElement=(0,v.a)({modalStrings:{header:this.strings.browseRFT},portal:e,user:e.user,filter:'(type: "Raster function template")',cardMessageOverrides:{preview:this.strings.previewDetails},onClose:this.closeItemBrowser,onSelection:this.handleItemBrowserSelection}),document.body.appendChild(this.itemBrowserElement)},this.handleItemBrowserSelection=async e=>{if(null!==e.detail){const t=e.detail.id;await this.loadRFT(t)}},this.loadRFT=async e=>{try{const t=await this.rfxCoreServices.addRFTPortalItemCommand.execute(e),a=this.getTemplateInfo();if(void 0!==a.rftJSON||!1!==a.hasUnsavedChanges&&void 0!==a.hasUnsavedChanges||!this.isPortalItem())a.hasUnsavedChanges=!0;else{const i=await this.rfxCoreServices.getDehydratedModelCommand.execute(t);i.sourceItemId=e,a.rftJSON=i,a.rftProperties=function(e){if((0,d.p)(e))return;const{name:t,description:a,thumbnailEx:i,functionType:s,definition:o,properties:r}=e;return{name:t,description:a,thumbnail:i,functionType:s,definitionQuery:o,properties:r}}(a.rftJSON),void 0===a.portalItem&&await this.updateTemplateInfoPortalItem(a,e),this.analysisTemplateNameChanged.emit(a.rftProperties.name)}this.updateActiveRFTList(a),this.analysisRFTLoaded.emit({id:e,data:a.rftJSON})}catch(t){this.analysisRFTFailedToLoad.emit(e)}},this.addToActiveRFTList=e=>{void 0===d.L.activeRFxTemplates.find((t=>t.id===e.id))&&(d.L.activeRFxTemplates=[...d.L.activeRFxTemplates,e])},this.updateActiveRFTList=e=>{d.L.activeRFxTemplates=d.L.activeRFxTemplates.map((t=>t.id===e.id?e:t))},this.updateTemplateInfoPortalItem=async(e,t)=>{const a=new s.default({id:t,portal:d.L.portal});await a.load(),this.updateTemplateInfoWithPortalItem(e,a)},this.updateTemplateInfoWithPortalItem=(e,t)=>{e.portalItem=t,e.canUpdateItem="admin"===t.itemControl||"update"===t.itemControl,0===t?.size&&(e.rftProperties={name:t.title,description:t.snippet,thumbnail:t.thumbnailUrl}),this.updateActiveRFTList(e)},this.createRfxDetailsEditor=({detailsEditorRfxTemplate:e,detailsEditorRfxSchema:t,detailsEditorRfxNode:a})=>{const i=(0,o.C)(e,this.translatedRFTNamesMap,!0)??e?.name,s=document.createElement("div");s.setAttribute("style","display: flex; width: 28rem; justify-content: space-between;"),s.slot="header",this.headerElement=s;const r=document.createElement("span");r.setAttribute("style","display: flex; align-items: center;"),r.innerHTML=i,this.header=i;const n=document.createElement("calcite-action");let l;n.label="",n.text="",n.icon="information",n.onclick=this.handleRFxDetailsEditorHeadingHelpClick(e,i),s.appendChild(r),s.appendChild(n);let c=!0;!0===d.L.isViewerUserType&&(l={secondary:this.strings.close},c=!1);const h=(({rfxTemplate:e,mapLayers:t,portal:a,schema:i,title:s,labels:o,showPrimaryButton:r,handlePanelClose:n,handlePanelOk:l,handlePanelCancel:d,headerElementComponent:c,header:h,createLayerBrowse:m,mapView:p})=>{const f=document.createElement("rfx-details-editor");f.rfxTemplate=e,f.schema=i,f.mapLayers=t,f.portal=a,f.mapView=p,f.addEventListener("rfxDetailsEditorBrowseLayerClick",m),f.header=h;const u=(0,v.c)("rfx-modal","",{open:!0});u.labels=o,u.showPrimaryButton=r,u.setAttribute("style","--calcite-dialog-size-y: 32rem"),u.addEventListener("rfxModalClose",(()=>{n()})),u.addEventListener("rfxModalPrimaryClick",(async()=>{const e=await f.okClicked();l({rfxTemplate:e})})),u.addEventListener("rfxModalSecondaryClick",(()=>{d()})),u.appendChild(c);const g=document.createElement("div");return g.slot=x.R.content,g.appendChild(f),u.appendChild(g),u})({rfxTemplate:e,schema:t,title:i,header:this.header,labels:l,showPrimaryButton:c,mapLayers:this.mapLayers,portal:this.portal,mapView:this.mapView,createLayerBrowse:this.createLayerBrowse,handlePanelClose:()=>{h.remove()},handlePanelOk:e=>{const{rfxTemplate:t}=e;a?.read(t),h.remove()},handlePanelCancel:()=>{h.remove()},headerElementComponent:s});document.body.appendChild(h)},this.createLayerBrowse=e=>{const t=e.detail;let a=(0,v.a)({modalStrings:{header:this.strings.selectLayer},portal:this.portal,user:this.portal.user,filter:t.filter||'(type: "Image Service")',selectionMode:"multi"===t.selectionMode?"multiple-sublayer":"single-sublayer",hideFilters:!1,onClose:()=>{a.remove(),a=void 0},onSelection:e=>{this.updateLayerValue(t.isFeatureSelectElement,t.referenceElement,e)}});document.body.appendChild(a)},this.updateLayerValue=(e,t,a)=>{if(null!==a.detail&&void 0!==a.detail){const e=a.detail;t.updateBrowsedLayer(e)}},this.handleAddFunctionClick=()=>{this.visibilityReducer({key:"rfxListView",visible:!0})},this.handleAddConstantClick=e=>{const{value:t}=e||{},a=this.getTemplateInfo();this.rfxCoreServices.addScalarNodeCommand.execute({value:t}),a.hasUnsavedChanges=!0,this.updateActiveRFTList(a)},this.handleAddRasterClick=e=>{const{value:t}=e||{},a=this.getTemplateInfo();this.rfxCoreServices.addRasterNodeCommand.execute({value:t}),a.hasUnsavedChanges=!0,this.updateActiveRFTList(a)},this.handleDontSaveClick=()=>{this.handleCloseClick(),this.closeWithoutSavingModalElement?.remove(),this.closeWithoutSavingModalElement=void 0},this.handleRunClick=()=>{},this.handleSaveClick=()=>{},this.handleCloseClick=()=>{this.clearState(),this.analysisRFTEditorClose.emit()},this.clearState=()=>{d.L.activeRFxTemplates=d.L.activeRFxTemplates.filter((e=>e.id!==this.rftItemId)),this.rfxEditorCoreElement.clearAll(),this.analysisTemplateNameChanged.emit()},this.handleDiagramZoomIn=()=>{this.rfxCoreServices.diagramZoomInCommand.execute()},this.handleDiagramZoomOut=()=>{this.rfxCoreServices.diagramZoomOutCommand.execute()},this.handleDiagramAutoLayout=()=>{this.rfxCoreServices.diagramAutoLayoutCommand.execute()},this.handleDiagramStretch=()=>{this.rfxCoreServices.diagramStretchCommand.execute()},this.handleDiagramPan=()=>{this.rfxCoreServices.diagramPanCommand.execute()},this.handleDiagramDeleteSelected=()=>{this.rfxCoreServices.deleteSelectedItemsCommand.execute()},this.handleRFTLaunch=async()=>{try{let e=await this.rfxCoreServices.getModelCommand.execute();const t=this.getTemplateInfo();e=(0,d.p)(t.rftProperties)?{...e,name:this.strings.defaultTemplateName,description:""}:y(e,t.rftProperties),void 0!==t.portalItem&&(e.sourceItemId=t.portalItem.id);const a=()=>{this.closeWithoutSavingModalElement?.remove(),this.closeWithoutSavingModalElement=void 0,this.analysisRFTLaunch.emit(e)},i=()=>{this.handleRFTSaveOnClose()};void 0!==e&&(!0===t.hasUnsavedChanges?(this.showCloseWithoutSavingModal(a,i),t.rftJSON=e):this.analysisRFTLaunch.emit(e))}catch{this.showErrorModal()}},this.handleDiagramSelect=()=>{this.rfxCoreServices.diagramSelectCommand.execute()},this.handleRFTSave=async()=>{const e=this.getTemplateInfo();try{let t=await this.rfxCoreServices.getModelCommand.execute();t=y(t,e.rftProperties),e.rftJSON=t;const a=b(t),i=e.portalItem?.toJSON(),s=await(0,f.u)(e.portalItem,{itemProperties:{...i,title:e.rftProperties.name,snippet:e.rftProperties.description,thumbnail:e.rftProperties.thumbnail},itemData:a});s.success?(e.hasUnsavedChanges=!1,e.portalItem=s.item,this.updateActiveRFTList(e),document.body.appendChild((0,v.b)({modalStrings:{content:this.strings.saveSuccess.replace("${template}",s.item.title)}})),this.analysisTemplateSaved.emit({portalItem:e.portalItem,template:t})):console.error("Failed to save the item",s.errors[0].message)}catch{throw this.showErrorModal(),new Error("Invalid RFT.")}},this.showErrorModal=()=>{const e=(0,v.d)({modalStrings:{header:this.strings.templateInvalidModalTitle,content:this.strings.templateInvalidModalMsg,cancel:this.strings.cancel}});!1===document.body.contains(e)&&(document.body.appendChild(e),e.open=!0)},this.closeSaveModal=()=>{void 0!==this.saveModalElement&&(this.saveModalElement.removeEventListener("cancelClick",this.closeSaveModal),this.saveModalElement.remove(),this.saveModalElement=void 0)},this.saveAsItem=async e=>{const t=e.detail.itemProperties,a={...this.getTemplateInfo()};a.rftProperties={...a.rftProperties,name:t.title,description:t.snippet};const i=y(a.rftJSON,a.rftProperties);a.rftJSON=i;const s=b(i);t.fileType="json";const o=await(0,f.c)({itemProperties:{...t,thumbnail:a.rftProperties.thumbnail},itemData:s},this.portal);if(o.success){a.hasUnsavedChanges=!1,this.updateTemplateInfoWithPortalItem(a,o.item),this.addToActiveRFTList({...a,hasUnsavedChanges:!1,portalItem:o.item,id:o.item.id});const e={modalStrings:{content:this.strings.saveSuccess.replace("${template}",o.item.title)}};d.L.entryPoint===l.E.ITEM&&(e.modalStrings.linkUrl=(0,p.a)(o.item),e.modalStrings.linkText=this.strings.openItemDetails,e.onLinkClicked=()=>{this.rftItemDetailsLinkClicked.emit()}),document.body.appendChild((0,v.b)(e)),this.analysisTemplateSaved.emit({portalItem:o.item,template:i}),this.analysisRFTEditorClose.emit()}this.closeSaveModal()},this.closeItemBrowser=()=>{void 0!==this.itemBrowserElement&&(this.itemBrowserElement.removeEventListener("rfxItemBrowserClose",this.closeItemBrowser),this.itemBrowserElement.remove(),this.itemBrowserElement=void 0)},this.handleRFTSaveAs=async()=>new Promise((async e=>{const t=this.getTemplateInfo(),{portal:a,closeSaveModal:i,saveAsItem:s}=this;this.saveModalElement?.remove();try{const o=await this.rfxEditorCoreElement.getModel();t.rftJSON=o,void 0!==o&&(this.saveModalElement=(0,v.e)({portal:a,portalItem:t.portalItem,itemProps:void 0!==t.rftProperties?{title:t.rftProperties.name,snippet:t.rftProperties.description}:void 0,onCancel:()=>{i(),e(!1)},onSave:async t=>{await s(t),e(!0)}}),document.body.appendChild(this.saveModalElement))}catch{this.showErrorModal(),e(!1)}})),this.handleRFxTemplateEditorPanelClose=()=>{void 0!==this.templateEditorElement&&(this.templateEditorElement.remove(),this.templateEditorElement=void 0)},this.handleRFxTemplateEditorPanelSave=e=>{const t=this.getTemplateInfo();t.rftProperties=e,t.hasUnsavedChanges=!0,this.updateActiveRFTList(t),this.templateEditorElement?.remove()},this.handleOpenTemplateEditor=()=>{const e=this.getTemplateInfo();let t,a=!0;!0===d.L.isViewerUserType&&(a=!1,t=this.strings.close),this.templateEditorElement=(0,v.f)({templateProperties:e.rftProperties,portalItem:e.portalItem,modalStrings:{header:this.strings.templatePropertiesTitle,secondary:t},showPrimaryButton:a,onCancel:this.handleRFxTemplateEditorPanelClose,onSave:this.handleRFxTemplateEditorPanelSave}),document.body.appendChild(this.templateEditorElement)},this.handleRFTShare=()=>{const e=this.getTemplateInfo(),{portal:t}=this;this.shareModalElement?.remove(),this.shareModalElement=(0,v.g)({portal:t,portalItem:e.portalItem}),this.shareModalElement.addEventListener("rfxShareSuccessful",(()=>{this.shareModalElement?.remove(),this.shareModalElement=void 0,document.body.appendChild((0,v.b)({modalStrings:{content:this.strings.shareSuccess.replace("${template}",e.portalItem.title)}}))})),document.body.appendChild(this.shareModalElement)},this.handleRFxListViewTriggerSelectFunction=async e=>{e.stopPropagation();const{detail:t}=e,a=this.getTemplateInfo(),i=await(0,o.b)(t);this.rfxCoreServices.addRFxFunctionCommand.execute(i),a.hasUnsavedChanges=!0,this.updateActiveRFTList(a)},this.handleRFxListViewPanelClose=e=>{e.stopPropagation(),this.visibilityReducer({key:"rfxListView",visible:!1})},this.createRasterNodeEditor=(e,t)=>{let a,i=!0;!0===d.L.isViewerUserType&&(a={secondary:this.strings.close},i=!1);const s=(0,v.h)({heading:this.strings.browseLayerDialogTitle,labels:a,showPrimaryButton:i,inputLayers:(0,c.t)(this.mapLayers).imageryLayers,layerValue:t,handlePanelOk:t=>{e.value=t.rasterValue,s?.remove()},handlePanelClose:()=>{s?.remove()},createLayerBrowse:this.createLayerBrowse});document.body.appendChild(s)},this.handlePopoverClose=()=>{(0,u.r)(this.toolHelpPopover)},this.handleRFxDetailsEditorHeadingHelpClick=(e,t)=>async()=>{const a=(0,o.e)(e),{helpTemplate:i,learnMoreUrl:s}=await(0,n.c)({rfxName:a,rfxTemplate:e,portal:this.portal,mode:l.a.EDITOR});this.toolHelpPopover=(0,u.s)(this.toolHelpPopover,{helpSrcdoc:i,helpId:"toolDescription",heading:t,referenceElement:this.headerElement,learnMoreUrl:s,offsetDistance:25,offsetSkidding:0}),this.toolHelpPopover.addEventListener("rfxHelpPopoverClose",this.handlePopoverClose)},this.handleRfxCoreNodeEditProperties=e=>{switch(this.handlePopoverClose(),e.dataType){case m.d.raster:this.createRasterNodeEditor(e.node,e.json);break;case m.d.rfxtemplate:if(void 0===e.schema||(0,g.i)({category:e.schema?.category}))return;this.createRfxDetailsEditor({detailsEditorRfxTemplate:e.json,detailsEditorRfxSchema:e.schema,detailsEditorRfxNode:e.node})}},this.handleRfxCoreNodeDuplicate=async e=>{switch(e.dataType){case m.d.raster:this.handleAddRasterClick({value:e.value});break;case m.d.scalar:this.handleAddConstantClick({value:e.value.value});break;case m.d.rfxtemplate:const t=(0,o.e)(e.json),a=await(0,o.b)(t);this.rfxCoreServices.addRFxFunctionCommand.execute(a)}},this.handleRfxCoreDeprecatedFunctionFound=e=>{const t=this.portal?.isPortal,a=this.portal?.sourceJSON?.helpBase||o.F.learnMoreDocBaseURL,i=(0,h.f)(a,this.locale);let s;if(!0===t){const e=o.F.learnMoreDocDeprecatedEnterpriseHelpID,{restUrl:t}=this.portal;s=`${i}${(0,n.b)(e)}`,s=(0,h.a)(s,t)}else s=(0,n.f)(i,o.F.learnMoreDocDeprecatedHelpID),this.analysisDeprecatedFunctionFound.emit();const r=`${this.strings.deprecatedFunctions}${e}`;this.rfxEditorPanelElement.appendChild((0,v.i)({modalStrings:{content:(0,d.q)(this.strings.deprecatedFunctionAlertContent,{docLink:s}),header:this.strings.deprecatedFunctionAlertHeader,functionNames:r}}))},this.handleRfxCoreNodeDelete=()=>{const e=this.getTemplateInfo();e.hasUnsavedChanges=!0,this.updateActiveRFTList(e)},this.handleRfxCoreNodeValueChange=()=>{const e=this.getTemplateInfo();!0===e.hasLoaded&&(e.hasUnsavedChanges=!0),this.updateActiveRFTList(e)},this.showRfxList=!1,this.mapView=void 0,this.mapLayers=void 0,this.portal=void 0,this.rftItemId="rft-0",this.scale=r.C.s,this.renderFlag=!1}onPortalChange(e){d.L.portal=e}async onRftItemIdChange(){if(void 0!==this.rftItemId){const e=this.getTemplateInfo(this.rftItemId)??{id:this.rftItemId};void 0===e.portalItem&&d.L.entryPoint!==l.E.ITEM||await this.updateTemplateInfoPortalItem(e,this.rftItemId),this.addToActiveRFTList(e)}}handleActionBarClick(e){if(e.detail.templateId===this.rftItemId)switch(e.detail.actionId){case T:this.handleNewTemplateClick();break;case E:this.handleOpenTemplateClick();break;case S:this.handleAddFunctionClick();break;case I:this.handleAddConstantClick();break;case R:this.handleAddRasterClick();break;case w:this.handleOpenTemplateEditor()}}async onPanelClose(e){return new Promise((async t=>{const a=this.getTemplateInfo(e);if(void 0!==a)return!0===d.L.isViewerUserType?(this.handleCloseClick(),void t(!0)):void(!0===a.hasUnsavedChanges?t(await this.showUnsavedChangesDialog(a)):(this.handleCloseClick(),t(!0)));t(!0)}))}async canClose(e){return new Promise((t=>{const a=this.getTemplateInfo(e);!0===a.hasUnsavedChanges?t({canClose:!1,message:(0,d.q)(this.strings.unsavedChanges,{rftTitle:a?.rftProperties?.name})}):t({canClose:!0,message:""})}))}async closeWithoutConfirmation(){return this.handleCloseClick(),Promise.resolve()}async reloadRFTItem(){void 0!==this.rftItemId&&(await this.onRftItemIdChange(),await this.loadRFT(this.rftItemId))}async getModelJSON(){const e=await this.rfxCoreServices.getModelDisplayDataCommand.execute(),t=this.rfxEditorCoreElement.getBoundingClientRect(),a=t.left,i=t.top;return e.map((e=>({...e,x:a+e.x,y:i+e.y,points:e.points.map((e=>({...e,x:a+e.x,y:i+e.y})))})))}updateTemplateInfo(e,t){const a=this.getTemplateInfo(e);return void 0!==t?.name&&void 0!==a&&(a.rftProperties.name=t.name,a.rftJSON.name=t.name,this.updateActiveRFTList(a)),Promise.resolve()}async componentWillLoad(){({strings:this.strings,dir:this.direction,locale:this.locale}=await(0,h.c)(this.hostElement,(0,i.a)("."))),void 0!==this.portal&&this.onPortalChange(this.portal),this.translatedRFTNamesMap=await async function(){const e=new Map,{rfxFunctions:t}=await(0,o.a)();for(const a of t)(0,d.p)(a)||("CellStatisticsFunction"===a.name&&e.set("LocalFunction__40",a.title),e.set(a.name,a.title));return e}(),await this.onRftItemIdChange()}componentDidLoad(){if(void 0!==this.rftItemId){const e=this.getTemplateInfo(this.rftItemId);e.hasLoaded=!1,setTimeout((async()=>{this.isPortalItem()?void 0!==e.rftJSON?(await this.rfxCoreServices.addRFTJSONCommand.execute(e.rftJSON),this.analysisRFTLoaded.emit({id:this.rftItemId,data:e.rftJSON})):await this.loadRFT(this.rftItemId):(e.rftProperties={name:`${this.strings?.newRFT} ${this.rftItemId.split("-")[1]}`},this.updateActiveRFTList(e)),e.hasLoaded=!0}),1)}}disconnectedCallback(){(0,u.r)(this.toolHelpPopover),this.handleCloseClick()}isPortalItem(){return-1===this.rftItemId.indexOf("rft")}getTemplateInfo(e){return d.L.activeRFxTemplates.find((t=>t.id===(e??this.rftItemId)))}visibilityReducer({key:e,visible:t}){const a=this.overlayElementsConfig[e];if(a.visible!==t){if(!0===t){const e=Object.values(this.overlayElementsConfig).filter((e=>e.slot===a.slot));e.length>=2&&e.slice(1).forEach((e=>{e.visible=!1}))}a.visible=t,this.scheduleRenderer()}}scheduleRenderer(){this.renderFlag=!this.renderFlag}renderOverlayElements(){const e={addRasterFunctionTitle:this.strings.addRasterFunctionTitle,templatePropertiesTitle:this.strings.templatePropertiesTitle,browseLayerDialogTitle:this.strings.browseLayerDialogTitle},t=this.overlayElementsConfig,a=Object.keys(t);!0===d.L.isViewerUserType&&(t.rightToolBar.visible=!1);return a.map((a=>{const i=t[a];if(!i.visible)return[];const s=i?.builder?.(e);return s}))}_renderEditorCoreUI(){return(0,i.h)("rfx-editor-core",{ref:this.initializeRFxEditorCore,onRfxCoreNodeEditProperties:e=>{e.stopPropagation();const{detail:t}=e;this.handleRfxCoreNodeEditProperties(t)},onRfxCoreNodeDuplicate:async e=>{e.stopPropagation();const{detail:t}=e;await this.handleRfxCoreNodeDuplicate(t)},onRfxCoreDeprecatedFunctionFound:e=>{e.stopPropagation();const{detail:t}=e;this.handleRfxCoreDeprecatedFunctionFound(t)},onRfxCoreNodeDelete:e=>{e.stopPropagation(),this.handleRfxCoreNodeDelete()},onRfxCoreNodeValueChange:e=>{e.stopPropagation(),this.handleRfxCoreNodeValueChange()}},this.renderOverlayElements())}render(){return(0,i.h)(i.H,{key:"5c75b4dad8d5ab3f96b0b59c01e3a101541ad403",class:F},(0,i.h)("div",{key:"7db9af4c16349519dbe87a367d5639844260a0db",class:{[P]:!0,[N]:"rtl"===this.direction}},(0,i.h)("slot",{key:"597f4ab8c9cd501b147efa4867685c8c2fb53eb8",name:A}),(0,i.h)("calcite-panel",{key:"4f3c8b2bf6d8221d1a1d039bacc3395b80e21e5e",class:M,heading:"",ref:e=>this.rfxEditorPanelElement=e},this._renderEditorCoreUI())))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.d)(this)}static get watchers(){return{portal:["onPortalChange"],rftItemId:["onRftItemIdChange"]}}};O.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.host{height:100%;width:100%}.content{height:100%;display:flex;overflow:hidden}.action-bar{height:100%;border-width:0 1px 0 0;border-style:solid;border-color:var(--calcite-color-border-2)}.menu-actions{display:inline-flex;justify-self:stretch}.header-actions{height:100%}.tooltip{white-space:nowrap}.arcgis--rtl .action-bar{border-width:0 0 0 1px}.editor-container{position:relative;}.overlay-element{z-index:3;box-shadow:0 0 5px rgba(0, 0, 0, 0.2);border-radius:0.25rem}.overlay-panel{max-height:90%;max-width:22rem;width:22rem}.list-wrapper{display:flex;height:100%}";const B="action-bar",U="tooltip",V=class{constructor(e){(0,i.r)(this,e),this.rfxEditorHeaderActionSelect=(0,i.c)(this,"rfxEditorHeaderActionSelect",7),this.handleActionClick=e=>{const t={actionId:e.target.id,templateId:this.templateId};this.rfxEditorHeaderActionSelect.emit(t)},this.isBarExpanded=!1,this.templateId=void 0,this.hideCreateNewTemplate=!1,this.hideEditTemplateProperties=!0,this.hideRFxNodeActions=!1,this.scale=r.C.m,this.expanded=void 0}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,h.c)(this.hostElement,(0,i.a)("."))),this.isBarExpanded=this.expanded}render(){const e=d.L.entryPoint===l.E.ITEM?this.strings.addTemplate:this.strings.openTemplate,t=d.L.isViewerUserType?this.strings.viewTemplateProperties:this.strings.editTemplateProperties;return(0,i.h)("calcite-action-bar",{key:"64c542bf4f7b00c3439eb83ea223bdfdceb74059",class:B,onCalciteActionBarToggle:e=>{this.isBarExpanded=e.target.expanded},scale:this.scale,expanded:!0===this.isBarExpanded},!1===this.hideCreateNewTemplate&&(0,i.h)("calcite-action-group",{key:"c2c1f00e383564823e447f11d475008c7018c713",scale:this.scale},(0,i.h)(i.F,{key:"c81ae90da0f05c2ad1596dc448d8b0abb831a5c9"},(0,i.h)("calcite-action",{key:"304a71d407d190d5ae28929279a24364c3042a1c",id:T,icon:"new-raster-function-template",text:this.strings.newTemplate,textEnabled:this.isBarExpanded,onClick:this.handleActionClick,scale:this.scale}),!this.isBarExpanded&&(0,i.h)("calcite-tooltip",{key:"7c786b5f91e1e0cefb1beef38131522682548027",referenceElement:T},(0,i.h)("div",{key:"5c1908d847aa244a13c549e55a15550cb324fdbc",class:U},this.strings.newTemplate)))),!1===this.hideRFxNodeActions&&(0,i.h)("calcite-action-group",{key:"85a20fa2bae45b37b802937ddce39f78b09579a5",scale:this.scale},(0,i.h)(i.F,{key:"37fbbbb576686b62fb7e64cb32499411357d85f3"},(0,i.h)("calcite-action",{key:"271e9fb665f33a7ed2b7a5605827af0554d981d6",id:E,icon:"folder-open",text:e,textEnabled:this.isBarExpanded,onClick:this.handleActionClick,scale:this.scale}),!this.isBarExpanded&&(0,i.h)("calcite-tooltip",{key:"e3aadfbe9fdb4edae5e92c28f386a6722c08d5a4",referenceElement:E},(0,i.h)("div",{key:"a1e9a941e69f54a02a8a6ba38a0c32e2993a7fec",class:U},e))),(0,i.h)(i.F,{key:"24bdee52e03ec08a785028e566fd602719ab0a59"},(0,i.h)("calcite-action",{key:"eef8054295605a0792bbe9ad84c72625792ab9b7",id:S,icon:"raster-function",text:this.strings.addFunction,textEnabled:this.isBarExpanded,onClick:this.handleActionClick,scale:this.scale}),!this.isBarExpanded&&(0,i.h)("calcite-tooltip",{key:"e9e66e56bc4bfc06e2bf1d41870e990ff90d2b7a",referenceElement:S},(0,i.h)("div",{key:"dc1d5fa352908e9269ce70731e27b571160b572e",class:U},this.strings.addFunction))),(0,i.h)(i.F,{key:"73122a5464d9de927548dc62094005cd9b3e3f86"},(0,i.h)("calcite-action",{key:"4b756428d2bb111414937480403f065004918107",id:I,icon:"add-constant",text:this.strings.addConstant,textEnabled:this.isBarExpanded,onClick:this.handleActionClick,scale:this.scale}),!this.isBarExpanded&&(0,i.h)("calcite-tooltip",{key:"f39082d85aa66bef290e7a56b77030ab02e8ace6",referenceElement:I},(0,i.h)("div",{key:"dd0c9f0590ce5d67e4ceed6b3c592e8d8a432253",class:U},this.strings.addConstant))),(0,i.h)(i.F,{key:"f7313067f8ff9b9908ddf5355efcd2704dd3b15f"},(0,i.h)("calcite-action",{key:"64a26f19f155af6a566f140d49e5f728e18e9e0a",id:R,icon:"add-raster-variable",text:this.strings.addRaster,textEnabled:this.isBarExpanded,onClick:this.handleActionClick,scale:this.scale}),!this.isBarExpanded&&(0,i.h)("calcite-tooltip",{key:"bdb78275306e4161ccdc45cf8953d537ee889b92",referenceElement:R},(0,i.h)("div",{key:"d447bd5d3cc99c2e2653931af4b43d0ac695e3ce",class:U},this.strings.addRaster)))),!1===this.hideEditTemplateProperties&&(0,i.h)("calcite-action-group",{key:"bcf7ee6339c85574af0cd22b314ba4bfd807d9be",scale:this.scale},(0,i.h)(i.F,{key:"532b505873edace2bf45818a788374aae88f9e85"},(0,i.h)("calcite-action",{key:"9eae22be3fd8c606662e3c6279033aae36c7b06a",id:w,icon:"properties",text:t,textEnabled:this.isBarExpanded,onClick:this.handleActionClick,scale:this.scale}),!this.isBarExpanded&&(0,i.h)("calcite-tooltip",{key:"47d85cb50ba9086a60a3a275ce33514166a14197",referenceElement:w},(0,i.h)("div",{key:"8747c70bd03301bdbe6622b96f67016a75d31da4",class:U},t)))),(0,i.h)("calcite-tooltip",{key:"16e8bc213ab0c2ca839dbcefa9fdaeb2edf9afd6",slot:"expand-tooltip"},(0,i.h)("div",{key:"889cfff065cacde30a704524639b3f0e76797809",class:U},this.strings.expand)))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.d)(this)}};V.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.action-bar{height:100%;border-width:0 1px 0 0;border-style:solid;border-color:var(--calcite-color-border-2)}.tooltip{white-space:nowrap}"},37465:(e,t,a)=>{a.d(t,{I:()=>r,c:()=>c,u:()=>d});var i=a(33752),s=a(22493);const o={JSON:"json",XML:"xml"},r={RASTER_FUNCTION_TEMPLATE:"Raster function template"};function n(e){const t=new FormData,{itemProperties:a,itemData:i}=e,{title:n,description:l,tags:d,type:c,snippet:h,properties:m,categories:p}=a;let f=a.fileType||o.JSON;if(f=f.startsWith(".")?f:`.${f}`,t.append("title",n),(0,s.p)(i)){let e="";c===r.RASTER_FUNCTION_TEMPLATE&&(e="rft");const a=`${n}.${void 0!==e?e:""}${f}`;t.append("file",i,a),t.append("name",a)}return t.append("type",c),void 0!==l&&t.append("description",l),void 0!==h&&t.append("snippet",h),(0,s.p)(d)||t.append("tags",d.join(",")),void 0!==m&&t.append("properties",JSON.stringify(m)),(0,s.p)(p)||t.append("categories",p.join(",")),t.append("f","json"),t}async function l(e,t,a){const{thumbnail:o,shareOptions:r}=a,n={success:!0,errors:[]};if(e.data){const a=e.data.id,l=new i.default({id:a,portal:t});return n.item=l,l.load().then((()=>(void 0!==o&&l.updateThumbnail({thumbnail:o}),(0,s.p)(r),Promise.resolve(n))))}}function d(e,t){((0,s.p)(t)||(0,s.p)(e))&&Promise.reject(new Error("Item data or item not present"));const a=e.portal,i=e.userItemUrl??`${a.user.userContentUrl}/items/${e.id}`;return(0,s.u)(`${i}/update`,{body:n(t)}).then((e=>l(e,a,t.itemProperties)),(e=>({success:!1,errors:[e]})))}function c(e,t){((0,s.p)(e)||(0,s.p)(t))&&Promise.reject(new Error("Item data or portal not present"));const{itemProperties:a}=e,i=t.user;if((0,s.p)(i))return;const{ownerFolder:o}=a,r=void 0!==o&&o.id!==o.title?o.id:void 0,d=(0,s.p)(r)?`${i.userContentUrl}/addItem`:`${i.userContentUrl}/${r}/addItem`;return(0,s.u)(d,{body:n(e)}).then((e=>l(e,t,a)),(e=>({success:!1,errors:[e]})))}}}]);