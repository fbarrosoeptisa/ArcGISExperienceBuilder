"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_analysis-components_dist_esm_a-a27ebd"],{40041:(e,a,t)=>{t.r(a),t.d(a,{analysis_block:()=>i.A,analysis_key_value:()=>i.c,analysis_parameter_group:()=>i.b,analysis_section:()=>i.a,analysis_value_table:()=>i.d});var i=t(20109);t(12064),t(22069),t(44345),t(55448),t(18423),t(91813),t(21255),t(588),t(54312),t(34031),t(9316),t(61320),t(64016),t(56451),t(6550),t(2924),t(5258),t(52373),t(33752),t(53976),t(49403),t(77462),t(23054),t(73645),t(12762),t(82567),t(28927),t(35970),t(5933),t(57295),t(5294),t(13661),t(35431),t(32513),t(11840),t(440),t(66744),t(23795),t(17902),t(71802),t(36596),t(72349),t(89962),t(97703),t(43284),t(96063),t(64872),t(86312),t(46784)},20109:(e,a,t)=>{t.d(a,{A:()=>p,a:()=>y,b:()=>C,c:()=>L,d:()=>_});var i=t(12064),s=t(22069),r=t(96063),l=t(86312),n=t(46784);const o="block",h="no-summary-text",p=class{constructor(e){(0,i.r)(this,e),this.label=void 0,this.summaryText=void 0,this.collapsible=!1,this.defaultClosed=!1,this.open=!0}componentWillLoad(){this.defaultClosed&&(this.open=!1)}render(){return(0,i.h)(i.H,{key:"bb862eb4c5703dce5ac775523221bdfd9e7bfd0e",class:`${(0,s.i)(this.summaryText)&&!1===this.collapsible?h:""}`},(0,i.h)("calcite-block",{key:"b41fbc96e69de46aac8d5fb84316b86351451774",class:o,heading:this.label??"",collapsible:this.collapsible,description:(0,s.i)(this.summaryText)?void 0:this.summaryText,open:this.open},(0,i.h)("slot",{key:"a093021986b4a83499dc6780af7f51a01294071d"})))}get hostElement(){return(0,i.g)(this)}};p.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;width:100%}.block{width:100%}:host(.no-summary-text) ::slotted(*){margin-top:calc(var(--calcite-spacing-md) * -1)}";const c="esriGPParameterTypeRequired",d="background",u="analysis--rtl",y=class{constructor(e){(0,i.r)(this,e),this.open=void 0,this.label=void 0}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,s.d)(this.hostElement,(0,i.a)(".")))}render(){return(0,i.h)(i.H,{key:"61ecc62c8e06086357ec5f31549e14723666039e",class:"rtl"===this.dir?u:""},(0,i.h)("calcite-block-section",{key:"3b35d1f45d3fae212332d95cd77773cc0f88664c",class:d,dir:this.dir,text:this.label??this.strings.defaultTitle,open:this.open??!1},(0,i.h)("slot",{key:"b5a8ee01f2401a9fe85fb5d92a9c683c9e129c67"})))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.g)(this)}};y.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:block;width:calc(var(--analysis-component-default-width) - var(--analysis-quarter-spacing))}.background{background-color:transparent}::slotted(*){margin-left:var(--analysis-quarter-spacing)}:host(.analysis--rtl) ::slotted(*){margin-left:0;margin-right:var(--analysis-quarter-spacing)}";const m={[r.A.GPString]:{icon:"string"},[r.A.GPMultiValueString]:{icon:"string"},[r.A.GPBoolean]:{icon:"boolean"},[r.A.GPMultiValueBoolean]:{icon:"boolean"},[r.A.GPDouble]:{icon:"number"},[r.A.GPMultiValueDouble]:{icon:"number"},[r.A.GPLong]:{icon:"number"},[r.A.GPMultiValueLong]:{icon:"number"},[r.A.GPDate]:{icon:"calendar"},[r.A.GPMultiValueDate]:{icon:"calendar"},[r.A.GPLinearUnit]:{icon:"line-straight"},[r.A.GPArealUnit]:{icon:"polygon-area"},[r.A.GPMultiValueArealUnit]:{icon:"polygon-area"},[r.A.GPMultiValueLinearUnit]:{icon:"line-straight"},[r.A.GPFeatureRecordSetLayer]:{icon:"feature-layer"},[r.A.GPMultiValueFeatureRecordSetLayer]:{icon:"feature-layer"},[r.A.GPRecordSet]:{icon:"table"},[r.A.GPMultiValueRecordSet]:{icon:"tables"},[r.A.GPRasterDataLayer]:{icon:"image-layer"},[r.A.GPMultiValueRasterDataLayer]:{icon:"image-layer"},[r.A.GPDataFile]:{icon:"data"},[r.A.GPMultiValueDataFile]:{icon:"data"},[r.A.GPField]:{icon:"brackets-curly"},[r.A.GPMultiValueField]:{icon:"brackets-curly"},[r.A.GPValueTable]:{icon:"brackets-curly"},[r.A.GPMultiValueValueTable]:{icon:"brackets-curly"},[r.A.GPComposite]:{icon:"brackets-curly"},[r.A.GPMultiValueComposite]:{icon:"brackets-curly"}},v="NEVER_SET",g="NO_LAYER",b="data-type-selector",f=new Set([r.A.GPFeatureRecordSetLayer,r.A.GPRecordSet]),C=class{constructor(e){(0,i.r)(this,e),this.analysisParameterGroupInputChange=(0,i.c)(this,"analysisParameterGroupInputChange",7),this.analysisHelpClick=(0,i.c)(this,"analysisHelpClick",7),this.selectionOptionChange=()=>{const e=this.pickerElement;this.updateDataType(e.selectedOption.value)},this.selectedChipsChange=()=>{const e=this.pickerElement,[a]=e.selectedChips,t=a;void 0!==t?this.updateDataType(t,this.selectedDataType):void 0!==this.selectedDataType&&(e.selectedChips=[this.activeDataType])},this.parameterValueChanged=()=>{if(void 0!==this.mappedElement){const e=this.mappedElement.value;if(void 0!==e&&this.isSupportedGPLayerValue(e)){if("selectedLayers"in this.mappedElement){const e=this.mappedElement.selectedLayers,a=Array.isArray(e)?e[0]:e;void 0!==a&&(this.selectedLayersMap.set(this.activeDataType,a),this.selectedLayers=e,this.trackLayerInstance(a))}}else"selectedLayers"in this.mappedElement&&(this.selectedLayersMap.set(this.activeDataType,void 0),this.selectedLayers=void 0,this.trackLayerInstance(void 0));this.updateAndEmitValue(e,this.value)}},this.setAnalysisRef=e=>{null!=e&&(this.mappedElement=e,this.selectedLayers=this.selectedLayersMap.get(this.activeDataType))},this.groupLabel=void 0,this.value=void 0,this.doCalciteInputChangeOnCommit=void 0,this.dataType=void 0,this.required=void 0,this.visibleTypes=[],this.UIparameterInfos=void 0,this.portal=void 0,this.mapView=void 0,this.mapLayers=void 0,this.modelVariableLayers=void 0,this.selectedLayers=void 0,this.supportsUpload=!1,this.serviceUrl=void 0,this.hideAddToMap=!1,this.clearEnabled=!1,this.paramGroupFilterLayersByChip=!1,this.validationParams=void 0,this.pickerElement=void 0,this.mappedElement=void 0,this.UIparameterMap=new Map,this.data=new Map,this.layerIdMap=new Map,this.selectedLayersMap=new Map,this.externalBrowsedLayers=[]}onValueChange(){this.dataType===r.A.GPComposite?(this.selectedDataType=this.getCompositeDataType(this.value),this.saveValue(this.selectedDataType,this.value)):this.updateSelectedLayerMap(this.activeDataType)}onDataTypeChange(e,a){e!==a&&(a===r.A.GPComposite&&(this.dataType=r.A.GPComposite),this.updateDataType(e,this.selectedDataType))}onVisibleTypesChange(e){this.visibleTypes=e??[]}onUIparameterInfosChange(e,a){(0,l.i)(e,a)||(this.updateWithUIParameterInfos(e),this.updateAndEmitValue(this.data.get(this.activeDataType),this.value))}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,s.d)(this.hostElement,(0,i.a)("."))),this.updateWithUIParameterInfos(this.UIparameterInfos),this.applyAllDefaultValues(),this.updateAndEmitValue(this.data.get(this.activeDataType),this.value)}async checkValidity(){return Promise.resolve(this.validate())}async validate(){const e=this.isGPComposite(this.value)?void 0!==this.value.value:void 0!==this.value;let a=!0!==this.required||!1!==e;try{void 0!==this.mappedElement&&"checkValidity"in this.mappedElement&&(a=await this.mappedElement.checkValidity())}catch(e){}return a}saveValue(e,a){const t=this.isGPComposite(a)?a.dataType:e;if(void 0!==t){const e=this.data.get(t);this.data.set(t,a),(0,l.i)(a,e)||this.updateSelectedLayerMap(t)}}updateAndEmitValue(e,a){if(!(0,l.i)(e,a)){const a=this.formatCompositeValue(this.activeDataType,e);this.saveValue(this.activeDataType,a),this.value=a,this.selectedDataType=this.getCompositeDataType(a)??this.activeDataType,this.analysisParameterGroupInputChange.emit({data:a,creationMode:this.layerCreationMode})}}updateDataType(e,a=this.activeDataType){null!=e&&e!==a&&(this.saveValue(a,this.value),this.selectedDataType=e,this.dataType!==r.A.GPComposite&&(this.dataType=e),this.applyDefaultValue(e),this.updateAndEmitValue(this.data.get(e),this.value))}getNewLayerIdState(e,a){return void 0!==e?e:a===v?v:g}updateLayerIdMap(e,a){const t=this.layerIdMap.get(e)??v,i=a?.id,s=this.getNewLayerIdState(i,t);this.layerIdMap.set(e,s),s!==t&&t!==v&&(this.saveValue(e,void 0),this.applyDefaultValue(e))}updateUIParameterMap(e){const{dataType:a,...t}=e;this.UIparameterMap.set(a,t)}updateDataMap(e){const{dataType:a,value:t,mapLayer:i}=e;void 0!==a&&this.updateLayerIdMap(a,i);const s=this.formatCompositeValue(a,t??this.data.get(a));this.saveValue(a,s)}updateSelectedLayerMap(e){if(void 0!==e){const a=this.data.get(e),t=(0,s.J)(a)?{variable:a.variable}:void 0,i=this.isGPComposite(a)?a.value??t:a,r=(0,s.J)(a)&&a.variable===this.selectedLayersMap.get(e)?.id;f.has(e)&&this.isSupportedGPLayerValue(i)&&!r&&this.fetchEligibleLayerInstance(i).then((a=>{this.selectedLayersMap.set(e,a),this.selectedLayers=a,this.trackLayerInstance(a),e===this.activeDataType&&(this.selectedLayersMap=new Map(this.selectedLayersMap))}))}}formatCompositeValue(e,a){const t=(0,s.J)(a);return this.dataType===r.A.GPComposite&&!1===this.isGPComposite(a)?{dataType:e,...t?{}:{value:a},...t?{variable:a.variable}:{}}:a}getCompositeDataType(e){return this.isGPComposite(e)?e.dataType:void 0}getCompositeValue(e){const a=(0,s.J)(e);return this.isGPComposite(e)&&!a?e.value:e}isGPComposite(e){return"object"==typeof e&&null!==e&&"dataType"in e&&(0,s.F)(e.dataType)&&("value"in e||"variable"in e)}applyAllDefaultValues(){this.UIparameterMap.forEach(((e,a)=>{this.applyDefaultValue(a)}))}applyDefaultValue(e){const{defaultValue:a}=this.UIparameterMap.get(e)??{},t=this.data.get(e),i=this.getCompositeValue(t),s=this.getCompositeValue(a);if(null==i&&null!=s){const a=this.formatCompositeValue(e,s);this.saveValue(e,a)}}updateWithUIParameterInfos(e){this.dataType===r.A.GPComposite?this.selectedDataType=this.getCompositeDataType(this.value):this.selectedDataType=this.dataType,this.saveValue(this.selectedDataType??this.dataType,this.value),this.UIparameterMap.clear();const a=e??[];for(const e of a)this.updateUIParameterMap(e),this.updateDataMap(e)}get dataTypes(){return[...this.UIparameterMap.keys()].filter((e=>0===this.visibleTypes.length||this.visibleTypes.includes(e)))}get activeDataType(){let e=this.selectedDataType;if(void 0===e||!1===this.dataTypes.includes(e)){const a=this.dataTypes[0];e=a,this.selectedDataType=a,this.dataType!==r.A.GPComposite&&(this.dataType=a)}return e}get allLayers(){return[this.mapLayers,this.externalBrowsedLayers,this.modelVariableLayers].flat().filter((e=>Boolean(e)))}get layerCreationMode(){let e;return void 0!==this.mappedElement&&"creationMode"in this.mappedElement&&(e=this.mappedElement.creationMode),e}get allLayerIds(){const e=this.allLayers.map((e=>e.id)).filter(Boolean);return new Set(e)}getChipGroupData(){return this.dataTypes.reduce(((e,a)=>{const t=this.UIparameterMap.get(a),i=m[a]?.icon??"circle-disallowed",s=t?.parameterGroupDataTypeLabel??this.strings[a]??a;return e.labels.push(s),e.icons.push(i),e}),{labels:[],icons:[]})}renderChipGroup(){const e=this.dataTypes,a=this.getChipGroupData();return(0,i.h)("analysis-chip-group",{ref:e=>{this.pickerElement=e},selectionMode:"single",value:e,chipLabel:a.labels,selectedChips:[this.activeDataType],iconLabel:a.icons,label:this.groupLabel,required:!0,onAnalysisChipGroupSelectionChange:this.selectedChipsChange})}renderSelect(){return(0,i.h)("calcite-select",{ref:e=>{this.pickerElement=e},label:this.strings.gpSelection,onCalciteSelectChange:this.selectionOptionChange,scale:s.U.Scale},(0,i.h)("calcite-option-group",{label:this.strings.gpTypes},this.dataTypes.map((e=>(0,i.h)("calcite-option",{key:e,value:e,selected:e===this.activeDataType},this.strings[e]??e)))))}renderDefaultComponent(){const e=this.activeDataType,a=this.getCompositeValue(this.data.get(e)),t=void 0===m[e],s=Array.isArray(this.selectedLayers)?this.selectedLayers[0]:this.selectedLayers;let l;e===r.A.GPRecordSet&&(l=n.L.Feature_Table);const o={...this.UIparameterMap.get(e)??{},selectedLayers:this.selectedLayers,selectedLayerIds:void 0!==s?.id?[s.id]:[],layerFilterType:this.paramGroupFilterLayersByChip?l:this.UIparameterMap.get(e)?.layerFilterType};return(0,i.h)(r.a,{key:e,name:e,dataType:e,portal:this.portal,user:this.portal?.user,mapView:this.mapView,mapLayers:this.mapLayers,modelVariableLayers:this.modelVariableLayers,externalBrowsedLayers:this.externalBrowsedLayers,supportsUpload:this.supportsUpload,serviceUrl:this.serviceUrl,validationParams:this.validationParams,...o,value:a,hideLabel:t,required:this.required,onSetRef:this.setAnalysisRef,onValueChange:this.parameterValueChanged,doCalciteInputChangeOnCommit:this.doCalciteInputChangeOnCommit,hideAddToMap:this.hideAddToMap})}render(){const e=this.UIparameterMap.get(this.activeDataType)??{},a=!0===this.required&&(void 0===e.label||""===e.label);return(0,i.h)(i.H,{key:"4e7674b88fc7c77ba01d8b5040c00424c9ee2964",dir:this.dir},(0,i.h)("analysis-label",{key:"b11da5d809e3fbab07c8a708355b325dfa23aa53",label:this.groupLabel,required:a,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}),(0,i.h)("div",{key:"c8891090fdb759db276822d0ab103e1444a38446",class:b},this.dataTypes.length<=2?this.renderChipGroup():this.renderSelect()),this.renderDefaultComponent())}trackLayerInstance(e){void 0!==e&&!1===this.allLayerIds.has(e.id)&&(this.externalBrowsedLayers=[...this.externalBrowsedLayers,e])}isSupportedGPLayerValue(e){return"object"==typeof e&&null!==e&&("url"in e||"itemId"in e||"layerDefinition"in e||"variable"in e)}async fetchEligibleLayerInstance(e){let a;if((0,s.J)(e))a=(0,s.$)(e.variable,this.modelVariableLayers??[]);else{const t=this.paramGroupFilterLayersByChip?"list"===this.layerCreationMode?this.mapLayers??[]:this.externalBrowsedLayers??[]:this.allLayers;a=(0,s.a0)(e,t),a=a??await(0,s.a1)(e)}return this.trackLayerInstance(a),a}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.g)(this)}static get watchers(){return{value:["onValueChange"],dataType:["onDataTypeChange"],visibleTypes:["onVisibleTypesChange"],UIparameterInfos:["onUIparameterInfosChange"]}}};C.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{--calcite-color-border-input:var(--analysis-ui-border-input);margin-bottom:var(--analysis-half-spacing)}.data-type-selector{margin-bottom:var(--analysis-quarter-spacing)}";const I="key-value",V={groupContainer:`${I}__group-container`,groupLabel:`${I}__group-label-text`,groupHorizontal:`${I}__horizontal-layout`,groupAction:`${I}__group-action`,groupActionHorizontal:`${I}__group-action-horizontal`,errorMessage:`${I}__error-message`};function T(e){return void 0!==e.name}const L=class{constructor(e){(0,i.r)(this,e),this.analysisKeyValueChange=(0,i.c)(this,"analysisKeyValueChange",7),this.analysisHelpClick=(0,i.c)(this,"analysisHelpClick",7),this.mappedElementMap=new Map,this.updateValue=(e,a)=>{const t=this.mappedElementMap.get(e),i=a;(0,l.g)(this.value,e)!==i&&(this.value={...this.value},(0,r.s)(this.value,e,i),void 0!==t&&(t.value=i,this.validateParameter(e)),this.analysisKeyValueChange.emit({path:e,value:this.value}))},this.parameterValueChanged=e=>{const a=this.mappedElementMap.get(e);void 0!==a&&(this.value={...this.value},(0,r.s)(this.value,e,a.value),this.validate()),this.analysisKeyValueChange.emit({path:e,value:this.value})},this.setAnalysisRef=(e,a)=>{null!=a?this.mappedElementMap.set(e,a):this.mappedElementMap.delete(e)},this.value=void 0,this.parameterInfos=void 0,this.UIparameterInfos=void 0,this.doCalciteInputChangeOnCommit=void 0,this.label=void 0,this.required=void 0,this.validationParams=void 0,this.clearEnabled=!1,this.errorMessage=void 0,this.layout=void 0}parameterInfosChange(e,a){const t=[];this.combinedParameterInfos?.forEach((e=>{"object"==typeof e&&(t.push(e.name),void 0!==a||(0,s.i)(this.value)?this.updateValue(e.name,e.value):e.value=this.value[e.name]??e.value)})),this.value=(0,r.p)(this.value,t),this.analysisKeyValueChange.emit({path:"init",value:this.value})}UIparameterInfosChange(e,a){(0,l.i)(e,a)||((0,s.i)(this.value)&&(this.value={}),this.combinedParameterInfos?.forEach((e=>{if(void 0!==e.name&&"object"==typeof this.value)if(!1===e.visible)delete this.value[e.name];else{const a=this.value[e.name]??e.value??e.defaultValue;this.updateValue(e.name,a)}})))}get combinedParameterInfos(){let e=this.parameterInfos??[];return void 0!==this.UIparameterInfos&&(e=this.UIparameterInfos.filter(T).map((e=>{const a=this.parameterInfos?.find((a=>a.name===e.name));return{...a,...e}}))),e}componentWillLoad(){this.UIparameterInfosChange(this.UIparameterInfos),this.analysisKeyValueChange.emit({path:"init",value:this.value})}render(){return(0,i.h)(i.H,{key:"a11d052042a84269edfea0472c5d53a5b7da301c"},(0,i.h)("analysis-label",{key:"33aafadc3872c765a4285006d3718e61405e44c0",label:this.label,required:!1,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}),this.renderParameters(this.combinedParameterInfos),this.renderErrorMessage())}renderErrorMessage(){const e=!1===(0,s.i)(this.validationParams?.message)||void 0!==this.errorMessage,a=(0,s.f)((0,s.m)({},this.validationParams)),t=void 0!==this.validationParams?(0,s.g)(this.validationParams.type):s.b.INVALID;return(0,i.h)("calcite-input-message",{class:V.errorMessage,hidden:!e,icon:"exclamationMarkTriangle",scale:s.U.Scale,status:t},a??this.errorMessage)}renderParameters(e,a,t){return e?.length>0&&(0,i.h)("div",null,void 0!==a?(0,i.h)("div",{class:V.groupLabel},t):null,(0,i.h)("div",{class:V.groupContainer},e?.map((e=>{const t=void 0!==a?`${a}[${e.name}]`:`${e.name}`,s=e.visible??!0;return e?.parameterInfos&&!e.dataType.includes("MultiValue")?this.renderParameters(e.parameterInfos,t,e.label??e.displayName??e.name):s&&(0,i.h)("div",{class:this.layout===r.b.Horizontal?V.groupHorizontal:""},(0,i.h)("analysis-label",{class:V.groupLabel,label:e.label??e.displayName??e.name,hideHelp:!0,required:!0===this.required||"required"in e&&!0===e.required}),(0,i.h)("div",{class:this.layout===r.b.Horizontal?V.groupActionHorizontal:V.groupAction},this.renderDefaultComponent(e,t)))}))))}renderDefaultComponent(e,a){const t=(0,l.g)(this.value,a);return(0,i.h)(r.a,{key:a,required:this.required,...e,label:"",onValueChange:()=>this.parameterValueChanged(`${a}`),onSetRef:e=>this.setAnalysisRef(`${a}`,e),value:t,doCalciteInputChangeOnCommit:this.doCalciteInputChangeOnCommit,clearEnabled:this.clearEnabled})}async checkValidity(){const e=await this.validate(),{message:a,type:t}=this.validationParams||{},i=!1===(void 0!==a)||!0===("informative"===t);return!0===e&&void 0===this.errorMessage&&!0===i}async validate(){const e=Array.from(this.mappedElementMap.keys()).map((async e=>this.validateParameter(e)));return(await Promise.all(e)).every((e=>!0===e))}async validateParameter(e){const a=this.mappedElementMap.get(e),t=this.combinedParameterInfos.find((a=>a.name===e))??{};let i=!0;if(void 0!==a)if("checkValidity"in a)i=await a.checkValidity();else{const e="required"in t&&t.required;i=!1===(!0===this.required||!0===e)||void 0!==a.value}return i}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.g)(this)}static get watchers(){return{parameterInfos:["parameterInfosChange"],UIparameterInfos:["UIparameterInfosChange"]}}};L.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{height:100%;margin-bottom:var(--analysis-half-spacing)}.key-value__group-container{display:flex;flex-direction:column;border:1px var(--calcite-color-border-1) solid;border-radius:var(--calcite-border-radius);padding:var(--analysis-half-spacing) var(--analysis-half-spacing) 0 var(--analysis-half-spacing);margin-bottom:var(--analysis-half-spacing)}.key-value__group-label-text{margin-bottom:var(--analysis-quarter-spacing);align-self:center;width:48%;font-size:var(--calcite-font-size--2)}.key-value__group-action{align-self:flex-end;width:100%}.key-value__group-action-horizontal{align-self:flex-end;width:50%}.key-value__horizontal-layout{display:flex;width:var(--analysis-component-default-width);justify-content:space-between}.key-value__error-message{margin-top:var(--analysis-quarter-spacing)}";const P="value-table",E={groupContainer:`${P}__group-container`,groupAction:`${P}__group-action`,groupAction1:`${P}__group-action-1`,label:`${P}__label`,groupHorizontal:`${P}__horizontal-layout`,groupHorizontalRtl:`${P}__horizontal-layout-rtl`,analysisInput:`${P}__analysis-input`,errorMessage:`${P}__error-message`},k=new Set([r.A.GPFeatureRecordSetLayer,r.A.GPRecordSet]),M=({direction:e,entryIndex:a,values:t,parameterInfos:s,valueWithoutKey:l,removeLabel:n,onEntryDeleted:o,onValueChange:h,onSetRef:p,doCalciteInputChangeOnCommit:d,clearEnabled:u,props:y})=>{const m=s[0],v=m?.label;return l?(0,i.h)("div",{class:`${E.groupHorizontal} ${"rtl"===e?E.groupHorizontal:""}`,key:a},Boolean(v)&&(0,i.h)("analysis-label",{label:v,hideHelp:!0,required:!0===m.required||m.parameterType===c}),(0,i.h)(r.a,{...m,label:"",onValueChange:e=>h(a,s[0].name,e),onSetRef:e=>p(a,s[0].name,e),value:t[s[0].name],doCalciteInputChangeOnCommit:d,clearEnabled:u}),(0,i.h)("calcite-button",{kind:"neutral","icon-start":"x",appearance:"transparent",scale:"s",class:E.groupAction1,onClick:()=>o(a),label:n})):(0,i.h)("div",{class:E.groupContainer,key:a},(0,i.h)("calcite-button",{"icon-end":"trash",appearance:"transparent",kind:"neutral",scale:"s",class:E.groupAction,onClick:()=>o(a),label:n}),s.filter((e=>!("visible"in e&&!1===e.visible))).map((e=>{const s="required"in e&&!0===e.required||e.parameterType===c;return(0,i.h)(r.a,{...e,...y,class:E.analysisInput,required:s,label:e.label??e.displayName,onValueChange:t=>h(a,e.name,t),onSetRef:t=>p(a,e.name,t),value:t?.[e.name],hideHelp:!0,doCalciteInputChangeOnCommit:d})})))};function A(e){return void 0!==e.name}const _=class{constructor(e){(0,i.r)(this,e),this.analysisValueTableChange=(0,i.c)(this,"analysisValueTableChange",7),this.analysisHelpClick=(0,i.c)(this,"analysisHelpClick",7),this.direction="ltr",this.entryInputElements=new Map,this.onAddButtonClick=()=>{this.value=this.valueWithoutKey?[...this.value,void 0]:[...this.value,this.getDefaultEntry()],this.analysisValueTableChange.emit()},this.onEntryDeleted=e=>{this.value.splice(e,1),this.removeAndUpdateEntryInputElements(e),this.value=[...this.value],this.analysisValueTableChange.emit()},this.onValueChange=async(e,a,t)=>{const i=t.target.value;this.valueWithoutKey?this.value[e]=i:this.value[e][a]=i;const[,s]=await this.applyRulesToEntry(e);this.value[e]=s,this.analysisValueTableChange.emit()},this.onSetRef=(e,a,t)=>{const i=this.entryInputElements.get(e);if(t)if(this.valueWithoutKey)this.entryInputElements.set(e,t);else{const s={[a]:t};this.entryInputElements.set(e,{...i??{},...s})}else if(this.valueWithoutKey)this.entryInputElements.delete(e),this.value.splice(e,1);else{delete i?.[a];const t=this.value[e];t&&delete t[a]}},this.validateSelection=async()=>{let e=!0;this.errorMessage=void 0;const a=!1===(0,s.i)(this.value)&&!0===(0,s.i)(this.value.every((e=>void 0!==e))),t=(0,s.f)((0,s.m)(this.strings,this.validationParams)),i=this.value.flat(2).some((e=>!(0,s.i)(e))),r=!1===a&&!1===i,l=void 0!==this.minGroupCount&&(!0===this.required||!1===r)&&this.value.length<this.minGroupCount,n=void 0!==this.maxGroupCount&&this.value.length>this.maxGroupCount;!0===this.required&&r?(e=!1,this.errorMessage=void 0!==this.validationParams?.message?t:this.strings.requiredMessage):(l||n)&&(e=!1,this.errorMessage=void 0!==this.validationParams?.message?t:(0,s.a)(l?this.strings.minGroupsMessage:this.strings.maxGroupsMessage,{minCount:`${this.minGroupCount??0}`,maxCount:`${this.maxGroupCount??Number.MAX_SAFE_INTEGER}`}));const o=(await this.checkEntriesValidity()).every((e=>!0===e));return e&&o},this.checkEntriesValidity=async()=>{const e=Array.from(this.entryInputElements.keys()).map((e=>{const a=this.entryInputElements.get(e);return(this.valueWithoutKey?[a]:Object.values(a)).map(this.checkEntryValidity)}));return Promise.all(e.flat())},this.checkEntryValidity=e=>!1===(0,s.i)(e)&&"checkValidity"in e&&"function"==typeof e.checkValidity?e.checkValidity():Promise.resolve(!0),this.getDefaultEntry=()=>{const e=this.combinedParameterInfos.filter((e=>void 0!==e.defaultValue)).map((e=>[e.name,e.defaultValue]));return Object.fromEntries(e)},this.required=!1,this.value=[],this.label=void 0,this.maxGroupCount=void 0,this.minGroupCount=void 0,this.parameterInfos=void 0,this.UIparameterInfos=void 0,this.UIparameterInfosRules=void 0,this.valueWithoutKey=!1,this.user=void 0,this.portal=void 0,this.mapLayers=void 0,this.mapView=void 0,this.supportsUpload=!1,this.serviceUrl=void 0,this.validationParams=void 0,this.doCalciteInputChangeOnCommit=void 0,this.clearEnabled=void 0,this.errorMessage=void 0,this.entryElements=void 0}async checkValidity(){const e=await this.validateSelection(),{message:a,type:t}=this.validationParams||{},i=!1===(void 0!==a)||!0===("informative"===t);return!0===e&&void 0===this.errorMessage&&!0===i}get combinedParameterInfos(){let e=this.parameterInfos??[];return void 0!==this.UIparameterInfos&&(e=this.UIparameterInfos.filter(A).map((e=>{const a=this.parameterInfos?.find((a=>a.name===e.name));return{...a,...e}}))),e}get rulesByDestination(){return(0,r.g)(this.UIparameterInfosRules??[])}async componentWillLoad(){if(({strings:this.strings,dir:this.direction}=await(0,s.d)(this.hostElement,(0,i.a)("."))),void 0===this.value||0===this.value.length){const e=this.valueWithoutKey?void 0:this.getDefaultEntry();this.value=[e],!1===(0,s.i)(e)&&this.analysisValueTableChange.emit()}}async componentWillRender(){this.entryElements=await Promise.all(this.value.map((async(e,a)=>{const[t,s]=await this.applyRulesToEntry(a);let r={};if(this.valueWithoutKey){r[t[0].name]=s}else r=s;return(0,i.h)(M,{direction:this.direction,entryIndex:a,values:r,valueWithoutKey:this.valueWithoutKey,parameterInfos:t,removeLabel:this.strings.removeEntryButtonLabel,onEntryDeleted:this.onEntryDeleted,onValueChange:this.onValueChange,onSetRef:this.onSetRef,doCalciteInputChangeOnCommit:this.doCalciteInputChangeOnCommit,clearEnabled:this.clearEnabled,props:{user:this.user,portal:this.portal,mapLayers:this.mapLayers,mapView:this.mapView,supportsUpload:this.supportsUpload,serviceUrl:this.serviceUrl}})})))}render(){return(0,i.h)(i.H,{key:"d02e8704bcb4f25b5416f98a1b4ad1eb960f37d6"},(0,i.h)("analysis-label",{key:"3d5becdc6db3241b14568937771213a2e0e7ae15",label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}),this.entryElements,(0,i.h)("calcite-button",{key:"f9191472917500009bd6adf131107a4b7dee9c75",style:this.valueWithoutKey?{marginTop:"var(--analysis-half-spacing)"}:{},appearance:"outline",kind:"neutral","icon-start":"plus",width:"full",scale:s.U.Scale,onClick:this.onAddButtonClick},this.strings.addEntryButtonLabel),this.renderErrorMessage())}renderErrorMessage(){const e=!1===(0,s.i)(this.validationParams?.message)||void 0!==this.errorMessage,a=(0,s.f)((0,s.m)(this.strings,this.validationParams)),t=void 0!==this.validationParams?(0,s.g)(this.validationParams.type):s.b.INVALID;return(0,i.h)("calcite-input-message",{class:E.errorMessage,hidden:!e,icon:"exclamationMarkTriangle",scale:s.U.Scale,status:t},a??this.errorMessage)}removeAndUpdateEntryInputElements(e){const a=this.entryInputElements.size;if(e>=0&&e<a){const a=new Map;for(const[t,i]of this.entryInputElements){const s=t>e?t-1:t;t!==e&&a.set(s,i)}this.entryInputElements=a}}getSelectedLayersForParameter(e,a){const t=a?.[e.name];let i;if("dataType"in e&&"string"==typeof e?.dataType&&k.has(e?.dataType)&&void 0!==t){const e=t;i=(0,s.a2)(e?.url??e?.layerDefinition?.name,this.mapLayers??[])}return i}async applyRulesToEntry(e){if(this.valueWithoutKey)return[this.combinedParameterInfos,this.value[e]];const a=this.rulesByDestination,t=this.value[e],i=this.entryInputElements.get(e);let s;s=void 0===i?{}:i;const l=Object.entries(s).reduce(((e,[a,t])=>(void 0!==t&&(e[a]=t),e)),{});return[await Promise.all(this.combinedParameterInfos.map((async e=>{const i={selectedLayers:this.getSelectedLayersForParameter(e,t),...e};let[s]=await(0,r.c)({param:i,data:t,rules:a.get(e.name)??[],renderedParameters:l});return[s]=(0,r.d)({param:s,data:t,renderedParameters:l}),s}))),t]}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.g)(this)}};_.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:block;margin-bottom:var(--analysis-half-spacing)}.value-table__group-container{display:flex;flex-direction:column;border:1px var(--calcite-color-border-1) solid;border-radius:var(--calcite-border-radius);padding:var(--analysis-half-spacing) var(--analysis-half-spacing) 0 var(--analysis-half-spacing);margin-bottom:var(--analysis-half-spacing)}.value-table__group-action{align-self:flex-end}.value-table__group-action-1{align-self:flex-start}.value-table__label{margin:var(--analysis-half-spacing) 0}.value-table__horizontal-layout{display:flex;border:1px var(--calcite-color-border-1) solid;width:calc(100% - var(--analysis-half-spacing) - 1px);margin-top:-1px;padding-top:var(--analysis-half-spacing);padding-left:var(--analysis-half-spacing)}.value-table__horizontal-layout-rtl{padding-left:unset;padding-right:var(--analysis-half-spacing)}.value-table__analysis-input{margin-bottom:var(--analysis-half-spacing)}.value-table__error-message{margin-top:var(--analysis-quarter-spacing)}"}}]);