"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-1b7d85"],{60567:(e,t,a)=>{a.d(t,{F:()=>i,N:()=>r,R:()=>l});const i={Mosaic:0,Item:1,ItemGroup:2},l={CORE:"CORE",STANDARD:"STANDARD"},r={INTEGER:"integer",FLOAT:"float"}},36064:(e,t,a)=>{a.r(t),a.d(t,{rfx_cte_weighted_overlay_table_editor:()=>b});var i=a(6225),l=(a(5294),a(13661),a(18423),a(21255),a(35431),a(93210)),r=a(22493),s=a(74229),n=a(76529),c=a(42776),d=(a(23795),a(17902),a(56451),a(81965)),o=(a(588),a(71802),a(44345),a(32513),a(33752),a(36596),a(60567));const h="rfx-cte-weighted-overlay-table-editor",u={colorRed:`${h}__color-red`,grid:`${h}__grid`,layerColumn:`${h}__layer-column`,influenceColumn:`${h}__influence-column`,fieldColumn:`${h}__field-column`,valueColumn:`${h}__value-column`,scaleColumn:`${h}__scale-column`},f="weightedOverlayTableHelpClickHandler",p="remapTableHelpClickHandler",g="scalesHelpClickHandler",m=[{key:"1-3",label:"1-3"},{key:"1-5",label:"1-5"},{key:"1-7",label:"1-7"},{key:"1-9",label:"1-9"},{key:"1-10",label:"1-10"},{key:"1-20",label:"1-20"},{key:"1-25",label:"1-25"},{key:"1-50",label:"1-50"},{key:"1-75",label:"1-75"},{key:"1-100",label:"1-100"}],v={influence:{numberType:o.N.INTEGER,min:0,max:100},layer:{required:!0}},b=class{constructor(e){(0,i.r)(this,e),this.rfxArgumentChange=(0,i.c)(this,"rfxArgumentChange",7),this.helpActionClickEventHandlers=new Map,this.scalesOptions=m,this.refreshRemapsGrid=()=>{const e=this.getRemapGridData();(0,r.p)(e)||(this.remapsGridSchema={...this.remapsGridSchema,gridOptions:e})},this.handleGridRowClick=e=>{const{detail:{gridOptions:t,rowIndex:a}}=e;a<0||a>t?.length-1||(this.selectedRowId=a,this.refreshRemapsGrid())},this.updateValue_weightedOverlayTable=async e=>{const{detail:{gridOptions:t,rowIndex:a,columnName:i}}=e,l=this.inputArgs;if((0,r.p)(t)||(0,r.p)(l))return;const s=[],n=[],c=[];let o=0,h=!1,u=!1,f=!1;t.forEach(((e,a)=>{if(a===t.length-1)return;const{layer:i,influence:l,field:h}=e;if((0,r.p)(i)||(0,r.p)(h))return;s.push(i),c.push(h);let u=(0,d.p)(l);((0,r.p)(u)||isNaN(u))&&(u=0===a?100:0),o+=u,n.push(u/100)})),o!==this.sumOfInfluence&&(h=!0,this.updateSumOfInfluenceElement(o)),u="layer"===i,f="field"===i;const p=l.Rasters,g=l.Influences,m=l.Fields,v=l.Remaps;let b;if(f&&m.value?.[a]===c[a]&&(f=!1),(0,r.p)(p.value)?p.value={elements:s,type:"ArgumentArray"}:p.value.elements=s,g.value=n,m.value=c,t.length>this.weightedOverlayGridOptionsLength?b=t[a]:t.length<this.weightedOverlayGridOptionsLength?(this.deleteLayerRemapStr(a),this.selectedRowId=a+1):t.length===this.weightedOverlayGridOptionsLength&&(h||(b=t[a])),v?.value&&(u&&b?.layer||f)){this.selectedRowId=a;const e=t.length-1;await this.initLayerRemapStr(b,a,e)}this.refreshRemapsGrid(),this.weightedOverlayGridOptionsLength=t.length},this.updateValue_remapTable=e=>{const{detail:{gridOptions:t}}=e,a=this.inputArgs;if((0,r.p)(t)||(0,r.p)(a))return;const i=a.Remaps,l=i?.value?.length;if((0,r.p)(l)||l<1||this.selectedRowId<0||this.selectedRowId>l-1)return;let s="";const n=t.length-1;t.forEach((function(e,t){const{value:a,scale:i}=e;if(!(0,r.p)(a)&&!(0,r.p)(i?.value)){let e=a;const l=i.value;"string"==typeof a&&(e=a.indexOf(" ")>-1?"'"+a+"'":a),s+=e+" "+l,t<n-1&&(s+=" ; ")}})),i.value[this.selectedRowId]=s},this.updateValue_scales=async e=>{e.stopPropagation();const t=e.target.value.replace(/\s/g,"").split("-");if(2!==t.length)return;const a=parseInt(t[0],10),i=parseInt(t[1],10);if(isNaN(a)||isNaN(i)||a>i)return;this.evalScales={evalFrom:a,evalTo:i},this.inputArgs.EvalFrom.value=a,this.inputArgs.EvalTo.value=i;const l=this.selectedRowId,r=this.weightedOverlayGridSchema.gridOptions?.[l],s=this.weightedOverlayGridSchema.gridOptions?.length;await this.initLayerRemapStr(r,l,s),this.refreshRemapsGrid()},this.weightedOverlayGridSchema={canAdd:!0,gridLayout:{},gridOptions:[],hasBorder:!0,hasHeader:!0,hasIdColumn:!0},this.remapsGridSchema={canAdd:!0,gridLayout:{},gridOptions:[],hasBorder:!0,hasHeader:!0,hasIdColumn:!0},this.sumOfInfluence=0,this.evalScales=void 0,this.widgetArgs=void 0}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.c)(this.hostElement,(0,i.a)(".")));const{inputArgs:e,inputLayers:t}=this.widgetArgs;this.inputArgs=e,this.inputLayers=t,this.initScalesSelectOptions(),await this.initGrids()}componentDidLoad(){this.attachHelpClickEventHandlers()}async checkValidity(){return await this.gridElement.checkValidity()}attachHelpClickEventHandlers(){const e=this.widgetArgs.onHelpActionClick({heading:this.strings.weightedOverlayTable,referenceElement:this.weightedOverlayTableLabelElement,helpTextID:this.widgetArgs.helpTextIDs?.weightedoverlay_weightedoverlaytable});this.helpActionClickEventHandlers.set(f,e);const t=this.widgetArgs.onHelpActionClick({heading:this.strings.remapTable,referenceElement:this.remapTableLabelElement,helpTextID:this.widgetArgs.helpTextIDs?.weightedoverlay_remaptable});this.helpActionClickEventHandlers.set(p,t);const a=this.widgetArgs.onHelpActionClick({heading:this.strings.scales,referenceElement:this.scalesLabelElement,helpTextID:this.widgetArgs.helpTextIDs?.weightedoverlay_scales});this.helpActionClickEventHandlers.set(g,a)}async getSelectedLayer(e){const t=(0,s.g)(e),a=this.inputLayers.find((e=>e.url===t));return a&&await a.load(),a}getScaleOptions(){const e=[];for(let t=this.evalScales.evalFrom;t<=this.evalScales.evalTo;t++)e.push({key:t.toString(),label:t.toString()});return e.push({key:"NODATA",label:"NODATA"}),e.push({key:"RESTRICTED",label:"RESTRICTED"}),e}getDefaultGridOption_weightedOverlayTable(){return{id:0,layer:void 0,field:void 0,influence:0}}getDefaultGridOption_remapTable(){return{id:0,value:void 0,scale:{options:this.getScaleOptions(),value:void 0}}}getRemapGridData(){const e=this.inputArgs?.Remaps,t=this.selectedRowId,a=[];if(t<0||t>e?.value?.length-1)return a;if(e?.value?.[t]){e.value[t].split(";").forEach(((e,t)=>{const i=e.trim().match(/(?:[^\s']+|'[^']*')+/g);if((0,r.p)(i)||2!==i.length)return;let l=i[0];const s=i[1];l.indexOf("'")>-1&&(l=l.replace(/[']+/g,"")),a.push({id:t,value:l,scale:{options:this.getScaleOptions(),value:s}})}));const i=a.length;a.push({id:i,value:void 0,scale:{options:this.getScaleOptions(),value:void 0}})}else a.push(this.getDefaultGridOption_remapTable());return a}async readArgValues(){if((0,r.p)(this.inputArgs))return;const e=this.inputArgs,t=[],a=e.Rasters,i=e.Fields,l=e.Influences,n=e.Remaps,c=a?.value?.elements??a?.value??[];let d=[],o=0,h=0;if((0,r.p)(a)||(0,r.p)(i)||(0,r.p)(l)||(0,r.p)(n)||(o=Math.max(c?.length||0,i.value?.length||0,l.value?.length||0,n.value?.length||0),n.value=n.value??[]),0===o||isNaN(o))return t.push(this.getDefaultGridOption_weightedOverlayTable()),d.push(this.getDefaultGridOption_remapTable()),[t,d];for(;h<o;){const e=c?.[h],a=e?.value;(0,r.p)(a?.url)||(e.value=await(0,s.w)(a,this.inputLayers)),t.push({id:h,rasterElement:e,layer:e,field:i?.value?.[h],influence:(l?.value?.[h]&&((100*l.value[h]).toFixed(2)||(h>0?0:100)))??0}),h+=1}if(n?.value?.length>0)t?.length>0&&t[0]?.layer&&t[0]?.field&&(this.selectedRowId=0,d=this.getRemapGridData());else for(let e=0;e<o;e++)n.value.push("");return[t,d]}async initGrids(){const e={layer:{allowScalar:!1,label:this.strings.layer,uiType:n.G.raster,style:u.layerColumn,validationRule:v.layer},influence:{label:this.strings.influence,uiType:n.G.number,style:u.influenceColumn,validationRule:v.influence},field:{label:this.strings.field,uiType:n.G.field,style:u.fieldColumn}},t={value:{label:this.strings.value,uiType:n.G.textInput,style:u.valueColumn},scale:{label:this.strings.scale,uiType:n.G.select,style:u.scaleColumn}},a=await this.readArgValues(),i=a[0],l=a[1];this.weightedOverlayGridOptionsLength=(i?.length??0)+1,this.weightedOverlayGridSchema={...this.weightedOverlayGridSchema,gridLayout:e,gridOptions:i},this.remapsGridSchema={...this.remapsGridSchema,gridLayout:t,gridOptions:l}}initScalesSelectOptions(){if((0,r.p)(this.inputArgs))return;const{EvalFrom:e,EvalTo:t}=this.inputArgs,a=e?.value??1,i=t?.value??9;this.evalScales={evalFrom:a,evalTo:i};const l=`${a}-${i}`;this.scalesOptions.some((e=>e.key===l))||this.scalesOptions.push({key:l,label:l})}updateSumOfInfluenceElement(e){this.sumOfInfluence=e,e>100?this.sumOfInfluenceElement.classList.add(u.colorRed):this.sumOfInfluenceElement.classList.remove(u.colorRed)}async initLayerRemapStr(e,t,a){if((0,r.p)(e)||t<0||a<=0||t>a-1)return;const{layer:i,field:l}=e,{evalFrom:s,evalTo:n}=this.evalScales;if((0,r.p)(i)||(0,r.p)(l))return;let c="";if(!(0,r.p)(i.value?.url)){const e=await this.getSelectedLayer(i.value?.url),t=await(e?.generateRasterInfo(e.rasterFunction));if((0,r.p)(e))return;if(e.sourceJSON?.hasRasterAttributeTable&&l){const a=(0,r.n)(e)?e.serviceRasterInfo.attributeTable:t.attributeTable,i=a?.features;if((0,r.p)(i))return;const d=i.map((e=>e.attributes[l])).filter((function(e,t,a){return a.indexOf(e)===t}));d?.length>1&&!isNaN(d[0])&&d.sort((function(e,t){return e-t}));c=d.map((function(e,t){"string"==typeof e&&(e=e.indexOf(" ")>-1?"'"+e+"'":e);return`${e} ${t+s<=n?t+s:s}`})).join(" ; ")}}const d=t,o=this.inputArgs.Remaps;this.inputArgs.Fields.value.splice(d,1,l),o.value.length===a&&o.value.splice(d,1,c),o.value.length<a&&o.value.splice(d,0,c)}deleteLayerRemapStr(e){this.inputArgs.Remaps.value.splice(e,1)}render(){return(0,i.h)("div",{key:"7e4b2adfed309ce4a66ab1e60369f6a61d6a4585"},(0,i.h)("calcite-label",{key:"142c79f1a47698631d6ea6ed056a3c0a28681eff",alignment:"start",scale:c.U.Scale,layout:"default",ref:e=>{this.weightedOverlayTableLabelElement=e}},(0,i.h)("rfx-label",{key:"36119a7bbdee021f9db10b74ebdb2dd87d9d511b",label:this.strings.weightedOverlayTable,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(f)()}),(0,i.h)("rfx-grid",{key:"4e88dc6d00d84d3371ae10ec8016fcf3f1040180",canAdd:this.weightedOverlayGridSchema.canAdd,class:u.grid,gridLayout:this.weightedOverlayGridSchema.gridLayout,gridOptions:this.weightedOverlayGridSchema.gridOptions,hasBorder:this.weightedOverlayGridSchema.hasBorder,hasHeader:this.weightedOverlayGridSchema.hasHeader,hasIdColumn:this.weightedOverlayGridSchema.hasIdColumn,inputLayers:this.widgetArgs.inputLayers,onRfxGridRowClick:this.handleGridRowClick,onRfxGridOptionChange:this.updateValue_weightedOverlayTable,rfxBrowseLayerClick:this.widgetArgs.onRfxBrowseLayerClick,ref:e=>{this.gridElement=e}})),(0,i.h)("calcite-label",{key:"788f178fdca36c67fb3fe513c9844fa64d878b37",alignment:"start",scale:c.U.Scale,layout:"inline-space-between"},(0,i.h)("span",{key:"2988584a0ee6e428f4f7901bb60cdf9ba9eebd16"},this.strings.sumOfInfluence),(0,i.h)("span",{key:"7c651c2e3f2408c643d59f3c41304ac4847be7b3",ref:e=>{this.sumOfInfluenceElement=e}},this.sumOfInfluence)),(0,i.h)("calcite-label",{key:"736098a38e0f019263fc804a8795bbffedec173f",alignment:"start",scale:c.U.Scale,layout:"default",ref:e=>{this.remapTableLabelElement=e}},(0,i.h)("rfx-label",{key:"97a3795463f86b27aeb53eb59ee15de8ef06a643",label:this.strings.remapTable,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(p)()}),(0,i.h)("rfx-grid",{key:"071e557218a4eeb2ee90878af5c2ef6237d727fd",canAdd:this.remapsGridSchema.canAdd,class:u.grid,gridLayout:this.remapsGridSchema.gridLayout,gridOptions:this.remapsGridSchema.gridOptions,hasBorder:this.remapsGridSchema.hasBorder,hasHeader:this.remapsGridSchema.hasHeader,hasIdColumn:this.remapsGridSchema.hasIdColumn,onRfxGridOptionChange:this.updateValue_remapTable})),(0,i.h)("calcite-label",{key:"84d764367dde27557f21389c7055a5099e861e4e",alignment:"start",scale:c.U.Scale,layout:"default",ref:e=>{this.scalesLabelElement=e}},(0,i.h)("rfx-label",{key:"9ba3f863ddb362a1b11ac30cd14da7c410dd3513",label:this.strings.scales,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(g)()}),(0,i.h)("rfx-dtex-common-select",{key:"ecbbd13d569cc2651f6d32df41003c7a9606e471",mode:this.widgetArgs.mode,allowCustomValues:!0,options:this.scalesOptions,onRfxArgumentChange:this.updateValue_scales,value:`${this.evalScales.evalFrom}-${this.evalScales.evalTo}`})))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.d)(this)}};b.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-cte-weighted-overlay-table-editor__grid table{width:100%;table-layout:fixed}.rfx-cte-weighted-overlay-table-editor__grid table thead tr th:first-child{width:7%}.rfx-cte-weighted-overlay-table-editor__grid table thead tr th:last-child{width:7%}.rfx-cte-weighted-overlay-table-editor__grid table tbody tr td:first-child{width:7%}.rfx-cte-weighted-overlay-table-editor__grid table tbody tr td:last-child{width:7%}.rfx-cte-weighted-overlay-table-editor__color-red{color:red}.rfx-cte-weighted-overlay-table-editor__layer-column{width:40%}.rfx-cte-weighted-overlay-table-editor__influence-column{width:16%}.rfx-cte-weighted-overlay-table-editor__field-column{width:30%}.rfx-cte-weighted-overlay-table-editor__scale-column{width:30%}";a(55448),a(2924),a(11840),a(52373),a(440),a(66744)},81965:(e,t,a)=>{a.d(t,{a:()=>d,f:()=>c,i:()=>r,p:()=>n,s:()=>s});var i=a(93210),l=a(22493);function r(e){return null!=e&&!1===Number.isNaN(e)&&!0===Number.isFinite(e)}function s(e,t){let a;if(null!==e){const i="string"==typeof e?Number.parseFloat(e):e;r(i)?a=i:r(t)&&(a=t)}return void 0===a?"":`${a}`}function n(e){if(!(0,l.p)(e))return Number.parseFloat(e)}function c(e,t=3){if(!(0,l.p)(e))return Number.parseFloat(e.toFixed(t))}function d(e,t){let a="";if(!(0,l.p)(e)&&!Number.isNaN(e)){const l=(0,i.g)().locale;a=Intl.NumberFormat(l,t).format(Number(e))}return a}},42776:(e,t,a)=>{a.d(t,{C:()=>l,U:()=>i,a:()=>r,u:()=>s});const i={Scale:"s",PopoverTimer:60},l={s:"s",m:"m",l:"l"},r={absolute:"absolute",fixed:"fixed"},s=e=>e===l.s?l.m:l.l}}]);