/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-792038.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-792038"],{22750:(e,t,r)=>{r.r(t),r.d(t,{arcgis_filter:()=>T,arcgis_filter_expression:()=>W});var s=r(28614),i=r(48122),a=r(50466),n=r(71480),o=r(97127),l=r(50063);r(68180);const p="empty-msg",c="msg-icon",d="tip-msg",u="header-info",h="match-expression-msg",f="match-expression-dropdown",g="match-type",m="notice";function y(e){let t="";if(!e.expressions?.length)return;let r="",s=0;for(let i=0;i<e.expressions.length;i++){const n=v(e.expressions[i],e);n.length&&(0===s?t=n:1===s?(r=` ${e.logicalOperatorForExpressions===a.l.OR?"OR":"AND"} `,t=`(${t})${r}(${n})`):t+=`${r}(${n})`,s++)}return t.length?t:void 0}function v(e,t){let r="";if(1===e.conditions.length)r=b(e.conditions[0],t);else{let s="";for(let i=0;i<e.conditions.length;i++){const n=b(e.conditions[i],t);n.length&&(r+=s+n,s=` ${e.logicalOperatorForConditions===a.l.OR?"OR":"AND"} `)}}return r}function b(e,t){const{layer:r,strings:s}=t,i=e.fieldName,n=e.operator;let o=e.value,l=e.value2;const p=e.values||[],c=e.unit,d=(0,a.g)(i,t);if(!d)return"";if((0,a.i)(t,n)&&!(0,a.a)(l))return"";if((0,a.b)(t,n)&&!p.length)return"";if((0,a.c)(t,n)&&!(0,a.a)(o))return"";if(!((0,a.a)(o)||p.length||(0,a.d)(t,n)||(0,a.e)(t,n)||(0,a.f)(t,n)))return"";let u="";if(d.simpleFieldType===a.s.STRING||d.simpleFieldType===a.s.GUID){const n=(0,a.j)(d),l=(0,a.k)(d),c=(0,a.m)(d),h=(0,a.n)(d),f=(0,a.o)(d),g=n&&(0,a.a)(o)&&t.isHosted&&function(e){if("number"==typeof e)return!1;for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}(o)?"N":"",m=o?.toString().replace(/'/gu,"''"),y=e=>{let s="";if(n)s=e?.toString().replace(/'/gu,"''"),s=`${g}'${s}'`;else if(l)s=e.toString();else if(c){s=`${t.supportsStandardizedQuery?"timestamp ":""}'${E(e,r.fieldsIndex.getTimeZone(i)||"UTC")}'`}else if(h){const r=t.supportsStandardizedQuery?"DATE ":"";let i;i="number"==typeof e?(0,a.u)(e):e,s=`${r}'${i}'`}else if(f){s=`${t.supportsStandardizedQuery?"TIME ":""}'${"number"==typeof e?(0,a.h)(e):e}'`}return s};switch(e.operator){case s.operators.stringOperatorIs:u=`${i} = ${y(o)}`;break;case s.operators.stringOperatorIsNot:u=`${i} <> ${y(o)}`;break;case s.operators.stringOperatorStartsWith:u=`${i} LIKE ${g}'${m}%'`;break;case s.operators.stringOperatorEndsWith:u=`${i} LIKE ${g}'%${m}'`;break;case s.operators.stringOperatorContains:u=`${i} LIKE ${g}'%${m}%'`;break;case s.operators.stringOperatorDoesNotContain:u=`${i} NOT LIKE ${g}'%${m}%'`;break;case s.operators.stringOperatorIncludes:u=`${i} IN (${p.map((e=>y(e)))})`;break;case s.operators.stringOperatorExcludes:u=`${i} NOT IN (${p.map((e=>y(e)))})`;break;case s.operators.stringOperatorIsBlank:u=`${i} IS NULL`;break;case s.operators.stringOperatorIsNotBlank:u=`${i} IS NOT NULL`;break;case s.operators.stringOperatorIsEmpty:u=`${i} = ''`;break;case s.operators.stringOperatorIsNotEmpty:u=`${i} <> ''`;break;case s.operators.stringOperatorIsCurrentUser:u=`${i} = CURRENT_USER`;break;case s.operators.stringOperatorIsNotCurrentUser:u=`${i} <> CURRENT_USER`}}else if(d.simpleFieldType===a.s.NUMBER||d.simpleFieldType===a.s.OID)switch(n){case s.operators.numberOperatorIs:u=`${i} = ${o}`;break;case s.operators.numberOperatorIsNot:u=`${i} <> ${o}`;break;case s.operators.numberOperatorIsAtLeast:u=`${i} >= ${o}`;break;case s.operators.numberOperatorIsLessThan:u=`${i} < ${o}`;break;case s.operators.numberOperatorIsAtMost:u=`${i} <= ${o}`;break;case s.operators.numberOperatorIsGreaterThan:u=`${i} > ${o}`;break;case s.operators.numberOperatorIsBetween:u=`${i} BETWEEN ${o} AND ${l}`;break;case s.operators.numberOperatorIsNotBetween:u=`${i} NOT BETWEEN ${o} AND ${l}`;break;case s.operators.numberOperatorIncludes:u=`${i} IN (${p.toString()})`;break;case s.operators.numberOperatorExcludes:u=`${i} NOT IN (${p.toString()})`;break;case s.operators.numberOperatorIsBlank:u=`${i} IS NULL`;break;case s.operators.numberOperatorIsNotBlank:u=`${i} IS NOT NULL`}else if(d.simpleFieldType===a.s.DATE_ONLY){const e=t.supportsStandardizedQuery?"DATE ":"";let r,h;switch(r="number"==typeof o?(0,a.u)(o):o,(0,a.a)(l)&&"number"==typeof l?h=(0,a.u)(l):(0,a.a)(l)&&(h=l),n){case s.operators.dateOperatorIsOn:u=`${i} = ${e}'${r}'`;break;case s.operators.dateOperatorIsNotOn:u=`${i} <> ${e}'${r}'`;break;case s.operators.dateOperatorIsBefore:u=`${i} < ${e}'${r}'`;break;case s.operators.dateOperatorIsAfter:u=`${i} > ${e}'${r}'`;break;case s.operators.dateOperatorInTheLast:u=`${i} BETWEEN ${x(t,d,o,c)}`;break;case s.operators.dateOperatorNotInTheLast:u=`${i} NOT BETWEEN ${x(t,d,o,c)}`;break;case s.operators.dateOperatorIsBetween:u=`${i} BETWEEN ${e}'${r}' AND ${e}'${h}'`;break;case s.operators.dateOperatorIsNotBetween:u=`${i} NOT BETWEEN ${e}'${r}' AND ${e}'${h}'`;break;case s.operators.dateOperatorIncludes:case s.operators.dateOperatorExcludes:{let t="",r="";p.forEach((s=>{const i="number"==typeof s?(0,a.u)(s):s;t+=`${r}${e}'${i}'`,r=","})),u=n===s.operators.numberOperatorIncludes?`${i} IN (${t})`:`${i} NOT IN (${t})`;break}case s.operators.dateOperatorIsBlank:u=`${i} IS NULL`;break;case s.operators.dateOperatorIsNotBlank:u=`${i} IS NOT NULL`}}else if(d.simpleFieldType===a.s.TIME_ONLY){const e=t.supportsStandardizedQuery?"TIME ":"";switch("number"==typeof o&&(o=(0,a.h)(o)),(0,a.a)(l)&&"number"==typeof l&&(l=(0,a.h)(l)),n){case s.operators.dateOperatorIsOn:u=`${i} = ${e}'${o}'`;break;case s.operators.dateOperatorIsNotOn:u=`${i} <> ${e}'${o}'`;break;case s.operators.dateOperatorIsBefore:u=`${i} < ${e}'${o}'`;break;case s.operators.dateOperatorIsAfter:u=`${i} > ${e}'${o}'`;break;case s.operators.dateOperatorIsBeforeOrEqual:u=`${i} <= ${e}'${o}'`;break;case s.operators.dateOperatorIsAfterOrEqual:u=`${i} >= ${e}'${o}'`;break;case s.operators.dateOperatorIsBetween:u=`${i} BETWEEN ${e}'${o}' AND ${e}'${l}'`;break;case s.operators.dateOperatorIsNotBetween:u=`${i} NOT BETWEEN ${e}'${o}' AND ${e}'${l}'`;break;case s.operators.dateOperatorIncludes:case s.operators.dateOperatorExcludes:{let t="",r="";p.forEach((s=>{t+=`${r}${e}'${"number"==typeof s?(0,a.h)(s):s}'`,r=","})),u=n===s.operators.numberOperatorIncludes?`${i} IN (${t})`:`${i} NOT IN (${t})`;break}case s.operators.dateOperatorIsBlank:u=`${i} IS NULL`;break;case s.operators.dateOperatorIsNotBlank:u=`${i} IS NOT NULL`}}else{const e=t.supportsStandardizedQuery?"timestamp ":"",a=r.fieldsIndex.getTimeZone(i)||"UTC",h=E(o,a),f=E(l,a);switch(n){case s.operators.dateOperatorIsOn:u=`${i} = ${e}'${h}'`;break;case s.operators.dateOperatorIsNotOn:u=`${i} <> ${e}'${h}'`;break;case s.operators.dateOperatorIsBefore:u=`${i} < ${e}'${h}'`;break;case s.operators.dateOperatorIsAfter:u=`${i} > ${e}'${h}'`;break;case s.operators.dateOperatorIsBeforeOrEqual:u=`${i} <= ${e}'${h}'`;break;case s.operators.dateOperatorIsAfterOrEqual:u=`${i} >= ${e}'${h}'`;break;case s.operators.dateOperatorInTheLast:u=`${i} BETWEEN ${x(t,d,o,c)}`;break;case s.operators.dateOperatorNotInTheLast:u=`${i} NOT BETWEEN ${x(t,d,o,c)}`;break;case s.operators.dateOperatorIsBetween:u=`${i} BETWEEN ${e}'${h}' AND ${e}'${f}'`;break;case s.operators.dateOperatorIsNotBetween:u=`${i} NOT BETWEEN ${e}'${h}' AND ${e}'${f}'`;break;case s.operators.dateOperatorIncludes:case s.operators.dateOperatorExcludes:{let t="",r="";p.forEach((s=>{t+=`${r}${e}'${E(s,a)}'`,r=","})),u=n===s.operators.dateOperatorIncludes?`${i} IN (${t})`:`${i} NOT IN (${t})`;break}case s.operators.dateOperatorIsBlank:u=`${i} IS NULL`;break;case s.operators.dateOperatorIsNotBlank:u=`${i} IS NOT NULL`}}return u}function E(e,t){const r=new Date(e),s=new Date(r.toLocaleString("en-US",{timeZone:t})),i=e=>String(e).padStart(2,"0"),a=i(s.getMonth()+1),n=i(s.getDate());return`${s.getFullYear()}-${a}-${n} ${i(s.getHours())}:${i(s.getMinutes())}:${i(s.getSeconds())}`}function x(e,t,r,s){const i=(0,a.n)(t)?"CURRENT_DATE":"CURRENT_TIMESTAMP";if(e.isHosted){let e=0;return e="year"===s?365*r:"month"===s?30*r:"week"===s?7*r:"day"===s?r:"hour"===s?r/24:r/1440,`${i} - ${e} AND ${i}`}{let e=0;return"year"===s?(e=365*r,`${i} - INTERVAL '${e}' DAY AND ${i}`):"month"===s?(e=30*r,`${i} - INTERVAL '${e}' DAY AND ${i}`):"week"===s?(e=7*r,`${i} - INTERVAL '${e}' DAY AND ${i}`):"day"===s?(e=r,`${i} - INTERVAL '${e}' DAY AND ${i}`):"hour"===s?`${i} - INTERVAL '${r}' HOUR AND ${i}`:`${i} - INTERVAL '${r}' MINUTE AND ${i}`}}async function O(e,t){const{layer:r,modules:s}=t;return!e?.length||(s.esriSql=s.esriSql||await(0,n.o)(),s.esriSql.parseWhereClause(e,r.fieldsIndex).then((e=>{const r=s.esriLang.clone(e);if(!r.isStandardized)return!1;t.expressions=[{conditions:[]}];const i=function(e,t){if(!t.expressions)return!1;return N(e)?I(e,t.expressions[0].conditions,t):(t.logicalOperatorForExpressions=$(e),I(e,t.expressions[0],t))}(r.parseTree,t);return t.expressions=(0,a.p)(t.expressions),i}),(e=>(console.error("SQLParser - error:",e),!1))))}function I(e,t,r){const{layer:s}=r;if(N(e)){if("column-reference"===e.left.type){const i=(0,a.g)(e.left.column,r),n=i?function(e,t,r,s){const{supportsCurrentUser:i,strings:n}=e;if(!r)return"";if(r.simpleFieldType===a.s.STRING)switch(t){case"=":return""===s.value?n.operators.stringOperatorIsEmpty:"current-user"===s.type?i?n.operators.stringOperatorIsCurrentUser:"":n.operators.stringOperatorIs;case"<>":return""===s.value?n.operators.stringOperatorIsNotEmpty:"current-user"===s.type?i?n.operators.stringOperatorIsNotCurrentUser:"":n.operators.stringOperatorIsNot;case"LIKE":return s.value.startsWith("%")&&s.value.endsWith("%")?(s.value=s.value.substring(1,s.value.length-1),n.operators.stringOperatorContains):s.value.endsWith("%")?(s.value=s.value.substring(0,s.value.length-1),n.operators.stringOperatorStartsWith):s.value.startsWith("%")?(s.value=s.value.substring(1),n.operators.stringOperatorEndsWith):n.operators.stringOperatorIs;case"NOT LIKE":return s.value.startsWith("%")&&s.value.endsWith("%")?s.value=s.value.substring(1,s.value.length-1):s.value.endsWith("%")?s.value=s.value.substring(0,s.value.length-1):s.value.startsWith("%")&&(s.value=s.value.substring(1)),n.operators.stringOperatorDoesNotContain;case"IS":return"null"===s.type?n.operators.stringOperatorIsBlank:n.operators.stringOperatorIs;case"ISNOT":case"IS NOT":return"null"===s.type?n.operators.stringOperatorIsNotBlank:n.operators.stringOperatorIs;case"IN":return n.operators.stringOperatorIncludes;case"NOT IN":case"NOTIN":return n.operators.stringOperatorExcludes}else if("number"===r.simpleFieldType||"oid"===r.simpleFieldType)switch(t){case"=":return n.operators.numberOperatorIs;case"<>":return n.operators.numberOperatorIsNot;case">=":return n.operators.numberOperatorIsAtLeast;case"<":return n.operators.numberOperatorIsLessThan;case"<=":return n.operators.numberOperatorIsAtMost;case">":return n.operators.numberOperatorIsGreaterThan;case"BETWEEN":return n.operators.numberOperatorIsBetween;case"NOT BETWEEN":case"NOTBETWEEN":return n.operators.numberOperatorIsNotBetween;case"IS":return"null"===s.type?n.operators.numberOperatorIsBlank:n.operators.numberOperatorIs;case"ISNOT":case"IS NOT":return"null"===s.type?n.operators.numberOperatorIsNotBlank:n.operators.numberOperatorIs;case"IN":return n.operators.numberOperatorIncludes;case"NOT IN":case"NOTIN":return n.operators.numberOperatorExcludes}else switch(t){case"=":return n.operators.dateOperatorIsOn;case"<>":return n.operators.dateOperatorIsNotOn;case"<":return n.operators.dateOperatorIsBefore;case">":return n.operators.dateOperatorIsAfter;case"<=":return n.operators.dateOperatorIsBeforeOrEqual;case">=":return n.operators.dateOperatorIsAfterOrEqual;case"BETWEEN":return"current-time"===s.value[0]?.left?.type?n.operators.dateOperatorInTheLast:n.operators.dateOperatorIsBetween;case"NOT BETWEEN":case"NOTBETWEEN":return"current-time"===s.value[0]?.left?.type?n.operators.dateOperatorNotInTheLast:n.operators.dateOperatorIsNotBetween;case"IS":if("null"===s.type)return n.operators.dateOperatorIsBlank;break;case"ISNOT":case"IS NOT":if("null"===s.type)return n.operators.dateOperatorIsNotBlank;break;case"IN":return n.operators.dateOperatorIncludes;case"NOT IN":case"NOTIN":return n.operators.dateOperatorExcludes}return""}(r,e.operator,i,e.right):void 0;if(!i||!n)return!1;{let o;if("null"===e.right.type)o={fieldName:i.layerField.name,operator:n};else{if("column-reference"===e.right.type)return!1;if("expression-list"===e.right.type&&(0,a.b)(r,n)){if("imagery"===s.type)return!1;if((0,a.m)(i)){const t=s.fieldsIndex.getTimeZone(i.layerField.name)||"UTC";o={fieldName:i.layerField.name,operator:n,values:e.right.value.map((e=>F(e.value,t)))}}else o=(0,a.n)(i)?{fieldName:i.layerField.name,operator:n,values:e.right.value.map((e=>w(e.value)))}:(0,a.o)(i)?{fieldName:i.layerField.name,operator:n,values:e.right.value.map((e=>C(e.value)))}:{fieldName:i.layerField.name,operator:n,values:e.right.value.map((e=>e.value))}}else if("expression-list"===e.right.type&&(0,a.c)(r,n)){const t=function(e){const t=e.right.value[0].right;let r=t.value;if("interval"!==t.type){if(Number.isNaN(r))return null;if(r%365==0)return{value:r/365,unit:"year"};if(r%30==0)return{value:r/30,unit:"month"};if(r%7==0)return{value:r/7,unit:"week"};if(r%1==0)return{value:r,unit:"day"};{const e=Math.round(24*r*60);return e%60==0?{value:Math.round(24*r),unit:"hour"}:{value:e,unit:"minute"}}}if(r="string"===t.value.type?Number.parseFloat(t.value.value):t.value.value,"day"===t.qualifier.period){if(r%365==0)return{value:r/365,unit:"year"};if(r%30==0)return{value:r/30,unit:"month"};if(r%7==0)return{value:r/7,unit:"week"};if(r%1==0)return{value:r,unit:"day"}}else{if("hour"===t.qualifier.period)return{value:r,unit:"hour"};if("minute"===t.qualifier.period)return{value:r,unit:"minute"}}}(e);if(!t)return!1;o={fieldName:i.layerField.name,operator:n,value:t.value,unit:t.unit}}else if("expression-list"===e.right.type&&(0,a.i)(r,n))if((0,a.m)(i)){const t=s.fieldsIndex.getTimeZone(i.layerField.name)||"UTC";o={fieldName:i.layerField.name,operator:n,value:F(e.right.value[0].value,t),value2:F(e.right.value[1].value,t)}}else o=(0,a.n)(i)?{fieldName:i.layerField.name,operator:n,value:w(e.right.value[0].value),value2:w(e.right.value[1].value)}:(0,a.o)(i)?{fieldName:i.layerField.name,operator:n,value:C(e.right.value[0].value),value2:C(e.right.value[1].value)}:{fieldName:i.layerField.name,operator:n,value:e.right.value[0].value,value2:e.right.value[1].value};else if("timestamp"===e.right.type)if(i.simpleFieldType===a.s.DATE_ONLY)o={fieldName:i.layerField.name,operator:n,value:e.right.value?.substring(0,10)};else{const t=s.fieldsIndex.getTimeZone(i.layerField.name)||"UTC";o={fieldName:i.layerField.name,operator:n,value:F(e.right.value,t)}}else if("date"===e.right.type)if("date-only"===i.layerField.type)o={fieldName:i.layerField.name,operator:n,value:w(e.right.value)};else{const t=s.fieldsIndex.getTimeZone(i.layerField.name)||"UTC";o={fieldName:i.layerField.name,operator:n,value:F(e.right.value,t)}}else o="time"===e.right.type?{fieldName:i.layerField.name,operator:n,value:C(e.right.value)}:{fieldName:i.layerField.name,operator:n,value:e.right.value}}t.push(o)}return!0}return!1}{let s;if(r.expressions=r.expressions||[],N(e.left)&&N(e.right))t.logicalOperatorForConditions=$(e),s=I(e.left,t.conditions,r),s=s&&I(e.right,t.conditions,r);else if(N(e.left))if(e.operator===e.right.operator&&N(e.right.left)&&N(e.right.right))t.logicalOperatorForConditions=$(e),s=I(e.left,t.conditions,r),s=s&&I(e.right,t,r);else{s=I(e.left,t.conditions,r);const i={conditions:[]};r.expressions.push(i),s=s&&I(e.right,i,r)}else if(N(e.right))if(e.operator===e.left.operator&&N(e.left.right)&&(N(e.left.left)||e.left.operator===e.left.left?.operator))t.logicalOperatorForConditions=$(e),s=I(e.left,t,r),s=s&&I(e.right,t.conditions,r);else{s=I(e.left,t,r);const i={conditions:[]};r.expressions.push(i),s=s&&I(e.right,i.conditions,r)}else if(e.operator===e.right.operator&&e.operator===e.left.operator&&(N(e.left.left)||!N(e.left.left)&&e.left.left.operator===e.operator))t.logicalOperatorForConditions=$(e),s=I(e.left,t,r),s=s&&I(e.right,t,r);else{s=I(e.left,t,r);const i={conditions:[]};r.expressions.push(i),s=s&&I(e.right,i,r)}return s}}function N(e){return"binary-expression"!==e.type||"OR"!==e.operator&&"AND"!==e.operator}function $(e){return"OR"===e.operator.toUpperCase()?a.l.OR:a.l.AND}function F(e,t){return a.D.fromFormat(e,"yyyy-MM-dd TT",{numberingSystem:"latn",zone:t}).toMillis()}function C(e){return(0,a.t)(e)}function w(e){return new Date(`${e} 00:00:00`).getTime()}const T=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.arcgisFilterWhereChange=(0,s.c)(this,"arcgisFilterWhereChange",7),this.arcgisSave=(0,s.c)(this,"arcgisSave",7),this.arcgisFilterSave=(0,s.c)(this,"arcgisFilterSave",7),this.arcgisCancel=(0,s.c)(this,"arcgisCancel",7),this.arcgisFilterCancel=(0,s.c)(this,"arcgisFilterCancel",7),this.arcgisClose=(0,s.c)(this,"arcgisClose",7),this.arcgisFilterDismissedChange=(0,s.c)(this,"arcgisFilterDismissedChange",7),this.arcgisDone=(0,s.c)(this,"arcgisDone",7),this.arcgisFilterDone=(0,s.c)(this,"arcgisFilterDone",7),this.arcgisPanelBackClick=(0,s.c)(this,"arcgisPanelBackClick",7),this.arcgisFilterPanelBackClick=(0,s.c)(this,"arcgisFilterPanelBackClick",7),this._closePopovers=(0,s.c)(this,"_closePopovers",7),this.arcgisExpressionChanged=(0,s.c)(this,"arcgisExpressionChanged",7),this.arcgisFilterExpressionChanged=(0,s.c)(this,"arcgisFilterExpressionChanged",7),this.manager=(0,o.u)(this),this.layerHasFeatureEffect=!1,this.properClose=!1,this.strings=(0,l.u)({blocking:!0}),this.applyFilter=()=>{const{props:e}=this,{layerView:t,layer:r,labelClass:s,originalLayer:i,mode:n}=e;if(this._closePopovers.emit(),"basic"===n){const t=y(e);this.properClose=!0,this.arcgisFilterSave.emit(t),this.arcgisSave.emit(t)}else if((0,a.a)(s))this.properClose=!0,this.arcgisFilterSave.emit(),this.arcgisSave.emit();else if("layer-view"===n){const t=y(e);this.properClose=!0,this.arcgisFilterSave.emit(t),this.arcgisSave.emit(t)}else if("effects"===n);else if(r){const s=y(e);(i||r).definitionExpression=s,"featureEffect"in r&&this.isAllowedFeatureEffect()?r.featureEffect=null:t&&"filter"in t&&(t.filter=null),(0,a.q)(e),this.properClose=!0,this.arcgisFilterSave.emit(),this.arcgisSave.emit(),this.componentStateInvalid=!0}},this.cancelFilter=()=>{this.revertFilter(),this._closePopovers.emit(),this.properClose=!0,this.arcgisFilterCancel.emit(),this.arcgisCancel.emit()},this.closeFilter=()=>{this.applyFilter(),this._closePopovers.emit(),this.properClose=!0,this.arcgisFilterDismissedChange.emit(),this.arcgisClose.emit()},this.onAddExpression=()=>{const{props:e}=this,{expressions:t}=e,r=(0,a.r)(e);if(!r)return;const s=(0,a.A)(e,r),i=(0,a.v)(e,r,s),n={conditions:[{fieldName:r.layerField.name,operator:s,...i,hasFocus:!0}]};e.expressions=t?(0,a.p)([...t.map((e=>({...e,conditions:e.conditions.map((e=>({...e,hasFocus:!1})))}))),n]):(0,a.p)([n]),(0,a.a)(i.value)&&(this.arcgisFilterExpressionChanged.emit({type:"replace",expression:n}),this.arcgisExpressionChanged.emit({type:"replace",expression:n})),this.reRender=!this.reRender},this.onMatchSelect=e=>{const{props:t}=this,r=e.target;t.logicalOperatorForExpressions=r.selectedOption.value,this.reRender=!this.reRender,this.applyFilterToLayer()},this.onRemoveFilter=()=>{const{props:e}=this;e.invalidFilter=!1,e.expressions=void 0,this.reRender=!this.reRender,this.applyFilterToLayer()},this.focusByClass=()=>{const e=this.el.querySelector("arcgis-filter .autofocus");e&&(e.nodeName.startsWith("CALCITE-")?e.setFocus():e?.focus())},this.view=void 0,this.layer=void 0,this.labelClass=void 0,this.mode=void 0,this.whereClause=void 0,this.viewFilter=void 0,this.featureReduction=void 0,this.hideLayerTitle=!1,this.panelHeading=void 0,this.tipHeading=void 0,this.noFilterMsg=void 0,this.tipMsg=void 0,this.invalidHeading=void 0,this.invalidMsg=void 0,this.newButtonLabel=void 0,this.clearText=void 0,this.leadingText=void 0,this.defaultFieldName=void 0,this.defaultOperator=void 0,this.defaultExpression=!1,this.hideButtons=!1,this.panelMaxHeight=void 0,this.closable=!1,this.dismissible=!1,this.withinModal=!1,this.reverseFooterButtons=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.props=void 0,this.reRender=!1,this.componentStateInvalid=!1}arcgisExpressionChangedHandler(e){const{props:t}=this,{expressions:r,modules:s}=t,{detail:i}=e;if("copy"===i.type){const n=e.detail.expression;let o;t.expressions=t.expressions.map((e=>e.uid===n.uid?n:e)),t.expressions=r.map((e=>({...e,conditions:e.conditions.map((e=>({...e,hasFocus:!1})))}))),t.expressions.forEach((e=>{e.uid===i.uid&&(o=s.esriLang.clone({...e}),o.conditions[0].hasFocus=!0)})),t.expressions=(0,a.p)([...t.expressions,o]),this.reRender=!this.reRender}else if("delete"===i.type){let e=0;r.forEach(((t,r)=>{t.uid===i.uid?e=r:t.conditions.forEach((e=>e.hasFocus=!1))})),t.expressions=r.filter((e=>e.uid!==i.uid)),t.expressions?.length?(t.expressions[Math.max(0,e-1)].conditions[0].hasFocus=!0,t.expressions=(0,a.p)([...t.expressions]),setTimeout((()=>this.focusByClass()),500)):setTimeout((()=>this.fabNode?.setFocus()),500),this.reRender=!this.reRender}else{const r=e.detail.expression;t.expressions=t.expressions.map((e=>e.uid===r.uid?{...r}:e))}this.applyFilterToLayer()}disablePanelHandler(e){"disabled"in this.panelNode&&(this.panelNode.disabled=e.detail)}async setFocus(){this.panelNode&&"setFocus"in this.panelNode?this.panelNode.setFocus():this.panelNode?.focus()}async done(){this.componentStateInvalid||(this.applyFilter(),this._closePopovers.emit(),this.properClose=!0,this.arcgisFilterDone.emit(),this.arcgisDone.emit())}async closePopovers(){this._closePopovers.emit()}async openPanel(){"closed"in this.panelNode&&(this.panelNode.closed=!1)}async componentWillLoad(){this.tipMsg&&!this.noFilterMsg&&(this.noFilterMsg=this.tipMsg),this.featureReduction&&(this.mode="feature-reduction"),this.dismissible&&!this.closable&&(this.closable=!0);let e=this.withinModal;if(!e){(0,i.f)(this.el,"calcite-dialog")&&(e=!0)}"subtype-sublayer"===this.layer.type&&"basic"!==this.mode&&(console.error('SubtypeSublayer is only supported with mode "basic"'),this.componentStateInvalid=!0),this.props={expressions:void 0,logicalOperatorForExpressions:"and",fields:[],operators:void 0,invalidFilter:!1,featureCount:-1,stringFieldsCount:0,dateFieldsCount:0,numberFieldsCount:0,isHosted:!1,supportsStandardizedQuery:!1,supportedSqlParserVersion:!1,supportsCurrentUser:!1,layer:this.layer,view:this.view,labelClass:this.labelClass,strings:this.strings,locale:this.strings._t9nLocale,fullLocale:this.strings._lang,inputDefinitionExpression:void 0,backgroundTheme:"light",lastWhere:void 0,defaultFieldName:this.defaultFieldName,defaultOperator:this.defaultOperator,insideDialog:e,mode:this.mode,modules:{reactiveUtils:await(0,n.b)(),colorUtils:await(0,n.s)(),ImageryLayer:await(0,n.b7)(),FeatureLayer:await(0,n.b8)(),FeatureEffect:await(0,n.t)(),Query:await(0,n.aj)(),esriConfig:await(0,n.i)(),esriLang:await(0,n.e)(),esriRequest:await(0,n.f)(),intl:await(0,n.al)(),arcade:await(0,n.w)()}};const{view:t,layer:r}=this,{props:s}=this,{modules:o}=s,l=r;if("esri.layers.support.Sublayer"===l.declaredClass){const e=l;t&&await o.reactiveUtils.whenOnce((()=>!t.updating));const r=await e.createFeatureLayer();await r.load(),this.props={...s,layer:r,mapImageSublayer:e}}else if("imagery"===l.type||"subtype-group"===l.type||"subtype-sublayer"===l.type||"catalog"===l.type)this.props={...s,layer:l};else if(!t||"feature"===l.type&&l.isTable){let e;e=new o.FeatureLayer({url:l.url,layerId:l.layerId,popupTemplate:l.popupTemplate}),await e.load(),this.props={...s,layer:e,originalLayer:l}}else this.props={...s,layer:l};const{labelClass:p,mode:c}=this.props,d="feature-reduction"===c?r.featureReduction.labelingInfo:r.labelingInfo;!(0,a.a)(p)||d?.length?await this.processLayer():console.log("can't find labelClass")}componentDidLoad(){const{props:e,defaultExpression:t}=this;!e.expressions?.length&&t&&this.onAddExpression(),requestAnimationFrame((()=>this.setFocus()))}disconnectedCallback(){this.properClose?this._closePopovers.emit():(this.applyFilter(),"layer-view"===this.props.mode&&(0,a.q)(this.props))}render(){const{props:e,hideLayerTitle:t,panelHeading:r,componentStateInvalid:i,closable:a,el:n,panelMaxHeight:o}=this,{layer:l,mapImageSublayer:p,invalidFilter:c,mode:d,strings:u}=e,h=p?p.title:l.title;return i?(0,s.h)("div",null):l?c?this.renderInvalidFilter():"basic"===d?(0,s.h)("div",{class:"content-div",ref:t=>{this.panelNode=t,e.panelNode=t}},this.renderContent()):"CALCITE-FLOW"===n.parentElement?.tagName||"CALCITE-FLOW"===n.parentElement?.parentElement?.tagName?(0,s.h)(s.H,{class:"flow-item-host"},(0,s.h)("calcite-flow-item",{loading:!1,heading:r||u.title,description:t?void 0:h??void 0,style:o?{maxHeight:o}:void 0,closable:a,selected:this.selected,showBackButton:!a,ref:t=>{this.panelNode=t,e.panelNode=t},onCalciteFlowItemBack:()=>{if("layer-view"===d){const t=y(e);this.arcgisFilterPanelBackClick.emit(t),this.arcgisPanelBackClick.emit(t)}else this.arcgisFilterPanelBackClick.emit(),this.arcgisPanelBackClick.emit()},onCalciteFlowItemClose:()=>this.closeFilter()},this.renderContent())):(this.selected=!0,(0,s.h)(s.H,null,(0,s.h)("calcite-panel",{loading:!1,heading:r||u.title,description:t?void 0:h??void 0,style:o?{maxHeight:o}:void 0,closable:a,ref:t=>{this.panelNode=t,e.panelNode=t},onCalcitePanelClose:()=>this.closeFilter()},this.renderContent()))):this.renderLoading()}renderContent(){return(0,s.h)(s.F,null,this.renderFooterButtons(),this.renderHeaderInfo(),this.renderMatchExpressionMsg(),this.renderExpressions(),this.renderTip(),this.renderAddExpression())}renderFooterButtons(){const{props:e,hideButtons:t}=this,{labelClass:r,mode:i}=e,n=(0,a.a)(r);return t||n||i&&["layer-view","basic"].includes(i)?(0,s.h)(s.F,null):(0,s.h)("div",{slot:"footer",class:"footer-buttons"+(this.reverseFooterButtons?" reverse":"")},this.renderSaveButton(),this.renderCancelButton())}renderSaveButton(){const{props:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{onClick:this.applyFilter,appearance:"solid",width:"half",label:t.save},t.save)}renderCancelButton(){const{props:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{onClick:this.cancelFilter,appearance:"outline-fill",width:"half",label:t.cancel},t.cancel)}renderHeaderInfo(){const{props:e,leadingText:t,clearText:r}=this,{strings:i,expressions:a}=e;return a?.length?(0,s.h)("div",{class:u},(0,s.h)("calcite-label",{class:"heading",layout:"inline-space-between"},t||i.showFeaturesWhere,(0,s.h)("calcite-button",{class:"clear",appearance:"transparent",onClick:this.onRemoveFilter},r||i.clearAll))):(0,s.h)(s.F,null)}renderLoading(){const{props:e,hideLayerTitle:t,panelHeading:r}=this,{layer:i,mapImageSublayer:a,mode:n,strings:o}=e,l=a?a.title:i.title;return"basic"===n?(0,s.h)("div",null):(0,s.h)(s.H,null,(0,s.h)("calcite-panel",{heading:r||o.title,description:t?void 0:l??void 0,loading:!0}))}renderInvalidFilter(){const{props:e,hideLayerTitle:t,closable:r,panelHeading:i,el:a}=this,{layer:n,mapImageSublayer:o,mode:l,strings:p}=e,c=o?o.title:n.title;return"basic"===l?(0,s.h)("div",{ref:this.focusByClass},this.renderInvalidContent()):"CALCITE-FLOW"===a.parentElement?.tagName||"CALCITE-FLOW"===a.parentElement?.parentElement?.tagName?(0,s.h)(s.H,null,(0,s.h)("calcite-flow-item",{heading:i||p.title,description:t?void 0:c??void 0,loading:!1,closable:r,ref:this.focusByClass,onCalciteFlowItemBack:()=>{this.arcgisFilterPanelBackClick.emit(),this.arcgisPanelBackClick.emit()},onCalciteFlowItemClose:()=>this.closeFilter()},this.renderInvalidContent())):(0,s.h)(s.H,null,(0,s.h)("calcite-panel",{heading:i||p.title,description:t?void 0:c??void 0,loading:!1,closable:r,ref:this.focusByClass,onCalcitePanelClose:()=>this.closeFilter()},this.renderInvalidContent()))}renderInvalidContent(){return(0,s.h)(s.F,null,this.renderFooterButtons(),this.renderInvalidFilterMsg())}renderInvalidFilterMsg(){const{invalidHeading:e,invalidMsg:t,newButtonLabel:r,props:i}=this,{strings:a}=i;return(0,s.h)("div",{class:m},(0,s.h)("calcite-notice",{scale:"s",width:"full",kind:"danger",icon:"exclamation-mark-triangle",open:!0},(0,s.h)("div",{slot:"title"},e||a.errors.problemDisplayingFilter),(0,s.h)("div",{slot:"message"},t||a.errors.problemDisplayingFilterMsg),(0,s.h)("calcite-link",{slot:"link",onClick:this.onRemoveFilter},r||a.createNewFilter)))}renderMatchExpressionMsg(){const{props:e}=this,{expressions:t,logicalOperatorForExpressions:r,strings:i}=e;if(!t?.length)return(0,s.h)(s.F,null);const n=r===a.l.AND;return t.length>1?(0,s.h)("div",{class:h},(0,s.h)("calcite-label",{class:"no-space",scale:"m"},(0,s.h)("calcite-select",{width:"full",scale:"m",label:i.accessibility.matchType,class:f,onCalciteSelectChange:this.onMatchSelect},(0,s.h)("calcite-option",{value:a.l.AND,label:i.matchAll,selected:n}),(0,s.h)("calcite-option",{value:a.l.OR,label:i.matchAtLeastOne,selected:!n})))):null}renderExpressions(){const{props:e}=this,{expressions:t}=e;return t?.length?(0,s.h)("div",null,t.map(((e,t)=>this.renderExpression(e,t)))):(0,s.h)(s.F,null)}renderExpression(e,t){const{props:r}=this;return(0,s.h)("div",null,this.renderLogicalOperatorExpression(t),(0,s.h)("arcgis-filter-expression",{props:r,ref:this.focusByClass,...e}))}renderLogicalOperatorExpression(e){const{props:t}=this,{logicalOperatorForExpressions:r,strings:i}=t;return 0===e?(0,s.h)(s.F,null):(0,s.h)("div",{class:g},(0,s.h)("span",null,r===a.l.OR?i.or:i.and))}renderAddExpression(){const{props:e}=this,{mode:t}=e;return"basic"===t?(0,s.h)("div",{class:"fab-without-panel"},this.renderAddExpressionFab()):this.renderAddExpressionFab()}renderAddExpressionFab(){const{props:e,hideButtons:t}=this,{expressions:r,strings:i}=e;return(0,s.h)("calcite-fab",{class:{autofocus:!r?.length,"fab-padding":t},slot:"fab",appearance:"outline-fill",kind:"neutral",icon:"plus",textEnabled:!0,text:i.addNew,onClick:this.onAddExpression,ref:e=>this.fabNode=e})}renderTip(){const{props:e,noFilterMsg:t}=this,{mapImageSublayer:r,expressions:i,labelClass:n,mode:o,strings:l}=e;if(i?.length)return(0,s.h)(s.F,null);const u=(0,a.a)(n);return(0,s.h)("div",{class:p},!t&&(0,s.h)("calcite-icon",{class:c,icon:"layer-filter"}),(0,s.h)("div",{class:d},t||(u?l.tips.emptyMsgLabels:r||"layer-view"===o?l.tips.emptyMsgMS:l.tips.emptyMsg)))}async processLayer(){const{props:e,viewFilter:t,hideButtons:r}=this,{layer:s,mapImageSublayer:i,originalLayer:n,view:o,labelClass:l,mode:p,modules:c}=e;if(!o||i||"imagery"===s.type||"subtype-group"===s.type||"subtype-sublayer"===s.type||"sublayer"===s.type||"catalog"===s.type||"feature"===s.type&&s.isTable||(e.layerView=await o.whenLayerView(s)),(0,a.w)(e),await(0,a.x)(e),await async function(e){const{layer:t,modules:r}=e;if(["feature","sublayer","wfs","csv","geojson","subtype-group","oriented-imagery","catalog","knowledge-graph"].includes(t.type)){const s=t,i=new r.Query({where:"1=1"});e.featureCount=await s.queryFeatureCount(i)}}(e),(0,a.y)(e),e.backgroundTheme=o&&await c.colorUtils.getBackgroundColorTheme(o),this.layerHasFeatureEffect=s.featureEffect,"basic"===p||"subtype-sublayer"===s.type){e.inputDefinitionExpression=this.whereClause,e.lastWhere=e.inputDefinitionExpression;const t=await O(e.inputDefinitionExpression,e);e.invalidFilter=!t,this.reRender=!this.reRender}else if((0,a.a)(l)&&l.where){e.inputDefinitionExpression=l.where,e.lastWhere=e.inputDefinitionExpression;const t=await O(e.inputDefinitionExpression,e);e.invalidFilter=!t,this.reRender=!this.reRender}else if("layer-view"===p){if(t){const r=await O(t,e);e.invalidFilter=!r,r&&this.applyFilterToLayer(!0),this.reRender=!this.reRender}}else if("effects"===p){if(e.invalidFilter=!1,s.featureEffect){e.inputDefinitionExpression=s.featureEffect.filter?.where,e.lastWhere=e.inputDefinitionExpression;const t=await O(e.inputDefinitionExpression,e);e.invalidFilter=!t,this.reRender=!this.reRender}}else if((0,a.a)(l)||!(0,a.a)(s.definitionExpression)&&!(0,a.a)(n?.definitionExpression))if(r){e.inputDefinitionExpression=s.definitionExpression??void 0,e.lastWhere=e.inputDefinitionExpression;const t=await O(e.inputDefinitionExpression,e);e.invalidFilter=!t,this.reRender=!this.reRender}else e.invalidFilter=!1;else{e.inputDefinitionExpression=(n||s).definitionExpression??void 0;const t=await O(e.inputDefinitionExpression,e);e.invalidFilter=!t,t&&this.applyFilterToLayer(!0),this.reRender=!this.reRender,!o||"imagery"===s.type||"subtype-group"===s.type||"catalog"===s.type||"feature"===s.type&&s.isTable||(s.definitionExpression=null)}}revertFilter(){const{props:e,viewFilter:t}=this,{layer:r,layerView:s,labelClass:i,inputDefinitionExpression:n,mapImageSublayer:o,originalLayer:l,backgroundTheme:p,mode:c,modules:d}=e,u=this.getLabelClassIndex();if("basic"===c);else if("imagery"!==r.type&&"subtype-group"!==r.type&&"subtype-sublayer"!==r.type&&"catalog"!==r.type&&"sublayer"!==r.type&&(0,a.a)(i))i.where=n,"feature-reduction"===c?(r.featureReduction=d.esriLang.clone(r.featureReduction),e.labelClass=r.featureReduction.labelingInfo[u]):r.labelingInfo=d.esriLang.clone(r.labelingInfo),o&&(o.labelingInfo=r.labelingInfo);else if("layer-view"===c){if("feature"===r.type)if(t)if((0,a.z)(r.featureEffect)){const e="light"===p?100:65;r.featureEffect=new d.FeatureEffect({filter:{where:t},excludedEffect:`grayscale(100%) opacity(30%) brightness(${e}%)`})}else r.featureEffect.filter.where=t,r.featureEffect=r.featureEffect.clone();else r.featureEffect?.filter?.where?(r.featureEffect.filter.where=null,(0,a.z)(r.featureEffect)?r.featureEffect=null:r.featureEffect=r.featureEffect.clone()):r.featureEffect=null}else if("effects"===c);else if(r){if(o?o.definitionExpression=n:(l||r).definitionExpression=n,this.isAllowedFeatureEffect()){const e=r;e.featureEffect?.filter?.where&&(e.featureEffect.filter.where=null,(0,a.z)(e.featureEffect)?e.featureEffect=null:e.featureEffect=e.featureEffect.clone())}else s&&"filter"in s&&(s.filter=null);this.componentStateInvalid=!0}}applyFilterToLayer(e){const{props:t,layerViewWaitHandler:r,hideButtons:s,mode:i}=this,{backgroundTheme:n,labelClass:o,layer:l,view:p,layerView:c,mapImageSublayer:d,originalLayer:u,lastWhere:h,modules:f}=t,g=y(t)||void 0;if(e||g===h||(this.arcgisFilterWhereChange.emit(g),this.arcgisChange.emit(g)),t.lastWhere=g,"basic"!==i&&!(0,a.a)(o))if("imagery"!==l.type&&"subtype-group"!==l.type&&"catalog"!==l.type){if(!s)if(d)d.definitionExpression=g;else if(!p||"feature"===l.type&&l.isTable)u.definitionExpression=y(t);else if(r&&(clearTimeout(r),this.layerViewWaitHandler=void 0),c)if(g?.length)if("featureEffect"in l&&this.isAllowedFeatureEffect())if((0,a.z)(l.featureEffect)){const e="light"===n?100:65;l.featureEffect=new f.FeatureEffect({filter:{where:g},excludedEffect:`grayscale(100%) opacity(30%) brightness(${e}%)`})}else l.featureEffect.filter=l.featureEffect.filter||{},l.featureEffect.filter.where=g,l.featureEffect=l.featureEffect.clone();else"filter"in c&&(c.filter={where:g});else"featureEffect"in l&&this.isAllowedFeatureEffect()?l.featureEffect?.filter?.where&&(l.featureEffect.filter.where=null,(0,a.z)(l.featureEffect)?l.featureEffect=null:l.featureEffect=l.featureEffect.clone()):"filter"in c&&(c.filter=null);else this.layerViewWaitHandler=setTimeout((()=>{this.applyFilterToLayer()}),500)}else l.definitionExpression=g}isAllowedFeatureEffect(){const{props:e,layerHasFeatureEffect:t}=this,{layer:r,featureCount:s,mode:i}=e;return!(s>5e5)&&(["feature","geojson","ogc-feature","wfs","csv","stream","knowledge-graph-sublayer"].includes(r.type)&&!r.featureReduction&&"effects"!==i&&"basic"!==i&&(!t||"layer-view"===i))}getLabelClassIndex(){const{props:e}=this,{layer:t,labelClass:r,mode:s}=e;let i=-1;const a="feature"===t.type&&("feature-reduction"===s?t.featureReduction.labelingInfo:t.labelingInfo);return r&&a.forEach(((e,t)=>{JSON.stringify(e.toJSON())===JSON.stringify(r.toJSON())&&(i=t)})),i}static get assetsDirs(){return["assets"]}get el(){return(0,s.g)(this)}};T.style=":host {\n  display: flex;\n  flex: 1 1 auto;\n  overflow: hidden;\n}\n:host([selected]) {\n  display: flex !important;\n}\n:host.flow-item-host {\n  display: none;\n}\n.content-div {\n  width: 100%;\n}\n.fab-padding {\n  padding-bottom: 1rem;\n}\n.fab-without-panel {\n  padding: 1rem;\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n}\n.notice {\n  margin: 8px;\n}\n.empty-msg {\n  margin: 40px 10px 0 10px;\n}\n.msg-icon,\n.tip-msg {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  margin-bottom: 30px;\n}\n.tip-msg {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  text-align: center;\n}\n.header-info {\n  padding: 8px 0 8px 15px;\n}\n.match-expression-dropdown {\n  width: 100%;\n}\n.match-expression-msg {\n  padding: 12px;\n}\n.match-type {\n  display: flex;\n  align-items: flex-start;\n  margin: 10px 22px 8px 22px;\n}\n\n:dir(rtl) {\n  .match-type {\n    align-items: flex-end;\n  }\n\n  .header-info {\n    padding-left: 0;\n    padding-right: 15px;\n  }\n}\n\n.heading {\n  --calcite-label-margin-bottom: 0;\n  font-weight: bold;\n}\n.clear {\n  margin: 0 4px;\n}\n.footer-buttons {\n  width: 100%;\n  display: flex;\n  flex-direction: row;\n}\n.footer-buttons.reverse {\n  flex-direction: row-reverse;\n}\n";const k="expression-block",L="add-condition-button",B="content",S="match-type-text",A="match-type-text-empty",D="match-condition",R="match-condition-dropdown",W=class{constructor(e){(0,s.r)(this,e),this.arcgisExpressionChanged=(0,s.c)(this,"arcgisExpressionChanged",7),this.arcgisFilterExpressionChanged=(0,s.c)(this,"arcgisFilterExpressionChanged",7),this.manager=(0,o.u)(this),this.onAddCondition=()=>{const{props:e,conditions:t}=this,r=(0,a.r)(e),s=(0,a.A)(e,r),i=(0,a.v)(e,r,s),n={fieldName:r.layerField.name,operator:(0,a.A)(e,r),...i,hasFocus:!0};t.forEach((e=>e.hasFocus=!1)),this.conditions=[...t,n],e.expressions=e.expressions.map((e=>e.uid===this.uid?{...e,conditions:this.conditions}:{...e})),this.fixUIDsForExpression(),this.menuNode.open=!1,this.emitChangeEvent()},this.onRemoveCondition=e=>{const{props:t,conditions:r}=this;r.forEach((e=>e.hasFocus=!1));let s=0;this.conditions=r.filter(((t,r)=>!t||r!==e||(s=r,!1))),this.conditions[Math.max(0,s-1)].hasFocus=!0,t.expressions=t.expressions.map((e=>e.uid===this.uid?{...e,conditions:this.conditions}:{...e})),this.fixUIDsForExpression(),this.emitChangeEvent()},this.onMatchSelect=e=>{const t=e.target.selectedOption.value;this.logicalOperatorForConditions=t,this.emitChangeEvent()},this.onCopyExpression=()=>{const{uid:e,conditions:t,logicalOperatorForConditions:r}=this,s={uid:e,conditions:t,logicalOperatorForConditions:r};this.menuNode.open=!1,this.arcgisFilterExpressionChanged.emit({type:"copy",uid:this.uid,expression:s}),this.arcgisExpressionChanged.emit({type:"copy",uid:this.uid,expression:s})},this.onRemoveExpression=()=>{this.arcgisFilterExpressionChanged.emit({type:"delete",uid:this.uid}),this.arcgisExpressionChanged.emit({type:"delete",uid:this.uid})},this.props=void 0,this.uid=void 0,this.conditions=void 0,this.logicalOperatorForConditions=void 0,this.hideRemove=!1,this.canRemove=!0,this.hideDuplicate=!1,this.canDuplicate=!0,this.showAddConditionButton=!1}arcgisFilterConditionChangeHandler(e){const{conditions:t}=this,{detail:r}=e;this.conditions=t.map((e=>e.uid===r.uid?r:e)),this.emitChangeEvent()}async componentWillLoad(){this.canRemove||this.hideRemove||(this.hideRemove=!0),this.canDuplicate||this.hideDuplicate||(this.hideDuplicate=!0),this.conditions=this.conditions||[]}render(){const{props:e,conditions:t}=this,{strings:r}=e,i=(0,o.a)(this.el);return(0,s.h)(s.H,{key:"a5849b78fe8889bfab0c5de0c8036afbc11d2f42",dir:i},(0,s.h)("calcite-block",{key:"e77acc603267c8ec38a3a878faf116fa1c7e41bc",heading:1===t.length?r.condition:r.conditionSet,open:!0,class:k},this.renderMenu(),this.renderMatchCondition(),this.renderConditions(),this.renderAddConditionButton()))}renderMenu(){const{props:e,hideDuplicate:t,hideRemove:r,conditions:i}=this,{strings:a}=e;return(0,s.h)("calcite-action-menu",{slot:"control",placement:"bottom-end",overlayPositioning:"fixed",label:a.accessibility.moreOptions,ref:e=>this.menuNode=e},!r&&(0,s.h)("calcite-action",{text:1===i.length?a.deleteExpression:a.deleteSet,textEnabled:!0,"data-value":"remove",onClick:this.onRemoveExpression}),!t&&(0,s.h)("calcite-action",{text:a.duplicate,textEnabled:!0,"data-value":"copy",onClick:this.onCopyExpression}),(0,s.h)("calcite-action",{text:a.addCondition,textEnabled:!0,"data-value":"add",onClick:this.onAddCondition}))}renderMatchCondition(){const{conditions:e,logicalOperatorForConditions:t,props:r}=this,{strings:i}=r;if(!e?.length||1===e.length)return(0,s.h)(s.F,null);const n=t!==a.l.OR;return(0,s.h)("div",{class:D},(0,s.h)("calcite-select",{width:"full",scale:"m",label:i.accessibility.matchType,class:R,onCalciteSelectChange:this.onMatchSelect},(0,s.h)("calcite-option",{value:a.l.AND,label:i.matchAll,selected:n}),(0,s.h)("calcite-option",{value:a.l.OR,label:i.matchAtLeastOne,selected:!n})))}renderConditions(){const{conditions:e}=this;return(0,s.h)("div",{class:B},e.map(((e,t)=>this.renderCondition(e,t))))}renderCondition(e,t){const{conditions:r,props:i}=this;return(0,s.h)("div",null,this.renderConditionHeader(t),(0,s.h)("arcgis-filter-condition",{props:i,showDelete:r.length>1,...e,onArcgisFilterConditionDeleted:()=>this.onRemoveCondition(t)}))}renderAddConditionButton(){return this.showAddConditionButton&&(0,s.h)("calcite-button",{alignment:"center",appearance:"transparent",class:L,"icon-start":"plus",scale:"s",onClick:this.onAddCondition},this.props.strings.addCondition)}renderConditionHeader(e){const{props:t,logicalOperatorForConditions:r,conditions:i}=this,{strings:n}=t;if(i.length<2)return(0,s.h)(s.F,null);const o=r!==a.l.OR;return(0,s.h)("div",null,e>0?(0,s.h)("span",{class:S},o?n.and:n.or):i.length>1?(0,s.h)("div",{class:A}):null)}fixUIDsForExpression(){const{props:e}=this;e.expressions=(0,a.p)(e.expressions),this.conditions=e.expressions.find((e=>e.uid===this.uid)).conditions}emitChangeEvent(){const{uid:e,conditions:t,logicalOperatorForConditions:r}=this,s={uid:e,conditions:t,logicalOperatorForConditions:r};this.arcgisFilterExpressionChanged.emit({type:"replace",expression:s}),this.arcgisExpressionChanged.emit({type:"replace",expression:s})}get el(){return(0,s.g)(this)}};W.style=".expression-block {\n  margin: 0 8px;\n  border: 1px solid var(--calcite-color-border-3);\n}\n.content {\n  padding-bottom: 6px;\n}\n.match-type-text {\n  display: flex;\n  justify-content: flex-start;\n  margin: 6px 8px 0 8px;\n}\n:dir(rtl) {\n  .match-type-text {\n    justify-content: flex-end;\n  }\n}\n.match-type-text-empty {\n  margin: 10px 0 0 0;\n}\n.match-condition {\n  border-bottom: 1px solid var(--calcite-color-border-3);\n  padding-bottom: 18px;\n}\n.match-condition-dropdown {\n  width: 100%;\n}\n\n.add-condition-button {\n  display: flex;\n}\n"},48122:(e,t,r)=>{function s(e,t,r){if(t&&e?.tagName===t.toUpperCase()||r&&e?.classList.contains(r))return e;{let s=e?.parentElement;for(;s;){if(t&&s.tagName===t.toUpperCase()||r&&s.classList.contains(r))return s;if("BODY"===s.tagName)break;s=s.parentElement}}}r.d(t,{f:()=>s})}}]);