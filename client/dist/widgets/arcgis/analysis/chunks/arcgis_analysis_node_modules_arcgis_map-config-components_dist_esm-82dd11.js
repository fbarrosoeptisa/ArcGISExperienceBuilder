/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-82dd11.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-82dd11"],{52618:(e,t,i)=>{i.r(t),i.d(t,{arcgis_filter_condition:()=>P,arcgis_filter_unique_list:()=>B});var s=i(28614),a=i(68180),n=i(97127),l=i(50466),r=i(71480),o=i(42444),u=i(50063);const d="field-selection",c="delete-action",h="filter-condition",p="operator-dropdown",m="input-plus-unique",g="input-plus-unique-date",v="input",f="label",y="blank-button",I="select-unique-button",S="between-values-input",C="select-values",T="list",F="unique-values-content-list-msg",N="in-the-last",b="in-the-last-count",E="in-the-last-unit",V="date-picker",O="histogram-content",q="histogram-content-slim",L="small-loader",D="time-zone",k="time-zone-icon",P=class{constructor(e){(0,s.r)(this,e),this.arcgisFilterConditionChanged=(0,s.c)(this,"arcgisFilterConditionChanged",7),this.arcgisFilterConditionDeleted=(0,s.c)(this,"arcgisFilterConditionDeleted",7),this.disablePanel=(0,s.c)(this,"disablePanel",7),this.arcgisValuesReturned=(0,s.c)(this,"arcgisValuesReturned",7),this.manager=(0,n.u)(this),this.histogramSlider=void 0,this.isEditorField=!1,this.afterCreateSliderDiv=e=>{const{fieldName:t,props:i,histogramSlider:s}=this,{modules:a}=i;e&&setTimeout((()=>{if(!s)return;const n=document.createElement("div");if(e.appendChild(n),s.container){const e=(0,l.g)(t,i);if(!e)return;const{bins:r,average:o,min:u,max:d,values:c,precision:h,rangeType:p}=s,m={container:n,bins:r,average:o,min:u,max:d,values:c,precision:h,rangeType:p};[l.s.DATE,l.s.DATE_ONLY,l.s.TIME_ONLY].includes(e.simpleFieldType)&&(m.hasTimeData=!0,this.addDateFormatFunctions(m,e)),s.destroy(),this.histogramSlider=new a.HistogramRangeSlider(m),this.createSliderChangeEvents(e)}else s.container=n}),1)},this.onFieldSelect=()=>{this.hasFocus=!0,this.openFieldPickList()},this.onOperatorSelect=e=>{const{props:t,fieldName:i,operator:s,value:a,value2:n}=this,r=e.target.selectedOption.value,o=(0,l.g)(i,t),u=(0,l.c)(t,s),d=(0,l.c)(t,r),c=u||d,h=u&&d,p=(0,l.i)(t,s),m=(0,l.i)(t,r),g=p&&m,v={value:a,value2:n,operator:s};this.value=(c&&!h?void 0:o.statistics&&!(0,l.a)(a)?o.statistics.avg:a)??void 0,this.value2=(m?n??((0,l.B)(o)&&o.statistics?.max?Math.round(o.statistics?.max):o.statistics?.max):c||!g?void 0:n)??void 0,this.operator=r;const f=this.checkDefaultValues(o),y={value:this.value??f.value,value2:this.value2??(m?f.value2:null),operator:this.operator,unit:this.unit||f.unit};this.value=v.value,this.value2=v.value2,this.operator=v.operator,this.emitChangeEvent(y)},this.onValueChangeMaybe=e=>{const{props:t,operator:i,value2:s}=this,a=this.getNewValue(e);(0,l.a)(a)&&(0,l.i)(t,i)&&a>=s||this.onValueChange(e,a)},this.onValueChange=(e,t)=>{t=t??this.getNewValue(e);const{props:i,fieldName:s,operator:a,value:n,value2:r}=this,{layer:o,view:u}=i,d=(0,l.g)(s,i),c=e;if(t=e?this.getNewValue(e):t,!(0,l.a)(t)){const e=(0,l.v)(i,d,a);if(t=e.value,c)if(d.simpleFieldType===l.s.DATE){const e=(0,l.C)(t,u?.timeZone,"preferredTimeZone"in o?o.preferredTimeZone??void 0:void 0);if("CALCITE-INPUT-DATE-PICKER"===c.tagName)c.value=e;else{const t=(0,l.E)(e);t&&(c.value=t)}}else d.simpleFieldType===l.s.DATE_ONLY?c.value=new Date(t).toISOString():d.simpleFieldType===l.s.TIME_ONLY?c.value=(0,l.h)(t):c.value=`${t}`}if(n!==t){if((0,l.a)(t)&&(0,l.i)(i,a)&&t>=r&&c)if(d.simpleFieldType===l.s.DATE)if(t=r-1e3,"CALCITE-INPUT-TIME-PICKER"===c.tagName){const e=(0,l.C)(t,u?.timeZone,"preferredTimeZone"in o?o.preferredTimeZone??void 0:void 0),i=(0,l.E)(e);i&&requestAnimationFrame((()=>c.value=i))}else c.value=(0,l.C)(t,u?.timeZone,"preferredTimeZone"in o?o.preferredTimeZone??void 0:void 0);else if(d.simpleFieldType===l.s.DATE_ONLY){const e=new Date(r-864e5);c.value=new Date(e).toISOString(),t=new Date(e).getTime()}else d.simpleFieldType===l.s.TIME_ONLY?(t=r-1e3,requestAnimationFrame((()=>c.value=(0,l.h)(t)))):(t=r-1,c.value=`${t}`);("CALCITE-INPUT-DATE-PICKER"===c?.tagName||"CALCITE-INPUT-TIME-PICKER"===c?.tagName||"CALCITE-INPUT"===c?.tagName&&"number"===c?.type||"CALCITE-INPUT-NUMBER"===c?.tagName)&&this.adjustHistogramMinMax(t),this.changeValues(t,r)}},this.onValue2ChangeMaybe=e=>{const{props:t,operator:i,value:s}=this,a=this.getNewValue(e);(0,l.a)(a)&&(0,l.i)(t,i)&&a<=s||this.onValue2Change(e,a)},this.onValue2Change=(e,t)=>{const{value:i,props:s,fieldName:a,operator:n}=this,{layer:r,view:o}=s,u=(0,l.g)(a,s),d=e;if(t=t??this.getNewValue(e)??void 0,!(0,l.a)(t)){const e=(0,l.v)(s,u,n);if(t=e.value2,u.simpleFieldType===l.s.DATE){const e=(0,l.C)(t,o?.timeZone,"preferredTimeZone"in r?r.preferredTimeZone??void 0:void 0);if("CALCITE-INPUT-DATE-PICKER"===d.tagName)d.value=e;else{const t=(0,l.E)(e);t&&(d.value=t)}}else u.simpleFieldType===l.s.DATE_ONLY?d.value=new Date(t).toISOString():u.simpleFieldType===l.s.TIME_ONLY?d.value=(0,l.h)(t):d.value=`${t}`}if((0,l.a)(t)&&t<=i)if(u.simpleFieldType===l.s.DATE)if(t=i+1e3,"CALCITE-INPUT-TIME-PICKER"===d.tagName){const e=(0,l.C)(t,o?.timeZone,"preferredTimeZone"in r?r.preferredTimeZone??void 0:void 0),i=(0,l.E)(e);i&&requestAnimationFrame((()=>d.value=i))}else d.value=(0,l.C)(t,o?.timeZone,"preferredTimeZone"in r?r.preferredTimeZone??void 0:void 0);else if(u.simpleFieldType===l.s.DATE_ONLY){const e=new Date(i+864e5);d.value=new Date(e).toISOString(),t=new Date(e).getTime()}else u.simpleFieldType===l.s.TIME_ONLY?(t=i+1e3,requestAnimationFrame((()=>d.value=(0,l.h)(t)))):(t=i+1,d.value=`${t}`);("CALCITE-INPUT-DATE-PICKER"===d.tagName||"CALCITE-INPUT-TIME-PICKER"===d?.tagName||"CALCITE-INPUT"===d.tagName&&"number"===d.type||"CALCITE-INPUT-NUMBER"===d?.tagName)&&this.adjustHistogramMinMax(t),this.changeValues(i,t)},this.onUnitSelect=e=>{const t=e.target;this.emitChangeEvent({unit:t.selectedOption.value})},this.onSelectUniqueValue=e=>{e.stopPropagation(),this.onSelectUnique(!1)},this.onSelectUniqueValues=()=>{const{props:e,fieldName:t,operator:i}=this,s=(0,l.g)(t,e),a=(0,l.F)(s),n=(0,l.b)(e,i),r=a&&!n;this.onSelectUnique(!r)},this.onDocumentClick=e=>{e.target.closest(`#arcgis-filter-unique-popover_${this.uid}`)||this.removeUniquePopover()},this.onRemoveSelectedValue=e=>{const{values:t,props:i}=this,{modules:a}=i,n=t.indexOf(e);t.splice(n,1),this.emitChangeEvent({values:t.length?a.esriLang.clone(t):null}),(0,s.f)(this.el)},this.afterCreateList=e=>{e&&this.scrollExprIntoView(e)},this.onHistogramBlockToggle=e=>{e.currentTarget.open?this.onHistogramOpen():this.onHistogramClose()},this.fieldPickListChanges=e=>{e.stopPropagation();const t=e.detail?.selectedFields?.[0];this.removeFieldsPickList(),t&&this.afterFieldSelect(t)},this.props=void 0,this.uid=void 0,this.fieldName=void 0,this.operator=void 0,this.uniqueValuesSortBy=void 0,this.value=void 0,this.value2=void 0,this.values=void 0,this.unit=void 0,this.histogramClosed=void 0,this.hasFocus=!1,this.invalidValue=void 0,this.showDelete=!1}arcgisValuesReturnedHandler(e){const t=e.detail;this.fieldName===t&&(this.checkDefaultValues((0,l.g)(t,this.props)),(0,s.f)(this.el))}arcgisFilterUniqueListChangedHandler(e){const{detail:t}=e;if(t.uid===this.uid){const e=t.selectedValues;if(t.multiple)this.emitChangeEvent({values:e,uniqueValuesSortBy:t.sortBy});else{this.uniqueValuesSortBy=t.sortBy;let i=e?.length?e[0]:void 0;const{fieldName:s,props:a}=this,n=(0,l.g)(s,a);(0,l.a)(i)&&"string"==typeof i&&n.simpleFieldType===l.s.TIME_ONLY&&(i=(0,l.t)(i)),this.onValueChange(null,i),this.removeUniquePopover(),this.uniqueActionNode?.setFocus()}}}arcgisFilterUniqueListSortByChanged(e){const{detail:t}=e;t.uid===this.uid&&(this.uniqueValuesSortBy=t.sortBy)}arcgisFilterUniqueListDoneHandler(e){const{detail:t}=e;t===this.uid&&(this.removeUniquePopover(),this.uniqueActionNode?.setFocus())}calcitePopoverCloseHandler(){this.uniquePopoverNode&&(this.removeUniquePopover(),this.uniqueActionNode?.setFocus())}closeFilterPopoversHandler(){this.removeFieldsPickList(),this.removeUniquePopover()}async componentWillLoad(){const{props:e}=this,{modules:t}=e,i=(0,l.r)({fields:this.props.fields});this.fieldName=this.fieldName||i.layerField.name,this.operator=this.operator||(0,l.A)(this.props,i),this.hasFocus=!!this.hasFocus,t.summaryStatistics=t.summaryStatistics||await(0,r.aD)(),t.histogram=t.histogram||await(0,r.aE)(),t.uniqueValues=t.uniqueValues||await(0,r.bc)(),t.HistogramRangeSlider=t.HistogramRangeSlider||await(0,r.bd)(),this.onDocumentClickBind=this.onDocumentClick.bind(this)}componentDidLoad(){(0,o.i)(this.el.shadowRoot,this.props.modules.esriConfig),this.setFocus()}disconnectedCallback(){this.removeFieldsPickList(),this.removeUniquePopover()}render(){const{fieldName:e,props:t}=this,{layer:i}=t,a=(0,l.g)(e,t);if(!a?.simpleFieldType)return(0,s.h)(s.H,null,(0,s.h)("div",null));const r="sourceJSON"in i?i.sourceJSON?.editFieldsInfo:void 0;this.isEditorField=e===r?.creatorField||e===r?.editorField;const o=(0,n.a)(this.el);return(0,s.h)(s.H,{dir:o},(0,s.h)("div",{class:h},this.renderFieldSelection(),this.renderOperatorSelection(a),this.renderValueInput(a),this.renderTimeZone(a),this.renderHistogram(a)))}renderFieldSelection(){const{hasFocus:e,fieldName:t,showDelete:i,props:a}=this,{fields:n,strings:r}=a,o=(0,l.g)(t,a);return(0,s.h)("div",{class:d},(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",scale:"m",alignment:"icon-end-space-between",disabled:n.length<=1,iconEnd:"chevron-down",class:`${i?"field-button-trash":""} ${e?"autofocus":""}`,onClick:n.length>1?this.onFieldSelect:void 0,ref:e=>this.fieldNode=e},o?.label||""),i?(0,s.h)("calcite-action",{class:c,label:r.remove,text:"",scale:"s",icon:"trash",onClick:()=>this.arcgisFilterConditionDeleted.emit()}):null)}renderOperatorSelection(e){const{props:t}=this,{operators:i,strings:a}=t;let n=e.simpleFieldType;if(!n)return(0,s.h)(s.F,null);n===l.s.GUID&&(n=l.s.STRING),n===l.s.OID&&(n=l.s.NUMBER),(0,l.F)(e)&&(n=l.s.DOMAIN);let r=i?.get(n);this.isEditorField&&(r=r.filter((e=>!(0,l.d)(t,e.name)&&!(0,l.e)(t,e.name))));const o=r.map((e=>this.renderOperatorOption(e.name)));return(0,s.h)("calcite-select",{width:"full",scale:"m",label:a.accessibility.operator,class:p,onCalciteSelectChange:this.onOperatorSelect},o)}renderOperatorOption(e){const{operator:t}=this;return(0,s.h)("calcite-option",{value:e,label:e,selected:e===t})}renderValueInput(e){const{props:t,operator:i,invalidValue:a}=this,n=a?"invalid":void 0;let r=(0,s.h)(s.F,null);return(0,l.d)(t,i)||(0,l.e)(t,i)||(0,l.f)(t,i)?r=(0,s.h)(s.F,null):(0,l.b)(t,i)?r=this.renderUniqueValues(e):(0,l.c)(t,i)?r=this.renderInTheLast(e):e.simpleFieldType===l.s.STRING||e.simpleFieldType===l.s.GUID||(0,l.F)(e)?r=this.renderValueInputString(e,{status:n}):e.simpleFieldType===l.s.NUMBER?r=this.renderValueInputNumber(e,{status:n}):e.simpleFieldType===l.s.DATE?r=this.renderValueInputDate(e):e.simpleFieldType===l.s.DATE_ONLY?r=this.renderValueInputDateOnly(e):e.simpleFieldType===l.s.TIME_ONLY?r=this.renderValueInputTimeOnly(e):e.simpleFieldType===l.s.OID&&(r=this.renderValueInputOid(e,{status:n})),a?(0,s.h)("calcite-label",null,r,(0,s.h)("calcite-input-message",{icon:!0,status:n},a)):r}renderUniqueButton(e,t,i){const{props:a}=this,{layer:n,strings:l}=a;return e&&"imagery"!==n.type?(0,s.h)("calcite-action",{class:I,disabled:t,loading:!!i,text:l.chooseFromUnique,scale:"s",icon:"chevron-down",onClick:t?void 0:this.onSelectUniqueValue,ref:e=>{e&&(this.uniqueActionNode=e)}}):(0,s.h)(s.F,null)}renderValueInputString(e,t){const{props:i,value:a,operator:n}=this,{strings:r}=i,o=e.uniqueValuesStatus,u=e.uniqueValueInfos,d=[r.operators.stringOperatorIs,r.operators.stringOperatorIsNot].includes(n),c=d&&(o===l.G.FAILED||o===l.G.SUCCESS&&!u?.length),h=(0,l.F)(e),p=h?(0,l.H)(a,e):a,g=o===l.G.MISSING||o===l.G.IN_PROGRESS;return o===l.G.MISSING&&this.onDisplayUniqueValues(e.layerField.name),h?(0,l.a)(p)?(0,s.h)("div",{key:"value-input-string"},(0,s.h)("calcite-button",{key:p,appearance:"outline-fill",kind:"neutral",width:"full",scale:"m",alignment:"icon-end-space-between",iconEnd:g?"spinner":c?void 0:"chevron-down",disabled:c,onClick:c?void 0:this.onSelectUniqueValue,ref:e=>{e&&(this.uniqueActionNode=e)}},p?`${p}`:"")):(0,s.h)("div",{key:"value-input-string",class:m},(0,s.h)("div",{key:"value-input-string-button",class:`${v} ${y} ${o===l.G.SUCCESS?"active":"inactive"}`,tabIndex:-1,onClick:o===l.G.SUCCESS?this.onSelectUniqueValue:void 0}),this.renderUniqueButton(d,c,g)):(0,s.h)("div",{key:"value-input-string",class:m},(0,s.h)("calcite-input",{type:"text",value:p?`${p}`:"",class:v,scale:"m",label:r.accessibility.value,onCalciteInputInput:e=>this.onValueChange(e.target),...t}),this.renderUniqueButton(d,c,g))}renderValueInputNumber(e,t){const{props:i,value:a,value2:n,operator:r}=this,{strings:o}=i,u=(0,l.Q)(e);if([o.operators.numberOperatorIsBetween,o.operators.numberOperatorIsNotBetween].includes(r))return(0,s.h)("div",null,(0,s.h)("calcite-input",{type:"number",value:(0,l.a)(a)?`${a}`:"",scale:"m",step:u?"any":1,label:o.accessibility.fromValue,onCalciteInputInput:e=>this.waitOnUser(e.target,this.onValueChangeMaybe),...t}),(0,s.h)("div",{class:`${S} first`}),(0,s.h)("calcite-input",{type:"number",value:(0,l.a)(n)?`${n}`:"",scale:"m",step:u?"any":1,class:S,label:o.accessibility.toValue,onCalciteInputInput:e=>this.waitOnUser(e.target,this.onValue2ChangeMaybe),...t}));{const i=e.uniqueValuesStatus,n=e.uniqueValueInfos,d=[o.operators.numberOperatorIs,o.operators.numberOperatorIsNot,o.operators.numberOperatorIsAtLeast,o.operators.numberOperatorIsAtMost,o.operators.numberOperatorIsGreaterThan,o.operators.numberOperatorIsLessThan].includes(r),c=(0,s.h)("calcite-input",{class:v,type:"number",value:(0,l.a)(a)?`${a}`:"",scale:"m",step:u?"any":1,label:o.accessibility.value,onCalciteInputInput:e=>this.waitOnUser(e.target,this.onValueChange),...t});return i===l.G.FAILED||i===l.G.SUCCESS&&!n?.length||!d?(0,s.h)("div",{key:"value-input-number"},c):i===l.G.MISSING||i===l.G.IN_PROGRESS?(i===l.G.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",{key:"value-input-number",class:m},c,this.renderUniqueButton(d,!0,!0))):(0,s.h)("div",{key:"value-input-number",class:m},c,this.renderUniqueButton(d,!e.uniqueValueInfos?.length))}}renderValueInputDate(e){const{props:t,value:i,value2:a,operator:n}=this,{layer:r,view:o,strings:u}=t,d="number"==typeof i?(0,l.C)(i,o?.timeZone,"preferredTimeZone"in r?r.preferredTimeZone??void 0:void 0):i,c=(0,l.E)(d);if([u.operators.dateOperatorIsBetween,u.operators.dateOperatorIsNotBetween].includes(n)){const e="number"==typeof a?(0,l.C)(a,o?.timeZone,"preferredTimeZone"in r?r.preferredTimeZone??void 0:void 0):a,t=(0,l.E)(e);return(0,s.h)("div",null,(0,s.h)("calcite-label",{class:f},u.startDate),(0,s.h)("calcite-input-date-picker",{class:`${V} first`,scale:"m",value:d,overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>this.onValueChange(e.target),ref:e=>{e&&(this.dateNode=e)}}),(0,s.h)("calcite-input-time-picker",{class:`${V} ${v}}`,scale:"m",value:c,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:e=>this.onValueChange(e.target),ref:e=>this.timeNode=e}),(0,s.h)("calcite-label",{class:f},u.endDate),(0,s.h)("calcite-input-date-picker",{class:`${V} first`,scale:"m",value:e,"data-value":"second",overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>this.onValue2Change(e.target),ref:e=>{e&&(this.dateNode2=e)}}),(0,s.h)("calcite-input-time-picker",{class:`${V} ${v}`,scale:"m",value:t,"data-value":"second",step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:e=>this.onValue2Change(e.target),ref:e=>this.timeNode2=e}))}{const t=e.uniqueValuesStatus,i=e.uniqueValueInfos,a=[u.operators.dateOperatorIsOn,u.operators.dateOperatorIsNotOn,u.operators.dateOperatorIsAfter,u.operators.dateOperatorIsBefore,u.operators.dateOperatorIsAfterOrEqual,u.operators.dateOperatorIsBeforeOrEqual].includes(n),r=(0,s.h)("div",{class:g},(0,s.h)("calcite-input-date-picker",{class:`${V} ${v} first`,scale:"m",value:d,overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>this.onValueChange(e.target),ref:e=>{e&&(this.dateNode=e)}}),(0,s.h)("calcite-input-time-picker",{class:`${V} ${v}`,scale:"m",value:c,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:e=>this.onValueChange(e.target),ref:e=>this.timeNode=e}));return t===l.G.FAILED||t===l.G.SUCCESS&&!i?.length||!a?(0,s.h)("div",{key:"value-input-date"},r):t===l.G.MISSING||t===l.G.IN_PROGRESS?(t===l.G.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",{key:"value-input-date",class:m},r,this.renderUniqueButton(a,!0,!0))):(0,s.h)("div",{key:"value-input-date",class:m},r,this.renderUniqueButton(a,!e.uniqueValueInfos?.length))}}renderValueInputDateOnly(e){const{props:t,value:i,value2:a,operator:n}=this,{strings:r}=t,o="number"==typeof i?new Date(i).toISOString():i;if([r.operators.dateOperatorIsBetween,r.operators.dateOperatorIsNotBetween].includes(n)){const e="number"==typeof a?new Date(a).toISOString():a;return(0,s.h)("div",null,(0,s.h)("calcite-input-date-picker",{class:`${V} first`,scale:"m",value:o,overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>this.onValueChange(e.target)}),(0,s.h)("calcite-input-date-picker",{class:V,scale:"m",value:e,overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>this.onValue2Change(e.target)}))}{const t=e.uniqueValuesStatus,i=e.uniqueValueInfos,a=[r.operators.dateOperatorIsOn,r.operators.dateOperatorIsNotOn,r.operators.dateOperatorIsAfter,r.operators.dateOperatorIsBefore,r.operators.dateOperatorIsAfterOrEqual,r.operators.dateOperatorIsBeforeOrEqual].includes(n),u=(0,s.h)("calcite-input-date-picker",{class:`${V} ${v}`,scale:"m",value:o,overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>this.onValueChange(e.target)});return t===l.G.FAILED||t===l.G.SUCCESS&&!i?.length||!a?(0,s.h)("div",{key:"value-input-date"},u):t===l.G.MISSING||t===l.G.IN_PROGRESS?(t===l.G.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",{key:"value-input-date",class:m},u,this.renderUniqueButton(a,!0,!0))):(0,s.h)("div",{key:"value-input-date",class:m},u,this.renderUniqueButton(a,!e.uniqueValueInfos?.length))}}renderValueInputTimeOnly(e){const{props:t,value:i,value2:a,operator:n}=this,{strings:r}=t,o="number"==typeof i?(0,l.h)(i):i;if([r.operators.dateOperatorIsBetween,r.operators.dateOperatorIsNotBetween].includes(n)){const e="number"==typeof a?(0,l.h)(a):a;return(0,s.h)("div",null,(0,s.h)("calcite-input-time-picker",{class:`${V} first`,scale:"m",value:o,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:e=>this.onValueChange(e.target)}),(0,s.h)("calcite-input-time-picker",{class:V,scale:"m",value:e,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:e=>this.onValue2Change(e.target)}))}{const t=e.uniqueValuesStatus,i=e.uniqueValueInfos,a=[r.operators.dateOperatorIsOn,r.operators.dateOperatorIsNotOn,r.operators.dateOperatorIsAfter,r.operators.dateOperatorIsBefore,r.operators.dateOperatorIsAfterOrEqual,r.operators.dateOperatorIsBeforeOrEqual].includes(n),u=(0,s.h)("calcite-input-time-picker",{class:`${V} ${v}`,scale:"m",value:o,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:e=>this.onValueChange(e.target)});return t===l.G.FAILED||t===l.G.SUCCESS&&!i?.length||!a?(0,s.h)("div",{key:"value-input-time"},u):t===l.G.MISSING||t===l.G.IN_PROGRESS?(t===l.G.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",{key:"value-input-time",class:m},u,this.renderUniqueButton(a,!0,!0))):(0,s.h)("div",{key:"value-input-time",class:m},u,this.renderUniqueButton(a,!e.uniqueValueInfos?.length))}}renderValueInputOid(e,t){const{props:i,value:a,value2:n,operator:r}=this,{strings:o}=i;if(e.simpleFieldType===l.s.OID)if((0,l.a)(a)&&(0,l.a)(n)){const e=Math.round(a),t=Math.round(n);e===a&&t===n||this.changeValues(e,t)}else if((0,l.a)(a)){const e=Math.round(a);e!==a&&this.changeValues(e,n)}else if((0,l.a)(n)){const e=Math.round(n);e!==n&&this.changeValues(a,e)}if([o.operators.numberOperatorIsBetween,o.operators.numberOperatorIsNotBetween].includes(r))return(0,s.h)("div",null,(0,s.h)("calcite-input",{type:"number",value:(0,l.a)(a)?`${a}`:"",scale:"m",min:0,step:1,label:o.accessibility.fromValue,onCalciteInputInput:e=>this.onValueChangeMaybe(e.target),...t}),(0,s.h)("div",{class:`${S} first`}),(0,s.h)("calcite-input",{type:"number",value:(0,l.a)(n)?`${n}`:"",scale:"m",min:0,step:1,class:S,label:o.accessibility.toValue,onCalciteInputInput:e=>this.onValue2ChangeMaybe(e.target),...t}));{const i=e.uniqueValuesStatus,n=e.uniqueValueInfos,u=[o.operators.numberOperatorIs,o.operators.numberOperatorIsNot,o.operators.numberOperatorIsAtLeast,o.operators.numberOperatorIsAtMost,o.operators.numberOperatorIsGreaterThan,o.operators.numberOperatorIsLessThan].includes(r),d=(0,s.h)("calcite-input",{class:v,type:"number",value:(0,l.a)(a)?`${a}`:"",scale:"m",min:0,step:1,label:o.accessibility.value,onCalciteInputInput:e=>this.onValueChange(e.target),...t});return i===l.G.FAILED||i===l.G.SUCCESS&&!n?.length||!u?(0,s.h)("div",{key:"value-input-oid"},d):i===l.G.MISSING||i===l.G.IN_PROGRESS?(i===l.G.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",{key:"value-input-oid",class:m},d,this.renderUniqueButton(u,!0,!0))):(0,s.h)("div",{key:"value-input-oid",class:m},d,this.renderUniqueButton(u,!e.uniqueValueInfos?.length))}}renderUniqueValues(e){const{props:t,values:i,fieldName:a}=this,{strings:n}=t,r=e.uniqueValuesStatus,o=e.uniqueValueInfos;if(r===l.G.MISSING||r===l.G.IN_PROGRESS)return r===l.G.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",null,(0,s.h)("calcite-loader",{class:L,inline:!0,label:""}));if(r===l.G.FAILED)return(0,s.h)("div",{class:F},(0,s.h)("calcite-button",{appearance:"transparent",width:"full",scale:"m",alignment:"center",class:C,disabled:!0,label:n.selectValues},n.selectValues),n.errors.errorUniqueValues);{const t=(0,s.h)("div",{class:F},!i?.length&&o?.length?n.selectOneValue:"");let l;o?.length||(l=(0,s.h)("div",{class:F},n.errors.noUniqueValues));const r=i?.map((t=>this.renderSelectedUniqueValue(t,e)));return(0,s.h)("div",null,t,(0,s.h)("calcite-button",{appearance:"transparent",width:"full",scale:"m",alignment:"center",class:C,disabled:!o?.length,onClick:o?.length?this.onSelectUniqueValues:void 0,ref:e=>this.uniqueSelectNode=e,label:n.selectValues},n.selectValues),l,i?.length?(0,s.h)("calcite-list",{key:`unique-values-list-${a}`,class:T,ref:this.afterCreateList,label:n.values},r):null)}}renderSelectedUniqueValue(e,t){const{props:i}=this,{view:a,strings:n,modules:r}=i,o=a?.timeZone||"system",u=(0,l.F)(t)?(0,l.H)(e,t):(0,l.m)(t)?(0,l.I)(e,o,r.intl):(0,l.n)(t)?(0,l.J)(e,r.intl):(0,l.o)(t)?(0,l.K)(e,r.intl):(0,l.k)(t)?r.intl.formatNumber(e):e;return(0,s.h)("calcite-list-item",{label:`${u}`,value:`${e}`},(0,s.h)("calcite-action",{slot:"actions-end",text:n.remove,icon:"x",onClick:this.onRemoveSelectedValue.bind(this,e)}))}renderInTheLast(e){const{props:t,value:i,unit:a}=this,{strings:n}=t,r=(0,l.n)(e);return(0,s.h)("div",{class:N},(0,s.h)("calcite-input-number",{inputMode:"decimal",min:1,integer:!0,value:(0,l.a)(i)?`${i}`:"",class:b,label:n.accessibility.value,onCalciteInputNumberInput:e=>this.onValueChange(e.target)}),(0,s.h)("calcite-select",{width:"full",scale:"m",label:n.accessibility.units,class:E,onCalciteSelectChange:this.onUnitSelect},!r&&this.renderInTheLastOption(l.L.MINUTE,a===l.L.MINUTE),!r&&this.renderInTheLastOption(l.L.HOUR,a===l.L.HOUR),this.renderInTheLastOption(l.L.DAY,a===l.L.DAY),this.renderInTheLastOption(l.L.WEEK,a===l.L.WEEK),this.renderInTheLastOption(l.L.MONTH,a===l.L.MONTH),this.renderInTheLastOption(l.L.YEAR,a===l.L.YEAR)))}renderInTheLastOption(e,t){const{props:i}=this,{strings:a}=i;return(0,s.h)("calcite-option",{value:e,label:a.units[e],selected:t})}renderTimeZone(e){const{props:t}=this,{view:i,strings:a}=t;if(e.simpleFieldType!==l.s.DATE)return(0,s.h)(s.F,null);const n=i&&"system"!==i.timeZone?"unknown"===i.timeZone?a.timeZoneUnknown:void 0:a.timeZoneSystem;return(0,s.h)("calcite-label",{class:D,scale:"s",layout:"inline",alignment:"start"},(0,s.h)("calcite-icon",{icon:"time-zone",scale:"s",class:k}),n||(0,s.h)("calcite-input-time-zone",{mode:"region","read-only":!0,value:i?.timeZone,tabindex:"-1"}))}renderHistogram(e){const{props:t,histogramClosed:i,operator:a,fieldName:n}=this,{layer:r,strings:o}=t;return"imagery"===r.type?(0,s.h)(s.F,null):e?.simpleFieldType?e.statisticsStatus===l.G.FAILED?(0,s.h)(s.F,null):(0,l.M)(n,a,t)?((void 0===i||!i&&e.histogramStatus===l.G.MISSING)&&this.onHistogramOpen(),(0,s.h)("calcite-block-section",{open:!0!==i,text:e.histogramStatus===l.G.FAILED?o.valueRange:o.histogram,onCalciteBlockSectionToggle:this.onHistogramBlockToggle},this.renderHistogramContent(e))):(0,s.h)(s.F,null):(0,s.h)(s.F,null)}renderHistogramContent(e){const{histogramClosed:t}=this,i=e.layerField.name;if(!0===t)return(0,s.h)(s.F,null);if(e.statistics&&e.histogramStatus!==l.G.IN_PROGRESS){return this.prepareSlider(e)?(0,s.h)("div",{key:`histogram-content-${i}-${e.statistics}`,class:e.histogram?O:q,ref:this.afterCreateSliderDiv,dir:(0,n.a)(this.el)}):(0,s.h)(s.F,null)}return(0,s.h)("div",{key:`histogram-content-${i}-${e.statistics}`,class:e.histogram?O:q},(0,s.h)("calcite-loader",{class:L,inline:!0,label:""}))}setFocus(){setTimeout((()=>{const e=this.el.querySelector(".autofocus");e?.setFocus()}),500)}onSelectUnique(e){const{props:t,value:i,values:n,fieldName:r,uid:o,uniqueValuesSortBy:u}=this,{strings:d,fullLocale:c,modules:h}=t;if(this.uniquePopoverNode)return void this.closeFilterPopoversHandler();this.closeFilterPopoversHandler();const p=(0,l.g)(r,t);if(!p)return;const m=this.fieldNode?.getBoundingClientRect().width,g=m?m+2:204,v=(0,a.q)(this.el,"calcite-panel")||(0,a.q)(this.el,"calcite-flow-item"),f=v?.clientHeight,y=f?Math.max(Math.min(f/3,400),200):400,I=document.createElement("calcite-popover");I.id=`arcgis-filter-unique-popover_${o}`,I.placement="bottom-end",I.offsetDistance=0,I.offsetSkidding=0,I.pointerDisabled=!0,I.overlayPositioning="fixed",I.referenceElement=e?this.uniqueSelectNode:this.uniqueActionNode;const S=document.createElement("arcgis-filter-unique-list");S.uid=o,S.props=t,S.uniqueValues=h.esriLang.clone(p.uniqueValueInfos),S.selectedValues=e?n:i?[i]:[],S.fieldDomains=p.fieldDomains,S.layerFieldType=p.layerField.type,S.multiple=e,S.sortBy=u,S.partialUniqueValues=p.partialUniqueValues,S.maxHeight=y,S.strings=d,S.locale=c,S.style=`width: ${g}px`,I.appendChild(S),document.body.appendChild(I),(0,s.f)(S),S.setFocus(),I.reposition(),this.uniquePopoverNode=I,setTimeout((()=>{I.open=!0,document.addEventListener("click",this.onDocumentClickBind)}),50)}scrollExprIntoView(e){setTimeout((()=>{e&&(e=(0,a.q)(e,".filter-expression"),e?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}),100)}removeUniquePopover(){document.removeEventListener("click",this.onDocumentClickBind),this.uniquePopoverNode&&(this.uniquePopoverNode.open=!1,this.uniquePopoverNode?.parentElement?.removeChild(this.uniquePopoverNode),this.uniquePopoverNode=void 0)}async onDisplayUniqueValues(e){const{props:t}=this,{layer:i,view:a,mode:n,modules:r}=t,o=(0,l.g)(e,t);if(o&&"imagery"!==i.type&&o.uniqueValuesStatus===l.G.MISSING&&i){o.uniqueValuesStatus=l.G.IN_PROGRESS;try{const s=await r.uniqueValues({layer:i,view:a,field:e,forBinning:"feature-reduction"===n&&["binning","cluster"].includes(i.featureReduction?.type)}),u=(0,l.k)(o),d=s.uniqueValueInfos.filter((e=>!!(0,l.a)(e.value)&&("string"===o.simpleFieldType&&!u||"guid"===o.simpleFieldType?"<Null>"!==e.value&&""!==`${e.value}`.trim():("number"===o.simpleFieldType||o.simpleFieldType,"<Null>"!==e.value&&""!==e.value))));d.sort(((e,t)=>e.count>t.count?-1:e.count<t.count?1:0)),(0,l.F)(o)&&o.fieldDomains.forEach((e=>{d.find((t=>t.value===e.code))||d.push({value:e.code,count:0})}));const c=2e3===s.uniqueValueInfos.length;t.fields=t.fields.map((t=>t.layerField.name===e?{...t,uniqueValueInfos:d,uniqueValuesStatus:l.G.SUCCESS,partialUniqueValues:c}:t)),this.arcgisValuesReturned.emit(o.layerField.name)}catch(i){if(console.error("error-uniqueValues",i),(0,l.F)(o)){const i=[];o.fieldDomains.forEach((e=>{i.find((t=>t.value===e.code))||i.push({value:e.code,count:void 0})})),t.fields=t.fields.map((t=>t.layerField.name===e?{...t,uniqueValueInfos:i,uniqueValuesStatus:l.G.SUCCESS,partialUniqueValues:!1}:t))}else t.fields=t.fields.map((t=>t.layerField.name===e?{...t,uniqueValuesStatus:l.G.FAILED}:t));(0,s.f)(this.el)}}}async onHistogramOpen(){const{props:e,fieldName:t}=this,{layer:i,view:a,mode:n,modules:r}=e,o=(0,l.g)(t,e);if(i&&"imagery"!==i.type&&o){if("subtype-group"===i.type)return e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statisticsStatus:l.G.FAILED,histogramStatus:l.G.FAILED}:e)),this.histogramClosed=!0,void(0,s.f)(this.el);if(o.statistics)this.checkDefaultValues(o),this.histogramClosed=!1;else if(!o.statistics){e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statisticsStatus:l.G.IN_PROGRESS}:e));try{const u=await r.summaryStatistics({layer:i,view:a,field:t,forBinning:"feature-reduction"===n&&["binning","cluster"].includes(i.featureReduction?.type),outStatisticTypes:{exclude:["median"]}});if(!(0,l.a)(u.avg)||!(0,l.a)(u.min)||!(0,l.a)(u.max))return e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statisticsStatus:l.G.FAILED}:e)),void(this.histogramClosed=!0);u.min===u.max&&(u.min>0?(u.min=u.min-.1*u.min,u.max=u.max+.1*u.max):u.min<0?(u.min=u.min+.1*u.min,u.max=u.max-.1*u.max):(u.min=-1,u.max=1)),e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statistics:u,statisticsStatus:l.G.SUCCESS}:e)),this.checkDefaultValues(o);try{const o=await r.histogram({layer:i,view:a,field:t,numBins:30,minValue:u.min,maxValue:u.max,forBinning:"feature-reduction"===n&&["binning","cluster"].includes(i.featureReduction?.type)});e.fields=e.fields.map((e=>e.layerField.name===t?{...e,histogram:o,histogramStatus:l.G.SUCCESS}:e)),(0,s.f)(this.el)}catch(i){console.error("error-histogram",i),e.fields=e.fields.map((e=>e.layerField.name===t?{...e,histogramStatus:l.G.FAILED}:e)),(0,s.f)(this.el)}}catch(i){console.error("error-summaryStatistics",i),e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statisticsStatus:l.G.FAILED,histogramStatus:l.G.FAILED}:e)),this.histogramClosed=!0,(0,s.f)(this.el)}}}}onHistogramClose(){this.histogramClosed=!0}async onMinMaxChange(e,t,i){const{props:a,value:n,value2:r}=this,{layer:o,view:u,mode:d,modules:c}=a,h=(0,l.g)(i,a);if(h&&"imagery"!==o.type){this.value=Math.min(Math.max(n,e),t),(0,l.a)(r)&&(this.value2=Math.min(Math.max(r,e),t)),this.histogramClosed=!1,a.fields=a.fields.map((e=>e.layerField.name===i?{...e,histogramStatus:l.G.IN_PROGRESS}:e));try{const n=await c.histogram({layer:o,view:u,field:h.layerField.name,numBins:30,minValue:e,maxValue:t,forBinning:"feature-reduction"===d&&["binning","cluster"].includes(o.featureReduction?.type)});a.fields=a.fields.map((e=>e.layerField.name===i?{...e,histogram:n,histogramStatus:l.G.SUCCESS}:e)),(0,s.f)(this.el)}catch(e){console.error("error-histogram",e),a.fields=a.fields.map((e=>e.layerField.name===i?{...e,histogramStatus:l.G.FAILED}:e))}}}adjustHistogramMinMax(e){const{histogramSlider:t}=this;t&&(t.min>e&&t.set({min:e}),t.max<e&&t.set({max:e}))}prepareSlider(e){const{histogramSliderFieldName:t,props:i}=this,{modules:s}=i;let{value:a,value2:n,histogramSlider:r}=this;const o=e.statistics;if(e.histogramStatus===l.G.IN_PROGRESS)return!1;(0,l.a)(a)&&"number"!=typeof a&&(a=void 0),(0,l.a)(n)&&"number"!=typeof n&&(n=void 0),this.checkDefaultValues(e);const u=[];if(u.push(a),(0,l.a)(n)&&u.push(n),(0,l.B)(e)){if((0,l.a)(u[0])){const e=Math.round(u[0]);e!==u[0]&&this.changeValues(e,n),u[0]=e}if((0,l.a)(u[1])){const e=Math.round(u[1]);e!==u[1]&&this.changeValues(a,e),u[1]=e}}let d=e.histogram?e.histogram.minValue:o.min,c=e.histogram?e.histogram.maxValue:o.max;if((0,l.a)(u[0])&&(0,l.a)(u[1])?(d=Math.min(d,u[0]),c=Math.max(c,u[1])):(0,l.a)(u[0])&&(d=Math.min(d,u[0]),c=Math.max(c,u[0])),r&&t!==e.layerField.name&&(r.destroy(),r=void 0),r){const t={bins:e.histogram?.bins,average:Math.round(10*o.avg)/10,min:d,max:c,values:void 0===u?.[0]?void 0:u,rangeType:this.getSliderRangeType()};r.set(t)}else{const t={bins:e.histogram?.bins,average:Math.round(10*o.avg)/10,min:d,max:c,values:void 0===u?.[0]?void 0:u,rangeType:this.getSliderRangeType(),precision:(0,l.B)(e)?0:4};[l.s.DATE,l.s.DATE_ONLY,l.s.TIME_ONLY].includes(e.simpleFieldType)&&(t.hasTimeData=!0,this.addDateFormatFunctions(t,e)),this.histogramSliderFieldName=e.layerField.name,this.histogramSlider=new s.HistogramRangeSlider(t),this.createSliderChangeEvents(e)}return!0}createSliderChangeEvents(e){const{histogramSlider:t}=this;t&&(t.on("min-change",(i=>{const s=t;this.onMinMaxChange(i.value,s.max,e.layerField.name)})),t.on("max-change",(i=>{const s=t;this.onMinMaxChange(s.min,i.value,e.layerField.name)})),t.watch("values",(()=>{const i=t;let s=i.values?.[0],a=i.values?.[1];[l.s.DATE,l.s.DATE_ONLY,l.s.TIME_ONLY].includes(e.simpleFieldType)&&(s=Math.round(s)),(0,l.B)(e)&&(a||0===s?(s=Math.floor(s),a=Math.ceil(a)):s=Math.round(s)),this.changeValues(s,a)})),t.on("segment-drag",(()=>{const i=t;let s=i.values[0],a=i.values[1];(0,l.B)(e)&&(a||0===s?(s=Math.floor(s),a=Math.ceil(a)):s=Math.round(s)),this.changeValues(s,a)})))}getSliderRangeType(){const{props:e,operator:t}=this,{strings:i}=e;switch(t){case i.operators.numberOperatorIs:case i.operators.dateOperatorIsOn:return"equal";case i.operators.numberOperatorIsNot:case i.operators.dateOperatorIsNotOn:return"not-equal";case i.operators.numberOperatorIsLessThan:case i.operators.dateOperatorIsBefore:return"less-than";case i.operators.numberOperatorIsGreaterThan:case i.operators.dateOperatorIsAfter:return"greater-than";case i.operators.numberOperatorIsAtMost:case i.operators.dateOperatorIsBeforeOrEqual:return"at-most";case i.operators.numberOperatorIsAtLeast:case i.operators.dateOperatorIsAfterOrEqual:return"at-least";case i.operators.numberOperatorIsBetween:case i.operators.dateOperatorIsBetween:return"between";case i.operators.numberOperatorIsNotBetween:case i.operators.dateOperatorIsNotBetween:return"not-between";default:return""}}getNewValue(e){const{fieldName:t,props:i}=this,{layer:s,view:a}=i,n=e;let r;if("CALCITE-INPUT-DATE-PICKER"===n?.tagName||"CALCITE-INPUT-TIME-PICKER"===n?.tagName){const e=(0,l.g)(t,i),o=n.getAttribute("data-value");if("CALCITE-INPUT-DATE-PICKER"===n?.tagName){if(r=n.value,!r)return;r=e.simpleFieldType===l.s.DATE?(0,l.N)(`${r} ${"second"===o?this.timeNode2?.value:this.timeNode?.value}`,s.fieldsIndex.getTimeZone(t),a?.timeZone,"preferredTimeZone"in s?s.preferredTimeZone??void 0:void 0):(0,l.O)(r)}else{if(r=n.value,!r)return;r=e.simpleFieldType===l.s.DATE?(0,l.N)(`${"second"===o?this.dateNode2?.value:this.dateNode?.value} ${r}`,s.fieldsIndex.getTimeZone(t),a?.timeZone,"preferredTimeZone"in s?s.preferredTimeZone??void 0:void 0):(0,l.t)(r)}}else if("CALCITE-INPUT"===n?.tagName&&"number"===n.type||"CALCITE-INPUT-NUMBER"===n?.tagName){if(r=n.value,!r)return;r=Number.parseFloat(r)}else"CALCITE-INPUT"===n?.tagName&&(r=n.value,r?.length||(r=void 0));return r}addDateFormatFunctions(e,t){const{props:i}=this,{view:s,modules:a}=i,n=s?.timeZone||"system";e.labelFormatFunction=e=>t.simpleFieldType===l.s.DATE?(0,l.I)(e,n,a.intl,"short-date"):t.simpleFieldType===l.s.DATE_ONLY?(0,l.J)(e,a.intl):(0,l.K)(e,a.intl)}changeValues(e,t){const{props:i,fieldName:s}=this,a=(0,l.g)(s,i),n=a.simpleFieldType&&[l.s.NUMBER,l.s.DATE,l.s.OID].includes(a.simpleFieldType)&&Number.isNaN(e)?void 0:e,r=a.simpleFieldType&&[l.s.NUMBER,l.s.DATE,l.s.OID].includes(a.simpleFieldType)&&Number.isNaN(t)?void 0:t;this.value===n&&this.value2===r||this.emitChangeEvent({value:n??void 0,value2:r??void 0})}checkDefaultValues(e){const{props:t,operator:i,value:s,value2:a,histogramSlider:n}=this,r=e.statistics,o=(0,l.v)(t,e,i);if((0,l.c)(t,i)){if(!(0,l.a)(s)){let e,t;if(r){const i=(new Date).getTime(),s=Math.abs(i-r.avg);s>2*l.R.YEAR?(e=Math.round(s/l.R.YEAR),t=l.L.YEAR):s>2*l.R.MONTH?(e=Math.round(s/l.R.MONTH),t=l.L.MONTH):s>2*l.R.WEEK?(e=Math.round(s/l.R.WEEK),t=l.L.WEEK):s>2*l.R.DAY?(e=Math.round(s/l.R.DAY),t=l.L.DAY):s>2*l.R.HOUR?(e=Math.round(s/l.R.HOUR),t=l.L.HOUR):(e=Math.round(s/l.R.MINUTE),t=l.L.MINUTE)}else e=1,t=l.L.YEAR;this.emitChangeEvent({value:e,unit:t})}}else if((0,l.i)(t,i))if((0,l.a)(s))if((0,l.a)(a))a<s&&(n&&n.values[0]===s?this.changeValues(s,s):this.changeValues(a,a));else{const t=r?.max??s+1,i=(0,l.B)(e)?Math.round(t):t;this.changeValues(s,i)}else if((0,l.a)(a)){const i=r?(0,l.P)(r.avg,t,e):a-1;this.changeValues(i,a)}else this.changeValues(o.value,o.value2);else(0,l.a)(s)||this.changeValues(o.value,o.value2);return o}openFieldPickList(){const{props:e,fieldName:t,fieldPickListSortBy:i}=this,{layer:s,view:a,insideDialog:n,mode:l,panelNode:r}=e;this.closeFilterPopoversHandler();const o=r?.getBoundingClientRect().width||240,u=Math.min(Math.round(o),500),d=-1*Math.round(u+(o-u)/2);this.arcgisFieldPickList=document.createElement("arcgis-field-pick-list"),this.arcgisFieldPickList.popoverProps={placement:"leading",offsetDistance:d,offsetSkidding:0,pointerDisabled:!0,popoverWidth:u,overlayPositioning:"fixed",refElement:r,zIndex:n?900:"effects"===l?101:void 0},this.arcgisFieldPickList.fields=this.createPickListFields(),this.arcgisFieldPickList.layer=s,this.arcgisFieldPickList.mapView=a,this.arcgisFieldPickList.showFieldInfo=!0,this.arcgisFieldPickList.showFieldName=!1,this.arcgisFieldPickList.selectedFields=[t],this.arcgisFieldPickList.sortBy=i??"default",this.arcgisFieldPickList.showFieldInfo="feature-reduction"!==l,this.arcgisFieldPickList.addEventListener("arcgisFieldPickListDismissed",this.fieldPickListChanges),this.arcgisFieldPickList.addEventListener("arcgisSortByChange",(e=>this.fieldPickListSortBy=e.detail)),document.body.appendChild(this.arcgisFieldPickList),this.disablePanel.emit(!0)}createPickListFields(){const{props:e}=this,{fields:t}=e;return t.map((e=>({name:e.layerField.name,alias:e.label,type:e.simpleFieldType})))}removeFieldsPickList(){this.disablePanel.emit(!1),this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=void 0,setTimeout((()=>this.fieldNode?.setFocus()),1))}afterFieldSelect(e){const{props:t,fieldName:i,operator:s,histogramClosed:a}=this,{strings:n}=t,r=(0,l.g)(i,t),o=(0,l.g)(e,t);let u;const d=(0,l.S)(t,r,o,s),c=(0,l.g)(e,t);c.simpleFieldType===l.s.STRING&&c.uniqueValuesStatus===l.G.SUCCESS&&c.uniqueValueInfos?.length&&[n.operators.stringOperatorIs,n.operators.stringOperatorIsNot].includes(d)&&(u=c.uniqueValueInfos[0].value??void 0),this.emitChangeEvent({hasFocus:!0,fieldName:e,operator:d,value:u,value2:void 0,values:void 0,uniqueValuesSortBy:void 0,histogramClosed:o.simpleFieldType&&![l.s.NUMBER,l.s.DATE,l.s.DATE_ONLY,l.s.TIME_ONLY].includes(o.simpleFieldType)||o.statisticsStatus===l.G.FAILED?void 0:!0===a&&r.statisticsStatus!==l.G.FAILED||void 0})}emitChangeEvent(e){const{uid:t,fieldName:i,operator:s,uniqueValuesSortBy:a,value:n,value2:r,values:o,unit:u,histogramClosed:d,hasFocus:c,props:h}=this,p=(0,l.c)(h,s)&&e.unit&&u&&e.unit!==u,m={uid:t,fieldName:e.fieldName||i,operator:e.operator||s,uniqueValuesSortBy:void 0===e.uniqueValuesSortBy?void 0:e.uniqueValuesSortBy||a,value:p?e.value??n:void 0===e.value?void 0:e.value??n,value2:void 0===e.value2?void 0:e.value2??r,values:void 0===e.values?void 0:e.values||o,unit:e.unit||u,histogramClosed:void 0===e.histogramClosed?void 0:e.histogramClosed||d,hasFocus:e.hasFocus||c};this.arcgisFilterConditionChanged.emit(m)}waitOnUser(e,t){this.typingHndl&&(clearTimeout(this.typingHndl),this.typingHndl=void 0);const i=e.value,s=Number.parseFloat(i);i?i.startsWith("-")&&(0===s||Number.isNaN(s))||t(e):this.typingHndl=setTimeout((()=>{this.typingHndl=void 0,t(e)}),2e3)}get el(){return(0,s.g)(this)}};P.style='.field-selection {\n  display: flex;\n  align-items: normal;\n}\n.delete-action {\n  padding: 0 0 0 4px;\n}\n:dir(rtl) {\n  .delete-action {\n    padding: 0 4px 0 0;\n  }\n}\n.operator-dropdown {\n  width: 100%;\n  margin: 5px 0;\n}\n.input-plus-unique {\n  display: flex;\n  flex-direction: row;\n  width: 100%;\n}\n.input-plus-unique-date {\n  width: 100%;\n}\n.input {\n  width: 100%;\n}\n.blank-button {\n  height: 22px;\n  border: var(--calcite-color-border-input) 1px solid;\n}\n.blank-button.active {\n  cursor: pointer;\n}\n.blank-button.inactive:focus {\n  outline: none;\n}\n.select-unique-button {\n  height: 32px;\n  border-top: var(--calcite-color-border-input) 1px solid;\n  border-bottom: var(--calcite-color-border-input) 1px solid;\n  border-right: var(--calcite-color-border-input) 1px solid;\n}\n:dir(rtl) {\n  .select-unique-button {\n    border-right: none;\n    border-left: var(--calcite-color-border-input) 1px solid;\n  }\n}\n.between-values-input.first {\n  margin-bottom: 5px;\n}\n.select-values {\n  margin-bottom: 4px;\n}\n.field-button-trash {\n  /* button with trash action */\n  inline-size: calc(100% - 36px);\n}\n.list {\n  max-height: 200px;\n  overflow-y: auto;\n}\n.unique-values-content-list-msg {\n  font-size: 90%;\n  margin-top: 5px;\n  margin-bottom: 5px;\n}\n.in-the-last {\n  display: flex;\n}\n.in-the-last-count {\n  width: 50%;\n}\n.in-the-last-unit {\n  width: 50%;\n}\n.date-picker {\n  width: 100%;\n}\n.date-picker.first {\n  margin-bottom: 5px;\n}\n.label {\n  margin-top: 10px;\n}\n.time-zone {\n  margin-top: 5px;\n}\n.time-zone-icon {\n  opacity: 60%;\n}\n.histogram-content {\n  height: 120px;\n  margin-top: 5px;\n}\n.histogram-content-slim {\n  height: 40px;\n  margin-top: 5px;\n}\n.small-loader {\n  margin-left: calc((100% - 16px) / 2);\n  margin-top: 10px;\n}\nhtml[dir="rtl"] .small-loader {\n  margin-left: auto;\n  margin-right: 8px;\n}\ncalcite-input-time-zone[read-only] {\n  --calcite-color-border-input: transparent;\n  --calcite-color-background: transparent;\n  --calcite-font-weight-medium: normal;\n  pointer-events: none;\n\n  margin-left: -10px;\n}\n:dir(rtl) {\n  calcite-input-time-zone[read-only] {\n    margin-left: auto;\n    margin-right: -10px;\n  }\n}\n';const w="container",U="popover-unique-list",x="unique-values-content-list-msg",M="count",A="unique-values-done",B=class{constructor(e){(0,s.r)(this,e),this.arcgisDone=(0,s.c)(this,"arcgisDone",7),this.arcgisFilterUniqueListDone=(0,s.c)(this,"arcgisFilterUniqueListDone",7),this.arcgisChanged=(0,s.c)(this,"arcgisChanged",7),this.arcgisFilterUniqueListChanged=(0,s.c)(this,"arcgisFilterUniqueListChanged",7),this.arcgisSortByChanged=(0,s.c)(this,"arcgisSortByChanged",7),this.arcgisFilterUniqueListSortByChanged=(0,s.c)(this,"arcgisFilterUniqueListSortByChanged",7),this.manager=(0,n.u)(this),this.strings=(0,u.u)({blocking:!0,name:"filter"}),this.onSortMenuSelect=e=>{const t=e.currentTarget,i=t.selectedItems?.[0].getAttribute("data-value");this.sortBy=i||void 0,this.arcgisFilterUniqueListSortByChanged.emit({uid:this.uid,sortBy:i||void 0}),this.arcgisSortByChanged.emit({uid:this.uid,sortBy:i||void 0})},this.done=()=>{this.arcgisFilterUniqueListDone.emit(this.uid),this.arcgisDone.emit(this.uid)},this.uid=void 0,this.props=void 0,this.uniqueValues=void 0,this.selectedValues=void 0,this.fieldDomains=void 0,this.layerFieldType=void 0,this.sortBy=void 0,this.multiple=!1,this.partialUniqueValues=!1,this.maxHeight=void 0}async setFocus(){this.listNode?.setFocus()}async componentWillLoad(){const{props:e}=this,{locale:t,modules:i}=e;i?i.intl.setLocale(t):(e.strings=this.strings,e.modules={intl:await(0,r.al)()})}render(){const{uid:e,uniqueValues:t,selectedValues:i,layerFieldType:a,fieldDomains:n,sortBy:r,multiple:o,partialUniqueValues:u,maxHeight:d,props:c}=this,{strings:h}=c,p=["small-integer","big-integer","integer","single","double","long"].includes(a),m=["date","date-only","time-only"].includes(a);(e=>{const t=n?.length;e.sort(((e,i)=>{if(!t&&p)return("string"==typeof e.value?Number.parseFloat(e.value):e.value)-("string"==typeof i.value?Number.parseFloat(i.value):i.value);{const s=t?this.getDecodedValue(e.value):e.value,a=t?this.getDecodedValue(i.value):i.value;return`${s}`.startsWith("_")?1:`${a}`.startsWith("_")?-1:`${s}`.localeCompare(`${a}`)}}))})(t),r&&"count"!==r?"selected"===r&&((e,t)=>{e.sort(((e,i)=>{const s=t?.indexOf(e.value)??-1,a=t?.indexOf(i.value)??-1;return s===a||s>-1&&a>-1?0:s>a?-1:1}))})(t,i):(e=>{e.sort(((e,t)=>e.count<=t.count?1:-1))})(t);const g=t.map((e=>this.renderUniqueValue(e)));let v;return u&&(v=(0,s.h)("div",{class:x},h.errors.tooManyUniqueValues)),(0,s.h)(s.H,null,(0,s.h)("div",{class:w},(0,s.h)("calcite-list",{label:h.values,class:U,filterEnabled:t.length>10,selectionMode:o?"multiple":"single","filter-placeholder":h.searchValues,onCalciteListChange:t=>{let i=t.target.selectedItems.map((e=>e.value));n||"date-only"!==a?n||"time-only"!==a?["date","oid","guid","small-integer","big-integer","integer","long"].includes(a)?i=i?.map((e=>Number.parseInt(e))):["single","double"].includes(a)&&(i=i?.map((e=>Number.parseFloat(e)))):i=i?.map((e=>(0,l.t)(e))):i=i?.map((e=>(0,l.O)(e))),this.isSameLists(i,this.selectedValues)||(this.selectedValues=i,this.arcgisFilterUniqueListChanged.emit({uid:e,multiple:o,selectedValues:i,sortBy:r}),this.arcgisChanged.emit({uid:e,multiple:o,selectedValues:i,sortBy:r}))},ref:e=>{this.listNode=e,d&&e?.setAttribute("style",`max-height: ${d||400}px`)}},t.length>10?this.renderSort(p,m):null,g),v,this.renderDone()))}renderSort(e,t){const{sortBy:i,props:a}=this,{strings:n}=a;return(0,s.h)("calcite-dropdown",{slot:"filter-actions-end",placement:"bottom-end",overlayPositioning:"fixed",widthScale:"s",onCalciteDropdownSelect:this.onSortMenuSelect},(0,s.h)("calcite-action",{slot:"trigger",label:n.sortValues,text:""},(0,s.h)("calcite-icon",{scale:"s",icon:"sortDescending"})),(0,s.h)("calcite-dropdown-group",null,(0,s.h)("calcite-dropdown-item",{selected:"count"===i||!(0,l.a)(i),"data-value":"count"},n.sortByCount),(0,s.h)("calcite-dropdown-item",{selected:"name"===i,"data-value":"name"},e||t?n.sortAscending:n.sortAlphabetical),(0,s.h)("calcite-dropdown-item",{selected:"selected"===i,"data-value":"selected"},n.sortSelected)))}renderUniqueValue(e){const{selectedValues:t,fieldDomains:i,layerFieldType:a,props:n}=this,{view:r,modules:o}=n,u=r?.timeZone||"system",d=i?.length?this.getDecodedValue(e.value):a===l.s.DATE?(0,l.I)(e.value,u,o.intl):a===l.s.DATE_ONLY?(0,l.J)(e.value,o.intl):a===l.s.TIME_ONLY?(0,l.K)(e.value,o.intl):"number"==typeof e.value?o.intl.formatNumber(e.value):e.value,c=!!t&&(a===l.s.DATE_ONLY?t.includes((0,l.O)(e.value)):a===l.s.TIME_ONLY?t.includes((0,l.t)(e.value)):t.includes(e.value));return(0,s.h)("calcite-list-item",{key:`list-item_${e.value}`,label:`${d}`,value:`${e.value}`,selected:c},(0,l.a)(e.count)?(0,s.h)("div",{class:M,slot:"actions-end"},`${e.count}`):null)}renderDone(){const{multiple:e,props:t}=this,{strings:i}=t;return e?(0,s.h)("div",{class:A},(0,s.h)("calcite-button",{appearance:"outline-fill",width:"full",onClick:this.done,label:i.done},i.done)):null}getDecodedValue(e){const{fieldDomains:t}=this,i=t;if(i){let t="";for(let s=0;s<i.length;s++){const a=i[s];a.code==e&&(t+=(t.length?" | ":"")+a.name)}return t.length||(t=`${e}`),t}return e}isSameLists(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;if(e?.length!==t?.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}get el(){return(0,s.g)(this)}};B.style=":host{width:100%}.container{min-height:30px}.popover-unique-list{width:100%;overflow-y:auto}.unique-values-content-list-msg{font-size:75%;margin:5px}.count{padding:0 6px;font-size:smaller;white-space:nowrap}.unique-values-done{padding:0.5rem}"},42444:(e,t,i)=>{function s(e,t){if(!e||!t)return;let i=t.assetsPath;i.endsWith("/")||(i+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${i}esri/themes/light/main.css" />`)}i.d(t,{i:()=>s})}}]);