/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-561aee.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-561aee"],{19061:(e,t,r)=>{r.r(t),r.d(t,{arcgis_layer_override:()=>g});var s=r(28614),i=r(68180),a=r(66916),o=r(97127),n=r(50063),l=r(71480);const c="container",p="details",u="buttons",h="top-button",d="properties",y="properties-icon",g=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.arcgisLayerOverrideChange=(0,s.c)(this,"arcgisLayerOverrideChange",7),this.arcgisDuplicateClick=(0,s.c)(this,"arcgisDuplicateClick",7),this.arcgisLayerOverrideDuplicateClick=(0,s.c)(this,"arcgisLayerOverrideDuplicateClick",7),this.arcgisSaveLayerClick=(0,s.c)(this,"arcgisSaveLayerClick",7),this.arcgisLayerOverrideSaveLayerClick=(0,s.c)(this,"arcgisLayerOverrideSaveLayerClick",7),this.arcgisSaveAsLayerClick=(0,s.c)(this,"arcgisSaveAsLayerClick",7),this.arcgisLayerOverrideSaveAsLayerClick=(0,s.c)(this,"arcgisLayerOverrideSaveAsLayerClick",7),this.manager=(0,o.u)(this),this.strings=(0,n.u)({blocking:!0}),this.afterCreateSource=e=>{this.sourceNode=e},this.afterCreateStatusButton=e=>{this.statusButtonNode=e},this.afterCreatePropertiesButton=e=>{this.propertiesNode=e},this.onPanelScroll=async()=>{if(this.statusPopover){const e=await(this.statusPopover?.getPopoverRect());(0,i.i)(e?.top)&&e.top<0&&this.closePopovers()}if(this.propertiesPopover){const e=await(this.propertiesPopover?.getPopoverRect());(0,i.i)(e?.top)&&e.top<0&&this.closePopovers()}},this.openDetails=e=>{e.stopPropagation(),e.preventDefault();const{layer:t}=this,{portalItem:r}=t;let s;s=r?.portal?r.portal.urlKey?`//${r.portal.urlKey}.${r.portal.customBaseUrl}/home/item.html?id=${r.id}&sublayer=${t.layerId}`:`//${r.portal.portalHostname}/home/item.html?id=${r.id}&sublayer=${t.layerId}`:`${t.url}/${t.layerId}`,window.open(s)},this.saveLayer=e=>{e.stopPropagation();const{layer:t}=this;this.arcgisLayerOverrideSaveLayerClick.emit(t.id),this.arcgisSaveLayerClick.emit(t.id)},this.saveAsLayer=e=>{e.stopPropagation();const{layer:t}=this;this.arcgisLayerOverrideSaveAsLayerClick.emit(t.id),this.arcgisSaveAsLayerClick.emit(t.id)},this.duplicateLayer=e=>{e.stopPropagation();const{layer:t}=this;this.arcgisLayerOverrideDuplicateClick.emit(t.id),this.arcgisDuplicateClick.emit(t.id)},this.openStatus=async e=>{if(e.stopPropagation(),this.containerPanelNode?.disabled||!this.sourceNode)return;if(this.statusPopover){if(this.statusPopover.parentNode)return this.statusPopover?.parentNode.removeChild(this.statusPopover),void(this.statusPopover=void 0);this.statusPopover=void 0}this.closePopovers(),await this.scrollIntoView(this.sourceNode);const{props:t,strings:r}=this,s=document.createElement("arcgis-layer-override-status");s.props=t,s.strings=r,s.popoverReferenceElement=this.sourceNode,document.body.appendChild(s),this.statusPopover=s,this.disableContainer(!0)},this.openManageProps=async()=>{if(!this.sourceNode)return;if(this.propertiesPopover){if(this.propertiesPopover.parentNode)return this.propertiesPopover.parentNode.removeChild(this.propertiesPopover),void(this.propertiesPopover=void 0);this.propertiesPopover=void 0}this.closePopovers(),await this.scrollIntoView(this.sourceNode);const{props:e,strings:t}=this,r=document.createElement("arcgis-layer-override-properties");r.props=e,r.strings=t,r.popoverReferenceElement=this.sourceNode,document.body.appendChild(r),this.propertiesPopover=r,this.disableContainer(!0)},this.layer=void 0,this.config=void 0,this.portal=void 0,this.hideDuplicate=!1,this.props=void 0,this.reRender=!1}closeAllPopoversHandler(){this.closePopovers()}arcgisPropChange(){this.arcgisChange.emit(),this.arcgisLayerOverrideChange.emit(),this.reRender=!this.reRender}arcgisStatusChange(){this.reRender=!this.reRender}async setFocus(){this.sourceActionNode?.setFocus()}async done(){this.closePopovers()}async refresh(){(0,a.g)(this.props),this.reRender=!this.reRender}async componentWillLoad(){this.props={layer:this.layer,portal:this.portal,config:this.config},this.props.layerOriginUtils=await(0,l.v)(),this.props.layerOriginUtils.isSupportedLayer(this.layer),(0,a.g)(this.props)}async componentDidLoad(){this.containerPanelNode=(0,i.q)(this.el,"calcite-panel"),this.containerPanelNode||(this.containerPanelNode=(0,i.q)(this.el,"calcite-flow-item")),this.containerPanelNode?.addEventListener("calcitePanelScroll",this.onPanelScroll)}disconnectedCallback(){this.containerPanelNode?.removeEventListener("calcitePanelScroll",this.onPanelScroll),this.closePopovers()}render(){return(0,s.h)(s.H,{key:"5a99298cbda4f424462a7fd507462c5acf740b2e"},(0,s.h)("div",{key:"ee2c2b2defd5d6923bc9578a0a54105f6555990b",class:c},this.renderSource(),this.renderCopy(),this.renderStatus(),this.renderProperties()))}renderSource(){const{strings:e,layer:t}=this,r=t.portalItem?.title,i=t.title,a="rtl"===(0,o.a)(this.el);return(0,s.h)("calcite-label",{ref:this.afterCreateSource},e.sourceLayer,(0,s.h)("calcite-block",{class:p,heading:(r&&r!==i?a?`${i} / ${r}`:`${r} / ${i}`:i)??void 0,description:t.isTable?"Table":"Feature layer",onClick:e=>this.openDetails(e)},(0,s.h)("calcite-action",{scale:"s",slot:"control",icon:"launch",text:e.sourceLayer,onClick:e=>this.openDetails(e),ref:e=>this.sourceActionNode=e})))}renderCopy(){const{strings:e,layer:t,hideDuplicate:r,props:i}=this,{portal:a}=i,o=this.canCreateItems(a?.user),n=["admin","update"].includes(t.portalItem?.itemControl??"");return n||o||!t.isTable&&!r?(0,s.h)("div",{class:u},n&&(0,s.h)("calcite-button",{width:"full",appearance:"outline-fill",kind:"neutral",iconStart:"save",class:h,label:e.save,onClick:this.saveLayer},e.save),o&&(0,s.h)("calcite-button",{width:"full",appearance:"outline-fill",kind:"neutral",iconStart:"save",class:h,label:e.saveAs,onClick:this.saveAsLayer},e.saveAs),!t.isTable&&!r&&(0,s.h)("calcite-button",{width:"full",appearance:"outline-fill",kind:"neutral",iconStart:"duplicate",label:e.duplicate,onClick:this.duplicateLayer},e.duplicate)):(0,s.h)(s.F,null)}renderStatus(){const{strings:e,layer:t,props:r}=this,{layerOriginInfo:i}=r;return(0,s.h)("calcite-notice",{class:d,width:"full",scale:"s",open:!0,onClick:this.openStatus},(0,s.h)("div",{slot:"title"},"source"===i.status?e.propsFromSource:"overridden"===i.status?e.propsSetInWebmap:e.somePropsSetInWebmap),(0,s.h)("calcite-button",{slot:"actions-end",iconStart:"information",scale:"s",appearance:"transparent",kind:"neutral",class:y,label:t.isTable?e.tableStatus:e.layerStatus,onClick:this.openStatus,ref:this.afterCreateStatusButton}))}renderProperties(){const{strings:e,layer:t}=this;return(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",label:t.isTable?e.manageTableProps:e.manageLayerProps,onClick:this.openManageProps,ref:this.afterCreatePropertiesButton},t.isTable?e.manageTableProps:e.manageLayerProps)}closePopovers(){this.closeStatusPopover(),this.closePropertiesPopover(),this.disableContainer(!1)}closeStatusPopover(){this.statusPopover&&(this.statusPopover.parentNode?.removeChild(this.statusPopover),this.statusPopover=void 0,setTimeout((()=>{this.statusButtonNode?.setFocus()}),300))}closePropertiesPopover(){this.propertiesPopover&&(this.propertiesPopover.parentNode?.removeChild(this.propertiesPopover),this.propertiesPopover=void 0,setTimeout((()=>{this.propertiesNode?.setFocus()}),300))}scrollIntoView(e){return e.getBoundingClientRect()?.top<0?(e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),new Promise((t=>{let r=0;const s=setInterval((()=>{(r>10||e.getBoundingClientRect()?.top>=0)&&(clearInterval(s),t()),r++}),100)}))):Promise.resolve()}disableContainer(e){this.containerPanelNode&&(this.containerPanelNode.disabled=e)}canCreateItems(e){return e&&(this.isPublicUser(e)||e.privileges?.includes("portal:user:createItem"))}isPublicUser(e){return!e.orgId}static get assetsDirs(){return["assets"]}get el(){return(0,s.g)(this)}};g.style=":host{height:100%}.container{padding:6px;background-color:white}.details{width:100%;margin-bottom:8px;border:1px solid var(--calcite-color-border-3);cursor:pointer}.buttons{margin-bottom:14px}.top-button{margin-bottom:4px}.properties{margin-bottom:16px;cursor:pointer}.properties-icon{height:100%;padding:0 var(--calcite-notice-spacing-token-large)}"},68180:(e,t,r)=>{r.d(t,{a:()=>s,b:()=>f,c:()=>P,d:()=>h,e:()=>u,f:()=>o,g:()=>p,h:()=>C,i:()=>l,j:()=>c,k:()=>y,l:()=>i,m:()=>d,n:()=>m,o:()=>v,p:()=>k,q:()=>w,s:()=>a,t:()=>g});var s,i,a,o,n=r(71480);function l(e){return null!=e}function c(e,t){const r=e.fieldName;if(r.includes(s.expression)){const e=t.get(r);return e?.title?e.title:r}return e.label?e.label:r}async function p(e){return new Map((await async function(e){return await new Promise(((t,r)=>{switch(h(e)){case a.feature:case a.ogcFeature:case a.stream:t(e.fields);break;case a.mapImage:{const s=e,i=s?.layer;i?.portalItem&&i.url.includes("https://demographics")&&i.url.includes(".arcgis.com")?i.portalItem?.fetchData().then((e=>{if(e?.thematicGroup){const r=new Map(s.fields.map((e=>[e.name,e]))),i=e.thematicGroup.fieldNames,a=[];i.forEach((e=>{r.has(e)&&a.push(r.get(e))})),t(a)}else t(s.fields)})).catch((e=>{r(new Error(e))})):t(s.fields);break}case a.imagery:{const r=e;t((r.fields||[]).concat(r.rasterFields||[]));break}case a.imageryTile:case a.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}}))}(e)).filter((e=>e.visible)).map((e=>[e.name,e])))}function u(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach((e=>{const r=`${s.expression}${e.name}`;t.set(r,e)})),t}function h(e){return"map-image"===e?.layer?.type?a.mapImage:"subtype-sublayer"===e?.type?a.subtype:"tile"===e?.layer?.type?a.tile:"scene"===e?.type?a.scene:"ogc-feature"===e?.type?a.ogcFeature:"imagery"===e?.type?a.imagery:"imagery-tile"===e?.type?a.imageryTile:"wfs"===e?.type?a.wfs:"wcs"===e?.type?a.wcs:"wms"===e?.layer?.type?a.wms:"csv"===e?.type?a.csv:"geojson"===e?.type?a.geojson:"stream"===e?.type?a.stream:"oriented-imagery"===e?.type?a.orientedImagery:"catalog"===e?.type?a.catalog:"catalog-footprint"===e?.type?a.catalogFootprint:"knowledge-graph-sublayer"===e?.type?a.knowledgeGraphSublayer:"voxel"===e?.type?a.voxel:a.feature}function d(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function y(e){return Number((100*(1-e)).toFixed(1))}function g(e){return Number((1-e/100).toFixed(3))}!function(e){e.expression="expression/",e.raster="Raster.",e.relationship="relationships/"}(s||(s={})),function(e){e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes"}(i||(i={})),function(e){e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms"}(a||(a={})),function(e){e.bigInteger="big-integer",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset"}(o||(o={}));const m=(e,t)=>{const r=[];return e?.fieldInfos?.forEach((e=>{e.fieldName?.includes(s.expression)?t&&r.push({name:e.fieldName.slice(s.expression.length),alias:e.fieldName.slice(s.expression.length),type:"string"}):r.push({name:e.fieldName,alias:e.label,type:"string"})})),r},f=async(e,t)=>{const[r,s]=await Promise.all([(0,n.g)(),(0,n.h)()]),i=new s;i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id];const a=(await r.identify(e.layer.url,i))?.results,o=a?.[0]?.feature;return o},v=async(e,t,r)=>{const s=await e.whenLayerView(t),i=await s.queryAggregates();return await b(r,i.features?.[0])},b=async(e,t)=>{const r=await(0,n.j)(),s=await(0,n.k)();let i;if(t)i=t.clone();else{i=new r;const t=m(e,!1);if(t?.length){const e={};t.forEach((t=>{e[t.name]=""})),i.attributes=e}const a=new s;i.geometry=a}return i};function w(e,t){const r=t.startsWith("#"),s=t.startsWith(".");for((s||r)&&(t=t.slice(1));e;){if(r){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function P(e){if(h(e)===a.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(h(e)===a.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find((t=>{if(t.id===e.id)return t}))?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function C(e,t,r){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const r=t.get(e);s=r.type?r.type.toLowerCase():""}else if(r.has(e)){const t=r.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function k(e,t){return"feature"!==e.type||e.url?"feature"===e.type||"csv"===e.type||"scene"===e.type||"wfs"===e.type||"geojson"===e.type||"oriented-imagery"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"catalog"===e.type||"catalog-footprint"===e.type?await e.queryFeatureCount():!t||"stream"!==e.type&&"ogc-feature"!==e.type?await Promise.reject(new Error(`Can't get feature count for layer of type ${e.type}.`)):await async function(e,t){const r=await t.whenLayerView(e);return await r.queryFeatureCount()}(e,t):await async function(e){const t=e.createQuery();t.outFields=["*"];const r=await e.queryFeatures(t);if(r.features?.length)return r.features.length;throw new Error("could not get feature count")}(e)}},66916:(e,t,r)=>{function s(e){const{layer:t,layerOriginUtils:r}=e;e.layerOriginInfo=r.getLayerOriginInfo(t,"web-map")}r.d(t,{g:()=>s})},50063:(e,t,r)=>{r.d(t,{u:()=>a});var s=r(97127),i=r(28614);const a=(0,s.m)(i.a)}}]);