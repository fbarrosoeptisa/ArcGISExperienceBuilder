/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f2d6be.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f2d6be"],{46456:(e,t,r)=>{r.r(t),r.d(t,{arcgis_categorize_items:()=>d});var i=r(19564),a=r(93863),o=r(5011),n=r(29259),s=r(26408),l=r(66507),c=r(80619);r(57159),r(4948),r(18991),r(98034),r(99004),r(44508),r(65174),r(80015),r(24211),r(67336),r(82297),r(5076),r(91102),r(73807),r(89261);const d=class{constructor(e){(0,i.r)(this,e),this.arcgisCategorizeItemsCancel=(0,i.c)(this,"arcgisCategorizeItemsCancel",7),this.arcgisCategorizeItemsSubmit=(0,i.c)(this,"arcgisCategorizeItemsSubmit",7),this.closeDialog=()=>{this.arcgisCategorizeItemsCancel.emit()},this.handleCategorySelected=({paths:e,selected:t})=>{const{itemIds:r,itemToCategoriesLookup:i}=this,a=Object.assign({},this.categorySelectionCountMap);if(e.forEach((e=>{a[e]=t?[...r]:[]})),r.forEach((r=>{i[r]||(i[r]=[]);const a=i[r];i[r]=t?[...a,...e]:a.filter((t=>!e.includes(t)))})),t){const t=e.reduce(((e,t)=>{let r="";return t.split("/").filter(Boolean).forEach((i=>{r=`${r}/${i}`,r!==t&&e.push(r)})),e}),[]);t.forEach((e=>{a[e]=[]})),r.forEach((e=>{const r=i[e];i[e]=r.filter((e=>!t.includes(e)))}))}this.categorySelectionCountMap=a},this.handleItemCategoryChange=(e,t)=>{var r;const{itemToCategoriesLookup:i,categorySelectionCountMap:a,rootCategoryPath:o}=this,n=null!==(r=i[e])&&void 0!==r?r:[],l=t.map((e=>e.startsWith(o)?e:`${o}${e}`));(0,s.g)(n,l)||(n.forEach((t=>{const r=a[t];a[t]=(null!=r?r:[]).filter((t=>t!==e))})),l.forEach((t=>{const r=a[t];a[t]=[...null!=r?r:[],e]})),i[e]=[...l],this.categorySelectionCountMap=Object.assign({},a))},this.updateCategory=async()=>{const{itemIds:e,portal:t,itemToCategoriesLookup:r,i18n:i}=this;this.isLoading=!0;const{result:o,error:n}=await(0,a.u)({categories:r,itemIds:e,portal:t});if(this.isLoading=!1,o&&!n)return this.arcgisCategorizeItemsSubmit.emit(r),void(this.canSave=!1);this.error=i.errorMessage},this.renderItemCard=e=>{const{i18n:t,portal:r,user:a,config:o,itemToCategoriesLookup:n,handleItemCategoryChange:s,categorySchema:l,rootCategoryPath:c}=this,d=n[e.id];return(0,i.h)("arcgis-item-browser-card",{key:e.id,item:e,portal:r,user:a,baseUrl:o.baseUrl,showItemType:!0},d&&d.length>=20&&(0,i.h)("div",{slot:"content-top",class:"status-banner"},(0,i.h)("calcite-icon",{icon:"exclamationMarkTriangle",scale:"s"}),(0,i.h)("span",null,t.limited)),(0,i.h)("div",{slot:"content-end",class:"category-picker-container"},(0,i.h)("arcgis-categories-picker",{portal:r,categories:d,schema:l,rootCategoryPath:c,onArcgisCategoriesPickerChange:({detail:t})=>s(e.id,t),hideLabel:!0})))},this.isActive=void 0,this.items=void 0,this.user=void 0,this.portal=void 0,this.config=void 0,this.group=void 0,this.categorySchema=void 0,this.isLoading=!1,this.categorySelectionCountMap=void 0,this.itemToCategoriesLookup={},this.error=void 0,this.canSave=!1,this.rootCategoryPath=void 0}async componentWillLoad(){const e=await(0,l.g)(this.el);this.i18n=e[0]}async componentDidLoad(){const{portal:e,user:t,group:r}=this;this.isLoading=!0;const i=this.items.map((e=>e.id)),{result:s,error:l}=await(0,o.c)(i,this.portal);this.items=s&&!l?s:this.items,this.updateInternalData(this.items);const{result:c,error:d}=await(0,a.g)({portal:e,user:t,group:r});!d&&c&&(this.categorySchema=c[0].categories,this.rootCategoryPath=(0,n.g)(c)),this.isLoading=!1}async updateInternalData(e){const t=this.group,r=!!t;this.itemIds=e.map((e=>e.id)),this.isLoading=!0;const{result:i,error:a}=await(0,o.c)(this.itemIds,this.portal,t);this.isLoading=!1;const n=i&&!a?i:e;this.itemToCategoriesLookup=n.reduce(((e,t)=>{let i=r?t.groupCategories:t.categories;return(null==i?void 0:i.length)||(i=t.categories),e[t.id]=i,e}),{}),this.categorySelectionCountMap=((e,t)=>{const r={};return e.forEach((({groupCategories:e,categories:i,id:a})=>{let o=t?e:i;(null==o?void 0:o.length)||(o=i),o.forEach((e=>{r[e]||(r[e]=[]),r[e].push(a)}))})),r})(n,r),this.initialItemToCategoriesLookup=structuredClone(this.itemToCategoriesLookup)}handleIsActiveChange(){this.isActive&&this.updateInternalData(this.items)}handleCountMapChange(){const{itemIds:e,itemToCategoriesLookup:t,initialItemToCategoriesLookup:r}=this,i=!!t&&!!r&&e.some((e=>!(0,s.g)(t[e],r[e]))),a=Object.values(t).some((e=>e.length>20));this.canSave=i&&!a}render(){const{items:e,categorySchema:t,categorySelectionCountMap:r,updateCategory:a,isLoading:o,i18n:n,closeDialog:s,isActive:l,renderItemCard:d,handleCategorySelected:u,error:h,canSave:g,rootCategoryPath:m}=this,p=e.length;return(0,i.h)("calcite-dialog",{key:"a45cadc0c446c07fab22d3a2e96de8a4fa8fcace",open:l,onCalciteDialogClose:s,modal:!0,scale:"l",class:"dialog",outsideCloseDisabled:!0,heading:n.modalTitle},o&&(0,i.h)("calcite-scrim",{key:"0a8f19e33a1cf7ad98117ec06f659142786d7810",loading:!0},n.loadingText),(0,i.h)("div",{key:"fc84334569a16b760f81e8eb8fd74e6c96f17bfb",class:"stage"},(0,i.h)("calcite-alert",{key:"50ee3304b3555b3ab4d903cf427481fe9ae3c7c9",icon:!0,open:!!h,label:h,kind:"danger",onCalciteAlertClose:()=>this.error=null},(0,i.h)("div",{key:"0a228d546713c25060706710d2c22ab5c765d908",slot:"message"},h)),(0,i.h)("arcgis-item-browser",{key:"dd28e14b041eb54758ef35d882b8c4f258095102",fetch:async()=>({nextStart:0,num:p,results:e,start:1,total:p}),portal:this.portal,user:this.user,config:this.config,hideContentTop:!0,contentPaddedBottom:!0,hidePreviewFooters:!0,view:"list",selection:"none",num:c.a},(0,i.h)("arcgis-category-tree",{key:"44b342035030cfbcadfcb77114a1740ac4f98ceb",slot:"filters",rootCategoryPath:m,categorySchema:t,categorySelectionCountMap:null!=r?r:{},total:p,onArcgisCategorizeCategorySelected:({detail:e})=>u(e)}),(0,i.h)("arcgis-item-browser-content",{key:"739b1a736119a777f5bde82e45e707b9ae6888ac",slot:"content"},e.map((e=>d(e)))))),(0,i.h)("calcite-button",{key:"632bf01489f014e2b4b312fd8cb96b88a5640e94",slot:"footer-end",appearance:"outline","data-id":"cancelButton",onClick:s},n.cancel),(0,i.h)("calcite-button",{key:"d3fb10f23877f432c09dc0c6e0d535a2e68932b3",slot:"footer-end",appearance:"solid","data-id":"nextButton",onClick:a,disabled:!g},n.save))}get el(){return(0,i.d)(this)}static get watchers(){return{items:["updateInternalData"],isActive:["handleIsActiveChange"],categorySelectionCountMap:["handleCountMapChange"]}}};d.style=".stage{height:100%;overflow:hidden;--tw-translate-x:0px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));background-color:var(--calcite-color-background)}@media screen and (min-width: 1080px){.stage{height:min(700px, 60vh)}}.dialog{--calcite-dialog-content-space:0;--calcite-dialog-size-x:1080px;z-index:900}.category-picker-container{margin-top:0.5rem}.status-banner{display:flex;align-items:center;padding-left:1rem;padding-right:1rem;padding-top:0.25rem;padding-bottom:0.25rem;font-size:0.75rem;border-bottom:1px solid var(--calcite-color-border-2)}.status-banner>calcite-icon{margin-inline-end:0.5rem;color:var(--calcite-color-status-danger)}.status-banner>span{margin-top:2px}"},77265:(e,t,r)=>{r.d(t,{a:()=>o,b:()=>a,i:()=>n});const i=["appExtensionError","forbiddenCredential","disabledSubscription","unauthorized","timeout","itemExists","exceedsFileSize","fileExists","emptyFile","unavailableGeocoder","dataNotAvailable","invalidShapefile","invalidFileGeodatabase","providePath","useSameFileName","invalidExtension","tokenRequired","invalidToken","invalid3DObjectFeatureClass","invalidClassification","serviceNameInvalid","titleInvalid","titleStartsWithNumber","titleRequired","titleInUseService","itemInRecycleBin","summaryInvalid","descriptionInvalid","missingUserOrPortal","dataStoreTitleInvalid","serviceNameExists","folderNameExists","serviceNotExist","unsupportedWFSVersion","invalidWMTS","invalidSpatialRef","emptyFeatureLayer","invalidFeatureLayerUrl","invalidUrl","httpWarning","flowAborted","duplicateFieldNames","failToFetchText","mapServiceError","noTilingSchemeFound","noMatchSpatialRef","invalidDataStorePublishType","noRegisteredServersForDataStore","noContentInDataStore","failToPublishFromDataStore","failToListDataStoreContents","invalidUsernameOrPassword","invalidConnection","invalidCredentials","invalidBigQueryProjectId","invalidSnowflakeServer","invalidSnowflakeRole","invalidSnowflakeWarehouse","invalidSnowflakeSchema","invalidSnowflakeDatabase","invalidAWSBucket","invalidAzureContainer","invalidJSON","unknownAGSType","unhandledError","incompatibleGeometries","multiPatchRestriction","invalidUniqueIdentifier","cannotAddNullData","exceededMaxFieldLength","invalidFieldType","failToCreate3DLayer"],a=e=>i.includes(null==e?void 0:e.code),o=e=>e&&e.hasOwnProperty("code")&&e.hasOwnProperty("message")&&e.hasOwnProperty("details")&&(!e.details||Array.isArray(e.details)),n=e=>{const t=e.toLocaleLowerCase();return t.includes("unexpected end of")||t.includes("did not match the expected pattern")}},5011:(e,t,r)=>{r.d(t,{a:()=>f,b:()=>u,c:()=>h,f:()=>d,g:()=>g,l:()=>w});var i=r(57159),a=r(77265),o=r(67336),n=r(98034),s=r(44508),l=r(82297),c=r(5076);const d=async(e,t)=>{const{owningSystemUrl:r}=await(0,i.f)((async()=>(0,l.g)(e)),"portalInfo",e.id);return(await Promise.all(t.map((async e=>{try{const{owningSystemUrl:t}=await(0,l.a)(e);return{owningSystemUrl:t,url:e}}catch(t){return console.error(t),{owningSystemUrl:null,url:e}}})))).filter((({owningSystemUrl:e})=>e===r)).map((({url:e})=>e))};async function u(e,t,r){var a;const{relationshipType:o,direction:n}=r,l=`${(0,s.g)(t)}content/items/${e}/relatedItems`,c=await(0,i.r)(l,{relationshipType:o,direction:n,includeRecycleBin:!0});return(null===(a=null==c?void 0:c.relatedItems)||void 0===a?void 0:a.length)&&(c.relatedItems=c.relatedItems.filter((t=>(null==t?void 0:t.id)!==e))),c}const h=async(e,t,r)=>{const a=!!r,o=(0,s.g)(t),n=a?`${o}/content/groups/${r.id}/search`:`${o}/search`;try{return{result:(await(0,i.r)(n,{filter:`id:(${e.join(" OR ")})`,num:100})).results}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},g=async(e,t)=>{try{const r=[],a=[],o=[];await Promise.all(e.map((async e=>{const{result:n,error:s}=await(0,i.f)((()=>(async(e,t)=>{var r;try{return{result:await(0,c.r)(e,t,{addTokenManually:!1})}}catch(e){const t="token required";return(null===(r=null==e?void 0:e.message)||void 0===r?void 0:r.toLowerCase().includes(t))?{error:{code:"tokenRequired"}}:(console.error(e),{error:{code:"unhandledError"}})}})(e,t)),"itemMetadata",`${e}--no-token`);if("tokenRequired"!==(null==s?void 0:s.code))if(m(n))r.push(p(n,e));else try{const t=await(0,l.a)(e);o.push(Object.assign(Object.assign({},n),{owningSystemUrl:t.owningSystemUrl}))}catch(s){console.warn(s)}else a.push(e)})));const n=await d(t,a),s=(await Promise.all(n.map((async e=>({response:await(0,c.r)(e,t,{addTokenManually:!0}),owningSystemUrl:(await(0,l.a)(e)).owningSystemUrl,url:e}))))).reduce(((e,{response:t,url:i,owningSystemUrl:a})=>m(t)?(r.push(p(t,i)),e):[...e,Object.assign(Object.assign({},t),{owningSystemUrl:a})]),[]),u=await Promise.all([...o,...s].map((async({serviceItemId:e,owningSystemUrl:t})=>{if(!e)return null;const{result:r}=await y({itemId:e,owningSystemUrl:t});return{item:r,owningSystemUrl:t}}))),{result:h}=r.length<=0?{result:[]}:await g(r,t);return{result:[...u.filter((e=>!!e)),...h]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},m=e=>!!(null==e?void 0:e.sources),p=(e,t)=>{var r;const i=null===(r=Object.values(e.sources)[0])||void 0===r?void 0:r.url;return i?i.includes("..")?(0,s.t)({url:t,path:i}):i:null},v=e=>`${e}/sharing/rest`,y=async({itemId:e,owningSystemUrl:t,requestOptions:r})=>{try{const a=(0,o.g)(e,v(t));return{result:await(0,i.r)(a,{},Object.assign(Object.assign({},r),{addTokenManually:!1}))}}catch(e){return console.error(e),(0,a.a)(e)&&e.message.toLocaleLowerCase().includes("invalid token")?{error:{code:"invalidToken"}}:{error:{code:"unhandledError"}}}},f=async({itemId:e,owningSystemUrl:t,requestOptions:r})=>{try{const a=`${(0,o.g)(e,v(t))}/data`;return{result:await(0,i.r)(a,{},Object.assign(Object.assign({},r),{addTokenManually:!1}))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},w=async(e,t)=>{try{const[r]=await(0,n.l)(["esri/portal/PortalItem"]),i=new r({id:e,portal:t});return await i.load(),{result:i}}catch(e){return console.error("Fail to reload item",e),{error:{code:"unhandledError"}}}}},67336:(e,t,r)=>{r.d(t,{a:()=>s,b:()=>n,c:()=>d,d:()=>u,e:()=>h,f:()=>p,g:()=>k,h:()=>v,i:()=>l,j:()=>w,k:()=>b,l:()=>y,m:()=>C,n:()=>S,o:()=>m,p:()=>f,q:()=>g,u:()=>c});var i=r(98034),a=r(44508);function o(e){var t;return!!(null===(t=e.owner)||void 0===t?void 0:t.toLowerCase().includes("esri"))}function n(e){var t;return o(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Credits"))}function s(e){var t;return o(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Subscription"))}function l(e,t){return e.owner===t.username}function c(e,t){return l(e,t)||function(e,t){var r;if(null!=e.isAdmin)return!!e.isAdmin;const i=e.owner,a="admin"===e.itemControl,o=["esri_livingatlas","esri_demographics","esri_boundaries"];if((null===(r=e.portal)||void 0===r?void 0:r.isPortal)&&!l(e,t)&&a&&i.includes("esri_")&&!o.includes(i))return!1;return a}(e,t)}const d=(e,t)=>!!t.orgId&&e.every((e=>e.isOrgItem)),u=(e,t)=>`${(0,a.a)(t)}item.html?id=${e}`,h=(e,t)=>`${(0,a.g)(t)}/content/users/${e}`,g=e=>e.reduce(((e,t)=>(e[t.owner]=e[t.owner]?[...e[t.owner],t.id]:[t.id],e)),{});function m(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Spatiotemporal")}function p(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("View Service")}function v(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Hosted Service")}function y(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Multi Services View")}function f(e){return(null==e?void 0:e.hasViews)&&!e.sourceSchemaChangesAllowed}async function w(e){var t;const r=null==e?void 0:e.portalItem;if(!r)return Promise.resolve(null);const o=r.portal,[n]=await(0,i.l)(["esri/request"]);if(null==o?void 0:o.user){return n(`${(0,a.g)(o)}community/users/${o.user.username}`,{query:{f:"json",token:null===(t=r.portal.credential)||void 0===t?void 0:t.token},responseType:"json"}).then((e=>{var t,r;const i=null!==(r=null===(t=e.data)||void 0===t?void 0:t.groups)&&void 0!==r?r:[];return Promise.resolve(i)}),(()=>Promise.reject()))}return Promise.resolve(null)}async function b(e){var t;const r=null==e?void 0:e.portalItem;if(!r)return Promise.resolve(null);const o=r.portal,[n]=await(0,i.l)(["esri/request"]);return n(`${(0,a.g)(o)}content/items/${r.id}/groups`,{query:{f:"json",token:null===(t=r.portal.credential)||void 0===t?void 0:t.token},responseType:"json"}).then((e=>{var t,r,i,a,o,n;const s=[...null!==(r=null===(t=e.data)||void 0===t?void 0:t.admin)&&void 0!==r?r:[],...null!==(a=null===(i=e.data)||void 0===i?void 0:i.member)&&void 0!==a?a:[],...null!==(n=null===(o=e.data)||void 0===o?void 0:o.other)&&void 0!==n?n:[]];return Promise.resolve(s)}),(()=>Promise.reject()))}async function S(e,t,{relationshipType:r,direction:o}){const n=`${(0,a.g)(t)}content/items/${e}/relatedItems`,[s]=await(0,i.l)(["esri/request"]);return await s(n,{query:{f:"json",relationshipType:r,direction:o},method:"get",responseType:"json"})}function C(e,t){return null==e?void 0:e.some((e=>null==t?void 0:t.some((t=>e.id===t.id&&e.capabilities.includes("updateitemcontrol")))))}const k=(e,t)=>`${(0,a.a)(t)}content/items/${e}`},82297:(e,t,r)=>{r.d(t,{a:()=>h,b:()=>d,c:()=>s,d:()=>l,e:()=>g,f:()=>o,g:()=>u,h:()=>n,i:()=>m,q:()=>c});var i=r(57159),a=r(44508);function o(e){var t;return"ArcGISEnterpriseOnKubernetes"===(e.portalDeploymentType||(null===(t=e.sourceJSON)||void 0===t?void 0:t.portalDeploymentType))}function n(e){var t,r;return e.isPortal?"modern"===(null===(r=e.portalProperties)||void 0===r?void 0:r.homePage)||function(e){var t;return e.isPortal&&"modernOnly"===(null===(t=e.portalProperties)||void 0===t?void 0:t.homePage)}(e):"modern"===(null===(t=e.portalProperties)||void 0===t?void 0:t.homePage)||function(e){const t=new Date("June 30, 2020").getTime();return!e.isPortal&&e.created>=t}(e)}async function s(e){try{return{result:await(0,i.f)((()=>(0,i.r)(`${(0,a.g)(e)}portals/self/resources/home.page.json`)),"homePageConfig",e.id)}}catch(e){return{result:void 0}}}async function l(e){return(0,i.f)((()=>(0,i.r)(`${(0,a.g)(e)}portals/self/userDefaultSettings`)),"memberDefaults",e.id)}async function c(e={},t){return(0,i.r)(`${(0,a.g)(t)}/community/groups`,e)}const d=async(e,t)=>{var r;if(!e)return[];const o=`${(0,a.a)(null!==(r=t.restUrl)&&void 0!==r?r:t.portalUrl)}portals/self/servers`,n=await(0,i.f)((()=>(0,i.r)(o)),"selfServers",t.id);return null==n?void 0:n.servers},u=e=>h((0,a.c)(e)),h=e=>{var t;const r=`${(0,a.a)(null!==(t=(0,a.b)(e))&&void 0!==t?t:e)}info`;return(0,i.f)((()=>(0,i.r)(r,{},{addTokenManually:!1})),"portalInfo",r)};async function g(e,t){return!e.isPortal||await m(e,t)}async function m(e,t){if(!t||!e)return!1;if(!e.isPortal)return!0;const{result:r,error:a}=await(0,i.f)((()=>p(e,t)),"isPortalBackedBySDS",e.id);return!a&&r}const p=async(e,t)=>{if(e.isBackedBySDS)return{result:!0};if(!e.isPortal)return{result:!0};try{return{result:!!await v(t,e)}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)},result:!1}}},v=async(e,t)=>{var r;return(null!==(r=await d(e,t))&&void 0!==r?r:[]).filter((e=>e.isHosted))[0]}},5076:(e,t,r)=>{r.d(t,{r:()=>o});var i=r(57159),a=r(4948);const o=async(e,t,r={})=>{const{body:o,usePost:n,addTokenManually:s,api:l=(null===a.c||void 0===a.c?void 0:a.c.api),customToken:c}=r,d=new URLSearchParams;o&&Object.entries(o).forEach((([e,t])=>{void 0!==t&&d.append(e,t)}));const u=new URL(e);if(u.searchParams.append("f","json"),c)u.searchParams.append("token",c);else{const e=!1===s?null:await(0,i.g)(t,l);e&&u.searchParams.append("token",e)}const h=await fetch(u.toString(),{body:n?d:void 0,method:n?"POST":"GET"}),g=await h.json(),m=g.error;if(m)throw"string"==typeof m?new Error(m):m;return g}},80619:(e,t,r)=>{r.d(t,{I:()=>i,a:()=>a});const i=["folder","group","contentType"],a=99999}}]);