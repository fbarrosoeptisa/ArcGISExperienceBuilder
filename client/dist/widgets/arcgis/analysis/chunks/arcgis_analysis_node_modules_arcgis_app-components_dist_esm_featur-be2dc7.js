/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_featur-be2dc7.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_featur-be2dc7"],{76246:(e,t,r)=>{r.d(t,{a:()=>i,i:()=>a});const i={FeatureServer:"Feature Service",GeocodeServer:"Geocoding Service",GeoDataServer:"Geodata Service",GeometryServer:"Geometry Service",GeoenrichmentServer:"Geoenrichment Service",GPServer:"Geoprocessing Service",GlobeServer:"Globe Service",ImageServer:"Image Service",MapServer:"Map Service",NAServer:"Network Analysis Service",ElevationServer:"Image Service",VectorTileServer:"Vector Tile Service",SceneServer:"Scene Service",StreamServer:"Stream Service",WMServer:"Workflow Manager Service",TiledImageServer:"Image Service",VideoServer:"Video Service",KnowledgeGraphServer:"Knowledge Graph Layer"},a=e=>!!Object.values(i).includes(e)},77265:(e,t,r)=>{r.d(t,{a:()=>s,b:()=>a,i:()=>n});const i=["appExtensionError","forbiddenCredential","disabledSubscription","unauthorized","timeout","itemExists","exceedsFileSize","fileExists","emptyFile","unavailableGeocoder","dataNotAvailable","invalidShapefile","invalidFileGeodatabase","providePath","useSameFileName","invalidExtension","tokenRequired","invalidToken","invalid3DObjectFeatureClass","invalidClassification","serviceNameInvalid","titleInvalid","titleStartsWithNumber","titleRequired","titleInUseService","itemInRecycleBin","summaryInvalid","descriptionInvalid","missingUserOrPortal","dataStoreTitleInvalid","serviceNameExists","folderNameExists","serviceNotExist","unsupportedWFSVersion","invalidWMTS","invalidSpatialRef","emptyFeatureLayer","invalidFeatureLayerUrl","invalidUrl","httpWarning","flowAborted","duplicateFieldNames","failToFetchText","mapServiceError","noTilingSchemeFound","noMatchSpatialRef","invalidDataStorePublishType","noRegisteredServersForDataStore","noContentInDataStore","failToPublishFromDataStore","failToListDataStoreContents","invalidUsernameOrPassword","invalidConnection","invalidCredentials","invalidBigQueryProjectId","invalidSnowflakeServer","invalidSnowflakeRole","invalidSnowflakeWarehouse","invalidSnowflakeSchema","invalidSnowflakeDatabase","invalidAWSBucket","invalidAzureContainer","invalidJSON","unknownAGSType","unhandledError","incompatibleGeometries","multiPatchRestriction","invalidUniqueIdentifier","cannotAddNullData","exceededMaxFieldLength","invalidFieldType","failToCreate3DLayer"],a=e=>i.includes(null==e?void 0:e.code),s=e=>e&&e.hasOwnProperty("code")&&e.hasOwnProperty("message")&&e.hasOwnProperty("details")&&(!e.details||Array.isArray(e.details)),n=e=>{const t=e.toLocaleLowerCase();return t.includes("unexpected end of")||t.includes("did not match the expected pattern")}},18409:(e,t,r)=>{r.d(t,{A:()=>ut,B:()=>Ee,C:()=>Ue,D:()=>F,E:()=>dt,F:()=>ze,M:()=>C,a:()=>Ye,b:()=>U,c:()=>A,d:()=>ee,e:()=>$,f:()=>R,g:()=>Je,h:()=>ft,i:()=>tt,j:()=>Ae,k:()=>Ne,l:()=>Ge,m:()=>$e,n:()=>Ke,o:()=>_e,p:()=>q,q:()=>Fe,r:()=>P,s:()=>M,t:()=>Pe,u:()=>lt,v:()=>Be,w:()=>gt,x:()=>Ce,y:()=>pt,z:()=>ct});var i=r(4948),a=r(26408),s=r(44508),n=r(86868),o=r(61191),l=r(98821),c=r(5152),u=r(69058),d=r(62913),p=r(82297),y=r(57159),v=r(98034),m=r(76246),f=r(748),g=r(97018),w=r(77265),h=r(87382),b=r(46227),S=r(65174),x=r(56288),O=r(18991),I=r(17233),T=r(93863);function L(e){const{customParameters:t}=o.a,r=e.includes("?")?"&":"?",i=(null==t?void 0:t.map((({parameter:e,value:t})=>`${e||""}${e||t?"=":""}${t||""}`)).join("&"))||"";return i?`${e}${r}${i}`:e}function P(e,{value:t,parameter:r}){const i=`${r}=${t}`,a=e.replace("&"===e[e.indexOf(i)-1]?`&${i}`:i,"");return"?"===a[a.length-1]?a.replace("?",""):a}const k=async e=>{const t=M.subscribers[e];try{await(null==t?void 0:t.unsubscribe())}catch(e){console.error(`Fail to call unsubscribe for ${t.name}: ${e}`)}},j=(0,O.c)({subscribers:{},unsubscribeAll:async()=>{await Promise.all(Object.keys(M.subscribers).map(k)),j.reset()},addSubscriber:(e,t)=>{const r=`${e}---${(0,b.g)()}`;return M.subscribers[r]={name:e,unsubscribe:t},r},unsubscribe:k,removeSubscriber:async e=>{delete M.subscribers[e]},isSubscriberValid:e=>!!M.subscribers[e]}),M=j.state,C=78643200;function U(e){if(!e)return null;let t=!0,r={},i={};return e.forEach((({append:e,parameter:a,value:s})=>{"layer"===e?(t=!1,i[a]=s):r[a]=s})),t?{customParameters:r}:{customParameters:r,customLayerParameters:i}}async function $(e,t,r){if("Desktop Application"===e.type)return $e();const i=await(0,d.b)(e);return"Application"!==e.type&&"API Key"!==e.type||await F(e.developerCredentialsType,i.id,t,r),i}async function F(e,t,r,i){const a=`${r}oauth2/registerApp`;let s={itemId:t,appType:"multiple",redirect_uris:JSON.stringify(["urn:ietf:wg:oauth:2.0:oob"])};i&&(s="apiToken"===e?Object.assign(Object.assign({},s),{httpReferrers:JSON.stringify(i.httpReferrers),privileges:JSON.stringify(i.privileges),isPersonalAPIToken:i.isPersonalAPIToken}):"apikey"===i.appType?{itemId:t,appType:"apikey",redirect_uris:JSON.stringify(i.redirect_uris),httpReferrers:JSON.stringify(i.httpReferrers),privileges:JSON.stringify(i.privileges)}:{itemId:t,appType:i.appType,httpReferrers:JSON.stringify(i.httpReferrers),redirect_uris:JSON.stringify(i.redirect_uris),url:i.url,privileges:JSON.stringify(i.privileges),isPersonalAPIToken:i.isPersonalAPIToken});try{return{result:await(0,y.r)(a,s,{},"post")}}catch(e){return console.error("error:",e),{error:{code:"unhandledError"}}}}async function R(e){try{return{result:await(0,y.r)(e,{},{addTokenManually:!1}),error:null}}catch(e){return console.error("error:",e),{result:null,error:{code:"appExtensionError"}}}}const E="hiddenMapDiv",N=()=>{const e=document.getElementById(E);e&&e.parentNode.removeChild(e)},A=(e=200,t=130)=>{let r=document.getElementById(E);r||(r=document.createElement("div"),r.id=E,r.style.position="absolute",r.style.left="-1000px",r.style.top="-1000px",r.style.width=`${e}px`,r.style.height=`${t}px`,document.body.appendChild(r));const i=document.createElement("div"),a="hiddenMap";return i.id=a,i.style.width=`${e}px`,i.style.height=`${t}px`,r.appendChild(i),a};async function D(e,t){const[r,i,a,s]=await(0,v.l)(["esri/tasks/PrintTemplate","esri/tasks/PrintParameters","esri/tasks/PrintTask","esri/config"]),n=new r;n.layout="MAP_ONLY",n.format="png32",n.preserveScale=!1,n.showAttribution=!1,n.showLabels=!1,n.exportOptions={width:600,height:400,dpi:96};const o=new a(t.self.helperServices.printTask.url,{}),l=new i;return l.map=e,l.template=n,s.defaults.io.timeout=12e4,new Promise(((t,r)=>{o.execute(l,(r=>{s.defaults.io.timeout=6e4,function(e){var t;e.destroy(),null===(t=document.getElementById("hiddenMapDiv"))||void 0===t||t.removeChild(document.getElementById("hiddenMap"))}(e),t(r.url)}),(e=>{s.defaults.io.timeout=6e4,r(e)}))}))}async function W(e,t,r){var a;const s=i.c.api,[n]=await(0,v.l)([3===s?"esri/tasks/Geoprocessor":"esri/rest/geoprocessor"]),{portal:o}=i.c;(null!==(a=e.baseMap.baseMapLayers)&&void 0!==a?a:[]).forEach((e=>{delete e.resourceInfo})),e.mapOptions={showAttribution:!1,extent:{xmin:t[0][0],ymin:t[0][1],xmax:t[1][0],ymax:t[1][1],spatialReference:{wkid:4326}},spatialReference:r},e.exportOptions={dpi:96,outputSize:[600,400]},e.layoutOptions={};const l={Web_Map_as_JSON:JSON.stringify(e),Format:"PNG32",Layout_Template:"MAP_ONLY"};if(3===s){const e=new n(o.helperServices.printTask.url);return new Promise(((t,r)=>{e.execute(l).then((e=>{if(e){let i=!1;for(let r=0;r<e.length;r++)if("Output_File"===e[r].paramName){t(e[r].value.url),i=!0;break}i||r()}}))}))}const{results:c}=await n.execute(o.helperServices.printTask.url,l),u=c.find((e=>"data-file"===e.dataType&&e)).value.url;if(!u)throw new Error("Failed to create thumbnail");return u}async function J(e,t){return await async function(e,t){const{config:r}=i.c,n={item:{extent:t},itemData:e};try{const[e]=await(0,v.l)(["esri/arcgis/utils"]);e.arcgisUrl=`${(0,s.g)()}content/items`;const t=A(),o=await e.createMap(n,t,{mapOptions:{nav:!1},bingMapsKey:r.self.bingKey,geometryServiceURL:i.c.portal.helperServices.geometry.url}),l=function(e){return new Promise((t=>{e._heatmapManager?e._heatmapManager.on("recalculateHeatmap",t):t()}))},c=e=>{const t=[0];return new Promise((r=>{const i=setInterval(((e,t)=>{var a;(null===(a=e.graphics)||void 0===a?void 0:a.length)||t[0]>10?(clearInterval(i),r()):t[0]=t[0]+1}),500,e,t)}))},u=e=>new Promise((t=>{"esri.layers.VectorTileLayer"===e.declaredClass&&setTimeout(t,5e3),e.on("update-start",(()=>{d(e).then(t)}))})),d=function(e){return new Promise((t=>{if(!e.updating)return t();"esri.layers.VectorTileLayer"===e.declaredClass&&setTimeout(t,1e4),e.on("update-end",t)}))},{map:p}=o,y=[];return p.graphicsLayerIds.forEach((e=>{var t;const r=p.getLayer(e);"heatmap"===(null===(t=r.renderer)||void 0===t?void 0:t.type)?y.push(l(r)):"esri.layers.WFSLayer"===r.declaredClass?y.push(c(r)):r.updating&&y.push(d(r))})),p.layerIds.forEach((e=>{const t=o.map.getLayer(e);t.updating?y.push(d(t)):"esri.layers.VectorTileLayer"===t.declaredClass&&y.push(u(t))})),y.length?(await Promise.all(y),await(0,a.t)(1e3),await D(o.map,r)):await D(o.map,r)}catch(e){throw new Error(`Map creation failed: ${JSON.stringify(e)}`)}}(e,t)}async function G(e){var t;const[r]=await(0,v.l)([4===i.c.api?"esri/geometry/SpatialReference":"esri/SpatialReference"]),{config:a,portal:s}=i.c,n={};n.baseMap=a.defaultBasemap||s.defaultBasemap,n.baseMap.title="basemap",n.operationalLayers=[];let o=e.url;o||"KML"!==e.type||(o=a.restBaseUrl+"content/items/"+e.id+"/data");const l=new URL(a.restBaseUrl).hostname;if(o.indexOf(l)>-1){const e=null===(t=null==a?void 0:a.userInfo)||void 0===t?void 0:t.token;e&&(o+="?token="+e)}n.operationalLayers.push({url:o,id:"KML_"+Math.random(),opacity:1,title:e.title,visibility:!0,type:"KML"});let c=[];if("string"==typeof e.extent){const t=e.extent.split(",");c=[[parseFloat(t[0]),parseFloat(t[1])],[parseFloat(t[2]),parseFloat(t[3])]]}else c=e.extent&&e.extent.length>0?e.extent:[[-180,-90],[180,90]];return W(n,c,new r({wkid:4326}))}const _={xmax:2e7,xmin:-2e7,ymax:2e7,ymin:-2e7,spatialReference:{wkid:102100}};function K(e,t){const r={102113:[-20037508.342788905,20037508.342788905],102100:[-20037508.342788905,20037508.342788905],3785:[-20037508.342788905,20037508.342788905],3857:[-20037508.342788905,20037508.342788905],4326:[-180,180]}[e];if(r&&t.xmin>t.xmax){const e=r[1]-t.xmin,i=t.xmax-r[0];e>i?t.xmax=r[1]+i:t.xmin=r[0]-e}}function V(e,t){var r,i;const a="ImageServer"!==t?null==e?void 0:e.spatialReference:null===(r=null==e?void 0:e.extent)||void 0===r?void 0:r.spatialReference;return a?a.wkid?a.wkid:a.wkt&&-1!==(null===(i=a.wkt)||void 0===i?void 0:i.search(/^PROJCS/i))?/^PROJCS\["[A-Za-z0-9_]*/i.exec(a.wkt)[0].split("[")[1]:null:null}async function q(e){var t,r;const[s]=await(0,v.l)([4===i.c.api?"esri/geometry/SpatialReference":"esri/SpatialReference"]),n=(null===(t=null==e?void 0:e.spatialReference)||void 0===t?void 0:t.wkid)||(null===(r=null==e?void 0:e.spatialReference)||void 0===r?void 0:r.wkt),o=new s({wkid:4326}),l=await async function(e,t){const r=[102113,102100,3857];if((null==e?void 0:e.wkt)==(null==t?void 0:t.wkt)&&((null==e?void 0:e.wkid)==(null==t?void 0:t.wkid)||(0,a.e)(e.latestWkid)&&(null==e?void 0:e.latestWkid)==(null==t?void 0:t.wkid))||(0,a.e)(null==t?void 0:t.latestWkid)&&(null==e?void 0:e.wkid)==(null==t?void 0:t.latestWkid)||(0,a.e)(null==e?void 0:e.latestWkid)&&(null==e?void 0:e.latestWkid)==(null==t?void 0:t.latestWkid))return!0;if((null==e?void 0:e.wkid)&&(null==t?void 0:t.wkid)&&r.includes(null==e?void 0:e.wkid)&&r.includes(null==t?void 0:t.wkid))return!0;return!1}(o,null==e?void 0:e.spatialReference);return n&&!l?await z(e,o):e}async function B(e,t){const{portal:r}=i.c,[a,s]=await(0,v.l)(4===i.c.api?["esri/geometry/support/webMercatorUtils","esri/rest/geometryService"]:["esri/geometry/webMercatorUtils","esri/tasks/GeometryService"]),n=[102113,102100,3857],o=e.spatialReference.wkid;if(o===t.wkid)return[e];let l;return 4326===o&&n.indexOf(t.wkid)>-1?(e.ymin=Math.max(e.ymin,-89.99),e.ymax=Math.min(e.ymax,89.99),l=a.geographicToWebMercator(e),K(t.wkid,l),l.spatialReference.wkid=t.wkid,[l]):n.indexOf(o)>-1&&4326===t.wkid?(l=a.webMercatorToGeographic(e),K(t.wkid,l),[l]):new Promise((async(a,n)=>{const o=4===i.c.api?s:new s(r.helperServices.geometry.url),l=e=>{const t=null==e?void 0:e[0];if("extent"!==(null==t?void 0:t.type)||isNaN(e[0].xmin)||isNaN(e[0].ymin)||isNaN(e[0].xmax)||isNaN(e[0].ymax)){if("point"!==(null==t?void 0:t.type)||isNaN(e[0].x)||isNaN(e[0].y))throw new Error;a(e)}else a(e)};if(4===i.c.api)try{const[i]=await(0,v.l)(["esri/rest/support/ProjectParameters"]),a=new i({geometries:[e],outSpatialReference:t});l(await o.project(r.helperServices.geometry.url,a))}catch(e){throw new Error(e)}else o.project([e],t,l,(e=>{n(e)}))}))}async function z(e,t){var r;const[i]=await(0,v.l)(["esri/geometry/Extent"]),a=new i(_),s=e.clone?e.clone():new i(Object.assign({},e)),n=await B(s,t);return"extent"===(null===(r=null==n?void 0:n[0])||void 0===r?void 0:r.type)?n[0]:a}async function H(e,t){const{api:r}=i.c,[a]=await(0,v.l)([4===r?"esri/geometry/SpatialReference":"esri/SpatialReference"]),[s,n]=await(0,v.l)(["esri/layers/FeatureLayer","esri/layers/StreamLayer"]);if(!e||!(e instanceof s)||e instanceof n)return t;if(3===r){try{await e.addPlugin("esri/plugins/FeatureLayerStatistics");const r=await e.statisticsPlugin.getSuggestedScaleRange(),{minScale:i,center:s,relaxedMinScale:n}=r;if(s){let e=await Y(s,1280,i);if(r.relaxedMinScale>0){let t=Q(e,200),r=800;for(;t>n&&(e=Y(s,r,i),t=Q(e,200),r-=200,!(r<=0)););}const o=await B(e,new a({wkid:4326}));t=[[o[0].xmin,o[0].ymin],[o[0].xmax,o[0].ymax]]}}catch(e){console.warn(e)}return t}return t}async function Q(e,t){const[r,i]=await(0,v.l)(["esri/config","esri/WKIDUnitConversion"]),a=e.spatialReference,s=null==a?void 0:a.wkid,n=null==a?void 0:a.wkt;let o=null;if(s)o=i.values[i[s]];else if(-1!==(null==n?void 0:n.search(/^PROJCS/i))){const e=/UNIT\[([^\]]+)\]\]$/i.exec(n);(null==e?void 0:e[1])&&(o=parseFloat(e[1].split(",")[1]))}return e.getWidth()/t*(o||20015077/180)*39.37*r.defaults.screenDPI}async function Y(e,t,r){const[i]=await(0,v.l)(["esri/geometry/Extent"]);return async function(e,t,r){const[i,a]=await(0,v.l)(["esri/config","esri/WKIDUnitConversion"]),s=39.37,n=20015077/180,o=a;let l,c,u=e.spatialReference;u&&(l=u.wkid,c=u.wkt);let d=null;if(l)d=o.values[o[l]];else if(c&&-1!==c.search(/^PROJCS/i)){const e=/UNIT\[([^\]]+)\]\]$/i.exec(c);(null==e?void 0:e[1])&&(d=parseFloat(e[1].split(",")[1]))}const p=e.expand(r*t/((d||n)*s*i.defaults.screenDPI)/e.getWidth());return p}(new i(e.x-1,e.y-.5,e.x+1,e.y+.5,e.spatialReference),t,r)}function X(e,t=4){if(!e)return X(_);if("string"==typeof e)return e;if(Array.isArray(e)){if(Array.isArray(e[0])&&Array.isArray(e[1])){let t,r;return 2===e[0].length&&(t=e[0],r=e[1]),4!==e[0].length&&6!==e[0].length||(t=[e[0][0],e[0][1]],r=[e[0][2],e[0][3]],6===e[0].length&&(r=[e[0][3],e[0][4]])),`${t.join(",")},${r.join(",")}`}return e.join(",")}return`${e.xmin.toFixed(t)},${e.ymin.toFixed(t)},${e.xmax.toFixed(t)},${e.ymax.toFixed(t)}`}async function Z(e,t,r){const[i,a]=await(0,v.l)(["esri/config","esri/layers/KMLLayer"]);if(3===r?i.defaults.kmlService=t.kmlService:i.kmlServiceUrl=t.kmlService,4===r){const t=new a({url:e});await t.load();return X(t.fullExtent)}const s=new a(e);return new Promise(((e,t)=>{s.on("load",(async()=>{const t=await async function(e){const[t]=await(0,v.l)(["esri/graphicsUtils"]),r=e.getLayers();let i;return r.forEach((e=>{var r;if((null===(r=e.graphics)||void 0===r?void 0:r.length)>0){const r=t.graphicsExtent(e.graphics);i=i?i.union(r):r}})),i}(s);e(t?X(t):void 0)})),s.on("error",t)}))}const ee=async(e,t,r,i,a)=>{try{const s=t.isPortal?r:`https://${t.portalHostname}/sharing/rest`,n=t.portalHostname?`${s}/content/items/${e}/data`:`${(0,d.g)(e)}/data`,o=await Z(n,i,a);return{result:await(0,d.u)(e,{url:n,extent:o})}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};var te;async function re(e){if(4===i.c.api)return"imagery-tile"==e.type;const[t]=await(0,v.l)(["esri/layers/RasterXLayer"]);return e instanceof t}async function ie(e){if(4===i.c.api)return"imagery"===e.type;const[t,r]=await(0,v.l)(["esri/layers/ArcGISImageServiceLayer","esri/layers/ArcGISImageServiceVectorLayer"]);return e instanceof t||e instanceof r}!function(e){e.Single="single",e.Multi="multi",e.Children="children",e.MultiChildren="multi-children",e.Ancestors="ancestors"}(te||(te={}));const ae={type:"esriSMS",style:"esriSMSCircle",color:[34,114,162,128],size:6,outline:{color:[34,114,162,255],width:1}},se={type:"esriSLS",style:"esriSLSSolid",color:[77,77,77,255],width:1.5},ne={type:"esriSFS",style:"esriSFSSolid",color:[227,139,79,204],outline:{type:"esriSLS",style:"esriSLSSolid",color:[255,255,255,255],width:.75}};async function oe(e){const[t,r]=await(0,v.l)(["esri/renderers/SimpleRenderer",4===i.c.api?"esri/geometry/support/jsonUtils":"esri/symbols/jsonUtils"]);switch(e){case"esriGeometryPoint":return new t(r.fromJson(ae)).toJson();case"esriGeometryPolyline":return new t(r.fromJson(se)).toJson();case"esriGeometryPolygon":return new t(r.fromJson(ne)).toJson()}}async function le(e){const{fields:t,selectedLayer:r}=e;if(null==t?void 0:t.length){const i=t.filter((e=>"esriFieldTypeGeometry"!==e.type));if(null==i?void 0:i.length)return async function(e,t){var r,i;const a=e.displayField,s=e.name+((null==a?void 0:a.length)?`: {${a}}`:"");let n=e.fields,o=!1,l=!1,c=!1;const u=await ie(t),d=await re(t);if(u||d){const e={rasterAttributeTableFieldPrefix:"Raster."};n=null===(r=t.getCustomRasterFields)||void 0===r?void 0:r.call(t,e),c=["F32","F64"].indexOf(t.pixelType)<0,(null==t?void 0:t.capabilities)&&(o=(null==t?void 0:t.capabilities.toLowerCase().indexOf("catalog"))>-1||(null===(i=t.fields)||void 0===i?void 0:i.length)>0,l=o&&("esriImageServiceDataTypeVector-UV"===t.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===t.serviceDataType))}const p={esriFieldTypeDouble:1,esriFieldTypeSingle:1},y={esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1},v={esriFieldTypeDate:1};let m=",";e.editFieldsInfo&&(e.editFieldsInfo.creatorField&&(m+=`${e.editFieldsInfo.creatorField},`),e.editFieldsInfo.creationDateField&&(m+=`${e.editFieldsInfo.creationDateField},`),e.editFieldsInfo.editorField&&(m+=`${e.editFieldsInfo.editorField},`),e.editFieldsInfo.editDateField&&(m+=`${e.editFieldsInfo.editDateField},`),m=m.toLowerCase());const f={title:s,fieldInfos:n.map((r=>{let i="esriFieldTypeOID"!==r.type&&"esriFieldTypeGlobalID"!==r.type&&"esriFieldTypeGeometry"!==r.type,a=null,s=r.editable&&"esriFieldTypeOID"!==r.type&&"esriFieldTypeGlobalID"!==r.type;if(i){let s=r.name.toLowerCase(),n=`${m}stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,`;o&&(n=`${n}raster.itempixelvalue,`,l&&(n=`${n}raster.magnitude,raster.direction,`)),(n.indexOf(`,${s},`)>-1||s.indexOf("shape")>-1||s.indexOf("perimeter")>-1||s.indexOf("objectid")>-1||s.indexOf("raster.servicepixelvalue.")>-1||s.indexOf("_i")==s.length-2)&&(i=!1),r.type in y?a={places:0,digitSeparator:!0}:r.type in p?a={places:c&&(s.indexOf("raster.servicepixelvalue")>-1||s.indexOf("raster.itempixelvalue")>-1)?0:2,digitSeparator:!0}:r.type in v&&(e.currentVersion>=10||(null==t?void 0:t.version)>=10)&&(a={dateFormat:"longMonthDayYear"})}return s=s?-1===m.indexOf(`,${r.name.toLowerCase()},`):s,{fieldName:r.name,label:r.alias,isEditable:s,tooltip:"",visible:i,format:a,stringFieldOption:"textbox"}})),description:null,showAttachments:!0,mediaInfos:[],layerOptions:void 0};return ie(t)?(f.layerOptions={},f.layerOptions.showNoDataRecords=!0,f.layerOptions.returnTopmostRaster=!0):re(t)&&(f.layerOptions={},f.layerOptions.showNoDataRecords=!0),f}({name:(null==r?void 0:r.title)||"",fields:t},e)}}async function ce(e,t){if(3===i.c.api){const r={opacity:1,visibility:!0,layerType:"WebTiledLayer",type:"WebTiledLayer"},a={baseMap:{title:"basemap",baseMapLayers:[],operationalLayers:[]}};if(e.id){const t=await async function(e){const{config:t}=i.c,r=`${t.restBaseUrl}content/items/${e}/data`;try{const e=await(0,y.r)(r,null,{disableIdentityLookup:!0});return e&&((null==e?void 0:e.wfsInfo)||e.wmtsInfo)?e:(null==e?void 0:e.layers)?e.layers:{}}catch(e){return e}}(e.id);a.baseMap.baseMapLayers.push(Object.assign(Object.assign({},t),r))}else a.baseMap.baseMapLayers.push(r);return J(a,t||e.extent)}{const[t,r,a,s]=await(0,v.l)(["esri/layers/WMTSLayer","esri/Map","esri/views/MapView","esri/core/reactiveUtils"]),n=new t({portalItem:{id:e.id,portal:i.c.portal}}),o=new r({layers:[n]}),l=new a({container:A(),map:o});await s.whenOnce((()=>!l.updating)),await l.goTo(n.fullExtent);return(await l.takeScreenshot({width:l.width,height:l.height,format:"png"})).dataUrl}}const ue=e=>{var t;const r=i.c.portal;return e.thumbnailURL&&(e.thumbnailURL=function(e){var t;return(null===(t=null==e?void 0:e.staticImagesUrl)||void 0===t?void 0:t.replace("http:","https:"))||""}(r)+e.thumbnailURL),r.isPortal&&0!==(null===(t=e.thumbnailURL)||void 0===t?void 0:t.indexOf("http"))&&(e.thumbnailURL=window.location.protocol+"//"+window.location.host+e.thumbnailURL),e};const de=(e,t)=>{const[r,i]=e.split("?");return`${r}${(null==i?void 0:i.split("&").reduce(((e,r)=>{const[i]=r.split("=");return-1===t.indexOf(i.toLowerCase())?`${e}${e?"&":"?"}${r}`:e}),""))||""}`},pe=async e=>{var t;const[r]=await(0,v.l)(["esri/layers/WMSLayer"]),{customParameters:a}=e,s=U(a),n=de(e.url,["service","request","bbox","format","height","width","layers","srs","crs","styles","transparent","bgcolor","exceptions","time","elevation","sld","wfs"]);try{if(4===i.c.api){const i=new r({url:n,customParameters:Object.assign({},null==s?void 0:s.customParameters),customLayerParameters:Object.assign({},null==s?void 0:s.customLayerParameters)});try{const t=await i.load();return e.type="WMS",{result:Object.assign(Object.assign({},e),{type:"WMS",serviceInfo:t})}}catch(e){return{error:{code:e.message?"unhandledError":"serviceNotExist",message:null!==(t=e.message)&&void 0!==t?t:e.message}}}}await he(n);const a=new r(n,{customParameters:Object.assign({},null==s?void 0:s.customParameters),customLayerParameters:Object.assign({},null==s?void 0:s.customLayerParameters)}),o=await new Promise(((t,r)=>{a.on("load",(()=>{e.type="WMS",t(Object.assign(Object.assign({},e),{type:"WMS",serviceInfo:a}))})),a.on("error",(e=>{var t;const{error:i}=e,a=!(null==i?void 0:i.message)||404===(null==i?void 0:i.status);r({code:a?"serviceNotExist":"unhandledError",message:null!==(t=i.message)&&void 0!==t?t:e.message})}))}));return{result:o}}catch(e){return console.error(e),{error:e}}},ye=async e=>{const t=4===i.c.api?await e.load():e,{layerInfos:r,title:a,allSublayers:s}=t;return{title:a,layers:function(e){return e.map((e=>{var t;const r=null!==(t=e.legendURL)&&void 0!==t?t:e.legendEnabled?e.legendUrl:void 0;return{name:e.name,visible:!1,title:e.title.replace(/ /g,String.fromCharCode(160)),extent:e.extent,legendUrl:r||void 0,queryable:e.queryable,subLayers:e.subLayers||[]}}))}(4===i.c.api?s.items:r)}};function ve(e=[],t){return delete t.id,t.subLayers&&t.subLayers.length?t.subLayers.reduce(ve,e):[...e,t]}const me=async(e,t)=>{let r=e.thumbnailURL;try{r=(await t.fetchImage(e.extent,800,532)).src}catch(e){console.error(e)}return Object.assign(Object.assign({},e),{thumbnailURL:r,extent:X(e.extent)})},fe=async(e,t)=>new Promise((r=>{const i=t=>{r(Object.assign(Object.assign({},e),{thumbnailURL:t||e.thumbnailURL,extent:X(e.extent)}))};t.getImageUrl(e.extent,800,532,i,i)})),ge=(e,t)=>JSON.stringify({title:e.title||"",url:e.url,version:e.version,layers:t,copyright:e.copyright||"",maxHeight:e.imageMaxHeight,maxWidth:e.imageMaxWidth,spatialReferences:e.spatialReferences,format:e.imageFormat.includes("png")?null:e.imageFormat,featureInfoUrl:e.featureInfoUrl,featureInfoFormat:e.featureInfoFormat,customParameters:e.customParameters||{},customLayerParameters:e.customLayerParameters||{}}),we=(e,t)=>JSON.stringify({title:e.title||"",url:e.url,mapUrl:e.getMapURL,version:e.version,layers:t,copyright:e.copyright||"",maxHeight:e.maxHeight,maxWidth:e.maxWidth,spatialReferences:e.spatialReferences,format:"png"!==e.getImageFormat()?e.getImageFormat():null,featureInfoUrl:e.getFeatureInfoURL,featureInfoFormat:e.featureInfoFormat,customParameters:e.customParameters||{},customLayerParameters:e.customLayerParameters||{}});async function he(e){var t,r,i;try{const a=await fetch(e);if("cors"===a.type&&200===a.status){const a=new URL(e).hostname,[s]=await(0,v.l)(["esri/config"]);null===(i=null===(r=null===(t=null==s?void 0:s.defaults)||void 0===t?void 0:t.io)||void 0===r?void 0:r.corsEnabledServers)||void 0===i||i.push(a)}}catch(e){}}function be({parameter:e}){return"version"===e}const Se=async e=>{const{customParameters:t}=e,{url:r}=e,i=de(r,["version","service","request","layer","typename"]),a=null==t?void 0:t.find(be),s=U(t.filter((e=>!be(e)))),n=Object.assign({customParameters:(null==s?void 0:s.customParameters)||{}},a?{version:a.value}:{});try{const[t]=await(0,v.l)(["esri/layers/ogc/wcsUtils"]),r=await t.getCapabilities(i,n),a=r.gridCoverages;return a&&a.length?{result:Object.assign(Object.assign({},e),{type:"WCS",url:i,serviceInfo:Object.assign(Object.assign({},r),{url:i})})}:{error:{code:"emptyFeatureLayer"}}}catch(e){return console.error(e),{error:e}}},xe=async(e,t)=>{const[r]=await(0,v.l)(["esri/layers/WFSLayer"]),{customParameters:a}=o.a,{url:s}=e,n=de(s,["version","service","request","layer","typename"]),l=U(a),c=await(async e=>{const{query:t}=await(0,f.d)(e);return(null==t?void 0:t.version)||"2.0.0"})(s),u=t||{version:c,url:n,customParameters:(null==l?void 0:l.customParameters)||{}};try{if(4===i.c.api){if("2.0.0"!==c)return{error:{code:"unsupportedWFSVersion"}};delete u.version,delete u.url;const[t]=await(0,v.l)(["esri/layers/ogc/wfsUtils"]),i=await t.getCapabilities(n,u),a=i.featureTypes;if(a&&a.length){const s=await t.getWFSLayerInfo(i,void 0,void 0,u),o=r.fromWFSLayerInfo(s);return o.layers=a,o.url=n,o.isComplex="esriGeometryComplex"===o.geometryType,{result:Object.assign(Object.assign({},e),{type:"WFS",serviceInfo:o})}}return{error:{code:"emptyFeatureLayer"}}}const t=new r(u);await he(n);return{result:await new Promise(((r,i)=>{t.initialize(u,(a=>{a&&a.length?(t.layers=a,t.url=n,t.isComplex="esriGeometryComplex"===t.geometryType,r(Object.assign(Object.assign({},e),{type:"WFS",serviceInfo:t}))):i({code:"emptyFeatureLayer"})})),t.on("error",(async()=>{if("2.0.0"===t.toJson().version){const{result:t,error:a}=await xe(e,{version:"1.1.0",url:s});a&&i(a),r(t)}else if("1.1.0"===t.toJson().version){const{result:t,error:a}=await xe(e,{version:"1.0.0",url:s});a&&i(a),r(t)}else i({code:"serviceNotExist"})}))}))}}catch(e){return console.error(e),{error:e}}},Oe=async e=>{var t;if(!e||!(null==e?void 0:e.serviceInfo))return Promise.reject(new Error("serviceNotExist"));const r=function(e,t,r){const{customParameters:i}=U(r),a=i.version||e.version;return delete i.version,{title:e.name,url:e.url,customParameters:i,layerType:"WCS",wcsInfo:{version:a,coverageId:t.id}}}(e.serviceInfo,e.selectedCoverage,e.customParameters),i=null===(t=null==e?void 0:e.selectedCoverage)||void 0===t?void 0:t.lonLatEnvelope,a=Object.assign(Object.assign({type:e.type,url:e.url},i?{extent:X(i)}:{}),{text:JSON.stringify(r)}),s=await We(a);return Object.assign(Object.assign({},a),s)},Ie=async e=>{var t;if(!e||!(null==e?void 0:e.serviceInfo))return Promise.reject(new Error("serviceNotExist"));const{serviceInfo:r}=e,a=X((null===(t=r.selectedLayer)||void 0===t?void 0:t.fullExtent)||[[],[]]),s=a.split(",").map(Number);if(!r.geometryType||"none"===r.geometryType)return Promise.reject(new Error("missingGeometry"));const n={type:e.type,url:e.url,thumbnailURL:e.thumbnailURL},l=await async function(e){const{layerNamespace:t,getFeatureUrl:r,spatialReferences:a,fields:s}=e,{maxFeatures:n,geometryType:l}=o.a;let c,u,d,p;if(3===i.c.api){const t=e.toJson();c=t.url,u=t.mode,d=t.version,p=t.name}else{const t=e;c=t.url,d="2.0.0",p=t.name}const y=l||e.geometryType||"esriGeometryComplex";return{url:c,mode:u,wfsInfo:{version:d,name:p,wfsNamespace:t,featureUrl:r,supportedSpatialReferences:a,customParameters:e.customParameters||{},maxFeatures:n||e.maxFeatures||3e3},layerDefinition:{geometryType:y,drawingInfo:{renderer:await oe(y)},spatialReference:{wkid:4326},fields:s},popupInfo:await le(e)}}(r),c=Object.assign(Object.assign({},ue(n)),{text:JSON.stringify(l),extent:a}),u=await We(c),d=Object.assign(Object.assign(Object.assign({},c),u),{extent:[[s[0],s[1]],[s[2],s[3]]]});try{const e=await async function(e){const{config:t}=i.c,r={baseMap:t.defaultBasemap||t.self.defaultBasemap,operationalLayers:[]},{baseMapLayers:a}=r.baseMap;let s=!1;return a.forEach((e=>{e.isReference||s||(!t.allSSL&&"https:"!=location.protocol||!(0,f.b)(e.url)&&!(0,f.c)(e.url)||(e.url=e.url.replace("http:","https:")),e.visibility=!1,s=!0,r.baseMap.baseMapLayers=[e])})),r.operationalLayers.push({type:"WFS",layerType:"WFS",opacity:1,visibility:!0,id:"wfs_xxx",wfsInfo:{maxFeatures:100}}),W(r,e)}(d.extent);return Object.assign(Object.assign({},d),{thumbnailUrl:e})}catch(e){return d}};async function Te(e,t){const[r]=await(0,v.l)(["esri/layers/WMTSLayer"]),{customParameters:a,url:s}=e,n=U(a),o=Object.assign(Object.assign({},t),{customLayerParameters:null==n?void 0:n.customLayerParameters,customParameters:null==n?void 0:n.customParameters})||await Object.assign(Object.assign({},async function(e){var t,r;const i=await(0,f.d)(e),a=(null===(t=i.query)||void 0===t?void 0:t.service)||"",s=(null===(r=i.query)||void 0===r?void 0:r.request)||"";return"wmts"===a.toLowerCase()&&"getcapabilities"===s.toLowerCase()||e.toLowerCase().indexOf("/1.0.0/wmtscapabilities.xml")>-1?{serviceMode:"KVP"}:{}}(s)),{customLayerParameters:(null==n?void 0:n.customLayerParameters)||{},customParameters:(null==n?void 0:n.customParameters)||{}}),l=de(s,["version","service","request","layer","style","format","tilematrixset","tilematrix","tilerow","tilecol"]),c=l.replace(/\/1.0.0\/wmtscapabilities.xml/i,"");try{if(4===i.c.api){const t=new r(c,o),i=t;await i.load();const a=i.sublayers.toArray();return a&&a.length?(t.layers=a,{result:Object.assign(Object.assign({},e),{type:"WMTS",serviceInfo:t})}):{error:{code:"serviceNotExist"}}}await he(l);const t=new r(c,o);let a;return{result:await new Promise(((r,i)=>{t.on("load",(({layer:s})=>{a=s.layers,a&&a.length?(t.layers=a,r(Object.assign(Object.assign({},e),{type:"WMTS",serviceInfo:t}))):i(new Error("serviceNotExist"))})),t.on("error",(t=>{var a;o.serviceMode?("The WMTS capabilities XML is not valid"===(null===(a=t.error)||void 0===a?void 0:a.message)&&i({code:"invalidWMTS"}),i({code:"serviceNotExist"})):Te(e,{serviceMode:"KVP"}).then((({result:e,error:t})=>{t&&i(t),r(e)}),i)}))}))}}catch(e){return console.error(e),{error:e}}}async function Le(e){if(!e)return Promise.reject("serviceNotExist");const{serviceInfo:t,selectedLayer:r,selectedTileInfo:a}=e;if(!r)return Promise.reject(new Error("layerNotSelected"));if(!a)return Promise.reject(new Error("missingGeometry"));t.selectedTileInfo=a;const{wmtsConfig:s,fullExtent:n}=await async function(e){var t;const r=4===i.c.api;try{const[a]=await(0,v.l)([r?"esri/geometry/SpatialReference":"esri/SpatialReference"]),{selectedLayer:s,selectedTileInfo:n,copyright:o}=e,l=(null==n?void 0:n.fullExtent.spatialReference)||new a({wkid:4326}),c=await B(null==s?void 0:s[r?"fullExtent":"gcsExtent"],l).then((e=>{var t;return"extent"===(null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.type)?4===i.c.api?e[0]:e[0].toJson():null}));let u,d="";if(r)d=s.imageFormat;else{const e=s.formats;d=e.includes("image/png")?"image/png":e[0]}e.resourceUrls=s.resourceUrls,u=r?e.getUrlTemplate(s.id,n.id,d,s.styleId):e.getTileUrlTemplate({identifier:s.identifier,tileMatrixSet:n.tileMatrixSet,format:d});const p={templateUrl:u,copyright:function(e){return"none"!==(null==e?void 0:e.toLowerCase())?(null==e?void 0:e.length)>180?`${e.substring(0,180)}..`:"":e}(o),fullExtent:r?c.toJSON():c||e.selectedTileInfo.fullExtent,tileInfo:function(e){const{tileInfo:t}=e;return 96!==(null==t?void 0:t.dpi)&&(t.lods.forEach((e=>{e.scale=96*e.scale/t.dpi})),t.dpi=96),r?t.toJSON():t.toJson()}(n),wmtsInfo:{url:null!==(t=e.wmtsUrl)&&void 0!==t?t:e.url,layerIdentifier:r?s.id:s.identifier,tileMatrixSet:r?n.id:n.tileMatrixSet,customParameters:e.customParameters||{},customLayerParameters:e.customLayerParameters||{}}};return Promise.resolve({wmtsConfig:p,fullExtent:c})}catch(e){throw console.error(e),e}}(t).catch((e=>{throw console.error("Error getting WMTS config",e),e})),o=t.selectedLayer[4===i.c.api?"fullExtent":"gcsExtent"],l=n?o:{xmin:-180,ymin:-90,xmax:180,ymax:90},c={type:e.type,url:e.url,thumbnailURL:e.thumbnailURL},u=Object.assign(Object.assign({},ue(c)),{url:s.wmtsInfo.url,text:JSON.stringify(s),extent:`${l.xmin},${l.ymin},${l.xmax},${l.ymax}`}),p=await We(u),y=Object.assign(Object.assign(Object.assign({},u),p),{extent:[[l.xmin,l.ymin],[l.xmax,l.ymax]]});try{const e=await ce(y),t=4===i.c.api?{type:"base64",data:e}:{type:"url",url:e},r=await(0,d.e)(p.id,t);return Object.assign(Object.assign({},y),r)}catch(e){return console.error("Error when adding WMTS URL:",e),y}}function Pe(e){var t,r;if(!e)return;const{title:i,description:a}=e;n.i.title=null!==(t=null!=i?i:n.i.title)&&void 0!==t?t:"",n.i.snippet=null!==(r=null!=a?a:n.i.snippet)&&void 0!==r?r:"",o.a.selectedLayer=e}async function ke(e,t={},r=!0){const{links:a}=e,s=je(a,"data","application/json")||je(a,"http://www.opengis.net/def/rel/ogc/1.0/data","application/json");if(null==s)throw new Error("Missing collections url");return 3===i.c.api?(0,y.r)(L(s.href),{},Object.assign(Object.assign({},t),{addTokenManually:!1}),"auto",{v3Request:{headers:{accept:"application/json"}},excludeJson:r}):(0,y.r)(L(s.href),{},Object.assign(Object.assign({},t),{addTokenManually:!1,headers:{accept:"application/json"}}),"auto",{excludeJson:r})}function je(e,t,r){return e.find((e=>e.rel===t&&e.type===r))||e.find((e=>e.rel===t&&!e.type))}const Me={fields:[{name:"Name",type:"esriFieldTypeString",alias:"Name",nullable:!0,editable:!0,sqlType:"sqlTypeOther",visible:!0,domain:null,defaultValue:null},{name:"Location",type:"esriFieldTypeString",alias:"Location",nullable:!0,editable:!0,sqlType:"sqlTypeOther",visible:!0,domain:null,defaultValue:null},{name:"Description",type:"esriFieldTypeString",alias:"Description",nullable:!0,editable:!0,sqlType:"sqlTypeOther",visible:!0,domain:null,defaultValue:null}]},Ce=(e,t)=>{const{newItemMode:r,typeKeywords:a,tags:s,extent:l,selectedServiceInfoLayersNames:c,addFeatureLayerType:u,layerData:p}=o.a,y=n.i.title;switch((null==y?void 0:y.length)>250&&(n.i.title=y.substring(0,250)),r){case"application":return $(e,t);case"file":return $e();case"url":return Ne(e,i.c.config,i.c.api);case"featureLayer":return ft({serviceInfo:e.serviceInfo,typeKeywords:a,tags:s,extent:l,selectedServiceInfoLayersNames:c,addFeatureLayerType:u,layerData:p});default:return(0,d.b)(Object.assign({},e))}},Ue=async()=>{try{const e=o.c,t=await Ce(e,"");o.a.id=t.id;const r=await Je(o.a.id,{success:t.success});if("failed"===r.status)throw r.statusMessage;return{}}catch(e){console.error(e);const t=(null==e?void 0:e.statusMessage)||e||"";switch(!0){case t.includes("Invalid File Geodatabase"):return{error:{code:"invalidFileGeodatabase"}};case t.includes("Invalid Shapefile"):return{error:{code:"invalidShapefile"}};case t.includes("The request size is greater than the max allowed of 1024MB"):return{error:{code:"exceedsFileSize"}};default:return{error:{code:"unhandledError"}}}}},$e=async e=>{const t=o.a.file,r=o.a.dataUrl;return!t&&r?Fe(e):(null==t?void 0:t.size)>C||"Esri Classifier Definition"===o.a.type?Ee():async function(){const e=(0,d.k)(i.c.user,n.i.folder),t=(0,d.i)(n.i,o.a);try{return await(0,y.a)(e,t,{},"post")}catch(e){throw(null==e?void 0:e.message)||e}}()},Fe=async e=>{var t;const r=(0,d.k)(i.c.user,n.i.folder),{fileName:a,dataUrl:s,extension:l}=o.a,c=(0,d.h)(n.i,o.a),u=!!o.a.overwrite,p=(null==s?void 0:s.includes("/query?"))&&(null==a?void 0:a.includes("query"))&&(null==l?void 0:l.includes("json"))?{filename:(0,b.g)(),dataUrl:s}:{},v=Object.assign(Object.assign(Object.assign({},c),{async:!0,filename:null!==(t=null==e?void 0:e.filename)&&void 0!==t?t:a,title:null==e?void 0:e.title,overwrite:u}),p);return(0,y.r)(r,v,{},"post")};async function Re(e,t,r=0){const{user:a,portal:s}=i.c,{existingItem:n}=o.a;try{const{partData:o,formData:l}=e,c=`?streamdata=true&size=${o.size}&partNum=${o.partNum}&f=json`,u=`${n?(0,I.g)(await(0,I.f)(n.owner,s),s):a.userContentUrl}/items/${t}/addPart${c}`;return{response:await(0,y.a)(u,l,{"X-Esri-Authorization":`Bearer ${(0,S.g)(i.c.portal)}`},"post"),attempts:r,partSize:o.size}}catch(i){if(!o.a.id)throw"cancelled";if(++r>5)throw new Error("Upload failed - too many attempts");return Re(e,t,r)}}const Ee=async e=>{var t,r,a,s;let l,c,p,v,m=!0;if(e){const{updateUrl:t,updateFormData:r,updateSourceDataId:i}=e;l=t,c=r,p=i,v=o.a.existingItem.owner}const f=()=>{if(o.a.id){m=!1;const e=o.a.id;return o.a.id=null,(0,d.l)(e,v)}},g=M.addSubscriber("addFileMultiPart",f),w=i.c.config;l=e?l:(0,d.k)(i.c.user,n.i.folder);const{fileName:h,file:b}=o.a;let O,I=null!==(t=w.multiPartBatchSize)&&void 0!==t?t:3,T=0;try{if(e)await(0,y.a)(l,c,{enctype:"multipart/form/data"},"post"),O=p;else{const e=await(0,y.r)(l,{multipart:!0,fileName:h,async:!0},{},"post");O=null!==(r=e.id)&&void 0!==r?r:e.itemId,o.a.id=O}o.a.uploadProgress=0,x.w.uploadProgress=0;let t=0;const a=function*(e){const t=o.a.file,{name:r,size:a}=t;let s=e?o.a.fileName:r,n=26214400,l=Math.ceil(a/n),c=0;for(l>1e4&&(n=Math.ceil(a/1e4),l=Math.ceil(a/n));c<l;){const e=new FormData,r=c*n,a=t.slice(r,r+n);c++;const o={partNum:c,size:a.size};e.append("partNum",String(o.partNum)),e.append("streamdata","true"),e.append("f","json"),e.append("token",(0,S.g)(i.c.portal)),e.append("file",a,s),yield{partData:o,formData:e}}return null}(!!e);await(0,u.s)((()=>{const{value:e,done:t}=a.next();return t?null:Re(e,O)}),{getBatchSize:()=>I,onPromiseCompleted:e=>{const{attempts:r,partSize:i}=e;r>0?(I=Math.max(1,Math.ceil(I/2)),T=0):(T++,T>=I&&(I=Math.min(I+1,10),T=0)),t+=i;const a=Math.floor(t/b.size*100);o.a.uploadProgress=a,x.w.uploadProgress=a},onPromiseThrow(){m=!1},shouldContinue:()=>m&&M.isSubscriberValid(g)}),M.removeSubscriber(g);const{type:s,extension:n,enablePublishing:v,properties:f,existingItem:w,tileLayerPublishType:L,classification:P}=o.a,k=[];return"3dTiles"===L&&k.push(o.a.tilesLayer3dTilesLayerType),await(0,d.j)(O,{file:b,type:s,extension:n,enablePublishing:v,properties:f,existingItem:w,typeKeywords:k,classification:P},!!e)}catch(e){throw await f(),console.error(null!==(a=null==e?void 0:e.message)&&void 0!==a?a:e),null!==(s=null==e?void 0:e.message)&&void 0!==s?s:e}},Ne=(e,t,r)=>{if(e.agsType)return Ye(e);switch(e.type){case"KML":return async function(e,t,r){try{const[i,a]=await Promise.all([Z(e.url,t,r),G(e)]);return await We(Object.assign(Object.assign({},e),{extent:i,thumbnailURL:a}))}catch(e){throw e}}(e,t,r);case"WMS":return(async e=>{const t=4===i.c.api,[r]=await(0,v.l)([t?"esri/geometry/SpatialReference":"esri/SpatialReference"]),{layers:a}=o.a;if(!e||!(null==e?void 0:e.serviceInfo))return Promise.reject(new Error("serviceNotExist"));const s=ue(e),{serviceInfo:n}=s,l=[];let c;const u=a.reduce(ve,[]).map((e=>{c=c?e.extent?c.union(e.extent):c:e.extent,l.push(e.name);const t={name:e.name,title:e.title,legendUrl:void 0,queryable:e.queryable};return e.legendUrl&&(t.legendUrl=e.legendUrl),t}));t||n.setVisibleLayers(l),c=c||n.fullExtent;const d=!n.spatialReferences.some((e=>e===c.spatialReference.wkid)),p={type:e.type,url:n.url,description:n.description||"",accessInformation:n.copyright||"",text:t?ge(n,u):we(n,u),extent:c};d&&z(c,new r({wkid:n.spatialReferences[0]})).then((e=>p.extent=e));const y=t?await me(p,n):await fe(p,n);return We(y)})(e);case"WFS":return Ie(e);case"WCS":return Oe(e);case"WMTS":return Le(e);case"OGCFeatureServer":return async function(e){const{serviceInfo:t,customParameters:r}=e;return t?(r.length>0&&(e.text=JSON.stringify({customParameters:U(r).customParameters})),We(e)):Promise.reject(new Error("serviceNotExist"))}(e);default:return We(e)}},Ae=async e=>(0,d.b)(e),De=e=>{var t,r,i,a;const{type:s,agsType:n}=e,o=(null===(t=h.a[null!=n?n:s])||void 0===t?void 0:t.typeKeywords)||[];return((null===(i=null===(r=null==e?void 0:e.serviceInfo)||void 0===r?void 0:r.layers)||void 0===i?void 0:i.some((e=>"Oriented Imagery Layer"===e.type)))||"Oriented Imagery Layer"===(null===(a=null==e?void 0:e.serviceInfo)||void 0===a?void 0:a.type))&&o.push("OrientedImageryLayer"),[...o,...e.typeKeywords||[]]},We=async e=>{const{customParameters:t,agsType:r}=e,{type:i}=(0,g.g)(e.type),a=Object.assign(Object.assign({},e),{typeKeywords:De(e),type:i});if((null==t?void 0:t.length)>=1&&r){const{customParameters:e}=U(t);a.text=JSON.stringify({customParameters:e})}return(0,d.b)(a)};async function Je(e,t={},r){var a;try{const a=i.c.user,s=null!=r?r:`${a.userContentUrl}/items/${e}/status`,n=(null==t?void 0:t.jobId)?{jobId:t.jobId}:{};return await(0,y.p)(s,{requestParams:n})}catch(r){if(!(null===(a=r.statusMessage)||void 0===a?void 0:a.includes("Item status doesn't exist"))||!t.success)throw console.error(r),r;return{itemId:e,status:"status-not-found",lastUpdatedTime:0,submissionTime:0,recordCount:0}}}async function Ge(e,t){const r=n.i.folder,{user:a}=i.c;return async function(e,t,r,a){const{config:s}=i.c,n=r.id&&"/"!==r.id&&r.id!==e?`/${r.id}`:"",o=`${s.restBaseUrl}content/users/${e}${n}/items/${t}/addResources`;return(0,y.r)(o,a,{},"post")}(a.username,t,r,{fileName:"cloudProvider.json",text:JSON.stringify(e),access:"private"})}async function _e(e){const{addResponseId:t,publishResponse:r,categories:i,portal:a}=e;try{const e=[t,null==r?void 0:r.id].filter((e=>e));i&&await(0,T.u)({portal:a,itemIds:e,categories:i}),await Je(r.id,{jobId:r.jobId});const s=r.serviceUrl,n=`${s.replace("rest/services","rest/admin/services")}/rebuildCache`,o=await(0,y.r)(n,{layers:0},{},"post");return await(0,d.u)(null==r?void 0:r.id,{properties:JSON.stringify({cacheJobId:o.jobId,cacheJobUrl:o.jobUrl}),id:null==r?void 0:r.id}),{}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}async function Ke(e,t){try{const r=`${t}/create3DLayer`,i=Object.assign(Object.assign({},Me),{name:n.i.title}),a=await(0,y.r)(r,{layer3DDefinition:JSON.stringify(i)},{},"post");return{result:await Je(e,{},a.statusURL)}}catch(e){return console.error(e),{error:{code:"failToCreate3DLayer"}}}}async function Ve(e){const{url:t,thumbnailURL:r,serviceInfo:a,extent:s}=e;if(r)return r;if(!["Map Service","Feature Service","Image Service"].includes(e.type))return null;if(["Map Service","Image Service"].includes(e.type)||-1!==t.indexOf("MapServer")){const e=X(s);return s?function(e){var t;let r,{visibleLayers:i,serviceUrl:a,serviceInfo:s,size:n,extent:o,bboxSR:l,imageSR:c,format:u}=e;if(!s)return"";let d=a.indexOf("/MapServer")>-1;if(!i&&d){let e;r=a.indexOf("/MapServer");const t=a.indexOf("?");t>-1?(e=a.substring(r+11,t),a=a.substring(0,r+10)+a.substring(t),i=e):(e=a.substring(r+11),a=a.substring(0,r+10),i=e)}!d&&s&&(d=s.capabilities?s.capabilities.toLowerCase().indexOf("map")>-1:s.supportedImageFormatTypes);let p=a;if(r=p.indexOf("?"),-1===r)if(d)p+="/export?";else{if(void 0!==s.currentVersion&&s.currentVersion>=10.1)return p+="/info/thumbnail",p;p+="/exportImage?"}else if(d)p=`${p.substring(0,r)}/export${p.substring(r,p.length)}&`;else{if(void 0!==s.currentVersion&&s.currentVersion>=10.1)return p=`${p.substring(0,r)}/info/thumbnail${p.substring(r,p.length)}`,p;p=`${p.substring(0,r)}/exportImage${p.substring(r,p.length)}&`}p+=`size=${n}&bbox=${o}`,(null==l?void 0:l.length)>0&&(p+=`&bboxSR=${l}`);(null==c?void 0:c.length)>0&&(p+=`&imageSR=${c}`);d&&(null===(t=null==s?void 0:s.supportedImageFormatTypes)||void 0===t?void 0:t.indexOf("PNG32"))>-1?p+=`&format=png32&f=${u}`:p+=d?`&format=png24&f=${u}`:`&format=jpgpng&f=${u}`;d?(null==i?void 0:i.length)>0&&(p+=`&layers=show:${i}`):p+="&interpolation=RSP_NearestNeighbor&bandIds=null";return p}({serviceUrl:t,extent:e,size:"800,532",format:"image",serviceInfo:a}):null}const{result:n,error:o}=await async function(e){var t;const{config:r,portal:a,api:s}=i.c;if(4===s)return{result:await qe(e.id,a)};const[n,o]=await(0,v.l)(["esri/layers/FeatureLayer","esri/geometry/Extent"]),{serviceInfo:l,username:c,password:u,isSecured:d}=e,p={baseMap:r.defaultBasemap||r.self.defaultBasemap,operationalLayers:[]};p.baseMap.title="basemap";const y=p.baseMap.baseMapLayers.length;for(let e=0;e<y;e++){let t=p.baseMap.baseMapLayers[e];if(!t.isReference){!r.allSSL&&"https:"!=location.protocol||!(0,f.b)(t.url)&&!(0,f.c)(t.url)||(t.url=t.url.replace("http:","https:")),t.visibility=!1,p.baseMap.baseMapLayers=[t];break}}if(!l)return{result:""};const m=l.layers||[],g=e.url,w=await(0,f.d)(g),h=d.secured?await it(w.path,{username:c,password:u}):null;m.reverse().forEach((async t=>{const r={url:`${g}/${t.id}${h?`?token=${h}`:""}`,id:`${e.id||Math.random()}_${t.id}`,opacity:1,title:`${e.title||"title"}_${t.id}`,visibility:!0,layerDefinition:void 0};let i=!1;m.forEach((e=>{e.id!==t.id||i||(i=!0,r.layerDefinition=e.layerDefinition)})),(!m.length||m.length&&i)&&p.operationalLayers.push(r)}));let b=[[-180,-90],[180,90]];if("string"==typeof e.extent){const t=e.extent.split(",");b=[[parseFloat(t[0]),parseFloat(t[1])],[parseFloat(t[2]),parseFloat(t[3])]]}else(null===(t=e.extent)||void 0===t?void 0:t.length)>0&&(b=e.extent);if(1===p.operationalLayers.length){let e=new n(p.operationalLayers[0].url);return new Promise((t=>{e.on("load",(async r=>{(null==r?void 0:r.layer)&&(e=r.layer);const i=await H(e,b);try{const e=await J(p,i);t({result:e})}catch(e){t({error:{code:"unhandledError",message:e}})}}))}))}{const t=e.extent,r=Q(new o(t[0][0],t[0][1],t[1][0],t[1][1]),200),i=[],a=[],s=[];p.operationalLayers.forEach((e=>{const t=new n(e.url),o=new Promise((s=>{t.on("load",(t=>{i.push(e),a.push(t),t.minScale<=r&&t.maxScale>r?s(!0):s(!1)})),t.on("error",(()=>{s(!1)}))}));s.push(o)}));const l=await Promise.all(s);p.operationalLayers=i;const c=l.filter((e=>e)).length>0;try{if(!c&&a.length>0){const e=await H(a[0],t);return{result:await J(p,e)}}return{result:await J(p,t)}}catch(e){return{error:{code:"unhandledError",message:e}}}}}(e);return o?(console.error("Error generating thumbnail",o),""):n}async function qe(e,t){var r,i,s;const[n,o,l,c,u,d,p,y]=await(0,v.l)(["esri/Map","esri/views/MapView","esri/layers/FeatureLayer","esri/Basemap","esri/rest/print","esri/rest/support/PrintTemplate","esri/rest/support/PrintParameters","esri/smartMapping/heuristics/scaleRange"]);try{const v=A(800,532),m=t.defaultBasemap.id.includes("basemap"),f=new l({portalItem:{id:e,portal:t}}),g=new n({basemap:m?"topo-vector":new c({portalItem:{id:t.defaultBasemap.id,portal:t}})}),w=new o({map:g,container:v});await g.watch("loaded");let h=0,b=0;m||({minScale:h,maxScale:b}=await y({layer:f,view:w}));const S=await f.queryExtent();w.goTo(S.extent),f.minScale=h,f.maxScale=b,w.map.add(f),w.scale=b,await(0,a.t)(2e3);const x=null!==(s=null===(i=null===(r=t.helperServices)||void 0===r?void 0:r.printTask)||void 0===i?void 0:i.url)&&void 0!==s?s:"https://utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",O=new p({view:w,template:new d({format:"png32",exportOptions:{dpi:96,width:800,height:532},layout:"map-only",showLabels:!1,attributionVisible:!1})}),I=await u.execute(x,O);return N(),I.url}catch(e){return N(),null}}function Be(e){const t=(0,f.e)(e),r=(0,s.p)(e),i=t.replace(s.v,"").match(s.h);let a=null==r?void 0:r.serverType,n=null==r?void 0:r.index;const o={mapserver:"MapServer",geocodeserver:"GeocodeServer",gpserver:"GPServer",geometryserver:"GeometryServer",geoenrichmentserver:"GeoenrichmentServer",imageserver:"ImageServer",naserver:"NAServer",featureserver:"FeatureServer",geodataserver:"GeoDataServer",globeserver:"GlobeServer",wmserver:"WMServer",sceneserver:"SceneServer",vectortileserver:"VectorTileServer",streamserver:"StreamServer",videoserver:"VideoServer",knowledgegraphserver:"KnowledgeGraphServer"};return a&&o[a.toLowerCase()]&&(a=o[a.toLowerCase()]),("ags"===a||!a&&i)&&(a="MapServer"),"MapServer"===a&&null!==n?"FeatureServer":a}async function ze(e){var t;const{config:r}=i.c,{checkAuth:a,storeAuth:n,username:o,password:l}=e;var c;e.title=(c=e.url,(0,s.p)((0,f.e)(c)).serverName);const u=Be(e.url);if(!u||"SceneServer"===u&&!r.sceneViewerEnabled)return{error:{code:"unknownAGSType"}};let d=null===(t=h.a[u])||void 0===t?void 0:t.type;d||console.warn(`Unknown AGS Type ${u}`),e.type=d,e.agsType=u;try{if(!i.c.user)return{result:await Qe(e)};const t=await et({username:o,password:l},e.url,(0,s.g)(i.c.portal),a),r=null==t?void 0:t.allowStoredAuth;if(!1===r&&(e.allowStoredAuth=!1),t.secured){e.isSecured=Object.assign({},t),e.allowStoredAuth=!1;const o=await async function(e,t,r){var a,n;if(499===(null==t?void 0:t.httpStatusCode)){const[t]=await(0,v.l)([3===i.c.api?"esri/IdentityManager":"esri/identity/IdentityManager"]),{url:o,password:l,username:c}=e;let u=null===(a=(await t._getTokenSvcUrl(o)).authInfo)||void 0===a?void 0:a.tokenServicesUrl;if(u){"/"!==u[u.length-1]&&(u+="/");try{const e=await et({password:l,username:c},null!=u?u:"",(0,s.g)(),r);return(null==e?void 0:e.secured)&&401===(null==e?void 0:e.httpStatusCode)}catch(e){return(null===(n=null==e?void 0:e.message)||void 0===n?void 0:n.indexOf("Http StatusCode: -1"))>-1&&-1}}}return!1}({username:e.username,password:e.password,url:e.url},t,a);if(o||401===t.httpStatusCode){if(-1===o){const r=Object.assign(Object.assign({},e),{isSecured:null,checkUrlError:!0,storeAuth:!1});return{result:await Qe(r,{useProxy:t.useProxy})}}{const r=Object.assign(Object.assign({},e),{isSecured:{httpStatusCode:401,isFederatedWithWebTierAuth:o}});return{result:await Qe(r,{useProxy:t.useProxy})}}}return e.isSecured=Object.assign(Object.assign({},t),{isFederatedWithWebTierAuth:o}),!1!==r&&(e.allowStoredAuth=!0),t.isOverride&&("GeoenrichmentServer"!==u||e.storeAuth?e.storeAuth=!0:e.createAsServiceProxy=!0),a&&!n?{result:await Qe(e,{useProxy:t.useProxy})}:{result:e}}return{result:await Qe(e,{useProxy:t.useProxy})}}catch(t){if((0,w.b)(t)){const e=t.code;if("flowAborted"===e||"unauthorized"===e||"invalidSpatialRef"===e)return{error:t}}try{const r=Object.assign(Object.assign({},e),{isSecured:e.isSecured||null,checkUrlError:t,storeAuth:!1});return{result:await Qe(r)}}catch(e){return(0,w.b)(e)?{error:e}:{error:{code:"unhandledError",message:JSON.stringify(e)}}}}}let He=3;async function Qe(e,t,r=0){var s,l,c,u,d,p,g,h,b,S,x,O,I,T,L,P,k,j;const{url:M=e.url,useProxy:C=!1}=null!=t?t:{},[U]=await(0,v.l)([3===i.c.api?"esri/IdentityManager":"esri/identity/IdentityManager"]),{username:$,password:F,checkAuth:R,agsType:E}=e,{tags:N=[]}=n.i||{},A=[499,498],D=(0,f.e)(M);if(!e.isSecured||401!==(null===(s=e.isSecured)||void 0===s?void 0:s.httpStatusCode)&&R||(null===(l=e.checkUrlError)||void 0===l?void 0:l.message)&&e.isSecured&&(0,m.i)(e.type))try{const t=await rt({username:$,password:F},D,{isSecure:e.isSecured,isVideoService:"Video Service"===e.type,checkAuth:R,useProxy:C});"Image Service"===e.type&&t.tileInfo&&("LERC"===t.tileInfo.format||"elevation"===(null===(c=t.cacheType)||void 0===c?void 0:c.toLowerCase())?e.agsType="ElevationServer":"raster"===(null===(u=t.cacheType)||void 0===u?void 0:u.toLowerCase())&&(e.agsType="TiledImageServer",tt(M,t)&&"TiledImageServer"!==o.a.hybridImageServiceSetting&&(e.agsType="ImageServer")));const r=t.credential||U.findCredential(M),i=t.documentInfo,s=((null==i?void 0:i.Keywords)||"").split(","),n=null!==(d=null==i?void 0:i.Title)&&void 0!==d?d:t.name;return e.tags=(0,a.b)([...s,...N]).filter((e=>e)),(null==n?void 0:n.length)>0&&(e.title=n),e.description=null!==(g=null!==(p=null==i?void 0:i.Comments)&&void 0!==p?p:t.description)&&void 0!==g?g:"",e.snippet=null!==(b=null!==(h=null==i?void 0:i.Subject)&&void 0!==h?h:t.serviceDescription)&&void 0!==b?b:"",e=Object.assign(Object.assign({},e),{thumbnailToken:(null==r?void 0:r.token)||null,extent:e.extent||t.fullExtent||t.extent,serviceInfo:Object.assign(Object.assign({},t),{isSecure:!!R,userInfo:{username:$,password:F}})}),Object.assign({},e)}catch(i){if((null===(S=null==i?void 0:i.message)||void 0===S?void 0:S.toLowerCase().includes("aborted"))||"Error: json"===(null==i?void 0:i.message))throw{code:"flowAborted",message:JSON.stringify(i.message.message)};if(A.includes(null!==(x=null==i?void 0:i.code)&&void 0!==x?x:null===(O=null==i?void 0:i.details)||void 0===O?void 0:O.httpStatus))return!1!==e.allowStoredAuth&&(e.allowStoredAuth=!e.checkUrlError),Object.assign(Object.assign({},e),{isSecured:{secured:!0},serviceInfo:{isSecure:!0},allowStoredAuth:!1!==e.allowStoredAuth&&o.a.allowStoredAuth});if(403===(null==i?void 0:i.code))throw e.serviceInfo={isSecure:!0},e.isSecured={secured:!0},{code:"forbiddenCredential",message:JSON.stringify(i)};if(i&&(null===(I=e.checkUrlError)||void 0===I?void 0:I.message)){if(null===(P=null===(L=null===(T=e.checkUrlError)||void 0===T?void 0:T.message)||void 0===L?void 0:L.includes)||void 0===P?void 0:P.call(L,"was not found"))throw{code:"serviceNotExist",message:JSON.stringify(e.checkUrlError.message)};throw{code:"unhandledError",message:JSON.stringify(e.checkUrlError.message)}}if(E&&"FeatureServer"!==E||"string"==typeof i&&i.includes("not found"))throw{code:"serviceNotExist",message:JSON.stringify(i)};if((0,w.a)(i)&&"The input spatial reference must be either a geographic or projected coordinate system"===i.details[0])throw{code:"invalidSpatialRef",message:JSON.stringify(i)};if(r<He)return await(0,a.t)(1e3*r),Qe(e,t,r+1)}else if((null===(k=e.isSecured)||void 0===k?void 0:k.isFederatedWithWebTierAuth)||401===(null===(j=e.isSecured)||void 0===j?void 0:j.httpStatusCode))try{const{title:t}=e,r=await(0,y.r)(e.url,{},{addTokenManually:!1}),i=(r.documentInfo.Keywords||"").split(","),s=[...(0,a.b)([...i,...N])];return e=Object.assign(Object.assign({},e),{extent:r.fullExtent||r.extent,serviceInfo:r}),Object.assign(Object.assign({},e),{title:t,tags:s})}catch(e){if(401===e.status)throw{code:"unauthorized"};throw{code:"serviceNotExist",message:JSON.stringify(e)}}}async function Ye(e){const{serviceInfo:t,username:r,password:a,isSecured:s,storeAuth:n,type:o}=e,{user:l,portal:c,config:u}=i.c,d=o,p={username:r,password:a},{thumbnailURL:v}=(0,g.g)(d),m=Object.assign(Object.assign({},e),{thumbnailURL:v||e.thumbnailURL});if((null==t?void 0:t.isSecure)&&!t.userInfo||(null==s?void 0:s.isOverride)&&!p||401!==(null==s?void 0:s.httpStatusCode)&&!p||n&&!p)throw new Error("invalidCredentials");if(s&&n){if(!(!c.isPortal||c.isPortal&&(0,f.h)()))throw new Error;if(m.serviceUsername=r,m.servicePassword=a,401===s.httpStatusCode){const e=await Ce(m,null==u?void 0:u.restBaseUrl).then((({id:e})=>(0,y.r)(`${l.userContentUrl}/items/${e}`,{},{},"post")));return Xe(Object.assign(Object.assign({},m),{id:e.item.id,url:e.item.url,sourceUrl:e.item.sourceUrl}),!0)}if((null==t?void 0:t.isSecure)&&!(null==t?void 0:t.userInfo))throw new Error("invalidCredentials")}return Xe(m)}async function Xe(e,t=!1){var r,a,s,n,l;const{url:c,serviceInfo:u,type:p,storeAuth:v,hybridImageServiceSetting:m,id:f}=e;let w;if(!u&&!v)throw new Error("serviceNotExist");if(v&&!u){He=15;const t=await Qe(e);return He=3,Object.assign(Object.assign({},t),{success:!0,id:f,folder:null===(r=e.folder)||void 0===r?void 0:r.title})}const b=Object.assign(Object.assign({},e),{description:(null==u?void 0:u.description)||(null===(a=null==u?void 0:u.documentInfo)||void 0===a?void 0:a.Comments)||"",accessInformation:(null==u?void 0:u.copyrightText)||(null===(s=null==u?void 0:u.documentInfo)||void 0===s?void 0:s.Credits)||"",spatialReference:V(e.serviceInfo,e.agsType)});if("map service"===(null==p?void 0:p.toLowerCase())&&b.typeKeywords.push((null==u?void 0:u.singleFusedMapCache)?"Tiled":"Dynamic"),("Image Service"===p&&"TiledImageServer"===m||function(e,t){var r,i;return(null===(r=e.toLowerCase())||void 0===r?void 0:r.includes("/imageserver"))&&(null===(i=null==t?void 0:t.capabilities)||void 0===i?void 0:i.toLowerCase().includes("tilesonly"))}(c,u))&&(b.typeKeywords=h.a.TiledImageServer.typeKeywords),"Table"===(null==u?void 0:u.type)&&(b.typeKeywords=[...b.typeKeywords,"Table","Singlelayer"]),p in{StreamServer:1,ImageServer:1,WorkspaceServer:1}?b.typeKeywords.push("Singlelayer"):((null==u?void 0:u.layers)||(null==u?void 0:u.tables))&&(u.layers&&(null===(n=null==u?void 0:u.layers)||void 0===n?void 0:n.length)||!(null==u?void 0:u.tables.length)?(w=[...u.layers||[],...u.tables||[]],b.typeKeywords.push(w.length>1?"Multilayer":"Singlelayer")):(-1===b.typeKeywords.findIndex((e=>"Table"===e))&&b.typeKeywords.push("Table"),b.typeKeywords.push(u.tables.length>1?"Multilayer":"Singlelayer"))),"sceneserver"===(null==p?void 0:p.toLowerCase())){const{layers:e}=u,t=(null===(l=null==e?void 0:e[0])||void 0===l?void 0:l.layerType)||(null==u?void 0:u.layerType);t&&b.typeKeywords.push(t)}try{const{extent:e}=await async function(e){const{extent:t}=e;return e.extent=X(await q(t)),e}(Object.assign({},b)),r=b,a=(0,g.g)(r.type);if(r.type=a.type,r.typeKeywords=[...r.typeKeywords||[],...a.typeKeywords||[]],!v){const t=X(r.extent).split(","),i=[[parseFloat(t[0]),parseFloat(t[1])],[parseFloat(t[2]),parseFloat(t[3])]];r.extent=i;const a=await Ve(r);r.thumbnailURL=a,r.thumbnailURL&&r.thumbnailToken&&(r.thumbnailURL+=`${r.thumbnailURL.indexOf("?")>-1?"&":"?"}${r.thumbnailToken}`),r.extent=X("Feature Service"===r.type||"Image Service"===r.type?e:r.extent)}return v?async function(e){const{user:t}=i.c,{exportTilesAllowed:r}=o.a,a=await We(e),s=`${t.userContentUrl}/items/${a.id}`,{item:n}=await(0,y.r)(s,{},{},"post"),l=r?e.url:n.url,c=await Qe(Object.assign(Object.assign({},e),{type:o.a.type}),l),{typeKeywords:u,thumbnailToken:p,spatialReference:v,extent:m,description:f}=c;e.id=a.id,e.typeKeywords=u,e.thumbnailToken=p,e.spatialReference=v,e.extent=m,e.description=f;try{const t=X(c.extent).split(","),r=[[parseFloat(t[0]),parseFloat(t[1])],[parseFloat(t[2]),parseFloat(t[3])]];e.extent=r;const i=await Ve(e);n.thumbnailURL=i,n.thumbnailURL&&n.thumbnailToken&&(n.thumbnailURL+=`${n.thumbnailURL.indexOf("?")>-1?"&":"?"}${n.thumbnailToken}`)}catch(e){console.error(e)}return await(0,d.u)(a.id,{thumbnailURL:n.thumbnailURL}),a}(r):t?(0,d.u)(r.id,Object.assign(Object.assign({},r),{url:r.sourceUrl})):We(r)}catch(t){if(v)throw t;return We(e)}}const Ze=["geocode.arcgis.com","geocodedev.arcgis.com","geocodeqa.arcgis.com","route.arcgis.com","routedev.arcgis.com","routeqa.arcgis.com","geoenrich.arcgis.com","geoenrichqa.arcgis.com","geoenrichddev.arcgis.com"];async function et(e,t,r,i,a=!1){const s=t.split("?")[0],n=`${r}portals/checkurl`,l=Ze.some((e=>-1!==t.indexOf(e)));if(l)return{secured:!0,isOverride:!0};{const c=!l&&t.indexOf("/VectorTileServer")>-1,u=`${n}?url=${encodeURIComponent(`${L(`${s}?f=json`)}`)}`;try{a&&await(0,y.r)(s,{},{disableIdentityLookup:!0,addTokenManually:!1});const n=await(0,y.r)(u,{},{addTokenManually:!1}),{httpStatusCode:l}=n;if(n.secured)403===l?n.secured=!1:401===l&&(n.allowStoredAuth=!1);else if(c){const a=await rt({username:e.username,password:e.password},t,{isVideoService:!1,checkAuth:i});if(o.a.exportTilesAllowed=null==a?void 0:a.exportTilesAllowed,null==a?void 0:a.exportTilesAllowed)return et(e,`${t}/exportTiles`,r,i)}return Object.assign(Object.assign({},n),{isOverride:!1})}catch(s){const{message:n,code:o}=s;return"Error checking resource"===n?a?{secured:!1,url:t,httpResponse:"",httpStatusCode:o,httpStatusMessage:n,isOverride:!1,allowStoredAuth:!1}:et(e,t,r,i,!0):"Service Proxy URL"===n?{secured:!0,url:t,httpResponse:"",httpStatusCode:o,httpStatusMessage:n,isOverride:!1,allowStoredAuth:!1,useProxy:!0}:{allowStoredAuth:!1,url:t,httpResponse:"",httpStatusCode:o,httpStatusMessage:n,isOverride:!1}}}}function tt(e,t){var r;return e.toLowerCase().indexOf("/imageserver")>-1&&"Raster"===(null==t?void 0:t.cacheType)&&-1===(null===(r=null==t?void 0:t.capabilities)||void 0===r?void 0:r.toLowerCase().indexOf("tilesonly"))}async function rt(e,t,r){var a;const s=i.c.config,[n]=await(0,v.l)([3===i.c.api?"esri/IdentityManager":"esri/identity/IdentityManager"]),{forceAddToken:o,isSecure:l,checkAuth:c}=r,{username:u,password:d}=e,p="auto",y=(0,f.b)(t),m=t.indexOf(".esri.com/server/rest/services")>-1;const g=y||m,w=Ze.some((e=>-1!==t.indexOf(e))),h={useProxy:null!==(a=null==r?void 0:r.useProxy)&&void 0!==a&&a,timeout:!1===s.isMultiTenant?6e4:5e3,addSSL:g,addTokenManually:l&&g&&!!s.isMultiTenant||o||!1,disableIdentityLookup:null};if(c){if(t=t.split("?")[0],w)return await at(t,{username:u,password:d}),ot(t,h,p);{(null==l?void 0:l.secured)&&u&&d&&(h.customToken=await it(t,{username:u,password:d}));const e=await ot(t,h,p);return e.credential=n.findCredential(t),e.credential&&n.registerToken({server:t,token:e.credential.token,userId:e.credential.userId,expires:e.credential.expires,ssl:e.credential.ssl}),e}}return h.disableIdentityLookup=!0,await ot(t,h,p)}const it=async(e,{username:t,password:r})=>{const{token:i}=await(0,y.f)((()=>at(e,{username:t,password:r})),"securedAGSToken",`${e}---${t}`,{getExpireAfterFromResult:e=>e.expireAfter});return i};async function at(e,t){const r=3===i.c.api,[a,s]=await(0,v.l)([r?"esri/IdentityManager":"esri/identity/IdentityManager",r?"esri/Credential":"esri/identity/Credential"]);if(t.username&&t.password){const r=await async function(e){const t=3===i.c.api,[r,a]=await(0,v.l)([t?"esri/IdentityManager":"esri/identity/IdentityManager",t?"esri/ServerInfo":"esri/identity/ServerInfo"]);let s=await r.findServerInfo(e);if(!s){s=new a,s.server=await r._getOrigin(e);const{authInfo:i,tokenServiceUrl:n,currentVersion:o}=await(t?nt:st)(e,r);s.tokenServiceUrl=(null==i?void 0:i.tokenServicesUrl)||(null==i?void 0:i.tokenServiceUrl)||n,s.currentVersion=o,s.hasServer=!0,r.registerServers([s])}return s}(e);if(a._checkProtocol(e,r,(e=>console.error(e))))try{const i=await a.generateToken(r,t),n=i.expires?Number(i.expires):null,o=!!i.ssl,l=new s({userId:t.username,server:r.server,token:i.token,expires:n,ssl:o,validity:r.shortLivedTokenValidity,resources:[e],scope:"server"});return-1===a.credentials.indexOf(l)&&a.credentials.push(l),{token:l.token,expireAfter:n}}catch(e){throw e.code=403,e}return null}}const st=async(e,t)=>{const r=await t._getTokenSvcUrl(e);return await r.promise},nt=async(e,t)=>t._getTokenSvcUrl(e);async function ot(e,t,r="post"){try{return await(0,y.r)(L(e),{},Object.assign({},t),r)}catch(e){throw e}}async function lt(e){var t,r;let i={};if((0,m.i)(e.type))i=await ze(e);else switch(e.type){case"OGCFeatureServer":i=await async function(e){var t,r,i,a;const{url:s}=e,n={addTokenManually:!1,headers:{accept:"application/json"}};try{const o=async(e,t)=>{var r,i,a;try{return await e()}catch(e){const s=null!==(a=null===(i=null===(r=null==e?void 0:e.message)||void 0===r?void 0:r.toLowerCase)||void 0===i?void 0:i.call(r))&&void 0!==a?a:"";if(s.includes("unexpected token")||s.includes("expected expression"))return t();throw{result:null,error:{code:"unhandledError",message:JSON.stringify(e)}}}},l=await o((()=>(0,y.r)(s,{},n,"auto",{excludeJson:!0})),(()=>(0,y.r)(s,{},n))),c=await o((()=>ke(l)),(()=>ke(l,{},!1)));return{result:Object.assign(Object.assign({},e),{extent:X(null===(a=null===(i=null===(r=null===(t=c.collections)||void 0===t?void 0:t[0])||void 0===r?void 0:r.extent)||void 0===i?void 0:i.spatial)||void 0===a?void 0:a.bbox),type:"OGCFeatureServer",serviceInfo:c,layers:c.collections}),error:null}}catch(e){return console.error("get OGC feature layer:",e),{result:null,error:{code:"unhandledError",message:JSON.stringify(e)}}}}(e);break;case"WCS":i=await Se(e);break;case"WMS":const{result:a,error:s}=await pe(e);if(s)i.error=s;else{const e=await ye(a.serviceInfo);i.result=Object.assign(Object.assign({},a),e)}break;case"WFS":i=await xe(e),i.result&&(i.result.layers=i.result.serviceInfo.layers,i.result.title=null!==(t=i.result.serviceInfo.title)&&void 0!==t?t:"",i.result.isComplex="esriGeometryComplex"===i.result.serviceInfo.isComplex);break;case"WMTS":i=await Te(e),i.result&&(i.result.layers=i.result.serviceInfo.layers,i.result.title=null!==(r=i.result.serviceInfo.title)&&void 0!==r?r:"");break;default:i={result:Object.assign({},e)}}return i}async function ct(e,t){var r,i;const a="CUSTOMDATA"===e.provider,s=Object.assign({},e),{config:n,user:o,asyncAddToDefinition:l=!0}=t,c={layers:null!==(r=s.layers)&&void 0!==r?r:[],tables:null!==(i=s.tables)&&void 0!==i?i:[]},u=JSON.stringify(c);delete s.layers,delete s.tables,delete s.initialExtent,delete s.fullExtent,delete s._ssl;const p=a?{service:JSON.stringify(s)}:{createParameters:JSON.stringify(s),targetType:"featureService"},v=a?`${n.restBaseUrl.replace("/portal/sharing/rest/","/server/admin/services/createService")}`:`${n.restBaseUrl}content/users/${o.username}/createService`,m=await(0,y.r)(v,p,{},"post");if(a){const e=`${n.restBaseUrl.replace("/portal/sharing/rest/",`/server/admin/services/${s.serviceName}.FeatureServer`)}`;try{return{createServiceResponse:{itemId:(await(0,y.r)(e,"post")).portalProperties.portalItems[0].itemID,encodedServiceURL:"",isView:!1,name:"",serviceItemId:"",serviceurl:"",size:0,success:!0,type:"",typeKeywords:[]},addToDefinitionResponse:null}}catch(e){throw console.error(e),e}}try{return await ut(u,m.encodedServiceURL,l),{createServiceResponse:m,addToDefinitionResponse:c}}catch(e){throw await(0,d.d)(m.itemId,{permanentDelete:!0},o),console.error(e),e}}async function ut(e,t,r=!0){if(e){const i=`${t.replace("rest/services","rest/admin/services")}/addToDefinition`;try{const t=await(0,y.r)(i,{addToDefinition:e,async:r},{},"post");return r?await(0,y.p)(t.statusURL||t.statusUrl):t}catch(i){throw r&&await ut(e,t,!1),i}}return null}function dt(e,t){const r=`${(0,s.g)(t)}content/items/${e.id}/data`;return(0,y.r)(r)}async function pt(e){var t,r;const i=null===(t=(await(0,p.q)({q:'title: "Esri Layer Templates" AND owner: "esri_en"',num:1})).results)||void 0===t?void 0:t[0];if(!i)return null;const a=null===(r=(await(0,y.r)(`${(0,s.g)(e)}/search`,{q:`title:"Points" group:"${i.id}" AND type:"Layer Template" -type:"Attachment"`,num:1})).results)||void 0===r?void 0:r[0];return a?dt(a,e):null}var yt=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(r[i[a]]=e[i[a]])}return r};const vt={currentVersion:10.51,hasVersionedData:!1,supportsDisconnectedEditing:!1,hasStaticData:!1,maxRecordCount:2e3,supportedQueryFormats:"JSON",supportsVCSProjection:!1,capabilities:"Query,Editing,Create,Update,Delete,Sync",description:"",copyrightText:"",allowGeometryUpdates:!0,units:"esriMeters",supportsAppend:!0,syncEnabled:!1,supportsApplyEditsWithGlobalIds:!1,editorTrackingInfo:{allowAnonymousToDelete:!0,allowAnonymousToQuery:!0,allowAnonymousToUpdate:!0,allowOthersToDelete:!1,allowOthersToQuery:!0,allowOthersToUpdate:!0,enableEditorTracking:!1,enableOwnershipAccessControl:!1},xssPreventionInfo:{xssPreventionEnabled:!0,xssPreventionRule:"InputOnly",xssInputRule:"rejectInvalid"},_ssl:!0},mt={provider:"CUSTOMDATA",extensions:[],frameworkProperties:{},datasets:[],capabilities:"Query",type:"FeatureServer",clusterName:"default",minInstancesPerNode:0,maxInstancesPerNode:0,instancesPerContainer:1,maxWaitTime:60,maxStartupTime:300,maxIdleTime:1800,maxUsageTime:600,loadBalancing:"ROUND_ROBIN",isolationLevel:"HIGH",configuredState:"STARTED",recycleInterval:24,recycleStartTime:"00:00",keepAliveInterval:1800,private:!1,isDefault:!1,maxUploadFileSize:0,allowedUploadFileTypes:"",properties:{disableCaching:"true"}},ft=async e=>{var t,r,a,s,l,p,y;const{tags:v,serviceInfo:m,typeKeywords:f,extent:g,selectedServiceInfoLayersNames:w,addFeatureLayerType:h,layerData:b}=e,{portal:S}=i.c,x=S.isPortal,O="CUSTOMDATA"===(null==m?void 0:m.provider);if(!m)throw new Error("No service info found.");try{let e;if(O)e=mt,e.serviceName=m.name||n.i.title;else{e=vt;try{e=null!==(t=await pt(S))&&void 0!==t?t:vt,e.capabilities="Query,Editing,Create,Update,Delete",e.hasStaticData=!1}catch(e){console.warn(`Could not fetch template ${JSON.stringify(e)}`)}}const I=m;let T=null!==(r=I.layers)&&void 0!==r?r:[],L=null!==(a=I.tables)&&void 0!==a?a:[];if("build"!==h&&w){const e=e=>w[e.name];T=T.filter(e),L=L.filter(e)}const{layers:P,tables:k}=ht(T,L),{layers:j,tables:M}=bt(P,k),C=Object.assign(Object.assign(Object.assign({},e),m),{name:I.name||n.i.title,layers:j,tables:M}),{cleanedCreateParameters:U,relationshipParameters:$}=wt(C);["serviceDescription","hasStaticData","maxRecordCount","supportedQueryFormats","capabilities","description","copyrightText","spatialReference","initialExtent","fullExtent","_ssl","allowGeometryUpdates","units","xssPreventionInfo"].forEach((e=>{const t=I[e];null!=t&&(U[e]=t)})),U.name=(0,u.a)(U.name),"template"===h&&(U.syncEnabled=!0,U.capabilities="Query,Editing,Create,Update,Delete,Sync");const{createServiceResponse:F}=await ct(U,{asyncAddToDefinition:!x,config:i.c.config,user:i.c.user});if(O)return{success:!0,id:F.itemId,folder:n.i.folder.id};const{itemId:R,serviceurl:E,success:N}=F,{typeKeywords:A}=(await(0,d.a)(R)).result,D=[...f,...A];m.captureGPS&&D.push("gpsMetadataEnabled");try{const e=S.defaultExtent||m.fullExtent||m.extent||g,t=e.spatialReference.wkid||e.spatialReference.wkt||"4326",r=X((e=>{const t=(e,t,r)=>e>=t&&e<=r;return t(e.ymax,-90,90)&&t(e.ymin,-90,90)&&t(e.xmax,-180,180)&&t(e.xmin,-180,180)&&e.ymax>e.ymin&&e.xmax>e.xmin})(e)?e:await q(e)),a=`https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/export?size=800,532&format=png24&bboxSR=${t}&bbox=${X(e)}&f=image`,u=n.i.folder;return(null===(l=null===(s=i.c.portal)||void 0===s?void 0:s.sourceJSON)||void 0===l?void 0:l.hasClassificationSchema)&&(o.a.classification.createdUser=i.c.user.username,o.a.classification.createdDate=Date.now()),await Promise.all([(0,d.u)(R,Object.assign(Object.assign({title:n.i.title,typeKeywords:D.join(","),tags:(null!=v?v:n.i.tags).join(","),extent:r,snippet:n.i.snippet,description:o.a.description},b?{text:JSON.stringify({layers:b.layers,tables:b.tables})}:{}),(null===(y=null===(p=i.c.portal)||void 0===p?void 0:p.sourceJSON)||void 0===y?void 0:y.hasClassificationSchema)?{classification:JSON.stringify(o.a.classification)}:{})),$.layers||$.tables?ut(JSON.stringify($),F.encodedServiceURL,!x):void 0,!(0,c.i)(u)&&(0,d.m)(R,u.id)]),(0,d.u)(R,{thumbnailURL:a}).catch(console.error),{success:N,id:R,folder:n.i.folder.id,serviceurl:E}}catch(e){throw(0,d.d)(R,{permanentDelete:!0}),console.error(e),e}}catch(e){throw console.error(e),e}},gt=async(e,t,r,i)=>{var a;const{username:n,password:l,checkAuth:c}=o.a;try{const t=e=>rt({username:n,password:l},e,{forceAddToken:r,isSecure:i,isVideoService:!1,checkAuth:c}),a=(0,s.p)(e);if(!a)return console.warn("invalid service info"),null;const{baseServerUrl:o,index:u}=a,d=await t(o),p=await Promise.all((d.layers||[]).filter((e=>null===u||e.id===u)).map((e=>t(`${o}/${e.id}`))));return{serviceInfo:d,layers:p,tables:await Promise.all((d.tables||[]).filter((e=>null===u||e.id===u)).map((e=>t(`${o}/${e.id}`))))}}catch(r){if(console.error(r),"token required"===(null===(a=r.message)||void 0===a?void 0:a.toLowerCase()))try{const{secured:r}=await et({username:n,password:l},e,t,c);return await gt(e,t,r)}catch(e){throw e}throw r}},wt=e=>{const t={},r=e=>t[e.id]=!0;e.layers.forEach(r),e.tables.forEach(r);const i=e=>t[e.relatedTableId],a=e=>({relationships:e.relationships.filter(i),id:e.id}),s=e=>{var t;return(null===(t=e.relationships)||void 0===t?void 0:t.length)>0},n={layers:e.layers.map(a).filter(s),tables:e.tables.map(a).filter(s)};0===n.layers.length&&delete n.layers,0===n.tables.length&&delete n.tables;const o=e.layers.map((e=>yt(e,["relationships"]))),l=e.tables.map((e=>yt(e,["relationships"])));return{relationshipParameters:n,cleanedCreateParameters:Object.assign(Object.assign({},e),{layers:o,tables:l})}},ht=(e,t)=>{const r=e=>Object.assign(Object.assign({},e),{indexes:(0,a.u)(e.indexes,(e=>e.name))});return{layers:e.map(r),tables:t.map(r)}},bt=(e,t)=>{let r=(0,l.c)(e,t);const i={};return r=r.map(((e,t)=>{i[e.id]=t;return Object.assign(Object.assign({},e),{id:t})})),r.forEach((e=>{var t;e.relationships=(null!==(t=e.relationships)&&void 0!==t?t:[]).map((e=>{const t=e.relatedTableId,r=i[t];return Object.assign(Object.assign({},e),{relatedTableId:r})}))})),r.reduce(((e,t)=>("Table"===t.type?e.tables.push(t):e.layers.push(t),e)),{layers:[],tables:[]})}},97018:(e,t,r)=>{r.d(t,{a:()=>s,f:()=>c,g:()=>l,s:()=>n,v:()=>o});var i=r(87382),a=r(46227);function s(e,t){const r=/(?:\.([^.]+))?$/;let i=null==e?void 0:e.replace(/^.*(\\|\/|:)/,""),s=i&&r.exec(i)[1]?r.exec(i)[1].toLowerCase():"",n="";if((null==i?void 0:i.indexOf(".rft."))>-1){const[e,t]=i.split(".rft.");s=`rft.${t}`,n=e}return i&&!n&&(n=-1===i.lastIndexOf(".")?i:i.substring(0,i.lastIndexOf("."))),n=n.replace(/\.|-/g,"_"),t&&(n=function(e){return`${e}_${(0,a.g)()}`}(n),i=`${n}.${s}`),{title:n,fileName:i,extension:s}}function n(e,t){return s(e.name,!!t)}function o(e,t){let r=e;const i=e.lastIndexOf("\\");return i>-1&&(r=r.substring(i+1,r.length)),r.replace(/\ /g,"_")===t.replace(/\ /g,"_")}function l(e){return i.a[e]?i.a[e]:i.a[Object.keys(i.a).find((t=>i.a[t].type===e))]}function c(e){if(!e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${Math.round(e/Math.pow(1024,t))} ${["B","KB","MB","GB","TB"][t]}`}},82297:(e,t,r)=>{r.d(t,{a:()=>p,b:()=>u,c:()=>o,d:()=>l,e:()=>y,f:()=>s,g:()=>d,h:()=>n,i:()=>v,q:()=>c});var i=r(57159),a=r(44508);function s(e){var t;return"ArcGISEnterpriseOnKubernetes"===(e.portalDeploymentType||(null===(t=e.sourceJSON)||void 0===t?void 0:t.portalDeploymentType))}function n(e){var t,r;return e.isPortal?"modern"===(null===(r=e.portalProperties)||void 0===r?void 0:r.homePage)||function(e){var t;return e.isPortal&&"modernOnly"===(null===(t=e.portalProperties)||void 0===t?void 0:t.homePage)}(e):"modern"===(null===(t=e.portalProperties)||void 0===t?void 0:t.homePage)||function(e){const t=new Date("June 30, 2020").getTime();return!e.isPortal&&e.created>=t}(e)}async function o(e){try{return{result:await(0,i.f)((()=>(0,i.r)(`${(0,a.g)(e)}portals/self/resources/home.page.json`)),"homePageConfig",e.id)}}catch(e){return{result:void 0}}}async function l(e){return(0,i.f)((()=>(0,i.r)(`${(0,a.g)(e)}portals/self/userDefaultSettings`)),"memberDefaults",e.id)}async function c(e={},t){return(0,i.r)(`${(0,a.g)(t)}/community/groups`,e)}const u=async(e,t)=>{var r;if(!e)return[];const s=`${(0,a.a)(null!==(r=t.restUrl)&&void 0!==r?r:t.portalUrl)}portals/self/servers`,n=await(0,i.f)((()=>(0,i.r)(s)),"selfServers",t.id);return null==n?void 0:n.servers},d=e=>p((0,a.c)(e)),p=e=>{var t;const r=`${(0,a.a)(null!==(t=(0,a.b)(e))&&void 0!==t?t:e)}info`;return(0,i.f)((()=>(0,i.r)(r,{},{addTokenManually:!1})),"portalInfo",r)};async function y(e,t){return!e.isPortal||await v(e,t)}async function v(e,t){if(!t||!e)return!1;if(!e.isPortal)return!0;const{result:r,error:a}=await(0,i.f)((()=>m(e,t)),"isPortalBackedBySDS",e.id);return!a&&r}const m=async(e,t)=>{if(e.isBackedBySDS)return{result:!0};if(!e.isPortal)return{result:!0};try{return{result:!!await f(t,e)}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)},result:!1}}},f=async(e,t)=>{var r;return(null!==(r=await u(e,t))&&void 0!==r?r:[]).filter((e=>e.isHosted))[0]}},53076:(e,t,r)=>{r.d(t,{a:()=>u,b:()=>c,c:()=>d,d:()=>s,e:()=>a,g:()=>o,r:()=>l,s:()=>n,u:()=>p});var i=r(26408);function a(e,t,r,i){!function(e,t,r){r=r||{};let i=null==r?void 0:r.expires;if("number"==typeof i){const e=new Date,t=24*i*60*60*1e3;e.setTime(Date.now()+t),i=r.expires=e}"string"!=typeof i&&(null==i?void 0:i.toUTCString)&&(r.expires=i.toUTCString());let a,s=`${e}=${encodeURIComponent(t)}`;for(a in r){s+=`; ${a}`;const e=r[a];!0!==e&&(s+=`=${e}`)}document.cookie=s}(e,i?JSON.stringify(t):t,r)}function s(e,t){const r=function(e){const t=document.cookie,r=new RegExp(`(?:^|; )${(0,i.f)(e)}=([^;]*)`),a=t.match(r);return a?decodeURIComponent(a[1]):void 0}(e);return r&&t?JSON.parse(r):r}function n(e,t,r){window.localStorage.setItem(e,r?JSON.stringify(t):t)}function o(e,t){const r=window.localStorage.getItem(e);return r&&t?JSON.parse(r):r}function l(e){window.localStorage.removeItem(e)}function c(e,t,r){window.sessionStorage.setItem(e,r?JSON.stringify(t):t)}function u(e,t){const r=window.sessionStorage.getItem(e);return r&&t?JSON.parse(r):r}function d(e){window.sessionStorage.removeItem(e)}function p(e,t,r){const i=new Date(t);i.setFullYear(t.getFullYear()+1),a(e,r,{expires:i}),r?n(e,"true",!1):l(e)}},56288:(e,t,r)=>{r.d(t,{w:()=>i});const i=(0,r(18991).c)({portal:null,user:null,i18n:null,scale:"m",api:4,nextText:null,uploadProgress:0}).state},748:(e,t,r)=>{r.d(t,{a:()=>b,b:()=>f,c:()=>m,d:()=>d,e:()=>w,f:()=>h,g:()=>y,h:()=>g,i:()=>S,j:()=>u,r:()=>c,s:()=>v,u:()=>p});var i=r(44508),a=r(4948),s=r(98034),n=r(53076),o=r(76246),l=r(87382);function c(e){return"/"===(null==e?void 0:e.slice(-1))?e.slice(0,e.length-1):e}function u(e){return e.startsWith("/")||e.startsWith("\\")?e.slice(1):e}async function d(e){var t;const r=null!==(t=null===a.c||void 0===a.c?void 0:a.c.api)&&void 0!==t?t:4,[i]=await(0,s.l)([4===r?"esri/core/urlUtils":"esri/urlUtils"]);let n=i.urlToObject(e);n.query=n.query||{};for(let e in n.query||{})n.query.hasOwnProperty(e)&&(Array.isArray(n.query[e])||(n.query[e]=n.query[e].replace(/(&lt;|&gt;|<|>|%3C|%3E)/g,"")));return n}function p(e){return(null==e?void 0:e.replace(/^.*\//,"").replace(/.[^.]*$/,""))||""}function y(e){const t=(null==e?void 0:e.replace(/^.*\//,"").replace(/\?+.*/,""))||"",r=t.replace(/^.*\./,"").toLowerCase();return l.b.includes(r)?t:""}function v(e){return["WFS","GeoJson","CSV","GeoRSS","KML","OGCFeatureServer","WMS","WMTS","WCS"].includes(e)}function m(e){const{config:t,portal:r}=a.c;let i=!1;if(!e)return!1;if((t.httpsDomains||[]).forEach((t=>{(e.indexOf(`.${t}/`)>-1||e.indexOf(`/${t}/`)>-1)&&(i=!0)})),!i){let t=r.portalHostname;t.indexOf("/")>-1&&(t=t.substring(0,t.indexOf("/"))),e.indexOf(t)>-1&&(i=!0)}return i}function f(e){if(!e)return!1;const{config:t,portal:r}=a.c,s=(0,i.g)(r),n=new URL(s).hostname,o=!1===t.isMultiTenant,l=-1!==e.indexOf(".arcgis.com/"),c=-1!==e.indexOf("//services")||-1!==e.indexOf("//tiles")||-1!==e.indexOf("//features")||-1!==e.indexOf("//locationservices"),u=r.supportsHostedServices&&-1!==e.indexOf(n)&&!o;return l&&c||!l&&u}function g(){var e;if(-1===window.location.protocol.toLowerCase().indexOf("https")){const t=(0,n.d)("esri_auth",!0);return"web"!==(null===(e=null==t?void 0:t.auth_tier)||void 0===e?void 0:e.toLowerCase())}return!0}function w(e){let t=e.toLowerCase();-1==t.indexOf("http://")&&-1==t.indexOf("https://")&&(t=(e="https://"+e).toLowerCase());let r=t.indexOf("//");r=t.indexOf("/",r+2),-1==r?t=(e+="/arcgis/rest/services").toLowerCase():r==t.length-1&&(t=(e+="arcgis/rest/services").toLowerCase());let i=t.indexOf("/arcgis",r);i==t.length-7?t=(e+="/rest/services").toLowerCase():i==t.length-8&&(t=(e+="rest/services").toLowerCase()),i=t.indexOf("/server",r),t.endsWith("/server")?t=(e+="/rest/services").toLowerCase():t.endsWith("/server/")&&(t=(e+="rest/services").toLowerCase());const a=t.indexOf("/rest/services",r),s=t.indexOf("/services",r),n=t.indexOf("/rest",r);return-1==a&&s>-1?t=(e=`${e.substring(0,s)}/rest/services${e.substring(s+9)}`).toLowerCase():-1==a&&n>-1&&(t=(e=`${e.substring(0,n)}/rest/services${e.substring(n+5)}`).toLowerCase()),t.indexOf("/rest/services"),e}const h=(e,t=!1)=>(e=c(e=e.trim()),/(http|https|ftp):\/\/?/.exec(e)||(e=`https://${e}`),!t&&"https:"!==location.protocol||!f(e)&&!m(e)||(e=e.replace("http:/","https:/")),e=e.indexOf("/dynamicLayer?")>-1?e.substring(0,e.indexOf("/dynamicLayer?")):e),b=(e,t=!1)=>{var r,a,s;if(!e)return{error:{code:"invalidUrl"}};if(S(e,t))return{error:{code:"httpWarning"}};const n=decodeURIComponent(e),l=n.replace(i.v,"").match(/((\.|\/)*(kml|kmz))/gi),c=n.replace(i.v,"").match(/((\/|\=)(wmts|wms|wfs|wcs))/gi),u=n.replace(i.v,"").match(/((\/|\=)(OGC|OGCFeatureServer))/gi),d=n.replace(i.v,"").match(/((\.|\/)*(rss))/gi),p=null===(r=n.replace(i.v,"").match(i.r))||void 0===r?void 0:r[1],y=n.replace(i.v,"").match(i.h),v=n.replace(i.v,"").match(/((\.|\/)*(csv))/gi),m=n.replace(i.v,"").match(/(\.|\/)((\$?{(z|level)})\/*(\$?{(x|col)})\/*(\$?{(y|row)}))/gi);let f=null;if(n.match(i.f))f="GeoJson";else if(!u||c||p)if(p&&!c)f=o.a[p];else if(y)f="Map Service";else if(c){const e="/"===(null==c?void 0:c[0].charAt(0))?"/":"=";f=null===(s=null===(a=null==c?void 0:c[0])||void 0===a?void 0:a.split(e)[1])||void 0===s?void 0:s.toUpperCase()}else l?f="KML":d?f="GeoRSS":v?f="CSV":m?f="Tile Layer":n.endsWith("KnowledgeGraphServer")&&(f="Knowledge Graph");else f="OGCFeatureServer";return{result:f}},S=(e,t)=>!t&&e.includes("http://")}}]);