/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-ffefcb.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-ffefcb"],{60328:(e,t,i)=>{i.r(t),i.d(t,{arcgis_attributes:()=>f});var s=i(28614),a=i(68180),l=i(18080),o=i(58325),d=i(71480),r=i(97127),n=i(50063);const c=({fieldType:e})=>e===a.f.oid||e===a.f.guid||e===a.f.globalId?(0,s.h)("calcite-icon",{scale:"s",icon:"key"}):e===a.f.integer||e===a.f.smallInteger||e===a.f.bigInteger?(0,s.h)("calcite-icon",{scale:"s",icon:"integer"}):e===a.f.single||e===a.f.double||e===a.f.long||e===a.f.number?(0,s.h)("calcite-icon",{scale:"s",icon:"number"}):e===a.f.string?(0,s.h)("calcite-icon",{scale:"s",icon:"string"}):e===a.f.date?(0,s.h)("calcite-icon",{scale:"s",icon:"date-time"}):e===a.f.dateOnly?(0,s.h)("calcite-icon",{scale:"s",icon:"calendar"}):e===a.f.timestampOffset?(0,s.h)("calcite-icon",{scale:"s",icon:"time-zone"}):e===a.f.timeOnly?(0,s.h)("calcite-icon",{scale:"s",icon:"clock"}):(0,s.h)("calcite-icon",{scale:"s",icon:"string"});const p=(e,t)=>async function(e,t){const i=await(0,d.l)(),s=[],l=new Map(t?.fieldInfos?.map((e=>[e.fieldName,e]))),o=await(0,a.g)(e);return o?.size&&(l.forEach((e=>{o.has(e.fieldName)&&(s.push(e),o.delete(e.fieldName))})),o.forEach((e=>{if(!["geometry"].includes(e.type)){const t=new i;t.fieldName=e.name,t.label=e.alias,t.visible=!1,s.push(t)}})),o.clear()),t?.expressionInfos&&t.expressionInfos?.forEach((e=>{const t=`${a.a.expression}${e.name}`;if(l.has(t))s.push(l.get(t));else{const e=new i;e.fieldName=t,e.visible=!1,s.push(e)}})),t?.fieldInfos?.forEach((e=>{e.fieldName.includes(a.a.relationship)&&s.push(e)})),await Promise.resolve(s)}(e,t),h=async(e,t,i,s)=>{try{let l,o;if(s===a.s.ogcFeature){l=await e.whenLayerView(t);const i=await(0,d.b)();await i.whenOnce((()=>!l.updating))}else if(s===a.s.stream){l=await e.whenLayerView(t);const i=await(0,d.b)();await i.whenOnce((()=>!l.updating))}else l=t;if(s===a.s.imageryTile||s===a.s.wcs){const i=e.allLayerViews.find((e=>e.layer.id===t.id)),s=await i.fetchPopupFeaturesAtLocation(t.fullExtent?.center);return s?.[0]}if(s===a.s.mapImage&&t.layer.version>=10.5&&!t.layer.capabilities?.operations?.supportsQuery&&t.layer.capabilities?.operations?.supportsIdentify){const i=await(0,a.b)(t,e);return i&&(i.sourceLayer=t),Promise.resolve(i)}const r="isTable"in t&&t.isTable,n=l.createQuery();r||(n.geometry=e.center,n.distance=e.resolution),n.outFields=["*"];const c=await l.queryFeatures(n,{signal:i.signal});if(0===c?.features?.length){const d=l.createQuery();d.geometry=e.extent,d.outFields=["*"];const r=await l.queryFeatures(d,{signal:i.signal});if(r?.features?.length>0)o=await m(r,e,t);else{const d=l.createQuery();d.where=l.definitionExpression||"1=1",d.outFields=["*"],(t.sourceJSON?.advancedQueryCapabilities?.supportsPagination||s===a.s.ogcFeature)&&(d.start=0,d.num=1),d.outSpatialReference=e.spatialReference,o=(await l.queryFeatures(d,{signal:i.signal}))?.features?.[0]}}else o=c?.features?.[0];return o&&s===a.s.imagery&&(o=await u(t,o)),Promise.resolve(o)}catch(e){return console.log(e),void await Promise.resolve(void 0)}},u=async(e,t)=>{const i=e.createQuery();i.outFields=["*"].concat(e.rasterFields.map((e=>e.name)).filter((e=>e.startsWith("Raster.")))),i.geometry=t.geometry,i.outSpatialReference=t.geometry.spatialReference;const s=await e.queryVisibleRasters(i,{returnTopmostRaster:!0,returnDomainValues:!0});return s?.[0]??t},m=async(e,t,i)=>{const s=await(0,a.c)(i);if("point"===s){let i=[void 0,void 0];for(let s=0;s<e.features.length;s++){const l=e.features[s].geometry.distance(t.center);(0===s||(0,a.i)(i?.[1]&&i[1]>l))&&(i=[e.features[s],l])}return i[0]}if("polyline"===s){let i=[void 0,void 0];const s=await(0,d.m)();for(let l=0;l<e.features.length;l++){const o=s.getNearestVertex(e.features[l].geometry,t.center).distance;(0===l||(0,a.i)(i?.[1]&&i[1]>o))&&(i=[e.features[l],o])}return i[0]}if("polygon"===s||"imagery"===(0,a.d)(i)){let i=[void 0,void 0];for(let s=0;s<e.features.length;s++){const l=e.features[s].geometry.centroid.distance(t.center);(0===s||(0,a.i)(i?.[1]&&i[1]>l))&&(i=[e.features[s],l])}return i[0]}return e.features[0]},f=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.attributesUpdated=(0,s.c)(this,"attributesUpdated",7),this.arcgisClose=(0,s.c)(this,"arcgisClose",7),this.arcgisAttributesDismissedChange=(0,s.c)(this,"arcgisAttributesDismissedChange",7),this.arcgisFieldAdded=(0,s.c)(this,"arcgisFieldAdded",7),this.arcgisAttributesFieldAdded=(0,s.c)(this,"arcgisAttributesFieldAdded",7),this.arcgisFieldDeleted=(0,s.c)(this,"arcgisFieldDeleted",7),this.arcgisAttributesFieldDeleted=(0,s.c)(this,"arcgisAttributesFieldDeleted",7),this.closeAttributePopovers=(0,s.c)(this,"closeAttributePopovers",7),this.manager=(0,r.u)(this),this.strings=(0,n.u)({blocking:!0}),this.layerFieldsMap=new Map,this.arcadeExpMap=new Map,this.popupOpenForLayer=!1,this.listItemNodes=[],this.allowFieldAdd=!1,this.debouncedAttributeUpdates=(0,o.d)((()=>{this.layerDisplayType===a.l.feature?this.layer.popupTemplate=this.popupTemplate.clone():this.layerDisplayType===a.l.cluster&&(this.layer.featureReduction.popupTemplate=this.popupTemplate.clone()),this.attributesUpdated.emit(),this.arcgisChange.emit()}),1e3),this.mapView=void 0,this.portal=void 0,this.layer=void 0,this.config=void 0,this.hidePopup=!1,this.displayPopup=!0,this.dismissible=!1,this.hideLayerTitle=!1,this.addFieldEnabled=!1,this.deleteFieldEnabled=!1,this.calciteFlowProps=!1,this.layerDisplayType=a.l.feature,this.reRender=!1,this.totalSelectedFields=0,this.lastSortBy="default",this.filterFields=void 0}async closeAttributePopoversHandler(e){if(this.attributesFormattingNode&&(this.attributesFormattingNode.parentElement?.removeChild(this.attributesFormattingNode),this.attributesFormattingNode=void 0,e.detail)){const e=this.listNode.selectedItems,t=e.find((e=>e.id===this.lastSelectedFieldName));for(const t of e.values())t.selected=!1;this.totalSelectedFields=0,this.lastSelectedFieldName=void 0,setTimeout((()=>t?t.setFocus():this.listItemNodes[0].setFocus()),300)}}async done(){this.closeAttributePopovers.emit(!0),this.showPreviewPopup(!1)}async setFocus(){this.panelNode?this.panelNode.setFocus():this.listNode?.setFocus()}async componentWillLoad(){this.displayPopup||this.hidePopup||(this.hidePopup=!0);const{mapView:e,layer:t,layerDisplayType:i}=this,s=(0,a.d)(t);if(i===a.l.feature){const l="type"in t?t.type:"sublayer",o=e.popup?.visible?e.popup.selectedFeature?.sourceLayer:void 0;this.popupOpenForLayer="subtype-sublayer"===l?o?.subtypeCode===t.subtypeCode&&o?.parent.id===t.parent.id:"sublayer"===l?o?.id===t.id&&o?.layer.id===t.layer?.id:"id"in t&&o?.id===t.id,s!==a.s.mapImage||t.popupTemplate||(t.popupEnabled=!1),this.popupTemplate=t.popupTemplate?t.popupTemplate.clone():t.createPopupTemplate(),this.popupTemplate.fieldInfos=[...await p(t,this.popupTemplate)],i===a.l.feature?t.popupTemplate=this.popupTemplate.clone():i===a.l.cluster&&(t.featureReduction.popupTemplate=this.popupTemplate.clone())}else this.popupTemplate=t.featureReduction.popupTemplate.clone();const o=window.customElements?.get("arcgis-field-add");this.allowFieldAdd=(0,a.i)(o)&&this.addFieldEnabled&&await(0,l.c)(t)}async componentWillRender(){this.layerFieldsMap=await(0,a.g)(this.layer),this.arcadeExpMap=(0,a.e)(this.popupTemplate)}componentDidLoad(){this.showPreviewPopup(!0),this.setupResizeObserver()}disconnectedCallback(){this.resizeObserver?.disconnect()}render(){const{strings:e,layer:t,hideLayerTitle:i,dismissible:a,allowFieldAdd:l,calciteFlowProps:o}=this,d=window.customElements?.get("arcgis-field-add");return(0,s.h)(s.H,{key:"c2d71f9f75db4d0d7ba90b755881fdd67fcdf701",style:o?{}:{display:"flex",flex:"1 1 auto",overflow:"hidden"}},o?(0,s.h)("div",null,this.renderList()):(0,s.h)("calcite-panel",{heading:e.attributesHeading,description:i?void 0:t.title??void 0,closable:a,ref:e=>this.panelNode=e,onCalcitePanelClose:async e=>{e.stopPropagation(),await this.done(),this.arcgisAttributesDismissedChange.emit(),this.arcgisClose.emit()}},this.renderList(),d&&l&&this.renderFieldAddFab()))}renderList(){const{strings:e}=this;this.listItemNodes=[];const t=this.getSortedFieldList().filter((e=>-1===e.fieldName?.indexOf(a.a.relationship)));return(0,s.h)("calcite-list",{label:e.attributesHeading,filterEnabled:t.length>=5,filterPlaceholder:e.searchFields,selectionMode:"multiple",onCalciteListFilter:()=>{this.filterFields=this.listNode?.filteredItems?.map((e=>e.value))??[],this.dropdownActionNode.disabled=this.filterFields.length<=2},ref:e=>this.listNode=e},this.popupTemplate.fieldInfos.length>=5?this.renderSort():(0,s.h)(s.F,null),this.totalSelectedFields>0?(0,s.h)("div",{class:"total-selected-div"},(0,s.h)("calcite-chip",{label:e.numberFieldsSelected.replace("${number}",`${this.totalSelectedFields}`),value:"selected-fields",closable:!0,onCalciteChipClose:e=>{e.stopPropagation(),this.closeAttributePopovers.emit(!0)}},e.numberFieldsSelected.replace("${number}",`${this.totalSelectedFields}`))):(0,s.h)(s.F,null),t.map((e=>this.renderListItem(e))))}renderSort(){const{strings:e}=this,t=this.popupTemplate.fieldInfos.every((e=>!!(0,a.h)(e.fieldName,this.layerFieldsMap,this.arcadeExpMap)));return(0,s.h)("calcite-dropdown",{slot:"filter-actions-end",placement:"bottom-end",overlayPositioning:"fixed"},(0,s.h)("calcite-action",{slot:"trigger",text:e.sort,title:e.sort,ref:e=>this.dropdownActionNode=e,disabled:this.allowFieldAdd&&this.filterFields&&this.filterFields.length<=2},(0,s.h)("calcite-icon",{scale:"s",icon:"sortDescending"})),(0,s.h)("calcite-dropdown-group",null,(0,s.h)("calcite-dropdown-item",{selected:"default"===this.lastSortBy,onClick:()=>this.lastSortBy="default",onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy="default")}},e.default),(0,s.h)("calcite-dropdown-item",{selected:"display"===this.lastSortBy,onClick:()=>this.lastSortBy="display",onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy="display")}},e.displayName),t&&(0,s.h)("calcite-dropdown-item",{selected:"type"===this.lastSortBy,onClick:()=>this.lastSortBy="type",onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy="type")}},e.type),(0,s.h)("calcite-dropdown-item",{selected:"field"===this.lastSortBy,onClick:()=>this.lastSortBy="field",onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy="field")}},e.fieldName)))}renderFieldAddFab(){const{strings:e}=this;return(0,s.h)("calcite-fab",{ref:e=>this.fieldAddFabNode=e,scale:"s",class:"floating-add-field-button",slot:"fab",kind:"neutral",appearance:"outline-fill","text-enabled":!0,text:e.addField,onClick:()=>{this.fieldAddFabNode.disabled=!0,this.openFieldAddModal()}})}showPreviewPopup(e){const{mapView:t,layer:i,hidePopup:s,layerDisplayType:l}=this;s||l!==a.l.feature||this.popupOpenForLayer||(e&&i.popupEnabled&&i.popupTemplate?(this.previewPopupController=new AbortController,(async(e,t,i)=>{e.closePopup();const s=(0,a.d)(t);if(s!==a.s.voxel){if(s!==a.s.scene||t?.associatedLayer){const a=await h(e,t,i,s);return a?(null!=e.popup&&"dockEnabled"in e.popup&&(e.popup.dockEnabled=!0),e.openPopup({features:[a],location:a.geometry?.extent?.center??a.geometry}),await Promise.resolve(a)):void await Promise.resolve(void 0)}await Promise.resolve(void 0)}else await Promise.resolve(void 0)})(t,i,this.previewPopupController)):(this.previewPopupController?.abort(),t.closePopup()))}setupResizeObserver(){const e=this.el?.parentElement;(0,a.i)(e.collapsed)&&(this.resizeObserver=new ResizeObserver((async()=>{e.collapsed?await this.done():this.showPreviewPopup(!0)})),this.resizeObserver.observe(e))}getSortedFieldList(){const e=[...this.popupTemplate.fieldInfos];return"display"===this.lastSortBy?e.sort(((e,t)=>(0,a.j)(e,this.arcadeExpMap).localeCompare((0,a.j)(t,this.arcadeExpMap)))):"field"===this.lastSortBy?e.sort(((e,t)=>e.fieldName.localeCompare(t.fieldName))):"type"===this.lastSortBy&&e.sort(((e,t)=>{const i=(0,a.h)(e.fieldName,this.layerFieldsMap,this.arcadeExpMap),s=(0,a.h)(t.fieldName,this.layerFieldsMap,this.arcadeExpMap);return i.localeCompare(s)})),e}renderListItem(e){return(0,s.h)("calcite-list-item",{id:e.fieldName,key:e.fieldName,label:(0,a.j)(e,this.arcadeExpMap),description:`{${e.fieldName}}`,value:e.fieldName,metadata:{label:(0,a.j)(e,this.arcadeExpMap),fieldName:e.fieldName},onClick:()=>this.handleListItemClick(e.fieldName),onKeyDown:t=>{" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),t.stopPropagation(),this.handleListItemClick(e.fieldName))},ref:e=>this.listItemNodes.push(e)},(0,s.h)("div",{slot:"actions-end",class:"field-icons"},(0,s.h)(c,{fieldType:(0,a.h)(e.fieldName,this.layerFieldsMap,this.arcadeExpMap)})))}async handleListItemClick(e){const{strings:t,mapView:i,layer:s,config:a,deleteFieldEnabled:l}=this;this.closeAttributePopovers.emit();const o=[...this.listNode.selectedItems.map((e=>e.value))];if(this.totalSelectedFields=o.length,this.lastSelectedFieldName=e,!this.attributesFormattingNode&&o.length){this.attributesFormattingNode=document.createElement("arcgis-attributes-formatting"),this.attributesFormattingNode.strings=t,this.attributesFormattingNode.config=a,this.attributesFormattingNode.popoverProps={refElement:this.el},this.attributesFormattingNode.selectedFields=o,this.attributesFormattingNode.layer=s,this.attributesFormattingNode.mapView=i,this.attributesFormattingNode.popupTemplate=this.popupTemplate.clone();const e=window.customElements?.get("arcgis-field-delete");this.attributesFormattingNode.deleteFieldEnabled=e&&l,this.attributesFormattingNode.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.popupTemplate=e.detail.clone(),this.debouncedAttributeUpdates(),this.reRender=!this.reRender})),this.attributesFormattingNode.addEventListener("arcgisClose",(e=>{e.stopPropagation(),this.closeAttributePopovers.emit(!0)})),this.attributesFormattingNode.addEventListener("arcgisFieldDeleted",(async e=>{this.attributesFormattingNode?.parentElement?.removeChild(this.attributesFormattingNode),this.attributesFormattingNode=void 0,this.popupTemplate=this.layer.popupTemplate?.clone(),this.listItemNodes.forEach((e=>{e&&(e.selected=!1)})),this.totalSelectedFields=0,this.arcgisAttributesFieldDeleted.emit(e.detail),this.arcgisFieldDeleted.emit(e.detail),this.debouncedAttributeUpdates()})),document.body.appendChild(this.attributesFormattingNode)}}openFieldAddModal(){this.fieldAddNode=document.createElement("arcgis-field-add"),this.fieldAddNode.layer=this.layer,this.fieldAddNode.addEventListener("arcgisFieldAddFieldAdded",(async e=>{const{layer:t}=this;this.layer.popupTemplate.fieldInfos=[...t.popupTemplate.fieldInfos],this.popupTemplate=this.layer.popupTemplate.clone();const i=this.layer.popupTemplate.fieldInfos.find((t=>t.fieldName===e.detail));this.popupTemplate.fieldInfos=[...await p(this.layer,this.popupTemplate),i],this.arcgisAttributesFieldAdded.emit(e.detail),this.arcgisFieldAdded.emit(e.detail),this.debouncedAttributeUpdates(),this.removeFieldAddNodes()})),this.fieldAddNode.addEventListener("arcgisWorkflowCancel",(async()=>this.removeFieldAddNodes())),document.body.appendChild(this.fieldAddNode)}removeFieldAddNodes(){this.fieldAddFabNode.disabled=!1,this.fieldAddNode?.parentElement?.childNodes.forEach((e=>{"ARCGIS-FIELD-ADD"===e.nodeName&&(this.fieldAddNode?.parentElement?.removeChild(e),this.fieldAddNode=void 0)}))}static get assetsDirs(){return["assets"]}get el(){return(0,s.g)(this)}};f.style=".total-selected-div{padding:var(--calcite-spacing-xs)}.field-icons{padding:0 var(--calcite-spacing-xl);display:flex;align-items:center}.floating-add-field-button{padding-bottom:0.5rem}"},58325:(e,t,i)=>{i.d(t,{a:()=>a,d:()=>s,t:()=>l});const s=(e,t)=>{let i,s="idle";const a=async(...a)=>await new Promise((l=>{switch(s){case"flushed":s="idle",i?(clearTimeout(i),l(e(...a))):l(null);break;case"invoked":clearTimeout(i),s="idle",l(e(...a));break;case"cancelled":clearTimeout(i),s="idle",l(null);break;default:i&&clearTimeout(i),s="pending",i=setTimeout((()=>{s="idle",l(e(...a))}),t)}}));return a.flush=async function(...e){return s="flushed",await a(...e)},a.invoke=async function(...e){return s="invoked",await a(...e)},a.cancel=async function(...e){return s="cancelled",await a(...e)},a.getStatus=function(){return s},a},a=(e,t)=>{let i;return async(...s)=>await new Promise((a=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,a(e(...s))}),t))}))};function l(e){return new Promise((t=>setTimeout(t,e)))}},50063:(e,t,i)=>{i.d(t,{u:()=>l});var s=i(97127),a=i(28614);const l=(0,s.m)(a.a)}}]);