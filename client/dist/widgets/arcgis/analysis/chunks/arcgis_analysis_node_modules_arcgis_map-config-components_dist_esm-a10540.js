/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-a10540.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-a10540"],{26451:(e,t,i)=>{i.r(t),i.d(t,{arcgis_smart_mapping_color_size_slider:()=>y,arcgis_smart_mapping_heatmap_slider:()=>C,arcgis_smart_mapping_panels_chart:()=>M,arcgis_smart_mapping_panels_color:()=>x,arcgis_smart_mapping_panels_predominance:()=>w,arcgis_smart_mapping_panels_relationship:()=>N,arcgis_smart_mapping_panels_type:()=>Et});var a=i(28614),n=i(48122),s=(i(68180),i(99592)),o=i(13898),r=i(54351),l=i(98518),d=i(66215),c=i(33101),h=i(63625),u=i(97127),p=i(39304),m=i(58325),g=i(42444),f=i(84521),S=i(78567),v=i(372),b=i(67751);i(71480),i(99818),i(80216);const y=class{constructor(e){(0,a.r)(this,e),this.arcgisSmartMappingColorSizeSliderChange=(0,a.c)(this,"arcgisSmartMappingColorSizeSliderChange",7),this.arcgisSmartMappingColorSizeSliderError=(0,a.c)(this,"arcgisSmartMappingColorSizeSliderError",7),this.manager=(0,u.u)(this),this.currentColorStopValues=[],this.currentSizeStopSizes=[],this.zigzagClick=!1,this.styleSheetStatus="not-loaded",this.smartMappingState=(0,c.u)(),this.histogramStatus=s.s.MISSING,this.statisticsStatus=s.s.MISSING,this.sliderZoomed=!1}async updateStatistics(){this.statisticsStatus=s.s.MISSING,this.statistics=void 0,this.histogramStatus=s.s.MISSING,this.histogram=void 0,this.colorSizeSlider?.destroy(),this.colorSizeSlider=void 0,this.sliderZoomed=!1,this.getStatistics()}componentWillLoad(){this.getStatistics()}componentDidLoad(){this.flowItemNode=(0,n.f)(this.el,"calcite-flow-item")}render(){const{config:e}=this.smartMappingState;return(0,a.h)(a.H,{key:"b6022cf6413ced88f703de7953f185c5bb45b3f6"},(0,a.h)("link",{key:"5f153dd1a553485462fc561f4d5f5aec12c8f4fd",rel:"stylesheet",href:`${e.jsapiUrl}/themes/light/main.css`,onLoad:()=>{this.styleSheetStatus="loaded",(0,a.f)(this.el)},onError:()=>{this.styleSheetStatus="failed",(0,a.f)(this.el)}}),"loaded"===this.styleSheetStatus?this.renderColorSizeSlider():"not-loaded"===this.styleSheetStatus?this.renderColorSizeSliderLoading():null)}renderColorSizeSlider(){const{histogramStatus:e,statistics:t,statisticsStatus:i,sliderZoomed:n,smartMappingState:o}=this,{strings:r}=o,l=(0,s.j)(o),d=l.authoringInfo,c=(0,s.b)(l,"color"),u=(0,s.b)(l,"size"),p="above-and-below"===d.univariateTheme;if(i===s.s.FAILED||i===s.s.MISSING)return this.colorSizeSlider&&(this.colorSizeSlider.destroy(),this.colorSizeSlider=void 0),(0,a.h)(a.F,null);if(i===s.s.IN_PROGRESS||e===s.s.IN_PROGRESS&&!this.colorSizeSlider)return this.renderColorSizeSliderLoading();{const e=this.prepareColorSizeSlider();let i=!1;if(c&&!n){const e=(0,s.G)(l,"color"),a=(0,h.g)(o),n=(0,s.aI)(a,e?.minSliderValue??t.min,e?.maxSliderValue??t.max);(n?.minMaxSame||!(0,s.M)(n?.min)&&!(0,s.M)(n?.max))&&(i=!0,this.zoomButtonNode&&(this.zoomButtonNode.disabled=!0))}else if(u&&!n){const e=(0,s.G)(l,"size"),a=(0,s.aI)(p?u.stops:[{value:u.minDataValue},{value:u.maxDataValue}],e?.minSliderValue??t.min,e?.maxSliderValue??t.max);(a?.minMaxSame||!(0,s.M)(a?.min)&&!(0,s.M)(a?.max))&&(i=!0,this.zoomButtonNode&&(this.zoomButtonNode.disabled=!0))}return c&&(this.currentColorStopValues=c.stops.map((e=>e.value))),u?.stops&&(this.currentSizeStopSizes=u.stops.map((e=>e.size))),(e||this.colorSizeSlider)&&this.colorSizeSlider.min!==this.colorSizeSlider.max?(0,a.h)("div",{class:"slider-box"},(0,a.h)("calcite-label",null,r.colorSizeSlider.dataRange),(0,a.h)("div",{class:"slider-box-buttons-front"},this.renderInvertButton(),u&&(0,a.h)(a.F,null,(0,a.h)("div",null,"\xa0"),this.renderZoomButton(i),(0,a.h)("div",null,"\xa0"),this.renderResetButton())),(0,a.h)("div",{ref:e=>{e&&this.afterColorSizeSliderCreate(e)}})):this.colorSizeSlider&&this.colorSizeSlider.min===this.colorSizeSlider.max?(0,a.h)(a.F,null):this.renderColorSizeSliderLoading()}}renderColorSizeSliderLoading(){const{strings:e}=this.smartMappingState;return(0,a.h)("div",{class:"slider-box"},(0,a.h)("calcite-loader",{label:e.loading}))}renderInvertButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("arcgis-smart-mapping-action",{text:e.colorSizeSlider.invertSlider,icon:"arrowUpDown",onClick:()=>this.handleInvertSlider()})}renderZoomButton(e){const{strings:t}=this.smartMappingState,{sliderZoomed:i}=this;return(0,a.h)("arcgis-smart-mapping-action",{text:t.colorSizeSlider.zoomSlider,icon:i?"magnifyingGlassMinus":"magnifyingGlassPlus",disabled:e,onClick:()=>this.handleZoomSlider(),ref:e=>{e&&(this.zoomButtonNode=e)}})}renderResetButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("arcgis-smart-mapping-action",{text:e.colorSizeSlider.resetSlider,icon:"undo",onClick:()=>this.handleResetSlider()})}prepareColorSizeSlider(){const{statistics:e,histogram:t,histogramStatus:i,sliderZoomed:a,smartMappingState:n}=this,{mapView:r,modules:c}=n,u=(0,s.j)(n),p=(0,s.a)(n),m="above-and-below"===u.authoringInfo.univariateTheme,g=["size-age","color-size-age","type-size-age"].includes(p),f=this.getFieldInfo().simpleFieldType===s.q.DATE,S=(0,s.b)(u,"color"),v=(0,s.b)(u,"size"),b=(0,s.G)(u,"size"),y=(0,s.G)(u,"color");let C,M,x;y?(C=(0,s.au)(y.theme,S.stops,!0),M=y.minSliderValue,x=y.maxSliderValue):(M=b?.minSliderValue??e.min,x=b?.maxSliderValue??e.max),({min:M,max:x}=(0,s.ag)({min:M,max:x}));const w=this.colorSizeSlider;if(this.colorSizeSlider&&(S&&w.style||!S&&!w.style)&&(this.colorSizeSlider?.destroy(),this.colorSizeSlider=void 0),i===s.s.IN_PROGRESS)return!1;if(this.colorSizeSlider){const i=this.colorSizeSlider;if("dragging"===i.slider?.state)return!0;let p={histogramConfig:{bins:t?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1},min:M??e.min,max:x??e.max};S?(p={...p,...C},p.stops=(0,h.g)(n),p.precision=(0,l.g)(p.stops),p.hasTimeData=f&&!g,f&&(0,o.a)(n,p,r.timeZone),a?this.zigzagClick||(p.zoomOptions=(0,s.aI)(S.stops,y?.minSliderValue??e.min,y?.maxSliderValue??e.max)):p.zoomOptions=null,p.histogramConfig.barCreatedFunction=t&&this.colorSliderBars&&d.b.bind(this,n,S,t,this.colorSliderBars),(0,d.u)(n,this.colorSizeSlider,this.colorSliderBars,p,t)):(p.style={trackBelowFillColor:(0,s.Z)(n,u.classBreakInfos[0].symbol)||new c.EsriColor([0,0,0,.5]),trackAboveFillColor:(0,s.Z)(n,u.classBreakInfos[1].symbol)||new c.EsriColor([0,0,0,.5])},p.stops=v.stops,p.precision=(0,l.g)(p.stops),a?this.zigzagClick||(p.zoomOptions=(0,s.aI)(m?v.stops:[{value:v.minDataValue},{value:v.maxDataValue}],b?.minSliderValue??e.min,b?.maxSliderValue??e.max)):p.zoomOptions=null),this.sliderZoomed&&this.adjustedZoomOptions&&!this.zigzagClick&&(p.zoomOptions=this.adjustedZoomOptions,"min"===this.zoomAdjustment?(this.colorSizeSlider.slider.min=p.zoomOptions.min,p.zoomOptions.min=null):(this.colorSizeSlider.slider.max=p.zoomOptions.max,p.zoomOptions.max=null)),this.adjustedZoomOptions=void 0,this.zoomAdjustment=void 0,this.colorSizeSlider.set(p),this.zigzagClick=!1}else{this.colorSliderBars=[];let i={histogramConfig:{bins:t?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1},min:M??e.min,max:x??e.max};m&&(i.primaryHandleEnabled=!0,i.persistSizeRangeEnabled=!0),f&&(i.hasTimeData=!0,(0,o.a)(n,i,r.timeZone)),S?(i={...i,...C},i.stops=(0,h.g)(n),i.precision=(0,l.g)(S.stops),i.histogramConfig.barCreatedFunction=t&&d.b.bind(this,n,i,t,this.colorSliderBars),this.colorSizeSlider=new c.ColorSizeSlider(i),this.colorSizeSlider&&this.colorSizeSlider.min===this.colorSizeSlider.max&&this.colorSizeSlider.set(i),this.colorSizeSlider&&(0,d.u)(n,this.colorSizeSlider,this.colorSliderBars)):(i.style={trackBelowFillColor:(0,s.Z)(n,u.classBreakInfos[0].symbol)||new c.EsriColor([0,0,0,.5]),trackAboveFillColor:(0,s.Z)(n,u.classBreakInfos[1].symbol)||new c.EsriColor([0,0,0,.5])},i.stops=v.stops,i.handlesSyncedToPrimary=!1,i.precision=(0,l.g)(i.stops),this.colorSizeSlider=new c.BinaryColorSizeSlider(i),this.colorSizeSlider&&this.colorSizeSlider.min===this.colorSizeSlider.max&&this.colorSizeSlider.set(i)),this.createColorSizeSliderChangeEvents()}return(0,s.M)(this.colorSizeSlider)}handleInvertSlider(){const{smartMappingState:e}=this,t=(0,s.j)(e),i=(0,s.b)(t,"color");if((0,s.B)(),i){let e=i.stops.map((e=>e.color));e=e.reverse(),i.stops.forEach(((t,i)=>{t.color=e[i]}))}else{const i=(0,s.Z)(e,t.classBreakInfos[0].symbol);(0,s.X)(e,t.classBreakInfos[0].symbol,(0,s.Z)(e,t.classBreakInfos[1].symbol)),(0,s.X)(e,t.classBreakInfos[1].symbol,i)}const n=(0,s.b)(t,"size");[n.minSize,n.maxSize]=[n.maxSize,n.minSize],(0,s.u)(e),(0,a.f)(this.el),this.arcgisSmartMappingColorSizeSliderChange.emit()}handleZoomSlider(e){const{smartMappingState:t}=this;if(this.histogramStatus===s.s.IN_PROGRESS)return;const{statistics:i}=this,a=(0,s.j)(t),n="above-and-below"===a.authoringInfo.univariateTheme;this.sliderZoomed=(0,s.M)(e)?!!e:!this.sliderZoomed;const o=(0,s.b)(a,"size");o||(this.sliderZoomed=!1);const r=(o?o.normalizationField:a.normalizationField)??void 0,l=this.getFieldInfo(),d=(0,s.G)(a,"size"),c=this.sliderZoomed?(0,s.aI)(n?o.stops:[{value:o.minDataValue},{value:o.maxDataValue}],d?.minSliderValue??i.min,d?.maxSliderValue??i.max):null,h=d?.minSliderValue===d?.maxSliderValue;this.getHistogram(l,r,i,c?.min||(h?i.min:d?.minSliderValue??i.min),c?.max||(h?i.max:d?.maxSliderValue??i.max))}handleResetSlider(){const{smartMappingState:e}=this,t=(0,s.j)(e),i=t.authoringInfo;this.sliderZoomed=!1;const n=(0,s.b)(t,"color"),o=(0,s.b)(t,"size"),l=(0,s.G)(t,"color"),d=(0,s.G)(t,"size"),c=this.getFieldInfo(),u=n?n.normalizationField:t.normalizationField;(0,r.r)((0,h.b)(e,{fieldInfos:[c],normalizationField:o.normalizationField,theme:i.univariateTheme,isContinuous:!!n,noReuse:!0,discardMinMax:!0}),this.flowItemNode).then((t=>{if(0===t.statistics?.count){const[e,i]=this.getDefaultDataRange(c),a=e,n=i;t.statistics.min=a,t.statistics.max=n,t.statistics.avg=(n+a)/2,this.statistics=t.statistics,this.statisticsStatus=s.s.SUCCESS}else t.statistics&&(0,s.M)(t.statistics.min)&&(0,s.M)(t.statistics.max)&&t.statistics.min<=t.statistics.max?(t.statistics=(0,s.ag)(t.statistics),this.statistics=t.statistics,this.statisticsStatus=s.s.SUCCESS,this.getHistogram(c,u,t.statistics,t.statistics.min,t.statistics.max)):this.statisticsStatus=s.s.FAILED;l&&(l.minSliderValue=this.statistics.min,l.maxSliderValue=this.statistics.max),d.minSliderValue=this.statistics.min,d.maxSliderValue=this.statistics.max,(0,s.u)(e),(0,a.f)(this.el)}),(e=>this.arcgisSmartMappingColorSizeSliderError.emit(e)))}afterColorSizeSliderCreate(e){if(this.colorSizeSlider.container)e.append(this.colorSizeSlider.container);else{const t=document.createElement("div");t.classList.add("slider-container"),e.append(t),this.colorSizeSlider.container=t}}getStatistics(){const{smartMappingState:e}=this,{layer:t,useFeatureReduction:i,mapView:a,modules:n}=e,o=t,r=(0,s.j)(e),l=(0,s.b)(r,"size"),d=(0,s.G)(r,"size"),c=this.getFieldInfo(),h=(l?l.normalizationField:r.normalizationField)??void 0;let u=d.minSliderValue,p=d.maxSliderValue;this.statisticsStatus=s.s.IN_PROGRESS,this.statistics||n.summaryStatistics({layer:o,view:a,field:c.field??void 0,valueExpression:c.expression??void 0,normalizationField:h,forBinning:"featureReduction"in o&&"binning"===o.featureReduction?.type&&i,outStatisticTypes:{exclude:["median"]}}).then((e=>{if(0===e.count){const[t,i]=this.getDefaultDataRange(c),a=d.minSliderValue||t,n=d.maxSliderValue||i;e.min=a,e.max=n,e.avg=(n+a)/2,(0,s.M)(d.minSliderValue)||(d.minSliderValue=a,d.maxSliderValue=n)}else if(!(0,s.M)(e.avg)||!(0,s.M)(e.min)||!(0,s.M)(e.max))return void(this.statisticsStatus=s.s.FAILED);e=(0,s.ag)(e),u=u??e.min,p=p??e.max,u===p&&(u=e.min,p=e.max),this.statistics=e,this.statisticsStatus=s.s.SUCCESS,this.getHistogram(c,h,e,u,p)}),(e=>{console.log(e),this.statisticsStatus=s.s.FAILED}))}getHistogram(e,t,i,a,n){const{layer:o,useFeatureReduction:r,mapView:l,modules:d}=this.smartMappingState,c=o;(i=i||this.statistics)&&0!==i.count&&(this.histogramStatus=s.s.IN_PROGRESS,d.histogram({layer:c,view:l,field:e.field??void 0,valueExpression:e.expression??void 0,numBins:50,minValue:(0,s.M)(a)?a:i.min??void 0,maxValue:(0,s.M)(n)?n:i.max??void 0,normalizationField:t??void 0,forBinning:"featureReduction"in c&&"binning"===c.featureReduction?.type&&r}).then((e=>{this.histogram=e,this.histogramStatus=s.s.SUCCESS}),(()=>{this.histogramStatus=s.s.FAILED})))}onMinMaxChange(e,t,i){const{smartMappingState:a}=this,n=(0,s.j)(a),o=n.authoringInfo,r="above-and-below"===o?.univariateTheme,l=(0,s.b)(n,"color"),d=(0,s.b)(n,"size");l?.stops&&(e=Math.min(e,l.stops[0].value),t=Math.max(t,l.stops[l.stops.length-1].value)),r&&(e=Math.min(e,d.stops[0].value),t=Math.max(t,d.stops[d.stops.length-1].value),d.stops.forEach(((e,t)=>{e.size=this.currentSizeStopSizes[t]}))),this.handleMinMaxChange(e,t,i)}handleMinMaxChange(e,t,i){const{statistics:a,smartMappingState:n}=this,o=(0,s.j)(n),r=(0,s.b)(o,"color"),l=(0,s.b)(o,"size"),c=(0,s.G)(o,"color")||{},h=(0,s.G)(o,"size")||{};"min"===i?(c.minSliderValue=e,h.minSliderValue=e):(c.maxSliderValue=t,h.maxSliderValue=t);const u=(0,s.aI)(r?.stops,c.minSliderValue,c.maxSliderValue);this.zoomButtonNode&&(this.sliderZoomed?this.zoomButtonNode.disabled=!1:!u||u.minMaxSame||!(0,s.M)(u.min)&&!(0,s.M)(u.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1),this.sliderZoomed&&(this.adjustedZoomOptions=this.colorSizeSlider.zoomOptions,"min"===i?(this.adjustedZoomOptions.min=e,this.zoomAdjustment="min"):(this.adjustedZoomOptions.max=t,this.zoomAdjustment="max"));const p=this.getFieldInfo(),m=l?l.normalizationField:o.normalizationField;this.getHistogram(p,m,a,e,t),(0,d.u)(n,this.colorSizeSlider,this.colorSliderBars,r,this.histogram),e===c.minSliderValue&&t===c.maxSliderValue&&(this.sliderZoomed=!1),o.authoringInfo.classificationMethod="manual",this.arcgisSmartMappingColorSizeSliderChange.emit()}createColorSizeSliderChangeEvents(){const{smartMappingState:e}=this,t=(0,s.j)(e),i=(0,s.a)(e),n=(0,s.b)(t,"size"),o=["size-age","color-size-age","type-size-age"].includes(i),r=this.getFieldInfo().simpleFieldType===s.q.DATE;this.colorSizeSlider&&(this.colorSizeSlider.watch("zoomOptions",((e,t)=>{this.sliderZoomed&&(t?.min&&!e?.min||t?.max&&!e?.max)&&(this.zigzagClick=!0,this.handleZigzagClick(e))})),this.colorSizeSlider.on("min-change",(e=>{e.value>this.currentColorStopValues[0]?(this.colorSizeSlider.stops.forEach(((e,t)=>{e.value=this.currentColorStopValues[t]})),this.onMinMaxChange(this.currentColorStopValues[0],this.colorSizeSlider.slider.max,"min")):this.onMinMaxChange(e.value,this.colorSizeSlider.slider.max,"min")})),this.colorSizeSlider.on("max-change",(e=>{e.value<this.currentColorStopValues[this.currentColorStopValues.length-1]?(this.colorSizeSlider.stops.forEach(((e,t)=>{e.value=this.currentColorStopValues[t]})),this.onMinMaxChange(this.colorSizeSlider.slider.min,this.currentColorStopValues[this.currentColorStopValues.length-1],"max")):this.onMinMaxChange(this.colorSizeSlider.slider.min,e.value,"max")})),this.colorSizeSlider.on("thumb-change",(e=>{if(n){if(r&&!o&&0===e.value)return void(0,a.f)(this.el);this.updateRendererStops(this.colorSizeSlider.stops)}})),this.colorSizeSlider.on("thumb-drag",(()=>{if(n){const e=this.colorSizeSlider.stops;this.updateRendererStops(e)}})),this.colorSizeSlider.on("segment-drag",(()=>{this.updateRendererStops(this.colorSizeSlider.stops)})))}updateRendererStops(e){const{smartMappingState:t}=this,i=(0,s.j)(t),a=(0,s.b)(i,"color"),n=(0,s.b)(i,"size"),o=(0,s.G)(i,"size"),r="above-and-below"===i.authoringInfo.univariateTheme;n.stops?n.stops.forEach(((t,i)=>{t.value=e[i].value,t.size=e[i].size,t.label=""})):(n.minDataValue=e[0].value,n.maxDataValue=e[e.length-1].value),a&&a.stops.forEach(((t,i)=>{t.value=e[i].value,t.color=e[i].color,t.label=""})),this.currentColorStopValues=e.map((e=>e.value)),this.currentSizeStopSizes=e.map((e=>e.size)),2===i.classBreakInfos.length&&(i.classBreakInfos[0].maxValue=e[2].value,i.classBreakInfos[1].minValue=e[2].value);const l=(0,s.aI)(r?n.stops:[{value:n.minDataValue},{value:n.maxDataValue}],o.minSliderValue,o.maxSliderValue);this.sliderZoomed?this.zoomButtonNode.disabled=!1:!l||l.minMaxSame||!(0,s.M)(l.min)&&!(0,s.M)(l.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1,(0,d.u)(t,this.colorSizeSlider,this.colorSliderBars),(0,s.u)(t)}getDefaultDataRange(e){if(e.simpleFieldType===s.q.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}getFieldInfo(){const{smartMappingState:e}=this,t=(0,s.j)(e),i=(0,s.b)(t,"size"),a=(0,s.o)(e,i?i.field:t.field);return{field:i?.field||t.field,expression:i?.valueExpression||t.valueExpression,expressionTitle:i?.valueExpressionTitle||t.valueExpressionTitle,simpleFieldType:a?a.simpleFieldType:s.q.NUMBER}}handleZigzagClick(e){const{statistics:t,smartMappingState:i}=this,a=(0,s.j)(i),n=(0,s.b)(a,"size"),o=(0,s.G)(a,"size"),r=this.getFieldInfo(),l=n?n.normalizationField:a.normalizationField,d=o.minSliderValue===o.maxSliderValue;this.getHistogram(r,l,t,e?.min??(d?t.min:o.minSliderValue),e?.max??(d?t.max:o.maxSliderValue)),e||(this.sliderZoomed=!1)}get el(){return(0,a.g)(this)}};y.style=".slider-box {\n  height: 320px;\n\n  .esri-color-size-slider,\n  .esri-binary-color-size-slider {\n    min-width: 200px;\n  }\n\n  .esri-color-size-slider .esri-slider .esri-slider__content,\n  .esri-binary-color-size-slider .esri-slider .esri-slider__content {\n    height: 175px;\n  }\n\n  .esri-color-size-slider__histogram-container,\n  .esri-binary-color-size-slider__histogram-container {\n    width: 85px;\n  }\n\n  .esri-color-size-slider .esri-slider .esri-slider__label,\n  .esri-color-size-slider .esri-slider .esri-slider__min,\n  .esri-color-size-slider .esri-slider .esri-slider__max,\n  .esri-binary-color-size-slider .esri-slider .esri-slider__label,\n  .esri-binary-color-size-slider .esri-slider .esri-slider__min,\n  .esri-binary-color-size-slider .esri-slider .esri-slider__max {\n    text-decoration: underline;\n  }\n\n  .esri-color-size-slider .esri-slider .esri-slider__label:hover,\n  .esri-color-size-slider .esri-slider .esri-slider__min:hover,\n  .esri-color-size-slider .esri-slider .esri-slider__max:hover,\n  .esri-binary-color-size-slider .esri-slider .esri-slider__label:hover,\n  .esri-binary-color-size-slider .esri-slider .esri-slider__min:hover,\n  .esri-binary-color-size-slider .esri-slider .esri-slider__max:hover {\n    border: 1px solid #bbb;\n    background-color: #f3f3f3;\n    text-decoration: none;\n    z-index: 1;\n  }\n}\n\n.slider-box-buttons-front {\n  display: flex;\n}\n\n.slider-container {\n  overflow: hidden;\n}\n";const C=class{constructor(e){(0,a.r)(this,e),this.manager=(0,u.u)(this),this.styleSheetStatus="not-loaded",this.smartMappingState=(0,c.u)()}render(){const{config:e}=this.smartMappingState;return(0,a.h)(a.H,{key:"6f27badeecb65eb6f292b3257e807eb589659059"},(0,a.h)("link",{key:"5a9421b909c2e5ebe8632613b3e421864cfd0c43",rel:"stylesheet",href:`${e.jsapiUrl}/themes/light/main.css`,onLoad:()=>{this.styleSheetStatus="loaded",(0,a.f)(this.el)},onError:()=>{this.styleSheetStatus="failed",(0,a.f)(this.el)}}),"loaded"===this.styleSheetStatus?this.renderHeatmapSlider():"not-loaded"===this.styleSheetStatus?this.renderHeatmapSliderLoading():null)}renderHeatmapSlider(){return this.prepareHeatmapSlider()||this.heatmapSlider?(0,a.h)("div",{class:"slider-box"},(0,a.h)("div",{ref:e=>{e&&this.afterHeatmapSliderCreate(e)}})):this.renderHeatmapSliderLoading()}renderHeatmapSliderLoading(){const{strings:e}=this.smartMappingState;return(0,a.h)("div",{class:"slider-box"},(0,a.h)("calcite-loader",{label:e.loading}))}prepareHeatmapSlider(){const{smartMappingState:e}=this,{modules:t}=e,i=(0,s.j)(e);if(this.heatmapSlider){const e=this.heatmapSlider;if("dragging"===e.slider?.state)return!0;const a=i.colorStops.map((e=>new t.HeatmapColorStop({color:new t.EsriColor(e.color.toRgba()),ratio:e.ratio}))),n={stops:a.splice(3,a.length-3)};this.heatmapSlider.set(n)}else{const e=i.colorStops.map((e=>new t.HeatmapColorStop({color:new t.EsriColor(e.color.toRgba()),ratio:e.ratio}))),a={stops:e.splice(3,e.length-3)};this.heatmapSlider=new t.HeatmapSlider(a),this.createHeatmapSliderChangeEvents()}return(0,s.M)(this.heatmapSlider)}afterHeatmapSliderCreate(e){if(this.heatmapSlider.container)e.append(this.heatmapSlider.container);else{const t=document.createElement("div");e.append(t),this.heatmapSlider.container=t}}createHeatmapSliderChangeEvents(){this.heatmapSlider&&(this.heatmapSlider.on("thumb-change",(()=>{this.handleHeatmapSliderEvent()})),this.heatmapSlider.on("thumb-drag",(()=>{this.handleHeatmapSliderEvent()})))}handleHeatmapSliderEvent(){const{smartMappingState:e}=this,{modules:t}=e,i=(0,s.j)(e),a=this.heatmapSlider.values[0],n=this.heatmapSlider.values[1];a===n&&(a+.001<=1?this.heatmapSlider.viewModel.setValue(1,a+.001):this.heatmapSlider.viewModel.setValue(0,n-.001));const o=i.colorStops.filter(((e,t)=>t<3)).map((e=>new t.HeatmapColorStop({color:new t.EsriColor(e.color.toRgba()),ratio:e.ratio}))),r=o[o.length-1].ratio;a<r&&this.heatmapSlider.viewModel.setValue(0,r);const l=o.concat(this.heatmapSlider.stops.slice());i.colorStops=l,(0,s.u)(e)}get el(){return(0,a.g)(this)}};C.style=".slider-box {\n  height: 255px;\n\n  .esri-heatmap-slider__ramp {\n    width: 30px;\n  }\n\n  .esri-heatmap-slider .esri-slider .esri-slider__content {\n    height: 175px;\n  }\n\n  .esri-heatmap-slider {\n    min-width: 200px;\n  }\n}\n";const M=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsChartBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsChartBackClick",7),this.arcgisSmartMappingPanelsChartClose=(0,a.c)(this,"arcgisSmartMappingPanelsChartClose",7),this.arcgisSmartMappingPanelsChartError=(0,a.c)(this,"arcgisSmartMappingPanelsChartError",7),this.manager=(0,u.u)(this),this.inputNodes={},this.labelNodes={},this.popoverSettings={},this.valueSymbolNodes={},this.smartMappingState=(0,c.u)(),this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{layer:e,modules:t,strings:i}=this.smartMappingState,a=(0,s.j)(this.smartMappingState);this.originalRendererJSON=a.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,a.defaultLabel||(a.defaultLabel=i.panels.chart.noData),this.smartMappingState.lastDefault={otherColor:a.othersCategory?.color,otherLabel:a.othersCategory?.label||i.panels.chart.other,threshold:a.othersCategory?.threshold,defaultColor:a.defaultColor,defaultLabel:a.defaultLabel},this.percentLabelFlip=(0,s.ay)(this.smartMappingState,this.el)}componentDidLoad(){(0,g.i)(this.el.shadowRoot,this.smartMappingState.modules.esriConfig),requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,h.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.sizeSliderWatchHandle?.remove(),this.smartMappingState.lastDefault=void 0,this.smartMappingState.selectedAttribute=void 0,this.smartMappingState.selectedValue=void 0,(0,s.ah)(),this.scaleHandle?.remove()}render(){const{hideLayerTitle:e,layer:t,mapImageSublayer:i,strings:n}=this.smartMappingState,o=e?void 0:i?.title??t.title;return(0,a.h)(a.H,{key:"1bdef01cd6b9958190609a75e754e7264144a7c2",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"4e5fa9e64f1343a467a8d55420907dcfe3a03961",class:"flow-item",closable:(0,s.C)(this.el),heading:n.panels.styleOptions,description:o,showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsChartBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderDoneButton(),this.renderCancelButton()))}renderVisualization(){const{smartMappingState:e}=this,{strings:t}=e,i="chart-size"===(0,s.a)(e);return(0,a.h)("calcite-block",{class:"chart-block",heading:i?t.panels.chart.chartStyleColor:t.panels.chart.chartStyle,open:!0,collapsible:!1},this.renderChartSymbol(),this.renderValues(),this.renderChartSize(),this.renderShape(),this.renderMinSlice(),this.renderBackgroundStyle())}renderChartSymbol(){const{smartMappingState:e}=this,{mapView:t,modules:i}=e,n=(0,s.j)(e).attributes,o=i.pieChartSchemes.getSchemes({basemap:t.map.basemap,geometryType:(0,s.A)(e),numColors:n.length}),r=(0,s.ab)(o,Math.min(n.length,10))[0].colors,l=n?.length?n.slice(0,10).map(((e,t)=>e.color?new i.EsriColor(e.color):new i.EsriColor(r[t%r.length]))):[];return(0,a.h)("arcgis-smart-mapping-symbol-button",{type:"chart-ramp",colors:l,rampType:"discrete",onArcgisSmartMappingSymbolButtonSymbolChange:()=>(0,a.f)(this.el)})}renderValues(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,s.j)(e);return(0,a.h)("calcite-label",{class:"top-padding"},t.panels.chart.fieldName,(0,a.h)("calcite-list",{class:"top-grey-border",label:t.panels.chart.fields},(0,a.h)("calcite-list",{label:"attributes","drag-enabled":!0,onCalciteListOrderChange:e=>{const t=Array.from(e.target.children);this.handleSortLegend(t)}},i.attributes.map(((e,t)=>this.renderValue(e,t)))),this.renderOtherValue(),this.renderNullValue()))}renderValue(e,t){return(0,a.h)("calcite-list-item",{key:e.field,value:e.field},this.renderSymbolNode(e,t),this.renderTextNode(e,t))}renderSymbolNode(e,t){const{smartMappingState:i}=this,{modules:n,selectedAttribute:o,strings:r}=i,l=(0,s.m)(i);l.color=new n.EsriColor(e.color),l.outline=void 0;const d={symbol:!0,"symbol-is-white":(0,s.av)(i,l)},c={"symbol-icon":!0,selected:o===t};return(0,a.h)("div",{class:d,slot:"content-start",role:"button","aria-label":r.panels.chart.accessibility.editSymbolFor.replace("${value}",e.label),"aria-haspopup":"true","aria-expanded":o===t,onClick:()=>this.handleValueSymbolClick(t),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleValueSymbolClick(t)}},(0,a.h)("div",{class:c,tabIndex:0,"aria-hidden":"true",ref:e=>{e&&(this.valueSymbolNodes[t]=e,(0,s.aJ)(i,l)?(e.style.backgroundColor="",e.style.opacity=""):(e.style.backgroundColor=l.color?.toHex()??"#ffffff",e.style.opacity=l.color?.a??0))}}))}renderOtherValue(){const{smartMappingState:e}=this,{lastDefault:t,modules:i,selectedAttribute:n,strings:o}=e,r=(0,s.j)(e),l=r.othersCategory?.color||t.otherColor,d=(0,s.m)(e);d.color=new i.EsriColor(l),d.outline=void 0;const c=r.othersCategory?.label||t.otherLabel,h={"other-symbol":!0,"symbol-is-white":(0,s.av)(e,d)},u={"symbol-icon":!0,selected:-1===n};return(0,a.h)("calcite-list-item",{class:"top-grey-border other-null-list-item"},(0,a.h)("div",{class:h,slot:"content-start",role:"button","aria-haspopup":"true","aria-expanded":-1===n,"aria-label":o.panels.chart.accessibility.editSymbolFor.replace("${fieldName}",c),onClick:()=>this.handleValueSymbolClick(-1),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleValueSymbolClick(-1)}},(0,a.h)("div",{class:u,tabIndex:0,"aria-hidden":"true",ref:t=>{t&&(this.valueSymbolNodes[-1]=t,(0,s.aJ)(e,d)?(t.style.backgroundColor="",t.style.opacity=""):(t.style.backgroundColor=d.color?.toHex()??"#ffffff",t.style.opacity=d.color?.a??0))}})),this.renderTextNode({symbol:d,label:c},-1))}renderTextNode(e,t){const{strings:i}=this.smartMappingState;return(0,a.h)(a.F,null,(0,a.h)("div",{"aria-label":i.panels.chart.accessibility.editLabelFor.replace("${fieldName}",e.label),class:"label text-wrap",slot:"content",tabIndex:0,onClick:e=>{(0,s.B)(),e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus(),this.smartMappingState.selectedValue=t},onKeyDown:e=>{(0,s.B)()," "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus(),this.smartMappingState.selectedValue=t)},ref:e=>this.labelNodes[t]=e},e.label),(0,a.h)("calcite-input",{class:"hidden",slot:"content",tabIndex:0,value:e.label,onFocusout:e=>{const i=e.target;this.handleValueTextChange(t,i.value)},onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key||"Enter"===e.key){e.preventDefault();const i=e.currentTarget;this.handleValueTextChange(t,i.value)}},ref:e=>this.inputNodes[t]=e}))}renderNullValue(){const{smartMappingState:e}=this,{lastDefault:t,modules:i,selectedAttribute:n,strings:o}=e,r=(0,s.j)(e),l=r.defaultColor||t.defaultColor,d=(0,s.m)(e);d.color=new i.EsriColor(l),d.outline=void 0;const c=r.defaultLabel||t.defaultLabel,h=(0,s.aJ)(e,d),u={"null-symbol":!0,"symbol-is-white":(0,s.av)(e,d)},p={"symbol-icon":!0,selected:-2===n};return(0,a.h)("calcite-list-item",{class:"other-null-list-item"},(0,a.h)("calcite-switch",{scale:"s",disabled:h,slot:"actions-start",class:"null-value-toggle",tabIndex:h?-1:void 0,checked:!!r.defaultColor&&!h,onClick:()=>this.handleNullValueCheckChange(),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleNullValueCheckChange()}}),(0,a.h)("div",{class:u,slot:"content-start",role:"button","aria-haspopup":"true","aria-expanded":-2===n,"aria-label":o.panels.chart.accessibility.editSymbolFor.replace("${fieldName}",c),onClick:()=>this.handleValueSymbolClick(-2),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleValueSymbolClick(-2)}},(0,a.h)("div",{class:p,tabIndex:0,"aria-hidden":"true",ref:e=>{e&&(this.valueSymbolNodes[-2]=e,h?(e.style.backgroundColor="",e.style.opacity=""):(e.style.backgroundColor=d.color?.toHex()??"#ffffff",e.style.opacity=d.color?.a??0))}})),this.renderTextNode({symbol:d,label:c},-2))}renderChartSize(){const{smartMappingState:e}=this,{mapView:t,strings:i}=e,n=(0,s.j)(e);if((0,s.b)(n,"size"))return(0,a.h)(a.F,null);const o=(0,s.b)(n,"size","auto"),r=this.getSizeValue(),l=Math.round(r/.75);return(0,a.h)(a.F,null,(0,a.h)("calcite-label",null,i.panels.chart.chartSize),(0,a.h)("arcgis-smart-mapping-slider-input",{min:10,max:120,values:[l],precision:0,suffixText:i.panels.chart.px,onArcgisSmartMappingSliderInputChange:e=>this.handleChartSizeChange(.75*e.detail)}),(0,a.h)("calcite-label",{scale:"s",layout:"inline"},(0,a.h)("calcite-checkbox",{scale:"s",checked:!!o,onCalciteCheckboxChange:e=>{this.handleAutoSizeChange(e.target.checked?"automatic":"fixed")},ref:e=>{this.adjustSizeNode=e,this.sizeSliderWatchHandle=t.watch("scale",(0,m.d)((()=>(0,a.f)(this.el)),100))}}),i.panels.chart.adjustChartSizeAutomatically))}renderShape(){const{smartMappingState:e}=this,{modules:t,strings:i}=e,n=(0,s.j)(e);if(this.shapeSlider){const e={values:[n.holePercentage??.5]};this.shapeSlider.set(e)}else{const i={min:0,max:Math.max(.9,n.holePercentage),values:[n.holePercentage??.5],precision:1};this.shapeSlider=new t.Slider(i),this.shapeSlider?.on("thumb-drag",(t=>{(0,s.j)(e).holePercentage=t.value,(0,s.u)(e)})),this.shapeSlider?.on("thumb-change",(t=>{(0,s.j)(e).holePercentage=t.value,(0,s.u)(e)}))}return(0,a.h)("div",{class:"top-padding"},(0,a.h)("calcite-label",null,i.panels.chart.shape),(0,a.h)("div",{class:"shape-slider slider-bottom-label",ref:e=>{e&&(e.style.width="100%",this.shapeSlider&&(this.shapeSlider.container=e))}}),(0,a.h)("div",{class:"slider-labels space-between","aria-hidden":"true"},(0,a.h)("calcite-label",null,i.panels.chart.pie),(0,a.h)("calcite-label",null,i.panels.chart.donut)))}renderMinSlice(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,s.j)(e),n=i.othersCategory?.threshold??.04;return(0,a.h)("div",{class:"top-padding"},(0,a.h)("div",{class:"space-between"},(0,a.h)("calcite-label",{layout:"inline"},t.panels.chart.grouping),(0,a.h)("calcite-icon",{scale:"s",icon:"information",role:"button",ref:e=>{e&&(0,s.ai)(e,`<div>${t.panels.chart.groupingInfo.replace("${other}",i.othersCategory?.label||t.panels.chart.other)}</div>`,!1)}})),(0,a.h)("arcgis-smart-mapping-slider-input",{disabled:!i.othersCategory,min:0,max:50,values:[Math.round(100*n)],precision:0,prefixText:this.percentLabelFlip?"%":void 0,suffixText:this.percentLabelFlip?void 0:"%",onArcgisSmartMappingSliderInputChange:t=>{const i=(0,s.j)(e);i.othersCategory&&(i.othersCategory.threshold=t.detail/100),(0,s.u)(e)}}))}renderBackgroundStyle(){return(0,a.h)("arcgis-smart-mapping-background-symbol",null)}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.arcgisSmartMappingPanelsChartClose.emit("save"),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,a.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{const{originalRendererJSON:t,originalFeatureReduction:i}=this;(0,s.B)(),(0,s.h)(e,t,i),this.arcgisSmartMappingPanelsChartClose.emit("cancel")},appearance:"outline-fill",width:"half"},t.cancel)}getSizeByScale(e,t){const i=e.stops,a=i.length-1,n=i[0].value,s=i[a].value;if(t<=n)return i[0].size;if(t>=s)return i[a].size;for(let e=0;e<=a;e++){const a=i[e],n=i[e+1];if(t>=a.value&&t<n.value){const e=n.value-a.value,i=a.size-n.size,s=(t-a.value)/e,o=a.size-i*s;return Math.round(100*o)/100}}return 1}getSizeValue(){const{smartMappingState:e}=this,{mapView:t}=e,i=(0,s.j)(e),a=(0,s.b)(i,"size","auto");if(a){const e=t.scale,i=a.stops;let n=0,s=!1;for(let t=0;t<i.length;t++){const a=i[t];if(e<=a.value){if(s=!0,t>0){const s=i[t-1],o=(e-s.value)/(a.value-s.value);n=s.size+(a.size-s.size)*o}else n=i[0].size;break}}return s||(n=i[i.length-1].size),n}return i.size}handleAutoSizeChange(e){const{smartMappingState:t}=this,i=(0,s.j)(t);if("fixed"===e){const e=(0,s.V)(i,"size","auto");i.visualVariables=e?.length?e:void 0,(0,s.u)(t),(0,a.f)(this.el)}else(0,r.r)((0,h.d)(t,{sizeOptimizationEnabled:!0}),this.flowItemNode).then((e=>{(0,s.u)(t,e.renderer),(0,a.f)(this.el)}),(e=>{this.adjustSizeNode.checked=!1,this.arcgisSmartMappingPanelsChartError.emit(e)}))}handleChartSizeChange(e){const{smartMappingState:t}=this,{mapView:i}=t,a=(0,s.j)(t),n=Math.max(e,.1),o=(0,s.b)(a,"size","auto");if(o){const e=n/this.getSizeByScale(o,i.scale);this.updateAutoSizeStops(o,e)}else a.size=n;(0,s.u)(t)}handleNullValueCheckChange(){const{smartMappingState:e}=this,{lastDefault:t}=e,i=(0,s.j)(e);i.defaultColor?(t.defaultColor=i.defaultColor,i.defaultColor=void 0):i.defaultColor=t.defaultColor,(0,s.u)(e),(0,a.f)(this.el)}handleSortLegend(e){const{smartMappingState:t}=this,i=(0,s.j)(t),n=i.attributes.map((e=>e.clone())),o=e.map((e=>e.value));n.sort(((e,t)=>o.indexOf(e.field)-o.indexOf(t.field))),i.attributes=n,(0,s.u)(t),(0,a.f)(this.el)}handleValueSymbolClick(e){this.popoverSettings?.popoverNode?(this.valueSymbolNodes[e].classList.remove("selected"),this.popoverSettings.index===e?((0,s.B)(),this.popoverSettings.popoverNode=void 0,this.popoverSettings.index=void 0,this.valueSymbolNodes[e].focus()):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))}handleValueTextChange(e,t){const{smartMappingState:i}=this,{lastDefault:n,modules:o,strings:r}=i,l=(0,s.j)(i),d=o.rendererJsonUtils.fromJSON(this.originalRendererJSON);if(this.inputNodes[e].classList.add("hidden"),!t.length)if(-1===e)t=d.othersCategory?.label||r.panels.chart.other;else if(-2===e)t=r.panels.chart.noData;else{const i=d.attributes.find((t=>t.field===l.attributes[e].field));t=i.label}-1===e?(l.othersCategory=l.othersCategory||{color:n?.otherColor,threshold:n?.threshold??0,label:void 0},l.othersCategory.label=t,n.otherLabel=t):-2===e?(l.defaultLabel=t,n.defaultLabel=t):l.attributes=l.attributes.map(((i,a)=>(a===e&&(i.label=t),i))),(0,s.u)(i),(0,a.f)(this.el),this.labelNodes[e].classList.remove("hidden"),this.labelNodes[e].innerHTML=t,this.inputNodes[e].value=t,setTimeout((()=>{this.smartMappingState.selectedValue===e&&(this.labelNodes[e].focus(),this.smartMappingState.selectedValue=void 0)}),300)}openSymbolStylerForValue(e){const{smartMappingState:t}=this;(0,s.B)(),this.popoverSettings.popoverNode=(0,p.c)(t,{referenceElement:this.flowItemNode,heading:t.strings.styler.symbolStyle}),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,p.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=void 0,this.valueSymbolNodes[e].classList.remove("selected"),setTimeout((()=>{this.valueSymbolNodes[e].focus()}),100)})),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{(0,p.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=void 0,this.valueSymbolNodes[e].classList.remove("selected")})),this.smartMappingState.selectedAttribute=e,(0,p.a)(t,{popoverNode:this.popoverSettings.popoverNode,onChange:()=>{(0,s.u)(t),(0,a.f)(this.el)}}),this.valueSymbolNodes[e].classList.add("selected")}updateAutoSizeStops(e,t){e.stops.forEach((e=>{e.size*=t}))}get el(){return(0,a.g)(this)}};M.style=":host {\n  width: 100%;\n  display: none;\n}\n:host([selected]) {\n  display: flex;\n}\n\n.flow-item {\n  height: 100%;\n}\n\n.chart-block {\n  overflow-x: hidden;\n}\n\n.null-value-toggle {\n  margin-left: 3.5px;\n}\n\n.hidden {\n  display: none;\n}\n\n.top-grey-border {\n  border-top: 1.5px solid #e0e0e0;\n}\n\n.top-padding {\n  margin-top: 12px;\n}\n\n.label {\n  font-size: var(--calcite-font-size--1);\n  padding-top: 5px;\n  padding-bottom: 5px;\n}\n\n.label:focus,\n.symbol-icon:focus {\n  outline: 2px solid var(--calcite-color-brand);\n}\n\n.selected {\n  outline: 1px solid var(--calcite-color-brand);\n}\n\n.other-null-list-item {\n  min-height: 45px;\n}\n\n.other-symbol {\n  margin-left: 30px;\n}\n\n.null-value-actions {\n  display: contents;\n}\n\n.null-symbol {\n  margin-left: 2.5px;\n}\n\n.shape-slider {\n  background-color: transparent;\n  position: relative;\n  width: 100%;\n  padding: 0 4px;\n}\n\n.slider-labels {\n  margin-top: 10px;\n}\n\n.space-between {\n  display: flex;\n  justify-content: space-between;\n}\n\n.symbol {\n  margin-left: 3px;\n}\n\n.symbol-icon {\n  width: 19px;\n  height: 19px;\n  margin: 2px;\n}\n\n.symbol-is-white {\n  background-color: #f3f3f3;\n}\n\n.text-wrap {\n  overflow-wrap: anywhere;\n}\n\n:dir(rtl) {\n  .null-value-toggle {\n    margin-right: 3.5px;\n    margin-left: auto;\n  }\n  .other-symbol {\n    margin-right: 30px;\n    margin-left: auto;\n  }\n  .null-symbol {\n    margin-right: 2.5px;\n    margin-left: auto;\n  }\n  .symbol {\n    margin-right: 3px;\n    margin-left: auto;\n  }\n}\n";const x=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsColorClose=(0,a.c)(this,"arcgisSmartMappingPanelsColorClose",7),this.arcgisSmartMappingPanelsColorBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsColorBackClick",7),this.arcgisSmartMappingPanelsColorError=(0,a.c)(this,"arcgisSmartMappingPanelsColorError",7),this.manager=(0,u.u)(this),this.smartMappingState=(0,c.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsColorClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,s.h)(i,e,t),this.arcgisSmartMappingPanelsColorClose.emit("cancel")},this.hideTransparency=!1,this.hideRotation=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=this.smartMappingState,i=(0,s.j)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,h.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,hideLayerTitle:t,strings:i}=this.smartMappingState;return(0,a.h)(a.H,{key:"eed7f73be61a5cd360989e4664c1d003e59cba78",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"b412984878a22229c485eda00329308534132195",heading:i.panels.styleOptions,description:t?void 0:e.title,class:"flow-item",closable:(0,s.C)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsColorBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,a.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):(0,a.h)(a.F,null)}renderCancelButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,a.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):(0,a.h)(a.F,null)}renderVisualization(){const{visualizationOpen:e,hideTransparency:t,hideRotation:i,smartMappingState:n}=this,{strings:o}=n,r=(0,s.a)(n),l=["color-age","color-age-size"].includes(r),d=(0,s.j)(n),c=(0,s.b)(d,"color"),h=c?c.field?(0,s.o)(n,c.field)?.label:c.valueExpressionTitle||o.expression:d.field?(0,s.o)(n,d.field)?.label:d.valueExpressionTitle||o.expression,u=(0,s.f)(n)[0].simpleFieldType===s.q.DATE;return(0,a.h)("calcite-block",{class:"color-block",heading:l?o.panels.color.colorAgeStyle:u?o.panels.color.colorStyleDate:o.panels.color.colorStyle,collapsible:!t||!i,open:e,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},l?null:(0,a.h)("calcite-label",{class:"attribute-name"},h),this.renderAge(),this.renderTheme(),this.renderDividedBy(),this.renderSymbol(),this.renderColorSlider(),this.renderBackgroundStyle(),this.renderDefaultSymbol(),this.renderShowInLegend(),this.renderClassify())}renderAge(){const{smartMappingState:e}=this,t=(0,s.a)(e);return["color-age","color-age-size"].includes(t)?(0,a.h)("arcgis-smart-mapping-age",{rendererSubtype:"color",onArcgisSmartMappingAgeChange:()=>{this.sliderNode.updateStatistics()},onArcgisSmartMappingAgeError:e=>this.arcgisSmartMappingPanelsColorError.emit(e.detail)}):(0,a.h)(a.F,null)}renderTheme(){const{smartMappingState:e}=this,t=(0,s.j)(e);if(!(0,s.b)(t,"color"))return(0,a.h)(a.F,null);const i=(0,s.a)(e);return(0,a.h)("arcgis-smart-mapping-theme-button",{ref:e=>this.themeButtonNode=e,rendererSubtype:"color",onArcgisSmartMappingThemeButtonBeforeOpen:()=>(0,s.B)(),onArcgisSmartMappingThemeButtonChange:t=>{let n=f.b;["color-age","color-age-size"].includes(i)&&(n=f.d),(0,r.r)(n(e,{theme:t.detail,discardMinMax:!0}),this.flowItemNode).then((t=>{const i=(0,s.j)(e);i.visualVariables=(0,s.V)(i,"color")||[],i.visualVariables.push((0,s.b)(t.renderer,"color")),i.authoringInfo.visualVariables=(0,s.W)(i,"color")||[],i.authoringInfo.visualVariables.push((0,s.G)(t.renderer,"color")),(0,s.u)(e),(0,a.f)(this.el),this.themeButtonNode&&(0,a.f)(this.themeButtonNode),this.classifyNode&&(0,a.f)(this.classifyNode),this.sliderNode&&((0,a.f)(this.sliderNode),this.sliderNode.updateStatistics())}),(e=>{(0,a.f)(this.themeButtonNode),this.arcgisSmartMappingPanelsColorError.emit(e)}))}})}renderDividedBy(){const{smartMappingState:e}=this,{fields:t}=e,i=(0,s.j)(e),n=(0,s.a)(e);if(["color-age","color-age-size"].includes(n))return(0,a.h)(a.F,null);if((0,s.F)(e,t).number<2)return(0,a.h)(a.F,null);const o=(0,s.b)(i,"color");if(o){const t=(0,s.o)(e,o.field),i={field:o.field,expression:o.valueExpression,expressionTitle:o.valueExpressionTitle,simpleFieldType:t?t.simpleFieldType:s.q.NUMBER};if(i.expression||i.simpleFieldType!==s.q.NUMBER)return(0,a.h)(a.F,null)}else if(i.valueExpression)return(0,a.h)(a.F,null);return(0,a.h)("arcgis-smart-mapping-divided-by",{rendererSubtype:"color",normalizationField:(o?o.normalizationField:i.normalizationField)??void 0,onArcgisSmartMappingDividedByChange:()=>{(0,a.f)(this.el),this.sliderNode.updateStatistics(),this.classifyNode&&(0,a.f)(this.classifyNode)},onArcgisSmartMappingDividedByError:e=>this.arcgisSmartMappingPanelsColorError.emit(e.detail)})}renderSymbol(){const{smartMappingState:e}=this,t=(0,s.j)(e),i=(0,s.b)(t,"color"),n=t.classBreakInfos,o=n[0].symbol;let r;return i?r=i.stops.map((e=>{const t=e.color.clone();return t.a=1,t})):n?.length&&(r=n.map((t=>(0,s.Z)(e,t.symbol)))),(0,a.h)("arcgis-smart-mapping-symbol-button",{symbol:o,colors:r,type:"color-ramp",rampType:i?"continuous":"discrete",ref:e=>{e&&(this.symbolButtonNode=e)},onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,a.f)(this.el),this.sliderNode&&(0,a.f)(this.sliderNode),this.classifyNode&&(0,a.f)(this.classifyNode),this.rotationNode&&(0,a.f)(this.rotationNode)}})}renderColorSlider(){return(0,a.h)("arcgis-smart-mapping-color-slider",{ref:e=>{e&&(this.sliderNode=e)},onArcgisSmartMappingColorSliderChange:()=>{(0,a.f)(this.el),this.sliderNode&&(0,a.f)(this.sliderNode),this.classifyNode&&(0,a.f)(this.classifyNode),this.rotationNode&&(0,a.f)(this.rotationNode)},onArcgisSmartMappingColorSliderError:e=>this.arcgisSmartMappingPanelsColorError.emit(e.detail)})}renderBackgroundStyle(){const{smartMappingState:e}=this,t=(0,s.a)(e);return(0,s.z)(e)&&["color-size"].includes(t)?(0,a.h)("arcgis-smart-mapping-background-symbol",null):(0,a.h)(a.F,null)}renderDefaultSymbol(){return(0,a.h)("arcgis-smart-mapping-default-symbol",{ref:e=>{e&&(this.defaultSymbolNode=e)},onArcgisSmartMappingDefaultSymbolBeforeToggle:()=>(0,s.B)(),onArcgisSmartMappingDefaultSymbolChange:()=>(0,a.f)(this.symbolButtonNode)})}renderShowInLegend(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,s.j)(e),n=(0,s.b)(i,"color");if(!n)return(0,a.h)(a.F,null);const o=n.legendOptions,r=!o||!1!==o.showLegend;return(0,a.h)("calcite-label",{class:"legend-toggle-padding",layout:"inline-space-between"},t.panels.color.includeInLegend,(0,a.h)("calcite-switch",{scale:"s",checked:r,onCalciteSwitchChange:()=>this.handleIncludeInLegendToggle()}))}renderClassify(){const{smartMappingState:e}=this,t=(0,s.j)(e),i=(0,s.a)(e),n=(0,s.f)(e)[0].simpleFieldType===s.q.DATE,o=["color-age","color-age-size"].includes(i);if("color"!==i||n||o)return(0,a.h)(a.F,null);const r=t.classBreakInfos;return(0,a.h)("arcgis-smart-mapping-classify",{ref:e=>this.classifyNode=e,onArcgisSmartMappingClassifyChange:t=>{const i=t.detail;(i?.closePopovers||i?.classesChange)&&(0,s.B)(),(i?.classesChange||i?.symbolChange)&&(this.symbolButtonNode.colors=r.map((t=>(0,s.Z)(e,t.symbol)))),(0,a.f)(this.el),(0,a.f)(this.sliderNode),(i?.toggle||!i?.symbolChange&&!i?.closePopovers)&&this.sliderNode.updateStatistics(),this.classifyNode&&(0,a.f)(this.classifyNode),this.symbolButtonNode&&(0,a.f)(this.symbolButtonNode),this.defaultSymbolNode&&(0,a.f)(this.defaultSymbolNode)},onArcgisSmartMappingClassifyError:e=>this.arcgisSmartMappingPanelsColorError.emit(e.detail)})}renderTransparency(){const{hideTransparency:e,smartMappingState:t}=this;if(e)return(0,a.h)(a.F,null);const i=(0,s.j)(t),n=(0,s.b)(i,"opacity");return(0,a.h)("arcgis-smart-mapping-transparency",{open:!!n,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsColorError.emit(e)})}renderRotation(){const{hideRotation:e,smartMappingState:t}=this;if(e)return(0,a.h)(a.F,null);const i=(0,s.j)(t),n=(0,s.b)(i,"opacity"),o=(0,s.b)(i,"rotation");return(0,a.h)("arcgis-smart-mapping-rotation",{open:!n&&!!o,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsColorError.emit(e)})}handleIncludeInLegendToggle(){const{smartMappingState:e}=this,t=(0,s.j)(e),i=(0,s.b)(t,"color"),a=i.legendOptions;a&&!1===a.showLegend?a.title?a.showLegend=!0:i.legendOptions=void 0:(i.legendOptions=a||{},i.legendOptions.showLegend=!1),(0,s.u)(e)}get el(){return(0,a.g)(this)}};x.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.color-block{overflow-x:hidden}.attribute-name{word-break:break-all}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";const w=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsPredominanceBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsPredominanceBackClick",7),this.arcgisSmartMappingPanelsPredominanceClose=(0,a.c)(this,"arcgisSmartMappingPanelsPredominanceClose",7),this.arcgisSmartMappingPanelsPredominanceError=(0,a.c)(this,"arcgisSmartMappingPanelsPredominanceError",7),this.manager=(0,u.u)(this),this.valueSymbolNodes={},this.labelNodes={},this.inputNodes={},this.maxCountOtherValues=200,this.popoverSettings={},this.smartMappingState=(0,c.u)(),this.handleDone=()=>{(0,s.B)(),this.arcgisSmartMappingPanelsPredominanceClose.emit("save")},this.hideRotation=!1,this.hideTransparency=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){const{layer:e,modules:t,strings:i}=this.smartMappingState,a=e,n=(0,s.j)(this.smartMappingState);return this.smartMappingState.lastDefault={defaultSymbol:n.defaultSymbol||(0,s.m)(this.smartMappingState),defaultLabel:n.defaultLabel||i.panels.predominance.other},this.originalRendererJSON=n.toJSON(),this.originalFeatureReduction="featureReduction"in a&&a.featureReduction?t.esriLang.clone(a.featureReduction):void 0,this.originalOrderBy="knowledge-graph-sublayer"!==a.type?a.orderBy??void 0:void 0,this.visualizationOpen=!0,await new Promise(((e,t)=>{(0,S.g)(this.smartMappingState,{fieldInfos:n.uniqueValueGroups[0].classes.map((e=>({field:e.values[0].value,simpleFieldType:s.q.NUMBER})))}).then((t=>{this.predominantCategoryInfos=t.predominantCategoryInfos,e(t.predominantCategoryInfos)})).catch((e=>{this.arcgisSmartMappingPanelsPredominanceError.emit({message:e,type:"error"}),t(new Error(e))}))}))}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,h.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.smartMappingState.lastDefault=void 0,this.smartMappingState.selectedValue=void 0,this.scaleHandle?.remove()}render(){const{hideLayerTitle:e,layer:t,mapImageSublayer:i,strings:n}=this.smartMappingState,o=e?void 0:i?.title??t.title;return(0,a.h)(a.H,{key:"661507b157b2665da724eea9f6f351a19e0af38a",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"9a8a581ae9f5f85ad6b86996f23687083848b83f",class:"flow-item",heading:n.panels.predominance.styleOptions,description:o,closable:(0,s.C)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsPredominanceBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderTransparency(),this.renderRotation(),this.renderDone(),this.renderCancel()))}renderVisualization(){const{strings:e}=this.smartMappingState,t=!this.hideTransparency||!this.hideRotation;return(0,a.h)("calcite-block",{class:"predominance-block",heading:e.panels.predominance.predominanceStyle,collapsible:t,open:this.visualizationOpen,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},this.renderPredominanceSymbol(),this.renderDrawingOrder(),this.renderValues(),this.renderMsg(),this.renderBackgroundStyle())}renderPredominanceSymbol(){const{smartMappingState:e}=this,{mapView:t,modules:i}=e,n=(0,s.j)(e).uniqueValueGroups[0].classes,o=i.predominanceSchemes.getSchemes({basemap:t.map.basemap,geometryType:(0,s.A)(e),numColors:n.length}),r=(0,s.ab)(o,Math.min(n.length,10))[0].colors,l=n?.length?n.slice(0,10).map(((t,a)=>(0,s.Z)(e,t.symbol)||new i.EsriColor(r[a%r.length]))):[];return(0,a.h)("arcgis-smart-mapping-symbol-button",{type:"predominance-ramp",colors:l,rampType:"discrete",popoverReferenceElement:this.flowItemNode,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,a.f)(this.el),this.rotationNode&&(0,a.f)(this.rotationNode)}})}renderDrawingOrder(){const{smartMappingState:e}=this,{layer:t,mapImageSublayer:i,strings:n}=e;if(i||"catalog-footprint"===t.type||"knowledge-graph-sublayer"===t.type)return(0,a.h)(a.F,null);const o=(0,s.j)(e);return(0,a.h)("calcite-label",{layout:"inline-space-between"},n.panels.predominance.drawingOrder,(0,a.h)("calcite-switch",{scale:"s",checked:o.orderByClassesEnabled,onCalciteSwitchChange:t=>{const i=t.target;(0,s.B)();const a=e.layer;(0,s.j)(e).orderByClassesEnabled=i.checked,i.checked?a.orderBy=void 0:a.orderBy=this.originalOrderBy,(0,s.u)(e)}}))}renderValues(){const{smartMappingState:e}=this,{lastDefault:t,strings:i}=e,n=(0,s.j)(e),o=n.defaultLabel||t.defaultLabel;return(0,a.h)(a.F,null,(0,a.h)("calcite-label",null,i.panels.predominance.fieldName),(0,a.h)("calcite-list",{label:i.panels.predominance.fieldName,class:"top-grey-border","drag-enabled":!0,onCalciteListOrderChange:e=>{const t=Array.from(e.target.children);this.handleSortValues(t)}},n.uniqueValueGroups[0].classes.map(((e,t)=>this.renderValue(e,t)))),(0,a.h)("calcite-list",{label:o},this.renderDefaultValue()))}renderValue(e,t){return(0,a.h)("calcite-list-item",{value:e.values[0].value,key:`values-${e.values[0].value}`,"sort-values":e.values[0].value},this.renderSymbolNode(e,t),this.renderTextNode(e,t),this.renderCountNode(e))}renderSymbolNode(e,t){const{smartMappingState:i}=this,{selectedValue:n,strings:o}=i,r={"default-symbol":-1===t,symbol:t>-1,"symbol-is-white":(0,s.av)(i,e.symbol)};return(0,a.h)("div",{class:r,slot:"content-start",onClick:()=>this.handleValueSymbolClick(t),role:"button",tabIndex:0,"aria-label":o.panels.predominance.accessibility.editSymbolFor.replace("${value}",e.label),"aria-haspopup":"true","aria-expanded":n===t,onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(t))},ref:e=>{e&&(t>-1?this.valueSymbolNodes[t]=e:this.defaultSymbolNode=e,this.createValueSymbol(t,e))}})}renderTextNode(e,t){const{strings:i}=this.smartMappingState;return(0,a.h)(a.F,null,(0,a.h)("div",{"aria-label":i.panels.predominance.accessibility.editLabelFor.replace("${fieldName}",e.label),class:"label text-wrap",slot:"content",tabIndex:0,onClick:e=>{this.smartMappingState.selectedValue=t,e.target.classList.add("hidden");const i=-1===t?this.defaultInputNode:this.inputNodes[t];i.classList.remove("hidden"),i.setFocus()},onKeyDown:e=>{if(" "===e.key||"Enter"===e.key){e.preventDefault(),e.stopPropagation(),this.smartMappingState.selectedValue=t,e.target.classList.add("hidden");const i=-1===t?this.defaultInputNode:this.inputNodes[t];i.classList.remove("hidden"),i.setFocus()}},ref:e=>{t>-1?this.labelNodes[t]=e:this.defaultLabelNode=e}},e.label),(0,a.h)("calcite-input",{class:"hidden",slot:"content",value:e.label??void 0,onFocusout:e=>{const i=e.target;this.handleValueTextChange(t,i.value)},onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key||"Enter"===e.key){e.preventDefault();const i=e.currentTarget;this.handleValueTextChange(t,i.value)}},ref:e=>{t>-1?this.inputNodes[t]=e:this.defaultInputNode=e}}))}renderCountNode(e){const{strings:t}=this.smartMappingState,i=this.getPredominantCategoryValue(e.values[0].value);return i&&(0,s.M)(i.count)?(0,a.h)("div",{slot:"content-end",class:"value-count","aria-label":t.panels.predominance.accessibility.countFor.replace("${value}",e.label)},`${i.count}`):(0,a.h)(a.F,null)}renderDefaultValue(){const{smartMappingState:e}=this,{lastDefault:t,strings:i}=e,n=(0,s.j)(e),o=n.defaultSymbol||t.defaultSymbol,r=n.defaultLabel||t.defaultLabel,l=this.getPredominantCategoryValue();return(0,a.h)("calcite-list-item",{class:"top-grey-border"},(0,a.h)("calcite-switch",{class:"default-value-toggle",scale:"s",slot:"actions-start",checked:!!n.defaultSymbol,onClick:()=>{n.defaultSymbol?n.defaultSymbol=void 0:(n.defaultSymbol=t.defaultSymbol,n.defaultLabel=t.defaultLabel),(0,s.u)(e),(0,a.f)(this.el)},onKeyDown:i=>{" "!==i.key&&"Enter"!==i.key||(n.defaultSymbol?n.defaultSymbol=void 0:(n.defaultSymbol=t.defaultSymbol,n.defaultLabel=t.defaultLabel),(0,s.u)(e),(0,a.f)(this.el))}}),this.renderSymbolNode(r,-1),this.renderTextNode({symbol:o,label:r},-1),(0,a.h)("div",{slot:"content-end","aria-label":i.panels.predominance.accessibility.countFor.replace("${value}",r)},`${l&&(0,s.M)(l.count)?l.count:0}`))}renderMsg(){const{smartMappingState:e}=this,{lastDefault:t,strings:i}=e,n=(0,s.j)(e);return n.uniqueValueGroups[0].classes&&n.uniqueValueGroups[0].classes.length>this.maxCountOtherValues?(0,a.h)("div",null,i.panels.predominance.tooManyValues.replace("${count}",this.maxCountOtherValues.toString())):n.uniqueValueGroups[0].classes.length?(0,a.h)(a.F,null):(0,a.h)("div",null,i.panels.predominance.noFeatures.replace("${other}",t.defaultLabel))}renderBackgroundStyle(){const{smartMappingState:e}=this,{mapImageSublayer:t}=e;return"predominance-size"!==(0,s.a)(e)||t?(0,a.h)(a.F,null):(0,a.h)("arcgis-smart-mapping-background-symbol",null)}renderTransparency(){const{smartMappingState:e}=this;if(this.hideTransparency)return(0,a.h)(a.F,null);const t=(0,s.b)((0,s.j)(e),"opacity");return(0,a.h)("arcgis-smart-mapping-transparency",{open:!!t,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsPredominanceError.emit(e)})}renderRotation(){const{smartMappingState:e}=this;if(this.hideRotation)return(0,a.h)(a.F,null);const t=(0,s.b)((0,s.j)(e),"opacity"),i=(0,s.b)((0,s.j)(e),"rotation");return(0,a.h)("arcgis-smart-mapping-rotation",{open:!t&&!!i,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsPredominanceError.emit(e),ref:e=>this.rotationNode=e})}renderDone(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancel(){const{smartMappingState:e}=this,{strings:t}=e;return(0,a.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{const{originalRendererJSON:t,originalFeatureReduction:i,originalOrderBy:a}=this;e.layer.orderBy=a,(0,s.B)(),(0,s.h)(e,t,i),this.arcgisSmartMappingPanelsPredominanceClose.emit("cancel")},appearance:"outline-fill",width:"half"},t.cancel)}async createValueSymbol(e,t){const{smartMappingState:i}=this,{lastDefault:a,modules:n}=i,o=(0,s.j)(i);let r;for(r=-1===e?o.defaultSymbol||a.defaultSymbol:o.uniqueValueGroups[0].classes[e].symbol.clone();t?.childNodes?.length;)t.removeChild(t.childNodes[0]);if(r){const e=await n.symbolUtils.renderPreviewHTML(r,{size:(0,s.aw)(r),symbolConfig:"cim"===r.type&&"CIMPolygonSymbol"===r.data.symbol.type?{isSquareFill:!0}:void 0});t.appendChild(e)}}getPredominantCategoryValue(e){if(!this.predominantCategoryInfos)return;const t=this.predominantCategoryInfos.filter((t=>t.value==e));return t?.length?t[0]:void 0}handleSortValues(e){const{smartMappingState:t}=this,{modules:i}=t;(0,s.B)();const n=e.map((e=>e.value)),o=(0,s.j)(t),r=o.uniqueValueGroups[0].classes.filter((e=>n.includes(`${e.values[0].value}`))).map((e=>i.esriLang.clone(e)));r.sort(((e,t)=>n.indexOf(e.values[0].value)-n.indexOf(t.values[0].value))),o.uniqueValueGroups[0].classes=r,(0,s.u)(t),(0,a.f)(this.el)}handleValueSymbolClick(e){if(this.popoverSettings?.popoverNode){(-1===e?this.defaultSymbolNode:this.valueSymbolNodes[e]).classList.remove("selected"),this.popoverSettings.index===e?((0,s.B)(),this.popoverSettings.popoverNode=void 0,this.popoverSettings.index=void 0):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))}else this.popoverSettings.index=e,this.openSymbolStylerForValue(e)}handleValueTextChange(e,t){const{smartMappingState:i}=this,{lastDefault:a,modules:n,strings:o}=i,r=(0,s.j)(i),l=n.rendererJsonUtils.fromJSON(this.originalRendererJSON);if(!t.length)if(-1===e)t=l.defaultLabel||o.panels.predominance.other;else{t=l.uniqueValueGroups[0].classes.find((t=>t.values[0].value===r.uniqueValueGroups[0].classes[e].values[0].value)).label}-1===e?(r.defaultLabel=t,a.defaultLabel=t):r.uniqueValueGroups[0].classes[e].label=t,(0,s.u)(i);const d=-1===e?this.defaultInputNode:this.inputNodes[e];d.classList.add("hidden");const c=-1===e?this.defaultLabelNode:this.labelNodes[e];c.classList.remove("hidden"),c.innerHTML=t,d.value=t,setTimeout((()=>{e===i.selectedValue&&(c.focus(),this.smartMappingState.selectedValue=void 0)}),300)}openSymbolStylerForValue(e){const{smartMappingState:t}=this;(0,s.B)();const i=-1===e?this.defaultSymbolNode:this.valueSymbolNodes[e];this.popoverSettings.popoverNode=(0,p.c)(t,{referenceElement:this.flowItemNode,heading:t.strings.styler.symbolStyle}),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,p.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=void 0,setTimeout((()=>i.focus()),300),i.classList.remove("selected")})),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{(0,p.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=void 0,i.classList.remove("selected")})),this.smartMappingState.selectedValue=e,(0,p.d)(t,{popoverNode:this.popoverSettings.popoverNode,onChange:()=>{(0,s.u)(t),(0,a.f)(this.el),this.rotationNode&&(0,a.f)(this.rotationNode)}}),i.classList.add("selected")}get el(){return(0,a.g)(this)}};w.style=":host {\n  width: 100%;\n  display: none;\n}\n:host([selected]) {\n  display: flex;\n}\n\n.flow-item {\n  height: 100%;\n}\n\n.predominance-block {\n  overflow-x: hidden;\n}\n\n.default-value-toggle {\n  margin-left: 3.5px;\n}\n\n.default-symbol {\n  min-width: 26px;\n  display: flex;\n  margin-left: 2.5px;\n}\n\n.hidden {\n  display: none;\n}\n\n.label {\n  font-size: var(--calcite-font-size--1);\n  padding-top: 5px;\n  padding-bottom: 5px;\n}\n\n.label:focus,\n.symbol:focus {\n  outline: 2px solid var(--calcite-color-brand);\n}\n\n.selected {\n  outline: 1px solid var(--calcite-color-brand);\n}\n\n.symbol {\n  min-width: 26px;\n  display: flex;\n  margin-left: 3px;\n}\n\n.symbol div,\n.default-symbol div {\n  margin: auto;\n}\n\n.symbol-is-white {\n  background-color: #f3f3f3;\n}\n\n.text-wrap {\n  overflow-wrap: anywhere;\n}\n\n.top-grey-border {\n  border-top: 1px solid #e0e0e0;\n}\n\n.list-item-top-grey-border {\n  border-top: 1.5px solid #e0e0e0;\n}\n\n:dir(rtl) {\n  .default-value-toggle {\n    margin-right: 3.5px;\n    margin-left: auto;\n  }\n\n  .default-symbol {\n    margin-right: 2.5px;\n    margin-left: auto;\n  }\n\n  .symbol {\n    margin-right: 3px;\n    margin-left: auto;\n  }\n}\n";const N=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsRelationshipClose=(0,a.c)(this,"arcgisSmartMappingPanelsRelationshipClose",7),this.arcgisSmartMappingPanelsRelationshipBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsRelationshipBackClick",7),this.arcgisSmartMappingPanelsRelationshipError=(0,a.c)(this,"arcgisSmartMappingPanelsRelationshipError",7),this.manager=(0,u.u)(this),this.colorSliderNodes=[],this.smartMappingState=(0,c.u)(),this.hideTransparency=!1,this.hideRotation=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=this.smartMappingState,i=(0,s.j)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,h.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,hideLayerTitle:t,mapImageSublayer:i,strings:n}=this.smartMappingState,o=t?void 0:i?.title??e.title;return(0,a.h)(a.H,{key:"7cd42bb4c70a6df9474b0ea3cb365a54a2d15b12",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"c9560c219be6d484956c33ca0781362bf30cfe91",heading:n.panels.styleOptions,description:o,class:"flow-item",closable:(0,s.C)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:()=>this.handleDone(),onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsRelationshipBackClick.emit()},ref:e=>{e&&(this.flowItemNode=e)}},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderLegend(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.handleDone(),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>this.handleCancel(),appearance:"outline-fill",width:"half"},e.cancel)}renderVisualization(){const{visualizationOpen:e,hideTransparency:t,hideRotation:i}=this,{strings:n}=this.smartMappingState;return(0,a.h)("calcite-block",{class:"relationship-block",heading:n.panels.relationship.relationshipStyle,collapsible:!t||!i,open:e,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},this.renderSymbol(),this.renderGridSize(),this.renderMethod(),this.renderField1(),this.renderField2(),this.renderBackgroundStyle(),this.renderDefaultSymbol())}renderSymbol(){const{smartMappingState:e}=this,{mapView:t,modules:i}=e,n=(0,s.j)(e).uniqueValueInfos??[];if(!n.length)return(0,a.h)(a.F,null);const o=i.relationshipSchemes.getSchemes({basemap:t.map.basemap,geometryType:(0,s.A)(e)}),r=(0,s.ab)(o,Math.min(n.length,10))[0].colors,l=(n?.length?n.filter(((e,t)=>t<10)).map(((t,a)=>(0,s.Z)(e,t.symbol)||new i.EsriColor(r[a%r.length]))):[]).reverse();return(0,a.h)("arcgis-smart-mapping-symbol-button",{colors:l,type:"relationship-ramp",rampType:"discrete",onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,a.f)(this.el),this.colorSliderNodes[0]&&(0,a.f)(this.colorSliderNodes[0]),this.colorSliderNodes[1]&&(0,a.f)(this.colorSliderNodes[1]),(0,a.f)(this.legendNode),this.rotationNode&&(0,a.f)(this.rotationNode)}})}renderGridSize(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,s.j)(e).authoringInfo.numClasses;return(0,a.h)("calcite-label",null,t.panels.relationship.gridSize,(0,a.h)("calcite-select",{label:t.panels.relationship.gridSize,onCalciteSelectChange:e=>{const t=e.target;this.handleGridSizeChange(Number.parseFloat(t.value))}},(0,a.h)("calcite-option",{value:"2",selected:2===i},t.panels.relationship.gridsize2),(0,a.h)("calcite-option",{value:"3",selected:3===i},t.panels.relationship.gridsize3),(0,a.h)("calcite-option",{value:"4",selected:4===i},t.panels.relationship.gridsize4)))}renderMethod(){const{smartMappingState:e}=this,t=(0,s.a)(e);return(0,a.h)("arcgis-smart-mapping-method-button",{onArcgisSmartMappingMethodButtonBeforeOpen:()=>(0,s.B)(),onArcgisSmartMappingMethodButtonChange:i=>{const n=i.target,o=(0,s.j)(e);"manual"===i.detail?(o.authoringInfo.classificationMethod="manual",(0,s.u)(e),(0,a.f)(this.el)):(0,r.r)((0,v.a)(e,{classificationMethod:i.detail}),this.flowItemNode).then((i=>{if(["relationship-size"].includes(t)){const e=(0,s.b)(o,"size");i.renderer.visualVariables=i.renderer.visualVariables||[],i.renderer.visualVariables.push(e);const t=(0,s.G)(o,"size");i.renderer.authoringInfo=i.renderer.authoringInfo||{},i.renderer.authoringInfo.visualVariables=i.renderer.authoringInfo.visualVariables||[],i.renderer.authoringInfo.visualVariables.push(t)}(0,s.u)(e,i.renderer),(0,a.f)(this.el),(0,a.f)(n)}),(e=>{(0,a.f)(n),this.arcgisSmartMappingPanelsRelationshipError.emit(e)}))},ref:e=>this.methodButtonNode=e})}renderField1(){const{smartMappingState:e}=this,t=(0,s.j)(e).authoringInfo.field1,i=(0,s.o)(e,t.field),n=i.layerField.alias||i.layerField.name;return(0,a.h)("calcite-block-section",{text:n},(0,a.h)("div",{class:"block-section-padding"},this.renderDividedBy(0),this.renderColorSlider(0)))}renderField2(){const{smartMappingState:e}=this,t=(0,s.j)(e).authoringInfo.field2,i=(0,s.o)(e,t.field),n=i.layerField.alias||i.layerField.name;return(0,a.h)("calcite-block-section",{text:n},(0,a.h)("div",{class:"block-section-padding"},this.renderDividedBy(1),this.renderColorSlider(1)))}renderDividedBy(e){const{smartMappingState:t}=this,i=(0,s.j)(t).authoringInfo,n=0===e?i.field1:i.field2,o=n?.normalizationField;return(0,a.h)("arcgis-smart-mapping-divided-by",{rendererSubtype:"relationship",fieldPos:e,normalizationField:o,onArcgisSmartMappingDividedByChange:()=>{(0,a.f)(this.el),this.colorSliderNodes[e]&&this.colorSliderNodes[e].updateStatistics()}})}renderColorSlider(e){return(0,a.h)("arcgis-smart-mapping-relationship-color-slider",{fieldPos:e,ref:t=>{t&&(this.colorSliderNodes[e]=t)},onArcgisSmartMappingRelationshipColorSliderChange:()=>this.methodButtonNode&&(0,a.f)(this.methodButtonNode)})}renderBackgroundStyle(){const{smartMappingState:e}=this,{mapImageSublayer:t}=e;return t||!(0,s.z)(e)||"relationship-size"!==(0,s.a)(e)?(0,a.h)(a.F,null):(0,a.h)("arcgis-smart-mapping-background-symbol",null)}renderDefaultSymbol(){return(0,a.h)("arcgis-smart-mapping-default-symbol",null)}renderLegend(){return(0,a.h)("arcgis-smart-mapping-relationship-legend",{onArcgisSmartMappingRelationshipLegendFocusChange:()=>(0,a.f)(this.el),ref:e=>this.legendNode=e})}renderTransparency(){const{hideTransparency:e,smartMappingState:t}=this;if(e)return(0,a.h)(a.F,null);const i=(0,s.j)(t),n=(0,s.b)(i,"opacity");return(0,a.h)("arcgis-smart-mapping-transparency",{open:!!n,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipError.emit(e)})}renderRotation(){if(this.hideRotation)return(0,a.h)(a.F,null);const{smartMappingState:e}=this,t=(0,s.j)(e),i=(0,s.b)(t,"opacity"),n=(0,s.b)(t,"rotation");return(0,a.h)("arcgis-smart-mapping-rotation",{open:!i&&!!n,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipError.emit(e)})}handleDone(){this.arcgisSmartMappingPanelsRelationshipClose.emit("save")}handleCancel(){const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,s.h)(i,e,t),this.arcgisSmartMappingPanelsRelationshipClose.emit("cancel")}handleGridSizeChange(e){(0,s.B)();const{smartMappingState:t}=this;(0,r.r)((0,v.a)(t,{numClasses:e}),this.flowItemNode).then((e=>{if("relationship-size"===(0,s.a)(t)){const i=(0,s.j)(t),a=(0,s.b)(i,"size");e.renderer.visualVariables=e.renderer.visualVariables||[],e.renderer.visualVariables.push(a);const n=(0,s.G)(i,"size");e.renderer.authoringInfo.visualVariables=e.renderer.authoringInfo.visualVariables||[],e.renderer.authoringInfo.visualVariables.push(n)}(0,s.u)(t,e.renderer),(0,a.f)(this.el),this.colorSliderNodes[0]&&(0,a.f)(this.colorSliderNodes[0]),this.colorSliderNodes[1]&&(0,a.f)(this.colorSliderNodes[1])}))}get el(){return(0,a.g)(this)}};function k(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function V(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?k(Object(i),!0).forEach((function(t){E(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):k(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function E(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function z(){return z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},z.apply(this,arguments)}function D(e,t){if(null==e)return{};var i,a,n=function(e,t){if(null==e)return{};var i,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)i=s[a],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)i=s[a],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}N.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.relationship-block{overflow-x:hidden}.attribute-name{word-break:break-all}.block-section-padding{padding-top:6px}";function I(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var P=I(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),O=I(/Edge/i),B=I(/firefox/i),F=I(/safari/i)&&!I(/chrome/i)&&!I(/android/i),_=I(/iP(ad|od|hone)/i),A=I(/chrome/i)&&I(/android/i),L={capture:!1,passive:!1};function R(e,t,i){e.addEventListener(t,i,!P&&L)}function j(e,t,i){e.removeEventListener(t,i,!P&&L)}function G(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function q(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function H(e,t,i,a){if(e){i=i||document;do{if(null!=t&&(">"===t[0]?e.parentNode===i&&G(e,t):G(e,t))||a&&e===i)return e;if(e===i)break}while(e=q(e))}return null}var $,U=/\s+/g;function Z(e,t,i){if(e&&t)if(e.classList)e.classList[i?"add":"remove"](t);else{var a=(" "+e.className+" ").replace(U," ").replace(" "+t+" "," ");e.className=(a+(i?" "+t:"")).replace(U," ")}}function X(e,t,i){var a=e&&e.style;if(a){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(i=e.currentStyle),void 0===t?i:i[t];t in a||-1!==t.indexOf("webkit")||(t="-webkit-"+t),a[t]=i+("string"==typeof i?"":"px")}}function Y(e,t){var i="";if("string"==typeof e)i=e;else do{var a=X(e,"transform");a&&"none"!==a&&(i=a+" "+i)}while(!t&&(e=e.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(i)}function K(e,t,i){if(e){var a=e.getElementsByTagName(t),n=0,s=a.length;if(i)for(;n<s;n++)i(a[n],n);return a}return[]}function W(){var e=document.scrollingElement;return e||document.documentElement}function J(e,t,i,a,n){if(e.getBoundingClientRect||e===window){var s,o,r,l,d,c,h;if(e!==window&&e.parentNode&&e!==W()?(o=(s=e.getBoundingClientRect()).top,r=s.left,l=s.bottom,d=s.right,c=s.height,h=s.width):(o=0,r=0,l=window.innerHeight,d=window.innerWidth,c=window.innerHeight,h=window.innerWidth),(t||i)&&e!==window&&(n=n||e.parentNode,!P))do{if(n&&n.getBoundingClientRect&&("none"!==X(n,"transform")||i&&"static"!==X(n,"position"))){var u=n.getBoundingClientRect();o-=u.top+parseInt(X(n,"border-top-width")),r-=u.left+parseInt(X(n,"border-left-width")),l=o+s.height,d=r+s.width;break}}while(n=n.parentNode);if(a&&e!==window){var p=Y(n||e),m=p&&p.a,g=p&&p.d;p&&(l=(o/=g)+(c/=g),d=(r/=m)+(h/=m))}return{top:o,left:r,bottom:l,right:d,width:h,height:c}}}function Q(e){var t=J(e),i=parseInt(X(e,"padding-left")),a=parseInt(X(e,"padding-top")),n=parseInt(X(e,"padding-right")),s=parseInt(X(e,"padding-bottom"));return t.top+=a+parseInt(X(e,"border-top-width")),t.left+=i+parseInt(X(e,"border-left-width")),t.width=e.clientWidth-i-n,t.height=e.clientHeight-a-s,t.bottom=t.top+t.height,t.right=t.left+t.width,t}function ee(e,t,i){for(var a=se(e,!0),n=J(e)[t];a;){var s=J(a)[i];if(!("top"===i||"left"===i?n>=s:n<=s))return a;if(a===W())break;a=se(a,!1)}return!1}function te(e,t,i,a){for(var n=0,s=0,o=e.children;s<o.length;){if("none"!==o[s].style.display&&o[s]!==lt.ghost&&(a||o[s]!==lt.dragged)&&H(o[s],i.draggable,e,!1)){if(n===t)return o[s];n++}s++}return null}function ie(e,t){for(var i=e.lastElementChild;i&&(i===lt.ghost||"none"===X(i,"display")||t&&!G(i,t));)i=i.previousElementSibling;return i||null}function ae(e,t){var i=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===lt.clone||t&&!G(e,t)||i++;return i}function ne(e){var t=0,i=0,a=W();if(e)do{var n=Y(e),s=n.a,o=n.d;t+=e.scrollLeft*s,i+=e.scrollTop*o}while(e!==a&&(e=e.parentNode));return[t,i]}function se(e,t){if(!e||!e.getBoundingClientRect)return W();var i=e,a=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var n=X(i);if(i.clientWidth<i.scrollWidth&&("auto"==n.overflowX||"scroll"==n.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==n.overflowY||"scroll"==n.overflowY)){if(!i.getBoundingClientRect||i===document.body)return W();if(a||t)return i;a=!0}}}while(i=i.parentNode);return W()}function oe(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function re(e,t){return function(){if(!$){var i=arguments;1===i.length?e.call(this,i[0]):e.apply(this,i),$=setTimeout((function(){$=void 0}),t)}}}function le(e,t,i){e.scrollLeft+=t,e.scrollTop+=i}function de(e){var t=window.Polymer,i=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):i?i(e).clone(!0)[0]:e.cloneNode(!0)}var ce="Sortable"+(new Date).getTime();function he(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(e){if("none"!==X(e,"display")&&e!==lt.ghost){t.push({target:e,rect:J(e)});var i=V({},t[t.length-1].rect);if(e.thisAnimationDuration){var a=Y(e,!0);a&&(i.top-=a.f,i.left-=a.e)}e.fromRect=i}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var i in e)if(e.hasOwnProperty(i))for(var a in t)if(t.hasOwnProperty(a)&&t[a]===e[i][a])return Number(i);return-1}(t,{target:e}),1)},animateAll:function(i){var a=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof i&&i());var n=!1,s=0;t.forEach((function(e){var t=0,i=e.target,o=i.fromRect,r=J(i),l=i.prevFromRect,d=i.prevToRect,c=e.rect,h=Y(i,!0);h&&(r.top-=h.f,r.left-=h.e),i.toRect=r,i.thisAnimationDuration&&oe(l,r)&&!oe(o,r)&&(c.top-r.top)/(c.left-r.left)==(o.top-r.top)/(o.left-r.left)&&(t=function(e,t,i,a){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-i.top,2)+Math.pow(t.left-i.left,2))*a.animation}(c,l,d,a.options)),oe(r,o)||(i.prevFromRect=o,i.prevToRect=r,t||(t=a.options.animation),a.animate(i,c,r,t)),t&&(n=!0,s=Math.max(s,t),clearTimeout(i.animationResetTimer),i.animationResetTimer=setTimeout((function(){i.animationTime=0,i.prevFromRect=null,i.fromRect=null,i.prevToRect=null,i.thisAnimationDuration=null}),t),i.thisAnimationDuration=t)})),clearTimeout(e),n?e=setTimeout((function(){"function"==typeof i&&i()}),s):"function"==typeof i&&i(),t=[]},animate:function(e,t,i,a){if(a){X(e,"transition",""),X(e,"transform","");var n=Y(this.el),s=n&&n.a,o=n&&n.d,r=(t.left-i.left)/(s||1),l=(t.top-i.top)/(o||1);e.animatingX=!!r,e.animatingY=!!l,X(e,"transform","translate3d("+r+"px,"+l+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),X(e,"transition","transform "+a+"ms"+(this.options.easing?" "+this.options.easing:"")),X(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){X(e,"transition",""),X(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),a)}}}}var ue=[],pe={initializeByDefault:!0},me={mount:function(e){for(var t in pe)pe.hasOwnProperty(t)&&!(t in e)&&(e[t]=pe[t]);ue.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),ue.push(e)},pluginEvent:function(e,t,i){var a=this;this.eventCanceled=!1,i.cancel=function(){a.eventCanceled=!0};var n=e+"Global";ue.forEach((function(a){t[a.pluginName]&&(t[a.pluginName][n]&&t[a.pluginName][n](V({sortable:t},i)),t.options[a.pluginName]&&t[a.pluginName][e]&&t[a.pluginName][e](V({sortable:t},i)))}))},initializePlugins:function(e,t,i,a){for(var n in ue.forEach((function(a){var n=a.pluginName;if(e.options[n]||a.initializeByDefault){var s=new a(e,t,e.options);s.sortable=e,s.options=e.options,e[n]=s,z(i,s.defaults)}})),e.options)if(e.options.hasOwnProperty(n)){var s=this.modifyOption(e,n,e.options[n]);void 0!==s&&(e.options[n]=s)}},getEventProperties:function(e,t){var i={};return ue.forEach((function(a){"function"==typeof a.eventProperties&&z(i,a.eventProperties.call(t[a.pluginName],e))})),i},modifyOption:function(e,t,i){var a;return ue.forEach((function(n){e[n.pluginName]&&n.optionListeners&&"function"==typeof n.optionListeners[t]&&(a=n.optionListeners[t].call(e[n.pluginName],i))})),a}};var ge=["evt"],fe=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=i.evt,n=D(i,ge);me.pluginEvent.bind(lt)(e,t,V({dragEl:ve,parentEl:be,ghostEl:ye,rootEl:Ce,nextEl:Me,lastDownEl:xe,cloneEl:we,cloneHidden:Ne,dragStarted:Ae,putSortable:De,activeSortable:lt.active,originalEvent:a,oldIndex:ke,oldDraggableIndex:Te,newIndex:Ve,newDraggableIndex:Ee,hideGhostForTarget:nt,unhideGhostForTarget:st,cloneNowHidden:function(){Ne=!0},cloneNowShown:function(){Ne=!1},dispatchSortableEvent:function(e){Se({sortable:t,name:e,originalEvent:a})}},n))};function Se(e){!function(e){var t=e.sortable,i=e.rootEl,a=e.name,n=e.targetEl,s=e.cloneEl,o=e.toEl,r=e.fromEl,l=e.oldIndex,d=e.newIndex,c=e.oldDraggableIndex,h=e.newDraggableIndex,u=e.originalEvent,p=e.putSortable,m=e.extraEventProperties;if(t=t||i&&i[ce]){var g,f=t.options,S="on"+a.charAt(0).toUpperCase()+a.substr(1);!window.CustomEvent||P||O?(g=document.createEvent("Event")).initEvent(a,!0,!0):g=new CustomEvent(a,{bubbles:!0,cancelable:!0}),g.to=o||i,g.from=r||i,g.item=n||i,g.clone=s,g.oldIndex=l,g.newIndex=d,g.oldDraggableIndex=c,g.newDraggableIndex=h,g.originalEvent=u,g.pullMode=p?p.lastPutMode:void 0;var v=V(V({},m),me.getEventProperties(a,t));for(var b in v)g[b]=v[b];i&&i.dispatchEvent(g),f[S]&&f[S].call(t,g)}}(V({putSortable:De,cloneEl:we,targetEl:ve,rootEl:Ce,oldIndex:ke,oldDraggableIndex:Te,newIndex:Ve,newDraggableIndex:Ee},e))}var ve,be,ye,Ce,Me,xe,we,Ne,ke,Ve,Te,Ee,ze,De,Ie,Pe,Oe,Be,Fe,_e,Ae,Le,Re,je,Ge,qe=!1,He=!1,$e=[],Ue=!1,Ze=!1,Xe=[],Ye=!1,Ke=[],We="undefined"!=typeof document,Je=_,Qe=O||P?"cssFloat":"float",et=We&&!A&&!_&&"draggable"in document.createElement("div"),tt=function(){if(We){if(P)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),it=function(e,t){var i=X(e),a=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),n=te(e,0,t),s=te(e,1,t),o=n&&X(n),r=s&&X(s),l=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+J(n).width,d=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+J(s).width;if("flex"===i.display)return"column"===i.flexDirection||"column-reverse"===i.flexDirection?"vertical":"horizontal";if("grid"===i.display)return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&o.float&&"none"!==o.float){var c="left"===o.float?"left":"right";return!s||"both"!==r.clear&&r.clear!==c?"horizontal":"vertical"}return n&&("block"===o.display||"flex"===o.display||"table"===o.display||"grid"===o.display||l>=a&&"none"===i[Qe]||s&&"none"===i[Qe]&&l+d>a)?"vertical":"horizontal"},at=function(e){function t(e,i){return function(a,n,s,o){var r=a.options.group.name&&n.options.group.name&&a.options.group.name===n.options.group.name;if(null==e&&(i||r))return!0;if(null==e||!1===e)return!1;if(i&&"clone"===e)return e;if("function"==typeof e)return t(e(a,n,s,o),i)(a,n,s,o);var l=(i?a:n).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&e.indexOf(l)>-1}}var i={},a=e.group;a&&"object"==T(a)||(a={name:a}),i.name=a.name,i.checkPull=t(a.pull,!0),i.checkPut=t(a.put),i.revertClone=a.revertClone,e.group=i},nt=function(){!tt&&ye&&X(ye,"display","none")},st=function(){!tt&&ye&&X(ye,"display","")};We&&!A&&document.addEventListener("click",(function(e){if(He)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),He=!1,!1}),!0);var ot=function(e){if(ve){e=e.touches?e.touches[0]:e;var t=(n=e.clientX,s=e.clientY,$e.some((function(e){var t=e[ce].options.emptyInsertThreshold;if(t&&!ie(e)){var i=J(e),a=n>=i.left-t&&n<=i.right+t,r=s>=i.top-t&&s<=i.bottom+t;return a&&r?o=e:void 0}})),o);if(t){var i={};for(var a in e)e.hasOwnProperty(a)&&(i[a]=e[a]);i.target=i.rootEl=t,i.preventDefault=void 0,i.stopPropagation=void 0,t[ce]._onDragOver(i)}}var n,s,o},rt=function(e){ve&&ve.parentNode[ce]._isOutsideThisEl(e.target)};function lt(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=z({},t),e[ce]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return it(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==lt.supportPointer&&"PointerEvent"in window&&!F,emptyInsertThreshold:5};for(var a in me.initializePlugins(this,e,i),i)!(a in t)&&(t[a]=i[a]);for(var n in at(t),this)"_"===n.charAt(0)&&"function"==typeof this[n]&&(this[n]=this[n].bind(this));this.nativeDraggable=!t.forceFallback&&et,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?R(e,"pointerdown",this._onTapStart):(R(e,"mousedown",this._onTapStart),R(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(R(e,"dragover",this),R(e,"dragenter",this)),$e.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),z(this,he())}function dt(e,t,i,a,n,s,o,r){var l,d,c=e[ce],h=c.options.onMove;return!window.CustomEvent||P||O?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=i,l.draggedRect=a,l.related=n||t,l.relatedRect=s||J(t),l.willInsertAfter=r,l.originalEvent=o,e.dispatchEvent(l),h&&(d=h.call(c,l,o)),d}function ct(e){e.draggable=!1}function ht(){Ye=!1}function ut(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,i=t.length,a=0;i--;)a+=t.charCodeAt(i);return a.toString(36)}function pt(e){return setTimeout(e,0)}function mt(e){return clearTimeout(e)}lt.prototype={constructor:lt,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(Le=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,ve):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,i=this.el,a=this.options,n=a.preventOnFilter,s=e.type,o=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,r=(o||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||r,d=a.filter;if(function(e){Ke.length=0;var t=e.getElementsByTagName("input"),i=t.length;for(;i--;){var a=t[i];a.checked&&Ke.push(a)}}(i),!ve&&!(/mousedown|pointerdown/.test(s)&&0!==e.button||a.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!F||!r||"SELECT"!==r.tagName.toUpperCase())&&!((r=H(r,a.draggable,i,!1))&&r.animated||xe===r)){if(ke=ae(r),Te=ae(r,a.draggable),"function"==typeof d){if(d.call(this,e,r,this))return Se({sortable:t,rootEl:l,name:"filter",targetEl:r,toEl:i,fromEl:i}),fe("filter",t,{evt:e}),void(n&&e.cancelable&&e.preventDefault())}else if(d&&(d=d.split(",").some((function(a){if(a=H(l,a.trim(),i,!1))return Se({sortable:t,rootEl:a,name:"filter",targetEl:r,fromEl:i,toEl:i}),fe("filter",t,{evt:e}),!0}))))return void(n&&e.cancelable&&e.preventDefault());a.handle&&!H(l,a.handle,i,!1)||this._prepareDragStart(e,o,r)}}},_prepareDragStart:function(e,t,i){var a,n=this,s=n.el,o=n.options,r=s.ownerDocument;if(i&&!ve&&i.parentNode===s){var l=J(i);if(Ce=s,be=(ve=i).parentNode,Me=ve.nextSibling,xe=i,ze=o.group,lt.dragged=ve,Ie={target:ve,clientX:(t||e).clientX,clientY:(t||e).clientY},Fe=Ie.clientX-l.left,_e=Ie.clientY-l.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,ve.style["will-change"]="all",a=function(){fe("delayEnded",n,{evt:e}),lt.eventCanceled?n._onDrop():(n._disableDelayedDragEvents(),!B&&n.nativeDraggable&&(ve.draggable=!0),n._triggerDragStart(e,t),Se({sortable:n,name:"choose",originalEvent:e}),Z(ve,o.chosenClass,!0))},o.ignore.split(",").forEach((function(e){K(ve,e.trim(),ct)})),R(r,"dragover",ot),R(r,"mousemove",ot),R(r,"touchmove",ot),R(r,"mouseup",n._onDrop),R(r,"touchend",n._onDrop),R(r,"touchcancel",n._onDrop),B&&this.nativeDraggable&&(this.options.touchStartThreshold=4,ve.draggable=!0),fe("delayStart",this,{evt:e}),!o.delay||o.delayOnTouchOnly&&!t||this.nativeDraggable&&(O||P))a();else{if(lt.eventCanceled)return void this._onDrop();R(r,"mouseup",n._disableDelayedDrag),R(r,"touchend",n._disableDelayedDrag),R(r,"touchcancel",n._disableDelayedDrag),R(r,"mousemove",n._delayedDragTouchMoveHandler),R(r,"touchmove",n._delayedDragTouchMoveHandler),o.supportPointer&&R(r,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(a,o.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){ve&&ct(ve),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;j(e,"mouseup",this._disableDelayedDrag),j(e,"touchend",this._disableDelayedDrag),j(e,"touchcancel",this._disableDelayedDrag),j(e,"mousemove",this._delayedDragTouchMoveHandler),j(e,"touchmove",this._delayedDragTouchMoveHandler),j(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?R(document,"pointermove",this._onTouchMove):R(document,t?"touchmove":"mousemove",this._onTouchMove):(R(ve,"dragend",this),R(Ce,"dragstart",this._onDragStart));try{document.selection?pt((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e,t){if(qe=!1,Ce&&ve){fe("dragStarted",this,{evt:t}),this.nativeDraggable&&R(document,"dragover",rt);var i=this.options;!e&&Z(ve,i.dragClass,!1),Z(ve,i.ghostClass,!0),lt.active=this,e&&this._appendGhost(),Se({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(Pe){this._lastX=Pe.clientX,this._lastY=Pe.clientY,nt();for(var e=document.elementFromPoint(Pe.clientX,Pe.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Pe.clientX,Pe.clientY))!==t;)t=e;if(ve.parentNode[ce]._isOutsideThisEl(e),t)do{if(t[ce]){if(t[ce]._onDragOver({clientX:Pe.clientX,clientY:Pe.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=t.parentNode);st()}},_onTouchMove:function(e){if(Ie){var t=this.options,i=t.fallbackTolerance,a=t.fallbackOffset,n=e.touches?e.touches[0]:e,s=ye&&Y(ye,!0),o=ye&&s&&s.a,r=ye&&s&&s.d,l=Je&&Ge&&ne(Ge),d=(n.clientX-Ie.clientX+a.x)/(o||1)+(l?l[0]-Xe[0]:0)/(o||1),c=(n.clientY-Ie.clientY+a.y)/(r||1)+(l?l[1]-Xe[1]:0)/(r||1);if(!lt.active&&!qe){if(i&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<i)return;this._onDragStart(e,!0)}if(ye){s?(s.e+=d-(Oe||0),s.f+=c-(Be||0)):s={a:1,b:0,c:0,d:1,e:d,f:c};var h="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");X(ye,"webkitTransform",h),X(ye,"mozTransform",h),X(ye,"msTransform",h),X(ye,"transform",h),Oe=d,Be=c,Pe=n}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!ye){var e=this.options.fallbackOnBody?document.body:Ce,t=J(ve,!0,Je,!0,e),i=this.options;if(Je){for(Ge=e;"static"===X(Ge,"position")&&"none"===X(Ge,"transform")&&Ge!==document;)Ge=Ge.parentNode;Ge!==document.body&&Ge!==document.documentElement?(Ge===document&&(Ge=W()),t.top+=Ge.scrollTop,t.left+=Ge.scrollLeft):Ge=W(),Xe=ne(Ge)}Z(ye=ve.cloneNode(!0),i.ghostClass,!1),Z(ye,i.fallbackClass,!0),Z(ye,i.dragClass,!0),X(ye,"transition",""),X(ye,"transform",""),X(ye,"box-sizing","border-box"),X(ye,"margin",0),X(ye,"top",t.top),X(ye,"left",t.left),X(ye,"width",t.width),X(ye,"height",t.height),X(ye,"opacity","0.8"),X(ye,"position",Je?"absolute":"fixed"),X(ye,"zIndex","100000"),X(ye,"pointerEvents","none"),lt.ghost=ye,e.appendChild(ye),X(ye,"transform-origin",Fe/parseInt(ye.style.width)*100+"% "+_e/parseInt(ye.style.height)*100+"%")}},_onDragStart:function(e,t){var i=this,a=e.dataTransfer,n=i.options;fe("dragStart",this,{evt:e}),lt.eventCanceled?this._onDrop():(fe("setupClone",this),lt.eventCanceled||((we=de(ve)).removeAttribute("id"),we.draggable=!1,we.style["will-change"]="",this._hideClone(),Z(we,this.options.chosenClass,!1),lt.clone=we),i.cloneId=pt((function(){fe("clone",i),lt.eventCanceled||(i.options.removeCloneOnHide||Ce.insertBefore(we,ve),i._hideClone(),Se({sortable:i,name:"clone"}))})),!t&&Z(ve,n.dragClass,!0),t?(He=!0,i._loopId=setInterval(i._emulateDragOver,50)):(j(document,"mouseup",i._onDrop),j(document,"touchend",i._onDrop),j(document,"touchcancel",i._onDrop),a&&(a.effectAllowed="move",n.setData&&n.setData.call(i,a,ve)),R(document,"drop",i),X(ve,"transform","translateZ(0)")),qe=!0,i._dragStartId=pt(i._dragStarted.bind(i,t,e)),R(document,"selectstart",i),Ae=!0,F&&X(document.body,"user-select","none"))},_onDragOver:function(e){var t,i,a,n,s=this.el,o=e.target,r=this.options,l=r.group,d=lt.active,c=ze===l,h=r.sort,u=De||d,p=this,m=!1;if(!Ye){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),o=H(o,r.draggable,s,!0),z("dragOver"),lt.eventCanceled)return m;if(ve.contains(e.target)||o.animated&&o.animatingX&&o.animatingY||p._ignoreWhileAnimating===o)return I(!1);if(He=!1,d&&!r.disabled&&(c?h||(a=be!==Ce):De===this||(this.lastPutMode=ze.checkPull(this,d,ve,e))&&l.checkPut(this,d,ve,e))){if(n="vertical"===this._getDirection(e,o),t=J(ve),z("dragOverValid"),lt.eventCanceled)return m;if(a)return be=Ce,D(),this._hideClone(),z("revert"),lt.eventCanceled||(Me?Ce.insertBefore(ve,Me):Ce.appendChild(ve)),I(!0);var g=ie(s,r.draggable);if(!g||function(e,t,i){var a=J(ie(i.el,i.options.draggable)),n=Q(i.el),s=10;return t?e.clientX>n.right+s||e.clientY>a.bottom&&e.clientX>a.left:e.clientY>n.bottom+s||e.clientX>a.right&&e.clientY>a.top}(e,n,this)&&!g.animated){if(g===ve)return I(!1);if(g&&s===e.target&&(o=g),o&&(i=J(o)),!1!==dt(Ce,s,ve,t,o,i,e,!!o))return D(),g&&g.nextSibling?s.insertBefore(ve,g.nextSibling):s.appendChild(ve),be=s,P(),I(!0)}else if(g&&function(e,t,i){var a=J(te(i.el,0,i.options,!0)),n=Q(i.el),s=10;return t?e.clientX<n.left-s||e.clientY<a.top&&e.clientX<a.right:e.clientY<n.top-s||e.clientY<a.bottom&&e.clientX<a.left}(e,n,this)){var f=te(s,0,r,!0);if(f===ve)return I(!1);if(i=J(o=f),!1!==dt(Ce,s,ve,t,o,i,e,!1))return D(),s.insertBefore(ve,f),be=s,P(),I(!0)}else if(o.parentNode===s){i=J(o);var S,v,b,y=ve.parentNode!==s,C=!function(e,t,i){var a=i?e.left:e.top,n=i?e.right:e.bottom,s=i?e.width:e.height,o=i?t.left:t.top,r=i?t.right:t.bottom,l=i?t.width:t.height;return a===o||n===r||a+s/2===o+l/2}(ve.animated&&ve.toRect||t,o.animated&&o.toRect||i,n),M=n?"top":"left",x=ee(o,"top","top")||ee(ve,"top","top"),w=x?x.scrollTop:void 0;if(Le!==o&&(v=i[M],Ue=!1,Ze=!C&&r.invertSwap||y),S=function(e,t,i,a,n,s,o,r){var l=a?e.clientY:e.clientX,d=a?i.height:i.width,c=a?i.top:i.left,h=a?i.bottom:i.right,u=!1;if(!o)if(r&&je<d*n){if(!Ue&&(1===Re?l>c+d*s/2:l<h-d*s/2)&&(Ue=!0),Ue)u=!0;else if(1===Re?l<c+je:l>h-je)return-Re}else if(l>c+d*(1-n)/2&&l<h-d*(1-n)/2)return function(e){return ae(ve)<ae(e)?1:-1}(t);if((u=u||o)&&(l<c+d*s/2||l>h-d*s/2))return l>c+d/2?1:-1;return 0}(e,o,i,n,C?1:r.swapThreshold,null==r.invertedSwapThreshold?r.swapThreshold:r.invertedSwapThreshold,Ze,Le===o),0!==S){var N=ae(ve);do{N-=S,b=be.children[N]}while(b&&("none"===X(b,"display")||b===ye))}if(0===S||b===o)return I(!1);Le=o,Re=S;var k=o.nextElementSibling,T=!1,E=dt(Ce,s,ve,t,o,i,e,T=1===S);if(!1!==E)return 1!==E&&-1!==E||(T=1===E),Ye=!0,setTimeout(ht,30),D(),T&&!k?s.appendChild(ve):o.parentNode.insertBefore(ve,T?k:o),x&&le(x,0,w-x.scrollTop),be=ve.parentNode,void 0===v||Ze||(je=Math.abs(v-J(o)[M])),P(),I(!0)}if(s.contains(ve))return I(!1)}return!1}function z(r,l){fe(r,p,V({evt:e,isOwner:c,axis:n?"vertical":"horizontal",revert:a,dragRect:t,targetRect:i,canSort:h,fromSortable:u,target:o,completed:I,onMove:function(i,a){return dt(Ce,s,ve,t,i,J(i),e,a)},changed:P},l))}function D(){z("dragOverAnimationCapture"),p.captureAnimationState(),p!==u&&u.captureAnimationState()}function I(t){return z("dragOverCompleted",{insertion:t}),t&&(c?d._hideClone():d._showClone(p),p!==u&&(Z(ve,De?De.options.ghostClass:d.options.ghostClass,!1),Z(ve,r.ghostClass,!0)),De!==p&&p!==lt.active?De=p:p===lt.active&&De&&(De=null),u===p&&(p._ignoreWhileAnimating=o),p.animateAll((function(){z("dragOverAnimationComplete"),p._ignoreWhileAnimating=null})),p!==u&&(u.animateAll(),u._ignoreWhileAnimating=null)),(o===ve&&!ve.animated||o===s&&!o.animated)&&(Le=null),r.dragoverBubble||e.rootEl||o===document||(ve.parentNode[ce]._isOutsideThisEl(e.target),!t&&ot(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),m=!0}function P(){Ve=ae(ve),Ee=ae(ve,r.draggable),Se({sortable:p,name:"change",toEl:s,newIndex:Ve,newDraggableIndex:Ee,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){j(document,"mousemove",this._onTouchMove),j(document,"touchmove",this._onTouchMove),j(document,"pointermove",this._onTouchMove),j(document,"dragover",ot),j(document,"mousemove",ot),j(document,"touchmove",ot)},_offUpEvents:function(){var e=this.el.ownerDocument;j(e,"mouseup",this._onDrop),j(e,"touchend",this._onDrop),j(e,"pointerup",this._onDrop),j(e,"touchcancel",this._onDrop),j(document,"selectstart",this)},_onDrop:function(e){var t=this.el,i=this.options;Ve=ae(ve),Ee=ae(ve,i.draggable),fe("drop",this,{evt:e}),be=ve&&ve.parentNode,Ve=ae(ve),Ee=ae(ve,i.draggable),lt.eventCanceled||(qe=!1,Ze=!1,Ue=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),mt(this.cloneId),mt(this._dragStartId),this.nativeDraggable&&(j(document,"drop",this),j(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),F&&X(document.body,"user-select",""),X(ve,"transform",""),e&&(Ae&&(e.cancelable&&e.preventDefault(),!i.dropBubble&&e.stopPropagation()),ye&&ye.parentNode&&ye.parentNode.removeChild(ye),(Ce===be||De&&"clone"!==De.lastPutMode)&&we&&we.parentNode&&we.parentNode.removeChild(we),ve&&(this.nativeDraggable&&j(ve,"dragend",this),ct(ve),ve.style["will-change"]="",Ae&&!qe&&Z(ve,De?De.options.ghostClass:this.options.ghostClass,!1),Z(ve,this.options.chosenClass,!1),Se({sortable:this,name:"unchoose",toEl:be,newIndex:null,newDraggableIndex:null,originalEvent:e}),Ce!==be?(Ve>=0&&(Se({rootEl:be,name:"add",toEl:be,fromEl:Ce,originalEvent:e}),Se({sortable:this,name:"remove",toEl:be,originalEvent:e}),Se({rootEl:be,name:"sort",toEl:be,fromEl:Ce,originalEvent:e}),Se({sortable:this,name:"sort",toEl:be,originalEvent:e})),De&&De.save()):Ve!==ke&&Ve>=0&&(Se({sortable:this,name:"update",toEl:be,originalEvent:e}),Se({sortable:this,name:"sort",toEl:be,originalEvent:e})),lt.active&&(null!=Ve&&-1!==Ve||(Ve=ke,Ee=Te),Se({sortable:this,name:"end",toEl:be,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){fe("nulling",this),Ce=ve=be=ye=Me=we=xe=Ne=Ie=Pe=Ae=Ve=Ee=ke=Te=Le=Re=De=ze=lt.dragged=lt.ghost=lt.clone=lt.active=null,Ke.forEach((function(e){e.checked=!0})),Ke.length=Oe=Be=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":ve&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],i=this.el.children,a=0,n=i.length,s=this.options;a<n;a++)H(e=i[a],s.draggable,this.el,!1)&&t.push(e.getAttribute(s.dataIdAttr)||ut(e));return t},sort:function(e,t){var i={},a=this.el;this.toArray().forEach((function(e,t){var n=a.children[t];H(n,this.options.draggable,a,!1)&&(i[e]=n)}),this),t&&this.captureAnimationState(),e.forEach((function(e){i[e]&&(a.removeChild(i[e]),a.appendChild(i[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return H(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var i=this.options;if(void 0===t)return i[e];var a=me.modifyOption(this,e,t);i[e]=void 0!==a?a:t,"group"===e&&at(i)},destroy:function(){fe("destroy",this);var e=this.el;e[ce]=null,j(e,"mousedown",this._onTapStart),j(e,"touchstart",this._onTapStart),j(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(j(e,"dragover",this),j(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),$e.splice($e.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Ne){if(fe("hideClone",this),lt.eventCanceled)return;X(we,"display","none"),this.options.removeCloneOnHide&&we.parentNode&&we.parentNode.removeChild(we),Ne=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(Ne){if(fe("showClone",this),lt.eventCanceled)return;ve.parentNode!=Ce||this.options.group.revertClone?Me?Ce.insertBefore(we,Me):Ce.appendChild(we):Ce.insertBefore(we,ve),this.options.group.revertClone&&this.animate(ve,we),X(we,"display",""),Ne=!1}}else this._hideClone()}},We&&R(document,"touchmove",(function(e){(lt.active||qe)&&e.cancelable&&e.preventDefault()})),lt.utils={on:R,off:j,css:X,find:K,is:function(e,t){return!!H(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},throttle:re,closest:H,toggleClass:Z,clone:de,index:ae,nextTick:pt,cancelNextTick:mt,detectDirection:it,getChild:te},lt.get=function(e){return e[ce]},lt.mount=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(lt.utils=V(V({},lt.utils),e.utils)),me.mount(e)}))},lt.create=function(e,t){return new lt(e,t)},lt.version="1.15.1";var gt,ft,St,vt,bt,yt,Ct=[],Mt=!1;function xt(){Ct.forEach((function(e){clearInterval(e.pid)})),Ct=[]}function wt(){clearInterval(yt)}var Nt=re((function(e,t,i,a){if(t.scroll){var n,s=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,r=t.scrollSensitivity,l=t.scrollSpeed,d=W(),c=!1;ft!==i&&(ft=i,xt(),gt=t.scroll,n=t.scrollFn,!0===gt&&(gt=se(i,!0)));var h=0,u=gt;do{var p=u,m=J(p),g=m.top,f=m.bottom,S=m.left,v=m.right,b=m.width,y=m.height,C=void 0,M=void 0,x=p.scrollWidth,w=p.scrollHeight,N=X(p),k=p.scrollLeft,V=p.scrollTop;p===d?(C=b<x&&("auto"===N.overflowX||"scroll"===N.overflowX||"visible"===N.overflowX),M=y<w&&("auto"===N.overflowY||"scroll"===N.overflowY||"visible"===N.overflowY)):(C=b<x&&("auto"===N.overflowX||"scroll"===N.overflowX),M=y<w&&("auto"===N.overflowY||"scroll"===N.overflowY));var T=C&&(Math.abs(v-s)<=r&&k+b<x)-(Math.abs(S-s)<=r&&!!k),E=M&&(Math.abs(f-o)<=r&&V+y<w)-(Math.abs(g-o)<=r&&!!V);if(!Ct[h])for(var z=0;z<=h;z++)Ct[z]||(Ct[z]={});Ct[h].vx==T&&Ct[h].vy==E&&Ct[h].el===p||(Ct[h].el=p,Ct[h].vx=T,Ct[h].vy=E,clearInterval(Ct[h].pid),0==T&&0==E||(c=!0,Ct[h].pid=setInterval(function(){a&&0===this.layer&&lt.active._onTouchMove(bt);var t=Ct[this.layer].vy?Ct[this.layer].vy*l:0,i=Ct[this.layer].vx?Ct[this.layer].vx*l:0;"function"==typeof n&&"continue"!==n.call(lt.dragged.parentNode[ce],i,t,e,bt,Ct[this.layer].el)||le(Ct[this.layer].el,i,t)}.bind({layer:h}),24))),h++}while(t.bubbleScroll&&u!==d&&(u=se(u,!1)));Mt=c}}),30),kt=function(e){var t=e.originalEvent,i=e.putSortable,a=e.dragEl,n=e.activeSortable,s=e.dispatchSortableEvent,o=e.hideGhostForTarget,r=e.unhideGhostForTarget;if(t){var l=i||n;o();var d=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,c=document.elementFromPoint(d.clientX,d.clientY);r(),l&&!l.el.contains(c)&&(s("spill"),this.onSpill({dragEl:a,putSortable:i}))}};function Vt(){}function Tt(){}Vt.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,i=e.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var a=te(this.sortable.el,this.startIndex,this.options);a?this.sortable.el.insertBefore(t,a):this.sortable.el.appendChild(t),this.sortable.animateAll(),i&&i.animateAll()},drop:kt},z(Vt,{pluginName:"revertOnSpill"}),Tt.prototype={onSpill:function(e){var t=e.dragEl,i=e.putSortable||this.sortable;i.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),i.animateAll()},drop:kt},z(Tt,{pluginName:"removeOnSpill"}),lt.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?R(document,"dragover",this._handleAutoScroll):this.options.supportPointer?R(document,"pointermove",this._handleFallbackAutoScroll):t.touches?R(document,"touchmove",this._handleFallbackAutoScroll):R(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?j(document,"dragover",this._handleAutoScroll):(j(document,"pointermove",this._handleFallbackAutoScroll),j(document,"touchmove",this._handleFallbackAutoScroll),j(document,"mousemove",this._handleFallbackAutoScroll)),wt(),xt(),clearTimeout($),$=void 0},nulling:function(){bt=ft=gt=Mt=yt=St=vt=null,Ct.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var i=this,a=(e.touches?e.touches[0]:e).clientX,n=(e.touches?e.touches[0]:e).clientY,s=document.elementFromPoint(a,n);if(bt=e,t||this.options.forceAutoScrollFallback||O||P||F){Nt(e,this.options,s,t);var o=se(s,!0);!Mt||yt&&a===St&&n===vt||(yt&&wt(),yt=setInterval((function(){var s=se(document.elementFromPoint(a,n),!0);s!==o&&(o=s,xt()),Nt(e,i.options,s,t)}),10),St=a,vt=n)}else{if(!this.options.bubbleScroll||se(s,!0)===W())return void xt();Nt(e,this.options,se(s,!1),!1)}}},z(e,{pluginName:"scroll",initializeByDefault:!0})}),lt.mount(Tt,Vt);const Et=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsTypeBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsTypeBackClick",7),this.arcgisSmartMappingPanelsTypeClose=(0,a.c)(this,"arcgisSmartMappingPanelsTypeClose",7),this.arcgisSmartMappingPanelsTypeClusterRequiresUpdate=(0,a.c)(this,"arcgisSmartMappingPanelsTypeClusterRequiresUpdate",7),this.arcgisSmartMappingPanelsTypeError=(0,a.c)(this,"arcgisSmartMappingPanelsTypeError",7),this.manager=(0,u.u)(this),this.groupMenuNodes=[],this.groupInputNodes=[],this.groupTextNodes=[],this.valueInputNodes=[],this.valueTextNodes=[],this.symbolNodes=[],this.checkedClasses=[],this.classSortable=[],this.groupSortable=void 0,this.otherSortable=void 0,this.symbolStylerOpen=!1,this.dragRenderToggle=!0,this.smartMappingState=(0,c.u)(),this.hideRotation=!1,this.hideTransparency=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){const{layer:e,modules:t,strings:i}=this.smartMappingState,a=e,n=(0,s.j)(this.smartMappingState),o=(0,s.a)(this.smartMappingState);this.smartMappingState.lastDefault={defaultSymbol:n.defaultSymbol||(0,s.m)(this.smartMappingState),defaultLabel:n.defaultLabel||i.panels.type.other},this.originalRendererJSON=n.toJSON(),this.originalFeatureReduction="featureReduction"in a&&a.featureReduction?t.esriLang.clone(a.featureReduction):void 0,this.originalOrderBy="knowledge-graph-sublayer"!==a.type?a.orderBy??void 0:void 0;try{const e=await(0,b.c)(this.smartMappingState,{fieldInfos:[{field:n.field,expression:n.valueExpression,expressionTitle:n.valueExpressionTitle}],typeScheme:(0,s.a5)(this.smartMappingState,b.m)});if((0,s.z)(this.smartMappingState)&&"type-size"===o){let i=n.uniqueValueInfos?.length?n.uniqueValueInfos[0].symbol:(0,s.m)(this.smartMappingState);const a=(0,s.j)(this.smartMappingState),o=(0,s.G)(a,"reference-size");"simple-marker"===i.type||o||(i=new t.SimpleMarkerSymbol),e.uniqueValueInfos.forEach((e=>{const a=t.esriLang.clone(i);(0,s.X)(this.smartMappingState,a,(0,s.Z)(this.smartMappingState,e.symbol)),e.symbol=a}))}return this.smartMappingState.allUniqueValues=e.uniqueValueInfos,e}catch(e){throw this.arcgisSmartMappingPanelsTypeError.emit({message:e,type:"error"}),new Error("Could not get unique values")}}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,h.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.closePopovers(),this.scaleHandle?.remove()}render(){const{smartMappingState:e}=this,{hideLayerTitle:t,layer:i,mapImageSublayer:n,strings:o}=e,r=t?void 0:n?.title??i.title;return(0,a.h)(a.H,{key:"04a0ccb67058eff6edc4c49a5b8cb1ead157d627",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"b5033654bff6d0ef87b79c8c400ded0f0dc0a61e",class:"flow-item",heading:o.panels.type.styleOptions,closable:(0,s.C)(this.el),showBackButton:this.showBackButton,selected:this.selected,description:r,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsTypeBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderVisualizationContent(),this.renderTransparency(),this.renderRotation(),this.renderDoneButton(),this.renderCancelButton()))}renderVisualizationContent(){const{smartMappingState:e}=this,{strings:t}=e,i=!this.hideTransparency||!this.hideRotation,n=(0,s.j)(e),o=(0,s.o)(e,n.field),r=o?.simpleFieldType===s.q.DATE||"date-only"===(0,s.v)(e,o?.layerField);return(0,a.h)("calcite-block",{class:"type-block",heading:r?t.panels.type.typeStyleDate:t.panels.type.typeStyle,collapsible:i,open:!0},this.renderTypesSymbol(),this.renderDrawingOrder(),this.renderGroups(),this.renderBackgroundStyle())}renderTypesSymbol(){const{smartMappingState:e}=this,{mapView:t,modules:i}=e,n=(0,s.j)(e).uniqueValueGroups??[];if(!n?.length||!n[0].classes?.length)return(0,a.h)(a.F,null);const o=[];n.forEach((e=>e.classes.forEach((e=>o.push(e)))));const r=i.typeSchemes.getSchemes({basemap:t.map.basemap,geometryType:(0,s.A)(e),numColors:o.length}),l=(0,s.ab)(r,Math.min(o.length,10))[0].colors,d=o?.length?o.map(((t,a)=>(0,s.Z)(e,t.symbol)||new i.EsriColor(l[a%l.length]))):[];return(0,a.h)("arcgis-smart-mapping-symbol-button",{rampType:"discrete",colors:d,type:"type-ramp",onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,a.f)(this.el),this.rotationNode&&(0,a.f)(this.rotationNode)}})}renderDrawingOrder(){const{smartMappingState:e}=this,{layer:t,mapImageSublayer:i,strings:n}=e;if(i||"catalog-footprint"===t.type)return(0,a.h)(a.F,null);const o=(0,s.j)(e);return(0,a.h)("calcite-label",{class:"toggle-div",layout:"inline-space-between"},n.panels.type.drawingOrder,(0,a.h)("calcite-switch",{class:"toggle-button",scale:"s",checked:o.orderByClassesEnabled,onCalciteSwitchChange:e=>{const t=e.target;this.handleDrawingOrderToggle(t.checked)}}))}renderGroups(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,s.j)(e),n=!i.uniqueValueGroups?.length,o=i.field?(0,s.o)(e,i.field)?.label:i.valueExpressionTitle||t.expression,r=n?[this.renderNoGroup()]:i.uniqueValueGroups.map(((e,t)=>this.renderGroup(e,t))),l=this.renderOtherValues();return(0,a.h)("div",{class:"top-padding"},(0,a.h)("calcite-label",null,o),(0,a.h)("div",{key:i.uniqueValueGroups.length,ref:t=>{if(t){(0,s.j)(e).uniqueValueGroups.length&&(this.groupSortable?.destroy(),this.groupSortable=lt.create(t,{group:{name:"shared",pull:!0,put:!1},dataIdAttr:"group-sort-values",ghostClass:"avatar",onSort:()=>this.handleSortGroups(),handle:".group-handle"}))}}},r),(0,a.h)("div",{class:"other",key:`${l?.length}${this.dragRenderToggle}`},(0,a.h)("div",{class:r.length?"":"values-items-only"},this.renderDefaultValue()),(0,a.h)("div",{ref:e=>{e&&(this.otherSortable?.destroy(),this.otherSortable=lt.create(e,{group:{name:"shared",pull:!1,put:!0},filter:".nodrag",sort:!1}))}},l,this.renderMsg())))}renderNoGroup(){const{strings:e}=this.smartMappingState;return(0,a.h)("div",{class:"group"},(0,a.h)("div",{class:"group-header"},(0,a.h)("div",{class:"value-part1"},(0,a.h)("div",{class:"group-handle-disabled","aria-hidden":"true"},(0,a.h)("calcite-icon",{scale:"s",icon:"drag"})),(0,a.h)("div",{class:"group-text no-group-heading",role:"button",tabIndex:0,"aria-label":e.panels.type.accessibility.editLabelFor.replace("${value}",e.panels.type.groupNameHint)},e.panels.type.groupNameHint)),(0,a.h)("div",{class:"value-part2"},this.renderGroupMenuNode(-2))),(0,a.h)("div",null,"\xa0"))}renderGroup(e,t){const i=e.classes.map(((e,i)=>this.renderValue(e,t,i)));return(0,a.h)("div",{key:e.toJSON(),class:"group","group-sort-values":`${t}`},(0,a.h)("div",{class:"group-header"},(0,a.h)("div",{class:"value-part1"},this.renderGroupHandleNode(t),this.renderGroupTextNode(e,t)),(0,a.h)("div",{class:"value-part2"},this.renderGroupCountNode(e),this.renderGroupMenuNode(t,e))),(0,a.h)("div",{ref:e=>{e&&(this.classSortable?.[t]?.destroy(),this.classSortable[t]=lt.create(e,{group:{name:"nested",pull:!0,put:["nested"]},dataIdAttr:"class-sort-values",ghostClass:"avatar",onSort:()=>this.handleSortClasses(t),handle:".class-handle"}))}},i))}renderGroupHandleNode(e){const{strings:t}=this.smartMappingState,i=this.selectedValueText===`${e}`;return(0,a.h)("div",{class:i?"group-handle-disabled":"group-handle","aria-hidden":"true",onMouseOver:a=>{const n=a.target;i||this.onMouseOver(`values-${e}-handle-tooltip`,n,t.panels.type.tooltips.dragGroup)},onMouseOut:()=>this.onMouseOut(`values-${e}-handle-tooltip`)},(0,a.h)("calcite-icon",{scale:"s",icon:"drag"}))}renderGroupTextNode(e,t){const{strings:i}=this.smartMappingState;let n=!1;return(0,a.h)(a.F,null,(0,a.h)("calcite-input",{class:"hidden",value:e.heading||"",onKeyDown:e=>{if(("Escape"===e.key||"Enter"===e.key)&&!n){e.preventDefault(),e.stopPropagation(),n=!0;const i=e.target;this.handleGroupTextChange(t,i.value)}},onFocusout:e=>{if(!n){n=!0;const i=e.target;this.handleGroupTextChange(t,i.value)}},ref:e=>{e&&(this.groupInputNodes[t]=e)}}),(0,a.h)("div",{class:"group-text group-text-active "+(e.heading?"group-heading":"no-group-heading"),role:"button",tabIndex:0,"aria-label":i.panels.type.accessibility.editLabelFor.replace("${value}",e.heading||i.panels.type.groupNameHint),onClick:()=>{this.onMouseOut(`group-${t}-text-tooltip`),this.handleGroupTextClick(t)},onMouseOver:e=>{const a=e.target;this.onMouseOver(`group-${t}-text-tooltip`,a,i.panels.type.tooltips.renameGroup)},onMouseOut:()=>this.onMouseOut(`group-${t}-text-tooltip`),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleGroupTextClick(t))},ref:e=>{e&&(this.groupTextNodes[t]=e)}},e.heading||i.panels.type.groupNameHint))}renderValue(e,t,i){return(0,a.h)("div",{key:`values-${e.label}`,class:"value","class-sort-values":`${t}/${i}`},(0,a.h)("div",{class:"value-part1"},this.renderHandleNode(t,i),this.renderCheckNode(t,i),this.renderSymbolNode(e,t,i),this.renderTextNode(e,t,i)),(0,a.h)("div",{class:"value-part2"},this.renderCountNode(e)))}renderHandleNode(e,t){const{strings:i}=this.smartMappingState,n=this.selectedValueText===`${e}/${t}`;return(0,a.h)("div",{class:n?"class-handle-disabled":"class-handle","aria-hidden":"true",onMouseOver:a=>{const n=a.target;this.onMouseOver(`values-${e}-${t}-handle-tooltip`,n,i.panels.type.tooltips.dragType)},onMouseOut:()=>this.onMouseOut(`values-${e}-${t}-handle-tooltip`)},(0,a.h)("calcite-icon",{scale:"s",icon:"drag"}))}renderCheckNode(e,t,i){const{strings:n}=this.smartMappingState,s=this.checkedClasses.find((i=>i.groupIdx===e&&i.classIdx===t));return(0,a.h)("calcite-action",{scale:"s",icon:s?"check-square":"square",text:n.panels.type.checkValue,appearance:"transparent",onClick:i=>{const a=i.currentTarget;this.handleCheck(e,t,a)},onKeyDown:t=>{-1===e&&i&&!t.shiftKey&&"Tab"===t.key&&this.actionsPopoverNode?.focusActionPad()},ref:t=>{-1===e&&i&&(this.lastOtherValueCheckNode=t)}})}renderSymbolNode(e,t,i){const{smartMappingState:n}=this,{strings:o}=n,r={"value-symbol":!0,"symbol-is-white":(0,s.av)(n,e.symbol)},l={symbol:!0,[(0,s.A)(n)]:!0,"symbol-selector--selected":this.selectedValue===`${t}/${i}`};return(0,a.h)("div",{class:r,onClick:()=>this.handleValueSymbolClick(t,i),role:"button","aria-label":o.panels.type.accessibility.editSymbolFor.replace("${value}",e.label),"aria-haspopup":"true","aria-expanded":this.selectedValue===`${t}/${i}`,onMouseOver:e=>{const a=e.target;this.onMouseOver(`values-${t}-${i}-icon-tooltip`,a,o.panels.type.tooltips.changeSymbol)},onMouseOut:()=>this.onMouseOut(`values-${t}-${i}-icon-tooltip`),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(t,i))}},(0,a.h)("div",{class:l,tabIndex:0,ref:e=>{e&&(this.symbolNodes[t]||(this.symbolNodes[t]=[]),this.symbolNodes[t][i]=e,this.afterCreateValueSymbol(t,i,e))},"aria-hidden":"true"}))}renderTextNode(e,t,i){const{smartMappingState:n}=this,{strings:o}=n;let r=!1;return(0,a.h)(a.F,null,(0,a.h)("calcite-input",{class:"hidden",value:e.label??void 0,onKeyDown:e=>{if(("Escape"===e.key||"Enter"===e.key)&&(e.preventDefault(),e.stopPropagation(),!r)){r=!0;const a=e.target;this.handleValueTextChange(t,i,a.value)}},onFocusout:e=>{if(!r){r=!0;const a=e.target;this.handleValueTextChange(t,i,a.value)}},ref:e=>{e&&(this.valueInputNodes[t]||(this.valueInputNodes[t]=[]),this.valueInputNodes[t][i]=e)}}),(0,a.h)("div",{class:"value-text",role:"button",tabIndex:0,"aria-label":o.panels.type.accessibility.editLabelFor.replace("${value}",e.label),onClick:()=>{this.onMouseOut(`value-${t}-${i}-text-tooltip`),this.handleValueTextClick(t,i)},onMouseOver:e=>{const a=e.target;this.onMouseOver(`value-${t}-${i}-text-tooltip`,a,o.panels.type.tooltips.renameType)},onMouseOut:()=>this.onMouseOut(`value-${t}-${i}-text-tooltip`),onKeyDown:e=>{if(" "===e.key||"Enter"===e.key)e.preventDefault(),e.stopPropagation(),this.handleValueTextClick(t,i);else if(!e.shiftKey&&"Tab"===e.key&&-1===t){const e=(0,s.j)(n),t=(0,b.g)(n);let i=0;e.uniqueValueGroups.forEach((e=>i+=e.classes.length));!!t?.length&&!(1===t.length&&!t[0].value)&&i<b.m||this.actionsPopoverNode.focusActionPad()}},ref:e=>{e&&(-1===t&&-1===i?this.otherTextNode=e:(this.valueTextNodes[t]||(this.valueTextNodes[t]=[]),this.valueTextNodes[t][i]=e))}},e.label?.trim().length?e.label:"\xa0\xa0\xa0\xa0\xa0\xa0"))}renderCountNode(e){const{allUniqueValues:t,strings:i}=this.smartMappingState;if(!t?.length)return(0,a.h)(a.F,null);let n;if(e.values.length>1)n=e.values.reduce(((e,t)=>e+(this.getUniqueValue(t.value)?.count||0)),0);else{const i=e.values[0].value,o=this.getUniqueValue(i);if(o&&!(0,s.M)(o.count))return(0,a.h)(a.F,null);if(!o&&t?.length){const e=this.getUniqueValue(t[0].value);if(!(0,s.M)(e?.count))return(0,a.h)(a.F,null)}n=o?o.count:0}return(0,a.h)("div",{class:"value-count","aria-label":i.panels.type.accessibility.countFor.replace("${value}",e.label)},`${n}`)}renderGroupCountNode(e){const{allUniqueValues:t,strings:i}=this.smartMappingState;if(!t?.length)return(0,a.h)(a.F,null);let n=0;return e.classes.forEach((e=>{e.values.forEach((e=>{const i=this.getUniqueValue(e.value);if(!i||(0,s.M)(i.count)){if(!i&&t?.length){const e=this.getUniqueValue(t[0].value);if(!(0,s.M)(e?.count))return}n+=i?.count??0}}))})),(0,a.h)("div",{class:"group-count","aria-label":i.panels.type.accessibility.countFor.replace("${value}",e.heading)},`${t?n:""}`)}renderGroupMenuNode(e,t){const{smartMappingState:i}=this,{strings:n}=i,o=(0,s.j)(i),r=o.uniqueValueGroups;let l,d,c=!1;if(-1===e){d=(0,b.b)(i);let e=0;o.uniqueValueGroups.forEach((t=>e+=t.classes?.length??0)),e+d.length>b.m&&(d=d.slice(0,b.m-e)),l=!!d.find(((e,t)=>!this.checkedClasses.find((e=>-1===e.groupIdx&&e.classIdx===t))))}else l=!!t?.classes?.find(((t,i)=>!this.checkedClasses.find((t=>t.groupIdx===e&&t.classIdx===i)))),c=!!t?.classes?.find((e=>e.values.length>1));return(0,a.h)("calcite-dropdown",{placement:"bottom-end",scale:"s",overlayPositioning:"absolute",ref:t=>{t&&(this.groupMenuNodes[e]=t)}},(0,a.h)("calcite-action",{slot:"trigger",scale:"s",text:n.panels.type.tooltips.options},(0,a.h)("calcite-icon",{scale:"s",icon:"ellipsis"})),(0,a.h)("calcite-dropdown-group",{"selection-mode":"none"},(0,a.h)("calcite-dropdown-item",{"icon-start":"pin-plus",label:n.panels.type.addValue,onClick:()=>this.handleAddValue(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleAddValue(e)}},n.panels.type.addValue),r.length>0&&(0,a.h)("calcite-dropdown-item",{"icon-start":"palette",label:n.panels.type.changeColors,onClick:()=>this.openSymbolStylerForGroup(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.openSymbolStylerForGroup(e)}},n.panels.type.changeColors)),(0,a.h)("calcite-dropdown-group",{"selection-mode":"none"},l&&(0,a.h)("calcite-dropdown-item",{"icon-start":"check-circle",label:n.panels.type.selectAllValues,onClick:()=>this.handleSelectAllValues(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleSelectAllValues(e)}},n.panels.type.selectAllValues),c&&(0,a.h)("calcite-dropdown-item",{"icon-start":"group-x",label:n.panels.type.separateValues,onClick:()=>this.handleSeparateValues(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleSeparateValues(e)}},n.panels.type.separateValues),e>0&&(0,a.h)("calcite-dropdown-item",{"icon-start":"arrow-bold-up",label:n.panels.type.moveUp,onClick:()=>this.handleGroupMoveUp(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleGroupMoveUp(e)}},n.panels.type.moveUp),r.length>0&&e<r.length-1&&(0,a.h)("calcite-dropdown-item",{"icon-start":"arrow-bold-down",label:n.panels.type.moveDown,onClick:()=>this.handleGroupMoveDown(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleGroupMoveDown(e)}},n.panels.type.moveDown)))}renderDefaultValue(){const{smartMappingState:e}=this,{lastDefault:t,strings:i}=e,n=(0,s.j)(e),o=n.defaultSymbol||t.defaultSymbol,r=n.defaultLabel||t.defaultLabel,l=(0,b.g)(e),d=l?this.getOtherCount(l):-1;let c=0;n.uniqueValueGroups.forEach((e=>c+=e.classes.length));const h=!!l?.length&&c<b.m,u=h&&1===l.length&&!l[0].value,p={"value-symbol":!0,"symbol-is-white":(0,s.av)(e,o)},m={symbol:!0,[(0,s.A)(e)]:!0,"symbol-selector--selected":"-1"===this.selectedValue};return(0,a.h)("div",{class:"value "+(h?"default-value":"")},(0,a.h)("div",{class:"value-part1"},(0,a.h)("calcite-switch",{class:"other-value-toggle",scale:"s",checked:!!n.defaultSymbol,onMouseOver:e=>{const t=e.target;this.onMouseOver("default-value-checkbox-tooltip",t,i.panels.type.tooltips.otherTooltip)},onMouseOut:()=>this.onMouseOut("default-value-checkbox-tooltip"),onClick:()=>this.handleDefaultCheckChange(),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleDefaultCheckChange()}}),(0,a.h)("div",{class:p,onClick:()=>this.handleValueSymbolClick(-1,0),role:"button","aria-haspopup":"true","aria-expanded":"-1/0"===this.selectedValue,"aria-label":i.panels.type.accessibility.editSymbolFor.replace("${fieldName}",r),onMouseOver:e=>{const t=e.target;this.onMouseOver("default-value-symbol-tooltip",t,i.panels.type.tooltips.changeSymbol)},onMouseOut:()=>this.onMouseOut("default-value-symbol-tooltip"),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(-1,0))}},(0,a.h)("div",{class:m,tabIndex:0,ref:e=>{e&&(this.symbolNodes[-1]||(this.symbolNodes[-1]=[]),this.symbolNodes[-1][0]=e,this.afterCreateValueSymbol(-1,0,e))},"aria-hidden":"true"})),this.renderTextNode({symbol:o,label:r},-1,-1)),(0,a.h)("div",{class:"value-part2"},d>-1?(0,a.h)("div",{class:`group-count ${(!h||u)&&"group-count-no-menu"}`,"aria-label":i.panels.type.accessibility.countFor.replace("${value}",r)},`${d}`):null,h&&!u&&this.renderDefaultMenuNode()))}renderDefaultMenuNode(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-dropdown",{placement:"bottom-end",scale:"s",overlayPositioning:"absolute",ref:e=>{e&&(this.groupMenuNodes[-1]=e)}},(0,a.h)("calcite-action",{slot:"trigger",scale:"s",text:e.panels.type.tooltips.options},(0,a.h)("calcite-icon",{scale:"s",icon:"ellipsis"})),(0,a.h)("calcite-dropdown-group",{"selection-mode":"none"},(0,a.h)("calcite-dropdown-item",{"icon-start":"check-circle",label:e.panels.type.selectAllValues,onClick:()=>this.handleSelectAllValues(-1),onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||this.handleSelectAllValues(-1)}},e.panels.type.selectAllValues)))}renderOtherValues(){const{smartMappingState:e}=this,{allUniqueValues:t}=e,i=(0,s.j)(e);if(!t?.length)return(0,a.h)(a.F,null);let n=(0,b.b)(e),o=0;i.uniqueValueGroups.forEach((e=>o+=e.classes?.length??0)),o+n.length>b.m&&(n=n.slice(0,b.m-o));return n.map(((e,t)=>this.renderOtherValue(e,t,t===n.length-1)))}renderOtherValue(e,t,i){const{strings:n}=this.smartMappingState;return(0,a.h)("div",{class:"value nodrag",key:e.toJSON()},(0,a.h)("div",{class:"value-part1"},(0,a.h)("div",{class:"value-handle-placeholder"},"\xa0"),(0,s.M)(e.values[0].value)?this.renderCheckNode(-1,t,i):(0,a.h)("div",{class:"check-placeholder"},"\xa0"),(0,a.h)("div",{class:"value-text other-value-text","aria-label":e.label},null===e.values[0].value?n.panels.type.noData:e.label)),(0,a.h)("div",{class:"value-part2"},this.renderCountNode(e)))}renderMsg(){const{smartMappingState:e}=this,{allUniqueValues:t,lastDefault:i,strings:n}=e,o=(0,s.j)(e);return t&&t.length>b.m?(0,a.h)("div",{class:"type-panel-msg"},n.panels.type.errors.tooManyValues.replace("${count}",b.m.toString())):o.uniqueValueInfos.length||t?.length?(0,a.h)(a.F,null):(0,a.h)("div",{class:"type-panel-msg"},n.panels.type.errors.noFeatures.replace("${other}",i.defaultLabel))}renderBackgroundStyle(){const{smartMappingState:e}=this,{mapImageSublayer:t}=e;return"type-size"!==(0,s.a)(e)||t?(0,a.h)(a.F,null):(0,a.h)("arcgis-smart-mapping-background-symbol",null)}renderTransparency(){if(this.hideTransparency)return(0,a.h)(a.F,null);const{smartMappingState:e}=this,t=(0,s.b)((0,s.j)(e),"opacity");return(0,a.h)("arcgis-smart-mapping-transparency",{open:!!t,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsTypeError.emit(e),onKeyDown:t=>{"type"===(0,s.a)(e)&&t.shiftKey&&"Tab"===t.key&&this.actionsPopoverNode.focusLastAction()},ref:e=>{e&&(this.transparencyNode=e)}})}renderRotation(){if(this.hideRotation)return(0,a.h)(a.F,null);const{smartMappingState:e}=this,t=(0,s.b)((0,s.j)(e),"opacity"),i=(0,s.b)((0,s.j)(e),"rotation");return(0,a.h)("arcgis-smart-mapping-rotation",{open:!t&&!!i,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsTypeError.emit(e),ref:e=>this.rotationNode=e})}renderDoneButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,a.h)("calcite-button",{slot:"footer",label:t.done,onClick:()=>this.arcgisSmartMappingPanelsTypeClose.emit("save"),appearance:"solid",width:"half",onKeyDown:t=>{"type-size"===(0,s.a)(e)&&t.shiftKey&&"Tab"===t.key&&this.actionsPopoverNode.focusLastAction()},ref:e=>this.doneButtonNode=e},t.done)}renderCancelButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,a.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{const{layer:t}=e,i=t,{originalRendererJSON:a,originalFeatureReduction:n,originalOrderBy:o}=this;this.closePopovers(),"catalog-footprint"!==i.type&&"knowledge-graph-sublayer"!==i.type&&(i.orderBy=o),(0,s.h)(e,a,n),this.arcgisSmartMappingPanelsTypeClose.emit("cancel")},appearance:"outline-fill",width:"half"},t.cancel)}addActionsPopover(){const{smartMappingState:e}=this;this.closePopovers(),this.actionsPopoverNode=document.createElement("arcgis-smart-mapping-type-actions-popover"),this.actionsPopoverNode.smartMappingState=e,this.actionsPopoverNode.referenceNode=this.flowItemNode,this.actionsPopoverNode.checkedClasses=this.checkedClasses,this.actionsPopoverNode.groupMenuNodes=this.groupMenuNodes,this.actionsPopoverNode.addEventListener("arcgisSmartMappingTypeActionsPopoverChange",(e=>{e.detail?.checkedClasses&&(this.checkedClasses=e.detail.checkedClasses,e.detail.checkedClasses.length||this.removeActionsPopover()),(0,a.f)(this.el),this.checkCluster()})),this.actionsPopoverNode.addEventListener("arcgisSmartMappingTypeActionsPopoverFocusExit",(t=>{if("bottom"===t.detail){"type"===(0,s.a)(e)?this.transparencyNode?.setFocus():this.doneButtonNode?.setFocus()}else"top"===t.detail&&(this.lastOtherValueCheckNode?this.lastOtherValueCheckNode.setFocus():this.otherTextNode.focus())})),document.body.appendChild(this.actionsPopoverNode)}afterCreateValueSymbol(e,t,i){const{smartMappingState:a}=this,{lastDefault:n,modules:o}=a,r=(0,s.j)(a),l=(0,s.G)(r,"reference-size"),d=(0,s.M)(l);let c;for(c=-1===e?r.defaultSymbol||n.defaultSymbol:r.uniqueValueGroups[e].classes[t].symbol.clone();i?.childNodes?.length;)i.removeChild(i.childNodes[0]);c&&o.symbolUtils.renderPreviewHTML(c,{size:(0,s.aw)(c,d),symbolConfig:"cim"===c.type&&"CIMPolygonSymbol"===c.data.symbol.type?{isSquareFill:!0}:void 0}).then((e=>{d&&(e.style.display="block"),i.appendChild(e)}))}checkCluster(){const{layer:e,useFeatureReduction:t}=this.smartMappingState;"featureReduction"in e&&t&&e.featureReduction&&this.arcgisSmartMappingPanelsTypeClusterRequiresUpdate.emit()}closePopovers(){this.removeActionsPopover(),(0,s.B)()}getOtherCount(e){let t=0;return e.map((e=>t+=e.count)),e.length?t:-1}getUniqueValue(e){const{allUniqueValues:t}=this.smartMappingState;if(!t)return null;const i=t.filter((t=>"<Null>"===e&&null===t.value||t.value==e));return i.length?i[0]:null}handleAddValue(e){const t=document.createElement("arcgis-smart-mapping-type-add-value");t.smartMappingState=this.smartMappingState,t.groupIdx=e,t.flowItemNode=this.flowItemNode,t.referenceNode=this.groupMenuNodes[e],t.addEventListener("arcgisSmartMappingTypeAddValuePopoverClose",(()=>{setTimeout((()=>{this.groupMenuNodes[e].setFocus()}),300),t?.parentElement?.removeChild(t)})),t.addEventListener("arcgisSmartMappingTypeAddValuePopoverNewValue",(()=>{this.updateRendererAndUI(),this.checkCluster(),setTimeout((()=>{this.groupMenuNodes[e].setFocus()}),300),t?.parentElement?.removeChild(t)})),document.body.appendChild(t)}handleCheck(e,t,i){const n=this.checkedClasses.findIndex((i=>i.groupIdx===e&&i.classIdx===t));n>-1?(this.checkedClasses.splice(n,1),i.icon="square",this.actionsPopoverNode.checkedClasses=this.checkedClasses,(0,a.f)(this.actionsPopoverNode),this.checkedClasses.length||this.removeActionsPopover()):(this.checkedClasses=[...this.checkedClasses,{groupIdx:e,classIdx:t}],i.icon="check-square",this.actionsPopoverNode?(this.actionsPopoverNode.checkedClasses=this.checkedClasses,(0,a.f)(this.actionsPopoverNode)):this.addActionsPopover())}handleDefaultCheckChange(){const{smartMappingState:e}=this,t=(0,s.j)(e);if(t.defaultSymbol)t.defaultSymbol=void 0,t.defaultLabel=void 0;else{const{lastDefault:e}=this.smartMappingState;t.defaultSymbol=e.defaultSymbol,t.defaultLabel=e.defaultLabel}this.updateRendererAndUI()}handleDrawingOrderToggle(e){const{smartMappingState:t}=this,{layer:i}=t,a=i,n=(0,s.j)(t);(0,s.B)(),n.orderByClassesEnabled=e,a.orderBy=e?void 0:this.originalOrderBy,this.updateRendererAndUI()}handleGroupMoveUp(e){this.closePopovers();const{smartMappingState:t}=this,i=(0,s.j)(t);if(e>0){const t=i.uniqueValueGroups,a=t.splice(e,1)[0];t.splice(e-1,0,a),i.uniqueValueGroups=t,this.checkedClasses=[],this.updateRendererAndUI(),this.checkCluster(),setTimeout((()=>{this.groupMenuNodes[e-1]?.setFocus()}),300)}}handleGroupMoveDown(e){this.closePopovers();const{smartMappingState:t}=this,i=(0,s.j)(t),a=i.uniqueValueGroups;if(e<a.length-1){const t=i.uniqueValueGroups,a=t.splice(e,1)[0];t.splice(e+1,0,a),i.uniqueValueGroups=t,this.checkedClasses=[],this.updateRendererAndUI(),this.checkCluster(),setTimeout((()=>{this.groupMenuNodes[e+1]?.setFocus()}),300)}}handleGroupTextChange(e,t){const{smartMappingState:i}=this,a=(0,s.j)(i),n=a.uniqueValueGroups;this.groupInputNodes[e].classList.add("hidden"),n[e].heading=t,a.uniqueValueGroups=n,this.selectedValueText=void 0,this.updateRendererAndUI(),this.groupTextNodes[e].classList.remove("hidden"),setTimeout((()=>this.groupTextNodes[e].focus()),300)}handleGroupTextClick(e){this.selectedValueText=`${e}`,this.groupTextNodes[e].classList.add("hidden"),this.groupInputNodes[e].classList.remove("hidden"),this.groupInputNodes[e].setFocus()}handleSelectAllValues(e){(0,s.B)();const{smartMappingState:t}=this,i=(0,s.j)(t);let n=0;i.uniqueValueGroups.forEach((e=>n+=e.classes?.length??0));const o=e>-1?i.uniqueValueGroups[e].classes:(0,b.b)(t);-1===e&&n+o.length>b.m&&(o.length=b.m-n),o.forEach(((t,i)=>{this.checkedClasses.find((t=>t.groupIdx===e&&t.classIdx===i))||this.checkedClasses.push({groupIdx:e,classIdx:i})})),(0,a.f)(this.el),this.actionsPopoverNode?(this.actionsPopoverNode.checkedClasses=this.checkedClasses,(0,a.f)(this.actionsPopoverNode)):this.addActionsPopover()}handleSeparateValues(e){this.closePopovers(),this.separateGroupValues(e),this.updateRendererAndUI(),this.checkCluster()}handleSortClasses(e){const t=this.classSortable?.[e].toArray()||[],{smartMappingState:i}=this,{modules:a}=i,n=(0,s.j)(i);this.closePopovers();const o=(0,b.b)(i).length;let r=0;n.uniqueValueGroups.forEach((e=>r+=e.classes?.length??0));const l=n.clone().uniqueValueGroups,d=[];l.forEach(((i,n)=>{if(n===e){const e=new a.UniqueValueGroup({heading:i.heading,classes:[]});t.forEach((t=>{const[i,a]=t.split("/").map((e=>Number.parseInt(e)));e.classes.push(l[i].classes[a])})),d.push(e)}else d.push(l[n])})),n.uniqueValueGroups=d.filter((e=>!!e.classes.length));const c=(0,b.b)(i).length;this.selectedValue=void 0,this.selectedValueText=void 0,this.checkedClasses=[],o===c&&(this.dragRenderToggle=!this.dragRenderToggle),setTimeout((()=>this.updateRendererAndUI()),300),this.checkCluster();let h=0;n.uniqueValueGroups.forEach((e=>h+=e.classes?.length??0)),r!==h&&this.checkCluster()}handleSortGroups(){const{smartMappingState:e}=this,t=this.groupSortable?this.groupSortable.toArray():[],i=(0,s.j)(e);this.closePopovers();const a=i.uniqueValueGroups,n=[];t.forEach((e=>{n.push(a[Number.parseInt(e)])})),i.uniqueValueGroups=n,this.selectedValue=void 0,this.selectedValueText=void 0,this.checkedClasses=[],this.updateRendererAndUI()}handleValueSymbolClick(e,t){if(this.symbolNodes[e][t].classList.remove("symbol-selector--selected"),this.symbolStylerOpen)this.selectedValue=void 0,this.selectedValueText=void 0,(0,s.B)(),this.symbolStylerOpen=!1;else{const i=`${e}/${t}`;this.selectedValue=this.selectedValue!==i?i:void 0,this.selectedValueText=void 0,(0,s.M)(this.selectedValue)?this.openSymbolStylerForValue(e,t):(this.symbolNodes[e][t].classList.remove("symbol-selector--selected"),(0,s.B)(),this.symbolStylerOpen=!1)}}handleValueTextChange(e,t,i){const{smartMappingState:a}=this,{allUniqueValues:n,lastDefault:o,modules:r,strings:l}=a,d=(0,s.j)(a),c=d.uniqueValueGroups;if(this.valueInputNodes[e][t].classList.add("hidden"),c?.[e]?.classes?.[t].label!==i){if(!i?.length)if(-1===e)i=this.originalRendererJSON.defaultLabel||l.panels.type.other;else{const a=n.find((i=>i.value===d.uniqueValueGroups?.[e].classes?.[t].values?.[0].value));i=a?.label||d.uniqueValueGroups?.[e].classes?.[t].label}if(-1!==e||d.defaultSymbol||(o.defaultLabel=i),-1===e)d.defaultSymbol&&(d.defaultLabel=i||o.defaultLabel);else{const o=d.uniqueValueGroups,l=(0,s.o)(a,d.field);if(i)o[e].classes[t].label=i;else{const i=o[e].classes[t].values.map((e=>{const t=e.value,i=n?.find((e=>e.value===t))?.label;return i||(l?.simpleFieldType===s.q.DATE||"date-only"===(0,s.v)(a,l?.layerField)?(0,b.d)(a,t,l):l?.simpleFieldType===s.q.NUMBER?r.intl.formatNumber(t):t)}));o[e].classes[t].label=i.join(", ")}d.uniqueValueGroups=o}}this.selectedValueText=void 0,this.updateRendererAndUI(),setTimeout((()=>{const i=-1===e&&-1===t?this.otherTextNode:this.valueTextNodes[e][t];i.classList.remove("hidden"),setTimeout((()=>i.focus()),300)}))}handleValueTextClick(e,t){this.selectedValueText=`${e}/${t}`;(-1===e&&-1===t?this.otherTextNode:this.valueTextNodes[e][t]).classList.add("hidden"),this.valueInputNodes[e][t]?.classList.remove("hidden"),this.valueInputNodes[e][t]?.setFocus()}onMouseOver(e,t,i){(0,s.ah)(),(0,s.aK)(t,i,e)}onMouseOut(e){(0,s.aL)(e)}openSymbolStylerForGroup(e){const{smartMappingState:t}=this,{strings:i}=t;(0,s.B)();const a=(0,p.c)(t,{referenceElement:this.flowItemNode,heading:i.panels.type.symbolStyle});a.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,p.r)(a),this.selectedValue=void 0,this.selectedValueText=void 0,setTimeout((()=>{this.groupMenuNodes[e]?.setFocus()}),300)})),a.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{this.selectedValue=void 0,this.selectedValueText=void 0,(0,p.r)(a),setTimeout((()=>{this.groupMenuNodes[e]?.setFocus()}),300)})),(0,p.e)(t,{groupIdx:e,popoverNode:a,onChange:()=>{this.updateRendererAndUI()}})}openSymbolStylerForValue(e,t){const{smartMappingState:i}=this,{strings:n}=i;(0,s.B)();const o=(0,p.c)(i,{referenceElement:this.flowItemNode,heading:n.panels.type.symbolStyle});o.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{const i=this.symbolNodes[e][t];this.selectedValue=void 0,this.selectedValueText=void 0,(0,p.r)(o),setTimeout((()=>{i.classList.remove("symbol-selector--selected"),this.symbolStylerOpen=!1,i.focus()}),300)})),o.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{const i=this.symbolNodes[e][t];this.selectedValue=void 0,this.selectedValueText=void 0,(0,p.r)(o),setTimeout((()=>{i.classList.remove("symbol-selector--selected"),this.symbolStylerOpen=!1,i.focus()}),300)})),(0,p.f)(i,{selectedValue:this.selectedValue,popoverNode:o,onChange:()=>{this.updateRendererAndUI(),this.rotationNode&&(0,a.f)(this.rotationNode)}}),this.symbolStylerOpen=!0,this.symbolNodes[e][t].classList.add("symbol-selector--selected")}removeActionsPopover(){this.actionsPopoverNode?.parentElement?.removeChild(this.actionsPopoverNode),this.actionsPopoverNode=void 0}separateGroupValues(e){const{smartMappingState:t}=this,i=(0,s.j)(t).uniqueValueGroups;(0,b.e)(t,i[e]),this.checkedClasses=[]}updateRendererAndUI(){const{smartMappingState:e}=this;(0,s.u)(e),(0,a.f)(this.el)}get el(){return(0,a.g)(this)}};Et.style=":host {\n  width: 100%;\n  display: none;\n}\n:host([selected]) {\n  display: flex;\n}\n\n.flow-item {\n  height: 100%;\n}\n\n.hidden {\n  display: none;\n}\n\n.type-block {\n  overflow: hidden;\n}\n\n.check-placeholder {\n  width: 32px;\n  height: 24px;\n}\n\n.type-panel-msg {\n  font-size: 80%;\n  margin: 5px;\n}\n\n.toggle-button {\n  margin-top: 2px;\n}\n\n.toggle-div {\n  padding-top: 6px;\n}\n\n.top-padding {\n  padding-top: 10px;\n}\n\n.symbol-selector {\n  background-color: rgb(255, 255, 255);\n  display: flex;\n  padding: 9px 9px;\n  justify-content: space-between;\n  align-items: center;\n  border-radius: 3px;\n  cursor: pointer;\n  transition: box-shadow 250ms ease-in-out;\n  box-shadow: 0 0 0 1px #e0e0e0;\n}\n\n.symbol-selector :last-child {\n  margin-bottom: 0;\n  svg {\n    fill: #c0c0c0;\n  }\n}\n\n.symbol-selector :hover {\n  box-shadow: 0 0 0 1px #c0c0c0;\n  svg {\n    fill: #404040;\n  }\n}\n\n.symbol-selector--selected,\n.symbol-selector--selected:hover {\n  outline: 1px solid var(--calcite-color-brand);\n  svg {\n    fill: #404040;\n  }\n}\n\n.symbol-is-white {\n  background-color: #f3f3f3;\n}\n\n.symbol-icon {\n  min-width: 26px;\n  display: flex;\n}\n\n.symbol-icon div {\n  margin: auto;\n}\n\n.symbol-icon.transparent {\n  height: 15px;\n  width: 100%;\n}\n\n.symbol-icon.transparent svg {\n  height: 15px;\n  width: 95%;\n  stroke: #e0e0e0;\n  stroke-width: 1px;\n}\n\n.group-header {\n  display: flex;\n  padding: 6px 0;\n  justify-content: space-between;\n  align-items: center;\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.group-heading {\n  font-weight: bold;\n}\n\n.no-group-heading {\n  color: rgba(50, 50, 50, 0.4);\n  font-style: italic;\n}\n\n.group {\n  border: 1px solid #e0e0e0;\n  margin: 5px 0;\n}\n\n.group-text {\n  padding: 3px 9px 0 9px;\n  word-break: break-all;\n}\n\n.group-text-active {\n  cursor: pointer;\n}\n\n.group-count {\n  padding-top: 7px;\n}\n\n.group-count-no-menu {\n  padding-right: 3px;\n}\n\n.values-items-only {\n  padding: 6px 6px;\n}\n\n.value {\n  display: flex;\n  padding: 6px 0;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.value-part1 {\n  display: flex;\n  width: -webkit-fill-available;\n  width: -moz-available;\n  align-items: center;\n  margin: 0 5px;\n}\n\n.value-part2 {\n  display: flex;\n}\n\n.group-handle,\n.class-handle {\n  color: rgba(50, 50, 50, 0.4);\n  cursor: grab;\n  width: 16px;\n  display: flex;\n}\n\n.group-handle-disabled,\n.class-handle-disabled {\n  color: #e0e0e0;\n  width: 16px;\n  display: flex;\n}\n\n.value-symbol {\n  margin: 0 5px;\n  padding: 4px;\n  cursor: pointer;\n}\n\n.value-text {\n  padding: 0 9px;\n  word-break: break-all;\n  cursor: pointer;\n}\n\n.value-count {\n  padding: 3px 3px 0 3px;\n}\n\n.menu-placeholder {\n  width: 32px;\n}\n\n.value-handle-placeholder {\n  min-width: 16px;\n}\n\n.other {\n  border: 1px solid #e0e0e0;\n}\n\n.default-value {\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.other-value-text {\n  cursor: default;\n}\n\n.other-value-toggle {\n  margin-left: 22px;\n  margin-right: 2px;\n}\n\n.symbol-styler-panel {\n  width: 328px;\n  min-height: 300px;\n}\n\n.symbol-styler-div {\n  width: 100%;\n}\n\n.avatar {\n  background-color: #f0efef;\n}\n\n.value-text:focus,\n.group-text:focus,\n.symbol:focus {\n  outline: 2px solid var(--calcite-color-brand);\n}\n"},13898:(e,t,i)=>{function a(e,t,i){t.labelFormatFunction=t=>r(e,t,i,"short-date"),t.inputFormatFunction=t=>r(e,t,i,"short-date"),t.inputParseFunction=e=>function(e,t){if(!e)return e;let i;if(t&&"system"!==t)if("unknown"===t)i=e;else{const a=new Date;i=e+(new Date(a.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(a.toLocaleString("en-US",{timeZone:t})).getTime())}else{i=e+6e4*(new Date).getTimezoneOffset()}return console.log("mapTZToUTC",e," - ",new Date(e).toISOString()," - ",new Date(i).toISOString()),i}(Date.parse(e),i)}function n(e,t){let i;if(t&&"system"!==t)if("unknown"===t)i=new Date(e).toISOString();else{const a=(new Date).getTimezoneOffset(),n=new Date(e).toLocaleString("en-US",{timeZone:t});i=new Date(new Date(n).getTime()-6e4*a).toISOString()}else{const t=(new Date).getTimezoneOffset();i=new Date(e-6e4*t).toISOString()}return i}function s(e,t,i){let a;if(t&&"system"!==t)if("unknown"===t)a=new Date(e).toISOString();else{const i=(new Date).getTimezoneOffset(),n=new Date(e).toLocaleString("en-US",{timeZone:t});a=new Date(new Date(n).getTime()-6e4*i).toISOString()}else{const t=(new Date).getTimezoneOffset();a=new Date(e-6e4*t).toISOString()}return a=i?a.substring(11,19):a.substring(11,16),a}function o(e,t){let i,a=new Date(e);if(a=new Date(a.getTime()-6e4*a.getTimezoneOffset()),t&&"system"!==t)if("unknown"===t)i=a.getTime();else{const e=new Date(a.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(a.toLocaleString("en-US",{timeZone:t})).getTime();i=a.getTime()+e}else{const e=(new Date).getTimezoneOffset();i=a.getTime()+6e4*e}return i}function r(e,t,i,a){const{modules:n}=e;let s;return s="unknown"===i?n.intl.formatDate(t,{...n.intl.convertDateFormatToIntlOptions(a||"short-date-short-time"),timeZone:"utc",timeZoneName:"shortOffset"}):n.intl.formatDate(t,{...n.intl.convertDateFormatToIntlOptions(a||"short-date-short-time"),timeZone:i}),s}i.d(t,{a:()=>a,b:()=>s,d:()=>o,u:()=>n})},58325:(e,t,i)=>{i.d(t,{a:()=>n,d:()=>a,t:()=>s});const a=(e,t)=>{let i,a="idle";const n=async(...n)=>await new Promise((s=>{switch(a){case"flushed":a="idle",i?(clearTimeout(i),s(e(...n))):s(null);break;case"invoked":clearTimeout(i),a="idle",s(e(...n));break;case"cancelled":clearTimeout(i),a="idle",s(null);break;default:i&&clearTimeout(i),a="pending",i=setTimeout((()=>{a="idle",s(e(...n))}),t)}}));return n.flush=async function(...e){return a="flushed",await n(...e)},n.invoke=async function(...e){return a="invoked",await n(...e)},n.cancel=async function(...e){return a="cancelled",await n(...e)},n.getStatus=function(){return a},n},n=(e,t)=>{let i;return async(...a)=>await new Promise((n=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,n(e(...a))}),t))}))};function s(e){return new Promise((t=>setTimeout(t,e)))}},98518:(e,t,i)=>{i.d(t,{a:()=>r,b:()=>o,g:()=>h,u:()=>s});var a=i(68180),n=i(99592);i(97127);function s(e,t){const{modules:i}=e,s=(0,n.j)(e),o=i.esriLang.clone(s.classBreakInfos);s.classBreakInfos=[],o.forEach(((i,n)=>{i=function(e,t,i,n,s){if((0,a.i)(i))if(0===i);else if(i<1){const a=Math.round(1/i);t.minValue="first"===s?Math.floor(t.minValue/i)/a:Math.round(t.minValue/i)/a,t.maxValue="last"===s?Math.ceil(t.maxValue/i)/a:Math.round(t.maxValue/i)/a,t.label=`${n>0?"> ":""}${t.minValue.toLocaleString(e.fullLocale,{maximumSignificantDigits:15})} - ${t.maxValue.toLocaleString(e.fullLocale,{maximumSignificantDigits:15})}`}else t.minValue="first"===s?Math.floor(t.minValue/i)*i:Math.round(t.minValue/i)*i,t.maxValue="last"===s?Math.ceil(t.maxValue/i)*i:Math.round(t.maxValue/i)*i,t.label=`${n>0?"> ":""}${t.minValue.toLocaleString()} - ${t.maxValue.toLocaleString()}`;return t}(e,i,t,n,0===n?"first":n===o.length-1?"last":void 0),s.addClassBreakInfo({minValue:i.minValue,maxValue:i.maxValue,symbol:i.symbol,label:i.label})}))}function o(e,t){const i=(0,n.j)(e).classBreakInfos;let a=t,s=Number.POSITIVE_INFINITY;i.forEach((e=>{a||(a=Math.max(l(e.minValue),l(e.maxValue))),s=Math.min(s,e.maxValue-e.minValue)}));const o=[];return s>1e7?(o.push(1e7),o.push(1e6),o.push(1e5),o.push(1e4),o.push(1e3),o.push(100),o.push(10),a>0&&o.push(1),a>1&&o.push(.1),a>2&&o.push(.01)):s>1e6?(o.push(1e6),o.push(1e5),o.push(1e4),o.push(1e3),o.push(100),o.push(10),a>0&&o.push(1),a>1&&o.push(.1),a>2&&o.push(.01)):s>1e5?(o.push(1e5),o.push(1e4),o.push(1e3),o.push(100),o.push(10),a>0&&o.push(1),a>1&&o.push(.1),a>2&&o.push(.01)):s>1e4?(o.push(1e4),o.push(1e3),o.push(100),o.push(10),a>0&&o.push(1),a>1&&o.push(.1),a>2&&o.push(.01)):s>1e3?(o.push(1e3),o.push(100),o.push(10),a>0&&o.push(1),a>1&&o.push(.1),a>2&&o.push(.01),a>3&&o.push(.001)):s>100?(o.push(100),o.push(10),a>0&&o.push(1),a>1&&o.push(.1),a>2&&o.push(.01),a>3&&o.push(.001),a>4&&o.push(1e-4),a>5&&o.push(1e-5)):s>10?(o.push(10),a>0&&o.push(1),a>1&&o.push(.1),a>2&&o.push(.01),a>3&&o.push(.001),a>4&&o.push(1e-4),a>5&&o.push(1e-5),a>6&&o.push(1e-6)):s>1?(a>0&&o.push(1),a>1&&o.push(.1),a>2&&o.push(.01),a>3&&o.push(.001),a>4&&o.push(1e-4),a>5&&o.push(1e-5),a>6&&o.push(1e-6)):s>.1?(a>1&&o.push(.1),a>2&&o.push(.01),a>3&&o.push(.001),a>4&&o.push(1e-4),a>5&&o.push(1e-5),a>6&&o.push(1e-6)):s>.01?(a>2&&o.push(.01),a>3&&o.push(.001),a>4&&o.push(1e-4),a>5&&o.push(1e-5),a>6&&o.push(1e-6)):s>.001?(a>3&&o.push(.001),a>4&&o.push(1e-4),a>5&&o.push(1e-5),a>6&&o.push(1e-6),a>7&&o.push(1e-7)):s>1e-4?(a>4&&o.push(1e-4),a>5&&o.push(1e-5),a>6&&o.push(1e-6),a>7&&o.push(1e-7),a>8&&o.push(1e-8)):s>1e-5&&(a>5&&o.push(1e-5),a>6&&o.push(1e-6),a>7&&o.push(1e-7),a>8&&o.push(1e-8),a>9&&o.push(1e-9)),o}function r(e){const t=(0,n.j)(e);let i=1e10;return t.classBreakInfos.forEach((e=>{i=Math.min(i,d(e.minValue)),i=Math.min(i,d(e.maxValue))})),i}function l(e){let t=1;for(;Math.round(e*t)/t!==e;)t*=10;return Math.log(t)/Math.LN10}function d(e){let t=1e-8;for(;c(Math.round(e/t)*t)===e;)t*=10;return t/10}function c(e){return Number.parseFloat(e.toPrecision(12))}function h(e){let t=0;e.forEach((e=>{(0,a.i)(e.value)?t=Math.max(l(c(e.value)),t):((0,a.i)(e.minValue)&&(t=Math.max(l(c(e.minValue)),t)),(0,a.i)(e.maxValue)&&(t=Math.max(l(c(e.maxValue)),t)),(0,a.i)(e.min)&&(t=Math.max(l(c(e.min)),t)),(0,a.i)(e.max)&&(t=Math.max(l(c(e.max)),t)))})),t=Math.min(t,3);const i=e[0],n=e[e.length-1],s=Math.min(i.minValue??i.min??i.value,n.minValue??n.min??n.value),o=Math.max(i.maxValue??i.max??i.value,n.maxValue??n.max??n.value)-s;return o/e.length<2e-7?t=8:o/e.length<2e-6?t=7:o/e.length<2e-5?t=6:o/e.length<2e-4?t=5:o/e.length<.002?t=4:o/e.length<.02?t=3:o/e.length<.2?t=Math.max(t,2):o/e.length<2&&(t=Math.max(t,1)),Math.round(t)}},66215:(e,t,i)=>{function a(e,t,i,a,n,r){const l=t?.length?o(t,i.bins[n]):s(e,t.stops,i.bins[n]);l&&(r.setAttribute("fill",l.toHex()),r.setAttribute("opacity",`${Math.max(l.a,.2)}`)),a?.push(r)}function n(e,t,i,a,n){t&&i?.forEach(((i,r)=>{const l=(n||t.histogramConfig)?.bins?.[r],d="breaks"in t?o(a||t.breaks,l):s(e,(a||t).stops,l);d&&(i.setAttribute("fill",d.toHex()),i.setAttribute("opacity",`${Math.max(d.a,.2)}`))}))}function s(e,t,i){const{modules:a}=e;if(!i)return;const n=(i.maxValue-i.minValue)/2+i.minValue;let s=t[0],o=t[t.length-1];const r=s.value,l=o.value;if(n<r)return s.color;if(n>l)return o.color;const d=t.filter((e=>e.value===n));if(d.length>0)return d[0].color;s=null,o=null,t.forEach(((e,i)=>{!s&&!o&&e.value>=n&&(s=t[i-1],o=e)}));const c=(n-s.value)/(o.value-s.value);return a.EsriColor.blendColors(s.color,o.color,c)}function o(e,t){if(!t)return;const i=(t.maxValue-t.minValue)/2+t.minValue;let a=e[0],n=e[e.length-1];if(i<a.min||i>n.max)return;const s=e.filter((e=>e.min===i));return s.length>0?s[0].color:(a=e[e.length-1],n=null,e.forEach(((t,s)=>{!n&&t.min>=i&&(a=e[s-1],n=t)})),a.color)}i.d(t,{b:()=>a,u:()=>n})},42444:(e,t,i)=>{function a(e,t){if(!e||!t)return;let i=t.assetsPath;i.endsWith("/")||(i+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${i}esri/themes/light/main.css" />`)}i.d(t,{i:()=>a})}}]);