/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-1a60c8.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-1a60c8"],{83709:(e,t,a)=>{a.r(t),a.d(t,{arcgis_category_schema_editor:()=>w,arcgis_schema_editor:()=>b,arcgis_schema_editor_category:()=>I,arcgis_schema_editor_category_row:()=>E});var i=a(19564),r=a(29259),o=a(89261),n=a(66507),s=a(96034),c=a(26408);a(98034),a(99004),a(91102),a(73807);const l=(e,t)=>{var a;return null!==(a=null==e?void 0:e.toLocaleLowerCase().replace(t.toLowerCase(),"").slice(1).split("/").length)&&void 0!==a?a:0},h=(e,t,a)=>{var i;const o=a.toLocaleLowerCase();if(null==t||t===o)return{targetCategory:e,targetIndex:1,parentCategory:null,originalPath:t};const n=t.slice(1).split("/");let s=0===t.toLocaleLowerCase().indexOf(o)?(0,r.b)("",{title:n.shift()}):"",c=null,l=e,h=0,g=s;do{s=(0,r.b)(s,{title:n.shift()}),c=l,h=l.categories.findIndex((e=>e.path.toLocaleLowerCase()===s.toLocaleLowerCase())),l=l.categories[h],g+=`/${null!==(i=null==l?void 0:l.title)&&void 0!==i?i:""}`}while(n.length>0&&l.categories.length);return g=g.replace(o,a),{targetCategory:l,targetIndex:h,parentCategory:c,originalPath:g}},g=e=>e.categories.map(d),d=e=>({title:e.title,categories:e.categories.map(d)}),m=({categoryAggregationData:e,categorySchema:t,parentPath:a,lowerCaseRootCategoryPath:i})=>t.map((t=>{var o,n,s;const c=(0,r.b)(null!=a?a:i,t),l=null===(o=e.fieldValues.find((e=>e.value===c)))||void 0===o?void 0:o.count,h=m({parentPath:c,categorySchema:null!==(n=t.categories)&&void 0!==n?n:[],categoryAggregationData:e,lowerCaseRootCategoryPath:i});return{title:null!==(s=t.displayName)&&void 0!==s?s:t.title,path:c,count:null!=l?l:0,categories:h}})),y=e=>e.reduce(((e,t)=>{var a;return e+1+y(null!==(a=t.categories)&&void 0!==a?a:[])}),0),p=({targetCategory:e,targetParentCategory:t})=>{var a;const i=null===(a=e.title.toLocaleLowerCase())||void 0===a?void 0:a.trim();return i?i.length>u?"maxCharacter":t.categories.some((t=>t.title.toLowerCase()===i&&t.path!==e.path))?"destinationHasSameName":null:"emptyTitle"},C=({rootCategoryPath:e,uiCategory:t,uiPath:a})=>h(t,a,e).originalPath,u=100,v=e=>{e.forEach((e=>{e.description&&delete e.description,e.categories?v(e.categories):e.categories=[]}))},f=e=>{const t=structuredClone(e);return v(t),t},w=class{constructor(e){(0,i.r)(this,e),this.workflowCancel=(0,i.c)(this,"workflowCancel",7),this.newSchemaWorkflowComplete=(0,i.c)(this,"newSchemaWorkflowComplete",7),this.deleteAllSchema=(0,i.c)(this,"deleteAllSchema",7),this.hasChangeSinceLastOpen=!1,this.didFetchTemplates=!1,this.templateInfo={custom:{schema:[{title:"Categories",categories:[]}]},arcgis:{schema:[],learnMoreId:"120001309",enterpriseLearnMoreId:"120001580"},iso:{schema:[],learnMoreId:"120001310",enterpriseLearnMoreId:"120001581"},inspire:{schema:[],learnMoreId:"120001311",enterpriseLearnMoreId:"120001582"}},this.fetchCategoryData=async()=>{var e,t;const{templateInfo:a,setCategorySchema:i,getCategorySchema:o,getCategoryAggregation:n,getStandardSetCategories:s,didFetchTemplates:c}=this,[{result:l},{result:h}]=await Promise.all([o(),n()]);if(null===(t=null===(e=null==l?void 0:l[0])||void 0===e?void 0:e.categories)||void 0===t?void 0:t.length)i(l),this.categoryAggregationData=h;else if(this.rootCategoryTitle=r.U.replace("/",""),this.categorySchema=[],this.newCategoryMode=!0,!c&&s){this.isFetchingTemplate=!0;const{result:e}=await s();a.arcgis.schema=e.LivingAtlas,a.iso.schema=e.ISO,a.inspire.schema=e.Inspire,this.didFetchTemplates=!0,this.isFetchingTemplate=!1}},this.setCategorySchema=e=>{this.rootCategoryTitle=e[0].title,this.categorySchema=e[0].categories},this.closeDialog=()=>{this.schemaToConfirm=null,this.hasUnsavedChanges=!1,this.workflowCancel.emit({hasChangeSinceLastOpen:this.hasChangeSinceLastOpen})},this.updateCategorySchema=async({schemaToUpdate:e,ignoreNewCategoryMode:t=!1,optimisticUpdate:a=!0})=>{const{rootCategoryTitle:i,handleError:r,fetchCategoryData:o,newCategoryMode:n,deleteAllSchema:s,deleteSchema:c,updateSchema:l}=this;if(n&&!t)return this.hasUnsavedChanges=e.length>0,this.categorySchema=e,!0;this.hasChangeSinceLastOpen=!0;const h=this.categorySchema;a&&(this.categorySchema=e);return(async()=>{if(this.error=null,0===e.length){const{error:e}=await c();return void(e?(r("generic"),a&&(this.categorySchema=h)):(this.newCategoryMode=!0,s.emit()))}const{error:t}=await l([{title:i,categories:n?f(e):e}]);t?(r("generic"),a&&(this.categorySchema=h)):(this.hasUnsavedChanges=!1,await o())})(),!0},this.handleError=e=>{const{i18n:t}=this;let a=t.error[e].message;"maxCharacter"===e&&(a=a.replace("${maxCharacter}",`${u}`)),this.error={title:t.error[e].title,message:a}},this.finishSetupNewCategorySchema=async()=>{const{newSchemaWorkflowComplete:e,categorySchema:t,updateCategorySchema:a}=this;await a({schemaToUpdate:t,ignoreNewCategoryMode:!0})&&(this.newCategoryMode=!1,e.emit({newSchema:t}))},this.renderTemplates=()=>{const{templateInfo:e,i18n:t,chosenTemplate:a,portal:r,config:o,setCategorySchema:n,customTemplateDescriptionText:s}=this,{helpBase:c,helpMap:l}=o;return(0,i.h)("div",{class:"template-container"},(0,i.h)("p",{class:"template-title"},t.template.title),(0,i.h)("calcite-tile-select-group",null,Object.keys(e).map((o=>{const{learnMoreId:h,enterpriseLearnMoreId:g}=e[o];return(0,i.h)("calcite-tile-select",{key:o,checked:a===o,description:s,heading:t.template.templateList[o].title,width:"auto",value:o,onCalciteTileSelectChange:t=>{const a=t.currentTarget.value;this.chosenTemplate=a,n(e[a].schema),this.hasUnsavedChanges="custom"!==a}},h&&(0,i.h)("calcite-link",{href:`${c}${l[r.isPortal?g:h]}`,role:"presentation",class:"template-link",iconEnd:"launch",target:"_blank",rel:"noopener noreferrer"},t.template.learnMore))}))))},this.renderConfirmationModal=()=>{const{i18n:e,handleUpdateSchemaWithCount:t,schemaToConfirm:a,lang:r,deleteConfirmMessage:n,changeTitleConfirmMessage:s}=this;if(!a)return null;const c=e.warning["delete"===a.type?"deleteInUseCategory":"changeTitleInUseCategory"],l="delete"===a.type?n:s;return(0,i.h)("calcite-dialog",{modal:!0,kind:"danger",scale:"m",width:"s",onCalciteDialogClose:e=>{e.stopPropagation(),this.schemaToConfirm=null},open:!!a,class:"confirm-modal",style:{"--calcite-modal-scrim-background":"rgba(255, 255, 255, 0.5)"},heading:c.title},(0,i.h)("div",{class:"confirm-modal-content"},(0,o.f)(r,l,a.count,{newTitle:"change-title"===a.type?a.newTitle:""})),(0,i.h)("calcite-button",{slot:"footer-end",appearance:"outline","data-id":"cancelButton",onClick:()=>{this.schemaToConfirm=null,"change-title"===a.type&&(this.categorySchema=[...this.categorySchema])}},e.cancel),(0,i.h)("calcite-button",{slot:"footer-end",appearance:"solid","data-id":"nextButton",onClick:t},c.cta))},this.handleUpdateSchemaWithCount=async()=>{const{schemaToConfirm:e,updateCategorySchema:t,updateSchemaFromPath:a,categoryAggregationData:i}=this;this.isUpdatingCategoryWithCount=!0,this.schemaToConfirm=null;await t({schemaToUpdate:e.schema})&&(await a({path:e.path,updateInfo:"delete"===e.type?{type:"delete"}:{type:"change-title",newTitle:e.newTitle}}),"change-title"===e.type&&(i.fieldValues=i.fieldValues.map((t=>{const a=e.path.toLowerCase(),i=(0,r.a)(a,e.newTitle.toLowerCase());return t.value.toLowerCase()===a?Object.assign(Object.assign({},t),{value:i}):t})),this.categoryAggregationData=Object.assign({},i))),this.isUpdatingCategoryWithCount=!1},this.getUnsavedChangesConfirmation=()=>window.confirm(this.i18n.hasUnsavedChanges),this.user=void 0,this.portal=void 0,this.config=void 0,this.canFetchCategories=void 0,this.dialogHeading=void 0,this.noticeTitle=void 0,this.noticeDescription=void 0,this.deleteConfirmMessage=void 0,this.changeTitleConfirmMessage=void 0,this.customTemplateDescriptionText=void 0,this.getDisabledWarning=void 0,this.getCategorySchema=void 0,this.getCategoryAggregation=void 0,this.getStandardSetCategories=void 0,this.updateSchema=void 0,this.deleteSchema=void 0,this.updateSchemaFromPath=void 0,this.isActive=void 0,this.newCategoryMode=!1,this.categorySchema=[],this.categoryAggregationData={fieldName:"categories",fieldValues:[]},this.hasUnsavedChanges=void 0,this.error=null,this.isFetchingSchemaOnActiveChange=!1,this.isUpdatingCategoryWithCount=!1,this.schemaToConfirm=void 0,this.rootCategoryTitle=void 0,this.isFetchingTemplate=!1,this.chosenTemplate="custom"}async componentWillLoad(){const e=await(0,n.g)(this.el);this.i18n=e[0],this.lang=e[1]}componentDidLoad(){this.handleIsActiveChange()}async handleIsActiveChange(){this.hasChangeSinceLastOpen=!1,this.chosenTemplate="custom",this.error=null,this.schemaToConfirm=null,this.isActive&&this.canFetchCategories&&(this.isFetchingSchemaOnActiveChange=!0,await this.fetchCategoryData(),this.isFetchingSchemaOnActiveChange=!1)}render(){const{newCategoryMode:e,categorySchema:t,categoryAggregationData:a,rootCategoryTitle:r,isActive:o,isFetchingSchemaOnActiveChange:n,closeDialog:s,i18n:c,updateCategorySchema:l,error:h,renderTemplates:g,chosenTemplate:d,workflowCancel:m,finishSetupNewCategorySchema:y,hasUnsavedChanges:p,handleError:C,renderConfirmationModal:u,isUpdatingCategoryWithCount:v,getUnsavedChangesConfirmation:f,dialogHeading:w,isFetchingTemplate:b,templateInfo:S,noticeTitle:I,noticeDescription:E,getDisabledWarning:D,didFetchTemplates:T}=this;return!o||n?null:(0,i.h)("calcite-dialog",{modal:!0,open:o,beforeClose:async()=>{if(p&&!f())throw new Error},onCalciteDialogClose:s,scale:"m",class:{modal:!0,"modal--large":e},outsideCloseDisabled:!0,heading:w},(0,i.h)("div",{class:"stage"},u(),(0,i.h)("calcite-alert",{icon:!0,open:!!h,label:null==h?void 0:h.title,kind:"danger",onCalciteAlertClose:()=>this.error=null},(0,i.h)("div",{slot:"message"},null==h?void 0:h.message)),(b||v)&&(0,i.h)("calcite-scrim",{loading:!0},c.loadingText),e&&S&&T&&g(),(0,i.h)("div",{class:{"inner-container":!0,"inner-container--new-category":e}},!e&&(0,i.h)("calcite-notice",{open:!0,class:"help-text"},(0,i.h)("div",{slot:"title"},I),(0,i.h)("div",{slot:"message"},E)),(0,i.h)("arcgis-schema-editor",{newCategoryMode:e,showInputByDefault:"custom"===d,canEditCategory:()=>!0,categoryAggregationData:a,categorySchema:t,rootCategoryPath:`/${r}`,canCollapseAll:!e,getDisabledWarning:D,saveNewTitle:async({newSchema:e,categoryCount:t,path:a,newTitle:i})=>t?(this.schemaToConfirm={schema:e,count:t,path:a,newTitle:i,type:"change-title"},!0):l({schemaToUpdate:e,optimisticUpdate:!1}),saveNewCategory:async({newSchema:e})=>l({schemaToUpdate:e}),onArcgisSchemaEditorDelete:async({detail:{newSchema:e,categoryCount:t,path:a}})=>t?this.schemaToConfirm={schema:e,count:t,path:a,type:"delete"}:l({schemaToUpdate:e}),onArcgisSchemaEditorListOrderChange:async({detail:{newSchema:e}})=>l({schemaToUpdate:e}),onArcgisSchemaEditorInvalidMove:({detail:{errorCode:e}})=>{C(e)},onArcgisSchemaEditorTitleInvalid:({detail:{errorCode:e}})=>{C(e)}}))),e&&(0,i.h)(i.F,null,(0,i.h)("calcite-button",{slot:"footer-end",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>{p&&!f()||m.emit()}},c.cancel),(0,i.h)("calcite-button",{slot:"footer-end",appearance:"solid","data-id":"nextButton",onClick:y,disabled:!p},c.finishSetup)))}get el(){return(0,i.d)(this)}static get watchers(){return{isActive:["handleIsActiveChange"]}}};w.style=".stage{height:100%;--tw-translate-x:0px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));overflow:hidden;display:flex}.modal{--calcite-dialog-content-space:0;--calcite-dialog-size-x:48rem;--calcite-dialog-size-y:90vh;--calcite-dialog-background-color:var(--calcite-color-background)}.modal--large{--calcite-dialog-size-x:1080px}.template-container{overflow:auto;width:20rem;padding:1rem}.template-title{margin-top:0px;margin-bottom:0px;margin-bottom:1rem;font-size:1.125rem}.template-link{font-size:0.75rem}.inner-container{overflow:auto;box-sizing:border-box;width:100%;padding:2rem}.inner-container--new-category{padding-inline-start:0.5rem;padding:1rem}.help-text{margin-bottom:0.75rem}.confirm-modal{--calcite-modal-width:32rem;--calcite-modal-height:auto}.confirm-modal-content{padding:1rem}";const b=class{constructor(e){(0,i.r)(this,e),this.arcgisSchemaEditorListOrderChange=(0,i.c)(this,"arcgisSchemaEditorListOrderChange",7),this.arcgisSchemaEditorDelete=(0,i.c)(this,"arcgisSchemaEditorDelete",7),this.arcgisSchemaEditorInvalidMove=(0,i.c)(this,"arcgisSchemaEditorInvalidMove",7),this.arcgisSchemaEditorTitleInvalid=(0,i.c)(this,"arcgisSchemaEditorTitleInvalid",7),this.prevChangeEventPayload=null,this.prevSchema=null,this.handleExpandCollapseAllClick=()=>{this.isCollapsedAll=!this.isCollapsedAll,this.itemRef.expandOrCollapseAll(this.isCollapsedAll)},this.handleListOrderChange=e=>{const{categorySchema:t,arcgisSchemaEditorListOrderChange:a,uiCategory:i,rootCategoryPath:r}=this,o=((e,{fromCategory:{path:t},toCategory:{path:a},fromIndex:i,toIndex:r},o)=>{const n=structuredClone(e),s=h(n,t,o);let c=s;t!==a&&(c=h(n,a,o));const[l]=s.targetCategory.categories.splice(i,1);return c.targetCategory.categories.splice(r,0,l),g(n)})(i,e,r);a.emit(Object.assign(Object.assign({},e),{newSchema:o})),this.prevSchema=t},this.handleDeleteClick=e=>{const{arcgisSchemaEditorDelete:t,uiCategory:a,rootCategoryPath:i}=this,r=((e,{path:t},a)=>{const i=structuredClone(e),{targetIndex:r,parentCategory:o}=h(i,t,a);return null==o||o.categories.splice(r,1),g(i)})(a,e,i);t.emit(Object.assign(Object.assign({},e),{path:C({uiPath:e.path,rootCategoryPath:i,uiCategory:a}),newSchema:r})),this.prevSchema=this.categorySchema},this.handleSaveNewTitle=async e=>{const{saveNewTitle:t,uiCategory:a,arcgisSchemaEditorTitleInvalid:i,rootCategoryPath:o}=this,n=e.path,s=p({targetParentCategory:h(a,n,o).parentCategory,targetCategory:{path:n,title:e.newTitle}});if(s)return i.emit(Object.assign(Object.assign({},e),{errorCode:s})),!1;const c=this.categorySchema,l=((e,{newTitle:t,path:a},i)=>{const r=structuredClone(e);return h(r,a,i).targetCategory.title=t,g(r)})(a,e,o),d=await t(Object.assign(Object.assign({},e),{path:C({uiPath:n,rootCategoryPath:o,uiCategory:a}),newSchema:l}));if(d){this.prevSchema=c;const{targetCategory:t,parentCategory:i}=h(a,e.path,o);t.title=e.newTitle,t.path=(0,r.b)(i.path,t)}return d},this.handleSaveNewCategory=async e=>{const{saveNewCategory:t,uiCategory:a,arcgisSchemaEditorTitleInvalid:i,rootCategoryPath:r}=this,o=e.path,{parentCategory:n,targetCategory:s}=h(a,o,r),c=p({targetParentCategory:null!=s?s:n,targetCategory:{path:o,title:e.newTitle}});if(c)return i.emit(Object.assign(Object.assign({},e),{errorCode:c})),!1;const l=this.categorySchema,d=((e,{newTitle:t,path:a},i)=>{const r=structuredClone(e),o=a.replace(/\/[^/]+$/,"");if(o){const{targetCategory:e}=h(r,o,i);e.categories.push({title:t,categories:[],count:0,path:null})}else r.categories.push({title:t,categories:[],count:0,path:null});return g(r)})(a,e,r),m=await t(Object.assign(Object.assign({},e),{newSchema:d}));return m&&(this.prevSchema=l),m},this.isMoveValid=e=>{const{maxDepth:t,arcgisSchemaEditorInvalidMove:a,prevChangeEventPayload:i,rootCategoryPath:r}=this,{fromCategory:o,toCategory:n,fromItemCategory:s}=e,{fromCategory:c,fromItemCategory:h,toCategory:g,fromIndex:d,toIndex:m}=null!=i?i:{};if(i&&c.path===o.path&&h.path===s.path&&g.path===n.path&&d===e.fromIndex&&m===e.toIndex)return this.prevChangeEventPayload=null,null;this.prevChangeEventPayload=e;const{path:y}=n;if("number"==typeof t&&y&&l(y,r)>t)return a.emit(Object.assign(Object.assign({},e),{errorCode:"maxDepthExceeded"})),!1;const C=p({targetParentCategory:n,targetCategory:s});return!C||(a.emit(Object.assign(Object.assign({},e),{errorCode:C})),!1)},this.categorySchema=void 0,this.rootCategoryPath=void 0,this.categoryAggregationData=void 0,this.showInputByDefault=!1,this.newCategoryMode=void 0,this.maxDepth=2,this.maxCategories=900,this.canCollapseAll=!0,this.canEditCategory=void 0,this.saveNewTitle=void 0,this.saveNewCategory=void 0,this.getDisabledWarning=void 0,this.isCollapsedAll=!1,this.uiCategory=void 0,this.canAddCategory=!1,this.canDeleteCategory=!1}async componentWillLoad(){const e=await(0,n.g)(this.el);this.i18n=e[0],this.categorySchemaChangeHandler()}async revertSchema(){this.categorySchema=this.prevSchema}categorySchemaChangeHandler(){const{categorySchema:e,categoryAggregationData:t,rootCategoryPath:a}=this;this.uiCategory=(({categoryAggregationData:e,categorySchema:t,rootCategoryPath:a})=>{var i,r;const o=a.toLocaleLowerCase();return{title:"",path:null,count:null!==(r=null===(i=e.fieldValues.find((e=>e.value===o)))||void 0===i?void 0:i.count)&&void 0!==r?r:0,categories:m({parentPath:null,categorySchema:t,categoryAggregationData:e,lowerCaseRootCategoryPath:o})}})({categorySchema:e,categoryAggregationData:t,rootCategoryPath:a});const i=y(e);this.canAddCategory=i<this.maxCategories,this.canDeleteCategory=!0}render(){const{uiCategory:e,rootCategoryPath:t,newCategoryMode:a,showInputByDefault:r,canAddCategory:o,canDeleteCategory:n,canEditCategory:s,canCollapseAll:c,i18n:l,isCollapsedAll:h,maxDepth:g,getDisabledWarning:d,handleExpandCollapseAllClick:m,handleListOrderChange:y,handleSaveNewTitle:p,handleSaveNewCategory:C,isMoveValid:u}=this;return(0,i.h)(i.H,{key:"b466d40a42b0a56ee9c80aa8f4c2da513b1eedf1"},c&&(0,i.h)("calcite-button",{key:"5be7991cd7cfa4626537040379234dc6006886bd",iconStart:h?"chevron-down":"chevron-up",appearance:"outline-fill",kind:"neutral",onClick:m,class:"expand-collapse-all"},h?l.expandAll:l.collapseAll),(0,i.h)("arcgis-schema-editor-category",{key:"d3197e7385ee2673b9472d08b47e2215690408b8",category:e,rootCategoryPath:t,newCategoryMode:a,showInputByDefault:r,canAddCategory:o,canDeleteCategory:n,canEditCategory:s,getDisabledWarning:d,i18n:l,maxDepth:g,isMoveValid:u,onListOrderChanged:e=>y(e.detail),onArcgisSchemaEditorInternalDeleteClick:e=>this.handleDeleteClick(e.detail),saveNewTitle:p,saveNewCategory:C,ref:e=>this.itemRef=e}))}get el(){return(0,i.d)(this)}static get watchers(){return{rootCategoryPath:["categorySchemaChangeHandler"],categorySchema:["categorySchemaChangeHandler"],categoryAggregationData:["categorySchemaChangeHandler"]}}};b.style=".expand-collapse-all{margin-bottom:1rem}";const S="arcgis-schema-editor-category-row__drag-handle",I=class{constructor(e){(0,i.r)(this,e),this.arcgisSchemaEditorInternalDeleteClick=(0,i.c)(this,"arcgisSchemaEditorInternalDeleteClick",7),this.arcgisSchemaEditorInternalDragHandleInteract=(0,i.c)(this,"arcgisSchemaEditorInternalDragHandleInteract",7),this.listOrderChanged=(0,i.c)(this,"listOrderChanged",7),this.itemRefs={},this.isSpecialDepthState=null,this.isRoot=!1,this.SORTABLE_ANIMATION_TIME=200,this.handleHandleKeyboardEvent=async({event:e,category:t})=>{var a;const i=e.code;if(!["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(i))return;const r=t.path,{sortable:o,getParentSortable:n,category:s,SORTABLE_ANIMATION_TIME:l}=this,{category:h}=null!==(a=null==n?void 0:n())&&void 0!==a?a:{category:null},g=o.toArray(),d=g.indexOf(r);let m=!1,y=d;const p=s;let C=p;const u=t;switch(g.splice(d,1),i){case"ArrowDown":y=(d+1)%(g.length+1),g.splice(y,0,r);break;case"ArrowUp":y=d-1,y<0&&(y=g.length),g.splice(y,0,r);break;case"ArrowLeft":if(!h)return;m=!1,C=h,y=h.categories.findIndex((e=>e.path===s.path));break;case"ArrowRight":const e=s.categories,t=e.length;if(t<2)return;m=!1,y=(d+1)%t,C=e[y]}const v={fromCategory:p,toCategory:C,fromItemCategory:u,fromIndex:d,toIndex:y},f=!this.isMoveValid||this.isMoveValid(v);null!==f&&f&&(m&&(o.sort(g,!0),await(0,c.t)(l)),this.listOrderChanged.emit(v))},this.renderCategoryContainer=()=>{const{category:e,rootCategoryPath:t,canAddCategory:a,isRoot:o,isCollapsed:n,isAddingCategory:s,isBeingDragged:c,canEditCategory:l,saveNewTitle:h,saveNewCategory:g,maxDepth:d,i18n:m,isMoveValid:y,canDeleteCategory:p,newCategoryMode:C,isSpecialDepthState:u,isLastInList:v,handleHandleKeyboardEvent:f,getDisabledWarning:w}=this,b=e.path,S=e.categories,I=S.length,E=I>0,D=!s,T=s||"max-depth"===u||c||!a||n,k=n||c||T&&D,x=!E||"next-depth-max"===u;return(0,i.h)("div",{class:{"arcgis-schema-editor-category__outer-category-container":!0,"arcgis-schema-editor-category__outer-category-container--last-in-list":v,"arcgis-schema-editor-category__outer-category-container--first-level":"first-level"===u,"arcgis-schema-editor-category__outer-category-container--hidden":k,"arcgis-schema-editor-category__outer-category-container--root":o}},E&&(0,i.h)("ul",{class:"arcgis-schema-editor-category__category-container",ref:e=>{this.dragContainerRef=e,this.sortable||this.initializeSortable()}},S.map(((e,r)=>{const o=e.path;return(0,i.h)("li",{class:"arcgis-schema-editor-category__row-container",key:o,"data-sortable-id":o},(0,i.h)("arcgis-schema-editor-category",{isLastInList:r===I-1,category:e,rootCategoryPath:t,newCategoryMode:C,canAddCategory:a,canDeleteCategory:p,canEditCategory:l,getDisabledWarning:w,i18n:m,maxDepth:d,isMoveValid:y,saveNewTitle:h,saveNewCategory:g,getParentSortable:()=>({sortable:this.sortable,category:this.category,getParentSortable:this.getParentSortable}),ref:e=>this.itemRefs[o]=e,onArcgisSchemaEditorInternalDragHandleInteract:e=>{e.stopPropagation(),f(e.detail)}}))}))),(0,i.h)("arcgis-schema-editor-category-row",{class:{"arcgis-schema-editor-category__new-category--hide":D},category:{categories:[],count:0,path:(0,r.b)(b,{title:"new-category"}),title:""},isCollapsible:!1,isCollapsed:!0,isNewCategory:!0,getDisabledWarning:w,canDeleteCategory:!1,canEditCategory:()=>!0,i18n:m,onArcgisSchemaEditorInternalCancelClick:()=>this.isAddingCategory=!1,saveNewTitle:async e=>{const t=await g(e);return t&&(this.isAddingCategory=!1),t},ref:e=>this.newCategoryRef=e}),(0,i.h)("div",{class:{"arcgis-schema-editor-category__add-category-btn":!0,"arcgis-schema-editor-category__add-category-btn--hide":T}},(0,i.h)("div",{class:{"arcgis-schema-editor-category__add-category-btn-divider":x}}),(0,i.h)("calcite-button",{appearance:"transparent",kind:"neutral",onClick:()=>this.isAddingCategory=!0,iconStart:"plus-circle",ref:e=>this.addCategoryButtonRef=e}),(0,i.h)("calcite-tooltip",{referenceElement:this.addCategoryButtonRef},(0,i.h)("div",null,o?m.categoryItem.addCategory:m.categoryItem.addSubcategory))))},this.category=void 0,this.rootCategoryPath=void 0,this.canAddCategory=void 0,this.canDeleteCategory=void 0,this.newCategoryMode=void 0,this.showInputByDefault=!1,this.canEditCategory=void 0,this.maxDepth=void 0,this.i18n=void 0,this.isMoveValid=void 0,this.saveNewTitle=void 0,this.saveNewCategory=void 0,this.getParentSortable=void 0,this.getDisabledWarning=void 0,this.isLastInList=!1,this.isCollapsed=!1,this.isBeingDragged=!1,this.isAddingCategory=!1,this.addCategoryButtonRef=void 0}componentWillLoad(){const e=this.category.path;this.isRoot=null===e;const t=l(e,this.rootCategoryPath);this.isSpecialDepthState=t>this.maxDepth&&!this.isRoot?"max-depth":t===this.maxDepth?"next-depth-max":1===t?"first-level":null,this.isCollapsed=this.newCategoryMode&&!this.isRoot}componentDidLoad(){this.onShowInputByDefaultChange(),this.initializeSortable()}initializeSortable(){!this.sortable&&this.dragContainerRef&&(this.sortable=s.S.create(this.dragContainerRef,{group:"arcgis-schema-editor",dataIdAttr:"data-sortable-id",animation:this.SORTABLE_ANIMATION_TIME,handle:`.${S}`,chosenClass:"arcgis-schema-editor-category-row--dragging",onSort:e=>{var t,a,i,r,o,n,s;const{from:c,to:l,oldIndex:h,newIndex:g,item:d}=e,m=()=>{c.insertBefore(d,c.children[h>g?h+1:h])},y=null===(t=c.closest("arcgis-schema-editor-category"))||void 0===t?void 0:t.category,p=null===(a=l.closest("arcgis-schema-editor-category"))||void 0===a?void 0:a.category;if(!p||!y)return void m();const C={fromCategory:y,toCategory:p,fromItemCategory:null===(i=d.querySelector("arcgis-schema-editor-category"))||void 0===i?void 0:i.category,fromIndex:h,toIndex:g},u=!this.isMoveValid||this.isMoveValid(C);if(null===u)return;if(!u)return void m();this.listOrderChanged.emit(C);(null!==(o=null===(r=y.path)||void 0===r?void 0:r.split("/").length)&&void 0!==o?o:0)!==(null!==(s=null===(n=p.path)||void 0===n?void 0:n.split("/").length)&&void 0!==s?s:0)&&1===y.categories.length&&setTimeout((()=>d.remove()),50)},setData:e=>{e.setData("foo","bar")}}))}onShowInputByDefaultChange(){this.isAddingCategory=this.newCategoryMode&&this.isRoot&&this.showInputByDefault}onIsAddingCategoryChange(){var e;null===(e=this.newCategoryRef)||void 0===e||e.reset()}async expandOrCollapseAll(e){this.isRoot||(this.isCollapsed=e),Object.values(this.itemRefs).forEach((t=>{null==t||t.expandOrCollapseAll(e)}))}async setIsBeingDragged(e){this.category.categories.length>0&&(this.isBeingDragged=e)}render(){const{category:e,canDeleteCategory:t,canEditCategory:a,isRoot:r,isCollapsed:o,i18n:n,renderCategoryContainer:s,saveNewTitle:c,isSpecialDepthState:l,arcgisSchemaEditorInternalDeleteClick:h,arcgisSchemaEditorInternalDragHandleInteract:g,getDisabledWarning:d}=this;return(0,i.h)(i.H,{key:"0c03ae32a973d57cb837a3739fd0bfe32c18f071"},!r&&(0,i.h)("arcgis-schema-editor-category-row",{key:"9003995883b624b3517f3970ad2d17f737ea6f83",category:e,isCollapsible:"max-depth"!==l,isCollapsed:o,canDeleteCategory:t,canEditCategory:e=>a({category:e,parentCategory:this.category}),getDisabledWarning:d,i18n:n,onArcgisSchemaEditorInternalDeleteClick:e=>{e.stopPropagation(),h.emit(e.detail)},onArcgisSchemaEditorInternalExpandClick:e=>this.isCollapsed=e.detail.isCollapsed,saveNewTitle:c,onArcgisSchemaEditorRowInternalDragHandleInteract:({detail:e})=>{g.emit(e)}}),s())}get el(){return(0,i.d)(this)}static get watchers(){return{showInputByDefault:["onShowInputByDefaultChange"],isAddingCategory:["onIsAddingCategoryChange"]}}};I.style=".arcgis-schema-editor-category__category-container{list-style-type:none;margin-top:0px;margin-bottom:0px;padding-inline-start:0px}.arcgis-schema-editor-category__outer-category-container{margin-top:0.5rem;padding-inline-start:1rem;padding-bottom:1rem;margin-inline-start:1rem;border-left:1px solid var(--calcite-color-border-2)}.arcgis-schema-editor-category__outer-category-container:not(:last-child){margin-bottom:1.5rem}.arcgis-schema-editor-category__outer-category-container--last-in-list{padding-bottom:0.5rem}.arcgis-schema-editor-category__outer-category-container--first-level{padding-bottom:1.5rem}.arcgis-schema-editor-category__outer-category-container--root{margin-left:0px;margin-right:0px;padding-left:0px;padding-right:0px;border-width:0px}.arcgis-schema-editor-category__outer-category-container--hidden{display:none}.arcgis-schema-editor-category__row-container:not(:last-child){margin-bottom:0.5rem}.arcgis-schema-editor-category__add-category-btn-divider{margin-inline-start:1rem;margin-top:0.5rem;height:0.75rem;border-left:1px solid var(--calcite-color-border-2)}.arcgis-schema-editor-category__add-category-btn--hide,.arcgis-schema-editor-category__new-category--hide{display:none}";const E=class{constructor(e){(0,i.r)(this,e),this.arcgisSchemaEditorRowInternalDragHandleInteract=(0,i.c)(this,"arcgisSchemaEditorRowInternalDragHandleInteract",7),this.arcgisSchemaEditorInternalDeleteClick=(0,i.c)(this,"arcgisSchemaEditorInternalDeleteClick",7),this.arcgisSchemaEditorInternalExpandClick=(0,i.c)(this,"arcgisSchemaEditorInternalExpandClick",7),this.arcgisSchemaEditorInternalCancelClick=(0,i.c)(this,"arcgisSchemaEditorInternalCancelClick",7),this.arcgisSchemaEditorRowUserDefaultsWarningClick=(0,i.c)(this,"arcgisSchemaEditorRowUserDefaultsWarningClick",7),this.onCancelEdit=()=>{const{arcgisSchemaEditorInternalCancelClick:e,isNewCategory:t}=this;t||(this.isEditing=!1),this.editedCategoryTitle=this.category.title,e.emit()},this.onSaveEdit=async()=>{const{category:e,editInputRef:t,editedCategoryTitle:a,saveNewTitle:i,setInvalid:r,isNewCategory:o}=this;if(!a)return r(),!1;if(a===e.title&&!o)return this.isEditing=!1,!0;t.status="idle";try{return await i({newTitle:a.trim(),path:e.path,categoryCount:e.count})?(o||(this.isEditing=!1),!0):(r(),!1)}catch(e){return o||(this.isEditing=!1),console.error(e),!1}},this.setInvalid=()=>{const{editInputRef:e}=this;e.status="invalid",e.setFocus()},this.category=void 0,this.i18n=void 0,this.isNewCategory=!1,this.canEditCategory=void 0,this.canDeleteCategory=void 0,this.isCollapsible=void 0,this.isCollapsed=void 0,this.saveNewTitle=void 0,this.getDisabledWarning=void 0,this.isEditing=this.isNewCategory,this.editedCategoryTitle=this.category.title,this.expandCollapseButtonRef=void 0,this.deleteButtonRef=void 0,this.editInputRef=void 0,this.cantEditIconRef=void 0,this.isInteracting=!1}async reset(){const{isNewCategory:e,category:t,canEditReason:a}=this;e&&!0===a&&(this.editedCategoryTitle=t.title,this.editInputRef.status="idle",this.isEditing=!1,await(0,c.t)(50),this.isEditing=!0,this.editInputRef.setFocus())}async setFocus(){this.editInputRef.setFocus()}componentWillLoad(){var e,t;this.canEditReason=null===(t=null===(e=this.canEditCategory)||void 0===e?void 0:e.call(this,this.category))||void 0===t||t}render(){const{category:e,isCollapsed:t,isEditing:a,isCollapsible:r,canDeleteCategory:o,canEditReason:n,i18n:s,editedCategoryTitle:c,onCancelEdit:l,onSaveEdit:h,arcgisSchemaEditorInternalExpandClick:g,isNewCategory:d,getDisabledWarning:m}=this,y=e.count,p=a?c:`${c} ${y?`(${y})`:""}`,C=!0===n,u=C&&!a&&!d&&o,v=null==m?void 0:m(e.path),f=Boolean(v);return(0,i.h)(i.H,{key:"fe60711353546c268fdba25f1f8b0fe542aa051f"},(0,i.h)("div",{key:"32f82ff9d21eb96b3804e0fa198fcf403b753082",class:"arcgis-schema-editor-category-row"},!d&&!a&&(0,i.h)("calcite-button",{key:"106f18cc4e92c4099e5a0a5c0591c263c7ea2c61",appearance:"transparent",kind:"neutral",iconStart:"drag",disabled:f,class:f?"":S,onFocus:()=>this.isInteracting=!0,onBlur:()=>this.isInteracting=!1,onKeyDown:t=>{this.isInteracting&&this.arcgisSchemaEditorRowInternalDragHandleInteract.emit({category:e,event:t})}}),r&&(0,i.h)(i.F,{key:"d1d0c71c13e4da1ec2a3b17a3e617e7261020e70"},(0,i.h)("calcite-button",{key:"8be217ae8bbf59db43179e5e520b38d147c770fc",appearance:"transparent",kind:"neutral",onClick:()=>g.emit({isCollapsed:!t}),iconStart:t||a?"chevron-up":"chevron-down",class:"cta",ref:e=>this.expandCollapseButtonRef=e}),(0,i.h)("calcite-tooltip",{key:"90b698969416a8f69a62a6479c63229f2b745222",referenceElement:this.expandCollapseButtonRef},(0,i.h)("div",{key:"6ee0d40536f47f7113540ebaba6c608214d48178",class:"btn-popover"},t?s.categoryItem.expand:s.categoryItem.collapse))),C?(0,i.h)("calcite-inline-editable",{class:"arcgis-schema-editor-category-row__inline-input",controls:!0,onKeyDown:e=>{switch(e.key){case"Escape":l();break;case"Enter":h()}},editingEnabled:a,disabled:f,afterConfirm:async()=>{if(!1===await h())throw new Error},onCalciteInlineEditableEditCancel:e=>{e.stopPropagation(),l()},onCalciteInternalInlineEditableEnableEditingChange:()=>this.isEditing=!0},(0,i.h)("calcite-input",{value:p,onCalciteInputInput:e=>this.editedCategoryTitle=e.currentTarget.value,required:!0,ref:e=>this.editInputRef=e})):(0,i.h)(i.F,null,(0,i.h)("div",{class:"arcgis-schema-editor-category-row__inline-input"},p),(0,i.h)("calcite-action",{class:"arcgis-schema-editor-category-row__cant-edit-reason",icon:"exclamation-mark-triangle-f",appearance:"transparent",label:n,ref:e=>this.cantEditIconRef=e,text:"",textEnabled:!1}),(0,i.h)("calcite-tooltip",{referenceElement:this.cantEditIconRef},(0,i.h)("div",{class:"btn-popover"},n))),u&&(0,i.h)(i.F,{key:"862c83f36118fed94cb70c4ed4fa7bbd3f13a8df"},(0,i.h)("calcite-button",{key:"25b3093707f18a1705a3e0103b3b959596a1a3ae",appearance:"transparent",kind:"danger",disabled:f,onClick:()=>this.arcgisSchemaEditorInternalDeleteClick.emit({path:e.path,categoryCount:y}),iconStart:"trash",class:"cta",ref:e=>this.deleteButtonRef=e}),(0,i.h)("calcite-tooltip",{key:"4f72e3bd6f94abc6579044a809ac023fcd02c34d",referenceElement:this.deleteButtonRef},(0,i.h)("div",{key:"fb3432026eed15102ca2735033e21474c234a23d",class:"btn-popover"},s.categoryItem.deleteCategory))),f&&(0,i.h)(i.F,{key:"2ba09c6de96e707ab7e12ebf888e0bfe28973e22"},(0,i.h)("calcite-action",{key:"2bf358a7c735290ca456bd84fa21f4ad16d78364",class:"arcgis-schema-editor-category-row__cant-edit-reason",icon:"exclamation-mark-triangle-f",appearance:"transparent",ref:e=>this.cantEditIconRef=e,text:v,onClick:()=>{this.arcgisSchemaEditorRowUserDefaultsWarningClick.emit()}}),(0,i.h)("calcite-tooltip",{key:"f8a0574c6193f6e17bc989ca6ab0480bbfa24e4d",referenceElement:this.cantEditIconRef},(0,i.h)("div",{key:"3a93c585f49cd6e2434c6872ea6bc2f042005322",class:"btn-popover"},v)))))}get el(){return(0,i.d)(this)}};E.style=".arcgis-schema-editor-category-row{display:flex;align-items:center;background-color:var(--calcite-color-foreground-1);height:2.5rem}.arcgis-schema-editor-category-row--editing{padding-left:0.5rem;padding-right:0.5rem}.arcgis-schema-editor-category-row__inline-input{font-size:0.875rem;width:100%}.arcgis-schema-editor-category-row__cta{display:flex;align-items:center;justify-content:center;height:100%;width:2.5rem}.arcgis-schema-editor-category-row__drag-handle{height:100%}.arcgis-schema-editor-category-row__btn-popover{white-space:nowrap;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem}.arcgis-schema-editor-category-row__cant-edit-reason{--calcite-ui-icon-color:var(--calcite-color-status-warning)}.arcgis-schema-editor-category-row--dragging{opacity:0.25}"},29259:(e,t,a)=>{a.d(t,{U:()=>i,a:()=>n,b:()=>r,g:()=>o});const i="/Categories",r=(e,t,a=!0)=>{const i=null!=e?e:"";return`${i}${i.endsWith("/")?"":"/"}${a?t.title.toLocaleLowerCase():t.title}`};function o(e){var t;let a=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.title;return a&&"/"!==a.charAt(0)&&(a=`/${a}`),a||i}const n=(e,t)=>`${e.replace(/\/([^\/]+)$/,`/${t}`)}`},26408:(e,t,a)=>{a.d(t,{a:()=>l,b:()=>d,c:()=>r,d:()=>i,e:()=>n,f:()=>o,g:()=>h,h:()=>m,i:()=>y,m:()=>s,t:()=>c,u:()=>g});const i=(e,t)=>{let a,i="idle";const r=(...r)=>new Promise((o=>{switch(i){case"flushed":i="idle",a?(clearTimeout(a),o(e(...r))):o(null);break;case"invoked":clearTimeout(a),i="idle",o(e(...r));break;case"cancelled":clearTimeout(a),i="idle",o(null);break;default:a&&clearTimeout(a),i="pending",a=setTimeout((()=>(i="idle",o(e(...r)))),t)}}));return r.flush=function(...e){return i="flushed",r(...e)},r.invoke=function(...e){return i="invoked",r(...e)},r.cancel=function(...e){return i="cancelled",r(...e)},r.getStatus=function(){return i},r},r=(e,t)=>{let a;return(...i)=>new Promise((r=>{a||(a=setTimeout((()=>{clearTimeout(a),a=void 0,r(e(...i))}),t))}))};function o(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function n(e){return null!=e}async function s(e,t){return await Promise.all([e,c(t)]),e}function c(e){return new Promise((t=>setTimeout(t,e)))}const l=(e,t)=>Object.fromEntries((e||[]).map((e=>{const{key:a,data:i}=t(e);return[a,i]}))),h=(e,t)=>e.length===t.length&&e.reduce(((e,a)=>e&&t.indexOf(a)>-1),!0);function g(e,t){const a=[],i={};return e.forEach((e=>{const r=t(e);null==i[r]&&(i[r]=e,a.push(e))})),a}function d(e){const t={boolean:{},number:{},string:{}},a=[];return e.filter((e=>{let i=typeof e;return i in t?!t[i].hasOwnProperty(e)&&(t[i][e]=!0):!(a.indexOf(e)>=0)&&a.push(e)}))}const m=(e,t)=>[...Array(Math.ceil(e.length/t))].map(((a,i)=>e.slice(t*i,t+t*i))),y=(e,t)=>e.includes(t)}}]);