/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-23e7f1.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-23e7f1"],{37660:(e,t,o)=>{o.r(t),o.d(t,{arcgis_sketch_layer_editor_content:()=>u,arcgis_sketch_layer_editor_shortcuts:()=>g,arcgis_sketch_layer_editor_snapping:()=>m,arcgis_sketch_layer_editor_tools:()=>y});var s=o(28614),i=o(68180),l=o(52868),r=o(97127),n=o(89826),c=o(98450),a=o(58325),h=o(71480);o(48843);const d=["#ff4040","#ff8202","#faa83e","#ffd159","#73b566","#008977","#33e3c8","#43abeb","#4b64c9","#9868ed","#b055e6","#db5181","#e03b99","#2b2b2b","#bdbdbd","#ffffff"],p=["#ffffff","#bdbdbd","#2b2b2b","#e03b99","#db5181","#b055e6","#9868ed","#4b64c9","#43abeb","#33e3c8","#008977","#73b566","#ffd159","#faa83e","#ff8202","#ff4040"],u=class{constructor(e){(0,s.r)(this,e),this.arcgisGraphicUpdates=(0,s.c)(this,"arcgisGraphicUpdates",7),this.arcgisPanelLoader=(0,s.c)(this,"arcgisPanelLoader",7),this.arcgisDisablePanel=(0,s.c)(this,"arcgisDisablePanel",7),this.arcgisActiveSymbolChange=(0,s.c)(this,"arcgisActiveSymbolChange",7),this.manager=(0,r.u)(this),this.sketchLayerEditorState=(0,c.u)(),this.divNodes=[],this.symbolNodes=[],this.suggestedFillColors=[],this.savedColors=[],this.percentLabelFlip=!1,this.narrow=!1,this.resizeObserver=new ResizeObserver((e=>{const t=e.pop();this.narrow=t.contentRect.width<=275,(0,s.f)(this.el)})),this.updateRotation=(0,a.d)((()=>{if(!this.rotationEl)return;clearTimeout(this.rotationValueHandle);const e=Number.parseInt(this.rotationEl.value);!e||e<this.rotationEl.min||e>this.rotationEl.max?this.rotationValueHandle=setTimeout((()=>this.handleTextPropChange(this.rotationEl,"rotation")),3e3):this.handleTextPropChange(this.rotationEl,"rotation")}),500),this.flowEl=void 0,this.symbolStylerRefElement=void 0,this.currentSketchInfo=void 0,this.hideSvgUploadSymbols=!1,this.hideAddStyles=!1,this.reRender=!0}popupUpdatedHandler({detail:{mapNotesPopuptemplate:e}}){this.currentSketchInfo.popup=e,this.arcgisGraphicUpdates.emit({type:"popup"})}async rerender(e){this.closeFontPopover(),(0,i.i)(e)&&(this.storageId=this.currentSketchInfo.tool?["circle","rectangle"].includes(e)?"arcgis-sketch-recent-polygon-symbols":`arcgis-sketch-recent-${e}-symbols`:"arcgis-sketch-recent-point-symbols",this.recentSymbols=(0,n.g)(this.storageId,!0)),this.reRender=!this.reRender,this.sketchPopupFlowItem&&(this.flowEl.back(),this.sketchPopupFlowItem?.parentElement?.removeChild(this.sketchPopupFlowItem),this.sketchPopupFlowItem=void 0);const{tool:t}=this.currentSketchInfo;"point"===t?this.startPointEdit():"polyline"===t?this.startPolylineEdit():["circle","polygon","rectangle"].includes(t)&&this.startPolygonEdit()}async componentWillLoad(){const{sketchLayerEditorState:e}=this;this.arcgisPanelLoader.emit(!0),await this.loadAllModules(),d.forEach((e=>this.suggestedFillColors.push(new this.modules.Color(e)))),p.forEach((e=>this.savedColors.push(new this.modules.Color(e)))),this.mapView=e.mapView,this.currentLanguage=e.currentLanguage,this.portal=e.portal,this.flowEl||(this.flowEl=(0,i.q)(this.el,"calcite-flow"));const t=this.currentSketchInfo.tool?["circle","rectangle"].includes(this.currentSketchInfo.tool)?"arcgis-sketch-recent-polygon-symbols":`arcgis-sketch-recent-${this.currentSketchInfo.tool}-symbols`:"arcgis-sketch-recent-point-symbols",o=(0,n.g)(t,!0);o&&(this.recentSymbols=[...o]);const s=(0,r.a)(this.el),l=new Intl.NumberFormat(this.currentLanguage,{style:"percent"}).format(0);this.percentLabelFlip="rtl"===s?l.endsWith("%"):l.startsWith("%")}componentDidLoad(){this.arcgisPanelLoader.emit(!1),this.flowEl&&this.resizeObserver.observe(this.flowEl)}disconnectedCallback(){clearTimeout(this.fontSizeValueHandle),clearTimeout(this.rotationValueHandle),clearTimeout(this.haloSizeValueHandle),clearTimeout(this.borderLineSizeValueHandle),this.flowEl&&this.resizeObserver.unobserve(this.flowEl),this.removeResetTooltip()}render(){return this.divNodes=[],this.symbolNodes=[],(0,s.h)(s.H,{key:"902136c07bef52f11a9c5d3f93b2e70ac47c8d78"},(0,s.h)("div",{key:"ad5c956dbc398c9b921ec92a7fc20b598491556e"},this.renderFeatureInfoBlock(),this.renderStyleInfoBlock()))}renderFeatureInfoBlock(){const e=this.getFeatureInfoHeading();return(0,s.h)("calcite-block",{heading:e,open:!0,collapsible:!0},this.renderSketchTitle(),this.renderPopupBtn())}renderStyleInfoBlock(){const{sketchLayerEditorState:e}=this,{strings:t}=e,o=this.currentSketchInfo.graphics&&this.currentSketchInfo.graphics.length>1,i=this.currentSketchInfo.graphics?.[0].geometry.type,l=this.currentSketchInfo.graphics?.every((e=>i===e.geometry.type)),r=this.currentSketchInfo.graphics?.some((e=>"text"===e.symbol?.type))&&!this.currentSketchInfo.graphics?.every((e=>"text"===e.symbol?.type)),n=!o||l&&!r;return(0,s.h)("div",{class:"style-info-wrapper"},(0,s.h)("div",{class:"style-info-block"},(0,s.h)("calcite-label",{class:"style-title"},t.style),n&&this.renderRecentSymbols(),!n&&this.renderNoStyleMessage()),n&&this.renderSymbolStyler())}renderRecentSymbols(){const{sketchLayerEditorState:e}=this,{strings:t}=e;let o;switch(this.currentSketchInfo.tool){case"polyline":o=t.line;break;case"polygon":case"circle":case"rectangle":o=t.polygon;break;case"text":o=t.text;break;default:o=t.point}return o=o.toLocaleLowerCase(),(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,t.recentSymbols.replace("${tool}",o)),(0,s.h)("div",{class:"recent-symbols-wrapper",ref:e=>this.recentSymbolsContainerEl=e},this.recentSymbols?.length?(0,s.h)(s.F,null,(0,s.h)("div",{class:"recent-symbols-symbol-group"},this.recentSymbols.map(((e,t)=>e?(0,s.h)("div",{key:"symbol",class:"recent-symbol",tabindex:"0",onClick:()=>this.handleRecentSymbolSelect(t),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleRecentSymbolSelect(t))},ref:o=>{o&&(this.divNodes[t]=o,this.afterCreateRecentSymbolDiv(o,e,t))}}):null))),(0,s.h)("div",{class:"recent-symbols-divider-wrapper"},(0,s.h)("div",{class:"recent-symbols-divider"})),(0,s.h)("div",{class:"recent-symbols-reset-button-wrapper"},(0,s.h)("calcite-action",{scale:"s",icon:"reset",text:t.clearRecentSymbols,onClick:()=>{const e=this.currentSketchInfo.tool?["circle","rectangle"].includes(this.currentSketchInfo.tool)?"arcgis-sketch-recent-polygon-symbols":`arcgis-sketch-recent-${this.currentSketchInfo.tool}-symbols`:"arcgis-sketch-recent-point-symbols";this.recentSymbols=[],(0,n.s)(e,this.recentSymbols,!0),(0,s.f)(this.el)},onFocus:()=>this.addResetTooltip(),onFocusout:()=>this.removeResetTooltip(),onMouseOver:()=>this.addResetTooltip(),onMouseOut:()=>this.removeResetTooltip(),ref:e=>this.resetRecentSymbolsNode=e}))):(0,s.h)("div",{key:"no-recent-symbol",class:"no-recent-symbols"},t.noRecentSymbols.replace("${tool}",o))))}renderSymbolStyler(){switch(this.currentSketchInfo.tool){case"point":return this.renderPoint();case"polyline":return this.renderPolyline();case"polygon":case"rectangle":case"circle":return this.renderPolygon();case"text":return this.renderText();default:return(0,s.h)(s.F,null)}}renderNoStyleMessage(){const{sketchLayerEditorState:e}=this,{strings:t}=e;return(0,s.h)("calcite-label",null,t.noStyleMessage)}renderSketchTitle(){const{sketchLayerEditorState:e}=this,{strings:t}=e;return(0,s.h)("calcite-label",null,t.featureName,(0,s.h)("calcite-input-text",{alignment:"start",placeholder:t.enterFeatureNamePlaceholder,value:this.currentSketchInfo.title,onBlur:e=>{this.currentSketchInfo.title=e.target.value,this.arcgisGraphicUpdates.emit({type:"title"})}}))}renderPopupBtn(){const{sketchLayerEditorState:e}=this,{strings:t}=e,o=window.customElements?.get("arcgis-popup");if(!o)return(0,s.h)(s.F,null);const l="rtl"===(0,r.a)(this.el),n=this.currentSketchInfo.graphics&&this.currentSketchInfo.graphics.length>1;return(0,s.h)("calcite-button",{alignment:"icon-end-space-between",appearance:"outline-fill",kind:"neutral",iconStart:"configure-popup",iconEnd:l?"chevron-left":"chevron-right",label:t.popup,width:"full",scale:"l",class:"sketch-popup-button",onClick:e=>{if(e.stopPropagation(),!this.sketchPopupFlowItem){this.sketchPopupFlowItem=document.createElement("calcite-flow-item"),this.sketchPopupFlowItem.heading=t.sketch,this.sketchPopupFlowItem.description=t.popup;const e=document.createElement("calcite-fab");e.icon="plus",e.slot="fab",e.scale="s",e.appearance="outline-fill",e.kind="neutral",e.label=t.addContent,e.text=t.addContent,e.textEnabled=!0,this.sketchPopupFlowItem.appendChild(e);const o=document.createElement("arcgis-popup");if(o.lang=this.currentLanguage,o.mapView=this.mapView,o.portal=this.portal,o.layerDisplayType=i.l.mapNotes,o.mapNotesGraphic=this.currentSketchInfo.graphics?.[0],o.mapNotesPopupTemplate=this.currentSketchInfo.popup,o.calciteFlowProps={flow:this.flowEl,calciteFab:e,calciteFlowItem:this.sketchPopupFlowItem},this.sketchPopupFlowItem.addEventListener("calciteFlowItemBack",(()=>{this.flowEl.removeChild(this.sketchPopupFlowItem),this.flowEl.childNodes[this.flowEl.childNodes.length-1].selected=!0})),this.sketchPopupFlowItem.appendChild(o),this.flowEl.appendChild(this.sketchPopupFlowItem),this.flowEl.childNodes.forEach((e=>e.selected=!1)),this.sketchPopupFlowItem.selected=!0,this.sketchPopupFlowItem.addEventListener("calciteFlowItemBack",(e=>{e.stopPropagation(),this.mapView.closePopup(),this.sketchPopupFlowItem?.parentElement?.removeChild(this.sketchPopupFlowItem),this.sketchPopupFlowItem=void 0})),n){o.multiplePopupsSelected=!0,o.disableEditing=!0;const e=document.createElement("calcite-button");e.label=t.applyChanges,e.innerHTML=t.applyChanges,e.scale="l",e.slot="footer",this.sketchPopupFlowItem.append(e),e.addEventListener("click",(()=>{this.alertEl&&(this.alertEl.parentElement?.removeChild(this.alertEl),this.alertEl=void 0),o.disableEditing=!1,o.update(),e.kind="neutral",e.disabled=!0,this.alertEl=document.createElement("calcite-alert"),this.alertEl.kind="success",this.alertEl.icon="check-circle";const s=document.createElement("div");s.slot="message",s.innerHTML=t.changesApplied,this.alertEl.append(s),this.alertEl.open=!0,document.body.append(this.alertEl),this.alertEl.addEventListener("calciteAlertClose",(()=>{this.alertEl.parentElement?.removeChild(this.alertEl),this.alertEl=void 0}))})),o.addEventListener("bulkPopupUpdated",(()=>{e.kind="brand",e.disabled=!1}))}o.addEventListener("popupUpdated",(e=>this.popupUpdatedHandler(e))),this.sketchPopupFlowItem.setFocus(),this.sketchPopupFlowItem.beforeBack=async()=>await o.done(),this.mapView.closePopup(),this.currentSketchInfo.graphics?.length&&this.currentSketchInfo.popup&&this.mapView.openPopup({features:[this.currentSketchInfo.graphics[0]],location:(0,i.m)(this.currentSketchInfo.graphics[0].geometry)})}}},t.popup)}renderPoint(){const e=this.currentSketchInfo.graphics&&this.currentSketchInfo.graphics.length>1,t=this.currentSketchInfo.graphics?.[0].geometry?.type,o=this.currentSketchInfo.graphics?.every((e=>t===e.geometry?.type)),i=this.currentSketchInfo.graphics?.[0].symbol?.type,l=this.currentSketchInfo.graphics?.every((e=>i===e.symbol?.type));return(0,s.h)("arcgis-symbol-styler",{class:"symbol-styler",displaySymbolsSelectionOnly:e&&o&&!l,mode:e?"minimal":"default",key:"point-styler",lang:this.currentLanguage,initialSourceId:this.currentSketchInfo.sourceIds.pointSourceId,hideSvgUploadSymbols:this.hideSvgUploadSymbols,hideAddStyles:this.hideAddStyles,ref:e=>{e&&this.currentSketchInfo.symbol&&(this.pointStyler=e,this.startPointEdit())},popoverProps:this.getPopoverProps(),onArcgisEdit:({detail:{symbol:e,symbolSwitch:t}})=>this.updateSymbol(e,t),onArcgisSourceIdChange:({detail:e})=>this.currentSketchInfo.sourceIds.pointSourceId=e})}renderPolyline(){const e=this.currentSketchInfo.graphics&&this.currentSketchInfo.graphics.length>1,t=this.currentSketchInfo.graphics?.[0].geometry?.type,o=this.currentSketchInfo.graphics?.every((e=>t===e.geometry?.type)),i=this.currentSketchInfo.graphics?.[0].symbol?.type,l=this.currentSketchInfo.graphics?.every((e=>i===e.symbol?.type));return(0,s.h)("arcgis-symbol-styler",{class:"symbol-styler",displaySymbolsSelectionOnly:e&&o&&!l,mode:e?"minimal":"default",key:"polyline-styler",lang:this.currentLanguage,initialSourceId:this.currentSketchInfo.sourceIds.polylineSourceId,hideSvgUploadSymbols:this.hideSvgUploadSymbols,hideAddStyles:this.hideAddStyles,ref:e=>{e&&this.currentSketchInfo.symbol&&(this.polylineStyler=e,this.startPolylineEdit())},popoverProps:this.getPopoverProps(),onArcgisEdit:({detail:{symbol:e,symbolSwitch:t}})=>this.updateSymbol(e,t),onArcgisSourceIdChange:({detail:e})=>this.currentSketchInfo.sourceIds.polylineSourceId=e})}renderPolygon(){const e=this.currentSketchInfo.graphics&&this.currentSketchInfo.graphics.length>1,t=this.currentSketchInfo.graphics?.[0].geometry?.type,o=this.currentSketchInfo.graphics?.every((e=>t===e.geometry?.type)),i=this.currentSketchInfo.graphics?.[0].symbol?.type,l=this.currentSketchInfo.graphics?.every((e=>i===e.symbol?.type));return(0,s.h)("arcgis-symbol-styler",{class:"symbol-styler",displaySymbolsSelectionOnly:e&&o&&!l,mode:e?"minimal":"default",key:"polygon-styler",lang:this.currentLanguage,initialSourceId:this.currentSketchInfo.sourceIds.polygonSourceId,hideSvgUploadSymbols:this.hideSvgUploadSymbols,hideAddStyles:this.hideAddStyles,ref:e=>{e&&this.currentSketchInfo.symbol&&(this.polygonStyler=e,this.startPolygonEdit())},popoverProps:this.getPopoverProps(),onArcgisEdit:({detail:{symbol:e,symbolSwitch:t}})=>this.updateSymbol(e,t),onArcgisSourceIdChange:({detail:e})=>this.currentSketchInfo.sourceIds.polygonSourceId=e})}renderText(){return(0,s.h)("div",{class:"text-content"},this.renderTextContent(),this.renderFontFamilySelection(),this.renderTextFontSize(),this.renderTextColor(),this.renderTextRotation(),this.renderTextHaloBlock(),this.renderTextBackgroundColorBlock())}renderTextContent(){const{sketchLayerEditorState:e}=this,{strings:t}=e,o=this.currentSketchInfo.symbol;let i,l;return this.textContentEl&&(i=o?.text,l=this.currentSketchInfo.graphics?.every((e=>i===e.symbol.text))),(0,s.h)("calcite-label",null,t.content,(0,s.h)("calcite-text-area",{resize:"vertical",placeholder:t.textContentPlaceholder,value:l?o?.text:"",onCalciteTextAreaInput:e=>{e.stopPropagation();const t=o?.clone();t.text=e.target.value,this.updateSymbol(t,!1,!1,"text")},ref:e=>this.textContentEl=e}))}renderFontFamilySelection(){const{sketchLayerEditorState:e}=this,{strings:t}=e,o=window.customElements?.get("arcgis-font-picker");if(!o)return(0,s.h)(s.F,null);const i=this.currentSketchInfo.symbol;return(0,s.h)("calcite-label",null,t.font,(0,s.h)("calcite-button",{alignment:"icon-end-space-between",appearance:"outline-fill",kind:"neutral",iconEnd:"chevron-down",label:(0,l.f)(i?.font||{family:"Arial",style:"normal",weight:"normal"}),width:"full",onClick:()=>this.openFontPopover()},(0,l.f)(i?.font)))}renderTextFontSize(){const{sketchLayerEditorState:e}=this,{strings:t}=e,o=this.currentSketchInfo.symbol;return(0,s.h)("calcite-label",null,t.size,(0,s.h)("calcite-input-number",{scale:"s",inputMode:"decimal",min:5,max:125,value:""+((0,i.i)(o?.font?.size)?o.font.size/.75:5),onCalciteInputNumberInput:e=>{clearTimeout(this.fontSizeValueHandle),e.stopPropagation();const t=Number.parseInt(this.fontSizeEl.value);!t||t<this.fontSizeEl.min||t>this.fontSizeEl.max?this.fontSizeValueHandle=setTimeout((()=>this.handleTextPropChange(this.fontSizeEl,"font-size")),3e3):this.handleTextPropChange(this.fontSizeEl,"font-size")},ref:e=>this.fontSizeEl=e}))}renderTextColor(){const{sketchLayerEditorState:e,modules:t}=this,{strings:o}=e,l=this.currentSketchInfo.symbol;return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,o.color,(0,s.h)("arcgis-color-input",{color:l?.color?.toHex()||"#ffffff",popoverProps:this.getPopoverProps(),storageId:"arcgis-symbol-styler-storage-colors",onArcgisChange:e=>{const o=l?.clone(),s=l?.color?.a??1;o.color=new t.Color(e.target.color),o.color.a=s,this.updateSymbol(o,!1,!1,"color",!1,!0)},onArcgisPickerClose:e=>{const o=e.detail;if(o){const e=l?.clone(),s=l?.color?.a??1;e.color=new t.Color(o),e.color.a=s,this.updateSymbol(e,!1,!1,"color")}},onArcgisSwatchUpdate:e=>{const o=e.detail;if(o){const e=l?.clone(),s=l?.color?.a??1;e.color=new t.Color(o),e.color.a=s,this.updateSymbol(e,!1,!1,"color")}}})),(0,s.h)("calcite-label",null,o.transparency,(0,s.h)("arcgis-slider-input",{min:0,max:100,step:1,unitsLabel:"%",flipLabels:this.percentLabelFlip,value:Math.round((0,i.k)(l?.color?.a??1)),onArcgisValueChange:e=>{const t=e.detail,o=(0,i.t)(t),s=l?.clone();s.color.a=o,this.updateSymbol(s,!1,!1,"color-transparency")},withSteppers:!this.narrow,label:o.transparency})))}renderTextRotation(){const{sketchLayerEditorState:e}=this,{strings:t}=e,o="rtl"===(0,r.a)(this.el),i=this.currentSketchInfo.symbol;return(0,s.h)("calcite-label",null,t.rotation,(0,s.h)("div",{class:"rotation"},(0,s.h)("calcite-slider",{min:0,max:360,value:i?.angle||0,step:1,onCalciteSliderInput:e=>this.handleTextRotationSliderValueChange(e.target.value,!0),onCalciteSliderChange:e=>this.handleTextRotationSliderValueChange(e.target.value,!1)}),(0,s.h)("calcite-input-number",{scale:"s",inputMode:"decimal",min:0,max:360,suffixText:o?"":"\xba",prefixText:o?"\xba":"",step:1,value:`${i?.angle||0}`,onCalciteInputNumberInput:this.updateRotation,ref:e=>this.rotationEl=e})))}renderTextHaloBlock(){const{modules:e,sketchLayerEditorState:t}=this,{strings:o}=t,l=this.currentSketchInfo.symbol;return(0,s.h)("calcite-block-section",{ref:e=>this.haloBlockSectionEl=e,text:o.halo,toggleDisplay:"switch",open:!!l?.haloColor,onCalciteBlockSectionToggle:t=>{t.stopPropagation();const o=l?.clone();this.haloBlockSectionEl.open?(o.haloColor=this.tempHaloColor??new e.Color("white"),o.haloSize=o?.haloSize??.75):(this.tempHaloColor=o.haloColor,o.haloColor=void 0),this.updateSymbol(o,!1,!1,"halo")}},(0,s.h)("div",{class:"halo-block"},(0,s.h)("calcite-label",null,o.color,(0,s.h)("arcgis-color-input",{color:l?.haloColor?.toHex()||"#ffffff",popoverProps:this.getPopoverProps(),storageId:"arcgis-symbol-styler-storage-colors",onArcgisChange:t=>{const o=l?.clone(),s=l?.haloColor?.a??1;o.haloColor=new e.Color(t.target.color),o.haloColor.a=s,this.updateSymbol(o,!1,!1,"halo-color")},onArcgisPickerClose:t=>{const o=t.detail;if(o){const t=l?.clone(),s=l?.haloColor?.a??1;t.haloColor=new e.Color(o),t.haloColor.a=s,this.updateSymbol(t,!1,!1,"halo-color")}},onArcgisSwatchUpdate:t=>{const o=t.detail;if(o){const t=l?.clone(),s=l?.haloColor?.a??1;t.haloColor=new e.Color(o),t.haloColor.a=s,this.updateSymbol(t,!1,!1,"halo-color")}}})),(0,s.h)("calcite-label",null,o.transparency,(0,s.h)("arcgis-slider-input",{min:0,max:100,step:1,unitsLabel:"%",flipLabels:this.percentLabelFlip,value:Math.round((0,i.k)(l?.haloColor?.a??1)),onArcgisSliderInputValueChange:e=>{const t=e.detail,o=(0,i.t)(t),s=l?.clone();s.haloColor.a=o,this.updateSymbol(s,!1,!1,"halo-color-transparency")},withSteppers:!this.narrow,label:o.transparency})),(0,s.h)("calcite-label",null,o.size,(0,s.h)("calcite-input-number",{scale:"s",inputMode:"decimal",min:1,max:10,value:""+((0,i.i)(l?.haloSize)?l.haloSize/.75:0),onCalciteInputNumberInput:e=>{clearTimeout(this.haloSizeValueHandle),e.stopPropagation();const t=Number.parseInt(this.haloSizeEl.value);!t||t<this.haloSizeEl.min||t>this.haloSizeEl.max?this.haloSizeValueHandle=setTimeout((()=>this.handleTextPropChange(this.haloSizeEl,"halo-size")),3e3):this.handleTextPropChange(this.haloSizeEl,"halo-size")},ref:e=>this.haloSizeEl=e}))))}renderTextBackgroundColorBlock(){const{sketchLayerEditorState:e,modules:t}=this,{strings:o}=e,l=this.currentSketchInfo.symbol;return(0,s.h)("calcite-block-section",{ref:e=>this.backgroundColorSectionEl=e,text:o.background,toggleDisplay:"switch",open:!!l?.backgroundColor,onCalciteBlockSectionToggle:e=>{e.stopPropagation();const o=l?.clone();this.backgroundColorSectionEl.open?(o.backgroundColor=this.tempBackgroundColor||new t.Color("white"),o.borderLineColor=this.tempBorderLineColor||new t.Color("white"),o.borderLineSize=this.tempBorderLineSize??.75):(this.tempBackgroundColor=o.backgroundColor,this.tempBorderLineColor=o.borderLineColor,this.tempBorderLineSize=o.borderLineSize,o.backgroundColor=void 0,o.borderLineColor=void 0,o.borderLineSize=void 0),this.updateSymbol(o,!1,!1,"background")}},(0,s.h)("div",{class:"background-color-block"},(0,s.h)("calcite-label",null,o.color,(0,s.h)("arcgis-color-input",{color:l?.backgroundColor?.toHex()||"#ffffff",popoverProps:this.getPopoverProps(),storageId:"arcgis-symbol-styler-storage-colors",onArcgisChange:e=>{const o=l?.clone(),s=l?.backgroundColor?.a??1;o.backgroundColor=new t.Color(e.target.color),o.backgroundColor.a=s,this.updateSymbol(o,!1,!1,"background-color",!1,!0)},onArcgisPickerClose:e=>{const o=e.detail;if(o){const e=l?.clone(),s=l?.backgroundColor?.a??1;e.backgroundColor=new t.Color(o),e.backgroundColor.a=s,this.updateSymbol(e,!1,!1,"background-color")}},onArcgisSwatchUpdate:e=>{const o=e.detail;if(o){const e=l?.clone(),s=l?.backgroundColor?.a??1;e.backgroundColor=new t.Color(o),e.backgroundColor.a=s,this.updateSymbol(e,!1,!1,"background-color")}}})),(0,s.h)("calcite-label",null,o.transparency,(0,s.h)("arcgis-slider-input",{min:0,max:100,step:1,unitsLabel:"%",flipLabels:this.percentLabelFlip,value:Math.round((0,i.k)(l?.backgroundColor?.a??1)),onArcgisValueChange:e=>{const t=e.detail,o=(0,i.t)(t),s=l?.clone();s.backgroundColor.a=o,this.updateSymbol(s,!1,!1,"background-color-transparency")},withSteppers:!this.narrow,label:o.transparency})),(0,s.h)("calcite-label",null,o.outlineColor,(0,s.h)("arcgis-color-input",{color:l?.borderLineColor?.toHex()||"#ffffff",popoverProps:this.getPopoverProps(),storageId:"arcgis-symbol-styler-storage-colors",onArcgisChange:e=>{const o=l?.clone(),s=l?.borderLineColor?.a??1;o.borderLineColor=new t.Color(e.target.color),o.borderLineColor.a=s,this.updateSymbol(o,!1,!1,"border-line-color",!1,!0)},onArcgisPickerClose:e=>{const o=e.detail;if(o){const e=l?.clone(),s=l?.borderLineColor?.a??1;e.borderLineColor=new t.Color(o),e.borderLineColor.a=s,this.updateSymbol(e,!1,!1,"border-line-color")}},onArcgisSwatchUpdate:e=>{const o=e.detail;if(o){const e=l?.clone(),s=l?.borderLineColor?.a??1;e.borderLineColor=new t.Color(o),e.borderLineColor.a=s,this.updateSymbol(e,!1,!1,"border-line-color")}}})),(0,s.h)("calcite-label",null,o.outlineTransparency,(0,s.h)("arcgis-slider-input",{min:0,max:100,step:1,unitsLabel:"%",flipLabels:this.percentLabelFlip,value:Math.round((0,i.k)(l?.borderLineColor?.a??1)),onArcgisValueChange:e=>{const t=e.detail,o=(0,i.t)(t),s=l?.clone();s.borderLineColor.a=o,this.updateSymbol(s,!1,!1,"border-line-color-transparency")},withSteppers:!this.narrow,label:o.outlineTransparency})),(0,s.h)("calcite-label",null,o.outlineWidth,(0,s.h)("calcite-input-number",{scale:"s",inputMode:"decimal",min:0,max:18,value:""+((0,i.i)(l?.borderLineSize)?l.borderLineSize/.75:1),onCalciteInputNumberInput:e=>{clearTimeout(this.borderLineSizeValueHandle),e.stopPropagation();const t=Number.parseInt(this.borderLineSizeEl.value);Number.isNaN(t)||t<this.borderLineSizeEl.min||t>this.borderLineSizeEl.max?this.borderLineSizeValueHandle=setTimeout((()=>this.handleTextPropChange(this.borderLineSizeEl,"border-line-size")),3e3):this.handleTextPropChange(this.borderLineSizeEl,"border-line-size")},ref:e=>this.borderLineSizeEl=e}))))}async loadAllModules(){const[e,t,o,s,i,l,r,n,c]=await Promise.all([(0,h.G)(),(0,h.R)(),(0,h.z)(),(0,h.D)(),(0,h.V)(),(0,h.W)(),(0,h.b2)(),(0,h.b3)(),(0,h.C)()]);this.modules={Color:e,cimSymbolUtils:t,symbolUtils:o,CIMSymbol:s,SimpleLineSymbol:i,SimpleFillSymbol:l,PictureMarkerSymbol:r,PictureFillSymbol:n,TextSymbol:c}}createPortalProp(){return{portal:this.portal,before:async(e,t)=>{await e.load(),t.originalStylesGroupQuery2d=e.stylesGroupQuery2d,e.stylesGroupQuery2d=e.sourceJSON["2DSketchStylesGroupQuery"]},after:async(e,t)=>{e.stylesGroupQuery2d=t.originalStylesGroupQuery2d}}}getFeatureInfoHeading(){const{sketchLayerEditorState:e}=this,{strings:t}=e,o=this.currentSketchInfo.graphics&&this.currentSketchInfo.graphics.length>1,s=this.currentSketchInfo.graphics?.[0].geometry?.type,i=this.currentSketchInfo.graphics?.every((e=>s===e.geometry?.type)),l=this.currentSketchInfo.graphics?.some((e=>"text"===e.symbol?.type))&&!this.currentSketchInfo.graphics?.every((e=>"text"===e.symbol?.type)),r=this.currentSketchInfo.tool;if(o){if(!i||l)return t.selectedFeatures;switch(s){case"polyline":return t.lineFeatures;case"polygon":return t.polygonFeatures;default:return"point"!==s||this.currentSketchInfo.graphics?.some((e=>"text"===e.symbol?.type))?t.textFeatures:t.pointFeatures}}else switch(r){case"point":return t.pointFeature;case"polyline":return t.lineFeature;case"text":return t.textFeature;default:return t.polygonFeature}}async afterCreateRecentSymbolDiv(e,t,o){const{sketchLayerEditorState:s,modules:i}=this,{strings:l}=s;let r;if(["simple-line","simple-fill","picture-marker","picture-fill","text","cim"].includes(t.type))"text"===t.type&&(t.text=l.textPreview),r=t;else switch(t.type){case"CIMSymbolReference":r=i.CIMSymbol.fromJSON(t);break;case"esriSLS":r=i.SimpleLineSymbol.fromJSON(t);break;case"esriSFS":r=i.SimpleFillSymbol.fromJSON(t);break;case"esriPMS":r=i.PictureMarkerSymbol.fromJSON(t);break;case"esriPFS":r=i.PictureFillSymbol.fromJSON(t);break;case"esriTS":r=i.TextSymbol.fromJSON(t)}const n=r.clone();"text"===n.type&&(n.haloSize=Math.min(2,n.haloSize)),"simple-line"===n.type&&(n.width=Math.min(2,n.width));const a=this.recentSymbolsContainerEl.clientWidth-49,h={maxSize:"text"===n.type?16:20,scale:!0,size:"simple-line"===n.type?{width:a/9,height:2}:{width:"text"===n.type?16:Math.min(a/6*.75,24),height:"text"===n.type?16:Math.min(a/6*.75,24)}};n&&await i.symbolUtils.renderPreviewHTML(n,h).then((t=>{t&&((0,c.r)(e),e.append(t),this.symbolNodes[o]=r)}))}handleRecentSymbolSelect(e){this.updateSymbol(this.symbolNodes[e],!0,!0,this.textContentEl?"recent-text":void 0),this.divNodes[0].focus()}getPopoverProps(){const e=this.flowEl?.getBoundingClientRect();return{offsetDistance:10,offsetSkidding:-3,overlayPositioning:"fixed",maxHeight:e&&e.height-65+"px",refElement:this.symbolStylerRefElement}}startPointEdit(){const{modules:e}=this,t="cim"===this.currentSketchInfo.symbol.type,o=this.currentSketchInfo.graphics&&this.currentSketchInfo.graphics.length>1;this.pointStyler?.edit(this.currentSketchInfo.symbol.clone(),{sections:{marker:{open:!0,symbolsOpen:!0,sizeOpen:!1,rotationOpen:!1,markerType:["cim:vector","custom"],keepChoice:!0,parts:{size:{autoSizeAdjust:!1},color:t&&o,transparency:t&&o}},...t&&{fill:{type:"color",optional:!0,suggestedColors:this.suggestedFillColors,savedColors:this.savedColors,open:!1,suggestedColorsOpen:!0},stroke:{optional:!0,open:!1,type:"color",suggestedColors:this.suggestedFillColors,savedColors:this.savedColors}}},marker:{size:t?e.cimSymbolUtils.getCIMSymbolSize(this.currentSketchInfo.symbol):"picture-marker"===this.currentSketchInfo.symbol.type?this.currentSketchInfo.symbol.width:25},fill:{color:t&&e.cimSymbolUtils.getCIMSymbolColor(this.currentSketchInfo.symbol)||this.suggestedFillColors[0]},stroke:t&&this.getCimOutlineProps(this.currentSketchInfo.symbol),fillEnabled:t,strokeEnabled:t,portal:this.createPortalProp()})}startPolylineEdit(){const e="cim"===this.currentSketchInfo.symbol.type,t=this.currentSketchInfo.graphics&&this.currentSketchInfo.graphics.length>1;this.polylineStyler?.edit(this.currentSketchInfo.symbol.clone(),{sections:{stroke:{type:"color",open:!0,suggestedColorsOpen:!0,suggestedColors:this.suggestedFillColors,extraParts:{width:!0,autoStrokeAdjust:!1}},marker:{parts:{size:{autoSizeAdjust:!1},color:e&&t,transparency:e&&t}}},stroke:{color:this.currentSketchInfo.symbol?.color||this.savedColors[1],size:this.currentSketchInfo.symbol?.width||10,style:this.currentSketchInfo.symbol?.style||"solid",marker:this.currentSketchInfo.symbol?.marker},portal:this.createPortalProp()})}getCimOutlineProps(e){const{modules:t}=this,o=(0,c.q)(e);return{color:new t.Color(o?.color),size:o?.width??1}}startPolygonEdit(){const e="cim"===this.currentSketchInfo.symbol.type,t=this.currentSketchInfo.graphics&&this.currentSketchInfo.graphics.length>1,o=this.currentSketchInfo.graphics&&!this.currentSketchInfo.graphics.every((e=>(0,i.i)((0,c.p)(e.symbol))));this.polygonStyler?.edit(this.currentSketchInfo.symbol.clone(),{sections:{fill:{type:"color",open:!0,optional:!0,suggestedColorsOpen:!0,transparencyOpen:!1,suggestedColors:this.suggestedFillColors},stroke:{type:"color",open:!1,optional:!0,suggestedColorsOpen:!0,suggestedColors:this.suggestedFillColors,extraParts:{width:!o,autoStrokeAdjust:!1}},marker:{parts:{size:{autoSizeAdjust:!1},color:e&&t,transparency:e&&t}}},fill:{color:this.currentSketchInfo.symbol.color||this.suggestedFillColors[0]},stroke:{color:this.currentSketchInfo.symbol.outline?.color||this.suggestedFillColors[0],size:this.currentSketchInfo.symbol.outline?.width||10,style:this.currentSketchInfo.symbol.outline?.style||"solid",autoAdjusted:!1},fillEnabled:!!this.currentSketchInfo.symbol.color,strokeEnabled:!!this.currentSketchInfo.symbol?.outline,portal:this.createPortalProp()})}async openFontPopover(){this.arcgisFontPickerEl||(this.arcgisDisablePanel.emit(!0),this.arcgisFontPickerEl=document.createElement("arcgis-font-picker"),this.arcgisFontPickerEl.view=this.mapView,this.arcgisFontPickerEl.enableMapSpecificFontList=!0,this.arcgisFontPickerEl.fontMap=await(0,l.g)(this.portal),this.arcgisFontPickerEl.font=this.currentSketchInfo.symbol?.font,this.arcgisFontPickerEl.popoverProps={refElement:this.flowEl,placement:"leading",offsetDistance:-this.flowEl.getBoundingClientRect().width,overlayPositioning:"fixed"},this.arcgisFontPickerEl.addEventListener("arcgisClose",(()=>this.closeFontPopover())),this.arcgisFontPickerEl.addEventListener("arcgisChange",(e=>this.changeFont(e))),document.body.appendChild(this.arcgisFontPickerEl))}closeFontPopover(){this.arcgisFontPickerEl&&(this.arcgisDisablePanel.emit(!1),document.body.removeChild(this.arcgisFontPickerEl),this.arcgisFontPickerEl=void 0)}changeFont(e){const t=e.detail;if(t){const e=this.currentSketchInfo.symbol?.clone();e.font.family=t.family,e.font.weight=t.weight,e.font.style=t.style,this.updateSymbol(e,!1,!1,"font"),(0,s.f)(this.el)}}handleTextRotationSliderValueChange(e,t){const o=this.currentSketchInfo.symbol?.clone();o.angle=e,this.updateSymbol(o,!1,!1,"rotation",t)}handleTextPropChange(e,t){if(!e)return;let o=Number.parseInt(e.value);Number.isNaN(o)||o<e.min?o=e.min:o>e.max&&(o=e.max),e.value=`${o}`;const i=this.currentSketchInfo.symbol?.clone();switch(t){case"font-size":i.font.size=.75*o;break;case"halo-size":i.haloSize=.75*o;break;case"rotation":i.angle=o;break;default:i.borderLineSize=.75*o}this.updateSymbol(i,!1,!1,t,!1,"rotation"!==t),(0,s.f)(this.el)}updateSymbol(e,t,o,s,l,r){const{sketchLayerEditorState:a}=this,{strings:h}=a,d=this.currentSketchInfo.symbol.clone(),p=e.clone(),u=(0,c.n)(this.currentSketchInfo.symbol)!==(0,c.n)(e);if(this.currentSketchInfo.symbol=e.clone(),"recent-text"===s&&(this.currentSketchInfo.symbol.text=d.text),this.arcgisGraphicUpdates.emit({type:"symbol",symbolSwitch:t,symbolSwitchFromRecent:o,textProp:s}),l)this.arcgisActiveSymbolChange.emit();else if((!u||t||o)&&!r){"text"===p.type&&(p.text=h.textPreview);const e=this.recentSymbols?.filter((e=>JSON.stringify(e)!==JSON.stringify(p)))??[],t=(0,i.i)(e)?[p,...e].slice(0,5):[p],o=this.currentSketchInfo.tool?["circle","rectangle"].includes(this.currentSketchInfo.tool)?"arcgis-sketch-recent-polygon-symbols":`arcgis-sketch-recent-${this.currentSketchInfo.tool}-symbols`:"arcgis-sketch-recent-point-symbols";(0,n.s)(o,t,!0),this.recentSymbols=t,this.arcgisActiveSymbolChange.emit()}}addResetTooltip(){const{sketchLayerEditorState:e}=this,{strings:t}=e,o=document.createElement("calcite-tooltip");o.className="sketch-layer-editor-content-tooltip",o.referenceElement=this.resetRecentSymbolsNode,o.placement="left-start",o.open=!0,o.innerHTML=t.clearRecentSymbols,document.body.append(o)}removeResetTooltip(){document.querySelectorAll(".sketch-layer-editor-content-tooltip").forEach((e=>e.parentNode?.removeChild(e)))}get el(){return(0,s.g)(this)}};u.style=".style-info-wrapper {\n  background-color: var(--calcite-color-foreground-1);\n}\n\n.style-info-block {\n  padding: var(--calcite-spacing-md) var(--calcite-spacing-md) var(--calcite-spacing-xxs);\n}\n\n.style-title {\n  font-weight: var(--calcite-font-weight-medium);\n}\n\n.text-content {\n  margin: 12px;\n}\n\n.rotation {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  position: relative;\n\n  calcite-slider {\n    width: 50%;\n  }\n\n  calcite-input-number {\n    width: 45%;\n  }\n}\n\n.sketch-popup-button {\n  margin-bottom: 0.4em;\n}\n\n.recent-symbols-wrapper {\n  background-color: var(--calcite-color-foreground-1);\n  border: 1px solid var(--calcite-color-border-1);\n  display: flex;\n  align-items: center;\n  justify-content: space-evenly;\n}\n\n.recent-symbols-symbol-group {\n  display: flex;\n  flex-direction: row;\n  padding: 8px 0px;\n  justify-content: space-evenly;\n  width: calc(100% - 48px);\n}\n\n.recent-symbol {\n  height: 32px;\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n}\n\n.recent-symbol:focus {\n  outline: 2px solid var(--calcite-ui-brand);\n  outline-offset: 2px;\n}\n\n.recent-symbols-divider-wrapper {\n  background-color: var(--calcite-color-border-3);\n}\n\n.recent-symbols-divider {\n  margin-block: 0.25rem;\n  display: inline-block;\n  inline-size: 1px;\n}\n\n.recent-symbols-reset-button-wrapper {\n  display: flex;\n  padding: 8px 0px;\n  justify-content: space-evenly;\n  width: 48px;\n}\n\n.no-recent-symbols {\n  min-height: 32px;\n  display: flex;\n  align-items: center;\n  padding: 8px;\n}\n\n.clear-recent-button {\n  padding-top: 8px;\n  margin: auto;\n}\n\n.symbol-styler {\n  /* enforce a horizontal scrollbar for small screens */\n  padding: 0px 1px;\n}\n\n.halo-block,\n.background-color-block {\n  padding-top: 6px;\n}\n";const g=class{constructor(e){(0,s.r)(this,e),this.arcgisClose=(0,s.c)(this,"arcgisClose",7),this.manager=(0,r.u)(this),this.refElement=void 0,this.sketchLayerEditorState=void 0,this.isOpen=!1}async reposition(){this.sketchLayerEditorShortcutsPopover?.reposition()}componentDidLoad(){this.isOpen=!0}render(){const{sketchLayerEditorState:e}=this,{strings:t}=e;return(0,s.h)(s.H,{key:"e6a765253c8366587e5438e044caf2f85ef6cfa0",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"bc2dc92e52052d2b436c03e45ce8e5c6b1687cf4",class:"popover",ref:e=>this.sketchLayerEditorShortcutsPopover=e,placement:"leading-start",open:this.isOpen,pointerDisabled:!0,referenceElement:this.refElement,offsetDistance:-Math.round(this.refElement.getBoundingClientRect().width),offsetSkidding:0,label:t.sketchShortcuts},(0,s.h)("calcite-panel",{key:"69776a53e86e0ccf6f924cf3b2055d7d40b0b5f4",heading:t.sketchShortcuts,closable:!0,style:{width:`${Math.max(this.refElement.getBoundingClientRect().width,375)}px`},onCalcitePanelClose:()=>this.arcgisClose.emit()},(0,s.h)("div",{key:"98359c8d08206b7f77e6023d2ec5401064b4e657",class:"sketch-shortcut"},(0,s.h)("calcite-chip",{key:"7ccd6843c7d40f676a10b4e87027cbced8eb5af2",label:"Ctrl",class:"sketch-shortcut-chip"},"Ctrl"),(0,s.h)("calcite-label",{key:"88c985ec0120be6f1ba84f86ed4743756c3d7e36",class:"sketch-shortcut-label"},t.ctrlShortcut),(0,s.h)("calcite-chip",{key:"9d1687bf0cf143b014481a031a72b0e6d6e0be8f",label:"Enter",class:"sketch-shortcut-chip"},"Enter"),(0,s.h)("calcite-label",{key:"19f9424ad3dfe5195d15a074e61dee1792aea47f",class:"sketch-shortcut-label"},t.cShortcut),(0,s.h)("calcite-chip",{key:"accad6d1f49eb171513cb649df46e2dcaf1f677e",label:"Z",class:"sketch-shortcut-chip"},"Z"),(0,s.h)("calcite-label",{key:"9f61664795c2cb795cda1565b60ab02ce8214589",class:"sketch-shortcut-label"},t.zShortcut),(0,s.h)("calcite-chip",{key:"0f4a8baf415b8ab6dcd1fd5fb13ec6eb4731aaea",label:"R",class:"sketch-shortcut-chip"},"R"),(0,s.h)("calcite-label",{key:"31c417e140d38b9b0e453729cf6325314e2cde4d",class:"sketch-shortcut-label"},t.rShortcut),(0,s.h)("calcite-chip",{key:"b67ef1d7cdfc36430cb35782b98c437263147da5",label:"Esc",class:"sketch-shortcut-chip"},"Esc"),(0,s.h)("calcite-label",{key:"b43eab08eba1639111b048c6b43f2506d74ebe81",class:"sketch-shortcut-label"},t.escShortcut),(0,s.h)("calcite-chip",{key:"20c468dd4d132a1bcdb810727bb122b2c773c952",label:"Tab",class:"sketch-shortcut-chip"},"Tab"),(0,s.h)("calcite-label",{key:"3ad1e98b44e16da9e35e2a5c655e2471228f1738",class:"sketch-shortcut-label"},t.tabShortcut)))))}get el(){return(0,s.g)(this)}};g.style=".sketch-shortcut {\n  background-color: var(--calcite-color-foreground-1);\n  display: grid;\n  grid-template-columns: 21% auto;\n  row-gap: var(--calcite-spacing-sm);\n  padding: var(--calcite-spacing-sm);\n}\n\n.sketch-shortcut-chip {\n  margin-right: var(--calcite-spacing-sm);\n}\n\n.sketch-shortcut-label {\n  align-self: center;\n}\n\n.popover {\n  --calcite-popover-z-index: 100;\n}\n\n:dir(rtl) {\n  .sketch-shortcut {\n    max-height: 40vh;\n  }\n  .sketch-shortcut-chip {\n    margin-left: var(--calcite-spacing-sm);\n    margin-right: 0;\n  }\n}\n";const m=class{constructor(e){(0,s.r)(this,e),this.arcgisCloseSnappingPopovers=(0,s.c)(this,"arcgisCloseSnappingPopovers",7),this.manager=(0,r.u)(this),this.refElement=void 0,this.sketchLayerEditorState=void 0}async reposition(){this.sketchLayerEditorSnappingPopover?.reposition()}async componentWillLoad(){await this.loadAllModules(),this.addSnappingWidget(),this.addTooltipsWidget()}componentDidLoad(){this.snappingControls.container=this.snappingControlDiv,this.sketchTooltipControls.container=this.sketchTooltipControlDiv}disconnectedCallback(){this.snappingControls?.destroy(),this.sketchTooltipControls?.destroy()}render(){const{sketchLayerEditorState:e}=this,{strings:t}=e;return(0,s.h)(s.H,{key:"218cc1f310d7542d46f71d968802fe2f3ce81e3e",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"4675b0c9d58539a6d7b21170aa525e754d8a186d",class:"popover",placement:"leading-start",ref:e=>this.sketchLayerEditorSnappingPopover=e,open:!0,pointerDisabled:!0,referenceElement:this.refElement,offsetDistance:-Math.round(this.refElement.getBoundingClientRect().width),offsetSkidding:0,label:t.settings},(0,s.h)("calcite-panel",{key:"8e22e66811fba693cc1bf67109733ac1c00934d8",closable:!0,headingLevel:2,heading:t.settings,style:{width:`${this.refElement.getBoundingClientRect().width}px`},onCalcitePanelClose:()=>{const{sketchLayerEditorState:e}=this,{snappingOptions:t,snappingSessionStorageIds:o,sketchTooltipOptions:s,sketchTooltipSessionStorageIds:i}=e;o?.current&&(0,c.s)(t,o.current),i?.current&&(0,c.f)(s,i.current),this.arcgisCloseSnappingPopovers.emit()}},(0,s.h)("div",{key:"47282ca6456f49abab599d845ac104e2f31f725b",class:"content"},(0,s.h)("div",{key:"391f984f1702e8fe3842c6c7d55f76a90409f617",ref:e=>this.sketchTooltipControlDiv=e}),(0,s.h)("div",{key:"e4dba3a368ab4ecaa4c67c4b908ded962278f49d",ref:e=>this.snappingControlDiv=e})))))}async loadAllModules(){const[e]=await Promise.all([(0,h.b4)()]);this.SnappingControls=e;const[t]=await Promise.all([(0,h.b5)()]);this.SketchTooltipControls=t}addSnappingWidget(){const{sketchLayerEditorState:e}=this,{mapView:t,snappingOptions:o}=e;this.snappingControls=new this.SnappingControls({view:t,snappingOptions:o,visibleElements:{header:!1}})}addTooltipsWidget(){const{sketchLayerEditorState:e}=this,{sketchTooltipOptions:t}=e;this.sketchTooltipControls=new this.SketchTooltipControls.createSketchTooltipControls({tooltipsToggle:!0,labelsToggle:!1},{tooltips:t})}get el(){return(0,s.g)(this)}};m.style=".popover.sc-arcgis-sketch-layer-editor-snapping{--calcite-popover-z-index:100}.content.sc-arcgis-sketch-layer-editor-snapping{max-height:60vh}.content.sc-arcgis-sketch-layer-editor-snapping .esri-grid-controls__tile__content.sc-arcgis-sketch-layer-editor-snapping{padding:var(--calcite-spacing-sm)}";const y=class{constructor(e){(0,s.r)(this,e),this.arcgisActionOnDrawFeatures=(0,s.c)(this,"arcgisActionOnDrawFeatures",7),this.arcgisActionOnSelectFeatures=(0,s.c)(this,"arcgisActionOnSelectFeatures",7),this.manager=(0,r.u)(this),this.refElement=void 0,this.mapNotesFeatures=void 0,this.sketchToolsToHide=[],this.activeSketchTool=void 0,this.hideSelectionTools=!1,this.activeSelectTool=void 0,this.sketchLayerEditorState=void 0,this.isOpen=!1}async reposition(){this.sketchToolsPopoverElement?.reposition()}componentWillLoad(){const{sketchLayerEditorState:e}=this;this.sketchLayerEditorSVModel=e.sketchLayerEditorSVModel,this.isOpen=!0}componentDidLoad(){const{sketchLayerEditorState:e}=this,{strings:t}=e;if(this.mapNotesFeatures?.length){let e=[],o=[],s=[],i=[];if(this.mapNotesFeatures.forEach((t=>{switch((0,c.g)(t)){case"polyline":o=[...o,t];break;case"polygon":s=[...s,t];break;case"text":i=[...i,t];break;default:e=[...e,t]}})),this.activeSelectTool){"select"===this.activeSelectTool?this.actionOnSelectFeatures(t.selectText,this.sketchSelectElement):this.actionOnSelectFeatures(t.rectangleLassoSelect,this.sketchRectangleSelectElement,"rectangle")}e.length&&this.sketchLayerEditorSVModel.updatePoint(e),o.length&&this.sketchLayerEditorSVModel.updateLine(o),s.length&&this.sketchLayerEditorSVModel.updatePolygon(s),i.length&&this.sketchLayerEditorSVModel.updateText(i)}else{const e={point:this.sketchPointElement,polygon:this.sketchPolygonElement,polyline:this.sketchPolyLineElement,circle:this.sketchCircleElement,rectangle:this.sketchRectangleElement,text:this.sketchTextElement};let t,o;if(this.activeSketchTool)t=this.activeSketchTool,o=e[t];else{let s=["point","polyline","polygon","rectangle","circle","text"];s=s.filter((e=>!this.sketchToolsToHide.includes(e))),t=s.length?s[0]:"point",o=e[t]}const s=this.getActiveSketchMessage(t);this.actionOnDrawFeatures(t,s,o)}}render(){const{sketchLayerEditorState:e}=this,{strings:t}=e;return(0,s.h)(s.H,{key:"59c57f2f01d94c64830e669f9f8132e44862b19c",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"f6bf31394286e1235139d698aff66d3d42cbb83a",ref:e=>this.sketchToolsPopoverElement=e,placement:"leading-start",open:this.isOpen,referenceElement:this.refElement,offsetDistance:15,pointerDisabled:!0,focusTrapDisabled:!0,triggerDisabled:!0,label:t.sketch,class:"popover",onCalcitePopoverBeforeClose:()=>this.sketchToolsPopoverElement.open=!0},(0,s.h)("calcite-action-pad",{key:"80b0bcaeeffd2f72889af2e7aa9e53426fea0f09",position:"start",layout:"vertical",expandDisabled:!0},this.renderDrawFeatures(),!this.hideSelectionTools&&this.renderSelectFeatures())))}renderDrawFeatures(){const{sketchLayerEditorState:e,sketchToolsToHide:t}=this,{strings:o}=e;return(0,s.h)("calcite-action-group",{label:o.drawFeatures},!t.includes("point")&&(0,s.h)("calcite-action",{ref:e=>this.sketchPointElement=e,text:o.stamp,label:o.stamp,title:o.stamp,icon:"pin",alignment:"center",onClick:()=>this.actionOnDrawFeatures("point",o.addStamp,this.sketchPointElement)}),!t.includes("polyline")&&(0,s.h)("calcite-action",{ref:e=>this.sketchPolyLineElement=e,text:o.line,label:o.line,title:o.line,icon:"line",alignment:"center",onClick:()=>this.actionOnDrawFeatures("polyline",o.startFinishDrawing,this.sketchPolyLineElement)}),!t.includes("polygon")&&(0,s.h)("calcite-action",{ref:e=>this.sketchPolygonElement=e,text:o.polygon,label:o.polygon,title:o.polygon,icon:"polygon",alignment:"center",onClick:()=>this.actionOnDrawFeatures("polygon",o.startFinishDrawing,this.sketchPolygonElement)}),!t.includes("rectangle")&&(0,s.h)("calcite-action",{ref:e=>this.sketchRectangleElement=e,text:o.rectangle,label:o.rectangle,title:o.rectangle,icon:"rectangle",alignment:"center",onClick:()=>this.actionOnDrawFeatures("rectangle",o.addRectangle,this.sketchRectangleElement)}),!t.includes("circle")&&(0,s.h)("calcite-action",{ref:e=>this.sketchCircleElement=e,text:o.circle,label:o.circle,title:o.circle,icon:"circle",alignment:"center",onClick:()=>this.actionOnDrawFeatures("circle",o.addCircle,this.sketchCircleElement)}),!t.includes("text")&&(0,s.h)("calcite-action",{ref:e=>this.sketchTextElement=e,text:o.text,label:o.text,title:o.text,icon:"text",alignment:"center",onClick:async()=>this.actionOnDrawFeatures("text",o.addText,this.sketchTextElement)}))}renderSelectFeatures(){const{sketchLayerEditorState:e}=this,{strings:t}=e;return(0,s.h)("calcite-action-group",{label:t.selectFeatures},(0,s.h)("calcite-action",{ref:e=>this.sketchSelectElement=e,text:t.select,label:t.select,title:t.select,icon:"cursor",alignment:"center",onClick:()=>this.actionOnSelectFeatures(t.selectText,this.sketchSelectElement)}),(0,s.h)("calcite-action",{ref:e=>this.sketchRectangleSelectElement=e,text:t.rectangleSelect,label:t.rectangleSelect,title:t.rectangleSelect,icon:"cursor-marquee",alignment:"center",onClick:()=>this.actionOnSelectFeatures(t.rectangleLassoSelect,this.sketchRectangleSelectElement,"rectangle")}),(0,s.h)("calcite-action",{ref:e=>this.sketchLassoSelectElement=e,text:t.lassoSelect,label:t.lassoSelect,title:t.lassoSelect,icon:"lasso",alignment:"center",onClick:()=>this.actionOnSelectFeatures(t.rectangleLassoSelect,this.sketchLassoSelectElement,"lasso")}))}getActiveSketchMessage(e){const{sketchLayerEditorState:t}=this,{strings:o}=t;switch(e){case"point":return o.addStamp;case"polyline":case"polygon":return o.startFinishDrawing;case"rectangle":return o.addRectangle;case"circle":return o.addCircle;case"text":return o.addText;default:return""}}actionOnDrawFeatures(e,t,o){this.clearActiveSelection(),this.activeSelectTool=void 0,o.active=!0,this.arcgisActionOnDrawFeatures.emit({tool:e,sketchMessage:t})}actionOnSelectFeatures(e,t,o){const{active:s=!1}=t;this.clearActiveSelection(),t.active=!s,this.activeSelectTool=t.active?o??"select":void 0,this.sketchLayerEditorSVModel.cancel(),this.arcgisActionOnSelectFeatures.emit({sketchMessage:s?"":e,multipleSelectTool:!s&&o||void 0})}clearActiveSelection(){[this.sketchPointElement,this.sketchPolyLineElement,this.sketchPolygonElement,this.sketchRectangleElement,this.sketchCircleElement,this.sketchTextElement,this.sketchSelectElement,this.sketchRectangleSelectElement,this.sketchLassoSelectElement].forEach((e=>{e&&(e.active=!1)}))}get el(){return(0,s.g)(this)}};y.style=".popover{--calcite-popover-z-index:100}"}}]);