/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-b0d712.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-b0d712"],{51231:(e,s,t)=>{t.r(s),t.d(s,{arcgis_smart_mapping_type_actions_popover:()=>n,arcgis_smart_mapping_type_add_value:()=>r});var a=t(28614),l=(t(68180),t(99592)),i=t(97127),o=t(67751);t(71480);const n=class{constructor(e){(0,a.r)(this,e),this.arcgisSmartMappingTypeActionsPopoverChange=(0,a.c)(this,"arcgisSmartMappingTypeActionsPopoverChange",7),this.arcgisSmartMappingTypeActionsPopoverFocusExit=(0,a.c)(this,"arcgisSmartMappingTypeActionsPopoverFocusExit",7),this.manager=(0,i.u)(this),this.checkedClasses=void 0,this.groupMenuNodes=void 0,this.referenceNode=void 0,this.smartMappingState=void 0,this.showMoveToGroup=!1}componentWillLoad(){this.topActionHandler=e=>{e.shiftKey&&"Tab"===e.key&&this.arcgisSmartMappingTypeActionsPopoverFocusExit.emit("top")}}componentDidRender(){const e=(this.moveUpNode?.disabled?void 0:this.moveUpNode)||(this.moveDownNode?.disabled?void 0:this.moveDownNode)||this.mergeNode||this.separateNode||this.moveToGroupNode;e?.removeEventListener("keydown",this.topActionHandler),e?.addEventListener("keydown",this.topActionHandler)}async focusActionPad(){this.actionPadNode?.setFocus()}async focusLastAction(){if(this.actionPadNode){const e=Array.from(this.actionPadNode.querySelectorAll("calcite-action")).filter((e=>!e.disabled));e[e.length-1].setFocus()}}render(){const{strings:e}=this.smartMappingState;if(!this.checkedClasses?.length)return(0,a.h)(a.F,null);const s=this.referenceNode?.getBoundingClientRect(),t=s?.height;return(0,a.h)(a.H,null,(0,a.h)("calcite-popover",{class:"js-app-flyout popover",placement:"leading-start",offsetDistance:10,offsetSkidding:(0,l.M)(t)?(t-120)/4+70:0,pointerDisabled:!0,label:e.panels.type.typeActions,triggerDisabled:!0,referenceElement:this.referenceNode,open:!0,ref:e=>this.popoverNode=e},this.showMoveToGroup?this.renderMoveToGroup():this.renderActions()))}renderActions(){return(0,a.h)("calcite-action-pad",{layout:"vertical",position:"start",expanded:!0,expandDisabled:!0,ref:e=>{e&&(this.actionPadNode=e)}},this.renderGroup1(),this.renderGroup2(),this.renderGroup3())}renderMoveToGroup(){if(!this.showMoveToGroup)return(0,a.h)(a.F,null);const{smartMappingState:e}=this,{strings:s}=e,t=(0,l.j)(e),i=t.uniqueValueGroups,o=!!!this.checkedClasses.find((e=>e.groupIdx!==this.checkedClasses[0].groupIdx))&&this.checkedClasses[0].groupIdx,n=i.map(((e,s)=>this.renderMoveToGroupListItem(e,s)));return(0,a.h)("calcite-panel",{heading:s.panels.type.moveToGroup,closable:!0,onCalcitePanelClose:()=>{this.showMoveToGroup=!1,(0,a.f)(this.el),setTimeout((()=>{this.moveToGroupNode.setFocus()}),300)},ref:e=>{e?.setFocus()}},(0,a.h)("calcite-list",{filterEnabled:i.length>=10,filterPlaceholder:s.panels.type.searchGroups,label:s.panels.type.selectGroup,selectionMode:"single"},n,!t.uniqueValueGroups.length&&(0,a.h)("calcite-list-item",{label:s.panels.type.untitledGroup,onCalciteListItemSelect:()=>this.moveToNewGroup(!0)}),(0,a.h)("calcite-list-item",{label:t.defaultLabel||s.panels.type.other,value:-1,disabled:-1===o,onCalciteListItemSelect:()=>{this.checkedClasses.sort(((e,s)=>s.groupIdx-e.groupIdx==0?s.classIdx-e.classIdx:s.groupIdx-e.groupIdx)),this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(i[e.groupIdx].classes.splice(e.classIdx,1),i[e.groupIdx].classes.length||i.splice(e.groupIdx,1))})),this.checkedClasses=[],t.uniqueValueGroups=i,(0,l.u)(e),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{this.groupMenuNodes[-1]?.setFocus()}),300)}})),(0,a.h)("calcite-button",{appearance:"outline",label:s.cancel,innerHTML:s.cancel,width:"full",slot:"footer",onClick:()=>{this.showMoveToGroup=!1,(0,a.f)(this.el),setTimeout((()=>{this.moveToGroupNode.setFocus()}),300)}}))}renderMoveToGroupListItem(e,s){const{smartMappingState:t}=this,{strings:i}=t,n=(0,l.j)(t),r=n.uniqueValueGroups,u=!!!this.checkedClasses.find((e=>e.groupIdx!==this.checkedClasses[0].groupIdx))&&this.checkedClasses[0].groupIdx;return(0,a.h)("calcite-list-item",{label:e.heading||i.panels.type.untitledGroup,value:s,disabled:u===s,onCalciteListItemSelect:e=>{const s=e.target.value;let a=this.checkedClasses.filter((e=>-1!==e.groupIdx)).map((e=>r[e.groupIdx].classes[e.classIdx]));const i=(0,o.b)(t);a=a.concat(this.checkedClasses.filter((e=>-1===e.groupIdx)).map((e=>i[e.classIdx])));const u=r[s];u.classes=u.classes.concat(a),this.checkedClasses.sort(((e,s)=>s.groupIdx-e.groupIdx==0?s.classIdx-e.classIdx:s.groupIdx-e.groupIdx)),this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(r[e.groupIdx].classes.splice(e.classIdx,1),r[e.groupIdx].classes.length||r.splice(e.groupIdx,1))})),this.checkedClasses=[],n.uniqueValueGroups=r,(0,l.u)(t),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{this.groupMenuNodes[s]?.setFocus()}),300)}})}renderGroup1(){const{smartMappingState:e}=this,{strings:s}=e,t=(0,l.j)(e).uniqueValueGroups;if(this.checkedClasses.find((e=>-1===e.groupIdx)))return(0,a.h)(a.F,null);const i=this.checkedClasses.map((e=>e.classIdx)),o=i.length,n=t[this.checkedClasses[0].groupIdx]?.classes.length;i.sort(((e,s)=>e-s));const r=i[0]>0||!!i.find(((e,s)=>s>0&&e-1>i[s-1])),u=i[o-1]<n-1||!!i.find(((e,s)=>s<o-1&&e+1<i[s+1]));return(0,a.h)("calcite-action-group",null,(0,a.h)("calcite-action",{text:s.panels.type.moveUp,textEnabled:!0,disabled:!r,icon:"arrow-bold-up",onClick:()=>this.moveUp(),ref:e=>this.moveUpNode=e}),(0,a.h)("calcite-action",{text:s.panels.type.moveDown,textEnabled:!0,disabled:!u,icon:"arrow-bold-down",onClick:()=>this.moveDown(),ref:e=>this.moveDownNode=e}))}renderGroup2(){const{smartMappingState:e}=this,{strings:s}=e,t=(0,l.j)(e).uniqueValueGroups,i=!!this.checkedClasses.find((e=>e.groupIdx!==this.checkedClasses[0].groupIdx)),o=!!this.checkedClasses.find((e=>-1!==e.groupIdx))&&this.checkedClasses.length>1,n=!!this.checkedClasses.find((e=>-1!==e.groupIdx&&t[e.groupIdx].classes[e.classIdx].values.length>1)),r=!!this.checkedClasses.find((e=>-1!==e.groupIdx)),u=!i&&-1!==this.checkedClasses[0].groupIdx&&this.checkedClasses.length===t[this.checkedClasses[0].groupIdx].classes.length;return(0,a.h)("calcite-action-group",null,o&&(0,a.h)("calcite-action",{text:s.panels.type.mergeValues,textEnabled:!0,onClick:()=>this.mergeValues(),ref:e=>this.mergeNode=e}),n&&(0,a.h)("calcite-action",{text:s.panels.type.separateValues,textEnabled:!0,onClick:()=>this.separateSelectedValues(),ref:e=>this.separateNode=e}),(0,a.h)("calcite-action",{text:s.panels.type.moveToGroup,textEnabled:!0,onClick:()=>this.moveToGroup(),ref:e=>{e&&(this.moveToGroupNode=e)}}),(0,a.h)("calcite-action",{text:s.panels.type.newGroup,textEnabled:!0,disabled:u,onClick:()=>this.moveToNewGroup()}),r&&(0,a.h)("calcite-action",{text:s.panels.type.remove,textEnabled:!0,onClick:()=>this.removeValues()}))}renderGroup3(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-action-group",null,(0,a.h)("calcite-action",{text:e.panels.type.clearSelection,textEnabled:!0,onClick:()=>this.clearSelection(),onKeyDown:e=>{e.shiftKey||"Tab"!==e.key||this.arcgisSmartMappingTypeActionsPopoverFocusExit.emit("bottom")}}))}clearSelection(){let e=-1;this.checkedClasses.forEach((s=>e=-1===s.groupIdx?e:-1===e?s.groupIdx:Math.min(e,s.groupIdx))),this.checkedClasses=[],this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{this.groupMenuNodes[e]?.setFocus()}),300)}mergeValues(){const{smartMappingState:e}=this,s=(0,l.j)(e),t=s.uniqueValueGroups;this.checkedClasses.sort(((e,s)=>e.groupIdx-s.groupIdx==0?e.classIdx-s.classIdx:-1===e.groupIdx||-1===s.groupIdx?s.groupIdx-e.groupIdx:e.groupIdx-s.groupIdx));const a=t[this.checkedClasses[0].groupIdx].classes[this.checkedClasses[0].classIdx],i=(0,o.b)(e);this.checkedClasses.forEach(((e,s)=>{if(s>0){const s=-1===e.groupIdx?i[e.classIdx]:t[e.groupIdx].classes[e.classIdx];a.values=a.values.concat(s.values),a.label+=`, ${s.label}`}}));const n=[];t.forEach(((e,s)=>{const t=[];e.classes.forEach(((e,l)=>{this.checkedClasses[0].groupIdx===s&&this.checkedClasses[0].classIdx===l?t.push(a):this.checkedClasses.find((e=>e.groupIdx===s&&e.classIdx===l))||t.push(e)})),t.length&&(e.classes=t,n.push(e))})),s.uniqueValueGroups=n,this.checkedClasses=[],(0,l.u)(e),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses})}moveDown(){const{smartMappingState:e}=this,{modules:s}=e,t=(0,l.j)(e),a=t.uniqueValueGroups,i=a[this.checkedClasses[0].groupIdx];this.checkedClasses.sort(((e,s)=>s.groupIdx-e.groupIdx==0?s.classIdx-e.classIdx:s.groupIdx-e.groupIdx));const o=s.esriLang.clone(this.checkedClasses);this.checkedClasses.forEach(((e,s)=>{if(e.classIdx<i.classes.length-1&&(0===s||s>0&&o[s-1].classIdx!==e.classIdx+1)){const t=i.classes.splice(e.classIdx,1)[0];i.classes.splice(e.classIdx+1,0,t),o[s].classIdx=e.classIdx+1}})),this.checkedClasses=o,t.uniqueValueGroups=a,(0,l.u)(e),this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((async()=>{await(this.moveDownNode.disabled?this.moveUpNode.setFocus():this.moveDownNode.setFocus())}),300)}moveToGroup(){this.showMoveToGroup=!0}moveToNewGroup(e=!1){const{smartMappingState:s}=this,{modules:t}=s,a=(0,l.j)(s),i=a.uniqueValueGroups;let n=this.checkedClasses.filter((e=>-1!==e.groupIdx)).map((e=>i[e.groupIdx].classes[e.classIdx]));const r=(0,o.b)(s);n=n.concat(this.checkedClasses.filter((e=>-1===e.groupIdx)).map((e=>r[e.classIdx])));const u=new t.UniqueValueGroup({heading:e?void 0:(0,o.f)(s,i),classes:n});i.push(u),this.checkedClasses.sort(((e,s)=>s.groupIdx-e.groupIdx==0?s.classIdx-e.classIdx:s.groupIdx-e.groupIdx)),this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(i[e.groupIdx].classes.splice(e.classIdx,1),i[e.groupIdx].classes.length||i.splice(e.groupIdx,1))})),this.checkedClasses=[],a.uniqueValueGroups=i,(0,l.u)(s),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{this.groupMenuNodes[i.length-1]?.setFocus()}),300)}moveUp(){const{smartMappingState:e}=this,{modules:s}=e,t=(0,l.j)(e),a=t.uniqueValueGroups,i=a[this.checkedClasses[0].groupIdx];this.checkedClasses.sort(((e,s)=>e.groupIdx-s.groupIdx==0?e.classIdx-s.classIdx:e.groupIdx-s.groupIdx));const o=s.esriLang.clone(this.checkedClasses);this.checkedClasses.forEach(((e,s)=>{if(e.classIdx>0&&(0===s||s>0&&o[s-1].classIdx!==e.classIdx-1)){const t=i.classes.splice(e.classIdx,1)[0];i.classes.splice(e.classIdx-1,0,t),o[s].classIdx=e.classIdx-1}})),this.checkedClasses=o,t.uniqueValueGroups=a,(0,l.u)(e),this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((async()=>{await(this.moveUpNode.disabled?this.moveDownNode.setFocus():this.moveUpNode.setFocus())}),300)}removeValues(){const{smartMappingState:e}=this,s=(0,l.j)(e);let t=s.uniqueValueGroups;const a={};this.checkedClasses?.forEach((e=>{a[e.groupIdx]||(a[e.groupIdx]=[]),a[e.groupIdx].push(e.classIdx)})),t.forEach(((e,s)=>{const t=a[s];t&&(e.classes=e.classes.filter(((e,s)=>!t.includes(s))))})),t=t.filter((e=>!!e.classes.length)),s.uniqueValueGroups=t,(0,l.u)(e),this.popoverNode.open=!1,this.checkedClasses=[],this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses})}separateSelectedValues(){const{smartMappingState:e}=this,s=(0,l.j)(e).uniqueValueGroups;this.checkedClasses.sort(((e,s)=>e.groupIdx-s.groupIdx==0?e.classIdx-s.classIdx:e.groupIdx-s.groupIdx));const t=[];let a=-2,i=[];this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(a!==e.groupIdx?(-2!==a&&t.push({groupIdx:a,classIdxs:i}),a=e.groupIdx,i=[e.classIdx]):i.push(e.classIdx))})),-2!==a&&t.push({groupIdx:a,classIdxs:i}),t.forEach((t=>(0,o.e)(e,s[t.groupIdx],t.classIdxs))),this.checkedClasses=[],(0,l.u)(e),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses})}get el(){return(0,a.g)(this)}};n.style=".popover{--calcite-popover-z-index:100}";const r=class{constructor(e){(0,a.r)(this,e),this.arcgisSmartMappingTypeAddValuePopoverClose=(0,a.c)(this,"arcgisSmartMappingTypeAddValuePopoverClose",7),this.arcgisSmartMappingTypeAddValuePopoverNewValue=(0,a.c)(this,"arcgisSmartMappingTypeAddValuePopoverNewValue",7),this.manager=(0,i.u)(this),this.isInt=!1,this.userTouchedLabel=!1,this.flowItemNode=void 0,this.referenceNode=void 0,this.groupIdx=void 0,this.smartMappingState=void 0}componentWillLoad(){const{smartMappingState:e}=this,{allUniqueValues:s}=e,t=(0,l.j)(e);this.allValues=s?.map((e=>`${e.value}`)),t.uniqueValueGroups.forEach((e=>{e.classes.forEach((e=>{const s=e.values?.[0].value;this.allValues.includes(`${s}`)||this.allValues.push(`${s}`)}))})),this.field=(0,l.o)(e,t.field),this.isDate=this.field?.simpleFieldType===l.q.DATE,this.isNumber=this.field?.simpleFieldType===l.q.NUMBER,this.isInt=!!this.field&&["small-integer","integer","long"].includes((0,l.v)(e,this.field.layerField)||"string")}componentDidLoad(){this.panelNode?.setFocus()}disconnectedCallback(){clearTimeout(this.addNumberHandle)}render(){const{strings:e}=this.smartMappingState;return(0,a.h)(a.H,{key:"a9e0cd33193304b51b217422f45116dd1a8c075d"},(0,a.h)("calcite-popover",{key:"f13ec0edfcfed238e0385530dd1ab01e035fbb6c",referenceElement:this.referenceNode,placement:"bottom-end",offsetDistance:0,offsetSkidding:0,label:e.panels.type.addValue,open:!0,ref:e=>this.popoverNode=e},this.renderContent()))}renderContent(){const{strings:e}=this.smartMappingState,s=this.flowItemNode?.getBoundingClientRect().width;return(0,a.h)("calcite-panel",{heading:e.panels.type.addValue,closable:!0,onCalcitePanelClose:()=>this.arcgisSmartMappingTypeAddValuePopoverClose.emit(),ref:e=>this.panelNode=e},(0,a.h)("div",{ref:e=>{e&&(e.style.padding="15px",e.style.width=`${s?s+20:280}px`)}},this.renderValueInput(),this.renderLabelInput()),this.renderDoneButton())}renderValueInput(){const{strings:e}=this.smartMappingState,{isDate:s,isInt:t,isNumber:l}=this;return(0,a.h)("calcite-label",{scale:"s"},e.panels.type.value,s?(0,a.h)("calcite-input-date-picker",{scale:"s",overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>{const s=e.target;this.handleAddDate(s.value)},ref:e=>{e&&(this.valueInputNode=e)}}):l?(0,a.h)("calcite-input-number",{step:t?1:"any",scale:"s",label:e.panels.type.value,placeholder:e.panels.type.storedValue,onCalciteInputNumberInput:()=>{clearTimeout(this.addNumberHandle);const e=this.valueInputNode.value;Number.isNaN(Number(e))?(this.doneButtonNode.disabled=!0,this.valueInputMessageNode.hidden=!0,this.addNumberHandle=setTimeout((()=>{this.valueInputNode.value="",this.userTouchedLabel||(this.labelInputNode.value="")}),3e3)):this.handleAddNumber(e)},ref:e=>{e&&(this.valueInputNode=e)}}):(0,a.h)("calcite-input",{scale:"s",label:e.panels.type.value,placeholder:e.panels.type.storedValue,onCalciteInputInput:()=>this.handleAddString(this.valueInputNode.value),ref:e=>{e&&(this.valueInputNode=e)}}),(0,a.h)("calcite-input-message",{hidden:!0,icon:"exclamation-mark-triangle",status:"invalid",ref:e=>this.valueInputMessageNode=e},e.panels.type.valueNotUnique))}renderLabelInput(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-label",{scale:"s"},e.panels.type.label,(0,a.h)("calcite-input",{type:"text",value:"",scale:"s",placeholder:e.panels.type.displayedValue,label:e.panels.type.label,onCalciteInputInput:()=>this.userTouchedLabel=!0,ref:e=>this.labelInputNode=e}))}renderDoneButton(){const{smartMappingState:e}=this,{modules:s,strings:t}=e,{field:l,isDate:i,isInt:n,isNumber:r}=this;return(0,a.h)("calcite-button",{appearance:"solid",label:t.done,width:"full",slot:"footer",disabled:!0,onClick:()=>{this.popoverNode.open=!1;const t=this.valueInputNode.value;let a,u;i?(a=this.labelInputNode.value||(0,o.d)(e,t,l),u=t):r?(u=n?Number.parseInt(t):Number.parseFloat(t),a=this.labelInputNode.value||s.intl.formatNumber(u)):(a=this.labelInputNode.value||t,u=t),this.addValue(a,u)},ref:e=>this.doneButtonNode=e},t.done)}addValue(e,s){const{smartMappingState:t}=this,{modules:a}=t,i=(0,l.j)(t),o=a.esriLang.clone(i.uniqueValueInfos.find((e=>["simple-marker","simple-line","simple-fill","cim"].includes(e.symbol?.type??"")))?.symbol||(0,l.m)(t,(0,l.a)(t))),n=(0,l.a6)(t).colors,r=new a.EsriColor(n[i.uniqueValueInfos.length%10]);r&&(0,l.X)(t,o,r);let u=i.uniqueValueGroups;-2===this.groupIdx&&(u=[new a.UniqueValueGroup({heading:void 0,classes:[]})],this.groupIdx=0),u[this.groupIdx].classes.push(new a.UniqueValueClass({values:[new a.UniqueValue({value:s})],label:e,symbol:o})),i.uniqueValueGroups=u,this.arcgisSmartMappingTypeAddValuePopoverNewValue.emit()}handleAddDate(e){const{smartMappingState:s}=this,{allUniqueValues:t}=s,a=(0,l.j)(s),i=t?.map((e=>`${e.value}`));a.uniqueValueGroups.forEach((e=>{e.classes.forEach((e=>{const s=e.values?.[0].value;i.includes(`${s}`)||i.push(`${s}`)}))}));const n=(0,l.o)(s,a.field);this.userTouchedLabel||(this.labelInputNode.value=(0,o.d)(s,e,n)),this.valueInputMessageNode.hidden=!i.includes(e),this.doneButtonNode.disabled=!e.length||i.includes(e)}handleAddNumber(e){const{modules:s}=this.smartMappingState;if(e.length&&this.isInt){let s=`${Math.round(Number.parseFloat(e))}`;s.includes(".")&&(s=s.substring(0,s.indexOf("."))),s!==e&&(e=s)}if(!this.userTouchedLabel){const t=this.isInt?Number.parseInt(e):Number.parseFloat(e);this.labelInputNode.value=s.intl.formatNumber(t)}this.valueInputMessageNode.hidden=!this.allValues.includes(e),this.doneButtonNode.disabled=!e.length||this.allValues.includes(e)}handleAddString(e){this.userTouchedLabel||(this.labelInputNode.value=e),this.valueInputMessageNode.hidden=!this.allValues.includes(e),this.doneButtonNode.disabled=!e.length||this.allValues.includes(e)}get el(){return(0,a.g)(this)}}},67751:(e,s,t)=>{t.d(s,{a:()=>n,b:()=>c,c:()=>o,d:()=>u,e:()=>g,f:()=>p,g:()=>d,m:()=>i,s:()=>h});var a=t(68180),l=t(99592);t(97127);const i=500;async function o(e,s){const{layer:t,useFeatureReduction:o,mapImageSublayer:n,mapView:r,modules:u}=e,c=t;s=s||{};const d=(0,l.k)((0,l.j)(e)),p=s.fieldInfos[0];return await u.TypeCreator.createRenderer({layer:c,view:r,field:p.field,valueExpression:p.expression,valueExpressionTitle:p.expressionTitle,numTypes:s.numTypes||10,sortBy:s.sortBy||"count",typeScheme:s.typeScheme||(0,l.a5)(e,i),returnAllCodedValues:!0,outlineOptimizationEnabled:!n&&(!(0,a.i)(s.outlineOptimizationEnabled)||s.outlineOptimizationEnabled),sizeOptimizationEnabled:!n&&(!(0,a.i)(s.sizeOptimizationEnabled)||s.sizeOptimizationEnabled),legendOptions:s.legendOptions,defaultSymbolEnabled:!0,forBinning:"binning"===c.featureReduction?.type&&o}).then((t=>{if(t.excludedUniqueValueInfos.length||(t.renderer.defaultLabel=void 0,t.renderer.defaultSymbol=void 0),h(e,s)){const s=(0,l.j)(e).clone(),a=(0,l.b)(s,"size","auto"),i=(0,l.b)(s,"size","outline");if(t.renderer.visualVariables=[],a&&(t.renderer.visualVariables=t.renderer.visualVariables||[],t.renderer.visualVariables.push(a)),i&&(t.renderer.visualVariables=t.renderer.visualVariables||[],t.renderer.visualVariables.push(i)),t.renderer.uniqueValueInfos=s.uniqueValueInfos,t.renderer.field2=s.field2,t.renderer.field3=s.field3,(0,l.z)(e)&&"type-size"===(0,l.a)(e)){const s=(0,l.m)(e),a=t.renderer.uniqueValueInfos?.slice();a?.forEach((t=>{const a=(0,l.Z)(e,t.symbol);t.symbol=s.clone(),(0,l.X)(e,t.symbol,a)})),t.renderer.uniqueValueInfos=a}}return(0,l.l)(d,t.renderer),t}))}async function n(e,s){const{layer:t,useFeatureReduction:o,mapImageSublayer:n,mapView:r,modules:u}=e,c=t,d=(s=s||[]).fieldInfos?s.fieldInfos[0]:null,p=(0,l.j)(e),h=(0,l.k)(p),g=p.uniqueValueInfos?.length?p.uniqueValueInfos[0].symbol:null,m=p.defaultSymbol,f=p.defaultLabel,I=d&&(d.field!==p.field||d.expression!==p.valueExpression);return s=s||{},await u.TypeCreator.createRenderer({layer:c,view:r,field:d?d.field:p.field,valueExpression:d?d.expression:p.valueExpression,valueExpressionTitle:d?d.expressionTitle:p.valueExpressionTitle,numTypes:s.numTypes||(I?10:p.uniqueValueInfos.length),sortBy:s.sortBy||"count",typeScheme:(0,l.a5)(e,i),outlineOptimizationEnabled:!n&&((0,a.i)(s.outlineOptimizationEnabled)?s.outlineOptimizationEnabled:!!h.sizeOutlineVisVar),sizeOptimizationEnabled:!n&&((0,a.i)(s.sizeOptimizationEnabled)?s.sizeOptimizationEnabled:!!h.sizeAutoVisVar),legendOptions:s.legendOptions||p.legendOptions,defaultSymbolEnabled:(0,a.i)(s.defaultSymbolEnabled)||!!p.defaultSymbol,forBinning:"binning"===c.featureReduction?.type&&o}).then((s=>{if((0,l.l)(h,s.renderer),g&&s.renderer.uniqueValueInfos?.length){const t=s.renderer.uniqueValueInfos.slice();t.forEach((s=>{const t=g.clone();(0,l.X)(e,t,(0,l.Z)(e,s.symbol)),s.symbol=t})),s.renderer.uniqueValueInfos=t}return m&&(s.renderer.defaultSymbol=m,s.renderer.defaultLabel=f),s}))}const r={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"};function u(e,s,t){const{allUniqueValues:a,locale:i,mapView:o,modules:n}=e;if(n.intl.setLocale(i),t?.simpleFieldType===l.q.DATE){let e;a&&(e=n.rendererSupportUtils.calculateDateFormatInterval(a.map((e=>e.value))));const t=new Date(s);if("unknown"===o.timeZone)return n.intl.formatDate(t,{...n.intl.convertDateFormatToIntlOptions(e?r[e]:"long-month-day-year"),timeZone:"utc",timeZoneName:"shortOffset"});{const s=new Date(t.getTime()+6e4*t.getTimezoneOffset());return n.intl.formatDate(s,{...n.intl.convertDateFormatToIntlOptions(e?r[e]:"long-month-day-year"),timeZone:o.timeZone})}}return n.intl.formatDateOnly(s,n.intl.convertDateFormatToIntlOptions("long-month-day-year"))}function c(e){const{allUniqueValues:s,modules:t}=e,i=(0,l.j)(e);if(!s?.length||!(0,a.i)(s[0].count))return[];let o=[];i.uniqueValueGroups.forEach((e=>{const s=[];e.classes.forEach((e=>e.values.forEach((e=>s.push(`${e.value}`))))),o=o.concat(s)}));return s.filter((e=>!o.includes(null===e.value?"<Null>":`${e.value}`))).map((e=>new t.UniqueValueClass({label:e.label,symbol:e.symbol,values:[{value:e.value}]})))}function d(e){const{allUniqueValues:s}=e,t=(0,l.j)(e);if(!s?.length||!(0,a.i)(s[0].count))return[];let i=[];t.uniqueValueGroups.forEach((e=>{const s=[];e.classes.forEach((e=>e.values.forEach((e=>s.push("<Null>"===e.value?"null":`${e.value}`))))),i=i.concat(s)}));return s.filter((e=>!i.includes(`${e.value}`)))}function p(e,s){const{strings:t}=e;let a=1,l=t.panels.type.defaultGroupName.replace("${number}",a.toString());for(;s.find((e=>e.heading===l));)l=t.panels.type.defaultGroupName.replace("${number}",(++a).toString());return l}function h(e,s){if(["type","type-size"].includes((0,l.a)(e))){const t=(0,l.j)(e),a={field:t.field,expression:t.valueExpression,expressionTitle:t.valueExpressionTitle};if((0,l.r)(s.fieldInfos[0],a))return!0}return!1}function g(e,s,t){const{modules:a}=e,i=(0,l.j)(e),o=(0,l.o)(e,i.field),n=o&&["small-integer","integer","big-integer","long"].includes((0,l.v)(e,o.layerField)),r=o?.simpleFieldType===l.q.DATE,c="date-only"===(0,l.v)(e,o?.layerField),d=[],p=(0,l.a5)(e);let h=0;s.classes.forEach(((i,g)=>{if(1===i.values.length||t&&!t.includes(g))d.push(i),h++;else if(!t||t.includes(g)){const t=i.symbol?.type,g=null!=t&&["simple-marker","simple-line","simple-fill","cim"].includes(t)?i.symbol:(0,l.m)(e,(0,l.a)(e));i.values.forEach(((t,i)=>{const m=a.esriLang.clone(g);if(i>0)if(p){const t=p.colors[(s.classes.length+h)%p.colors.length];t&&(0,l.X)(e,m,t)}else{const t=(0,l.a6)(e).colors,i=new a.EsriColor(t[(s.classes.length+h)%10]);i&&(0,l.X)(e,m,i)}const f=o?.layerField?.domain,I=f?f.codedValues?.find((e=>e.code===t.value)):null,v=I?I.name:r||c?u(e,t.value,o):o?.simpleFieldType===l.q.NUMBER?a.intl.formatNumber(n?Number.parseInt(t.value):Number.parseFloat(t.value)):t.value;d.push(new a.UniqueValueClass({values:[new a.UniqueValue({value:t.value})],label:v,symbol:m})),h++}))}})),s.classes=d}}}]);