/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-a980c9.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-a980c9"],{48278:(e,t,i)=>{i.r(t),i.d(t,{arcgis_attributes_formatting:()=>c});var a=i(28614),s=i(71480),l=i(68180),o=i(18080),n=i(97127);const r=["short-date","long-month-day-year","day-short-month-year","long-date","long-month-year","short-month-year","year"],d=["short-time","long-time","short-time-24","long-time-24"],m=new Map;m.set("short-date",{dateFormat:r[0],timeFormat:""}),m.set("short-date-short-time",{dateFormat:r[0],timeFormat:d[0]}),m.set("short-date-long-time",{dateFormat:r[0],timeFormat:d[1]}),m.set("short-date-short-time-24",{dateFormat:r[0],timeFormat:d[2]}),m.set("short-date-long-time-24",{dateFormat:r[0],timeFormat:d[3]}),m.set("long-month-day-year",{dateFormat:r[1],timeFormat:""}),m.set("long-month-day-year-short-time",{dateFormat:r[1],timeFormat:d[0]}),m.set("long-month-day-year-long-time",{dateFormat:r[1],timeFormat:d[1]}),m.set("long-month-day-year-short-time-24",{dateFormat:r[1],timeFormat:d[2]}),m.set("long-month-day-year-long-time-24",{dateFormat:r[1],timeFormat:d[3]}),m.set("day-short-month-year",{dateFormat:r[2],timeFormat:""}),m.set("day-short-month-year-short-time",{dateFormat:r[2],timeFormat:d[0]}),m.set("day-short-month-year-long-time",{dateFormat:r[2],timeFormat:d[1]}),m.set("day-short-month-year-short-time-24",{dateFormat:r[2],timeFormat:d[2]}),m.set("day-short-month-year-long-time-24",{dateFormat:r[2],timeFormat:d[3]}),m.set("long-date",{dateFormat:r[3],timeFormat:""}),m.set("long-date-short-time",{dateFormat:r[3],timeFormat:d[0]}),m.set("long-date-long-time",{dateFormat:r[3],timeFormat:d[1]}),m.set("long-date-short-time-24",{dateFormat:r[3],timeFormat:d[2]}),m.set("long-date-long-time-24",{dateFormat:r[3],timeFormat:d[3]}),m.set("long-month-year",{dateFormat:r[4],timeFormat:null}),m.set("short-month-year",{dateFormat:r[5],timeFormat:null}),m.set("year",{dateFormat:r[6],timeFormat:null}),m.set("default",{dateFormat:r[0],timeFormat:d[2]});const h=new Date("December 31, 1969 18:00:00"),c=class{constructor(e){(0,a.r)(this,e),this.arcgisChange=(0,a.c)(this,"arcgisChange",7),this.arcgisClose=(0,a.c)(this,"arcgisClose",7),this.arcgisFieldDeleted=(0,a.c)(this,"arcgisFieldDeleted",7),this.manager=(0,n.u)(this),this.layerFieldsMap=new Map,this.arcadeExpMap=new Map,this.selectedFieldInfosMap=new Map,this.hasCommonDataTypes=!0,this.fieldsAreDeletable=!1,this.mapView=void 0,this.layer=void 0,this.config=void 0,this.strings=void 0,this.popupTemplate=void 0,this.popoverProps=void 0,this.selectedFields=void 0,this.deleteFieldEnabled=!1}async reposition(){this.popoverNode?.reposition()}async setFocus(){this.panelNode?.setFocus()}async componentWillLoad(){const{layer:e,mapView:t,popupTemplate:i,selectedFields:a,deleteFieldEnabled:n}=this;if(this.intl=await(0,s.al)(),this.layerFieldsMap=await(0,l.g)(e),this.arcadeExpMap=(0,l.e)(i),a.forEach((e=>{const t=i.fieldInfos.find((t=>t.fieldName===e));t&&this.selectedFieldInfosMap.set(e,{index:i.fieldInfos.indexOf(t),fieldType:(0,l.h)(e,this.layerFieldsMap,this.arcadeExpMap),fieldInfo:t})})),this.firstSelectedFieldInfo=this.selectedFieldInfosMap.get(a[0]).fieldInfo,this.firstSelectedFieldType=this.selectedFieldInfosMap.get(a[0]).fieldType,this.hasCommonDataTypes=this.checkCommonDataTypes(this.firstSelectedFieldType),!this.firstSelectedFieldInfo.format&&this.hasCommonDataTypes&&await this.setUpDefaultFormat(this.firstSelectedFieldInfo,this.firstSelectedFieldType),n&&("feature"===e.type||"oriented-imagery"===e.type)&&e.portalItem&&(1===a?.length||a?.length>1&&this.enableMultipleDeletion(e.portalItem))){const i=e.fields.filter((e=>a.includes(e.name)));if(a.some((t=>!e.fields.find((e=>e.name===t)))))this.fieldsAreDeletable=!1;else{const a=await Promise.all(i.map((async i=>await(0,o.a)(t,e,i))));this.fieldsAreDeletable=!a.some((e=>!e))}}}componentDidLoad(){this.panelNode?.setFocus()}render(){const{strings:e,popoverProps:t,hasCommonDataTypes:i,selectedFields:s}=this;return(0,a.h)(a.H,{key:"4e1e5c95c9c458be9712c401c4c3619716b86376",class:"js-app-flyout"},(0,a.h)("calcite-popover",{key:"f8e75e236a0ad87a229fdebd8dff11c6de767589",class:"popover",placement:"leading-start",open:!0,pointerDisabled:!0,referenceElement:t.refElement,offsetDistance:0,offsetSkidding:45,label:e.attributesFormatting.formattingOptions,ref:e=>this.popoverNode=e},(0,a.h)("calcite-panel",{key:"bb0e871d7258b70380b73d5d7e9e8b1bd11fe512",closable:!0,style:{width:`${t.refElement.getBoundingClientRect().width}px`},onCalcitePanelClose:()=>this.arcgisClose.emit(),ref:e=>this.panelNode=e},(0,a.h)("div",{key:"3ce1cf970a13f70e3694c22a1a5d4fc60f666c65",slot:"header-content"},e.attributesFormatting.manageField),(0,a.h)("div",{key:"a1203c9fd4de149f315d210e06b4e46d1fb2f81c",class:"formatting-div"},1===s.length?this.renderDisplayName():(0,a.h)("h3",null,e.attributesFormatting.multipleSelection.replace("${number}",`${s.length}`)),i?this.renderFormattingOptions():(0,a.h)("h3",null,e.attributesFormatting.selectCommon)),this.renderDeleteButton(),this.renderDoneButton())))}renderDisplayName(){const{strings:e,arcadeExpMap:t,firstSelectedFieldInfo:i}=this;return(0,a.h)("calcite-label",null,e.attributesFormatting.displayName,(0,a.h)("calcite-input",{type:"text",ref:e=>this.displayNameNode=e,value:(t.has(i.fieldName)?t.get(i.fieldName).title:i.label)??void 0,onCalciteInputInput:()=>this.handleDisplayNameChange()}))}renderFormattingOptions(){const{firstSelectedFieldInfo:e,firstSelectedFieldType:t}=this;if(e.format){if(t===l.f.integer||t===l.f.smallInteger||t===l.f.bigInteger)return this.renderThousandSeparator();if(t===l.f.single||t===l.f.double||t===l.f.long||t===l.f.number)return(0,a.h)("div",null,this.renderSignificantDigits(),this.renderThousandSeparator());if(t!==l.f.date&&t!==l.f.dateOnly&&t!==l.f.timeOnly&&t!==l.f.timestampOffset||!this.dateFormattingAvailable())return(0,a.h)(a.F,null);{const i=m.has(e.format.dateFormat)?m.get(e.format.dateFormat):t===l.f.dateOnly?m.get("short-date"):m.get("short-date-short-time");return(0,a.h)("div",null,t!==l.f.timeOnly&&this.renderDateFormat(i.dateFormat),t!==l.f.timeOnly&&t!==l.f.dateOnly&&this.renderShowTime(i.timeFormat),t!==l.f.dateOnly&&this.renderTimeFormat(i.timeFormat))}}return(0,a.h)(a.F,null)}renderThousandSeparator(){const{strings:e,firstSelectedFieldInfo:t}=this;return(0,a.h)("section",{class:"single-line-label-switch-section"},(0,a.h)("calcite-label",{class:"single-line-label-switch-label"},e.attributesFormatting.showThousandsSeparator),(0,a.h)("calcite-switch",{scale:"s",class:"single-line-label-switch-switch",checked:!!t.format.digitSeparator,onCalciteSwitchChange:e=>{e.stopPropagation(),this.handleCalciteSwitchChange()},ref:e=>this.thousandSeparatorSwitchNode=e}))}renderSignificantDigits(){const{strings:e,firstSelectedFieldInfo:t}=this;return(0,a.h)("section",null,(0,a.h)("calcite-label",null,e.attributesFormatting.significantDigits,(0,a.h)("calcite-select",{label:e.attributesFormatting.significantDigits,onCalciteSelectChange:e=>{const i=e.target;t.format.places=Number(i.selectedOption.value)||0,this.saveFieldInfo()}},[0,1,2,3,4,5,6,7,8].map((i=>(0,a.h)("calcite-option",{value:i.toString(),selected:t.format.places===i},`${i} ${e.attributesFormatting.decimalPlaces}`))))))}renderDateFormat(e){const{strings:t,intl:i}=this;return(0,a.h)("section",null,(0,a.h)("calcite-label",null,t.attributesFormatting.dateFormat,(0,a.h)("calcite-select",{label:t.attributesFormatting.dateFormat,onCalciteSelectChange:()=>this.changeDateTimeFormat(),ref:e=>this.dateFormatSelectNode=e},r.map((t=>(0,a.h)("calcite-option",{value:t,selected:e===t},i.formatDate(h,i.convertDateFormatToIntlOptions(t))))))))}renderShowTime(e){const{strings:t}=this;return(0,a.h)("section",{class:"single-line-label-switch-section",ref:e=>this.showTimeSectionNode=e},(0,a.h)("calcite-label",{class:"single-line-label-switch-label"},t.attributesFormatting.showTime),(0,a.h)("calcite-switch",{scale:"s",class:"single-line-label-switch-switch",checked:!!e,onCalciteSwitchChange:e=>{e.stopPropagation(),this.handleCalciteSwitchChange()},ref:e=>this.showTimeSwitchNode=e}))}renderTimeFormat(e){const{strings:t}=this;return(0,a.h)("section",{ref:e=>this.timeFormatSectionNode=e},(0,a.h)("calcite-label",null,t.attributesFormatting.timeFormat,(0,a.h)("calcite-select",{label:t.attributesFormatting.timeFormat,onCalciteSelectChange:()=>this.changeDateTimeFormat(),ref:e=>this.timeFormatSelectNode=e},d.map((t=>(0,a.h)("calcite-option",{value:t,selected:e===t},this.getTimeFormatString(t)))))))}renderDeleteButton(){const{layer:e,mapView:t,config:i,selectedFields:s,strings:l,fieldsAreDeletable:o}=this;if(!o)return(0,a.h)(a.F,null);const n=window.customElements?.get("arcgis-field-delete");return n?(0,a.h)("calcite-button",{appearance:"outline-fill",slot:"footer",width:"half",kind:"danger",onClick:a=>{const l=a.target;l.disabled=!0;const o=document.createElement("arcgis-field-delete");o.layer=e,o.mapView=t,o.config=i,o.fieldNames=s,o.addEventListener("arcgisFieldDeleteModalClose",(()=>l.disabled=!1)),o.addEventListener("arcgisFieldDeleteFieldDeleted",(()=>this.arcgisFieldDeleted.emit(s))),document.body.append(o)}},1===s.length?l.attributesFormatting.deleteField:l.attributesFormatting.deleteFields):(0,a.h)(a.F,null)}renderDoneButton(){const{strings:e,fieldsAreDeletable:t}=this;return(0,a.h)("calcite-button",{appearance:"outline-fill",slot:"footer",width:t?"half":"full",onClick:()=>this.arcgisClose.emit()},e.attributesFormatting.done)}enableMultipleDeletion(e){return"devext.arcgis.com"===e.portal?.portalHostname&&"1"===window.localStorage.getItem("allow-bulk-field-deletion-agol-mv")}checkCommonDataTypes(e){const{selectedFields:t,selectedFieldInfosMap:i}=this;for(let a=1;a<t.length;a++){const s=i.get(t[a]).fieldType;if(e===l.f.integer||e===l.f.smallInteger||e===l.f.bigInteger){if(![l.f.integer,l.f.smallInteger,l.f.bigInteger].includes(s))return!1}else if(e===l.f.single||e===l.f.double||e===l.f.long||e===l.f.number){if(![l.f.single,l.f.double,l.f.long,l.f.number].includes(s))return!1}else if(e===l.f.date||e===l.f.timestampOffset){if(![l.f.date,l.f.timestampOffset].includes(s))return!1}else if(e===l.f.dateOnly){if(![l.f.dateOnly].includes(s))return!1}else if(e===l.f.timeOnly&&![l.f.timeOnly].includes(s))return!1}return!0}async setUpDefaultFormat(e,t){const i=await(0,s.a_)();t===l.f.integer||t===l.f.smallInteger||t===l.f.bigInteger?(e.format=new i({digitSeparator:!1}),this.saveFieldInfo()):t===l.f.single||t===l.f.double||t===l.f.long||t===l.f.number?(e.format=new i({digitSeparator:!1,places:2}),this.saveFieldInfo()):t!==l.f.date&&t!==l.f.dateOnly&&t!==l.f.timeOnly&&t!==l.f.timestampOffset||!this.dateFormattingAvailable()||(t===l.f.dateOnly?e.format=new i({dateFormat:"short-date"}):e.format=new i({dateFormat:"short-date-short-time"}),this.saveFieldInfo())}setUpDateTimeDisplay(){const{firstSelectedFieldInfo:e,firstSelectedFieldType:t,hasCommonDataTypes:i}=this;if((t===l.f.date||t===l.f.timeOnly||t===l.f.timestampOffset)&&e.format?.dateFormat&&i){const i=m.get(e.format.dateFormat);t===l.f.date||t===l.f.timestampOffset?""===i.timeFormat?(this.showTimeSwitchNode.checked=!1,this.showTimeSectionNode.style.display="flex",this.timeFormatSectionNode.style.display="none"):null===i.timeFormat?(this.showTimeSwitchNode.checked=!1,this.showTimeSectionNode.style.display="none",this.timeFormatSectionNode.style.display="none"):(this.showTimeSwitchNode.checked=!0,this.showTimeSectionNode.style.display="flex",this.timeFormatSectionNode.style.display="block"):t===l.f.timeOnly&&(this.timeFormatSectionNode.style.display="block")}}dateFormattingAvailable(){const{layer:e}=this;return(0,l.d)(e)!==l.s.scene||null!==e.associatedLayer}handleDisplayNameChange(){const{firstSelectedFieldInfo:e}=this;(0,l.i)(this.displayNameNode.value)||(this.displayNameNode.value=e.fieldName),this.arcadeExpMap.has(e.fieldName)?this.arcadeExpMap.get(e.fieldName).title=this.displayNameNode.value:e.label=this.displayNameNode.value,this.saveFieldInfo()}handleCalciteSwitchChange(){const{firstSelectedFieldInfo:e,firstSelectedFieldType:t}=this;e.format&&(t===l.f.date||t===l.f.timestampOffset?this.changeDateTimeFormat():(e.format.digitSeparator=!!this.thousandSeparatorSwitchNode?.checked,this.saveFieldInfo()))}changeDateTimeFormat(){const{firstSelectedFieldInfo:e,firstSelectedFieldType:t}=this,i=this.dateFormatSelectNode?.selectedOption?.value,a=this.timeFormatSelectNode?.selectedOption?.value;if(t===l.f.date||t===l.f.timestampOffset){const t=m.get(i);""===t.timeFormat?e.format.dateFormat=this.showTimeSwitchNode.checked?`${i}-${a}`:`${i}`:null===t.timeFormat&&(e.format.dateFormat=`${i}`)}else t===l.f.dateOnly?e.format.dateFormat=`${i}`:t===l.f.timeOnly&&(e.format.dateFormat=`short-date-${a}`);this.saveFieldInfo(),this.setUpDateTimeDisplay(),this.popoverNode?.reposition()}getTimeFormatString(e){const{strings:t}=this;return e===d[0]?t.attributesFormatting.shortTime:e===d[1]?t.attributesFormatting.longTime:e===d[2]?t.attributesFormatting.shortTime24:e===d[3]?t.attributesFormatting.longTime24:t.attributesFormatting.shortTime24}saveFieldInfo(){const{arcadeExpMap:e,selectedFieldInfosMap:t,selectedFields:i,firstSelectedFieldInfo:a,hasCommonDataTypes:s}=this;s&&(t.forEach((e=>{e.fieldInfo.fieldName===a.fieldName?e.fieldInfo=a.clone():e.fieldInfo.format=a.format.clone()})),1===i.length&&e.has(a.fieldName)&&this.popupTemplate.expressionInfos?.forEach(((t,i)=>{`${l.a.expression}${t.name}`!==a.fieldName||(this.popupTemplate.expressionInfos[i]=e.get(a.fieldName).clone())})),t.forEach((e=>{this.popupTemplate.fieldInfos[e.index]=e.fieldInfo.clone()})),Array.isArray(this.popupTemplate.content)&&this.popupTemplate.content.forEach((e=>{"fields"===e.type&&e.fieldInfos&&e.fieldInfos.forEach(((i,a)=>{if(t.has(i.fieldName)){const s=t.get(i.fieldName).fieldInfo.clone();s.visible=!0,e.fieldInfos[a]=s}}))})),this.arcgisChange.emit(this.popupTemplate.clone()))}get el(){return(0,a.g)(this)}};c.style=".popover {\n  --calcite-popover-z-index: 100;\n}\n\n.formatting-div {\n  padding: var(--calcite-spacing-md);\n  max-height: 60vh;\n}\n\n.single-line-label-switch-section {\n  display: flex;\n  margin: 0px;\n  padding: var(--calcite-spacing-sm) 0px;\n}\n\n.single-line-label-switch-label {\n  display: flex;\n  flex-flow: column nowrap;\n  flex: 1 0 0%;\n  overflow: hidden;\n}\n\n.single-line-label-switch-switch {\n  flex: 0 0 0%;\n  justify-self: flex-end;\n  margin: 0px;\n\n  input {\n    display: none;\n  }\n}\n"}}]);