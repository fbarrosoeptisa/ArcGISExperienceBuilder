/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-040962.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-040962"],{30425:(e,t,s)=>{s.r(t),s.d(t,{arcgis_sketch_features:()=>u});var i=s(28614),a=s(89826),r=s(68180),o=s(71480),n=s(97127),c=s(50063);function h(e){switch(e?.geometry?.type){case"point":return"text"===e?.symbol?.type?"text":"point";case"polyline":return"polyline";default:return"polygon"}}function l(e,t,s,i){const r=function(e){if(e)return(0,a.a)(e.webmap,!0)||(0,a.a)(e.current,!0)||void 0;return}(e)||{enabled:!0,selfEnabled:!0,featureEnabled:!0,featureSourcesIds:[t.id]};return new i({enabled:r.enabled,selfEnabled:r.selfEnabled,featureEnabled:r.featureEnabled,featureSources:d(s,r.featureSourcesIds)})}function d(e,t){const s=function(e){const{map:t}=e,{allLayers:s}=t,i=s.flatten((e=>"sublayers"in e?e.sublayers:null)).filter((e=>!e.isTable));return[...new Set(i.toArray())]}(e);return s.filter((e=>t.includes(e.id))).map((e=>({layer:e,enabled:!0})))}class p{constructor(e,t,s,i,a){this.mapNotesLayer=e,this.mapView=t,this.sketchViewModelPoint=new s({layer:this.mapNotesLayer.pointLayer??void 0,view:this.mapView,updateOnGraphicClick:!1,snappingOptions:i}),this.sketchViewModelPoint.on("update",(e=>a(e))),this.sketchViewModelLine=new s({layer:this.mapNotesLayer.polylineLayer??void 0,view:this.mapView,updateOnGraphicClick:!1,snappingOptions:i}),this.sketchViewModelLine.on("update",(e=>a(e))),this.sketchViewModelPolygon=new s({layer:this.mapNotesLayer.polygonLayer??void 0,view:this.mapView,updateOnGraphicClick:!1,snappingOptions:i}),this.sketchViewModelPolygon.on("update",(e=>a(e))),this.sketchViewModelText=new s({layer:this.mapNotesLayer.textLayer??void 0,view:this.mapView,updateOnGraphicClick:!1,snappingOptions:i}),this.sketchViewModelText.on("update",(e=>a(e)))}duplicate(){this.duplicatePoint(),this.duplicateLine(),this.duplicatePolygon(),this.duplicateText()}delete(){this.deletePoint(),this.deleteLine(),this.deletePolygon(),this.deleteText()}cancel(){this.cancelPoint(),this.cancelLine(),this.cancelPolygon(),this.cancelText()}destroy(){this.destroyPoint(),this.destroyLine(),this.destroyPolygon(),this.destroyText()}updatePoint(e){this.sketchViewModelPoint.update(e)}duplicatePoint(){this.sketchViewModelPoint.duplicate()}deletePoint(){this.sketchViewModelPoint.delete()}cancelPoint(){this.sketchViewModelPoint.cancel()}destroyPoint(){this.sketchViewModelPoint.destroy()}updateLine(e){this.sketchViewModelLine.update(e)}duplicateLine(){this.sketchViewModelLine.duplicate()}deleteLine(){this.sketchViewModelLine.delete()}cancelLine(){this.sketchViewModelLine.cancel()}destroyLine(){this.sketchViewModelLine.destroy()}updatePolygon(e){this.sketchViewModelPolygon.update(e)}duplicatePolygon(){this.sketchViewModelPolygon.duplicate()}deletePolygon(){this.sketchViewModelPolygon.delete()}cancelPolygon(){this.sketchViewModelPolygon.cancel()}destroyPolygon(){this.sketchViewModelPolygon.destroy()}updateText(e){this.sketchViewModelText.update(e)}duplicateText(){this.sketchViewModelText.duplicate()}deleteText(){this.sketchViewModelText.delete()}cancelText(){this.sketchViewModelText.cancel()}destroyText(){this.sketchViewModelText.destroy()}}const u=class{constructor(e){(0,i.r)(this,e),this.arcgisChange=(0,i.c)(this,"arcgisChange",7),this.arcgisSketchFeaturesUpdated=(0,i.c)(this,"arcgisSketchFeaturesUpdated",7),this.arcgisAddFeature=(0,i.c)(this,"arcgisAddFeature",7),this.arcgisSketchFeaturesAddSketch=(0,i.c)(this,"arcgisSketchFeaturesAddSketch",7),this.arcgisEditFeatures=(0,i.c)(this,"arcgisEditFeatures",7),this.arcgisSketchFeaturesEditFeatures=(0,i.c)(this,"arcgisSketchFeaturesEditFeatures",7),this.arcgisCopyToNewSketchLayer=(0,i.c)(this,"arcgisCopyToNewSketchLayer",7),this.arcgisSketchFeaturesCopyToNewSketchLayer=(0,i.c)(this,"arcgisSketchFeaturesCopyToNewSketchLayer",7),this.manager=(0,n.u)(this),this.strings=(0,c.u)({blocking:!0}),this.renderingSymbolPreviews=!1,this.listItemNodes=[],this.graphicsSelectionHandles=[],this.graphicsUpdateHandles=[],this.selectedGraphics=[],this.duplicatedGraphicIndices=[],this.freezeGraphicsListOrder=!1,this.activeSVMCount=0,this.onGraphicUpdate=e=>{if(this.listItemNodes=this.listItemNodes.slice(0,this.graphics.length),"start"===e.state)if(this.freezeGraphicsListOrder||this.activeSVMCount)this.listItemNodes.forEach(((e,t)=>this.listItemNodes[t].selected=(0,r.i)(this.selectedGraphics.find((e=>e.index===t))))),this.freezeGraphicsListOrder=!1,this.activeSVMCount-=1;else{let t=!1;this.selectedGraphics=[],this.graphics.forEach(((s,i)=>{t||JSON.stringify(s.toJSON())!==JSON.stringify(e.graphics[0].toJSON())?this.listItemNodes[i]&&(this.listItemNodes[i].selected=!1):(t=!0,this.selectedGraphics.push({index:i,graphic:s}),this.listItemNodes[i]&&(this.listItemNodes[i].selected=!0),this.addActionsPopover())}))}"complete"===e.state&&(this.arcgisSketchFeaturesUpdated.emit(),this.arcgisChange.emit())},this.mapView=void 0,this.layer=void 0,this.hideAddSketch=!1,this.showAddSketch=!0,this.hideEditFeature=!1,this.showEditFeature=!0,this.snappingSessionStorageIds=void 0,this.blockClosed=!1,this.open=!0,this.graphics=[]}sketchUpdatedHandler(e){e.stopPropagation(),(0,i.f)(this.el)}async setFocus(){this.addFeatureButtonNode?.setFocus()}async done(){this.snappingSessionStorageIds?.current&&function(e,t){const s=[...new Set([...e.featureSources.filter((e=>e.enabled)).map((e=>e.layer.id))])],i={enabled:e.enabled,selfEnabled:e.selfEnabled,featureEnabled:e.featureEnabled,featureSourcesIds:s};(0,a.b)(t,i,!0)}(this.snappingOptions,this.snappingSessionStorageIds.current),this.sketchFeaturesSVModel?.destroy(),this.mapView.popupEnabled=!0}async componentWillLoad(){this.showAddSketch||this.hideAddSketch||(this.hideAddSketch=!0),this.showEditFeature||this.hideEditFeature||(this.hideEditFeature=!0),this.open||this.blockClosed||(this.blockClosed=!0),await this.loadAllModules(),this.snappingOptions=l(this.snappingSessionStorageIds,this.layer,this.mapView,this.modules.SnappingOptions),this.sketchFeaturesSVModel=new p(this.layer,this.mapView,this.modules.SketchViewModel,this.snappingOptions,this.onGraphicUpdate),this.combineMapNotesGraphics()}async componentDidRender(){const{strings:e,modules:t}=this;if(!this.renderingSymbolPreviews){this.renderingSymbolPreviews=!0;for(let s=0;s<this.graphics.length;s++){const i=this.el.shadowRoot.getElementById(`image-${s}`);i.textContent="",await t.symbolUtils.renderPreviewHTML(this.graphics[s].symbol,{node:i,scale:!0,maxSize:20,size:{width:20,height:"polyline"===this.graphics[s].geometry?.type?6:20},..."text"===this.graphics[s].symbol?.type&&{overrideText:this.graphics[s].symbol?.text?.[0]||e.textPreview}})}this.renderingSymbolPreviews=!1}}componentDidLoad(){this.watchForChangesToMapNotesLayer(),this.watchForGraphicSelectionOnClick()}componentDidUpdate(){this.duplicatedGraphicIndices.length&&(this.listItemNodes.forEach(((e,t)=>this.listItemNodes[t].selected=this.duplicatedGraphicIndices.includes(t))),this.selectedGraphics=[],this.listItemNodes.forEach(((e,t)=>{e.selected&&this.selectedGraphics.push({index:t,graphic:this.graphics[t]})})),this.duplicatedGraphicIndices=[])}disconnectedCallback(){this.graphicsSelectionHandles.forEach((e=>e?.remove())),this.graphicsUpdateHandles.forEach((e=>e?.remove())),this.hitTestHandle?.remove(),this.unselectAllGraphics(),this.sketchFeaturesSVModel?.cancel(),this.sketchFeaturesSVModel?.destroy()}render(){const{strings:e,graphics:t,selectedGraphics:s,showAddSketch:a,open:r}=this;return this.listItemNodes=[],(0,i.h)(i.H,{key:"20e9d3e7923fddc9ce3ba00ecc7a6032825bff60"},(0,i.h)("calcite-block",{key:"8b684211794ad5fdd6efc822b75ed8b504f4d7b5",ref:e=>this.blockNode=e,heading:e.sketches,open:r,collapsible:!0,onCalciteBlockOpen:()=>{s.length&&this.addActionsPopover()},onCalciteBlockClose:()=>this.removeActionsPopover()},(0,i.h)("calcite-list",{key:"36562c0a712554ee765f0c6180a2c6b70be33491",selectionMode:"multiple",label:e.sketches},t.map(((e,t)=>this.renderPickListItem(e,t)))),a?(0,i.h)("calcite-button",{ref:e=>this.addFeatureButtonNode=e,iconStart:"pencil-mark",appearance:"transparent",width:"full",onClick:()=>{const{layer:e}=this;this.removeActionsPopover(),this.unselectAllGraphics(),this.sketchFeaturesSVModel.cancel(),this.arcgisSketchFeaturesAddSketch.emit({layer:e}),this.arcgisAddFeature.emit({layer:e})}},e.addSketch):null))}renderPickListItem(e,t){const{strings:s,showEditFeature:a}=this;return(0,i.h)("calcite-list-item",{id:`graphic-${t}`,label:e?.attributes?.title||this.getStringFromType(e),onClick:()=>this.handleFeatureSelectionViaList(),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleFeatureSelectionViaList())},ref:e=>this.listItemNodes.push(e)},(0,i.h)("div",{slot:"content-start",id:`image-${t}`}),a?(0,i.h)("calcite-action",{slot:"actions-end",text:s.edit,title:s.edit,scale:"s",icon:"pencil",onClick:t=>{t.preventDefault(),t.stopPropagation(),this.arcgisSketchFeaturesEditFeatures.emit({features:[e]}),this.arcgisEditFeatures.emit({features:[e]})}}):null)}async loadAllModules(){const[e,t,s,i,a]=await Promise.all([(0,o.y)(),(0,o.b)(),(0,o.z)(),(0,o.A)(),(0,o.B)()]);this.modules={SketchViewModel:e,reactiveUtils:t,symbolUtils:s,drawUtils:i,SnappingOptions:a}}combineMapNotesGraphics(){this.graphics=[...this.layer.pointLayer.graphics,...this.layer.polylineLayer.graphics,...this.layer.polygonLayer.graphics,...this.layer.textLayer.graphics]}watchForChangesToMapNotesLayer(){const{modules:e}=this;for(const t of[this.layer.pointLayer,this.layer.polylineLayer,this.layer.polygonLayer,this.layer.textLayer]){const s=e.reactiveUtils.on((()=>t?.graphics),"change",(()=>{this.freezeGraphicsListOrder||this.combineMapNotesGraphics()}));this.graphicsSelectionHandles.push(s);const i=e.reactiveUtils.on((()=>t),"graphic-update",(e=>{"geometry"!==e?.property&&this.combineMapNotesGraphics()}));this.graphicsUpdateHandles.push(i)}}watchForGraphicSelectionOnClick(){this.hitTestHandle?.remove(),this.hitTestHandle=this.mapView.on("click",(async e=>{const t=(await this.mapView.hitTest(e,{include:this.layer})).results;if(t.length){const e=["point","polyline","polygon"];t.sort(((t,s)=>e.indexOf(t.graphic.geometry.type)-e.indexOf(s.graphic.geometry.type)));const s=t[0].graphic;this.unselectAllGraphics(!0),this.handleFeatureSelectionViaHitTest(s)}else this.listItemNodes?.forEach((e=>{e&&(e.selected=!1)})),this.removeActionsPopover(),this.unselectAllGraphics(),this.sketchFeaturesSVModel.cancel(),this.combineMapNotesGraphics(),this.freezeGraphicsListOrder=!1,this.activeSVMCount=0}))}unselectAllGraphics(e){this.selectedGraphics=[],this.listItemNodes.forEach((e=>{e&&(e.selected=!1)})),e||this.removeActionsPopover()}addActionsPopover(){this.sketchActionsPopoverNode||(this.sketchActionsPopoverNode=document.createElement("arcgis-sketch-actions-popover"),this.sketchActionsPopoverNode.referenceElement=this.blockNode,this.sketchActionsPopoverNode.selectedGraphics=this.selectedGraphics,this.sketchActionsPopoverNode.strings=this.strings,this.sketchActionsPopoverNode.addEventListener("arcgisEdit",(()=>{this.removeActionsPopover();const e=this.selectedGraphics.map((e=>e.graphic));this.arcgisSketchFeaturesEditFeatures.emit({features:e}),this.arcgisEditFeatures.emit({features:e}),this.unselectAllGraphics()})),this.sketchActionsPopoverNode.addEventListener("arcgisDuplicate",(()=>{this.sketchFeaturesSVModel.duplicate(),this.offsetDuplicatedFeatures(),this.combineMapNotesGraphics();const e=this.selectedGraphics.map((e=>e.graphic));this.duplicatedGraphicIndices=[],e.forEach((e=>{let t=!1;this.graphics.forEach(((s,i)=>{t||this.duplicatedGraphicIndices.includes(i)||JSON.stringify(s.toJSON())!==JSON.stringify(e.toJSON())||(this.duplicatedGraphicIndices.push(i),t=!0)}))}))})),this.sketchActionsPopoverNode.addEventListener("arcgisCopy",(()=>{const e=this.selectedGraphics.map((e=>e.graphic));this.arcgisSketchFeaturesCopyToNewSketchLayer.emit({features:e}),this.arcgisCopyToNewSketchLayer.emit({features:e})})),this.sketchActionsPopoverNode.addEventListener("arcgisDelete",(()=>{this.removeActionsPopover(),this.unselectAllGraphics(),this.sketchFeaturesSVModel.delete(),this.combineMapNotesGraphics(),this.freezeGraphicsListOrder=!1,this.activeSVMCount=0})),document.body.appendChild(this.sketchActionsPopoverNode)),this.sketchActionsPopoverNode.setFocus()}removeActionsPopover(){this.sketchActionsPopoverNode?.parentElement?.removeChild(this.sketchActionsPopoverNode),this.sketchActionsPopoverNode=void 0}getStringFromType(e){const{strings:t}=this;switch(e?.geometry?.type){case"point":return"text"===e?.symbol?.type?t.text:t.point;case"polyline":return t.line;case"polygon":return t.polygon;default:return t.point}}handleFeatureSelectionViaHitTest(e){switch(this.freezeGraphicsListOrder=!0,this.activeSVMCount=1,e.layer){case this.layer.pointLayer:this.sketchFeaturesSVModel.updatePoint([e]);break;case this.layer.textLayer:this.sketchFeaturesSVModel.updateText([e]);break;case this.layer.polylineLayer:this.sketchFeaturesSVModel.updateLine([e]);break;case this.layer.polygonLayer:this.sketchFeaturesSVModel.updatePolygon([e]);break;default:return}this.graphics?.forEach(((t,s)=>{if(JSON.stringify(t.toJSON())===JSON.stringify(e.toJSON())){this.selectedGraphics.find((t=>JSON.stringify(t.graphic.toJSON())===JSON.stringify(e.toJSON())))||this.selectedGraphics.push({index:s,graphic:t})}})),this.addActionsPopover()}handleFeatureSelectionViaList(){this.listItemNodes=this.listItemNodes.filter((e=>(0,r.i)(e))),this.listItemNodes.forEach((e=>{const t=Number.parseInt(e.id.split("-")[1]);if(e.selected){this.freezeGraphicsListOrder=!0;this.selectedGraphics.find((e=>e.index===t))||this.selectedGraphics.push({index:t,graphic:this.graphics[t]})}else this.selectedGraphics=this.selectedGraphics.filter((e=>e.index!==t))})),this.selectedGraphics.length?(this.addActionsPopover(),this.sketchActionsPopoverNode.selectedGraphics=this.selectedGraphics,(0,i.f)(this.sketchActionsPopoverNode)):this.removeActionsPopover();let e=[],t=[],s=[],a=[];this.selectedGraphics.forEach((i=>{switch(h(i.graphic)){case"polyline":t=[...t,i.graphic];break;case"polygon":s=[...s,i.graphic];break;case"text":a=[...a,i.graphic];break;default:e=[...e,i.graphic]}}));const o=[e,t,s,a].filter((e=>e.length));this.activeSVMCount=o.length,this.freezeGraphicsListOrder=!0,e.length?this.sketchFeaturesSVModel.updatePoint(e):this.sketchFeaturesSVModel.cancelPoint(),t.length?this.sketchFeaturesSVModel.updateLine(t):this.sketchFeaturesSVModel.cancelLine(),s.length?this.sketchFeaturesSVModel.updatePolygon(s):this.sketchFeaturesSVModel.cancelPolygon(),a.length?this.sketchFeaturesSVModel.updateText(a):this.sketchFeaturesSVModel.cancelText(),this.watchForGraphicSelectionOnClick(),this.selectedGraphics.length||(this.sketchFeaturesSVModel.cancel(),this.combineMapNotesGraphics(),this.freezeGraphicsListOrder=!1,this.activeSVMCount=0)}offsetDuplicatedFeatures(){const{modules:e}=this;this.selectedGraphics.forEach((t=>e.drawUtils.move(t.graphic.geometry,15*this.mapView.resolution,15*this.mapView.resolution)));let t=[],s=[],i=[],a=[];this.selectedGraphics.forEach((e=>{switch(h(e.graphic)){case"polyline":s=[...s,e.graphic];break;case"polygon":i=[...i,e.graphic];break;case"text":a=[...a,e.graphic];break;default:t=[...t,e.graphic]}}));const r=[t,s,i,a].filter((e=>e.length));this.activeSVMCount=r.length,this.freezeGraphicsListOrder=!0,t.length&&this.sketchFeaturesSVModel.updatePoint(t),s.length&&this.sketchFeaturesSVModel.updateLine(s),i.length&&this.sketchFeaturesSVModel.updatePolygon(i),a.length&&this.sketchFeaturesSVModel.updateText(a)}static get assetsDirs(){return["assets"]}get el(){return(0,i.g)(this)}};u.style=".actions-start-padding{padding:8px}"},68180:(e,t,s)=>{s.d(t,{a:()=>i,b:()=>f,c:()=>b,d:()=>p,e:()=>d,f:()=>o,g:()=>l,h:()=>v,i:()=>c,j:()=>h,k:()=>g,l:()=>a,m:()=>u,n:()=>m,o:()=>w,p:()=>N,q:()=>S,s:()=>r,t:()=>y});var i,a,r,o,n=s(71480);function c(e){return null!=e}function h(e,t){const s=e.fieldName;if(s.includes(i.expression)){const e=t.get(s);return e?.title?e.title:s}return e.label?e.label:s}async function l(e){return new Map((await async function(e){return await new Promise(((t,s)=>{switch(p(e)){case r.feature:case r.ogcFeature:case r.stream:t(e.fields);break;case r.mapImage:{const i=e,a=i?.layer;a?.portalItem&&a.url.includes("https://demographics")&&a.url.includes(".arcgis.com")?a.portalItem?.fetchData().then((e=>{if(e?.thematicGroup){const s=new Map(i.fields.map((e=>[e.name,e]))),a=e.thematicGroup.fieldNames,r=[];a.forEach((e=>{s.has(e)&&r.push(s.get(e))})),t(r)}else t(i.fields)})).catch((e=>{s(new Error(e))})):t(i.fields);break}case r.imagery:{const s=e;t((s.fields||[]).concat(s.rasterFields||[]));break}case r.imageryTile:case r.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}}))}(e)).filter((e=>e.visible)).map((e=>[e.name,e])))}function d(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach((e=>{const s=`${i.expression}${e.name}`;t.set(s,e)})),t}function p(e){return"map-image"===e?.layer?.type?r.mapImage:"subtype-sublayer"===e?.type?r.subtype:"tile"===e?.layer?.type?r.tile:"scene"===e?.type?r.scene:"ogc-feature"===e?.type?r.ogcFeature:"imagery"===e?.type?r.imagery:"imagery-tile"===e?.type?r.imageryTile:"wfs"===e?.type?r.wfs:"wcs"===e?.type?r.wcs:"wms"===e?.layer?.type?r.wms:"csv"===e?.type?r.csv:"geojson"===e?.type?r.geojson:"stream"===e?.type?r.stream:"oriented-imagery"===e?.type?r.orientedImagery:"catalog"===e?.type?r.catalog:"catalog-footprint"===e?.type?r.catalogFootprint:"knowledge-graph-sublayer"===e?.type?r.knowledgeGraphSublayer:"voxel"===e?.type?r.voxel:r.feature}function u(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function g(e){return Number((100*(1-e)).toFixed(1))}function y(e){return Number((1-e/100).toFixed(3))}!function(e){e.expression="expression/",e.raster="Raster.",e.relationship="relationships/"}(i||(i={})),function(e){e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes"}(a||(a={})),function(e){e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms"}(r||(r={})),function(e){e.bigInteger="big-integer",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset"}(o||(o={}));const m=(e,t)=>{const s=[];return e?.fieldInfos?.forEach((e=>{e.fieldName?.includes(i.expression)?t&&s.push({name:e.fieldName.slice(i.expression.length),alias:e.fieldName.slice(i.expression.length),type:"string"}):s.push({name:e.fieldName,alias:e.label,type:"string"})})),s},f=async(e,t)=>{const[s,i]=await Promise.all([(0,n.g)(),(0,n.h)()]),a=new i;a.geometry=t.extent,a.mapExtent=t.extent,a.returnGeometry=!0,a.tolerance=6,a.layerOption="popup",a.width=t.width,a.height=t.height,a.layerIds=[e.id];const r=(await s.identify(e.layer.url,a))?.results,o=r?.[0]?.feature;return o},w=async(e,t,s)=>{const i=await e.whenLayerView(t),a=await i.queryAggregates();return await k(s,a.features?.[0])},k=async(e,t)=>{const s=await(0,n.j)(),i=await(0,n.k)();let a;if(t)a=t.clone();else{a=new s;const t=m(e,!1);if(t?.length){const e={};t.forEach((t=>{e[t.name]=""})),a.attributes=e}const r=new i;a.geometry=r}return a};function S(e,t){const s=t.startsWith("#"),i=t.startsWith(".");for((i||s)&&(t=t.slice(1));e;){if(s){if(e.id===t)return e}else if(i){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function b(e){if(p(e)===r.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(p(e)===r.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find((t=>{if(t.id===e.id)return t}))?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function v(e,t,s){let i="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))i="number";else if(t.has(e)){const s=t.get(e);i=s.type?s.type.toLowerCase():""}else if(s.has(e)){const t=s.get(e);i=t.returnType?t.returnType.toLowerCase():""}else i="number";return i}async function N(e,t){return"feature"!==e.type||e.url?"feature"===e.type||"csv"===e.type||"scene"===e.type||"wfs"===e.type||"geojson"===e.type||"oriented-imagery"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"catalog"===e.type||"catalog-footprint"===e.type?await e.queryFeatureCount():!t||"stream"!==e.type&&"ogc-feature"!==e.type?await Promise.reject(new Error(`Can't get feature count for layer of type ${e.type}.`)):await async function(e,t){const s=await t.whenLayerView(e);return await s.queryFeatureCount()}(e,t):await async function(e){const t=e.createQuery();t.outFields=["*"];const s=await e.queryFeatures(t);if(s.features?.length)return s.features.length;throw new Error("could not get feature count")}(e)}},89826:(e,t,s)=>{function i(e,t,s){window.localStorage.setItem(e,s?JSON.stringify(t):t)}function a(e){window.localStorage.removeItem(e)}function r(e,t){const s=window.localStorage.getItem(e);return s&&t?JSON.parse(s):s}function o(e,t,s){window.sessionStorage.setItem(e,s?JSON.stringify(t):t)}function n(e,t){const s=window.sessionStorage.getItem(e);return s&&t?JSON.parse(s):s}s.d(t,{a:()=>n,b:()=>o,g:()=>r,r:()=>a,s:()=>i})},50063:(e,t,s)=>{s.d(t,{u:()=>r});var i=s(97127),a=s(28614);const r=(0,i.m)(a.a)}}]);