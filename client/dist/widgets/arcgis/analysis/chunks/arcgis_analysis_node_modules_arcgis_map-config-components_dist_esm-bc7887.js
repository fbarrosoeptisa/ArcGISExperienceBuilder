/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-bc7887.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-bc7887"],{44097:(e,t,a)=>{a.r(t),a.d(t,{arcgis_smart_mapping_panels_gallery:()=>M,arcgis_smart_mapping_panels_raster_gallery:()=>v});var i=a(28614),s=a(48122),n=a(50732),r=a(99592),l=a(63625),o=a(14471),c=a(54351),p=a(68180),d=a(33101),m=a(97127),g=a(80216),h=a(84521),u=a(58944),y=a(5738),f=a(78567),S=a(58825),z=a(67751),b=a(372),E=a(79323),w=a(14289);a(71480),a(99818),a(76110);let F;function k(e,t){F&&clearTimeout(F),F=setTimeout((()=>{F=null,R(e,t)}),1e3)}function R(e,t){const{selectedFields:a,layer:i,mapImageSublayer:s}=e,n="ogc-feature"===i.type,o="wfs"===i.type,c="parquet"===i.type,d=i.capabilities?.query?.supportsSqlExpression,m=n||o||c||d,w=a.map((t=>(0,r.o)(e,t.field))),F=(0,r.f)(e),k=(0,r.a)(e);if(!(0,r.p)(a,F))if(0===a.length)t("heatmap"===k?(0,y.c)(e):(0,g.c)(e));else if(1===a.length){const n=w[0];if("heatmap"!==k||!m||a[0].expression||a[0].featureReductionExpression||a[0].simpleFieldType!==r.q.NUMBER)if("color-size"===k&&(0,r.r)(a[0],F[0]))t((0,h.c)(e,{fieldInfos:a}));else if("type-size"===k&&(0,r.r)(a[0],F[0]))t((0,z.c)(e,{fieldInfos:a}));else if(["color-size","type-size"].includes(k)&&(0,r.r)(a[0],F[F.length>1?1:0]))t((0,u.c)(e,{fieldInfos:a}));else if(a[0].expression||a[0].featureReductionExpression)a[0].simpleFieldType===r.q.NUMBER||a[0].simpleFieldType===r.q.DATE?t((0,h.c)(e,{fieldInfos:a})):t((0,z.c)(e,{fieldInfos:a}));else if(n.simpleFieldType===r.q.STRING||"string"===(0,r.t)(e,n)||"domain"in n.layerField&&n.layerField.domain)t((0,z.c)(e,{fieldInfos:a}));else if(["integer","double","single","small-integer","big-integer"].includes((0,r.v)(e,n.layerField))&&"objectIdField"in i&&i.objectIdField!==n.layerField.name)if((0,r.w)(e))"featureReduction"in i&&i.featureReduction?t((0,h.c)(e,{fieldInfos:a})):t((0,u.c)(e,{fieldInfos:a}));else if((0,r.x)(e))t((0,u.c)(e,{fieldInfos:a}));else{const i=(0,r.t)(e,n);["integer","small-integer","big-integer"].includes((0,r.v)(e,n.layerField))||(0,p.i)(i)&&"integer"===i?t((0,u.c)(e,{fieldInfos:a})):t((0,h.c)(e,{fieldInfos:a}))}else"date"===(0,r.v)(e,n.layerField)&&("color-age-size"===k&&(0,r.r)(a[0],F[0])?t((0,h.a)(e,{fieldInfos:a})):["color-size-age","type-size-age"].includes(k)&&(0,r.r)(a[0],F[1])?t((0,u.a)(e,{fieldInfos:a})):t(s?(0,h.a)(e,{fieldInfos:a}):(0,h.c)(e,{fieldInfos:a})));else t((0,y.c)(e,{fieldInfos:a}))}else if(2===a.length){const i=w[0];"type"!==k&&"type-size"!==k||!(0,r.r)(a[0],F[0])?a[0].expression||a[0].featureReductionExpression?a[0].simpleFieldType===r.q.NUMBER&&a[1].simpleFieldType===r.q.NUMBER?t((0,u.b)(e,{fieldInfos:a})):t((0,E.c)(e,{fieldInfos:a})):a[0].simpleFieldType===r.q.STRING||"string"===(0,r.t)(e,i)||"domain"in i.layerField&&i.layerField.domain?a[1].simpleFieldType===r.q.DATE&&(["color-size-age","type-size-age"].includes(k)||s)?t((0,E.a)(e,{fieldInfos:a})):t((0,E.c)(e,{fieldInfos:a})):a[0].simpleFieldType===r.q.DATE||a[1].simpleFieldType===r.q.DATE?a[0].simpleFieldType===r.q.DATE&&(["color-age","color-age-size"].includes(k)||s)?t((0,u.d)(e,{fieldInfos:a})):a[1].simpleFieldType===r.q.DATE&&(["color-size-age","type-size-age"].includes(k)||s)?t((0,u.e)(e,{fieldInfos:a})):t((0,u.b)(e,{fieldInfos:a})):a[0].expression||a[0].featureReductionExpression||a[1].expression||a[1].featureReductionExpression?t((0,u.b)(e,{fieldInfos:a})):"dot-density"===k?t((0,y.a)(e,{fieldInfos:a})):"predominance"===k?t((0,f.c)(e,{fieldInfos:a})):"predominance-size"===k?t((0,f.c)(e,{fieldInfos:a,includeSizeVariable:!0})):"chart"===k?t((0,l.c)(e,{fieldInfos:a})):"chart-size"===k?t((0,l.c)(e,{fieldInfos:a,includeSizeVariable:!0})):"compare"===k?t((0,S.c)(e,{fieldInfos:a})):["relationship","relationship-size"].includes(k)?t((0,b.c)(e,{fieldInfos:a})):t((0,u.b)(e,{fieldInfos:a})):t((0,E.c)(e,{fieldInfos:a}))}else 3===a.length&&(["relationship","relationship-size"].includes(k)||a[2].expression||a[2].featureReductionExpression||!m)?t((0,y.b)(e,{fieldInfos:a})):"dot-density"===k&&a.length<=8?t((0,y.a)(e,{fieldInfos:a})):"predominance-size"===k?t((0,f.c)(e,{fieldInfos:a,includeSizeVariable:!0})):"chart"===k?t((0,l.c)(e,{fieldInfos:a,includeSizeVariable:!1})):"chart-size"===k?t((0,l.c)(e,{fieldInfos:a,includeSizeVariable:!0})):s&&!m||a[2].simpleFieldType===r.q.DATE?t((0,y.b)(e,{fieldInfos:a})):t((0,f.c)(e,{fieldInfos:a}))}const M=class{constructor(e){(0,i.r)(this,e),this.smartMappingCompleteClose=(0,i.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsGalleryClose=(0,i.c)(this,"arcgisSmartMappingPanelsGalleryClose",7),this.arcgisSmartMappingPanelsGalleryError=(0,i.c)(this,"arcgisSmartMappingPanelsGalleryError",7),this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate=(0,i.c)(this,"arcgisSmartMappingPanelsGalleryClusterRequiresUpdate",7),this.manager=(0,m.u)(this),this.tileNodes=[],this.lastSortBy="default",this.smartMappingState=(0,d.u)(),this.handleGenerateClick=()=>{const e=document.createElement("arcgis-smart-mapping-panels-assist");e.addEventListener("arcgisSmartMappingPanelsAssistClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile(),setTimeout((()=>this.focusSelectedTile()),500)})),e.addEventListener("arcgisSmartMappingPanelsAssistBackClick",(()=>{(0,i.f)(this.el),setTimeout((()=>this.focusSelectedTile()),500),this.removeFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsAssistError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),e.addEventListener("arcgisSmartMappingPanelsAssistClusterRequiresUpdate",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1},this.addExpression=async()=>{const{smartMappingState:e}=this,{useFeatureReduction:t}=e;this.addExpressionButtonNode.disabled=!0,(0,r.B)();try{const a=await(0,n.u)(e);this.addExpressionButtonNode.disabled=!1,a.simpleFieldType===r.q.UNKNOWN&&(a.simpleFieldType=r.q.NUMBER);const{selectedFields:i,modules:s,strings:l}=this.smartMappingState;if(2===i.length&&a?.simpleFieldType===r.q.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:l.panels.gallery.errors.expressionMustBeNumber,type:"warning"});if(1===i.length&&i[0].simpleFieldType===r.q.STRING&&a?.simpleFieldType===r.q.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:l.panels.gallery.errors.expressionMustBeNumber,type:"warning"});const o=t?i.find((e=>"aggregateCount"===e.field)):void 0,c=o?s.esriLang.clone(i).filter((e=>"aggregateCount"!==e.field)):s.esriLang.clone(i);if(c.push(a),3===c.length)for(let e=0;e<3;e++){const t=c[e];if(t.simpleFieldType===r.q.DATE&&2!==e){c.splice(e,1),c.splice(2,0,t);break}}o&&c.push(o),c.length>1&&c[1].simpleFieldType===r.q.STRING&&c.reverse(),this.smartMappingState.selectedFields=c,k(e,this.galleryRequestWrapper)}catch(e){this.addExpressionButtonNode.disabled=!1,this.addExpressionButtonNode.setFocus()}},this.handleArcadeEdit=async e=>{(0,r.B)();try{const{smartMappingState:t}=this,{selectedFields:a,strings:s}=t,o=await(0,n.u)(t,a[e]);if(o.simpleFieldType===r.q.UNKNOWN&&(o.simpleFieldType=r.q.NUMBER),0!==e&&o?.simpleFieldType===r.q.STRING&&a[0].simpleFieldType===r.q.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:s.panels.gallery.errors.expressionMustBeNumber,type:"warning"});const c=a[e];"string"===o.simpleFieldType?(a.splice(e,1),a.unshift(o),e=0,(0,i.f)(this.el)):a[e]=o,this.smartMappingState.selectedFields.length!==a.length?(this.smartMappingState.selectedFields=a,k(t,this.galleryRequestWrapper)):(this.smartMappingState.selectedFields=a,function(e,t,a,i){const{selectedFields:s}=e,n=(0,r.j)(e),{idx:o,oldFieldInfo:c}=t,p=(0,r.a)(e);if(!(0,r.r)(s[o],c))if(s[o].expression===c.expression){const t=s[o];if("size"===p||"color-size"===p&&1===o||"type-size"===p&&1===o||"relationship-size"===p&&2===o){const e=n,a=(0,r.b)(n,"size");a?a.valueExpressionTitle=t.expressionTitle:e.valueExpressionTitle&&(e.valueExpressionTitle=t.expressionTitle)}else if("color"===p||"color-size"===p&&0===o){const e=n,a=(0,r.b)(n,"color");a?a.valueExpressionTitle=t.expressionTitle:e.valueExpressionTitle&&(e.valueExpressionTitle=t.expressionTitle)}else("type"===p||"type-size"===p&&0===o)&&(n.valueExpressionTitle=t.expressionTitle);(0,r.u)(e),i()}else s[o].simpleFieldType===c.simpleFieldType?"size"===p?a((0,u.f)(e,{fieldInfos:s})):"color"===p?a((0,h.b)(e,{fieldInfos:s})):"type"===p?a((0,z.a)(e,{fieldInfos:s})):"color-size"===p?1===s.length?a((0,l.b)(e,{fieldInfos:s})):a((0,u.g)(e,{fieldInfos:s})):"type-size"===p?a((0,E.b)(e,{fieldInfos:s})):"relationship-size"===p?a((0,y.d)(e,{fieldInfos:s})):R(e,a):R(e,a)}(t,{idx:e,oldFieldInfo:c},this.galleryRequestWrapper,(()=>(0,i.f)(this.el))))}catch(e){this.addExpressionButtonNode.setFocus()}},this.handleListOrderChange=e=>{const{smartMappingState:t}=this,{selectedFields:a,modules:i}=t,s=[];e.target.querySelectorAll("calcite-list-item").forEach((e=>{s.push(i.esriLang.clone(a[Number.parseInt(e.value)]))})),this.smartMappingState.selectedFields=s,k(t,this.galleryRequestWrapper)},this.handleListChange=e=>{const{selectedFields:t}=this.smartMappingState;!!t[e].expression?this.handleArcadeEdit(e):this.openFieldPickList(!0,e)},this.handleRemoveAttribute=e=>{const{smartMappingState:t}=this,{selectedFields:a}=t;this.smartMappingState.selectedFields=a?.filter(((t,a)=>a!==e)),k(t,this.galleryRequestWrapper)},this.handleSelectClick=e=>{const{smartMappingState:t}=this;!function(e,t,a){const{selectedFields:i}=e;switch(t){case"simple":e.selectedFields=[],a((0,g.c)(e));break;case"type":a((0,z.c)(e,{fieldInfos:i}));break;case"color":a((0,h.c)(e,{fieldInfos:i}));break;case"size":a((0,u.c)(e,{fieldInfos:i}));break;case"color-age":a((0,h.a)(e,{fieldInfos:i}));break;case"size-age":a((0,u.a)(e,{fieldInfos:i}));break;case"dot-density":a((0,y.a)(e,{fieldInfos:i}));break;case"heatmap":a((0,y.c)(e,{fieldInfos:i}));break;case"compare":a((0,S.c)(e,{fieldInfos:i}));break;case"relationship":a((0,b.c)(e,{fieldInfos:i}));break;case"relationship-size":a((0,y.b)(e,{fieldInfos:i}));break;case"predominance":a((0,f.c)(e,{fieldInfos:i}));break;case"predominance-size":a((0,f.c)(e,{fieldInfos:i,includeSizeVariable:!0}));break;case"chart":a((0,l.c)(e,{fieldInfos:i}));break;case"chart-size":a((0,l.c)(e,{fieldInfos:i,includeSizeVariable:!0}));break;case"type-size":a((0,E.c)(e,{fieldInfos:i}));break;case"type-size-age":a((0,E.a)(e,{fieldInfos:i}));break;case"color-size":1===i.length?a((0,l.a)(e,{fieldInfos:i})):a((0,u.b)(e,{fieldInfos:i}));break;case"color-age-size":a((0,u.d)(e,{fieldInfos:i}));break;case"color-size-age":a((0,u.e)(e,{fieldInfos:i}))}}(t,e,this.galleryRequestWrapper)},this.handleOptionsClick=e=>{const{selectedFields:t}=this.smartMappingState;switch(e){case"simple":{const e=document.createElement("arcgis-smart-mapping-panels-simple");e.addEventListener("arcgisSmartMappingPanelsSimpleClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsSimpleBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsSimpleError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,e.showBackButton=!0,this.selected=!1;break}case"color":case"color-age":{const e=document.createElement("arcgis-smart-mapping-panels-color");e.addEventListener("arcgisSmartMappingPanelsColorClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsColorBackClick",(()=>{(0,i.f)(this.el),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsColorError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"size":case"size-age":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>{(0,i.f)(this.el),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"type":{const e=document.createElement("arcgis-smart-mapping-panels-type");e.addEventListener("arcgisSmartMappingPanelsTypeClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsTypeBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsTypeClusterRequiresUpdate",(()=>{this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit()})),e.addEventListener("arcgisSmartMappingPanelsTypeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"compare":{const e=document.createElement("arcgis-smart-mapping-panels-compare");e.addEventListener("arcgisSmartMappingPanelsCompareClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsCompareBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsCompareError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"heatmap":{const e=document.createElement("arcgis-smart-mapping-panels-heatmap");e.addEventListener("arcgisSmartMappingPanelsHeatmapClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsHeatmapBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsHeatmapError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"predominance":{const e=document.createElement("arcgis-smart-mapping-panels-predominance");e.addEventListener("arcgisSmartMappingPanelsPredominanceClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsPredominanceBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsPredominanceError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"chart":{const e=document.createElement("arcgis-smart-mapping-panels-chart");e.addEventListener("arcgisSmartMappingPanelsChartClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsChartBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsChartError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"relationship":{const e=document.createElement("arcgis-smart-mapping-panels-relationship");e.addEventListener("arcgisSmartMappingPanelsRelationshipClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRelationshipBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRelationshipError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"dot-density":{const e=document.createElement("arcgis-smart-mapping-panels-dot-density");e.addEventListener("arcgisSmartMappingPanelsDotDensityClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsDotDensityBackClick",(()=>this.cleanUpFlowItem(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"color-size":case"color-age-size":case"color-size-age":if(t.length>1){const e=document.createElement("arcgis-smart-mapping-panels-color-size");e.addEventListener("arcgisSmartMappingPanelsColorSizeClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsColorSizeBackClick",(()=>{(0,i.f)(this.el),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1}else{const e=document.createElement("arcgis-smart-mapping-panels-color-size-univariate");e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateBackClick",(()=>{(0,i.f)(this.el),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1}break;case"type-size":case"type-size-age":{const e=document.createElement("arcgis-smart-mapping-panels-type-size");e.addEventListener("arcgisSmartMappingPanelsTypeSizeClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsTypeSizeBackClick",(()=>{(0,i.f)(this.el),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsTypeSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"predominance-size":{const e=document.createElement("arcgis-smart-mapping-panels-predominance-size");e.showBackButton=!0,e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"chart-size":{const e=document.createElement("arcgis-smart-mapping-panels-chart-size");e.addEventListener("arcgisSmartMappingPanelsChartSizeClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsChartSizeBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsChartSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"relationship-size":{const e=document.createElement("arcgis-smart-mapping-panels-relationship-size");e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.handleDone=()=>{this.arcgisSmartMappingPanelsGalleryClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:a}=this;(0,r.h)(a,e,t),this.arcgisSmartMappingPanelsGalleryClose.emit("cancel")},this.galleryRequestWrapper=e=>{const{smartMappingState:t}=this,{strings:a}=t;(0,c.r)(e,this.flowItemNode).then((e=>{const{layer:a}=t;(0,r.u)(t,e.renderer),(0,i.f)(this.el),"featureReduction"in a&&"cluster"===a.featureReduction?.type&&(this.checkCluster(),this.checkClusterRenderer()),this.focusSelectedTile()}),(()=>{this.arcgisSmartMappingPanelsGalleryError.emit({message:a.panels.gallery.errors.changeRendererErrorMsg,type:"warning"})}))},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,a=(0,r.j)(this.smartMappingState);this.originalRendererJSON=a.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.flowNode=(0,s.f)(this.el,"calcite-flow");const i=t.urlUtils.urlToObject(document.URL);this.urlObjectQuery=i.query||{}}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.setUpWatchBinScale(!0)}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,useFeatureReduction:t,hideLayerTitle:a,strings:s}=this.smartMappingState,n=t?s.panels.gallery.binStyles:s.panels.gallery.styles;let l=!1;if("featureReduction"in e&&"cluster"===e.featureReduction?.type){const t=e.featureReduction;"pie-chart"!==t.renderer?.type||t.renderer.authoringInfo?.isAutoGenerated||(l=!0)}return(0,i.h)(i.H,{key:"ee1ede7c80b1ac426f2b3e3b3f92b1523b48b9d4",class:"calcite-match-height"},(0,i.h)("calcite-flow-item",{key:"04842394690adf21f95475d10f03fa550933f62a",heading:n,description:a?void 0:e.title,class:"flow-item",closable:(0,r.C)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:this.handleDone,ref:e=>this.flowItemNode=e},l?this.renderClusteringWarning():this.renderGalleryContent()))}renderGalleryContent(){return(0,i.h)(i.F,null,this.renderDoneButton(),this.renderCancelButton(),this.renderGenerate(),this.renderStepOne(),this.renderStepTwo())}renderClusteringWarning(){const{strings:e}=this.smartMappingState;return(0,i.h)(i.F,null,(0,i.h)("div",null,(0,i.h)("calcite-tip",{closeDisabled:!0},(0,i.h)("div",null,e.panels.gallery.chartClusterMsg))),(0,i.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleCancel,appearance:"outline-fill",width:"full"},e.done))}renderDoneButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,i.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):null}renderCancelButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,i.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):null}renderGenerate(){const e=this.urlObjectQuery,{layer:t,portal:a,strings:s}=this.smartMappingState,n=Object.keys(o.a).includes(e.assist);return e.assist&&(0,r.n)(t)&&(n&&"devext.arcgis.com"===a.portalHostname||n&&"qaext.arcgis.com"===a.portalHostname||n&&"www.arcgis.com"===a.portalHostname&&a.user&&"jsapi"===a.urlKey)?(0,i.h)(i.F,null,(0,i.h)("div",{class:"gallery-block"},(0,i.h)("div",{class:"generate-block"},(0,i.h)("calcite-icon",{icon:"effects"}),(0,i.h)("calcite-label",{layout:"inline-space-between"},(0,i.h)("div",null,(0,i.h)("div",{class:"generate-title"},s.panels.gallery.styleWithAI),(0,i.h)("div",{class:"generate-description"},s.panels.gallery.styleWithAIMsg)),(0,i.h)("calcite-button",{class:"generate-button",onClick:this.handleGenerateClick},s.panels.gallery.go)))),(0,i.h)("div",{class:"separator"},(0,i.h)("div",{class:"separator-line"}),(0,i.h)("span",{class:"separator-text"},s.panels.gallery.or),(0,i.h)("div",{class:"separator-line"}))):(0,i.h)(i.F,null)}renderStepOne(){const{smartMappingState:e}=this,{layer:t,selectedFields:a,strings:s,useFeatureReduction:n}=e,l=a.length,o=(0,r.y)(e).string>0,c=3===l&&(a[2].expression||a[2].featureReductionExpression),p=n&&2===l&&a[0].simpleFieldType===r.q.DATE,d=3===l&&a[2].simpleFieldType===r.q.DATE,m=a.map(((e,t)=>this.renderAttribute(t))),g=l>1&&!o&&!c&&!d&&!p;return(0,i.h)("div",{class:"attributes gallery-block"},(0,i.h)("div",null,(0,i.h)("div",{class:"center"},(0,i.h)("calcite-icon",{class:"number-icon",icon:"number-circle-1"})),(0,i.h)("div",{class:"attributes-header-text center"},s.panels.gallery.chooseAttributes)),!l&&(0,i.h)("div",{class:"attributes-msg center"},s.panels.gallery.chooseAttributesMsg),(0,i.h)("calcite-list",{label:s.panels.gallery.attributes,class:m.length>0?"attribute-list":"",key:`gallery-attributes-selects-${a}`,dragEnabled:g,onCalciteListOrderChange:this.handleListOrderChange},m),t&&this.renderAddButtons(),t&&this.renderTip())}renderAttribute(e){const{smartMappingState:t}=this,{selectedFields:a,strings:s,useFeatureReduction:n}=t,l=a[e].field||a[e].expressionTitle||a[e].featureReductionExpressionTitle,o=!!a[e].expression,c=(0,r.o)(t,a[e].field),p=c?c.label:a[e].expressionTitle||a[e].featureReductionExpressionTitle,d=a[e].simpleFieldType,m=!o&&(d===r.q.NUMBER?"number":n&&["date","timestamp-offset"].includes((0,r.v)(t,c.layerField))?"date-time":d===r.q.STRING?"date-only"===(0,r.v)(t,c.layerField)?"calendar":"string":d===r.q.DATE?"date-time":null);return(0,i.h)("calcite-list-item",{key:`gallery-attribute-${e}-${l}`,label:p,value:e,onClick:t=>t.target&&this.handleListChange(e),onKeyDown:t=>{" "===t.key&&(t.preventDefault(),this.handleListChange(e))}},m&&(0,i.h)("div",{slot:"actions-end"},(0,i.h)("calcite-icon",{scale:"s",icon:m,class:"field-type"})),(0,i.h)("calcite-action",{key:`gallery-attribute-${e}-${l}-remove`,slot:"actions-end",text:o?s.panels.gallery.removeExpression:s.panels.gallery.removeField,label:o?s.panels.gallery.removeExpression:s.panels.gallery.removeField,onClick:t=>{t.stopPropagation(),this.handleRemoveAttribute(e)},onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.stopPropagation(),this.handleRemoveAttribute(e))}},(0,i.h)("calcite-icon",{scale:"s",icon:"x"})))}renderTip(){const{selectedFields:e,portal:t,strings:a}=this.smartMappingState;if(e.length>1)return;if(!e.length&&(0,r.D)(r.L.ARCGIS_COMPONENT_NOTIFICATIONS,r.K.SMART_MAPPING_TIP1_DISMISSED)||1===e.length&&(0,r.D)(r.L.ARCGIS_COMPONENT_NOTIFICATIONS,r.K.SMART_MAPPING_TIP2_DISMISSED))return null;const s=a.panels.gallery.tip1.indexOf("${smartMappingLink}"),n=t.helpMap?.m||t.helpMap,l=a.panels.gallery.tip1.replace("${smartMappingLink}",a.panels.gallery.tip1Link);return(0,i.h)("div",{key:"gallery-tip",class:"tip"},(0,i.h)("calcite-input-message",{key:"gallery-tip-message",icon:"lightbulb",class:"tip-message"},0===e.length&&t.helpBase&&n?(0,i.h)("div",{key:"gallery-tip-text"},(0,i.h)("span",{class:"tip-text"},a.panels.gallery.tip1.substring(0,s)),(0,i.h)("calcite-link",{target:"_blank",href:`${t.helpBase}${n[120003249]}`},a.panels.gallery.tip1Link),(0,i.h)("span",{class:"tip-text"},a.panels.gallery.tip1.substring(s+19))):0===e.length?(0,i.h)("span",{key:"gallery-tip-text",class:"tip-text"},l," "):(0,i.h)("span",{key:"gallery-tip-text",class:"tip-text"},a.panels.gallery.tip2)),(0,i.h)("calcite-action",{scale:"s",label:a.close,text:a.close,onClick:()=>{const{selectedFields:e}=this.smartMappingState;e.length?(0,r.E)(r.L.ARCGIS_COMPONENT_NOTIFICATIONS,{key:r.K.SMART_MAPPING_TIP2_DISMISSED,value:"true"}):(0,r.E)(r.L.ARCGIS_COMPONENT_NOTIFICATIONS,{key:r.K.SMART_MAPPING_TIP1_DISMISSED,value:"true"}),(0,i.f)(this.el)}},(0,i.h)("calcite-icon",{scale:"s",icon:"x"})))}renderAddButtons(){const{smartMappingState:e}=this,{layer:t,mapImageSublayer:a,selectedFields:s,strings:n,supportsArcade:l}=e,o=s.length,c=(0,r.F)(e),p=(0,r.y)(e),d=p.string>0,m=p.date>0,g=p.expression>0,h=t.capabilities?.query?.supportsSqlExpression,u="knowledge-graph-sublayer"===t.type,y=(0,r.j)(e),f=(0,r.G)(y,"reference-size");let S=!(a&&!l&&1===o||!(o<10)||2===o&&(d||g)||a&&2===o&&m||3===o&&(m||s[2].expression||s[2].featureReductionExpression||!h));S=S&&(1===p.string&&p.number+p.date===0&&c.number+c.date>0||0===p.string&&p.date<2&&p.number+p.date<3&&p.string+p.number+p.date<c.string+c.number+c.date||p.number>=2&&p.number<c.number);const z=!f&&!u&&(!a||l)&&(o<2||2===o&&!g&&s[0].simpleFieldType===r.q.NUMBER&&s[1].simpleFieldType===r.q.NUMBER);return(0,i.h)("div",{class:"add-button-div"},(0,i.h)("div",{class:"add-buttons"},(0,i.h)("calcite-button",{disabled:!S,onClick:()=>this.openFieldPickList(),appearance:"outline-fill",kind:"neutral",width:"full",label:n.panels.gallery.addField,iconStart:"plus",class:"attributes-add-new",ref:e=>this.addFieldButtonNode=e},n.panels.gallery.field),(0,i.h)("span",null,"\xa0\xa0"),(0,i.h)("calcite-button",{disabled:!z,onClick:this.addExpression,appearance:"outline-fill",kind:"neutral",width:"full",label:n.panels.gallery.addExpression,iconStart:"plus",class:"attributes-add-new",ref:e=>this.addExpressionButtonNode=e},n.expression)))}renderStepTwo(){const{smartMappingState:e}=this,{selectedFields:t,strings:a}=e,s=function(e){const{layer:t,useFeatureReduction:a,mapImageSublayer:i,selectedFields:s,supportsArcade:n}=e,l="ogc-feature"===t.type,o="wfs"===t.type,c="stream"===t.type,p="parquet"===t.type,d="featureReduction"in t&&t.featureReduction,m=s.length,g=(0,r.y)(e),h=g.string>0,u=g.date>0,y=g.expression>0,f=t.capabilities?.query?.supportsSqlExpression,S=l||o||c||p||f,z=[];return z.push("simple"),1!==m||h||i&&u||z.push("color"),1!==m||h||i&&u||z.push("size"),i&&!n||1!==m||!u||y||!S||z.push("color-age"),i&&!n||1!==m||!u||y||!S||z.push("size-age"),i&&!n||1!==m&&2!==m||h||i&&u||z.push("color-size"),i&&!n||2!==m||h||!u||s[0].simpleFieldType!==r.q.DATE||s[0].expression||s[0].featureReductionExpression||!S||i&&g.date>1||z.push("color-age-size"),i&&!n||2!==m||h||!u||s[1].simpleFieldType!==r.q.DATE||s[1].expression||s[1].featureReductionExpression||!S||i&&g.date>1||z.push("color-size-age"),(!i||n)&&m>0&&m<=8&&!y&&(0,r.z)(e)&&!h&&!u&&S&&z.push("dot-density"),(!i||n)&&m>1&&m<=10&&!y&&!h&&!u&&S&&z.push("predominance"),i&&!n||!(m>1)||y||h||u||!S||z.push("predominance-size"),!i&&(!d||"binning"===d.type)&&m>1&&m<=10&&!y&&["polygon","point","multipoint"].includes((0,r.A)(e))&&!h&&!u&&S&&z.push("chart"),i||d&&"binning"!==d.type||!(m>1)||y||!["polygon","point","multipoint"].includes((0,r.A)(e))||h||u||!S||z.push("chart-size"),i&&!n||2!==m||y||h||u||z.push("relationship"),i&&!n||3!==m||y&&(1!==g.expression||!s[2].expression&&!s[2].featureReductionExpression)||i&&u||z.push("relationship-size"),i&&!n||2!==m||y||h||u||z.push("compare"),1!==m||i&&u||z.push("type"),i&&!n||2!==m||!(g.date<2)||i&&u||z.push("type-size"),(!i||n)&&2===m&&u&&g.date<2&&s[1].simpleFieldType===r.q.DATE&&s[1].field&&S&&z.push("type-size-age"),i&&!n||!["point","multipoint"].includes((0,r.A)(e))||d&&("binning"!==d?.type||a)||!(S&&m<=1||!S&&0===m)||h||u||0!==g.expression||z.push("heatmap"),z}(e),n=function(e){const t=(0,r.a)(e),a=(0,r.f)(e),i=a.length>0?a[0].simpleFieldType:null;let s=[];switch(t){case"simple":s=["simple","color","size","color-age","size-age","color-size","type","heatmap","dot-density","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"];break;case"type":s=["type","color","size","color-age","size-age","color-size","dot-density","heatmap","simple","type-size","type-size-age","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","compare","relationship","relationship-size"];break;case"color":s=["color","size","color-age","size-age","color-size","dot-density"],s="string"===i||"date"===i?s.concat(["type","heatmap","simple"]):s.concat(["heatmap","simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"color-age":s=["color-age","color","size","size-age","color-size","dot-density"],s="string"===i||"date"===i?s.concat(["type","heatmap","simple"]):s.concat(["heatmap","simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"size":s=["size","size-age","color","color-age","color-size","dot-density"],s="string"===i||"date"===i?s.concat(["type","heatmap","simple"]):s.concat(["heatmap","simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"size-age":s=["size-age","size","color-age","color","color-size","dot-density"],s="string"===i||"date"===i?s.concat(["type","heatmap","simple"]):s.concat(["heatmap","simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"heatmap":s=["heatmap","color","size","color-age","size-age","color-size","dot-density"],s="string"===i?s.concat(["type","simple"]):s.concat(["simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"predominance":s=["predominance","predominance-size","chart","chart-size","color-size","color-age-size","color-size-age","dot-density","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===i?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"chart":s=["chart","chart-size","predominance","predominance-size","color-size","color-age-size","color-size-age","dot-density","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===i?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"dot-density":s=["dot-density","color-size","color-age-size","color-size-age","predominance","predominance-size","chart","chart-size","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===i?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"compare":s=["compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===i&&(s=s.concat(["type"])),s=s.concat(["simple"]),i&&"string"===i||(s=s.concat(["type"]));break;case"relationship":s=["relationship","relationship-size","compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===i&&(s=s.concat(["type"])),s=s.concat(["simple"]),i&&"string"===i||(s=s.concat(["type"]));break;case"color-size":s=["color-size","color-age-size","color-size-age","color","size","color-age","size-age","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","type","heatmap","simple"];break;case"color-age-size":s=["color-age-size","color-size-age","color-size","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","color","color-age","size","size-age","simple","type","heatmap"];break;case"color-size-age":s=["color-size-age","color-age-size","color-size","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","color","color-age","size","size-age","simple","type","heatmap"];break;case"type-size":s=["type-size","type-size-age","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type","size","simple","color","color-age","size-age","heatmap","compare","relationship","relationship-size"];break;case"type-size-age":s=["type-size-age","type-size","color-age-size","color-size-age","color-size","dot-density","predominance","predominance-size","chart","chart-size","type","size","size-age","simple","color","color-age","heatmap","compare","relationship","relationship-size"];break;case"predominance-size":s=["predominance-size","predominance","chart-size","chart","dot-density","color-size","color-age-size","color-size-age","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===i?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"chart-size":s=["chart-size","chart","predominance-size","predominance","dot-density","color-size","color-age-size","color-size-age","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===i?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"relationship-size":s=["relationship-size","relationship","compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===i&&(s=s.concat(["type"])),s=s.concat(["simple"]),"string"!==i&&(s=s.concat(["type"]));break;default:s=["color","size","color-age","size-age","color-size"],"string"===i&&(s=s.concat(["type"])),s=s.concat(["heatmap","simple"]),"string"!==i&&(s=s.concat(["type"])),s=s.concat(["dot-density","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"])}return s}(e),l=t?.length?1===t.length&&t[0].field&&t[0].simpleFieldType===r.q.NUMBER?a.panels.gallery.styleMsg.oneNumber:2===t.length&&t[0].field&&t[1].field&&t[0].simpleFieldType===r.q.NUMBER&&t[1].simpleFieldType===r.q.NUMBER?a.panels.gallery.styleMsg.multipleNumber:a.panels.gallery.styleMsg.any:a.panels.gallery.styleMsg.empty;s.sort(((e,t)=>n.indexOf(e)-n.indexOf(t)));const o=s.map(((e,t)=>this.renderStyleTile(e,t)));return(0,i.h)("div",{class:"gallery-block"},(0,i.h)("div",{class:"style-tiles"},(0,i.h)("div",{class:"attributes-header"},(0,i.h)("div",{class:"center"},(0,i.h)("calcite-icon",{class:"number-icon",icon:"number-circle-2"})),(0,i.h)("div",{class:"styles-msg-title center"},a.panels.gallery.pickStyle),(0,i.h)("div",{class:"styles-msg center"},l)),o))}renderStyleTile(e,t){const{smartMappingState:a}=this,s=(0,r.j)(a),{selectedFields:n}=a,l=(0,r.a)(a),o=(0,r.H)(a),c=`${n?.[0]?.simpleFieldType===r.q.DATE}\n        ${n?.[1]?.simpleFieldType===r.q.DATE}`,p=(0,r.G)(s,"reference-size"),d=(0,r.M)(p);return(0,i.h)("arcgis-smart-mapping-tile",{key:`tile-${e}-${o}-${d}-${c}`,tileType:"gallery",type:e,selected:e===l,ref:e=>{e&&(this.tileNodes[t]=e)},onArcgisSmartMappingTileSelect:()=>this.handleSelectClick(e),onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick(e),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsGalleryError.emit(e.detail),onArcgisSmartMappingTileThemeChange:()=>(0,i.f)(this.el)})}addField(e){const{smartMappingState:t}=this,{layer:a,selectedFields:i,modules:s,useFeatureReduction:n}=t;(0,r.I)(t,e);const l=n?i.find((e=>"aggregateCount"===e.field)):void 0,o=l?s.esriLang.clone(i).filter((e=>"aggregateCount"!==e.field)):s.esriLang.clone(i);if(e.forEach((e=>{const i=(0,r.o)(t,e);let s;if("featureReduction"in a&&n){s=a.featureReduction.fields.find((e=>e.name===i.layerField.name&&e.onStatisticExpression))}i.simpleFieldType===r.q.STRING||n&&i.simpleFieldType===r.q.DATE?s?o.unshift({field:e,simpleFieldType:i.simpleFieldType,featureReductionExpression:s.onStatisticExpression.expression,featureReductionExpressionTitle:s.onStatisticExpression.title??void 0}):o.unshift({field:e,simpleFieldType:n&&i.simpleFieldType===r.q.DATE?r.q.DATE:r.q.STRING}):s?o.push({field:e,simpleFieldType:i.simpleFieldType,featureReductionExpression:s.onStatisticExpression.expression,featureReductionExpressionTitle:s.onStatisticExpression.title??void 0}):o.push({field:e,simpleFieldType:i.simpleFieldType})})),3===o.length)for(let e=0;e<3;e++){const t=o[e];if(t.simpleFieldType===r.q.DATE&&2!==e){o.splice(e,1),o.splice(2,0,t);break}}l&&o.push(l),(0,r.p)(i,o)||(this.smartMappingState.selectedFields=o,k(t,this.galleryRequestWrapper))}editAttribute(e,t){const{smartMappingState:a}=this,{layer:i,selectedFields:s,modules:n,useFeatureReduction:l}=a;(0,r.I)(a,e);const o=n.esriLang.clone(s);e.forEach((e=>{const n=(0,r.o)(a,e);let o;if("featureReduction"in i&&l){o=i.featureReduction.fields.find((e=>e.name===n.layerField.name&&e.onStatisticExpression))}n.simpleFieldType===r.q.STRING||l&&n.simpleFieldType===r.q.DATE?(s.splice(t,1),o?s.unshift({field:e,simpleFieldType:n.simpleFieldType,featureReductionExpression:o.onStatisticExpression.expression,featureReductionExpressionTitle:o.onStatisticExpression.title??void 0}):s.unshift({field:e,simpleFieldType:l&&n.simpleFieldType===r.q.DATE?r.q.DATE:r.q.STRING})):s[t]=o?{field:e,simpleFieldType:n.simpleFieldType,featureReductionExpression:o.onStatisticExpression.expression,featureReductionExpressionTitle:o.onStatisticExpression.title??void 0}:{field:e,simpleFieldType:n.simpleFieldType}})),(0,r.p)(s,o)||(this.smartMappingState.selectedFields=s,k(a,this.galleryRequestWrapper))}appendFlowItem(e){const{flowNode:t}=this,a=(0,s.f)(this.el,"arcgis-smart-mapping");(0,r.C)(this.el)?t.appendChild(e):a.appendChild(e),this.setUpWatchBinScale(!1)}removeFlowItem(e){const{flowNode:t}=this,a=(0,s.f)(this.el,"arcgis-smart-mapping");(0,r.C)(this.el)?t.removeChild(e):a.removeChild(e),this.setUpWatchBinScale(!0),this.selected=!0}checkCluster(){const{layer:e}=this.smartMappingState;"featureReduction"in e&&e.featureReduction&&this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit()}checkClusterRenderer(){const{layer:e}=this.smartMappingState;if("featureReduction"in e&&"cluster"===e.featureReduction?.type){const t=e.featureReduction;t.renderer=void 0,e.featureReduction=t.clone()}}openFieldPickList(e=!1,t){(0,r.B)();const{fields:a,selectedFields:i}=this.smartMappingState,s=i.map((e=>e.field)),n=a.filter((a=>{let i=!s.includes(a.layerField.name);return e&&(i=i||a.layerField.name===s[t]),i})),l=document.createElement("arcgis-smart-mapping-field-pick-list");l.smartMappingState=this.smartMappingState,l.fields=n,l.popoverProps={refElement:this.flowItemNode,placement:"leading",popoverWidth:1.05*this.flowItemNode.getBoundingClientRect().width,overlayPositioning:"absolute",flipDisabled:!1,triggerDisabled:!0},l.singleEditMode=e,l.fieldToReplace=e?i[t]:void 0,l.lastSortBy=this.lastSortBy,document.body.appendChild(l),(0,r.J)(this.flowItemNode,!0),l.addEventListener("arcgisSmartMappingFieldPickListClose",(a=>{document.body.removeChild(l),(0,r.J)(this.flowItemNode,!1),a.detail?.selectedFields&&(e?this.editAttribute(a.detail.selectedFields,t):this.addField(a.detail.selectedFields)),this.addFieldButtonNode.setFocus()})),l.addEventListener("arcgisSmartMappingFieldPickListSortByChange",(e=>{this.lastSortBy=e.detail}))}cleanUpFlowItem(e){this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0}focusSelectedTile(){this.setUpWatchBinScale(!0),setTimeout((()=>requestAnimationFrame((async()=>await(this.tileNodes[0]?.setFocus())))),300)}setUpWatchBinScale(e){e?this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel"))):this.scaleHandle?.remove()}get el(){return(0,i.g)(this)}};M.style=":host {\n  width: 100%;\n  display: none;\n}\n:host([selected]) {\n  display: flex;\n}\n\n.flow-item {\n  height: 100%;\n}\n\n.generate-block {\n  --calcite-panel-background-color: var(--calcite-color-foreground-1);\n  padding: 0 var(--calcite-spacing-sm);\n}\n\n.generate-title {\n  font-weight: var(--calcite-font-weight-bold);\n  padding-top: var(--calcite-spacing-xs);\n  font-size: var(--calcite-font-size-0);\n}\n\n.generate-description {\n  padding-top: var(--calcite-spacing-xs);\n  font-size: var(--calcite-font-size--1);\n}\n\n.generate-button {\n  padding-right: var(--calcite-spacing-xs);\n}\n\n:dir(rtl) {\n  .generate-button {\n    padding-left: var(--calcite-spacing-xs);\n    padding-right: 0;\n  }\n}\n\n.separator {\n  display: flex;\n  align-items: center;\n  margin-bottom: var(--calcite-spacing-sm);\n}\n\n.separator-line {\n  flex-grow: 1;\n  height: var(--calcite-spacing-px);\n  background-color: var(--calcite-color-border-1);\n  margin: 0 var(--calcite-spacing-md);\n}\n\n.separator-text {\n  padding: 0 var(--calcite-spacing-xl);\n  color: var(--calcite-color-text-1);\n  font-weight: var(--calcite-font-weight-bold);\n}\n\n.add-button-div {\n  margin: 0 3px;\n}\n\n.add-buttons {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  background-color: #ffffff;\n}\n.attributes {\n  padding: 6px 6px 0 6px;\n  background-color: #ffffff;\n}\n.attributes-header-text {\n  font-weight: bold;\n  font-size: 16px;\n  padding: 10px 0;\n}\n.attributes-msg {\n  font-size: var(--calcite-font-size--2);\n}\n.attributes-add-new {\n  margin-top: 10px;\n}\n.tip {\n  margin-top: 15px;\n  display: flex;\n  justify-content: space-between;\n}\n.tip-message {\n  justify-content: center;\n}\n.tip-text {\n  color: #3d5f1d;\n}\n.tip-close {\n  margin-top: 4px;\n}\n.field-type {\n  display: flex;\n  align-items: center;\n  height: 100%;\n  color: var(--calcite-color-text-1);\n}\n.attribute-list {\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.gallery-block {\n  padding: 12px 3px;\n  margin-bottom: 12px;\n  background-color: #ffffff;\n  box-shadow:\n    0 1px 10px 2px rgba(0, 0, 0, 0.05),\n    0 0 0 1px #e0e0e0;\n}\n.style-tiles {\n  /* calcite-checkbox bug in RTL */\n  overflow-x: hidden;\n}\n.center {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n}\n.number-icon {\n  color: var(--calcite-color-brand);\n}\n.styles-msg-title {\n  padding: 6px;\n  font-weight: bold;\n  font-size: 16px;\n  display: flex;\n  justify-content: center;\n}\n.styles-msg {\n  font-size: var(--calcite-font-size--2);\n}\n";const v=class{constructor(e){(0,i.r)(this,e),this.arcgisSmartMappingPanelsRasterGalleryClose=(0,i.c)(this,"arcgisSmartMappingPanelsRasterGalleryClose",7),this.arcgisSmartMappingPanelsRasterGalleryError=(0,i.c)(this,"arcgisSmartMappingPanelsRasterGalleryError",7),this.manager=(0,m.u)(this),this.tileNodes=[],this.smartMappingState=(0,d.u)(),this.handleSelectClick=e=>{const{smartMappingState:t}=this,{layer:a}=t;a.bandIds=[],function(e,t,a){switch(t){case"raster-flow":a((0,w.b)(e));break;case"raster-vector-field":a((0,w.a)(e));break;case"raster-stretch":a((0,r.P)(e));break;case"raster-rgb":a((0,r.O)(e));break;case"raster-shaded-relief":a(async function(e){const{layer:t,modules:a}=e,i=t,s="imagery"===i.type?i.rasterFunction??void 0:void 0;return await a.RasterShadedReliefCreator.createRenderer({layer:i,rasterFunction:s})}(e));break;case"raster-class-breaks":a((0,w.c)(e));break;case"raster-colormap":a(async function(e){const{layer:t,modules:a}=e,i=t,s="imagery"===i.type?i.rasterFunction??void 0:void 0;return await a.RasterColormapCreator.createRenderer({layer:i,rasterFunction:s}).then((e=>(e.renderer.colormapInfos.forEach(((t,a)=>{t.label||(e.renderer.colormapInfos[a].label=" ")})),e)))}(e));break;case"raster-unique-value":a((0,r.N)(e))}}(t,e,this.galleryRequestWrapper)},this.handleOptionsClick=e=>{switch(e){case"raster-class-breaks":{const e=document.createElement("arcgis-smart-mapping-panels-raster-class-breaks");e.addEventListener("arcgisSmartMappingPanelsRasterClassBreaksClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterClassBreaksBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterClassBreaksError",(({detail:e})=>this.arcgisSmartMappingPanelsRasterGalleryError.emit(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"raster-colormap":{const e=document.createElement("arcgis-smart-mapping-panels-raster-colormap");e.addEventListener("arcgisSmartMappingPanelsRasterColormapClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterColormapBackClick",(()=>this.cleanUpFlowItem(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"raster-flow":{const e=document.createElement("arcgis-smart-mapping-panels-raster-flow");e.addEventListener("arcgisSmartMappingPanelsRasterFlowClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterFlowBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterFlowError",(({detail:e})=>this.arcgisSmartMappingPanelsRasterGalleryError.emit(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"raster-rgb":{const e=document.createElement("arcgis-smart-mapping-panels-raster-rgb");e.addEventListener("arcgisSmartMappingPanelsRasterRgbClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterRgbBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterRgbError",(({detail:e})=>this.arcgisSmartMappingPanelsRasterGalleryError.emit(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"raster-shaded-relief":{const e=document.createElement("arcgis-smart-mapping-panels-raster-shaded-relief");e.addEventListener("arcgisSmartMappingPanelsRasterShadedReliefClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterShadedReliefBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterShadedReliefError",(({detail:e})=>this.arcgisSmartMappingPanelsRasterGalleryError.emit(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"raster-stretch":{const e=document.createElement("arcgis-smart-mapping-panels-raster-stretch");e.addEventListener("arcgisSmartMappingPanelsRasterStretchClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterStretchBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterStretchError",(({detail:e})=>this.arcgisSmartMappingPanelsRasterGalleryError.emit(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"raster-unique-value":{const e=document.createElement("arcgis-smart-mapping-panels-raster-unique-value");e.addEventListener("arcgisSmartMappingPanelsRasterUniqueValueClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterUniqueValueBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterUniqueValueError",(({detail:e})=>this.arcgisSmartMappingPanelsRasterGalleryError.emit(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"raster-vector-field":{const e=document.createElement("arcgis-smart-mapping-panels-raster-vector-field");e.addEventListener("arcgisSmartMappingPanelsRasterVectorFieldClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterVectorFieldBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterVectorFieldError",(({detail:e})=>this.arcgisSmartMappingPanelsRasterGalleryError.emit(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.handleDone=()=>{this.arcgisSmartMappingPanelsRasterGalleryClose.emit("save")},this.handleCancel=()=>{const{originalRendererObj:e,originalEffect:t,originalBandCombination:a,smartMappingState:i}=this,{layer:s}=i,n=s;n.effect=t,n.bandIds=a,(0,r.Q)(i,e),this.arcgisSmartMappingPanelsRasterGalleryClose.emit("cancel")},this.galleryRequestWrapper=e=>{const{smartMappingState:t}=this,{strings:a}=t;(0,c.r)(e,this.flowItemNode).then((e=>{(0,r.Q)(t,e.renderer),(0,i.f)(this.el)}),(()=>{this.arcgisSmartMappingPanelsRasterGalleryError.emit({message:a.panels.gallery.errors.changeRendererErrorMsg,type:"warning"})}))},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,a=e,i=a.rasterFunction;await t.smartMappingRasterUtils.getSupportedRendererInfo({layer:a,rasterFunction:i}).then((async e=>{this.supportedRendererTypes=e.supportedTypes,this.originalRendererObj=(0,r.R)(this.smartMappingState),this.originalEffect=a.effect??void 0,this.originalBandCombination=(a.bandIds||await t.smartMappingRasterUtils.getDefaultBandCombination({layer:a,rasterFunction:i}))??void 0})),this.flowNode=(0,s.f)(this.el,"calcite-flow")}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())))}componentDidUpdate(){setTimeout((()=>{this.tileNodes[0]?.setFocus()}),300)}render(){const{strings:e}=this.smartMappingState;return(0,i.h)(i.H,{key:"abc1dc3d6bba42d26c434e279ae7e9633b952f24",class:"calcite-match-height"},(0,i.h)("calcite-flow-item",{key:"8f194225c7247c3a647d1795bbc8c9a379c9399f",heading:e.panels.rasterGallery.style,class:"flow-item",closable:(0,r.C)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,ref:e=>this.flowItemNode=e},this.renderRasterGalleryContent()))}renderRasterGalleryContent(){return(0,i.h)(i.F,null,this.renderStyleOptions(),this.renderDoneButton(),this.renderCancelButton())}renderStyleOptions(){const{smartMappingState:e}=this,{modules:t,strings:a}=e,s=(0,r.g)(e),n=t.esriLang.clone(this.supportedRendererTypes).sort((e=>e===s?-1:1)).map(((e,t)=>this.renderStyleTile(e,t)));return(0,i.h)(i.F,null,(0,i.h)("calcite-label",{class:"styles-msg-title"},a.panels.rasterGallery.symbologyOptions),n)}renderStyleTile(e,t){const{smartMappingState:a}=this,s=(0,r.g)(a);return(0,i.h)("arcgis-smart-mapping-tile",{key:`tile-${e}`,tileType:"gallery",type:e,selected:e===s,ref:e=>{e&&(this.tileNodes[t]=e)},onArcgisSmartMappingTileSelect:()=>this.handleSelectClick(e),onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick(e)})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,i.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,i.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},e.cancel)}cleanUpFlowItem(e){this.flowNode.removeChild(e),this.focusSelectedTile(),this.selected=!0}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((async()=>await(this.tileNodes[0]?.setFocus())))),300)}get el(){return(0,i.g)(this)}};v.style=":host{display:none}:host([selected]){display:flex}.styles-msg-title{margin-top:12px;padding:6px;font-weight:bold;font-size:16px;display:flex}.styles-msg{font-size:var(--calcite-font-size--2)}"},50732:(e,t,a)=>{a.d(t,{u:()=>n});var i=a(68180),s=a(99592);a(97127);async function n(e,t){const{layer:a,strings:n,modules:l}=e,o=a,c=document.createElement("arcgis-modal-arcade");return c.arcadeScript=t?.expression||"",c.arcadeProfile=function(e){const{layer:t,useFeatureReduction:a}=e;return{id:"visualization",definitions:{$feature:a?{fields:(0,i.n)(t.featureReduction.popupTemplate,!1)}:t}}}(e),c.testData=await async function(e){const{layer:t,mapView:a,useFeatureReduction:s}=e;return{profileVariableInstances:{$feature:s?await(0,i.o)(a,t,t.featureReduction.popupTemplate):await r(e),$view:{scale:a.scale,timeProperties:a.timeExtent?{currentStart:a.timeExtent.start,currentEnd:a.timeExtent.end,startIncluded:!0,endIncluded:!0}:void 0}},spatialReference:a.spatialReference}}(e),c.addExistingExpressions=!0,c.layer=o,c.arcadeTitle=t?.expressionTitle||n.arcade.newExpression,c.arcadeTitleEditable=!0,c.arcadeTitleEditingEnabled=!t?.expressionTitle,document.body.appendChild(c),await new Promise(((t,a)=>{c.addEventListener("arcgisClose",(async i=>{if(document.body.removeChild(c),!i.detail)return void a(new Error);const{script:n,title:r,predictOutputType:p}=i.detail;n?.trim().length?await l.fieldUtils.getExpressionFields(o,[n]).then((a=>{(0,s.S)(e,a),t({expression:n,expressionTitle:r,simpleFieldType:"number"===p?s.q.NUMBER:"string"===p?s.q.STRING:"date"===p?s.q.NUMBER:s.q.UNKNOWN})})):a(new Error)}))}))}async function r(e){const{layer:t,mapView:a,modules:i}=e;let n;if(!("fields"in t))return null;{await async function(e){const{oneFeatureResponse:t,oneFeatureResponseStatus:a}=e;if(t&&a!==s.s.MISSING)return e.oneFeatureResponse;{const t=await async function(e){const{mapView:t,layer:a,mapImageSublayer:i}=e;if(!("fields"in a))throw new Error("getOneFeature: wrong layer type");if(i)return await l(e);return await t.whenLayerView(a).then((async t=>{const i=t;if("feature"===a.type&&!a.url||"wfs"===a.type){const t=a.createQuery();return t.start=0,t.num=5,t.outFields=["*"],await a.queryFeatures(t).then((async t=>t.features?.length?t:o(e)))}{const t="hasM"in a&&a.hasM,s="hasZ"in a&&a.hasZ,n=i.availableFields.length===a.fields?.length&&!t&&!s;if("createQuery"in a&&n){const t=a.createQuery();return t.start=0,t.num=5,t.outFields=["*"],await i.queryFeatures(t).then((async t=>t.features?.length?t:await l(e)))}return await l(e)}}))}(e);return e.oneFeatureResponse=t?.features.length&&t,e.oneFeatureResponseStatus=t?.features.length?s.s.SUCCESS:s.s.FAILED,t}}(e);const{oneFeatureResponse:r}=e;if(r?.features?.length)n=i.esriLang.clone(r.features[0]);else{const r={};t.fields?.forEach((e=>{["small-integer","big-integer","integer","single","double","string","date","date-only","oid","guid"].includes(e.type)&&!1===e.nullable?e.defaultValue?r[e.name]=e.defaultValue:"string"===e.type?r[e.name]="":r[e.name]=0:r[e.name]=null}));const l=a.extent;let o,c;(0,s.z)(e)?(o=new i.Polygon({spatialReference:new i.SpatialReference(a.spatialReference.toJSON())}),o.addRing([[l.xmin,l.ymin],[l.xmax,l.ymin],[l.xmax,l.ymax],[l.xmin,l.ymax],[l.xmin,l.ymin]]),c=new i.SimpleLineSymbol):(0,s.w)(e)?(o=new i.Point(l.center.toJSON()),c=new i.SimpleMarkerSymbol):(0,s.x)(e)&&(o=new i.Polyline({spatialReference:new i.SpatialReference(a.spatialReference.toJSON())}),o.addPath([[l.xmin,l.ymin],[l.xmax,l.ymax]]),c=new i.SimpleFillSymbol),n=new i.Graphic({geometry:o,symbol:c,attributes:r})}}return n}async function l(e){const{layer:t,mapView:a,modules:i}=e;if(!("queryFeatures"in t))return o(e);const s=new i.Query({outFields:["*"],where:"1=1",outSpatialReference:a.spatialReference,returnGeometry:!0,returnM:"hasM"in t&&t.hasM,returnZ:"hasZ"in t&&t.hasZ});return"sourceJSON"in t&&t.sourceJSON?.advancedQueryCapabilities?.supportsPagination&&(s.num=1),await t.queryFeatures(s).catch(o)}function o(e){const{layer:t,modules:a}=e,i={};"fields"in t&&t.fields?.forEach((e=>{e.defaultValue?i[e.name]=e.defaultValue:["small-integer","big-integer","integer","single","double","long","date","oid"].includes(e.type)?i[e.name]=0:"date-only"===e.type?i[e.name]=null:i[e.name]=""}));const n=new a.Graphic({geometry:void 0,symbol:void 0,attributes:i});return new a.FeatureSet({features:[n],fields:[],geometryType:(0,s.A)(e),spatialReference:"spatialReference"in t?t.spatialReference.clone():void 0})}},80216:(e,t,a)=>{a.d(t,{a:()=>r,b:()=>o,c:()=>n,d:()=>l});var i=a(68180),s=a(99592);a(97127);async function n(e,t){const{layer:a,useFeatureReduction:n,mapImageSublayer:r,mapView:l,modules:o}=e,c=a;t=t||{};const p=(0,s.k)((0,s.j)(e));return await o.LocationCreator.createRenderer({layer:c,view:l,outlineOptimizationEnabled:!r&&(!(0,i.i)(t.outlineOptimizationEnabled)||t.outlineOptimizationEnabled),sizeOptimizationEnabled:!r&&(!(0,i.i)(t.sizeOptimizationEnabled)||t.sizeOptimizationEnabled),forBinning:"binning"===c.featureReduction?.type&&n}).then((e=>((0,s.l)(p,e.renderer),e)))}async function r(e,t){const{layer:a,useFeatureReduction:n,mapImageSublayer:r,mapView:l,modules:o}=e,c=a;t=t||{};const p=(0,s.j)(e),d=(0,s.a)(e),m=(0,s.k)(p),g=p.symbol?p.symbol:(0,s.m)(e,d),h={layer:c,view:l,outlineOptimizationEnabled:!r&&((0,i.i)(t.outlineOptimizationEnabled)?t.outlineOptimizationEnabled:!!m.sizeOutlineVisVar),sizeOptimizationEnabled:!r&&((0,i.i)(t.sizeOptimizationEnabled)?t.sizeOptimizationEnabled:!!m.sizeAutoVisVar),forBinning:"binning"===c.featureReduction?.type&&n};return await o.LocationCreator.createRenderer(h).then((e=>((0,s.l)(m,e.renderer),g&&(e.renderer.symbol=g),e)))}async function l(e){const{layer:t,useFeatureReduction:a,mapView:i,modules:n}=e,r=t;return await n.LocationCreator.createRenderer({layer:r,view:i,outlineOptimizationEnabled:!0,forBinning:"binning"===r.featureReduction?.type&&a}).then((e=>(0,s.b)(e.renderer,"size","outline")))}async function o(e){const{layer:t,useFeatureReduction:a,mapView:i,modules:n}=e,r=t;return await n.LocationCreator.createRenderer({layer:r,view:i,outlineOptimizationEnabled:!1,sizeOptimizationEnabled:!0,forBinning:"binning"===r.featureReduction?.type&&a}).then((e=>(0,s.b)(e.renderer,"size","auto")))}},14289:(e,t,a)=>{a.d(t,{a:()=>o,b:()=>n,c:()=>p,d:()=>d,e:()=>r,f:()=>l,g:()=>m,h:()=>c});a(68180);var i=a(99592),s=(a(97127),a(76110));async function n(e,t){const{layer:a,mapView:i,modules:s}=e,n=a;return t=t||{},await s.RasterFlowCreator.createRenderer({layer:n,view:i,theme:t.flowTheme||"flow-line",includeColorVariable:t.includeColorVariable,legendOptions:t.legendOptions,flowRepresentation:t.flowRepresentation,flowScheme:t.flowScheme||l(e)}).then((e=>(e.layerEffect&&!e.layerEffect.includes("drop-shadow")&&(n.effect=e.layerEffect),e.renderer.color=e.renderer.color&&(t.color||e.renderer.color),e)))}async function r(e,t){const{layer:a,mapView:s,modules:n}=e,r=a;t=t||{};const o=(0,i.R)(e),c=(0,i.b)(o,"color"),p=o.authoringInfo,d=t.flowTheme||p?.flowTheme||"flow-line";return await n.RasterFlowCreator.createRenderer({layer:r,view:s,theme:d,includeColorVariable:t.includeColorVariable??!!c,legendOptions:t.legendOptions||c?.legendOptions,flowRepresentation:t.flowRepresentation||o.flowRepresentation,flowScheme:t.flowScheme}).then((a=>{const s=(0,i.G)(o,"color"),r=(0,i.G)(a.renderer,"color");s?.minSliderValue&&s?.maxSliderValue&&r&&(r.minSliderValue=s.minSliderValue,r.maxSliderValue=s.maxSliderValue);const c=(0,i.b)((0,i.R)(e),"color"),m=(0,i.b)(a.renderer,"color");c&&m&&c.stops.forEach(((e,t)=>{m.stops[t].value=e.value})),a.renderer.color=a.renderer.color&&(t.color||o.color||a.renderer.color);return(t.flowScheme||l(e))&&c&&m&&c.stops.forEach(((e,t)=>{m.stops[t].color=new n.EsriColor(e.color.toJSON())})),d===p.flowTheme&&(a.renderer.flowSpeed=o.flowSpeed,a.renderer.density=o.density,a.renderer.trailLength=o.trailLength,a.renderer.trailWidth=o.trailWidth,a.renderer.trailCap=o.trailCap),a}))}function l(e){const{mapView:t,modules:a}=e,s=(0,i.R)(e),n=(0,i.b)(s,"color");if(!n)return null;const r=n.stops.map((e=>e.color)),l=a.flowSchemes.getSchemes({basemap:t.map.basemap||"topo"}),o=[l.primaryScheme].concat(l.secondarySchemes),c=[];return o.forEach((e=>{let t=r.some(((t,a)=>!(0,i.a8)(e.colors[a],t)));t?(e.colors=e.colors.reverse(),t=r.some(((t,a)=>!(0,i.a8)(e.colors[a],t))),t||c.push(e)):c.push(e)})),c.length?c[0]:null}async function o(e){const{layer:t,modules:a}=e,s=t,n="imagery"===s.type?s.rasterFunction??void 0:void 0;return await a.RasterVectorFieldCreator.createRenderer({layer:s,rasterFunction:n}).then((t=>(s.effect=void 0,(0,i.Q)(e,t.renderer),t)))}async function c(e,t){const{layer:a,modules:s}=e,n=a,r=(0,i.R)(e),l="imagery"===n.type?n.rasterFunction??void 0:void 0;return t=t||{},await s.RasterVectorFieldCreator.createRenderer({layer:n,rasterFunction:l,style:t.style||r.style}).then((e=>{e.renderer.symbolTileSize=r.symbolTileSize;const t=(0,i.b)(r,"size");return e.renderer.visualVariables=(0,i.V)(e.renderer,"size")||[],e.renderer.visualVariables.push(t),e.renderer.flowRepresentation=r.flowRepresentation,e.renderer.inputUnit=r.inputUnit,e.renderer.outputUnit=r.outputUnit,e}))}async function p(e){const{layer:t,modules:a}=e,i=t,n="imagery"===i.type?i.rasterFunction??void 0:void 0,r=(0,s.c)(e,[[245,245,0],[255,0,0]].map((e=>new a.EsriColor(e))));return await a.RasterClassBreaksCreator.createRenderer({layer:i,rasterFunction:n,colorRamp:r}).then((e=>(e.renderer.classBreakInfos.forEach((e=>e.symbol.outline.width=0)),e)))}async function d(e,t){const{layer:a,modules:s}=e,n=a,r=(0,i.R)(e),l="imagery"===n.type?n.rasterFunction:void 0;return await s.RasterClassBreaksCreator.createRenderer({layer:n,rasterFunction:l,field:t.field||r.field,classificationMethod:t.classificationMethod||r.authoringInfo.classificationMethod,numClasses:t.numClasses||r.classBreakInfos.length,colorRamp:r.authoringInfo.colorRamp,definedInterval:t.definedInterval}).then((e=>(e.renderer.classBreakInfos.forEach((e=>e.symbol.outline.width=0)),e)))}function m(e){const{rasterInfo:t,modules:a,strings:i}=e;let s;const n=t?.attributeTable?.fields;return s=n?n.filter((e=>"oid"!==e.type&&"string"!==e.type)):[new a.Field({name:"value",alias:i.panels.classBreaks.value})],s}}}]);