/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-700534.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-700534"],{4137:(e,t,i)=>{i.r(t),i.d(t,{arcgis_table:()=>h});var a=i(28614),s=i(71480),l=i(68180),o=i(58325),n=i(42444),r=i(38967),c=i(97127),d=i(50063);const h=class{constructor(e){(0,a.r)(this,e),this.arcgisChange=(0,a.c)(this,"arcgisChange",7),this.arcgisTableUpdated=(0,a.c)(this,"arcgisTableUpdated",7),this.arcgisScaleChange=(0,a.c)(this,"arcgisScaleChange",7),this.arcgisTableScaleChange=(0,a.c)(this,"arcgisTableScaleChange",7),this.arcgisClose=(0,a.c)(this,"arcgisClose",7),this.arcgisTableDismissedChange=(0,a.c)(this,"arcgisTableDismissedChange",7),this.arcgisEditRecordClick=(0,a.c)(this,"arcgisEditRecordClick",7),this.arcgisTableEditRecordClick=(0,a.c)(this,"arcgisTableEditRecordClick",7),this.arcgisCreateRecordClick=(0,a.c)(this,"arcgisCreateRecordClick",7),this.arcgisTableCreateRecordClick=(0,a.c)(this,"arcgisTableCreateRecordClick",7),this.arcgisInCellEdit=(0,a.c)(this,"arcgisInCellEdit",7),this.arcgisTableInCellEdit=(0,a.c)(this,"arcgisTableInCellEdit",7),this.manager=(0,c.u)(this),this.strings=(0,d.u)({blocking:!0}),this.isWithinTabsManager=!1,this.recordsCount=0,this.selectedOnlyMode=!1,this.selectedCount=0,this.keepTableSelection=!1,this.relatedAttributeTableTemplateHandles=[],this.editMessagePopoverClickHandler=e=>{this.editMessagePopoverNode?(0,r.i)(e.target,"arcgis-table-editing-popover")||(document.body.removeChild(this.editMessagePopoverNode),this.editMessagePopoverNode=void 0,document.removeEventListener("click",this.editMessagePopoverClickHandler)):document.removeEventListener("click",this.editMessagePopoverClickHandler)},this.fieldVisibilityPopoverClickHandler=e=>{this.fieldVisibilityPopoverNode?(0,r.i)(e.target,"arcgis-table-field-selection")||(document.body.removeChild(this.fieldVisibilityPopoverNode),this.fieldVisibilityPopoverNode=void 0,document.removeEventListener("click",this.fieldVisibilityPopoverClickHandler)):document.removeEventListener("click",this.fieldVisibilityPopoverClickHandler)},this.columnInfoClickHandler=e=>{this.columnInfoPopoverNode?(0,r.i)(e.target,"arcgis-table-column-info")||(document.body.removeChild(this.columnInfoPopoverNode),this.columnInfoPopoverNode=void 0,document.removeEventListener("click",this.columnInfoClickHandler)):document.removeEventListener("click",this.columnInfoClickHandler)},this.view=void 0,this.layer=void 0,this.config=void 0,this.scale=r.S.MEDIUM,this.dismissible=!1,this.initialViewpoint=void 0,this.allowAddEditRecord=!1,this.allowFieldCalculate=!1,this.initiallySelectedObjectIds=void 0,this.reRender=!1,this.isBarExpanded=!1,this.lockRaster=!1,this.selectedFeatureIds=[]}async setFocus(){this.focus()}async refresh(e){const t=e?.addedObjectIds?.length?e.addedObjectIds:e?.updatedObjectIds;t?(this.selectedFeatureIds=t,this.selectedCount=t.length,this.updateHighlightsAndSelection()):e?.selectedObjectIds?.length&&(this.selectedFeatureIds=e.selectedObjectIds,this.selectedCount=1,this.selectedOnlyMode=!0,this.activeTable.highlightIds.removeAll(),this.activeTable.highlightIds.addMany(e.selectedObjectIds),this.activeTable.objectIds.removeAll(),this.activeTable.objectIds.addMany(e.selectedObjectIds)),await(this.table?.refresh())}async conditionalRefresh(e){const{table:t}=this;if(t.viewModel.relationshipColumns.some((t=>t.layer.id===e.id)))await t.refresh();else for(const i of t.relatedTables){if(i.layer.id===e.id){await t.refresh();break}if(i.viewModel.relationshipColumns.some((t=>t.layer.id===e.id))){await t.refresh();break}}}async containsLayer(e){const{table:t}=this;if(t.layer.id===e.id)return!0;for(const i of t.relatedTables)if(i.layer.id===e.id)return!0;if(!t.relatedTable&&t.relationshipInfos.length){if(t.relationshipInfos.map((e=>e.relatedLayer.id)).includes(e.id))return!0}return!1}async highlightRootFeature(e,t){this.selectedFeatureIds=e&&(0,l.i)(t)?[t]:[],this.updateHighlightsAndSelection()}async enableEdits(e){e?(this.activeTable.editingEnabled=this.supportsEditing(this.activeTable.layer),this.fabNode&&(this.fabNode.disabled=!1)):(this.activeTable.editingEnabled=!1,this.fabNode&&(this.fabNode.disabled=!0))}async disableTableEditorHooks(e){if(!this.activeTable?.layer)return;this.allowAddEditRecord=!e;const t=this.supportsEditing(this.activeTable.layer);e?(this.activeTable.actionColumnConfig=void 0,this.fabNode&&(this.fabNode.hidden=!0)):(this.activeTable.actionColumnConfig=this.allowAddEditRecord&&t?this.getActionColumnConfig(this.activeTable.layer,this.activeTable.relatedTable?"related-table":"parent-table"):void 0,this.fabNode&&(this.fabNode.hidden=!1))}async getSelectedObjectIds(){return await Promise.resolve(this.activeTable.highlightIds)}async componentWillLoad(){await this.loadAllModules();const{view:e,layer:t}=this;"imagery"===t.type?(this.imagerySelection=!0,this.props={view:e,layer:t}):this.props={view:e,layer:t},this.supportsSelection=!0,this.initiallySelectedObjectIds&&(this.selectedFeatureIds=this.initiallySelectedObjectIds,this.selectedCount=this.initiallySelectedObjectIds.length,this.selectedOnlyMode=!0),this.isWithinTabsManager=(0,r.i)(this.el,"arcgis-tabs-manager")}async componentDidLoad(){const{modules:e,allowAddEditRecord:t}=this;(0,n.i)(this.el.shadowRoot,e.esriConfig),requestAnimationFrame((()=>this.focus()));const i=await this.getFieldTemplates();this.activeTable.tableTemplate=i;const{table:s}=this;this.relatedTablesHandle=s.relatedTables.on("change",(async({added:i})=>{i.length&&i.forEach((e=>{const i=e.layer,a=this.supportsEditing(i);e.visibleElements={header:!1,menu:!1,columnDescriptions:!1},e.actionColumnConfig=t&&a?this.getActionColumnConfig(i,"related-table"):void 0,e.attachmentsEnabled=(0,r.e)(i)})),this.activeTable=s.relatedTable??s;this.supportsEditing(this.activeTable.layer)&&this.activeTable.layer.on&&this.activeTable.layer.on("edits",(0,o.d)((()=>{this.activeTable.layer&&(this.arcgisTableInCellEdit.emit({layer:this.activeTable.layer}),this.arcgisInCellEdit.emit({layer:this.activeTable.layer}))}),300)),s.relatedTable&&(this.showSelectedNode.disabled=!0);const l=await this.getFieldTemplates();this.activeTable.tableTemplate=l,setTimeout((()=>this.updateTable(this.activeTable.tableTemplate)),300),this.selectedFeatureIds=[],this.activeTable.highlightIds.forEach((e=>this.selectedFeatureIds.push(e))),this.activeTable.highlightIds.on("change",(e=>{const{selectedFeatureIds:t}=this;e.removed.forEach((e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)})),e.added.forEach((e=>{t.includes(e)||t.push(e)})),this.selectedCount=new Set(t).size,this.lockRasters(),this.reRender=!this.reRender})),this.createFeatureHandle=e.reactiveUtils.watch((()=>this.activeTable.viewModel.store.canAddRelatedFeature),(()=>(0,a.f)(this.el))),(0,a.f)(this.el),this.columnMenuHandle?.remove(),this.columnMenuHandle=this.getMenuHandle(),this.attachmentsViewOptionsHandle?.remove(),this.attachmentsViewOptionsHandle=this.getAttachmentsViewOptionsHandle(),this.columnSortOrderHandle?.remove(),this.columnSortOrderHandle=this.getColumnSortOrderHandle(),this.columnReorderHandle?.remove(),this.columnReorderHandle=this.getColumnReorderHandle(),this.relatedAttributeTableTemplateHandles.forEach((e=>e?.remove())),this.table.relatedTables.forEach((e=>{const t=this.getRelatedAttributeTableTemplateHandle(e);t&&this.relatedAttributeTableTemplateHandles.push(t)}))})),this.showAllTablesHandle=e.reactiveUtils.watch((()=>this.table.allRelatedTablesVisible),(e=>this.fieldVisibilityActionNode.disabled=e))}disconnectedCallback(){this.closePopovers();const{table:e}=this;e?.destroy(),this.removeAllHandles()}render(){const{props:e,isWithinTabsManager:t}=this,{layer:i}=e;return i?(0,a.h)(a.H,null,(0,a.h)("div",{class:"content"},this.renderActionBar(),(0,a.h)("calcite-panel",{heading:t?void 0:i.title,ref:e=>{const{layer:t}=this.props;this.panelNode=e,this.layerTitleHandle=t.watch("title",(()=>this.reRender=!this.reRender))},onKeyDown:e=>{this.dismissible&&"Escape"===e.key&&!e.defaultPrevented&&(this.handleCloseClick(),e.preventDefault())}},this.renderHeaderActions(),this.renderTable(),this.renderCreateRecordFab()))):(0,a.h)(a.F,null)}renderActionBar(){const{supportsSelection:e,selectedFeatureIds:t,imagerySelection:i,strings:s,isWithinTabsManager:l}=this,o=this.isKnowledgeGraphSubTable();return(0,a.h)("div",{class:l?"":"non-tabs-manager-action-bar-wrapper"},(0,a.h)("calcite-action-bar",{class:"action-bar",onCalciteActionBarToggle:e=>this.isBarExpanded=e.target.expanded},(0,a.h)("calcite-action-group",{overlayPositioning:"fixed",menuPlacement:"trailing-start"},e&&!(this.activeTable?.layer??this.layer).isTable&&!o&&(0,a.h)("calcite-action",{icon:"zoom-to-object",text:s.zoomToSelection,disabled:!t?.length,onClick:()=>this.handleZoomToClick(),ref:e=>{this.zoomNode=e,this.afterCreateAction(this.zoomNode,s.zoomToSelection)}}),(0,a.h)("calcite-action",{icon:"home",text:s.home,disabled:!this.initialViewpoint,onClick:()=>this.handleHomeClick(),ref:e=>{this.homeNode=e,this.afterCreateAction(this.homeNode,s.home)}}),(0,a.h)("calcite-tooltip",{slot:"menu-tooltip",overlayPositioning:"fixed"},(0,a.h)("div",{class:"tooltip"},s.more))),!i&&this.renderTableActions(),i&&e&&this.renderImageryTableActions(),(0,a.h)("calcite-tooltip",{slot:"expand-tooltip",overlayPositioning:"fixed"},(0,a.h)("div",{class:"tooltip"},s.expand))))}renderTableActions(){const{selectedFeatureIds:e,supportsSelection:t,selectedOnlyMode:i,strings:s}=this,l=i||this.activeTable?.objectIds?.length;return(0,a.h)("calcite-action-group",{overlayPositioning:"fixed",menuPlacement:"trailing-start"},t&&(0,a.h)("calcite-action",{icon:"erase",text:s.clearSelection,disabled:!e?.length,onClick:()=>this.handleClearClick(),ref:e=>{this.eraseNode=e,this.afterCreateAction(this.eraseNode,s.clearSelection)}}),t&&(0,a.h)("calcite-action",{icon:"selected-items-filter",text:s.showSelected,disabled:this.table?.relatedTable||!e?.length,onClick:()=>this.handleShowSelectedClick(),ref:e=>{this.showSelectedNode=e,this.afterCreateAction(this.showSelectedNode,s.showSelected)}}),t&&(0,a.h)("calcite-action",{icon:"list",text:s.showAll,disabled:!l,onClick:()=>this.handleShowAllClick(),ref:e=>{this.showAllNode=e,this.afterCreateAction(this.showAllNode,s.showAll)}}),(0,a.h)("calcite-action",{icon:"refresh",text:s.refresh,onClick:()=>this.handleRefreshClick(),ref:e=>{this.refreshNode=e,this.afterCreateAction(this.refreshNode,s.refresh)}}),(0,a.h)("calcite-tooltip",{slot:"menu-tooltip",overlayPositioning:"fixed"},(0,a.h)("div",{class:"tooltip"},s.more)))}renderImageryTableActions(){const{selectedFeatureIds:e,lockRaster:t,strings:i}=this;return(0,a.h)("calcite-action-group",{overlayPositioning:"fixed",menuPlacement:"trailing-start"},(0,a.h)("calcite-action",{icon:"erase",text:i.clearSelection,disabled:!e?.length,onClick:()=>this.handleClearClick(),ref:e=>{this.eraseNode=e,this.afterCreateAction(this.eraseNode,i.clearSelection)}}),(0,a.h)("calcite-action",{icon:"select-visible",text:i.selectVisible,onClick:()=>this.handleSelectVisibleClick(),ref:e=>{this.selectVisibleImageryNode=e,this.afterCreateAction(this.selectVisibleImageryNode,i.selectVisible)}}),(0,a.h)("calcite-action",{icon:t?"unlock":"lock",text:t?i.displayAll:i.displaySelected,onClick:()=>{t?this.handleDisplayAllClick():this.handleDisplaySelectedClick()},ref:e=>{this.displayImageNode=e,this.afterCreateAction(this.displayImageNode,t?i.displayAll:i.displaySelected)}}),(0,a.h)("calcite-tooltip",{slot:"menu-tooltip",overlayPositioning:"fixed"},(0,a.h)("div",{class:"tooltip"},i.more)))}renderHeaderActions(){const{layer:e,strings:t}=this,i="type"in e&&this.supportsEditing(e)&&!e.editingEnabled;return(0,a.h)("div",{slot:"header-actions-end",class:"menu-actions"},i&&(0,a.h)("calcite-action",{text:t.layerEditing,scale:"s",onClick:()=>this.handleEditMessageActionClick(),ref:e=>this.editMessageActionNode=e},(0,a.h)("calcite-icon",{scale:"s",icon:"exclamation-mark-circle"})),(0,a.h)("calcite-action",{text:t.fieldVisibility,scale:"s",onClick:()=>this.handleFieldVisibilityClick(),ref:e=>this.fieldVisibilityActionNode=e,onMouseOver:()=>(0,r.a)(this.fieldVisibilityActionNode,t.fieldVisibility),onMouseOut:()=>(0,r.r)(),onFocus:()=>(0,r.a)(this.fieldVisibilityActionNode,t.fieldVisibility),onFocusout:()=>(0,r.r)()},(0,a.h)("calcite-icon",{scale:"s",icon:"gear"})),this.renderExpandCollapseButton(),this.renderCloseButton())}renderExpandCollapseButton(){const{strings:e,scale:t,isWithinTabsManager:i}=this;return i?(0,a.h)(a.F,null):t===r.S.SMALL?(0,a.h)("calcite-action",{key:"expand-table",text:e.expand,scale:"s",onClick:()=>this.handleExpandClick()},(0,a.h)("calcite-icon",{icon:"chevrons-up"})):(0,a.h)("calcite-action",{key:"expand",text:e.shrink,scale:"s",onClick:()=>this.handleExpandClick()},(0,a.h)("calcite-icon",{icon:"chevrons-down"}))}renderCloseButton(){const{strings:e,isWithinTabsManager:t,dismissible:i}=this;return t||!i?(0,a.h)(a.F,null):(0,a.h)("calcite-action",{text:e.close,icon:"x",onClick:()=>this.handleCloseClick(),ref:e=>this.closeButtonNode=e})}renderTable(){return(0,a.h)("div",{class:"table"},(0,a.h)("div",{ref:e=>this.afterCreateTableNode(e)}))}renderCreateRecordFab(){const{strings:e,allowAddEditRecord:t}=this,i=this.table?.relatedTable?this.table?.relatedTable.layer:this.layer;if(!t)return(0,a.h)(a.F,null);if(!this.supportsEditing(i))return(0,a.h)(a.F,null);if(this.table?.relatedTable&&!this.table.relatedTable.viewModel.store.canAddRelatedFeature)return(0,a.h)(a.F,null);const s=(0,r.g)(i);return i.isTable||s.length?(0,a.h)("calcite-fab",{scale:"s",class:"table-fab",kind:"neutral",appearance:"outline-fill","text-enabled":!0,text:i.isTable?e.createRecord:e.createFeature,onClick:()=>{this.fabNode&&(this.fabNode.disabled=!0),this.activeTable.highlightIds.removeAll(),this.handleCreateRecordClick()},ref:e=>this.fabNode=e}):(0,a.h)(a.F,null)}async loadAllModules(){const[e,t,i,a,l,o,n,r,c,d,h,u]=await Promise.all([(0,s.aW)(),(0,s.aX)(),(0,s.aY)(),(0,s.aZ)(),(0,s.b)(),(0,s.a_)(),(0,s.aj)(),(0,s.a$)(),(0,s.b0)(),(0,s.j)(),(0,s.al)(),(0,s.i)()]);this.modules={FeatureTable:e,TableTemplate:t,attributeTableTemplateUtils:i,popupUtils:a,reactiveUtils:l,FieldInfoFormat:o,Query:n,imageService:r,MosaicRule:c,Graphic:d,intl:h,esriConfig:u}}afterCreateTableNode(e){const{modules:t,props:i,supportsSelection:a}=this;let{selectedFeatureIds:s}=this;const{layer:l,view:n}=i,{table:c}=this;if(c)return;const{allowAddEditRecord:d}=this,h=this.supportsEditing(l);this.table=new t.FeatureTable({objectIds:s,highlightIds:s,layer:l,view:n,relatedRecordsEnabled:!0,editingEnabled:h,attachmentsEnabled:(0,r.e)(l),multiSortEnabled:!1,visibleElements:{header:!1,menu:!1,columnDescriptions:!1},actionColumnConfig:d&&h?this.getActionColumnConfig(l,"parent-table"):void 0,container:e}),this.activeTable=this.table,h&&this.table.layer.on&&this.table.layer.on("edits",(0,o.d)((()=>{this.table.layer&&(this.arcgisTableInCellEdit.emit({layer:this.table.layer}),this.arcgisInCellEdit.emit({layer:this.table.layer}))}),300)),a||(this.activeTable.grid.visibleElements={selectionColumn:!1}),this.tableSizeHandle=t.reactiveUtils.watch((()=>this.table.viewModel.size),(e=>{this.recordsCount=e,this.updateDisplayCount()})),this.columnMenuHandle?.remove(),this.columnMenuHandle=this.getMenuHandle(),this.attachmentsViewOptionsHandle?.remove(),this.attachmentsViewOptionsHandle=this.getAttachmentsViewOptionsHandle(),this.columnSortOrderHandle?.remove(),this.columnSortOrderHandle=this.getColumnSortOrderHandle(),this.columnReorderHandle?.remove(),this.columnReorderHandle=this.getColumnReorderHandle(),this.attributeTableTemplateHandle?.remove(),this.attributeTableTemplateHandle=this.getAttributeTableTemplateHandle(),a&&(this.activeTable.highlightIds.on("change",(e=>{const{selectedFeatureIds:t}=this;e.removed.forEach((e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)})),e.added.forEach((e=>{t.includes(e)||t.push(e)})),this.selectedCount=new Set(t).size,this.updateDisplayCount(),this.lockRasters(),this.reRender=!this.reRender})),this.popupActiveHandle=t.reactiveUtils.watch((()=>n.popup?.viewModel?.active),(()=>{const e=n.popup?.selectedFeature;if(e&&n.popup?.visible&&(e.layer?.id===l.id||"sublayer"===l.type&&e.sourceLayer?.layer?.id===l.layer?.id)){this.activeTable.highlightIds.removeAll(),s=[];const e=n.popup.selectedFeature.getObjectId();this.activeTable.highlightIds.push(e),s.push(e),this.selectedOnlyMode&&!this.activeTable.objectIds.includes(e)&&(this.activeTable.objectIds.push(e),this.reRender=!this.reRender)}else!e||n.popup.visible||this.keepTableSelection||(this.activeTable.highlightIds.removeAll(),this.selectedOnlyMode&&this.handleShowAllClick());this.keepTableSelection=!1})))}getActionColumnConfig(e,t){const{strings:i}=this;return{icon:"pencil",label:e.isTable?i.editRecord:i.editFeature,callback:({feature:i})=>{this.keepTableSelection=!0,this.activeTable.columns.forEach((e=>e.closeMenu())),this.selectedFeatureIds=[i.getObjectId()],this.activeTable.highlightIds.removeAll(),this.activeTable.highlightIds.add(i.getObjectId()),this.activeTable.editingEnabled=!1,"related-table"===t&&(i.layer=e,i.sourceLayer=e),this.arcgisTableEditRecordClick.emit({parentTable:this.table,feature:i,layer:e}),this.arcgisEditRecordClick.emit({parentTable:this.table,feature:i,layer:e})},disabled:()=>(0,l.i)(this.activeTable)&&!this.activeTable.editingEnabled}}async getFieldTemplates(e){const{modules:t,activeTable:i,strings:a}=this,s=e??i?.layer??this.layer,l=e=>{const t=[{label:a.information,icon:"information",clickFunction:()=>this.handleShowColumnInfo(e.name)}],i=!["blob","global-id","guid","oid","raster"].includes(e.type),l=s.sourceJSON?.geometryProperties,o=l?.shapeLengthFieldName,n=l?.shapeAreaFieldName,r=[o,n].includes(e.name),c=window.customElements?.get("arcgis-field-calculate"),d=c&&e.editable&&i&&!r&&e.name!==this.activeTable.layer.objectIdField,h=("feature"===s.type||"oriented-imagery"===s.type)&&s.sourceJSON.supportsCalculate&&s.portalItem?.typeKeywords?.indexOf("Hosted Service")>-1&&"admin"===s.portalItem.itemControl;return this.allowFieldCalculate&&this.config&&h&&d&&t.push({label:a.calculateField,icon:"calculator",clickFunction:()=>this.handleCalculateField(e.name)}),t.push({label:a.hideField,icon:"view-hide",clickFunction:()=>this.handleHideClick(e.name)}),{items:t}};let o;if(r.s.includes(s.type)){o=s.attributeTableTemplate?await t.attributeTableTemplateUtils.createTableTemplateFromAttributeTableTemplate({layer:s,template:s.attributeTableTemplate,includeHiddenFields:!0,excludedFieldTypesOverride:["geometry","blob","raster","xml"]}):await t.attributeTableTemplateUtils.createDefaultTableTemplateFromLayer({layer:s,excludedFieldTypesOverride:["geometry","blob","raster","xml"]}),s?.attributeTableTemplate||(s.attributeTableTemplate=await t.attributeTableTemplateUtils.createDefaultAttributeTableTemplateFromLayer({layer:s,excludedFieldTypesOverride:["geometry","blob","raster","xml"]}));const e=s.fields.filter((e=>!e.visible)).map((e=>e.name));o.columnTemplates=o.columnTemplates.filter((t=>!("field"===t.type&&(e.includes(t.fieldName)||!s.fields.find((e=>e.name===t.fieldName)))))),o.columnTemplates.forEach((e=>{if("field"===e.type){const t=e.fieldName,i=s.fields.find((e=>e.name===t)),a=s.popupTemplate?.fieldInfos?.find((e=>e.fieldName===t));e.label=a?.label||i.alias||i.name,e.menuConfig=l(i),e.format=a?.format??this.getDefaultFormat(i)}}))}else{o=new t.TableTemplate({columnTemplates:[]});const e=t.popupUtils.createFieldInfos({fields:s.fields,objectIdField:s.objectIdField}),i=new Map(e.map((e=>[e.fieldName,e]))),a=s.popupTemplate?.fieldInfos?new Map(s.popupTemplate.fieldInfos.map((e=>[e.fieldName,e]))):void 0,n=[];if(s.fields.forEach((e=>{if("geometry"===e.type||!e.visible)return;const t=i.get(e.name),s=a?.get(e.name),o={fieldName:e.name,label:s?.label||e.alias||e.name,type:"field",visible:!!t&&t.visible,format:s?.format||this.getDefaultFormat(e),menuConfig:l(e)};n.push(o)})),(0,r.e)(s)){const e={type:"attachment",visible:!0};n.push(e)}o.columnTemplates=n}return s.popupTemplate?.fieldInfos&&(this.popupTemplateWatchHandle?.remove(),this.popupTemplateWatchHandle=t.reactiveUtils.watch((()=>s.popupTemplate),(async()=>{let e=!1,i=!1;const{popupTemplate:a}=s;if(o.columnTemplates.forEach((t=>{a.fieldInfos.forEach((a=>{if(t.fieldName===a.fieldName&&(JSON.stringify(t.format)!==JSON.stringify(a.format)&&(i=!0,t.format=a.format),t.label!==a.label)){e=!0,t.label=a.label;const i=this.activeTable.columns.find((e=>e.fieldName===a.fieldName));i&&(i.label=a.label)}}))})),r.s.includes(s.type)){const e=await this.getFieldTemplates();this.activeTable.tableTemplate=e}else e?this.updateTable(new t.TableTemplate({columnTemplates:o.columnTemplates})):i&&await(this.table?.refresh())}))),o}getDefaultFormat(e){const{modules:t}=this;return["integer","small-integer","big-integer"].includes(e.type)?new t.FieldInfoFormat({digitSeparator:!1,places:0}):["single","double","long"].includes(e.type)?new t.FieldInfoFormat({digitSeparator:!1,places:2}):["date","time-only","timestamp-offset"].includes(e.type)?new t.FieldInfoFormat({dateFormat:"short-date-short-time"}):"date-only"===e.type?new t.FieldInfoFormat({dateFormat:"short-date"}):void 0}supportsEditing(e){const t=["feature","oriented-imagery","subtype-sublayer"].includes(e.type),i=e.effectiveEditingEnabled;return t&&i}updateDisplayCount(){const{modules:e,strings:t,panelNode:i,recordsCount:a,selectedCount:s,supportsSelection:o}=this;if(!i)return;const n=e.intl.convertNumberFormatToIntlOptions({digitSeparator:!0}),r=e.intl.formatNumber(a,n);if((0,l.i)(s)&&o)if(0===s)i.description=0===a?t.zeroRecordsZeroSel:1===a?t.oneRecordZeroSel:t.numRecordsZeroSel.replace("${count}",r);else if(1===s)i.description=0===a?t.zeroRecordsOneSel:1===a?t.oneRecordOneSel:t.numRecordsOneSel.replace("${count}",r);else{const l=e.intl.formatNumber(s,n);i.description=0===a?t.zeroRecordsNumSel.replace("${countSel}",l):1===a?t.oneRecordNumSel.replace("${countSel}",l):t.numRecordsNumSel.replace("${count}",r).replace("${countSel}",l)}else i.description=0===a?t.zeroRecords:1===a?t.oneRecord:t.numRecords.replace("${count}",r)}isKnowledgeGraphSubTable(){const e=this.activeTable?.layer??this.layer;if("knowledge-graph-sublayer"===e.type){return(e.parentCompositeLayer.tables?.toArray()??[]).map((e=>e.id)).includes(e.id)}return!1}afterCreateAction(e,t){e&&(e.onfocus=()=>{const{isBarExpanded:i}=this;i||e.textEnabled||(0,r.a)(e,t)},e.onmouseover=e.onfocus,e.onmouseout=()=>(0,r.r)(),e.removeEventListener("focusout",(()=>(0,r.r)())),e.addEventListener("focusout",(()=>(0,r.r)())))}handleZoomToClick(){const{modules:e,view:t,selectedFeatureIds:i}=this,a=this.activeTable?.layer??this.layer;if("imagery"===a.type){const s=new e.Query;s.outSpatialReference=t.spatialReference,s.objectIds=[...i],s.returnGeometry=!0,a.queryRasters(s).then((e=>{t.goTo(e.features)}))}else{const e=a,s=e.createQuery();s.outSpatialReference=t.spatialReference,s.objectIds=[...i],s.returnGeometry=!0,e.queryFeatures(s).then((e=>{t.goTo(e.features)}))}}handleHomeClick(){const{view:e,initialViewpoint:t}=this;e.goTo(t)}handleClearClick(){const{activeTable:e,supportsSelection:t}=this,{grid:i}=e;e.highlightIds.removeAll(),this.clearFilter(),t&&(i.visibleElements={selectionColumn:!0})}handleShowSelectedClick(){this.selectedOnlyMode=!0,this.activeTable.objectIds.removeAll(),this.activeTable.objectIds.addMany(this.activeTable.highlightIds),this.reRender=!this.reRender}handleShowAllClick(){this.selectedOnlyMode=!1,this.activeTable.objectIds.removeAll(),this.reRender=!this.reRender}handleRefreshClick(){const{table:e}=this;e.refresh(),this.reRender=!this.reRender}async handleSelectVisibleClick(){const{layer:e,view:t,table:i}=this;i.highlightIds.removeAll();const a=t?.extent,l=await async function(e,t,i){const[a,l,o]=await Promise.all([(0,s.ah)(),(0,s.k)(),(0,s.aV)()]),n=new a({spatialReference:e.spatialReference});n.addRing([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]);const r=new l({x:(e.xmax-e.xmin)/t.width,y:(e.ymax-e.ymin)/t.height,spatialReference:e.spatialReference}),c=new o;c.geometry=n,c.returnGeometry=!0,c.pixelSize=r;const d=i.mosaicRule.clone();return i.definitionExpression&&(d.where=i.definitionExpression),c.mosaicRule=d,c}(a,t,e);this.selectFeaturesFromIdentify(l)}handleDisplayAllClick(){const{modules:e}=this;this.lockRaster=!1;const t=this.layer,{sourceJSON:i}=t,a=i.allowedMosaicMethods.split(",").map((e=>e.trim().toLowerCase()));a.unshift(i.defaultMosaicMethod.toLowerCase());const s=a.find((e=>"lockraster"!==e&&"viewpoint"!==e&&("byattribute"!==e||!!i.sortField)))??"none";t.mosaicRule=e.MosaicRule.fromJSON({...i,defaultMosaicMethod:s}),t.visible=!0}handleDisplaySelectedClick(){this.lockRaster=!0,this.lockRasters()}handleEditMessageActionClick(){const{strings:e}=this;this.editMessagePopoverNode||(document.removeEventListener("click",this.editMessagePopoverClickHandler),this.editMessagePopoverNode=document.createElement("arcgis-table-editing-popover"),this.editMessagePopoverNode.referenceElement=this.editMessageActionNode,this.editMessagePopoverNode.strings=e,this.editMessagePopoverNode.addEventListener("arcgisClose",(e=>{e.stopPropagation(),this.removeEditingPopover(),setTimeout((()=>this.editMessageActionNode?.setFocus()),200)})),document.body.appendChild(this.editMessagePopoverNode),setTimeout((()=>{this.editMessagePopoverNode?.setFocus(),document.addEventListener("click",this.editMessagePopoverClickHandler)}),100))}handleFieldVisibilityClick(){if(this.fieldVisibilityPopoverNode)return;document.removeEventListener("click",this.fieldVisibilityPopoverClickHandler);const e=this.activeTable.layer,{props:t,strings:i,fieldSortOrder:a,activeTable:s}=this,l=document.createElement("arcgis-table-field-selection");l.props={layer:e,view:t.view},l.strings=i,l.columnTemplates=s.tableTemplate.columnTemplates;const o=this.activeTable.columns.filter((e=>"field"in e))??[],n=Array.from(o.map((e=>e.fieldName)));l.fieldColumnOrder=n,l.sortBy=a??"default",l.attachmentsEnabled=!!(0,r.e)(e)&&s.attachmentsEnabled,l.relationshipsEnabled=s.relatedRecordsEnabled,l.popoverReferenceElement=this.fieldVisibilityActionNode,l.addEventListener("arcgisFieldColumnTemplatesVisibilityChange",(e=>{e.stopPropagation();e.detail.forEach((e=>this.activeTable.toggleColumnVisibility(e))),this.updateTable(this.activeTable.tableTemplate)})),l.addEventListener("arcgisAttachmentColumnTemplateVisibilityChange",(e=>{e.stopPropagation();this.activeTable.columns.find((e=>"onShowAttachments"in e)).hidden=!e.detail;const t=this.activeTable.tableTemplate?.columnTemplates.find((e=>"attachment"===e.type));t.visible=e.detail,this.updateTable(this.activeTable.tableTemplate)})),l.addEventListener("arcgisRelationshipsColumnTemplateVisibilityChange",(e=>{e.stopPropagation();this.activeTable.columns.filter((e=>"relationshipId"in e)).forEach((t=>t.hidden=!e.detail));const t=this.activeTable.tableTemplate?.columnTemplates.filter((e=>"relationship"===e.type));t?.forEach((t=>t.visible=e.detail)),this.updateTable(this.activeTable.tableTemplate)})),l.addEventListener("arcgisSortByChange",(e=>{e.stopPropagation(),this.fieldSortOrder=e.detail})),l.addEventListener("arcgisClose",(()=>{this.closePopovers(),setTimeout((()=>this.fieldVisibilityActionNode.setFocus()),200)})),document.body.appendChild(l),this.fieldVisibilityPopoverNode=l,setTimeout((()=>document.addEventListener("click",this.fieldVisibilityPopoverClickHandler)),200)}handleExpandClick(){const{scale:e}=this,t=e===r.S.SMALL?r.S.MEDIUM:r.S.SMALL;this.arcgisTableScaleChange.emit(t),this.arcgisScaleChange.emit(t),this.scale=t,this.closePopovers()}handleCloseClick(){this.arcgisTableDismissedChange.emit(),this.arcgisClose.emit()}handleCreateRecordClick(){const{table:e}=this;if(e.relatedTable){const t=e.relatedTable;t.editingEnabled=!1;const i=t.tableParent;if(t.relationshipConfig){const{objectId:e}=t.relationshipConfig,a=i.viewModel.store.getItemByObjectId(e);if(a?.feature){const{relatedLayer:e,relationshipId:i}=t.relationshipConfig,s=e.relationships?.find((e=>e.id===i)),l=a.feature,o=t.layer.relationships?.find((e=>e.id===i)),n=l.getAttribute(s.keyField);this.arcgisTableCreateRecordClick.emit({parentTable:this.table,targetTable:t,relationshipKeyField:o.keyField,relationshipKeyFieldValue:n}),this.arcgisCreateRecordClick.emit({parentTable:this.table,targetTable:t,relationshipKeyField:o.keyField,relationshipKeyFieldValue:n})}else t.editingEnabled=!1,this.arcgisTableCreateRecordClick.emit({parentTable:this.table,targetTable:t}),this.arcgisCreateRecordClick.emit({parentTable:this.table,targetTable:t})}else t.editingEnabled=!1,this.arcgisTableCreateRecordClick.emit({parentTable:this.table,targetTable:t}),this.arcgisCreateRecordClick.emit({parentTable:this.table,targetTable:t})}else this.table.editingEnabled=!1,this.arcgisTableCreateRecordClick.emit({parentTable:this.table,targetTable:this.table}),this.arcgisCreateRecordClick.emit({parentTable:this.table,targetTable:this.table})}handleShowColumnInfo(e){this.columnInfoPopoverNode&&this.columnInfoPopoverNode.parentNode?.removeChild(this.columnInfoPopoverNode),document.removeEventListener("click",this.columnInfoClickHandler);const{props:t,strings:i}=this,a=this.activeTable.layer,s=document.createElement("arcgis-table-column-info");s.props={view:t.view,layer:a},s.strings=i,s.fieldName=e,s.popoverReferenceElement=this.fieldVisibilityActionNode,s.addEventListener("arcgisClose",(()=>{this.closePopovers(),setTimeout((()=>this.focus()),100)})),s.addEventListener("arcgisSetupComplete",(()=>this.syncMenuHandles())),document.body.appendChild(s),this.columnInfoPopoverNode=s,setTimeout((()=>document.addEventListener("click",this.columnInfoClickHandler)),200)}handleCalculateField(e){const t=window.customElements?.get("arcgis-field-calculate");if(!t)return;const i=document.createElement("arcgis-field-calculate");i.fieldName=e,i.layer=this.activeTable.layer,i.config=this.config,i.addEventListener("arcgisFieldCalculateClose",(()=>{document.body.removeChild(i),this.activeTable.refresh(),this.arcgisTableInCellEdit.emit({layer:this.activeTable.layer}),this.arcgisInCellEdit.emit({layer:this.activeTable.layer})})),document.body.appendChild(i)}handleHideClick(e){this.activeTable.hideColumn(e),this.activeTable.tableTemplate?.columnTemplates.forEach((t=>{t.fieldName===e&&(t.visible=!1)})),this.updateTable(this.activeTable.tableTemplate)}async lockRasters(){const{modules:e,selectedFeatureIds:t,layer:i,imagerySelection:a}=this;if(this.lockRaster)if(a&&t.length){const a=t.map((e=>"string"==typeof e?Number.parseInt(e):e)),s=new e.MosaicRule;s.method="lock-raster",s.lockRasterIds=a;const l=i.definitionExpression;l&&(s.where=l),i.mosaicRule=s,i.visible=!0}else i.visible=!1}async selectFeaturesFromIdentify(e){const{modules:t,layer:i}=this,a=[];if("imagery"===i.type&&i.visible){const s=await t.imageService.identify(i.url,e);if(s?.catalogItems?.features&&s.catalogItemVisibilities)for(let e=0;e<s.catalogItems.features.length;e++)s.catalogItemVisibilities[e]>0&&a.push(s.catalogItems.features[e]);const l=a.map((e=>new t.Graphic({attributes:e.attributes,geometry:e.geometry,sourceLayer:this.activeTable.layer,layer:this.activeTable.layer})));l.length?l.forEach((e=>this.activeTable.highlightIds.add(e.getObjectId()))):this.activeTable.highlightIds.removeAll()}}updateTable(e){this.activeTable.tableTemplate=e,this.isStandardView()&&this.syncAttributeTableTemplate()}updateHighlightsAndSelection(){this.activeTable.highlightIds.removeAll(),this.activeTable.highlightIds.addMany(this.selectedFeatureIds),this.activeTable.objectIds.length&&this.activeTable.objectIds.addMany(this.selectedFeatureIds)}getMenuHandle(){const{modules:e}=this;return e.reactiveUtils.watch((()=>this.activeTable?.state),(e=>{"loaded"===e&&(this.syncMenuHandles(),this.activeTable.columns.on("change",(()=>this.syncMenuHandles())))}))}syncMenuHandles(){this.activeTable.columns?.forEach((e=>{e?.menu&&(e?.menu?.addEventListener("calciteDropdownOpen",(()=>{this.fabNode&&(this.fabNode.hidden=!0)})),e?.menu?.addEventListener("calciteDropdownClose",(()=>{this.fabNode&&(this.fabNode.hidden=!1)})))}))}getColumnSortOrderHandle(){const{modules:e}=this;return e.reactiveUtils.watch((()=>this.activeTable.activeSortOrders),(async()=>{"loaded"===this.activeTable.state&&this.isStandardView()&&this.syncAttributeTableTemplate()}))}getColumnReorderHandle(){const{activeTable:e}=this;return e.on("column-reorder",(()=>{this.fieldVisibilityPopoverNode?.parentElement?.removeChild(this.fieldVisibilityPopoverNode),this.fieldVisibilityPopoverNode=void 0,document.body.removeEventListener("click",this.fieldVisibilityPopoverClickHandler),this.isStandardView()&&this.syncAttributeTableTemplate()}))}getAttachmentsViewOptionsHandle(){const{modules:e}=this;return e.reactiveUtils.watch((()=>this.activeTable.attachmentsViewOptions.objectId),(e=>{this.fabNode&&(e&&!this.fabNode.classList.contains("hidden-fab")?this.fabNode.classList.add("hidden-fab"):!e&&this.fabNode.classList.contains("hidden-fab")&&this.fabNode.classList.remove("hidden-fab"))}))}getAttributeTableTemplateHandle(){const{layer:e,modules:t}=this;if(!r.s.includes(e.type))return;return t.reactiveUtils.watch((()=>e.attributeTableTemplate),(async(e,t)=>{if(!t)return;const i=await this.getFieldTemplates(this.layer);this.table.tableTemplate=i,await this.table.refresh()}))}getRelatedAttributeTableTemplateHandle(e){const{modules:t}=this;if(!r.s.includes(e.layer.type))return;return t.reactiveUtils.watch((()=>e.layer?.attributeTableTemplate),(async(t,i)=>{if(t&&i){const t=await this.getFieldTemplates(e.layer);e.tableTemplate=t,await this.table.refresh()}}))}async syncAttributeTableTemplate(){const e=this.activeTable.layer;if(r.s.includes(e.type)){if(e.attributeTableTemplate){const{modules:t}=this,i=e.attributeTableTemplate.clone();t.attributeTableTemplateUtils.syncAttributeTableTemplate(this.activeTable,i),JSON.stringify(i)!==JSON.stringify(e.attributeTableTemplate)&&(e.attributeTableTemplate=i)}if(e.attributeTableTemplate?.orderByFields?.length>1){const t=e.attributeTableTemplate.clone(),i=this.table.activeSortOrders[0];t.orderByFields=[{field:i.fieldName,order:i.direction}],e.attributeTableTemplate=t,this.syncColumnDirectionsWithOrderByFields()}this.arcgisTableUpdated.emit(),this.arcgisChange.emit()}}isStandardView(){return!this.table.relatedTable&&!this.activeTable.attachmentsViewOptions.objectId}syncColumnDirectionsWithOrderByFields(){const e=this.activeTable.activeSortOrders[0]?.fieldName;this.activeTable.columns.forEach((t=>{"fieldName"in t&&t.fieldName!==e&&(t.direction=void 0)})),this.activeTable.tableTemplate?.columnTemplates.forEach((t=>{"fieldName"in t&&t.fieldName!==e&&(t.direction=void 0)}))}focus(){const{isWithinTabsManager:e}=this;e?this.fieldVisibilityActionNode?.setFocus():this.closeButtonNode?.setFocus()}clearFilter(){this.selectedOnlyMode=!1,this.selectedCount=0,this.selectedFeatureIds=[],this.activeTable.objectIds.removeAll()}closePopovers(){document.removeEventListener("click",this.fieldVisibilityPopoverClickHandler),document.removeEventListener("click",this.columnInfoClickHandler),document.removeEventListener("click",this.editMessagePopoverClickHandler),this.fieldVisibilityPopoverNode&&(document.body.removeChild(this.fieldVisibilityPopoverNode),this.fieldVisibilityPopoverNode=void 0),this.columnInfoPopoverNode&&(document.body.removeChild(this.columnInfoPopoverNode),this.columnInfoPopoverNode=void 0),this.removeEditingPopover()}removeEditingPopover(){this.editMessagePopoverNode?.parentElement?.removeChild(this.editMessagePopoverNode),this.editMessagePopoverNode=void 0}removeAllHandles(){this.layerTitleHandle?.remove(),this.tableSizeHandle?.remove(),this.popupActiveHandle?.remove(),this.popupTemplateWatchHandle?.remove(),this.createFeatureHandle?.remove(),this.columnMenuHandle?.remove(),this.attachmentsViewOptionsHandle?.remove(),this.columnSortOrderHandle?.remove(),this.columnReorderHandle?.remove(),this.attributeTableTemplateHandle?.remove(),this.relatedAttributeTableTemplateHandles.forEach((e=>e?.remove())),this.showAllTablesHandle?.remove(),this.relatedTablesHandle?.remove()}static get assetsDirs(){return["assets"]}get el(){return(0,a.g)(this)}};h.style=":host {\n  width: 100%;\n}\n\n.table {\n  height: 100%;\n}\n\n.content {\n  height: 100%;\n  display: flex;\n}\n\n.non-tabs-manager-action-bar-wrapper {\n  padding: 2px 0px;\n  background-color: var(--calcite-color-foreground-1);\n}\n\n.action-bar {\n  height: 100%;\n  border-width: 0 1px 0 0;\n  border-style: solid;\n  border-color: var(--calcite-color-border-2);\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n\n.tooltip {\n  white-space: nowrap;\n}\n\n.menu-actions {\n  display: inline-flex;\n  justify-self: stretch;\n}\n\n.table-fab {\n  position: absolute;\n  bottom: 24px;\n  left: auto;\n  right: 76px;\n  --calcite-opacity-disabled: 0.8;\n}\n\n.hidden-fab {\n  visibility: hidden;\n}\n\n:dir(rtl) {\n  .action-bar {\n    border-width: 0 0 0 1px;\n  }\n  .table-fab {\n    left: 76px;\n    right: auto;\n  }\n}\n\n.esri-grid .esri-column__header-content calcite-dropdown calcite-dropdown-group {\n  max-width: 300px;\n  overflow-x: auto;\n}\n"},68180:(e,t,i)=>{i.d(t,{a:()=>a,b:()=>g,c:()=>C,d:()=>u,e:()=>h,f:()=>o,g:()=>d,h:()=>w,i:()=>r,j:()=>c,k:()=>p,l:()=>s,m:()=>m,n:()=>f,o:()=>y,p:()=>k,q:()=>T,s:()=>l,t:()=>b});var a,s,l,o,n=i(71480);function r(e){return null!=e}function c(e,t){const i=e.fieldName;if(i.includes(a.expression)){const e=t.get(i);return e?.title?e.title:i}return e.label?e.label:i}async function d(e){return new Map((await async function(e){return await new Promise(((t,i)=>{switch(u(e)){case l.feature:case l.ogcFeature:case l.stream:t(e.fields);break;case l.mapImage:{const a=e,s=a?.layer;s?.portalItem&&s.url.includes("https://demographics")&&s.url.includes(".arcgis.com")?s.portalItem?.fetchData().then((e=>{if(e?.thematicGroup){const i=new Map(a.fields.map((e=>[e.name,e]))),s=e.thematicGroup.fieldNames,l=[];s.forEach((e=>{i.has(e)&&l.push(i.get(e))})),t(l)}else t(a.fields)})).catch((e=>{i(new Error(e))})):t(a.fields);break}case l.imagery:{const i=e;t((i.fields||[]).concat(i.rasterFields||[]));break}case l.imageryTile:case l.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}}))}(e)).filter((e=>e.visible)).map((e=>[e.name,e])))}function h(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach((e=>{const i=`${a.expression}${e.name}`;t.set(i,e)})),t}function u(e){return"map-image"===e?.layer?.type?l.mapImage:"subtype-sublayer"===e?.type?l.subtype:"tile"===e?.layer?.type?l.tile:"scene"===e?.type?l.scene:"ogc-feature"===e?.type?l.ogcFeature:"imagery"===e?.type?l.imagery:"imagery-tile"===e?.type?l.imageryTile:"wfs"===e?.type?l.wfs:"wcs"===e?.type?l.wcs:"wms"===e?.layer?.type?l.wms:"csv"===e?.type?l.csv:"geojson"===e?.type?l.geojson:"stream"===e?.type?l.stream:"oriented-imagery"===e?.type?l.orientedImagery:"catalog"===e?.type?l.catalog:"catalog-footprint"===e?.type?l.catalogFootprint:"knowledge-graph-sublayer"===e?.type?l.knowledgeGraphSublayer:"voxel"===e?.type?l.voxel:l.feature}function m(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function p(e){return Number((100*(1-e)).toFixed(1))}function b(e){return Number((1-e/100).toFixed(3))}!function(e){e.expression="expression/",e.raster="Raster.",e.relationship="relationships/"}(a||(a={})),function(e){e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes"}(s||(s={})),function(e){e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms"}(l||(l={})),function(e){e.bigInteger="big-integer",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset"}(o||(o={}));const f=(e,t)=>{const i=[];return e?.fieldInfos?.forEach((e=>{e.fieldName?.includes(a.expression)?t&&i.push({name:e.fieldName.slice(a.expression.length),alias:e.fieldName.slice(a.expression.length),type:"string"}):i.push({name:e.fieldName,alias:e.label,type:"string"})})),i},g=async(e,t)=>{const[i,a]=await Promise.all([(0,n.g)(),(0,n.h)()]),s=new a;s.geometry=t.extent,s.mapExtent=t.extent,s.returnGeometry=!0,s.tolerance=6,s.layerOption="popup",s.width=t.width,s.height=t.height,s.layerIds=[e.id];const l=(await i.identify(e.layer.url,s))?.results,o=l?.[0]?.feature;return o},y=async(e,t,i)=>{const a=await e.whenLayerView(t),s=await a.queryAggregates();return await v(i,s.features?.[0])},v=async(e,t)=>{const i=await(0,n.j)(),a=await(0,n.k)();let s;if(t)s=t.clone();else{s=new i;const t=f(e,!1);if(t?.length){const e={};t.forEach((t=>{e[t.name]=""})),s.attributes=e}const l=new a;s.geometry=l}return s};function T(e,t){const i=t.startsWith("#"),a=t.startsWith(".");for((a||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(a){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function C(e){if(u(e)===l.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(u(e)===l.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find((t=>{if(t.id===e.id)return t}))?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function w(e,t,i){let a="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))a="number";else if(t.has(e)){const i=t.get(e);a=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);a=t.returnType?t.returnType.toLowerCase():""}else a="number";return a}async function k(e,t){return"feature"!==e.type||e.url?"feature"===e.type||"csv"===e.type||"scene"===e.type||"wfs"===e.type||"geojson"===e.type||"oriented-imagery"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"catalog"===e.type||"catalog-footprint"===e.type?await e.queryFeatureCount():!t||"stream"!==e.type&&"ogc-feature"!==e.type?await Promise.reject(new Error(`Can't get feature count for layer of type ${e.type}.`)):await async function(e,t){const i=await t.whenLayerView(e);return await i.queryFeatureCount()}(e,t):await async function(e){const t=e.createQuery();t.outFields=["*"];const i=await e.queryFeatures(t);if(i.features?.length)return i.features.length;throw new Error("could not get feature count")}(e)}},58325:(e,t,i)=>{i.d(t,{a:()=>s,d:()=>a,t:()=>l});const a=(e,t)=>{let i,a="idle";const s=async(...s)=>await new Promise((l=>{switch(a){case"flushed":a="idle",i?(clearTimeout(i),l(e(...s))):l(null);break;case"invoked":clearTimeout(i),a="idle",l(e(...s));break;case"cancelled":clearTimeout(i),a="idle",l(null);break;default:i&&clearTimeout(i),a="pending",i=setTimeout((()=>{a="idle",l(e(...s))}),t)}}));return s.flush=async function(...e){return a="flushed",await s(...e)},s.invoke=async function(...e){return a="invoked",await s(...e)},s.cancel=async function(...e){return a="cancelled",await s(...e)},s.getStatus=function(){return a},s},s=(e,t)=>{let i;return async(...a)=>await new Promise((s=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,s(e(...a))}),t))}))};function l(e){return new Promise((t=>setTimeout(t,e)))}},38967:(e,t,i)=>{var a;i.d(t,{S:()=>a,a:()=>n,e:()=>d,g:()=>c,i:()=>o,r:()=>r,s:()=>l}),function(e){e.SMALL="s",e.MEDIUM="m",e.LARGE="l"}(a||(a={}));const s=["feature","oriented-imagery","map-image"],l=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint"];function o(e,t){for(;e;){if(e.nodeName===t.toUpperCase())return!0;e=e.parentElement}return!1}function n(e,t){const i=document.createElement("calcite-tooltip");i.className="table-tooltip",i.referenceElement=e,i.placement="trailing-start",i.open=!0;const a=document.createElement("div");a.className="tooltip",a.innerHTML=t,i.append(a),document.body.append(i)}function r(){document.querySelectorAll(".table-tooltip").forEach((e=>e.parentNode?.removeChild(e)))}function c(e){return[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap((e=>e.templates)):[]]}function d(e){return(s.includes(e.type)||"sublayer"===e.type&&s.includes(e.layer.type))&&function(e){if(!e?.capabilities)return!1;const{capabilities:{data:{supportsAttachment:t},operations:{supportsQueryAttachments:i}}}=e;return t&&i}(e)}},42444:(e,t,i)=>{function a(e,t){if(!e||!t)return;let i=t.assetsPath;i.endsWith("/")||(i+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${i}esri/themes/light/main.css" />`)}i.d(t,{i:()=>a})},50063:(e,t,i)=>{i.d(t,{u:()=>l});var a=i(97127),s=i(28614);const l=(0,a.m)(s.a)}}]);