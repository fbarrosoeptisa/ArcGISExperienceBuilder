/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-0c2f1d.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-0c2f1d"],{65514:(e,t,s)=>{s.r(t),s.d(t,{arcgis_delete_folder:()=>D,arcgis_delete_items:()=>C,arcgis_item_category_schema_editor:()=>f});var i=s(19564),a=s(4948),l=s(89261),r=s(66507),o=s(96295),n=s(44508),c=s(57159),d=s(18991),h=s(31171),m=s(93863),u=s(24211),g=s(80015);s(98034),s(99004),s(91102),s(73807),s(65174),s(5011),s(67336),s(82297),s(5076);const p=async(e,t)=>(0,c.r)(`${e.userContentUrl}/${t.id}`);async function y(e,t,s,i){try{const a=`${(0,n.g)(e)}search`;return{result:(await(0,c.r)(a,{q:`owner:${t.username} ownerfolder:${s.id} ${i||""}`,num:1})).total}}catch(e){return{result:0}}}const D=class{constructor(e){(0,i.r)(this,e),this.arcgisDeleteFolderClose=(0,i.c)(this,"arcgisDeleteFolderClose",7),this.arcgisDeleteFolderSuccess=(0,i.c)(this,"arcgisDeleteFolderSuccess",7),this.arcgisDeleteFolderFail=(0,i.c)(this,"arcgisDeleteFolderFail",7),this.updateItems=async()=>{var e;const t=await p(null!==(e=this.user)&&void 0!==e?e:a.c.user,this.folder);this.items=t.items},this.renderMessage=()=>{var e;const{i18n:t,folder:s,mode:a,folderTotal:r,portal:o,lang:n,items:c}=this,{text:d,description:h}=(null===(e=null==o?void 0:o.sourceJSON)||void 0===e?void 0:e.recycleBinEnabled)?(()=>{let e="",i="";switch(a){case"UNPROTECTED":e=t.message.recycleAll.replace("${title}",s.title);break;case"UNRECYCLABLE":case"UNRECYCLABLE_UNPROTECTED":e=t.message.canBeEmptied.replace("${title}",s.title);break;case"PROTECTED_UNRECYCLABLE":case"PROTECTED_UNPROTECTED":case"PROTECTED_UNRECYCLABLE_UNPROTECTED":e=t.message.mustBeEmpty.replace("${title}",s.title),i=t.message.aFewCannotBeDeleted;break;case"PROTECTED":e=t.message.cannotBeDeleted.replace("${title}",s.title)}return{text:e,description:i}})():(()=>{let e="";if("PROTECTED"===a)e=t.message.cannotBeDeleted.replace("${title}",s.title);else e=(0,l.f)(n,t.disabledMessage,r||(null==c?void 0:c.length)||0,{label:s.title});return{text:e,description:null}})();return(0,i.h)(i.F,null,d&&(0,i.h)("p",{innerHTML:d}),h&&(0,i.h)("p",null,h))},this.handlePostDeleteItems=async()=>{var e;0===(await p(null!==(e=this.user)&&void 0!==e?e:a.c.user,this.folder)).total?await this.handleDeleteFolder():this.arcgisDeleteFolderFail.emit(this.i18n.deleteProtectedItemsInFolder)},this.handleDeleteFolder=async()=>{var e;(await(async(e,t,s)=>{const i=`${(null!=s?s:t.user).userContentUrl}/${e.id}/delete`;return await(0,c.r)(i,{},{},"post")})(this.folder,this.portal,null!==(e=this.user)&&void 0!==e?e:a.c.user)).success&&this.arcgisDeleteFolderSuccess.emit(this.i18n.success.replace("${title}",this.folder.title))},this.portal=void 0,this.user=void 0,this.folder=void 0,this.active=!0,this.mode=void 0,this.items=void 0}async componentWillLoad(){var e,t;const s=await(0,r.g)(this.el);this.i18n=s[0],this.lang=s[1];const i=null!==(e=this.user)&&void 0!==e?e:a.c.user,l=null!==(t=this.portal)&&void 0!==t?t:a.c.portal;this.isEmpty=(await async function(e,t,s){return{result:0===(await y(e,t,s)).result}}(l,i,this.folder)).result,this.folderTotal=(await async function(e,t,s){return{result:(await y(e,t,s,o.H)).result}}(l,i,this.folder)).result,this.updateItems()}render(){var e;const{portal:t,user:s,active:a,i18n:l,folder:r,items:o,mode:n,isEmpty:c}=this;if(r)return c?(0,i.h)("calcite-modal",{widthScale:"s",open:a,kind:"danger",onCalciteModalClose:()=>this.arcgisDeleteFolderClose.emit()},(0,i.h)("div",{slot:"header"},l.deleteFolder),(0,i.h)("div",{slot:"content",innerHTML:l.message.empty.replace("${title}",r.title)}),(0,i.h)("calcite-button",{slot:"secondary",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>{this.arcgisDeleteFolderClose.emit(),this.active=!1},width:"full"},l.cancel),(0,i.h)("calcite-button",{slot:"primary",appearance:"solid",kind:"danger","data-id":"nextButton",onClick:async()=>{await this.handleDeleteFolder(),this.active=!1},width:"full"},l.delete)):(0,i.h)("arcgis-delete-items",{items:o,portal:t,user:s,active:a,showSelectedItemsCount:!1,primaryBucket:"protectedItems",allowPermanentlyDeleteDeselect:!1,showConfirmDeleteMessage:"PROTECTED"===n&&(null===(e=null==t?void 0:t.sourceJSON)||void 0===e?void 0:e.recycleBinEnabled),closeOnConfirm:!1,onArcgisDeleteItemsModeChange:e=>{this.mode=e.detail},onArcgisDeleteItemsClose:()=>{this.arcgisDeleteFolderClose.emit(),this.active=!1},onArcgisDeleteItemsDelete:async()=>{await this.handlePostDeleteItems(),this.active=!1}},(0,i.h)("div",{slot:"header"},l.deleteFolder),(0,i.h)("div",{slot:"message"},this.renderMessage()))}get el(){return(0,i.d)(this)}},C=class{constructor(e){(0,i.r)(this,e),this.arcgisDeleteItemsDelete=(0,i.c)(this,"arcgisDeleteItemsDelete",7),this.arcgisDeleteItemsError=(0,i.c)(this,"arcgisDeleteItemsError",7),this.arcgisDeleteItemsClose=(0,i.c)(this,"arcgisDeleteItemsClose",7),this.arcgisDeleteItemsModeChange=(0,i.c)(this,"arcgisDeleteItemsModeChange",7),this.compositeItemsTotal=0,this.additionalCompositeItemsTotal=0,this.deletePrimaryAction="RECYCLE",this.headerTitle="",this.configurePermanentlyDeleteOverrideUI=()=>{var e;const{i18n:t}=this;this.headerTitle=t.permanentlyDelete,this.primaryButtonText=t.permanentlyDelete,this.deleteMode="UNRECYCLABLE",this.permanentDeleteOverrideEnabled=!0,null===(e=this.modalRef)||void 0===e||e.setFocus()},this.renderContent=()=>{var e,t;const{portal:s,items:a,inRecycleBin:l,deleteItemsBuckets:r,deleteMode:o,deletePrimaryAction:n,permanentDeleteOverrideEnabled:c,configurePermanentlyDeleteOverrideUI:d,showConfirmDeleteMessage:h,allowPermanentlyDeleteDeselect:m}=this;return(0,i.h)(i.F,null,(0,i.h)("slot",{name:"message"}),this.showCompositeDisclaimer?(0,i.h)("arcgis-delete-items-composite-disclaimer",{buckets:this.deleteItemsBuckets,additionalDependentItemsTotal:this.additionalCompositeItemsTotal}):(null!==(t=null===(e=s.sourceJSON)||void 0===e?void 0:e.recycleBinEnabled)&&void 0!==t?t:s.recycleBinEnabled)&&!l?(0,i.h)("arcgis-delete-items-recycle",{items:a,buckets:r,mode:o,primaryAction:n,primaryBucket:this.primaryBucket,allowPermanentlyDeleteDeselect:m,permanentlyDeleteOverridden:c,disableLinks:this.disableLinks,onArcgisDeleteItemsPermanentlyDeleteOverride:()=>{d()},onArcgisDeleteItemsPermanentlyDeleteBucketToggle:({detail:e})=>{this.preventNonRecyclableItemDelete=e},showSelectedItemsCount:this.showSelectedItemsCount}):h?(0,i.h)("arcgis-delete-items-permanent",{buckets:r,mode:o}):null)},this.handleDelete=async()=>{var e,t;this.isLoading=!0;const{unprotectedItems:s,unrecyclableItems:i}=this.deleteItemsBuckets,a=s.map((e=>e.item)),l=i.map((e=>e.item));let r=[],o=[],n=[];const c=e=>e+this.compositeItemsTotal;try{if(this.permanentDeleteOverrideEnabled||this.inRecycleBin){const e=[...a];!this.preventNonRecyclableItemDelete&&e.push(...l),r=await this.deleteItems(e,!0)}else{const e=[...a,...l];n=e.length>0?await this.deleteItems(e):[]}for(const e of n)a.some((t=>t.id===e.itemId))?o.push(e):l.some((t=>t.id===e.itemId))&&r.push(e);const e=(0,h.s)({deletedItems:o,permanentlyDeletedItems:r}),t={deletedItems:[...e.successes.filter((e=>!e.permanentDelete))],permanentlyDeletedItems:[...e.successes.filter((e=>e.permanentDelete))],deletedItemsCount:o.length>0?c(o.length):0,permanentlyDeletedItemsCount:r.length>0?c(r.length):0};e.successes.length>0&&this.arcgisDeleteItemsDelete.emit(t);const{errors:s}=e;s.length>0&&this.arcgisDeleteItemsError.emit(s),this.closeOnConfirm&&(this.active=!1)}catch(s){this.arcgisDeleteItemsError.emit({messageCode:null!==(t=null===(e=s.details)||void 0===e?void 0:e.messageCode)&&void 0!==t?t:"unknown"}),this.isLoading=!1}},this.deleteItems=async(e,t=!1)=>1===e.length?[await(0,h.d)(e[0],this.portal,t)]:(await(0,h.a)(e,this.portal,t)).results,this.user=void 0,this.portal=void 0,this.items=[],this.inRecycleBin=void 0,this.active=void 0,this.showSelectedItemsCount=!0,this.showConfirmDeleteMessage=!0,this.allowPermanentlyDeleteDeselect=!0,this.disableLinks=void 0,this.primaryBucket="unrecyclableItems",this.closeOnConfirm=!0,this.allowDiscouraged=void 0,this.store=(0,d.c)({}),this.deleteItemsBuckets={unrecyclableItems:[],unprotectedItems:[],protectedItems:[],selectedCompositeItems:[]},this.permanentDeleteOverrideEnabled=!1,this.showCompositeDisclaimer=!1,this.isLoading=!1,this.preventNonRecyclableItemDelete=!1}async componentWillLoad(){const e=await(0,r.g)(this.el);this.i18n=e[0],this.store.state.i18n=this.i18n,this.store.state.portal=this.portal,this.store.state.locale=(0,r.a)(this.el),this.determineDeleteState()}async handleItemUpdate(){this.determineDeleteState({fetch:!0})}async determineDeleteState(e={fetch:!0}){const{fetch:t}=e;try{if(this.inRecycleBin)return this.deleteMode="UNRECYCLABLE",this.deletePrimaryAction="PERMANENTLY_DELETE",this.primaryButtonText=this.i18n.permanentlyDelete,this.headerTitle=this.i18n.permanentlyDelete,void(this.deleteItemsBuckets.unrecyclableItems=this.items.map((e=>({item:e}))));t&&(this.isLoading=!0,this.deleteItemsBuckets=Object.assign({},await(0,h.b)(this.items,this.portal,this.allowDiscouraged)),this.compositeItemsTotal=this.countDependentItems(),this.additionalCompositeItemsTotal=this.compositeItemsTotal-this.deleteItemsBuckets.selectedCompositeItems.length,this.showCompositeDisclaimer=this.additionalCompositeItemsTotal>0,this.isLoading=!1),this.deleteMode=(0,h.c)(this.deleteItemsBuckets),this.arcgisDeleteItemsModeChange.emit(this.deleteMode),this.deletePrimaryAction=(0,h.e)(this.deleteMode),this.primaryButtonText=this.i18n["PERMANENTLY_DELETE"===this.deletePrimaryAction?"permanentlyDelete":"delete"],this.headerTitle=this.i18n["PERMANENTLY_DELETE"===this.deletePrimaryAction?"permanentlyDelete":(0,h.i)(this.deleteItemsBuckets.unprotectedItems)||1!==this.items.length?"deleteItems":"deleteItem"]}catch(e){console.error(e)}}countDependentItems(){const{unprotectedItems:e}=this.deleteItemsBuckets;return e.reduce(((e,t)=>{var s,i,a,l;return e+(null!==(l=(null===(s=t.relatedItems)||void 0===s?void 0:s.isComposite)&&(null===(a=null===(i=t.relatedItems)||void 0===i?void 0:i.resultData)||void 0===a?void 0:a.count))&&void 0!==l?l:0)}),0)}renderDeleteButton(){const{isLoading:e,i18n:t,primaryButtonText:s}=this;return(0,i.h)("calcite-button",{slot:"footer-end",appearance:"solid",kind:"danger","data-id":"nextButton",onClick:async()=>this.handleDelete(),disabled:e||"PROTECTED_UNRECYCLABLE"===this.deleteMode&&this.preventNonRecyclableItemDelete},null!=s?s:t.delete)}renderCompositeDisclaimerNextButton(){const{isLoading:e,i18n:t}=this;return(0,i.h)("calcite-button",{slot:"footer-end",appearance:"solid",kind:"brand","data-id":"nextButton",onClick:async()=>this.showCompositeDisclaimer=!1,disabled:e},t.next)}render(){const{i18n:e,active:t,isLoading:s,headerTitle:a,deletePrimaryAction:l,permanentDeleteOverrideEnabled:r,additionalCompositeItemsTotal:o,showCompositeDisclaimer:n,renderContent:c}=this,d=r||!n&&o>0;return(0,i.h)("calcite-dialog",{key:"2f6e3ba79ca34eeaf00dfb57d2997cab9ad1e72b",modal:!0,open:t,widthScale:"s",kind:n?"info":"danger",outsideCloseDisabled:!0,ref:e=>this.modalRef=e,heading:a,onCalciteDialogClose:()=>{this.arcgisDeleteItemsClose.emit(),this.active=!1}},(0,i.h)("div",{key:"e222993b3d98c5fa9a422f66e25f05ee05d98e7e",class:"content"},s?(0,i.h)("calcite-scrim",{loading:!0}):c()),!s&&(0,i.h)(i.F,{key:"e40492b35febf67c62fe26ee8119660d6caeb81d"},(0,i.h)("div",{key:"9b7bf4bd97ca8eaabfacf9157e9518095f9f4013",slot:"footer-start"},d&&(0,i.h)("calcite-button",{key:"d9f6760338073d05c949e046dfc3a24400964e06",appearance:"outline-fill",kind:"neutral","data-id":"backButton",onClick:()=>{r?(this.permanentDeleteOverrideEnabled=!1,this.determineDeleteState({fetch:!1})):this.showCompositeDisclaimer=!0},disabled:s},e.back)),(0,i.h)("calcite-button",{key:"9a66069f70c4f73763a3829737c434da0005cfd1",slot:"footer-end",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>{this.active=!1}},e.cancel),"NONE"!==l&&(this.showCompositeDisclaimer?this.renderCompositeDisclaimerNextButton():this.renderDeleteButton())))}get el(){return(0,i.d)(this)}static get watchers(){return{items:["handleItemUpdate"]}}};C.style=".content{display:flex;min-height:72px;flex-direction:column;justify-content:center}::slotted([slot=message]){margin-bottom:1rem}";const f=class{constructor(e){(0,i.r)(this,e),this.workflowCancel=(0,i.c)(this,"workflowCancel",7),this.newSchemaWorkflowComplete=(0,i.c)(this,"newSchemaWorkflowComplete",7),this.deleteAllSchema=(0,i.c)(this,"deleteAllSchema",7),this.getCategorySchema=()=>{const{user:e,portal:t,group:s}=this;return(0,m.g)({user:e,portal:t,group:s})},this.getCategoryAggregation=()=>{const{user:e,portal:t,group:s}=this;return(async(e,t,s)=>{const i=s?`${(0,n.g)(t)}/content/groups/${s.id}/`:`${(0,n.g)(t)}`,a=s?{q:o.H,countFields:"access,contentstatus,groupCategories"}:{q:`orgid:${e.orgId} ${o.H}`,countFields:"categories"};try{const{aggregations:e}=await(0,c.r)(`${i}search`,Object.assign(Object.assign({},a),{countSize:200,num:0,f:"json"}));return{result:s?e.counts.find((({fieldName:e})=>"groupCategories"===e)):e.counts[0]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(e,t,s)},this.updateSchema=e=>{const{portal:t,group:s}=this;return(async({portal:e,group:t,categorySchema:s})=>{try{const i=t?(0,g.a)(e,t):`${(0,n.g)(e)}/portals/${e.id}/`;return await(0,c.r)(`${i}assignCategorySchema`,{categorySchema:JSON.stringify({categorySchema:s})},{},"post"),{}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})({portal:t,categorySchema:e,group:s})},this.deleteSchema=()=>{const{portal:e,group:t}=this;return(async(e,t)=>{try{const s=t?(0,g.a)(e,t):`${(0,n.g)(e)}/portals/${e.id}/`;return await(0,c.r)(`${s}deleteCategorySchema`,{},{},"post"),{}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(e,t)},this.updateSchemaFromPath=({path:e,updateInfo:t})=>{const{portal:s,group:i}=this;return(0,m.e)({path:e,portal:s,updateInfo:t,group:i})},this.getStandardSetCategories=()=>{const{portal:e}=this;return(async e=>{try{const[{categorySchema:t},{categorySchema:s},{categorySchema:i}]=await Promise.all([(0,m.a)(e,"LivingAtlas"),(0,m.a)(e,"Inspire"),(0,m.a)(e,"ISO")]);return{result:{LivingAtlas:t,Inspire:s,ISO:i}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(e)},this.user=void 0,this.portal=void 0,this.config=void 0,this.group=void 0,this.isActive=void 0,this.rootCategoryTitle=void 0}async componentWillLoad(){const e=await(0,r.g)(this.el);this.i18n=e[0]}render(){const{user:e,portal:t,config:s,i18n:a,isActive:l,group:r,getCategorySchema:o,getCategoryAggregation:n,updateSchema:c,deleteSchema:d,updateSchemaFromPath:h,getStandardSetCategories:m}=this,g=Boolean(!(0,u.b)(this.user)||this.group),p=r?a.modalGroupHeader:a.modalHeader,y=r?a.helpTextGroup:a.helpText,D=r?a.helpTextGroupDescription:a.helpTextDescription,C=a.template.templateList.custom[r?"messageGroup":"message"];return(0,i.h)("arcgis-category-schema-editor",{key:"4e2a278f4c505a2a848ad007f436675ddcb17b27",user:e,portal:t,config:s,isActive:l,canFetchCategories:g,dialogHeading:p,noticeTitle:y,noticeDescription:D,customTemplateDescriptionText:C,deleteConfirmMessage:a.warning.deleteInUseCategory.message,changeTitleConfirmMessage:a.warning.changeTitleInUseCategory.message,getCategorySchema:o,getCategoryAggregation:n,updateSchema:c,deleteSchema:d,updateSchemaFromPath:h,getStandardSetCategories:m,onWorkflowCancel:e=>{this.workflowCancel.emit(e.detail)},onNewSchemaWorkflowComplete:e=>{this.newSchemaWorkflowComplete.emit(e.detail)},onDeleteAllSchema:()=>{this.deleteAllSchema.emit()}})}get el(){return(0,i.d)(this)}};f.style=".stage{height:100%;--tw-translate-x:0px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));overflow:hidden;display:flex}.modal{--calcite-dialog-content-space:0;--calcite-dialog-size-x:48rem;--calcite-dialog-size-y:90vh;--calcite-dialog-background-color:var(--calcite-color-background)}.modal--large{--calcite-dialog-size-x:1080px}.template-container{overflow:auto;width:20rem;padding:1rem}.template-title{margin-top:0px;margin-bottom:0px;margin-bottom:1rem;font-size:1.125rem}.template-link{font-size:0.75rem}.inner-container{overflow:auto;box-sizing:border-box;width:100%;padding:2rem}.inner-container--new-category{padding-inline-start:0.5rem;padding:1rem}.help-text{margin-bottom:0.75rem}.confirm-modal{--calcite-modal-width:32rem;--calcite-modal-height:auto}.confirm-modal-content{padding:1rem}"},96295:(e,t,s)=>{s.d(t,{H:()=>i,R:()=>a});const i='-typekeywords:("MapAreaPackage") -type:("Map Area" OR "Indoors Map Configuration" OR "Code Attachment")',a="Indoors Map Configuration,Code Attachment"}}]);