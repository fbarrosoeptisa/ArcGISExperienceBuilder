/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-member--6fa22e.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-member--6fa22e"],{29797:(e,t,r)=>{r.r(t),r.d(t,{arcgis_member_category_schema_editor:()=>g});var o=r(19564),n=r(93863),i=r(44508),a=r(57159),s=r(29259),c=r(66507),l=r(24211);r(4948),r(18991),r(80015),r(98034),r(99004),r(65174),r(91102),r(73807),r(89261),r(67336);const u=async({path:e,portal:t,updateInfo:r})=>{try{const o=(await d({category:e,portal:t,num:1})).total;if(0===o)return console.warn(`No items found with category ${e} when updating schema`),{};const n=100,c=Math.ceil(o/n),l=[];for(let o=0;o<c;o++)l.push(d({category:e,portal:t,start:o*n,num:n}).then((({results:t})=>{const o={};return t.forEach((t=>{const n="change-title"===r.type?t.categories.map((t=>{const o=(0,s.a)(e,r.newTitle);return t===e?o:t.replace(`${e}/`,`${o}/`)})):t.categories.filter((t=>!t.startsWith(e)));o[t.username]=n})),o})));const u=await Promise.all(l);let g={};return u.forEach((e=>{g=Object.assign(Object.assign({},g),e)})),await Promise.all(Object.keys(g).map((e=>async function({categories:e,username:t,portal:r}){try{const o=`${(0,i.g)(r)}community/users/${t}/update`;return{result:await(0,a.r)(o,{categories:JSON.stringify(e)},{},"post")}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}({categories:g[e],username:e,portal:t})))),{}}catch(t){return console.error(`Error ${r.type} items schema from path ${e}:`,t),{error:{code:"unhandledError"}}}};const d=({category:e,portal:t,start:r,num:o})=>{const n={start:r,num:o,categories:JSON.stringify([e])};return(0,a.r)(`${(0,i.g)(t)}portals/${t.id}/users/search`,n)},g=class{constructor(e){(0,o.r)(this,e),this.workflowCancel=(0,o.c)(this,"workflowCancel",7),this.newSchemaWorkflowComplete=(0,o.c)(this,"newSchemaWorkflowComplete",7),this.deleteAllSchema=(0,o.c)(this,"deleteAllSchema",7),this.arcgisMemberCategoryEditorRowWarningClick=(0,o.c)(this,"arcgisMemberCategoryEditorRowWarningClick",7),this.getCategorySchema=()=>{const{portal:e,user:t}=this;return(0,n.d)({portal:e,user:t})},this.getCategoryAggregation=()=>{const{portal:e}=this;return(async e=>{const t=`${(0,i.g)(e)}/portals/${e.id}/users/`,r={q:`orgid:${e.id}`,countFields:"categories"};try{const{aggregations:e}=await(0,a.r)(`${t}search`,Object.assign(Object.assign({},r),{countSize:200,num:0,f:"json"}));return{result:e.counts[0]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(e)},this.getDisabledWarning=e=>{const{defaultMemberCategories:t,i18n:r}=this;if(t.some((t=>{const r=t.toLowerCase();return r===e||r.includes(`${e}/`)})))return r.defaultCategoryWarning},this.updateSchema=e=>{const{portal:t}=this;return(async({categorySchema:e,portal:t})=>{try{const r=`${(0,i.g)(t)}portals/${t.id}/assignMemberCategorySchema`;return await(0,a.r)(r,{memberCategorySchema:JSON.stringify({memberCategorySchema:e})},{},"post"),{}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})({categorySchema:e,portal:t})},this.deleteSchema=()=>{const{portal:e}=this;return(async e=>{try{const t=`${(0,i.g)(e)}/portals/${e.id}/deleteMemberCategorySchema`;return await(0,a.r)(t,{},{},"post"),{}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(e)},this.updateSchemaFromPath=({path:e,updateInfo:t})=>{const{portal:r}=this;return u({path:e,updateInfo:t,portal:r})},this.user=void 0,this.portal=void 0,this.config=void 0,this.defaultMemberCategories=[],this.isActive=void 0}handleRowWarningClick(){this.arcgisMemberCategoryEditorRowWarningClick.emit()}async componentWillLoad(){const e=await(0,c.g)(this.el);this.i18n=e[0]}render(){const{user:e,portal:t,config:r,i18n:n,isActive:i,getDisabledWarning:a,getCategorySchema:s,getCategoryAggregation:c,updateSchema:u,deleteSchema:d,updateSchemaFromPath:g}=this,m=!(0,l.b)(e);return(0,o.h)("arcgis-category-schema-editor",{key:"3b47c6613cea966c36f7d116aa99f8b326c90650",user:e,portal:t,config:r,isActive:i,canFetchCategories:m,dialogHeading:n.dialogHeading,noticeTitle:n.noticeTitle,noticeDescription:n.noticeDescription,deleteConfirmMessage:n.warning.deleteInUseCategory.message,changeTitleConfirmMessage:n.warning.changeTitleInUseCategory.message,getDisabledWarning:a,getCategorySchema:s,getCategoryAggregation:c,updateSchema:u,deleteSchema:d,updateSchemaFromPath:g,onWorkflowCancel:e=>{this.workflowCancel.emit(e.detail)},onNewSchemaWorkflowComplete:e=>{this.newSchemaWorkflowComplete.emit(e.detail)},onDeleteAllSchema:()=>{this.deleteAllSchema.emit()}})}get el(){return(0,o.d)(this)}}},67336:(e,t,r)=>{r.d(t,{a:()=>s,b:()=>a,c:()=>u,d:()=>d,e:()=>g,f:()=>p,g:()=>$,h:()=>v,i:()=>c,j:()=>w,k:()=>C,l:()=>y,m:()=>b,n:()=>S,o:()=>h,p:()=>f,q:()=>m,u:()=>l});var o=r(98034),n=r(44508);function i(e){var t;return!!(null===(t=e.owner)||void 0===t?void 0:t.toLowerCase().includes("esri"))}function a(e){var t;return i(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Credits"))}function s(e){var t;return i(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Subscription"))}function c(e,t){return e.owner===t.username}function l(e,t){return c(e,t)||function(e,t){var r;if(null!=e.isAdmin)return!!e.isAdmin;const o=e.owner,n="admin"===e.itemControl,i=["esri_livingatlas","esri_demographics","esri_boundaries"];if((null===(r=e.portal)||void 0===r?void 0:r.isPortal)&&!c(e,t)&&n&&o.includes("esri_")&&!i.includes(o))return!1;return n}(e,t)}const u=(e,t)=>!!t.orgId&&e.every((e=>e.isOrgItem)),d=(e,t)=>`${(0,n.a)(t)}item.html?id=${e}`,g=(e,t)=>`${(0,n.g)(t)}/content/users/${e}`,m=e=>e.reduce(((e,t)=>(e[t.owner]=e[t.owner]?[...e[t.owner],t.id]:[t.id],e)),{});function h(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Spatiotemporal")}function p(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("View Service")}function v(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Hosted Service")}function y(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Multi Services View")}function f(e){return(null==e?void 0:e.hasViews)&&!e.sourceSchemaChangesAllowed}async function w(e){var t;const r=null==e?void 0:e.portalItem;if(!r)return Promise.resolve(null);const i=r.portal,[a]=await(0,o.l)(["esri/request"]);if(null==i?void 0:i.user){return a(`${(0,n.g)(i)}community/users/${i.user.username}`,{query:{f:"json",token:null===(t=r.portal.credential)||void 0===t?void 0:t.token},responseType:"json"}).then((e=>{var t,r;const o=null!==(r=null===(t=e.data)||void 0===t?void 0:t.groups)&&void 0!==r?r:[];return Promise.resolve(o)}),(()=>Promise.reject()))}return Promise.resolve(null)}async function C(e){var t;const r=null==e?void 0:e.portalItem;if(!r)return Promise.resolve(null);const i=r.portal,[a]=await(0,o.l)(["esri/request"]);return a(`${(0,n.g)(i)}content/items/${r.id}/groups`,{query:{f:"json",token:null===(t=r.portal.credential)||void 0===t?void 0:t.token},responseType:"json"}).then((e=>{var t,r,o,n,i,a;const s=[...null!==(r=null===(t=e.data)||void 0===t?void 0:t.admin)&&void 0!==r?r:[],...null!==(n=null===(o=e.data)||void 0===o?void 0:o.member)&&void 0!==n?n:[],...null!==(a=null===(i=e.data)||void 0===i?void 0:i.other)&&void 0!==a?a:[]];return Promise.resolve(s)}),(()=>Promise.reject()))}async function S(e,t,{relationshipType:r,direction:i}){const a=`${(0,n.g)(t)}content/items/${e}/relatedItems`,[s]=await(0,o.l)(["esri/request"]);return await s(a,{query:{f:"json",relationshipType:r,direction:i},method:"get",responseType:"json"})}function b(e,t){return null==e?void 0:e.some((e=>null==t?void 0:t.some((t=>e.id===t.id&&e.capabilities.includes("updateitemcontrol")))))}const $=(e,t)=>`${(0,n.a)(t)}content/items/${e}`}}]);