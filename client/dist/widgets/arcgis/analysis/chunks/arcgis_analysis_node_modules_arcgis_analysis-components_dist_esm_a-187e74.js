"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_analysis-components_dist_esm_a-187e74"],{91895:(e,s,t)=>{t.r(s),t.d(s,{analysis_attribute_expression:()=>i.c,analysis_expression_group:()=>i.b,analysis_query_entry:()=>i.a,analysis_query_target_select:()=>i.A,analysis_spatial_expression:()=>i.d});var i=t(15400);t(12064),t(22069),t(44345),t(55448),t(18423),t(91813),t(21255),t(588),t(54312),t(34031),t(9316),t(61320),t(64016),t(56451),t(6550),t(2924),t(5258),t(52373),t(33752),t(53976),t(49403),t(77462),t(23054),t(73645),t(12762),t(82567),t(28927),t(35970),t(5933),t(57295),t(5294),t(13661),t(35431),t(32513),t(11840),t(440),t(66744),t(23795),t(17902),t(71802),t(36596),t(72349),t(89962),t(97703),t(43284),t(87192),t(46033),t(64872)},15400:(e,s,t)=>{t.d(s,{A:()=>r,a:()=>c,b:()=>m,c:()=>k,d:()=>V});var i=t(12064),a=t(22069),n=t(87192);const r=class{constructor(e){(0,i.r)(this,e),this.analysisQueryTargetSelectChange=(0,i.c)(this,"analysisQueryTargetSelectChange",7),this.onLayerSelectChange=e=>{const s=e.target.selectedOption.value;this.target=this.layers.find((e=>e.id===s))??this.layers[0],this.analysisQueryTargetSelectChange.emit(this.target)},this.target=void 0,this.disabled=!1,this.recordsTerm="features",this.layers=[]}async componentWillLoad(){({strings:this.strings}=await(0,a.d)(this.hostElement,(0,i.a)("."))),void 0===this.target&&(this.target=this.layers[0],this.analysisQueryTargetSelectChange.emit(this.target))}render(){const e="records"===this.recordsTerm?this.strings.recordsLabel:this.strings.featuresLabel;return(0,i.h)(i.H,{key:"1ce83e0913c92d09f9b31749aeb55e8dd5c377b1"},(0,i.h)("calcite-label",{key:"9c9fbad1c4db746fe5867379c9ae4d0df792997d"},e,(0,i.h)("calcite-select",{key:"37be19d7786daa5270e812bfe5487a97202f1006",label:e,onCalciteSelectChange:this.onLayerSelectChange,width:"auto",disabled:this.disabled},this.layers.map((e=>(0,i.h)("calcite-option",{value:e.id,selected:this.target.id===e.id,key:e.id},(0,a.B)(e)))))))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.g)(this)}};r.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex}";const o="inline-container",l="inline-remove-btn",h="section-container",p="section-content",c=class{constructor(e){(0,i.r)(this,e),this.analysisQueryEntryRemove=(0,i.c)(this,"analysisQueryEntryRemove",7),this.onRemoveClick=()=>{this.analysisQueryEntryRemove.emit()},this.kind="group",this.appearance="section"}componentWillLoad(){this.strings=(0,n.g)()}render(){const e="expression"===this.kind?this.strings.removeAttributeExpression:this.strings.removeExpressionGroup;switch(this.appearance){case"inline":return(0,i.h)("div",{class:o},(0,i.h)("slot",null),(0,i.h)("calcite-button",{class:l,kind:"neutral",appearance:"transparent",iconStart:"x",label:e,onClick:this.onRemoveClick,title:e}));case"section":return(0,i.h)("div",{class:h},(0,i.h)("div",{class:p},(0,i.h)("slot",null)),(0,i.h)("calcite-button",{kind:"neutral",appearance:"transparent",iconStart:"x",label:e,onClick:this.onRemoveClick,title:e}))}}};c.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.inline-container{display:flex;margin-bottom:var(--analysis-full-spacing);align-items:center}.inline-remove-btn{margin:0px var(--analysis-quarter-spacing)}.section-container{display:flex;align-items:flex-start;gap:var(--analysis-quarter-spacing);margin-bottom:var(--analysis-full-spacing)}.section-content{flex-grow:1}";const d="add-btns-container",u="error-message",g="group-content-container",y="operator-container",m=class{constructor(e){(0,i.r)(this,e),this.analysisExpressionGroupChange=(0,i.c)(this,"analysisExpressionGroupChange",7),this.onAddSpatialExpressionClick=()=>{this.expressionGroup=this.expressionGroup.addDefaultSpatialExpression(this.expressionGroup.layer,this.layers),this.error=void 0,this.analysisExpressionGroupChange.emit()},this.onAddAttributeExpressionClick=()=>{this.error=void 0,this.expressionGroup=this.expressionGroup.addDefaultExpression(this.options),this.analysisExpressionGroupChange.emit()},this.onOperatorSelect=e=>{this.expressionGroup.operator=e.target.selectedOption.value,this.error=void 0,this.analysisExpressionGroupChange.emit()},this.onAddGroupClick=()=>{this.expressionGroup=this.expressionGroup.addNewGroup(),this.error=void 0,this.analysisExpressionGroupChange.emit()},this.onRemoveChild=(e,s)=>{this.expressionGroup=this.expressionGroup.removeChild(e),this.error=void 0,this.analysisExpressionGroupChange.emit(),s.stopPropagation()},this.onChildExpressionChange=(e,s)=>{this.expressionGroup.children[e]=s.target.expression,this.error=void 0,this.analysisExpressionGroupChange.emit()},this.onChildSpatialExpressionChange=e=>{const s=e.target.spatialExpression;this.expressionGroup=this.expressionGroup.changeSpatialExpression(s),this.analysisExpressionGroupChange.emit()},this.onChildGroupChange=(e,s)=>{this.expressionGroup.children[e]=s.target.expressionGroup,this.analysisExpressionGroupChange.emit(),s.stopPropagation()},this.expressionGroup=void 0,this.mode=void 0,this.allowedExpressions=["attribute","group","spatial"],this.layers=void 0,this.recordsTerm="features",this.options=void 0,this.cache=void 0,this.depth=0,this.error=void 0}componentDidRender(){void 0!==this.spatialExpressionButtonTooltipRef&&null!==this.spatialExpressionButtonTooltipRef&&void 0!==this.addSpatialExpressionButtonRef&&(this.spatialExpressionButtonTooltipRef.referenceElement=this.addSpatialExpressionButtonRef)}get hasError(){return void 0!==this.error}componentWillLoad(){this.strings=(0,n.g)()}render(){const e=this.expressionGroup;return(0,i.h)(i.F,{key:"72550a385ff630eb849ea59f880b077cec2bd1f7"},0===this.depth?(0,i.h)(i.F,null,this.renderOperatorContainer(),void 0!==e.spatialExpression&&this.renderSpatialExpression(),this.renderChildExpressions(),this.renderTopLevelButtons()):void 0===e.spatialExpression?(0,i.h)(i.F,null,(0,i.h)("div",{class:g},this.renderOperatorContainer(),this.renderChildExpressions(),this.renderExpressionDropdown())):(0,i.h)(i.F,null,this.renderSpatialExpression(),this.depth<=2&&(0,i.h)("div",{class:g},e.children.length>0&&this.renderOperatorContainer(),this.renderChildExpressions(),this.renderExpressionDropdown())),(0,i.h)("calcite-input-message",{key:"9efbd6b77520a0e09491496b7519095e89630a78",status:"invalid",class:u,scale:a.U.Scale,hidden:!this.hasError,icon:"exclamationMarkTriangle"},this.error))}renderOperatorContainer(){return(0,i.h)("div",{class:y},(0,i.h)("calcite-label",null,this.strings.where,(0,i.h)("calcite-select",{width:"auto",label:this.strings.groupOperatorSelect,onCalciteSelectChange:this.onOperatorSelect},(0,i.h)("calcite-option",{value:n.a.And,selected:this.expressionGroup.operator===n.a.And},this.strings.andOperatorLabel),(0,i.h)("calcite-option",{value:n.a.Or,selected:this.expressionGroup.operator===n.a.Or},this.strings.orOperatorLabel))))}renderSpatialExpression(){return(0,i.h)("analysis-spatial-expression",{layers:this.layers,spatialExpression:this.expressionGroup.spatialExpression,onAnalysisExpressionChange:e=>this.onChildSpatialExpressionChange(e)})}renderChildExpressions(){return this.expressionGroup.children.map(((e,s)=>e instanceof n.E?(0,i.h)("analysis-query-entry",{kind:"group",appearance:"section",key:e.id,onAnalysisQueryEntryRemove:e=>this.onRemoveChild(s,e)},(0,i.h)("analysis-expression-group",{expressionGroup:e,layers:this.layers,depth:this.depth+1,mode:this.mode,cache:this.cache,allowedExpressions:this.allowedExpressions,options:this.options,onAnalysisExpressionGroupChange:e=>this.onChildGroupChange(s,e)})):(0,i.h)("analysis-attribute-expression",{expression:e,cache:this.cache,target:this.expressionGroup.layer,key:e.id,options:this.options,onAnalysisExpressionChange:e=>this.onChildExpressionChange(s,e),onAnalysisExpressionRemoveClick:e=>this.onRemoveChild(s,e)})))}renderTopLevelButtons(){const e=new Set(this.allowedExpressions);return("analysis"===this.mode&&n.S.getValidSelectingLayers(this.expressionGroup.layer,this.layers).length<1||"sql"===this.mode)&&e.delete("spatial"),(0,i.h)("div",{class:d},(0,i.h)("calcite-button",{disabled:!1===e.has("attribute"),appearance:"outline-fill",kind:"neutral",iconStart:"plus",onClick:this.onAddAttributeExpressionClick},"features"===this.recordsTerm?this.strings.attributeExpression:this.strings.expression),"sql"!==this.mode&&(0,i.h)(i.F,null,(0,i.h)("calcite-button",{disabled:!1===e.has("spatial"),ref:e=>{e&&(this.addSpatialExpressionButtonRef=e)},appearance:"outline-fill",kind:"neutral",iconStart:"plus",onClick:this.onAddSpatialExpressionClick},this.strings.spatialExpression),!1===e.has("spatial")&&(0,i.h)("calcite-tooltip",{referenceElement:this.addSpatialExpressionButtonRef,ref:e=>this.spatialExpressionButtonTooltipRef=e,overlayPositioning:"fixed",placement:"top"},this.strings.spatialExpressionTwoLayers)),(0,i.h)("calcite-button",{disabled:!1===e.has("group"),appearance:"outline-fill",kind:"neutral",iconStart:"group-form-plus",onClick:this.onAddGroupClick},this.strings.expressionGroup))}renderExpressionDropdown(){const e=new Set(this.allowedExpressions);return this.depth>=2&&e.delete("group"),"analysis"===this.mode&&n.S.getValidSelectingLayers(this.expressionGroup.layer,this.layers).length<1&&e.delete("spatial"),(0,i.h)("calcite-dropdown",{widthScale:"m",overlayPositioning:"fixed"},(0,i.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconStart:"plus",iconEnd:"chevron-down"},this.strings.expression),(0,i.h)("calcite-dropdown-group",null,e.has("attribute")&&(0,i.h)("calcite-dropdown-item",{onCalciteDropdownItemSelect:this.onAddAttributeExpressionClick},"features"===this.recordsTerm?this.strings.attributeExpression:this.strings.expression),e.has("spatial")&&(0,i.h)("calcite-dropdown-item",{onCalciteDropdownItemSelect:this.onAddSpatialExpressionClick},this.strings.spatialExpression),e.has("group")&&(0,i.h)("calcite-dropdown-item",{onCalciteDropdownItemSelect:this.onAddGroupClick},this.strings.expressionGroup)))}get hostElement(){return(0,i.g)(this)}};m.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.operator-container{display:flex}.group-content-container{width:calc(100% - 2 * var(--analysis-half-spacing) - 2px);padding:var(--analysis-half-spacing);background-color:var(--calcite-color-background);border:1px solid var(--calcite-color-border-1)}.add-btns-container{display:flex;gap:var(--analysis-quarter-spacing)}.error-message{margin-top:var(--analysis-half-spacing)}";const x="flex-container",v="half-width",f="single-value",C="field-select",b="operator-select",E="value-select",S="value-sm",I="name";const k=class{constructor(e){(0,i.r)(this,e),this.analysisExpressionChange=(0,i.c)(this,"analysisExpressionChange",7),this.analysisExpressionRemoveClick=(0,i.c)(this,"analysisExpressionRemoveClick",7),this.defaultMaxDropdownItems=2e3,this.handleUniqueValuesListChange=e=>{const s=e.detail.selectedValues,t=this.parseStringInput(s[0],this.expression.dataType);this.expression=new n.b(this.expression).changeValue(t),this.analysisExpressionChange.emit(),this.showUniqueValuesPopover=!1},this.onRemoveClick=e=>{this.analysisExpressionRemoveClick.emit(),e.stopPropagation()},this.onFieldSelect=e=>{const s=e.target.selectedOption.value,t=this.fields?.find((e=>e.name===s));void 0!==t&&(this.expression=new n.b(this.expression).changeField(t,this.options),this.loadFieldValues(t.name)),this.analysisExpressionChange.emit()},this.getFieldValuesByUniqueValues=async e=>{const s=`${this.target.id}-${e}`,t=await this.cache.getOrPut((()=>(0,a.ap)({layer:this.target,fieldName:e})),s);return(t?.uniqueValueInfos??[]).map((e=>({value:e.value,count:!0===this.options?.hideUniqueValueCounts?void 0:e.count,label:e.label??`${e.value}`})))},this.onOperatorSelect=e=>{const s=e.target.selectedOption.value;this.expression=new n.b(this.expression).changeOperator(s),this.analysisExpressionChange.emit()},this.onValueInputChange=e=>{const s=e.target.value;this.expression.value=this.parseStringInput(s,this.expression.dataType),this.analysisExpressionChange.emit()},this.onValueComboboxChange=e=>{const s=e.target.value,t=Array.isArray(s)?s[0]:s;this.expression.value=this.parseStringInput(t,this.expression.dataType),this.analysisExpressionChange.emit()},this.onValuesComboboxChange=e=>{(0,n.c)("multi-value"===this.expression.type,"Incorrect render function for expression type.");const s=e.target.value,t=(Array.isArray(s)?s:[s]).map((e=>this.parseStringInput(e,this.expression.dataType)));this.expression.value=t.filter((e=>!1===(0,a.i)(e))),this.analysisExpressionChange.emit()},this.onValueDateChange=()=>{const e=this.parseDateValueFromInputs(this.valueDateInputElement,this.valueTimeInputElement);this.expression.value=e,this.analysisExpressionChange.emit()},this.onDateOnlyRangeChange=e=>{(0,n.c)("range"===this.expression.type,"Incorrect render function for expression type.");const s=e.target.value;this.expression.value=[this.parseStringInput(s[0],"date-only"),this.parseStringInput(s[1],"date-only")],this.analysisExpressionChange.emit()},this.onRangeStartDateChange=()=>{(0,n.c)("range"===this.expression.type,"Incorrect render function for expression type.");const e=this.parseDateValueFromInputs(this.startDateInputElement,this.startTimeInputElement);this.expression.value[0]=e,this.analysisExpressionChange.emit()},this.onRangeEndDateChange=()=>{(0,n.c)("range"===this.expression.type,"Incorrect render function for expression type.");const e=this.parseDateValueFromInputs(this.endDateInputElement,this.endTimeInputElement);this.expression.value[1]=e,this.analysisExpressionChange.emit()},this.onRangeStartInputChange=e=>{(0,n.c)("range"===this.expression.type,"Incorrect render function for expression type.");const s=e.target.value;this.expression.value[0]=this.parseStringInput(s,this.expression.dataType),this.analysisExpressionChange.emit()},this.onRangeEndInputChange=e=>{(0,n.c)("range"===this.expression.type,"Incorrect render function for expression type.");const s=e.target.value;this.expression.value[1]=this.parseStringInput(s,this.expression.dataType),this.analysisExpressionChange.emit()},this.onDistanceInputChange=e=>{(0,n.c)("distance"===this.expression.type,"Incorrect render function for expression type.");const s=e.target.value;this.expression=new n.b(this.expression).changeValue({distance:this.parseStringInput(s,"double"),unit:this.expression.value.unit}),this.analysisExpressionChange.emit()},this.onDistanceUnitChange=e=>{(0,n.c)("distance"===this.expression.type,"Incorrect render function for expression type.");const s=e.target.selectedOption.value;this.expression.value.unit=s,this.analysisExpressionChange.emit()},this.parseStringInput=(e,s)=>{let t;return t=(0,a.i)(e)?void 0:(0,n.f)(s)?""===e?void 0:parseFloat(e):(0,n.h)(s)?""===e?void 0:parseInt(e):e,t},this.parseDateValueFromInputs=(e,s)=>{const t=e?.valueAsDate,i=s?.value?s.value.split(":"):[0,0];return new Date(t.getFullYear(),t.getMonth(),t.getDate(),Number(i[0]),Number(i[1]))},this.fields=void 0,this.fieldValues=[],this.loadingMessage=void 0,this.showUniqueValuesPopover=!1,this.expression=void 0,this.target=void 0,this.options=void 0,this.cache=void 0}get maxDropdownItems(){return this.options?.maxDropdownItems??this.defaultMaxDropdownItems}get selectedField(){return this.fields?.find((e=>e.name===this.expression?.field))}async loadFields(e){this.loadAbortController?.abort(),this.loadAbortController=new AbortController;try{await(e?.load({signal:this.loadAbortController.signal}))}catch(e){}const s=e?.fields??[];this.fields=s.filter((s=>(0,n.i)(s,this.options,e)))}async componentWillLoad(){this.strings=(0,n.g)(),await this.loadFields(this.target),this.loadFieldValues(this.expression.field)}render(){switch(this.expression.type){case"value":return(0,i.h)("analysis-query-entry",{kind:"expression",appearance:"inline",onAnalysisQueryEntryRemove:this.onRemoveClick},(0,i.h)("div",{class:f},this.renderFieldSelect("auto"),this.renderOperatorSelect("auto"),this.renderValueInput(),this.showUniqueValuesPopover&&this.renderUniqueValuesPopover()));case"multi-value":return(0,i.h)("analysis-query-entry",{kind:"expression",appearance:"section",onAnalysisQueryEntryRemove:this.onRemoveClick},(0,i.h)("div",{class:x},this.renderFieldSelect("half"),this.renderOperatorSelect("half")),this.renderValuesInput());case"range":return(0,i.h)("analysis-query-entry",{kind:"expression",appearance:"section",onAnalysisQueryEntryRemove:this.onRemoveClick},(0,i.h)("div",{class:x},this.renderFieldSelect("half"),this.renderOperatorSelect("half")),this.renderRangeInputs());case"distance":return(0,i.h)("analysis-query-entry",{kind:"expression",appearance:"inline",onAnalysisQueryEntryRemove:this.onRemoveClick},(0,i.h)("div",{class:f},this.renderFieldSelect("auto"),this.renderOperatorSelect("auto"),this.renderDistanceInputs()))}}renderFieldSelect(e="auto"){return(0,i.h)("calcite-select",{class:C,label:this.strings.fieldSelect,width:e,onCalciteSelectChange:this.onFieldSelect},this.fields?.map((e=>(0,i.h)("calcite-option",{value:e.name,selected:e.name===this.expression?.field},e.alias))))}renderOperatorSelect(e="auto"){const s=function(e){switch(e.dataType){case"string":return n.m;case"small-integer":case"integer":case"big-integer":case"single":case"double":case"long":case"oid":return n.N;case"date":return n.l;case"date-only":return n.k;case"geometry":return n.G;case"boolean":return n.B}}(this.expression),t=void 0!==this.getSelectedFieldDomainOptions(),a=s.filter((e=>!(t&&(0,n.d)(e)))).filter((e=>{const{useIntervalQueries:s,useExtractDatePartQueries:t}=this.options??{},i=!0!==s&&["in_the_last","not_in_the_last"].includes(e),a=!0!==t&&["this_year","this_month","this_day"].includes(e);return!i&&!a&&"this_day"!==e}));return(0,i.h)("calcite-select",{class:b,label:this.strings.expressionOperatorSelect,key:this.expression.operator,width:e,onCalciteSelectChange:this.onOperatorSelect},a.map((e=>{const s=this.strings.operators[e],t="is_true"===e||"is_false"===e?s.toLocaleLowerCase():s;return(0,i.h)("calcite-option",{value:e,selected:this.expression?.operator===e},t)})))}renderUniqueValuesPopover(e=!1){let s=this.expression.dataType;if("oid"===this.expression.dataType){s=!0===(void 0===this.fieldValues.find((e=>"string"==typeof e.value)))?"integer":this.expression.dataType}let t=!1,a=this.fieldValues;a.length>this.maxDropdownItems&&(t=!0,a=a.slice(0,this.maxDropdownItems));const n=this.numberInputElement.getBoundingClientRect().width;return(0,i.h)("calcite-popover",{autoClose:!0,focusTrapDisabled:!0,placement:"bottom-end",offsetDistance:0,offsetSkidding:0,pointerDisabled:!0,overlayPositioning:"fixed",open:!0,referenceElement:this.numberInputElement,onCalcitePopoverClose:()=>{this.showUniqueValuesPopover=!1},label:this.strings.chooseFromUniqueValues},(0,i.h)("arcgis-filter-unique-list",{style:{width:`${n}px`},uid:`arcgis-filter-unique-list_${this.expression.field}`,uniqueValues:a,partialUniqueValues:t,selectedValues:[this.expression.value],layerFieldType:s,props:{},multiple:e,strings:{searchValues:this.strings.searchValues,sortByCount:this.strings.sortByCount,sortAlphabetical:this.strings.sortAlphabetical,sortAscending:this.strings.sortNumericAscending,sortSelected:this.strings.sortSelected,errors:{tooManyUniqueValues:this.strings.tooManyValuesToDisplay}},sortBy:I,maxHeight:300,onArcgisFilterUniqueListChanged:this.handleUniqueValuesListChange}))}renderValueInput(){(0,n.c)("value"===this.expression.type,"Incorrect render function for expression type.");const{dataType:e,value:s,operator:t}=this.expression;let r;if((0,n.e)(t))r=null;else if((0,n.f)(e)||(0,n.h)(e)){const t=(0,n.f)(e)?"any":1,o=this.getSelectedFieldMinMax();r=(0,i.h)("calcite-input-number",{step:t,placeholder:this.strings.inputPlaceholderText,value:void 0===s?void 0:`${s}`,onCalciteInputNumberChange:this.onValueInputChange,min:o?.min,max:o?.max,ref:e=>{void 0!==e&&(this.numberInputElement=e)}},(0,i.h)("calcite-button",{slot:"action",label:this.strings.chooseFromUniqueValues,appearance:"outline",kind:"neutral",scale:a.U.MediumScale,iconEnd:"chevron-down",onClick:()=>{this.showUniqueValuesPopover=!this.showUniqueValuesPopover}}))}else r="date-only"===e?(0,i.h)("div",{class:x},(0,i.h)("calcite-input-date-picker",{placement:"bottom-start",overlayPositioning:"fixed",value:s,onCalciteInputDatePickerChange:this.onValueInputChange})):"date"===e?this.renderValueDateInput():(0,i.h)("calcite-combobox",{class:E,label:this.strings.choiceList,allowCustomValues:!0,scale:a.U.MediumScale,selectionMode:"single",key:this.expression.operator,value:void 0===s?void 0:`${s}`,placeholder:this.strings.inputPlaceholderText,onCalciteComboboxChange:this.onValueComboboxChange,overlayPositioning:"fixed"},this.renderComboboxItems());return r}renderValuesInput(){(0,n.c)("multi-value"===this.expression.type,"Incorrect render function for expression type.");const e=this.expression.validValues.map((e=>`${e}`));return(0,i.h)("calcite-combobox",{label:this.strings.multiInputPlaceholderText,onCalciteComboboxChange:this.onValuesComboboxChange,allowCustomValues:!0,selectionMode:"multiple",scale:a.U.MediumScale,value:e,key:this.expression.operator,overlayPositioning:"fixed",placeholder:this.strings.inputPlaceholderText,clearDisabled:!0},this.renderComboboxItems())}renderComboboxItems(){const e=[];let s="multi-value"===this.expression.type?this.expression.value:[this.expression.value];s=s.filter((e=>void 0!==e));for(const t of s){const s=`${t}`;e.push((0,i.h)("calcite-combobox-item",{key:s,value:s,textLabel:s,selected:!0}))}if(void 0!==this.loadingMessage)e.push((0,i.h)("calcite-combobox-item",{key:this.loadingMessage,value:void 0,textLabel:this.loadingMessage,selected:!1,disabled:!0}));else{const t=new Set(s),a=this.maxDropdownItems+s.length;for(const s of this.fieldValues)if(t.has(s.value)||e.push((0,i.h)("calcite-combobox-item",{key:s.label,value:`${s.value}`,textLabel:s.label})),e.length>=a){e.push((0,i.h)("calcite-combobox-item",{key:this.strings.tooManyValuesToDisplay,value:void 0,textLabel:this.strings.tooManyValuesToDisplay,selected:!1,disabled:!0}));break}}return(0,i.h)(i.F,null,e)}renderValueDateInput(){(0,n.c)("value"===this.expression.type,"Incorrect render function for expression type.");const{operator:e,value:s}=this.expression,t=s,a=this.parseTimeValue(t),r=["is_on","is_not_on"].includes(e);return(0,i.h)("div",{class:x},(0,i.h)("calcite-input-date-picker",{key:"value-date",placement:"bottom",class:r?x:v,layout:"vertical",overlayPositioning:"fixed",valueAsDate:t,onCalciteInputDatePickerChange:this.onValueDateChange,ref:e=>{this.valueDateInputElement=e}}),!r&&(0,i.h)("calcite-input-time-picker",{key:"value-time",placement:"bottom",class:v,overlayPositioning:"fixed",value:a,onCalciteInputTimePickerChange:this.onValueDateChange,ref:e=>{this.valueTimeInputElement=e}}))}renderRangeInputs(){(0,n.c)("range"===this.expression.type,"Incorrect render function for expression type.");const{dataType:e,value:s}=this.expression;let t;if((0,n.f)(e)||(0,n.h)(e)){const a=(0,n.f)(e)?"any":1,r=this.getSelectedFieldMinMax();t=(0,i.h)("div",{class:x},(0,i.h)("calcite-input-number",{step:a,class:v,value:void 0===s[0]?"":`${s[0]}`,onCalciteInputNumberChange:this.onRangeStartInputChange,min:r?.min,max:r?.max}),(0,i.h)("calcite-input-number",{step:a,class:v,value:void 0===s[1]?"":`${s[1]}`,onCalciteInputNumberChange:this.onRangeEndInputChange,min:r?.min,max:r?.max}))}else if("date-only"===e){const e=[s[0]??"",s[1]??""];t=(0,i.h)("calcite-input-date-picker",{placement:"bottom-start",overlayPositioning:"fixed",value:e,range:!0,onCalciteInputDatePickerChange:this.onDateOnlyRangeChange})}else t="date"===e?this.renderRangeDateInputs():(0,i.h)("p",null,"Not supported yet.");return t}renderRangeDateInputs(){(0,n.c)("range"===this.expression.type,"Incorrect render function for expression type.");const{value:e}=this.expression,s=e[0],t=e[1],a=this.parseTimeValue(s),r=this.parseTimeValue(t);return(0,i.h)("div",{class:x},(0,i.h)("calcite-input-date-picker",{key:"start-date",class:v,placement:"bottom",overlayPositioning:"fixed",valueAsDate:s,onCalciteInputDatePickerChange:this.onRangeStartDateChange,ref:e=>{this.startDateInputElement=e}}),(0,i.h)("calcite-input-time-picker",{key:"start-time",class:v,placement:"bottom",overlayPositioning:"fixed",value:a,onCalciteInputTimePickerChange:this.onRangeStartDateChange,ref:e=>{this.startTimeInputElement=e}}),(0,i.h)("calcite-input-date-picker",{key:"end-date",class:v,placement:"bottom",overlayPositioning:"fixed",valueAsDate:t,onCalciteInputDatePickerChange:this.onRangeEndDateChange,ref:e=>{this.endDateInputElement=e}}),(0,i.h)("calcite-input-time-picker",{key:"end-time",class:v,placement:"bottom",overlayPositioning:"fixed",value:r,onCalciteInputTimePickerChange:this.onRangeEndDateChange,ref:e=>{this.endTimeInputElement=e}}))}renderDistanceInputs(){(0,n.c)("distance"===this.expression.type,"Incorrect render function for expression type."),(0,n.c)("date"===this.expression.dataType||"date-only"===this.expression.dataType,"Incorrect data type.");const{distance:e,unit:s}=this.expression.value;return(0,i.h)(i.F,null,(0,i.h)("calcite-input-number",{step:1,placeholder:this.strings.inputPlaceholderText,value:void 0===e?void 0:`${e}`,onCalciteInputNumberChange:this.onDistanceInputChange,class:S,min:0}),(0,i.h)("calcite-select",{label:this.strings.expressionDateUnitSelect,onCalciteSelectChange:this.onDistanceUnitChange},n.D[this.expression.dataType].map((t=>(0,i.h)("calcite-option",{value:t,selected:t===s},(0,n.j)(t,e))))))}async loadFieldValues(e){let s=this.getSelectedFieldDomainOptions()??[];if(s.length<1)try{this.loadingMessage=this.strings.loadingFieldValues,s=await this.getFieldValuesByUniqueValues(e)}catch{return this.fieldValues=[],void(this.loadingMessage=this.strings.errorRetrievingFieldValues)}this.fieldValues=s.filter((e=>!1===(0,a.i)(e.value))),this.loadingMessage=this.fieldValues.length<1?this.strings.noFieldValuesRetrieved:void 0}getSelectedFieldMinMax(){let e;const s=this.selectedField?.domain;return"range"===s?.type&&(e={min:s.minValue,max:s.maxValue}),e}getSelectedFieldDomainOptions(){let e;const s=this.selectedField?.name,t=this.selectedField?.domain;if("coded-value"===t?.type)e=t.codedValues.map((e=>({label:e.name,value:e.code})));else if(void 0!==s&&s===this.target?.typeIdField)e=this.target?.types.map((e=>({label:e.name,value:e.id})));else if(void 0!==s&&!1===(0,a.i)(this.target?.types)){const t=new Map;for(const e of this.target.types){const i=e.domains[s];if("coded-value"===i?.type)for(const e of i.codedValues){const s=t.get(e.code);void 0===s?t.set(e.code,[e.name]):s.includes(e.name)||s.push(e.name)}}if(t.size>0){e=[];for(const[s,i]of t)e.push({label:i.join(" | "),value:s})}}return e}parseTimeValue(e){return e instanceof Date?e.toTimeString().substring(0,5):void 0}get hostElement(){return(0,i.g)(this)}static get watchers(){return{target:["loadFields"]}}};k.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.flex-container{display:flex}.half-width{width:50%}.single-value{display:flex}.single-value .field-select{max-inline-size:45%}.single-value .operator-select{flex-grow:1}.single-value .value-select{--calcite-combobox-input-height:1rem;min-width:150px}.single-value .value-sm{width:10rem}";const R="flex-container",w="flex-grow",D="layer-select",V=class{constructor(e){(0,i.r)(this,e),this.analysisExpressionChange=(0,i.c)(this,"analysisExpressionChange",7),this.spatialRelationships=Object.values(n.n),this.spatialRelationshipUnits=n.o,this.onSpatialRelationshipSelect=e=>{const s=e.target.selectedOption.value;this.spatialExpression=this.spatialExpression.changeSpatialRelationship(s);const t=this.spatialExpression.selectingLayer,i=this.spatialRelationshipLayers.get(s),a=i.find((e=>e.id===t.id));this.spatialExpression=void 0!==a?this.spatialExpression.changeSelectingLayer(a):this.spatialExpression.changeSelectingLayer(i[0]),this.analysisExpressionChange.emit()},this.onSpatialRelationshipUnitsSelect=e=>{const s=e.target.selectedOption.value;this.spatialExpression=this.spatialExpression.changeSpatialRelationshipUnit(s),this.analysisExpressionChange.emit()},this.onDistanceInputChange=e=>{const s=parseFloat(e.target.value);this.spatialExpression=this.spatialExpression.changeSpatialRelationshipDistance(s),this.analysisExpressionChange.emit()},this.onLayerSelectChange=e=>{const s=e.target.value,t=this.layers?.find((e=>e.id===s));void 0!==this.layers&&void 0!==t&&(this.spatialExpression=this.spatialExpression.changeSelectingLayer(t)),this.analysisExpressionChange.emit()},this.spatialExpression=void 0,this.layers=void 0}setLayersToSpatialRelationships(e){void 0!==e&&(this.spatialRelationshipLayers=n.S.getValidLayersForRelationships(this.spatialExpression.layer,e,this.spatialRelationships))}componentWillLoad(){this.strings=(0,n.g)(),this.setLayersToSpatialRelationships(this.layers),this.spatialRelationshipLayers=n.S.getValidLayersForRelationships(this.spatialExpression.layer,this.layers??[],this.spatialRelationships)}render(){return(0,i.h)(i.H,{key:"4238a2f55a9bce0756195fd01a1b60c805a21697"},this.renderSpatialRelationshipSelect(),this.renderLayerSelect())}renderSpatialRelationshipSelect(e="auto"){const s=this.spatialExpression.spatialRelationship;return(0,i.h)("div",{class:R},(0,i.h)("calcite-select",{class:w,label:this.strings.spatialRelationshipSelect,width:e,onCalciteSelectChange:this.onSpatialRelationshipSelect},this.spatialRelationships.map((e=>(0,i.h)("calcite-option",{selected:s===e,value:e,key:e,disabled:(0,a.i)(this.spatialRelationshipLayers.get(e))},(0,a.i)(this.spatialRelationshipLayers.get(e))?(0,a.a)(this.strings.spatialRelationships[e],{noCompatibleLayers:this.strings.noCompatibleLayers}):(0,a.a)(this.strings.spatialRelationships[e],{noCompatibleLayers:""}))))),this.spatialExpression.isDistanceRelationship&&this.renderSpatialRelationshipParams())}renderSpatialRelationshipParams(e="auto"){const s=this.spatialExpression.spatialRelationshipParams?.units,t=this.spatialExpression.spatialRelationshipParams?.distance;return(0,i.h)("div",{class:R},(0,i.h)("calcite-input-number",{class:w,step:1,placeholder:this.strings.inputPlaceholderText,value:void 0===t?"":`${t}`,onCalciteInputNumberChange:this.onDistanceInputChange}),(0,i.h)("calcite-select",{class:w,label:this.strings.spatialRelationshipParamsDistanceInput,width:e,onCalciteSelectChange:this.onSpatialRelationshipUnitsSelect},this.spatialRelationshipUnits.map((e=>(0,i.h)("calcite-option",{selected:s===e,value:e,key:e},this.strings.spatialRelationshipUnits[e])))))}renderLayerSelect(e="auto"){const s=this.spatialRelationshipLayers.get(this.spatialExpression.spatialRelationship),t=this.spatialExpression.selectingLayer;return(0,i.h)("calcite-select",{class:D,label:this.strings.spatialRelationshipLayerSelect,width:e,onCalciteSelectChange:this.onLayerSelectChange},s?.map((e=>(0,i.h)("calcite-option",{value:e.id,key:e.id,selected:t?.id===e.id},(0,a.B)(e)))))}get hostElement(){return(0,i.g)(this)}static get watchers(){return{layers:["setLayersToSpatialRelationships"]}}};V.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.flex-container{display:flex}.flex-container .flex-grow{flex-grow:1}"}}]);