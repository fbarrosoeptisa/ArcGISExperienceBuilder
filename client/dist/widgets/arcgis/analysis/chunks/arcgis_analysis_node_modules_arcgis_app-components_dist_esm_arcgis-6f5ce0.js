/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-6f5ce0.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-6f5ce0"],{14188:(e,i,t)=>{t.r(i),t.d(i,{arcgis_new_item_pages_append_upload:()=>b});var a=t(19564),n=t(4948),o=t(97018),s=t(86868),l=t(18409),r=t(90722),d=t(61191),p=t(62913),c=t(68334),h=t(33861),u=t(44069),m=t(87382),v=t(51834),y=t(22020),f=t(17233),g=t(8227);t(18991),t(32084),t(91102),t(73807),t(44508),t(98821),t(90079),t(32198),t(65174),t(82297),t(57159),t(98034),t(99004),t(76246),t(748),t(56288),t(93863),t(80015),t(24211),t(67336),t(96160),t(12350),t(11560),t(63330),t(78537),t(11163),t(66484);async function w(){try{await(0,p.d)(d.a.id,{permanentDelete:!0}),d.a.id=null}catch(e){console.warn("Delete item failed",e)}}const b=class{constructor(e){(0,a.r)(this,e),this.fileSelect=(0,a.c)(this,"fileSelect",7),this.newItemUpdatePage=(0,a.c)(this,"newItemUpdatePage",7),this.newItemToggleNavigationEnabled=(0,a.c)(this,"newItemToggleNavigationEnabled",7),this.newItemPrevPage=(0,a.c)(this,"newItemPrevPage",7),this.workflowComplete=(0,a.c)(this,"workflowComplete",7),this.sourceName="",this.itemTypes=[{value:"File Geodatabase",icon:"data",publishable:!0},{value:"Shapefile",icon:"file-zip",publishable:!0}],this.insideModal=!0,this.fullHeight=!0,this.selectedZipFile="File Geodatabase",this.step="upload",this.loading=void 0,this.loaderMessage=void 0,this.loaderType="indeterminate",this.error=void 0,this.overwriteProcess=!1,this.file=void 0,this.header=void 0,this.description=void 0}async handlePrev(e){if(e.preventDefault(),!this.loading){if("analyzeZip"===this.step)return d.a.file=null,void(this.step="upload");d.a.appendOptions.layers.length>1&&(d.a.sourceDataLayer=null),this.newItemPrevPage.emit()}}async handleNext(){var e;if(this.overwriteProcess&&"overwrite"===d.a.addAppendSelectOption){const{addAppendSelectOption:i}=d.a,t=Object.assign({id:null===(e=this.publishResponse)||void 0===e?void 0:e.id,appendType:i,item:Object.assign({},d.a),overwriteStatus:this.overwriteStatus},this.publishResponse);this.workflowComplete.emit(t)}else if(d.a.file){if("zip"===d.a.extension)if(this.step="analyzeZip",d.a.type=m.a[this.selectedZipFile].type,"overwrite"===d.a.addAppendSelectOption)d.a.id=this.item.id,await this.handleOverwrite();else{await this.uploadAndAnalyzeFile()&&this.nextStep()}}else this.handleError({code:"providePath"})}async fileSelectHandler(e){var i;const t=e.detail.file;d.a.originalFileName=t.name;const{title:a,fileName:n,extension:s}=(0,o.s)(t,!0);if("overwrite"===d.a.addAppendSelectOption&&!(0,o.v)(d.a.originalFileName,this.sourceName))return void this.handleError({code:"useSameFileName"});if(d.a.initialTitle=a,d.a.file=t,d.a.fileName=n,d.a.newItemMode="file",d.a.extension=s,d.a.type="zip"===d.a.extension&&this.isEnterprise?"Shapefile":(0,v.f)(s,this.validTypes)[0].type,d.a.addAsUniqueFile=!0,"esriGeometryMultiPatch"===(null===(i=d.a.sourceDataLayer)||void 0===i?void 0:i.geometryType)&&"File Geodatabase"!==d.a.type&&"Shapefile"!==d.a.type&&"update"!==d.a.addAppendSelectOption)return this.step="upload",void this.handleError({code:"multiPatchRestriction"});const r=(null==t?void 0:t.size)>l.M&&"zip"===d.a.extension,p="overwrite"!==d.a.addAppendSelectOption&&!this.isEnterprise,c="overwrite"===d.a.addAppendSelectOption&&(null==t?void 0:t.size)>l.M;if("overwrite"!==d.a.addAppendSelectOption||r)if("zip"===d.a.extension&&(p||c))this.step="analyzeZip";else{this.step="analyze";await this.uploadAndAnalyzeFile()&&this.nextStep()}else await this.handleOverwrite()}async componentWillLoad(){var e,i;const{existingItem:t,addAppendSelectOption:a}=d.a,{config:o,portal:s}=n.c;this.item=t,this.sourceName=(null===(e=d.a.appendOptions.sourceData)||void 0===e?void 0:e.name)||this.item.name,this.i18n=h.u.i18n.appendUpload,this.config=o,this.isEnterprise=s.isPortal;const l=null===(i=d.a.appendOptions.sourceData)||void 0===i?void 0:i.type;this.allowedExtensions="overwrite"===a?(0,v.m)(["geojson"===l.toLowerCase()?"GeoJson":l]):s.isPortal?u.c:u.d,this.header=this.i18n.selectData,this.description="",this.validTypes=Object.values(m.a).filter((e=>e.appendUploadFormat)),"overwrite"===a&&this.validTypes.push(m.a["Service Definition"]),d.a.id&&await w(),d.a.file=null}async handleOverwrite(){var e;const{existingItem:i,file:t,keepDescription:a,fileName:o,appendOptions:l}=d.a;h.u.nextText="proceed";const r=i;this.loading=!0,this.overwriteProcess=!0,this.newItemToggleNavigationEnabled.emit(!1),this.loaderMessage=h.u.i18n.append.appendLoadingMessages.overwriting;const p=(0,f.g)(await(0,f.f)(this.item.owner,n.c.portal),n.c.portal),{error:u}=await(0,c.f)(l.sourceData,p,{file:t,overwrite:!0,keepDescription:a,fileName:o,existingItemId:r.id});if(u)return this.handleError(u),this.loading=!1,!1;try{const{result:t,error:a}=await(0,c.p)(i,null!==(e=s.i.title)&&void 0!==e?e:d.a.initialTitle,n.c.portal,n.c.user,d.a.appendOptions);if(a)throw a;this.publishResponse=t,this.updateAndCheckStatus(r)}catch(u){return this.handleError({code:"unhandledError"}),this.loading=!1,!1}}async updateAndCheckStatus(e){var i;const{result:t}=await(0,c.r)(e);this.newItemToggleNavigationEnabled.emit(!0);const a=await(0,l.g)(e.id,{success:null==t?void 0:t.success});this.overwriteStatus=null==a?void 0:a.status;const n=Object.assign({id:null===(i=this.publishResponse)||void 0===i?void 0:i.id,item:Object.assign({},d.a),overwriteStatus:this.overwriteStatus,appendType:d.a.addAppendSelectOption},this.publishResponse);if("completed"===(null==a?void 0:a.status.toLowerCase()))return n.overwriteStatus=null==a?void 0:a.status,void this.workflowComplete.emit(n);"failed"===(null==a?void 0:a.status.toLowerCase())&&(h.u.nextText="next",this.loading=!1,this.handleError({code:"unhandledError"}))}nextStep(){var e,i,t;let a="appendSelectLayer";const{analyzeResults:n}=d.a,o=n.publishParameters;if(1===(null===(e=n.publishParameters.layers)||void 0===e?void 0:e.length)||!n.publishParameters.layers){d.a.dataLayer=null!==(t=null===(i=null==o?void 0:o.layers)||void 0===i?void 0:i[0])&&void 0!==t?t:o;const e=(0,g.a)(d.a.type,d.a.dataLayer,d.a.sourceDataLayer);if("update"!==d.a.addAppendSelectOption){if(!(0,y.c)(d.a.dataLayer,d.a.sourceDataLayer,d.a.type))return void this.handleError({code:"incompatibleGeometries"})}a="Microsoft Excel"!==d.a.type&&"CSV"!==d.a.type||"esriGeometryPoint"!==(null===d.a||void 0===d.a?void 0:d.a.sourceDataLayer.geometryType)||"Table"===(null===d.a||void 0===d.a?void 0:d.a.sourceDataLayer.type)?"add"!==d.a.addAppendSelectOption||(e||d.a.backupLayerFields.some((e=>"esriFieldTypeDate"===e.type)))&&!this.isEnterprise?"appendKeyPairSelect":"appendMatchFields":"csvLocationFields"}this.newItemToggleNavigationEnabled.emit(!0),this.newItemUpdatePage.emit(a)}updateLoader(e,i){this.loaderType=e,this.loaderMessage=i}async uploadAndAnalyzeFile(){const{file:e,originalFileName:i,type:t}=d.a,{portal:a,user:o,config:s,lang:p}=n.c;this.loading=!0,this.newItemToggleNavigationEnabled.emit(!1),this.updateLoader((null==e?void 0:e.size)>l.M?"determinate":"indeterminate",h.u.i18n.append.appendLoadingMessages.uploading.replace("${fileName}",i));let c=null;return({error:c}=await(0,l.C)()),c?(this.handleError(c),!1):(this.updateLoader("indeterminate",this.i18n.analyzing),({error:c}=await(0,r.a)({analyzeArgs:{type:"item",itemid:d.a.id,workflow:"append"},itemArgs:{itemType:t},configArgs:{portal:a,user:o,config:s,lang:p},initialize:!0})),c&&(this.handleError(c),d.a.id&&await w()),!c)}async handleError(e){this.newItemToggleNavigationEnabled.emit(!0);let i=h.u.i18n.error,t=this.i18n.errors.errorWhileUpload;switch(e.code){case"exceedsFileSize":t=this.i18n.errors.errorExceedFileSize;break;case"invalidFileGeodatabase":i=h.u.i18n.itemProperties.invalidGeodatabase.title,t=h.u.i18n.itemProperties.invalidGeodatabase.description;break;case"invalidShapefile":i=h.u.i18n.itemProperties.invalidShapefile.title,t=h.u.i18n.itemProperties.invalidShapefile.description;break;case"useSameFileName":t=this.i18n.errors.sameFileName.replace("${x}",this.sourceName);break;case"providePath":t=this.i18n.errors.providePath;break;case"incompatibleGeometries":i=h.u.i18n.appendSelectLayer.sameGeometryWarningTitle,t=h.u.i18n.appendSelectLayer.sameGeometryWarningDescription;break;case"multiPatchRestriction":i=h.u.i18n.appendSelectLayer.sameGeometryWarningTitle,t=this.i18n.errors.multiPatchErrorDescription;break;case"unhandledError":"overwrite"===d.a.addAppendSelectOption&&(t=this.i18n.errors.errorUpdate)}("incompatibleGeometries"===e.code||"multiPatchRestriction"===e.code&&d.a.id)&&(d.a.file=null,await w()),this.loading=!1,this.error={title:i,description:t}}renderPickZip(){const e=this.itemTypes.map((({value:e,icon:i})=>({optionTitle:this.i18n[e].title,value:e,description:this.i18n[e].description,icon:i})));return(0,a.h)("calcite-label",{class:"zip-select"},(0,a.h)("div",{class:"zip-select-heading"},this.i18n.itemType),(0,a.h)("div",{class:"w-full"},(0,a.h)("div",{class:"w-full"},(0,a.h)("calcite-tile-group",{label:this.i18n.itemType,layout:"vertical",selectionMode:"single-persist"},Object.keys(e).map((i=>{const{icon:t,value:n,optionTitle:o,description:s}=e[i];return(0,a.h)("calcite-tile",{key:n,selected:n===this.selectedZipFile,heading:o,description:s,icon:t,"input-enabled":!0,"data-value":n,onCalciteTileSelect:e=>{this.selectedZipFile=e.target.dataset.value}})}))))))}render(){const{i18n:e,error:i,loaderType:t,loaderMessage:n,step:o,loading:s,config:l,sourceName:r,validTypes:p,allowedExtensions:c,isEnterprise:h}=this,u="overwrite"===d.a.addAppendSelectOption;u&&(this.header=e.selectData,this.description=e.sameFileNameDescription.replace("${fileName}",r));const m=h&&u?"120004189":"120001300",v=`${l.helpBase}${l.helpMap[m]}`;return(0,a.h)(a.H,{key:"0b842ef17cee84dd037720bc479694e7e3b7604f",class:{"overflow-hidden":s}},(0,a.h)("arcgis-new-item-loader",{key:"db0fddd8de047f3fef0cf9f2c24e8bcef307c57e",type:t,active:s,text:n}),"analyzeZip"!==o&&(0,a.h)("div",{key:"d6589cacb06a707662abdcb4cacfad812ba128e4",class:{"upload-step":!0,"upload-step--header-with-description":u}},(0,a.h)("arcgis-new-item-description",{key:"726679f997bd78b1259ceb520c766ccf2d911ed5",header:this.header,content:this.description})),"analyzeZip"!==o&&(0,a.h)("div",{key:"db0a1aae22173737ae1617d9d4f8efc8c4b494ac",class:{"file-browser-container":!0,"file-browser-container--has-description":u}},(0,a.h)("arcgis-file-browser",{key:"983ed9b980df77aee75cd9992080287da3ec361d",cloud:!1,validTypes:p,allowedExtensions:c,insideModal:!0,config:l,helpText:e.learnMore,helpLink:v,helpIdType:"append",fullHeight:!0})),"analyzeZip"===o&&(0,a.h)("div",{key:"d8124e9bdd3fd52a9a568461870dee8410172633",class:"analyze-step"},(0,a.h)("arcgis-new-item-input-readonly",{key:"aba107de648b6add39cdb04a70eda28dd68de24b",label:e.file}),"zip"===d.a.extension&&this.renderPickZip()),(0,a.h)("arcgis-new-item-alert",{key:"8b5713e01f36a97403a53988adfe9f573d3021d6",heading:null==i?void 0:i.title,description:null==i?void 0:i.description,link:{href:null==i?void 0:i.link,title:null==i?void 0:i.linkText},active:!!i,onAlertDismiss:()=>this.error=null}))}get el(){return(0,a.d)(this)}};b.style=":host{overflow:hidden}.file-browser-container{display:block;height:95%}.file-browser-container--has-description{display:block;height:90%}.upload-step{margin-bottom:0px;display:block}.upload-step--header-with-description{margin-bottom:0.75rem;display:block}.read-only{z-index:50;display:block}.zip-select-heading{font-weight:500}calcite-tile-group{inline-size:100%}calcite-tile{max-inline-size:100%;min-inline-size:100%}"},91102:(e,i,t)=>{t.d(i,{a:()=>r,c:()=>n,d:()=>d,g:()=>o,i:()=>s,s:()=>l});var a=t(73807);function n(e,i){return function e(t){return t?t.closest(i)||e(function(e){return e.getRootNode()}(t).host||null):null}(e)}function o(e){const i=n(e,".calcite-mode-dark, .calcite-mode-light");return(null==i?void 0:i.classList.contains("calcite-mode-dark"))?"dark":"light"}function s(e){let i=e;for(;null==i?void 0:i.parentNode;){if(i.parentNode===document)return!0;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1}function l(e){return(new a.S).sanitize(e)}function r(e){const i=l(e),t=document.createElement("div");return t.innerHTML=i,t.textContent||t.innerText||""}function d(e){const i=document.createElement("textarea");return i.innerHTML=e,i.value}},22020:(e,i,t)=>{function a(e){var i,t;const{dataLayer:a,type:n,sourceDataLayer:o}=e,s=null!==(i=null==a?void 0:a.geometryType)&&void 0!==i?i:null===(t=null==a?void 0:a.layerInfo)||void 0===t?void 0:t.geometryType;if("Microsoft Excel"===n||"CSV"===n){if(("address"===a.locationType&&a.addressFields||"coordinates"===a.locationType)&&"esriGeometryPoint"===(null==o?void 0:o.geometryType))return null;if(!s||"none"===a.locationType||"Table"===(null==o?void 0:o.type))return{title:"noGeometryMatchTitle",description:"noGeometryTableMessage"};if((null==o?void 0:o.geometryType)!==s)return{title:"noGeometryMatchTitle",description:"noGeometryMatchMessage"}}else{if((null==o?void 0:o.geometryType)!==(null==a?void 0:a.geometryType))return{title:"noGeometryMatchTitle",description:"noGeometryMatchMessage"};if("table"===(null==o?void 0:o.type.toLowerCase()))return{title:"noGeometryMatchTitle",description:"noGeometryMatchMessage"}}}function n(e,i,t){return"Microsoft Excel"===t||"CSV"===t?"Table"===(null==i?void 0:i.type)||("esriGeometryPoint"===(null==i?void 0:i.geometryType)&&"none"===(null==e?void 0:e.locationType)||"esriGeometryPoint"===(null==i?void 0:i.geometryType)&&(!!e.addressFields||"none"!==e.locationType)):"Table"===(null==i?void 0:i.type)||(null==e?void 0:e.geometryType)===(null==i?void 0:i.geometryType)}t.d(i,{c:()=>n,v:()=>a})},51834:(e,i,t)=>{t.d(i,{a:()=>r,f:()=>o,i:()=>l,m:()=>s});var a=t(26408),n=t(87382);function o(e,i){let t;t=i?i.map((e=>e.type)):Object.keys(n.a);let a=[];return t.forEach((i=>{var t;(null===(t=n.a[i].fileExt)||void 0===t?void 0:t.indexOf(e))>=0&&a.push(n.a[i])})),a}function s(e){return e?(0,a.b)(e.flatMap((e=>{var i;return null===(i=n.a[e])||void 0===i?void 0:i.fileExt})).filter((e=>!!e))):null}const l=e=>e/1024/1024>50,r=e=>e/1024/1024>20}}]);