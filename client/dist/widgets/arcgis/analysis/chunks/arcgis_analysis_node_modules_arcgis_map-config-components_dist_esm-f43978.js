/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-f43978.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-f43978"],{68180:(e,t,i)=>{i.d(t,{a:()=>n,b:()=>h,c:()=>w,d:()=>m,e:()=>p,f:()=>s,g:()=>u,h:()=>v,i:()=>a,j:()=>c,k:()=>f,l:()=>r,m:()=>d,n:()=>g,o:()=>b,p:()=>E,q:()=>S,s:()=>o,t:()=>y});var n,r,o,s,l=i(71480);function a(e){return null!=e}function c(e,t){const i=e.fieldName;if(i.includes(n.expression)){const e=t.get(i);return e?.title?e.title:i}return e.label?e.label:i}async function u(e){return new Map((await async function(e){return await new Promise(((t,i)=>{switch(m(e)){case o.feature:case o.ogcFeature:case o.stream:t(e.fields);break;case o.mapImage:{const n=e,r=n?.layer;r?.portalItem&&r.url.includes("https://demographics")&&r.url.includes(".arcgis.com")?r.portalItem?.fetchData().then((e=>{if(e?.thematicGroup){const i=new Map(n.fields.map((e=>[e.name,e]))),r=e.thematicGroup.fieldNames,o=[];r.forEach((e=>{i.has(e)&&o.push(i.get(e))})),t(o)}else t(n.fields)})).catch((e=>{i(new Error(e))})):t(n.fields);break}case o.imagery:{const i=e;t((i.fields||[]).concat(i.rasterFields||[]));break}case o.imageryTile:case o.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}}))}(e)).filter((e=>e.visible)).map((e=>[e.name,e])))}function p(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach((e=>{const i=`${n.expression}${e.name}`;t.set(i,e)})),t}function m(e){return"map-image"===e?.layer?.type?o.mapImage:"subtype-sublayer"===e?.type?o.subtype:"tile"===e?.layer?.type?o.tile:"scene"===e?.type?o.scene:"ogc-feature"===e?.type?o.ogcFeature:"imagery"===e?.type?o.imagery:"imagery-tile"===e?.type?o.imageryTile:"wfs"===e?.type?o.wfs:"wcs"===e?.type?o.wcs:"wms"===e?.layer?.type?o.wms:"csv"===e?.type?o.csv:"geojson"===e?.type?o.geojson:"stream"===e?.type?o.stream:"oriented-imagery"===e?.type?o.orientedImagery:"catalog"===e?.type?o.catalog:"catalog-footprint"===e?.type?o.catalogFootprint:"knowledge-graph-sublayer"===e?.type?o.knowledgeGraphSublayer:"voxel"===e?.type?o.voxel:o.feature}function d(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function f(e){return Number((100*(1-e)).toFixed(1))}function y(e){return Number((1-e/100).toFixed(3))}!function(e){e.expression="expression/",e.raster="Raster.",e.relationship="relationships/"}(n||(n={})),function(e){e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes"}(r||(r={})),function(e){e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms"}(o||(o={})),function(e){e.bigInteger="big-integer",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset"}(s||(s={}));const g=(e,t)=>{const i=[];return e?.fieldInfos?.forEach((e=>{e.fieldName?.includes(n.expression)?t&&i.push({name:e.fieldName.slice(n.expression.length),alias:e.fieldName.slice(n.expression.length),type:"string"}):i.push({name:e.fieldName,alias:e.label,type:"string"})})),i},h=async(e,t)=>{const[i,n]=await Promise.all([(0,l.g)(),(0,l.h)()]),r=new n;r.geometry=t.extent,r.mapExtent=t.extent,r.returnGeometry=!0,r.tolerance=6,r.layerOption="popup",r.width=t.width,r.height=t.height,r.layerIds=[e.id];const o=(await i.identify(e.layer.url,r))?.results,s=o?.[0]?.feature;return s},b=async(e,t,i)=>{const n=await e.whenLayerView(t),r=await n.queryAggregates();return await T(i,r.features?.[0])},T=async(e,t)=>{const i=await(0,l.j)(),n=await(0,l.k)();let r;if(t)r=t.clone();else{r=new i;const t=g(e,!1);if(t?.length){const e={};t.forEach((t=>{e[t.name]=""})),r.attributes=e}const o=new n;r.geometry=o}return r};function S(e,t){const i=t.startsWith("#"),n=t.startsWith(".");for((n||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(n){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function w(e){if(m(e)===o.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(m(e)===o.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find((t=>{if(t.id===e.id)return t}))?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function v(e,t,i){let n="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))n="number";else if(t.has(e)){const i=t.get(e);n=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);n=t.returnType?t.returnType.toLowerCase():""}else n="number";return n}async function E(e,t){return"feature"!==e.type||e.url?"feature"===e.type||"csv"===e.type||"scene"===e.type||"wfs"===e.type||"geojson"===e.type||"oriented-imagery"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"catalog"===e.type||"catalog-footprint"===e.type?await e.queryFeatureCount():!t||"stream"!==e.type&&"ogc-feature"!==e.type?await Promise.reject(new Error(`Can't get feature count for layer of type ${e.type}.`)):await async function(e,t){const i=await t.whenLayerView(e);return await i.queryFeatureCount()}(e,t):await async function(e){const t=e.createQuery();t.outFields=["*"];const i=await e.queryFeatures(t);if(i.features?.length)return i.features.length;throw new Error("could not get feature count")}(e)}},48122:(e,t,i)=>{function n(e,t,i){if(t&&e?.tagName===t.toUpperCase()||i&&e?.classList.contains(i))return e;{let n=e?.parentElement;for(;n;){if(t&&n.tagName===t.toUpperCase()||i&&n.classList.contains(i))return n;if("BODY"===n.tagName)break;n=n.parentElement}}}i.d(t,{f:()=>n})},99592:(e,t,i)=>{i.d(t,{$:()=>Oe,A:()=>b,B:()=>c,C:()=>p,D:()=>H,E:()=>$,F:()=>V,G:()=>et,H:()=>ue,I:()=>O,J:()=>u,K:()=>j,L:()=>J,M:()=>v,N:()=>ft,O:()=>lt,P:()=>mt,Q:()=>Y,R:()=>X,S:()=>L,T:()=>a,U:()=>Te,V:()=>tt,W:()=>it,X:()=>_e,Y:()=>ye,Z:()=>ke,_:()=>re,a:()=>ie,a0:()=>Le,a1:()=>Se,a2:()=>be,a3:()=>Pe,a4:()=>qe,a5:()=>he,a6:()=>ve,a7:()=>ge,a8:()=>Ee,a9:()=>Ae,aA:()=>ot,aB:()=>st,aC:()=>ee,aD:()=>dt,aE:()=>ut,aF:()=>pt,aG:()=>gt,aH:()=>yt,aI:()=>ae,aJ:()=>ze,aK:()=>d,aL:()=>g,aM:()=>U,aN:()=>I,aO:()=>M,aP:()=>E,aa:()=>$e,ab:()=>Ie,ac:()=>Fe,ad:()=>je,ae:()=>ne,af:()=>m,ag:()=>h,ah:()=>y,ai:()=>f,aj:()=>k,ak:()=>xe,al:()=>We,am:()=>Re,an:()=>Ge,ao:()=>Je,ap:()=>Xe,aq:()=>Ke,ar:()=>Ve,as:()=>Be,at:()=>N,au:()=>se,av:()=>Me,aw:()=>He,ax:()=>ct,ay:()=>F,az:()=>at,b:()=>Ze,c:()=>G,d:()=>Z,e:()=>R,f:()=>oe,g:()=>K,h:()=>me,i:()=>q,j:()=>ce,k:()=>nt,l:()=>rt,m:()=>Ce,n:()=>C,o:()=>z,p:()=>B,q:()=>r,r:()=>D,s:()=>n,t:()=>A,u:()=>pe,v:()=>P,w:()=>T,x:()=>w,y:()=>_,z:()=>S});var n,r,o=i(68180),s=i(97127),l=i(48122);function a(e){return 0===Object.keys(e).length&&e.constructor===Object}function c(){document.querySelectorAll("calcite-popover").forEach((e=>{let t=!1;if(e.classList.forEach((e=>{e.startsWith("smart-mapping-")&&e.endsWith("-popover")&&(t=!0)})),t){e.setAttribute("open","false");const t=e.parentNode;t?.removeChild(e)}})),document.querySelectorAll("arcgis-smart-mapping-styler-popover, arcgis-smart-mapping-info-popover, arcgis-smart-mapping-symbol-pair-popover, arcgis-smart-mapping-dropdown, arcgis-smart-mapping-field-pick-list, .arcgis-smart-mapping-attribute-input-field-pick-list").forEach((e=>e?.parentNode?.removeChild(e)))}function u(e,t){const i=function(e){if("CALCITE-PANEL"===e?.tagName)return e;if("CALCITE-FLOW-ITEM"===e?.tagName)return e;{let t=e?.parentElement;for(;t;){if("CALCITE-PANEL"===t.tagName)return t;if("CALCITE-FLOW-ITEM"===t.tagName)return t;t=t.parentElement}}}(e);i&&(i.disabled=t)}function p(e){const t=e?.parentElement;if("CALCITE-FLOW"===t?.tagName){let i=0;return t.childNodes.forEach(((t,n)=>{t===e&&(i=n)})),0===i}return!1}function m(e,t){const{containsFlow:i}=e;return i?(0,l.f)(t,"calcite-flow"):(0,l.f)(t,"arcgis-smart-mapping")}function d(e,t,i,n=!0){const r=document.getElementById(i);r?.parentNode&&r.parentNode.removeChild(r);const o=document.createElement("calcite-tooltip");o.className="smart-mapping-tooltip",o.id=i,o.referenceElement=e,o.open=n,o.innerHTML=t,document.body.append(o)}function f(e,t,i=!0,n){const r=document.createElement("calcite-tooltip");r.className="smart-mapping-tooltip",r.referenceElement=e,r.open=i,r.innerHTML=t,r.placement=n??"auto",document.body.append(r)}function y(){document.querySelectorAll(".smart-mapping-tooltip").forEach((e=>{e.parentNode?.removeChild(e)}))}function g(e){const t=document.getElementById(e);"smart-mapping-tooltip"===t?.className&&t?.parentNode&&t.parentNode.removeChild(t)}function h(e){return e.min===e.max&&v(e.min)&&(e.min>0?(e.min=0,e.max*=2):e.min<0?(e.min*=2,e.max=0):(e.min=-10,e.max=10)),e}function b(e){const{layer:t,useFeatureReduction:i}=e;return"featureReduction"in t&&"binning"===t.featureReduction?.type&&i||"imagery"===t.type||"imagery-tile"===t.type||"wcs"===t.type?"polygon":"geo-rss"===t.type?"point":t.geometryType}function T(e){const{layer:t}=e;return"stream"===t.type||"point"===b(e)||"multipoint"===b(e)}function S(e){const{layer:t}=e;return!("stream"===t.type)&&"polygon"===b(e)}function w(e){const{layer:t}=e;return!("stream"===t.type)&&"polyline"===b(e)}function v(e){return null!=e}function E(e){if(e.simpleFieldType===r.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}function I(e){setTimeout((()=>{e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),setTimeout((()=>{const e=document.getElementsByTagName("calcite-shell")?.[0];e&&(e.scrollTop=0)}),100)}),100)}function F(e,t){const{fullLocale:i}=e,n=(0,s.a)(t),r=new Intl.NumberFormat(i,{style:"percent"}).format(0);return"rtl"===n?r.endsWith("%"):r.startsWith("%")}function N(e,t){return e.minValue<.001&&e.maxValue<.001?`${e.minValue.toFixed(t).toLocaleString()} - ${e.maxValue.toFixed(t).toLocaleString()}`:`${e.minValue.toLocaleString()} - ${e.maxValue.toLocaleString()}`}function C(e){return"feature"===e.type}!function(e){e.MISSING="missing",e.IN_PROGRESS="inProgress",e.SUCCESS="success",e.FAILED="failed"}(n||(n={})),function(e){e.NUMBER="number",e.STRING="string",e.DATE="date",e.OID="oid",e.GUID="guid",e.UNKNOWN="unknown"}(r||(r={}));let x=["id","fips","fid","objectid","_objectid","__objectid","x","y","lat","long","latitude","longitude","shape","shape_length","shape_leng","shape_area","perimeter","stretched_value","fnode_","tnode_","lpoly_","rpoly_","poly_","subclass","rings_ok","rings_nok","st_length(shape)","st_area(shape)"];async function R(e){const{layer:t,mapImageSublayer:i}=e;let{layerFields:n}=e;if(!t||n)return;e.layerFields=function(e){const{layer:t,useFeatureReduction:i,modules:n}=e;if("featureReduction"in t&&"binning"===t.featureReduction?.type&&i){const i=t.featureReduction.fields,r=[];return i.forEach((i=>{const o=t.fields.find((e=>e.name===i.onStatisticField));i.onStatisticField&&!o||r.push(new n.Field({name:i.name,alias:i.alias||i.name,type:P(e,i)}))})),r}return"fields"in t&&v(t.fields)?t.fields??[]:[]}(e);const o=i?.layer;if(o?.portalItem&&o.url.includes("https://demographics")&&o.url.includes(".arcgis.com")){const e=o.portalItem;try{const t=await e.fetchData();if(t?.thematicGroup){const e=t.thematicGroup.fieldNames;e&&(n=n.filter((t=>e.includes(t.name))))}}catch{}}!function(e){const{layer:t,mapImageSublayer:i,layerFields:n,supportsArcade:o}=e,s="capabilities"in t&&null!=t.capabilities&&"query"in t.capabilities&&"supportsSqlExpression"in t.capabilities.query&&t.capabilities?.query?.supportsSqlExpression;e.fields=[],e.stringFieldsCount=0,e.dateFieldsCount=0,e.numberFieldsCount=0;const l="popupTemplate"in t&&t.popupTemplate?t.popupTemplate.fieldInfos:[],a=oe(e),c=a.filter((e=>!!e.field)).map((e=>e.field.toLowerCase()));c?.length&&(x=x.filter((e=>!c.includes(e))));n.forEach((n=>{if(x.includes(n.name.toLowerCase()))return;if("date"===n.type&&(i&&!o||"stream"!==t.type&&!s))return;if("date-only"===n.type&&i)return;const a=l?l.filter((e=>e.fieldName===n.name)):null,u=a?.length?a[0].label:null,p={layerField:n,label:u||n.alias||n.name};!function(e,t,i){const{useFeatureReduction:n}=e;let o=P(e,t.layerField);n&&o&&["date","timestamp-offset"].includes(o)&&(o="string");switch(o){case"string":case"date-only":t.simpleFieldType=r.STRING,e.stringFieldsCount++;break;case"date":t.simpleFieldType=r.DATE,e.dateFieldsCount++;break;case"oid":i.includes(t.layerField.name.toLowerCase())&&(t.simpleFieldType=r.OID);break;case"guid":i.includes(t.layerField.name.toLowerCase())&&(t.simpleFieldType=r.GUID);break;case"small-integer":case"big-integer":case"integer":case"single":case"double":case"long":t.simpleFieldType=r.NUMBER,e.numberFieldsCount++}}(e,p,c),p.simpleFieldType&&e.fields.push(p)}))}(e)}function z(e,t){if(q(e)){const i=gt(e).filter((e=>e.name===t));if(i.length){const e=i[0];return{label:e.alias??"",layerField:e,simpleFieldType:r.STRING}}}else{const i=e.fields.filter((e=>e.layerField.name===t));if(i.length)return i[0]}}function M(e){const t=e.fields.filter((e=>e.simpleFieldType===r.NUMBER));if(t.length)return t[0]}function k(e){return e.numberFieldsCount>0}function _(e){const{selectedFields:t}=e,i={string:0,number:0,date:0,unknown:0,expression:0,featureReductionExpression:0};return t.forEach((t=>{let n;if(i.expression+=t.expression?1:0,i.featureReductionExpression+=t.featureReductionExpression?1:0,t.field){const i=z(e,t.field);n=i?i.simpleFieldType:r.UNKNOWN}else n=t.simpleFieldType;switch(n){case r.NUMBER:case r.OID:case r.GUID:i.number++;break;case r.STRING:i.string++;break;case r.DATE:i.date++;break;case r.UNKNOWN:i.unknown++}})),i}function V(e,t){const{fields:i}=e;t=t||i;const n={string:0,number:0,date:0,expression:0};return t?.forEach((e=>{switch(e.simpleFieldType){case r.NUMBER:case r.OID:case r.GUID:n.number++;break;case r.STRING:n.string++;break;case r.DATE:n.date++}})),n}function O(e,t){const{layer:i}=e;"featureReduction"in i&&i.featureReduction&&"binning"===i.featureReduction.type||L(e,t)}function L(e,t){const{layer:i}=e;"geojson"!==i.type&&"wfs"!==i.type&&"feature"!==i.type&&"parquet"!==i.type||(i.outFields=t)}function B(e,t){let i=!0;return e.length===t.length&&(e.forEach(((e,n)=>{i&&!D(e,t[n])&&(i=!1)})),i)}function D(e,t){return e&&t&&(e.field??null)===(t.field??null)&&(e.expression??null)===(t.expression??null)&&(e.expressionTitle??null)===(t.expressionTitle??null)}function U(e){return e.simpleFieldType===r.DATE}function A(e,t){const i=t.layerField;switch(P(e,i)){case"small-integer":case"big-integer":case"integer":case"single":case"double":if("domain"in i&&i.domain)return"string";switch("valueType"in i&&i.valueType){case"name-or-title":case"type-or-category":case"description":case"location-or-place-name":case"ordered-or-ranked":case"binary":case"unique-identifier":case"date-and-time":return"string";case"count-or-amount":return"integer";default:return"double"}case"string":case"date-only":return"string";case"date":return"date";default:return"string"}}function P(e,t){const{layer:i}=e;if(t&&"fields"in i){if("type"in t)return t.type;if("statisticType"in t){if(t.onStatisticExpression)return"number"===t.onStatisticExpression.returnType?"double":t.onStatisticExpression.returnType;const e=i.fields?.find((e=>e.name===t.onStatisticField));if(!t.onStatisticField||e){if("count"===t.statisticType)return"integer";if("avg"===t.statisticType)return"double";if(["min","max","sum","mode"].includes(t.statisticType))return e?.type||"integer"}}else;}}function q(e){const{layer:t}=e;return["imagery","imagery-tile","wcs"].includes(t.type)}async function G(e){return("imagery"===e.type||"imagery-tile"===e.type?await e.generateRasterInfo(e.rasterFunction).catch((()=>e.serviceRasterInfo)):"wcs"===e.type?e.serviceRasterInfo:void 0)??void 0}var J,j;!function(e){e.ARCGIS_COMPONENT_NOTIFICATIONS="arcgisComponent_notifications"}(J||(J={})),function(e){e.SMART_MAPPING_TIP1_DISMISSED="arcgis_smart_mapping_tip1_dismissed",e.SMART_MAPPING_TIP2_DISMISSED="arcgis_smart_mapping_tip2_dismissed"}(j||(j={}));const W=e=>{const t=(e=>localStorage.getItem(e))(e);return t?JSON.parse(t):{}},$=(e,t)=>{const i=W(e);i[t.key]=t.value,((e,t)=>{localStorage.setItem(e,t)})(e,JSON.stringify(i))},H=(e,t)=>{const i=W(e);return Object.keys(i).includes(t)?i[t]:null};function X(e){const{layer:t}=e;return t.renderer}function K(e){const{layer:t}=e,i=t;switch(i?.renderer?.type){case"flow":return"raster-flow";case"vector-field":return"raster-vector-field";case"class-breaks":return"raster-class-breaks";case"unique-value":return"raster-unique-value";case"raster-stretch":return function(e){const{layer:t,rasterInfo:i}=e,n=t,r="raster-stretch"===X(e)?.type;if(!r)return!1;const o=null!=n.bandIds&&n.bandIds?.length>1,s=i.bandCount>1,l=X(e).gamma?.length>1;return r&&(o||s&&l)}(e)?"raster-rgb":"raster-stretch";case"raster-shaded-relief":return"raster-shaded-relief";default:return i.renderer?.type}}function Y(e,t){const{modules:i}=e;Q(e,i.esriLang.clone(t||ce(e)))}function Q(e,t){const{layer:i}=e;i.renderer=t}async function Z(e){const{layer:t,modules:i}=e,n=t,r=n.rasterFunction;if(!n.bandIds){const e=await i.smartMappingRasterUtils.getDefaultBandCombination({layer:n,rasterFunction:r});n.bandIds=e}const o=await i.smartMappingRasterUtils.getSupportedRendererInfo({layer:n,rasterFunction:r});return Q(e,o.defaultRenderer),o.defaultRenderer}function ee(e,t){const{modules:i}=e;if(!t)return[new i.EsriColor([0,0,0,1]),new i.EsriColor([50,50,50,1]),new i.EsriColor([73,73,73,1]),new i.EsriColor([140,140,140,1]),new i.EsriColor([255,255,255,1])];if("multipart"!==t?.type)return[t.fromColor,t.toColor];const n=t.colorRamps??[],r=n.map((e=>e.fromColor));return r.push(n[n.length-1].toColor),r}const te="polygon";function ie(e){return ne(e,ce(e))}function ne(e,t){let i="unknown";if(!t)return i;const n=Qe(t,"size"),r=Qe(t,"color"),o=Ze(t,"color"),s=et(t,"color"),l=et(t,"size"),a=et(t,"reference-size");if(t.normalizationType&&"field"!==t.normalizationType)return"unknown";if("simple"===t.type)i="simple";else if("dot-density"===t.type)i="dot-density";else if("heatmap"===t.type)i="heatmap";else if("class-breaks"===t.type){const c=t;if(r)i=c.valueExpression&&!s?"color":n?l?.units?"color-size-age":s?.units?"color-age-size":"color-size":s?.style&&o.normalizationField?"compare":s?.units?n?"color-age-size":"color-age":a?"color-size":"color";else if(n)i="univariate-color-size"===c.authoringInfo?.type?"color-size":c.valueExpression&&!l?"size":l?.units?"size-age":"size";else{const n=t,r=n.authoringInfo;i=r?"class-breaks-color"===r.type?"color":"class-breaks-size"===r.type||a||de(n.classBreakInfos)?"size":"color":S(e)?n.valueExpression?de(n.classBreakInfos)?"size":"color":n.backgroundFillSymbol?"size":"color":de(n.classBreakInfos)?"size":"color"}}else"unique-value"===t.type?r||(i=t.valueExpression?t.authoringInfo&&"predominance"===t.authoringInfo.type||"Predominant category"===t.valueExpressionTitle?Qe(t,"size")?"predominance-size":"predominance":t.authoringInfo&&"relationship"===t.authoringInfo.type?Qe(t,"size")||a?"relationship-size":"relationship":Qe(t,"size")||a?"type-size":"type":n?l?.units?"type-size-age":"type-size":a?"type-size":"type"):"pie-chart"===t.type&&(i=Qe(t,"size")?"chart-size":"chart");return i}function re(e,t){const i=Ze(t,"color"),n=Ze(t,"size"),r=ne(e,t);i?.normalizationField?(t.normalizationField=i.normalizationField,t.normalizationType="field"):["color-size","color-age-size","color-size-age"].includes(r)&&i?(t.normalizationField=void 0,t.normalizationType=void 0):"size"===r&&n?.normalizationField&&(t.normalizationField=n.normalizationField,t.normalizationType="field")}function oe(e,t){t=t||ce(e);let i=[];switch(ne(e,t)){case"relationship":case"relationship-size":{i=[{field:t.authoringInfo.field1.field,simpleFieldType:r.NUMBER},{field:t.authoringInfo.field2.field,simpleFieldType:r.NUMBER}];const n=Ze(t,"size"),o=et(t,"reference-size");if(n){const t=z(e,n.field);i.push({field:n.field,expression:n.valueExpression,expressionTitle:n.valueExpressionTitle,simpleFieldType:n.field&&t?.simpleFieldType?t.simpleFieldType:r.NUMBER})}else o&&i.push({field:o.field,simpleFieldType:r.NUMBER});break}case"predominance":case"predominance-size":i=t.uniqueValueInfos.map((t=>({field:`${t.value}`,simpleFieldType:z(e,`${t.value}`)?.simpleFieldType||r.NUMBER})));break;case"chart":case"chart-size":i=t.attributes.map((t=>{const i=z(e,t.field);return{field:t.field,expression:t.valueExpression,expressionTitle:t.valueExpressionTitle,simpleFieldType:t.field&&i?i.simpleFieldType:r.NUMBER}}))}if(i.length)return i;switch(t.type){case"dot-density":i=t.attributes.map((t=>({field:t.field,simpleFieldType:z(e,t.field)?.simpleFieldType||r.NUMBER})));break;case"heatmap":{const n=t;i=n.field?[{field:n.field,simpleFieldType:z(e,n.field)?.simpleFieldType||r.NUMBER}]:[];break}case"class-breaks":{const n=t,o=z(e,n.field);i=[{field:n.field,expression:o?void 0:n.valueExpression,expressionTitle:o?void 0:n.valueExpressionTitle,simpleFieldType:n.field&&o?.simpleFieldType?o.simpleFieldType:r.NUMBER}];const s=Ze(t,"color"),l=Ze(t,"size"),a=et(t,"color"),c=et(t,"size"),u=et(t,"reference-size");if(s&&l)if(s.field===l.field&&s.valueExpression===l.valueExpression&&s.valueExpressionTitle===l.valueExpressionTitle){const t=z(e,s.field);i=[{field:s.field,expression:t?void 0:s.valueExpression,expressionTitle:t?void 0:s.valueExpressionTitle,simpleFieldType:s.field&&t?.simpleFieldType?t.simpleFieldType:r.NUMBER}]}else{if(a?.units)i=[{field:a.field,simpleFieldType:r.DATE}];else{const t=z(e,s.field);i=[{field:s.field,expression:t?void 0:s.valueExpression,expressionTitle:t?void 0:s.valueExpressionTitle,simpleFieldType:s.field&&t?.simpleFieldType?t.simpleFieldType:r.NUMBER}]}if(c?.units)i.push({field:c.field,simpleFieldType:r.DATE});else{const t=z(e,l.field);i.push({field:l.field,expression:t?void 0:l.valueExpression,expressionTitle:t?void 0:l.valueExpressionTitle,simpleFieldType:l.field&&t?.simpleFieldType?t.simpleFieldType:r.NUMBER})}}else if(s){if(a?.units)i=[{field:a.field,simpleFieldType:r.DATE}];else{const t=z(e,s.field);i=[{field:s.field,expression:t?void 0:s.valueExpression,expressionTitle:t?void 0:s.valueExpressionTitle,simpleFieldType:s.field&&t?.simpleFieldType?t.simpleFieldType:r.NUMBER}]}u&&i.push({field:u.field,simpleFieldType:r.NUMBER})}else if(l)if(c?.units)i=[{field:c.field,simpleFieldType:r.DATE}];else{const t=z(e,l.field);i=[{field:l.field,expression:t?void 0:l.valueExpression,expressionTitle:t?void 0:l.valueExpressionTitle,simpleFieldType:l.field&&t?.simpleFieldType?t.simpleFieldType:r.NUMBER}]}else u&&(i=[{field:u.field,simpleFieldType:r.NUMBER}]);if(a?.style&&s&&s.normalizationField){const t=z(e,s.field),n=z(e,s.normalizationField);i=[{field:s.field,simpleFieldType:t?.simpleFieldType?t.simpleFieldType:r.NUMBER},{field:s.normalizationField,simpleFieldType:n?.simpleFieldType?n.simpleFieldType:r.NUMBER}]}break}case"unique-value":if("predominance"===t.authoringInfo?.type){i=t.uniqueValueInfos.map((t=>{const i=z(e,`${t.value}`);return{field:`${t.value}`,simpleFieldType:i?i.simpleFieldType:r.NUMBER}}))}else if("chart"===t.authoringInfo?.type){i=t.uniqueValueInfos.map((t=>{const i=z(e,`${t.value}`);return{field:`${t.value}`,simpleFieldType:i?i.simpleFieldType:r.NUMBER}}))}else if("relationship"===t.authoringInfo?.type){const n=z(e,t.authoringInfo.field1.field),o=z(e,t.authoringInfo.field2.field);i=[{field:t.authoringInfo.field1.field,simpleFieldType:n?.simpleFieldType?n.simpleFieldType:r.NUMBER},{field:t.authoringInfo.field2.field,simpleFieldType:o?.simpleFieldType?o.simpleFieldType:r.NUMBER}]}else{const n=t,o=z(e,n.field);let s=r.NUMBER;n.field&&o?s=o.simpleFieldType||r.NUMBER:n.valueExpression&&n.uniqueValueInfos?.[0]&&"string"==typeof n.uniqueValueInfos[0].value&&(s=r.STRING),i=[{field:n.field,expression:o?void 0:n.valueExpression,expressionTitle:o?void 0:n.valueExpressionTitle,simpleFieldType:s}];const l=Ze(t,"size"),a=et(t,"reference-size");if(l){let n=l.field;if(!n){n=(et(t,"size")||{}).field}const o=z(e,n);i.push({field:n,expression:o?void 0:l.valueExpression,expressionTitle:o?void 0:l.valueExpressionTitle,simpleFieldType:n&&o?.simpleFieldType?o.simpleFieldType:r.NUMBER})}else a&&i.push({field:a.field,simpleFieldType:r.NUMBER})}}return i}function se(e,t,i=!1){if(!e||t&&5!==t.length)return{handlesSyncedToPrimary:!1,primaryHandleEnabled:!1,visibleElements:{interactiveTrack:!0}};switch(e){case"high-to-low":case"above":case"below":return{handlesSyncedToPrimary:!1,primaryHandleEnabled:!1,visibleElements:{interactiveTrack:!0}};case"above-and-below":return{handlesSyncedToPrimary:!1,primaryHandleEnabled:!0,syncedSegmentsEnabled:!i,visibleElements:{interactiveTrack:!i}};case"centered-on":case"extremes":return{handlesSyncedToPrimary:!1,primaryHandleEnabled:!0,syncedSegmentsEnabled:!0,visibleElements:{interactiveTrack:!0}}}}function le(e){const{mapView:t}=e,i=t.map.basemap.baseLayers.getItemAt(0);if(!i.url)return"esri.layers.OpenStreetMapLayer"===i.declaredClass?"osm":"topo";const n=i.url.toLowerCase();return n.includes("arcgis/rest/services/World_Street_Map".toLowerCase())?"streets":n.includes("ArcGIS/rest/services/Canvas/World_Light_Gray_Base".toLowerCase())?"gray":n.includes("arcgis/rest/services/World_Topo_Map".toLowerCase())||n.includes("arcgis/rest/services/USGSTopo".toLowerCase())?"topo":n.includes("ArcGIS/rest/services/World_Terrain_Base".toLowerCase())?"terrain":n.includes("arcgis/rest/services/NatGeo_World_Map".toLowerCase())?"national-geographic":n.includes("arcgis/rest/services/Ocean/World_Ocean_Base".toLowerCase())?"oceans":n.includes("arcgis/rest/services/World_Imagery".toLowerCase())?"satellite":n.includes("ArcGIS/rest/services/Reference/World_Boundaries_and_Places".toLowerCase())?"hybrid":n.includes("arcgis/rest/services/Canvas/World_Dark_Gray_Base".toLowerCase())?"dark-gray":"topo"}function ae(e,t,i){if(!(0,o.i)(t)||!(0,o.i)(i))return;const n=e[0].value,r=e[e.length-1].value,s=.3*(r-n);return{min:n-s>t?n-s:void 0,max:r+s<i?r+s:void 0,minMaxSame:n===r}}function ce(e){const{layer:t}=e,i=t,{useFeatureReduction:n}=e;return"featureReduction"in i&&"binning"===i.featureReduction?.type&&n?i.featureReduction.renderer:i.renderer}function ue(e,t){const i=ce(e),n="authoringInfo"in i?i.authoringInfo:void 0,r=et(ce(e),"color"),o=et(ce(e),"size");return et(ce(e),"reference-size")&&"size"===t?"reference-size":("color"===t?r?.theme:"size"===t?o?.theme:n?.univariateTheme||r?.theme||o?.theme)||""}function pe(e,t){const{layer:i,mapImageSublayer:n}=e;if("geo-rss"===i.type){const e=i;e.pointSymbol=e.pointSymbol.clone(),e.lineSymbol=e.lineSymbol.clone(),e.polygonSymbol=e.polygonSymbol.clone()}else!function(e,t){const{layer:i,useFeatureReduction:n}=e;"featureReduction"in i&&"binning"===i.featureReduction?.type&&n?i.featureReduction.renderer=t:!n&&"renderer"in i&&(i.renderer=t)}(e,(t||ce(e)).clone()),n&&(n.renderer=(t||ce(e)).clone())}function me(e,t,i){const{layer:n,modules:r}=e;i&&"featureReduction"in n&&(n.featureReduction=null),pe(e,r.rendererJsonUtils.fromJSON(t)),i&&"featureReduction"in n&&(n.featureReduction=i)}function de(e){let t,i;for(t=0;t<e.length;t++){const n=e[t].symbol;for(i=0;i<e.length;i++){const r=e[i].symbol;if(t!==i&&fe(n,r))return!0}}return!1}function fe(e,t){return"picture-marker"!==e.type&&("cross"===e.style||"x"===e.style?"cross"===t.style||"x"===t.style?!e.outline.color&&!t.outline.color||e.outline.color&&t.outline.color&&e.outline.color.toString()===t.outline.color.toString():!e.outline.color&&!t.color||e.outline.color&&t.color&&e.outline.color.toString()===t.color.toString():"cross"===t.style||"x"===t.style?!e.color&&!t.outline.color||e.color&&t.outline.color&&e.color.toString()===t.outline.color.toString():!e.color&&!t.color||e.color&&t.color&&e.color.toString()===t.color.toString())}function ye(e,t){const{modules:i}=e,n=ce(e),r=ie(e);if(["unique-size","unique-size-age"].includes(r))return null;let o;const s=Ze(n,"color"),l=n.classBreakInfos?n.classBreakInfos:n.uniqueValueInfos;let a;return s?(a=s.stops.map((e=>e.color)),o=i.colorSchemes.getMatchingSchemes({theme:t||"high-to-low",colors:a,geometryType:b(e)||te})):l&&l.length>=1&&(a=l?l.map((t=>ke(e,t.symbol))).filter((e=>e)):null,a?.length&&(a.length>10&&(a=a.slice(0,9)),o=function(e,t,i){const{modules:n}=e;let r=n.colorSchemes.getMatchingSchemes({theme:i||"high-to-low",colors:t,geometryType:b(e)||te});i&&(!r||r&&!r.length)&&(r=n.colorSchemes.getMatchingSchemes({theme:"high-to-low",colors:t,geometryType:b(e)||te}));(!r||r&&!r.length)&&(r=n.colorSchemes.getMatchingSchemes({theme:"above-and-below",colors:t,geometryType:b(e)||te}));return r}(e,a,t))),o?.length?o[0]:null}function ge(e){const{mapView:t,modules:i}=e,n=ce(e).uniqueValueInfos;if(!n||n.length<2)return null;const r=Math.sqrt(n.length),o=i.relationshipSchemes.getSchemes({basemap:t.map.basemap||"topo",geometryType:b(e)}),s=[o.primaryScheme].concat(o.secondarySchemes),l=[];return s.forEach((t=>{let o=[];t.colorsForClassBreaks[r-2].colors.forEach((e=>{o=o.concat(i.esriLang.clone(e))}));n.some((t=>{const i=ke(e,t.symbol);return!!i&&!o.find((e=>Ee(e,i)))}))||l.push(t)})),l.length?l[0]:null}function he(e,t){const{mapView:i,modules:n}=e,r=ce(e);if(!r.uniqueValueInfos||r.uniqueValueInfos.length<2)return null;return we(e,n.typeSchemes.getSchemes({basemap:i.map.basemap,geometryType:b(e)||te,numColors:t??r.uniqueValueInfos.length}))}function be(e){const{mapView:t,modules:i}=e,n=ce(e);if(!n.uniqueValueInfos||n.uniqueValueInfos.length<2)return null;return we(e,i.predominanceSchemes.getSchemes({basemap:t.map.basemap,geometryType:b(e),numColors:10}))}function Te(e){const{mapView:t,modules:i}=e,n=ce(e);if(!n.attributes||n.attributes.length<2)return null;return we(e,i.pieChartSchemes.getSchemes({basemap:t.map.basemap,geometryType:b(e),numColors:10}))}function Se(e){const{mapView:t,modules:i}=e,n=ce(e).colorStops.filter(((e,t)=>t>=3)).map((e=>e.color)),r=i.heatmapSchemes.getSchemes({basemap:t.map.basemap||"topo"}),o=[r.primaryScheme].concat(r.secondarySchemes),s=[];return o.forEach((e=>{n.some(((t,i)=>!Ee(e.colors[i],t)))||s.push(e)})),s.length?s[0]:null}function we(e,t){const i=ce(e).uniqueValueInfos;if(!i||i.length<2)return null;const n=Ie(t,Math.min(i.length,10)),r=[];return n.forEach((t=>{i.filter(((e,t)=>t<10)).some(((i,n)=>{const r=ke(e,i.symbol);return!!r&&!Ee(t.colors[n],r)}))||r.push(t.scheme)})),r.length?r[0]:null}function ve(e){const{mapView:t,modules:i}=e;return i.typeSchemes.getSchemes({basemap:t.map.basemap,geometryType:b(e)||te}).primaryScheme}function Ee(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b}function Ie(e,t){const i=Ne(e),n=[];return i.forEach((e=>{const i=t>0,r=!!e.colorsForClassBreaks;let o;o=i&&r?function(e,t){const i=e.length;let n=[];for(let r=0;r<i;r++){const i=e[r];if(t<i.numClasses)break;n=i.colors}return n}(e.colorsForClassBreaks,t):e.colors,n.push({colors:o,scheme:e})})),n}function Fe(e){const t=Ne(e);let i=[];return t.forEach((e=>{e.colors&&(i=i.concat(e.colors))})),function(e){const t={};return e.filter((e=>{const i=!t[e.toHex()];return i&&(t[e.toHex()]=1),i}))}(i)}function Ne(e){return[e.primaryScheme].concat(e.secondarySchemes)}function Ce(e,t){const{modules:i}=e,n=i.typeSchemes.getSchemes({theme:"default",basemap:le(e),geometryType:b(e)}).primaryScheme;let r;if(T(e)||t&&["size","color-size","color-age-size","color-size-age","color-age-size-age","type-size","predominance-size","chart-size","relationship-size"].includes(t)){const e=new i.SimpleLineSymbol({style:"solid",color:new i.EsriColor(n.outline.color),width:n.outline.width});r=new i.SimpleMarkerSymbol({style:"circle",size:n.size,outline:e,color:n.noDataColor})}else if(S(e)){const e=new i.SimpleLineSymbol({style:"solid",color:new i.EsriColor(n.outline.color),width:n.outline.width});r=new i.SimpleFillSymbol({style:"solid",outline:e,color:n.noDataColor})}else w(e)&&(r=new i.SimpleLineSymbol({style:"solid",color:new i.EsriColor(n.noDataColor),width:n.width}));return r}function xe(e,t){const{modules:i}=e,n=i.typeSchemes.getSchemes({theme:"default",basemap:le(e),geometryType:"line"===t?"polyline":t}).primaryScheme;let r;if("point"===t){const e=new i.SimpleLineSymbol({style:"solid",color:new i.EsriColor(n.outline.color),width:n.outline.width});r=new i.SimpleMarkerSymbol({style:"circle",size:n.size,outline:e,color:n.noDataColor})}else if("polygon"===t){const e=new i.SimpleLineSymbol({style:"solid",color:new i.EsriColor(n.outline.color),width:n.outline.width});r=new i.SimpleFillSymbol({style:"solid",outline:e,color:n.noDataColor})}else"line"===t&&(r=new i.SimpleLineSymbol({style:"solid",color:new i.EsriColor(n.noDataColor),width:n.width}));return r}function Re(e){const{modules:t}=e;return new t.SimpleFillSymbol({color:[184,184,184,1],style:"solid",outline:{type:"simple-line",color:"white",width:1}})}function ze(e,t){if(!t)return!1;let i=!1;const n=ke(e,t);if(t&&"esri.symbols.SimpleFillSymbol"===t.declaredClass){const e=t.outline;n&&0!==n.a||e&&(!e||e.color)&&0!==e.color.a||(i=!0)}else if(t&&"esri.symbols.SimpleLineSymbol"===t.declaredClass)n&&0!==n.a||(i=!0);else if(t&&"esri.symbols.SimpleMarkerSymbol"===t.declaredClass){const e=t.outline;n&&0!==n.a||e&&(!e||e.color)&&0!==e.color.a||(i=!0)}return i}function Me(e,t){const{modules:i}=e;if(t){return"dark"===i.previewSymbol2D.getContrastingBackgroundTheme(t,245)}return!1}function ke(e,t){const{modules:i}=e;return"cim"===t?.type?i.EsriColor.fromJSON(i.cimSymbolUtils.getCIMSymbolColor(t)?.toJSON()):"simple-marker"===t?.type&&["x","cross"].includes(t?.style)?t?.outline?.color:t?.color}function _e(e,t,i){const{modules:n}=e;"picture-marker"!==t.type&&("cim"===t.type?n.cimSymbolUtils.applyCIMSymbolColor(t,i):"simple-marker"===t.type&&t.style&&["cross","x"].includes(t.style)?(t.outline||(t.outline=new __esri.SimpleLineSymbol),t.outline.color=i):t.color=i)}function Ve(e,t){return e&&(e.a=t),e}function Oe(e,t){const{modules:i}=e;return"cim"===t.type?i.cimSymbolUtils.getCIMSymbolSize(t):t.size?t.size:t.width}function Le(e,t,i){const{modules:n}=e;if("cim"===t.type)n.cimSymbolUtils.scaleCIMSymbolTo(t,i);else if((0,o.i)(t.size))t.size=i;else{const e=t.height/t.width;t.width=i,t.height=t.width*e}}function Be(e){const t=e.data.symbol.symbolLayers?.find((e=>["CIMSolidStroke","CIMPictureStroke"].includes(e.type)));return t?.width??0}function De(e,t){const{modules:i}=e;return"cim"===t.type?i.cimSymbolUtils.getCIMSymbolRotation(t,!0):["simple-marker","picture-marker"].includes(t.type)?t.angle:void 0}function Ue(e,t,i){const{modules:n}=e;null!=i&&("cim"===t.type?n.cimSymbolUtils.applyCIMSymbolRotation(t,i,!0):["simple-marker","picture-marker"].includes(t.type)&&(t.angle=i))}function Ae(e){return"picture-marker"!==e.type&&("cim"===e.type?["CIMPolygonSymbol"].includes(e.data.symbol.type)&&!!Je(e):!!e.outline?.color)}function Pe(e,t,i){if(t.uniqueValueInfos?.length){const n=t.uniqueValueInfos.slice();n.forEach((t=>{const n=i.clone();_e(e,n,ke(e,t.symbol)),t.symbol=n})),t.uniqueValueInfos=n}else if(t.classBreakInfos?.length){const n=t.classBreakInfos.slice();n.forEach((t=>{const n=i.clone();_e(e,n,ke(e,t.symbol)),t.symbol=n})),t.classBreakInfos=n}else if(t.symbol){const n=i.clone();_e(e,n,ke(e,t.symbol)),t.symbol=n}}function qe(e,t,i){if(t.uniqueValueInfos?.length){const n=t.uniqueValueInfos.slice();n.forEach((t=>{const n=i.clone();_e(e,n,ke(e,t.symbol)),t.symbol=n})),t.uniqueValueInfos=n}else if(t.classBreakInfos?.length){const n=t.classBreakInfos.slice();n.forEach((t=>{const n=i.clone();_e(e,n,ke(e,t.symbol)),t.symbol=n})),t.classBreakInfos=n}else if(t.symbol){const n=i.clone();_e(e,n,ke(e,t.symbol)),t.symbol=n}}function Ge(e){return"cim"===e.type&&"CIMLineSymbol"===e.data.symbol?.type}function Je(e){if("CIMPointSymbol"!==e.data.symbol?.type)return"CIMLineSymbol"===e.data.symbol?.type?function(e){const t=e.data.symbol.symbolLayers;return t[0]}(e):"CIMPolygonSymbol"===e.data.symbol?.type?function(e){const t=e.data.symbol.symbolLayers;return t.find((e=>"CIMSolidStroke"===e.type))}(e):void 0}function je(e){const{mapImageSublayer:t,layer:i}=e;return!t||!!i.sourceJSON?.cimVersion}function We(e){return!(!e.style||!["cross","x"].includes(e.style))}function $e(e,t){return"picture-marker"===t.type||"cim"===t.type&&!function(e,t){const{modules:i}=e;return!!i.cimSymbolUtils.getCIMSymbolColor(t)}(e,t)}function He(e,t){return"simple-line"===e.type?{width:12,height:3}:"cim"===e.type&&"CIMLineSymbol"===e.data.symbol.type?void 0:"simple-fill"===e.type?14:"cim"===e.type&&"CIMPolygonSymbol"===e.data.symbol.type?t?18:void 0:"cim"===e.type?20:14}function Xe(e,t,i){if(t.type!==i.type)return{hasOtherChanges:!0,any:!0};const n=De(e,t)!==De(e,i),r=Math.abs(Oe(e,t)-Oe(e,i))>.01,o=JSON.stringify(ke(e,t)?.toJSON())!==JSON.stringify(ke(e,i)?.toJSON()),s=!!["simple-marker","simple-fill"].includes(t.type)&&JSON.stringify(t.outline?.toJSON())!==JSON.stringify(i.outline?.toJSON()),l=t.clone();Le(e,l,Oe(e,i)),_e(e,l,ke(e,i)),["simple-marker","simple-fill"].includes(t.type)&&(l.outline=i.outline.clone()),Ue(e,l,De(e,i));const a=!function(e,t){if(JSON.stringify(e.toJSON())===JSON.stringify(t.toJSON()))return!0;if("cim"===e.type&&"cim"===t.type)return Ye(e.toJSON().symbol,t.toJSON().symbol);return!1}(l,i);return{rotation:n&&!r&&!o&&!s&&!a,size:r&&!n&&!o&&!s&&!a,outline:s&&!n&&!r&&!o&&!a,color:o&&!n&&!r&&!s&&!a,other:a,any:n||r||s||o||a}}function Ke(e,t,i,n,r){return r.rotation?Ue(e,t,De(e,i)):r.size?Le(e,t,Oe(e,i)):r.color?("picture-marker"===t.type&&(t=i.clone()),_e(e,t,n)):r.outline?"picture-marker"===t.type?t=i.clone():t.outline=i.outline?.clone():_e(e,t=i.clone(),n),t}function Ye(e,t){const i=Object.keys,n=typeof e;return e&&t&&"object"===n&&n===typeof t?i(e).length===i(t).length&&i(e).every((i=>"size"===i||"width"===i?Math.abs(e[i]-t[i])<.01:Ye(e[i],t[i]))):e===t}function Qe(e,t,i){const n=e&&e.visualVariables;return!!n&&n.some((e=>{const n=e.target,r="$view.scale"===e.valueExpression;return e.type===t&&(!(0,o.i)(n)&&!(0,o.i)(i)&&!r||n===i||"auto"===i&&r)}))}function Ze(e,t,i){const n=e&&e.visualVariables;if(n){const e=n.filter((e=>{const n=e.target,r="$view.scale"===e.valueExpression;return e.type===t&&(!(0,o.i)(n)&&!(0,o.i)(i)&&!r||n===i||"auto"===i&&r&&!n)}));if(e.length)return e[0]}}function et(e,t,i){if(!e?.authoringInfo)return;const n=e?.authoringInfo?.visualVariables;if(n){const e=n.filter((e=>{const n=e.target;return"reference-size"===t?"size"===e.type&&"reference-size"===e.theme:e.type===t&&(!(0,o.i)(n)&&!(0,o.i)(i)||n===i)}));if(e.length)return e[0]}}function tt(e,t,i){const n=e&&e.visualVariables;if(n){const e=n.filter((e=>{const n=e.target,r="$view.scale"===e.valueExpression;return!(e.type===t&&(!(0,o.i)(n)&&!(0,o.i)(i)&&!r||n===i||"auto"===i&&r))}));if(e.length)return e}}function it(e,t,i){if(!("authoringInfo"in e)||!e.authoringInfo)return;let n=e?.authoringInfo?.visualVariables;if(n){"reference-size"===t&&(n=n.filter((e=>!("size"===e.type&&"reference-size"===e?.theme))));const e=n.filter((e=>{const n=e.target;return!(e.type===t&&(!(0,o.i)(n)&&!(0,o.i)(i)||n===i))}));if(e.length)return e}}function nt(e){const t=Ze(e,"size","outline"),i=Ze(e,"size","auto"),n=Ze(e,"rotation");return{sizeOutlineVisVar:t,sizeAutoVisVar:i,opacityVisVar:Ze(e,"opacity"),authOpacityVisVar:et(e,"opacity"),rotationVisVar:n}}function rt(e,t,i){const{sizeOutlineVisVar:n,opacityVisVar:r,authOpacityVisVar:o,rotationVisVar:s}=e;!et(t,"reference-size")&&n&&(t.visualVariables=tt(t,"size","outline")||[],t.visualVariables.push(n)),r&&o&&!i?.notOpacity&&(t.visualVariables=tt(t,"opacity")||[],t.visualVariables.push(r),t.authoringInfo=t.authoringInfo||{},t.authoringInfo.visualVariables=it(t,"opacity")||[],t.authoringInfo.visualVariables.push(o)),s&&(t.visualVariables=t.visualVariables||[],t.visualVariables.push(s))}var ot;!function(e){e.NONE="none",e.MINIMUM_MAXIMUM="min-max",e.PERCENT_CLIP="percent-clip",e.STANDARD_DEVIATION="standard-deviation"}(ot||(ot={}));const st={STD_DEV:2,MIN_PERCENT:2,MAX_PERCENT:2,GAMMA:1,STRETCH_TYPE:ot.NONE};async function lt(e){const{layer:t,modules:i}=e,n=t,r="imagery"===n.type?n.rasterFunction:void 0;return n.bandIds=await ct(e),await i.RasterRGBCreator.createRenderer({layer:n,rasterFunction:r,rgbBandIds:n.bandIds}).then((t=>(n.effect=void 0,Y(e,t.renderer),t)))}async function at(e,t){const{layer:i,modules:n}=e,r=i,o=X(e),s="imagery"===r.type?r.rasterFunction:void 0;return t=t||{},await n.RasterRGBCreator.createRenderer({layer:r,rasterFunction:s,rgbBandIds:r.bandIds,stretchType:t.stretchType||o.stretchType,useGamma:t.useGamma||o.useGamma,gamma:t.gamma||o.useGamma?o.gamma:[1,1,1]}).then((e=>(e.renderer.dynamicRangeAdjustment=o.dynamicRangeAdjustment,e.renderer.colorRamp=o.colorRamp,e.renderer.customStatistics=o.customStatistics,v(e.renderer.numberOfStandardDeviations)&&0!==e.renderer.numberOfStandardDeviations||(e.renderer.numberOfStandardDeviations=st.STD_DEV),e)))}async function ct(e){const{layer:t,rasterInfo:i,modules:n}=e,r=t,{bandCount:o}=i,s=await n.smartMappingRasterUtils.getDefaultBandCombination({layer:r}),l=s.length;return l!==o&&s.push(...new Array(3-l).fill(o-1)),3!==r.bandIds?.length&&(r.bandIds=s),r.bandIds}var ut;!function(e){e.NONE="none",e.MINIMUM_MAXIMUM="min-max",e.PERCENT_CLIP="percent-clip",e.STANDARD_DEVIATION="standard-deviation"}(ut||(ut={}));const pt={STD_DEV:2,MIN_PERCENT:2,MAX_PERCENT:2,GAMMA:1,BAND_INDEX:0,STRETCH_TYPE:ut.NONE};async function mt(e){const{layer:t,modules:i}=e,n=t,r="imagery"===n.type?n.rasterFunction??void 0:void 0;return n.bandIds=[0],await i.RasterStretchCreator.createRenderer({layer:n,rasterFunction:r}).then((t=>(n.effect=void 0,Y(e,t.renderer),t)))}async function dt(e,t){const{layer:i,modules:n}=e,r=i,o=X(e),s="imagery"===r.type?r.rasterFunction??void 0:void 0;return t=t||{},await n.RasterStretchCreator.createRenderer({layer:r,rasterFunction:s,stretchType:t.stretchType||o.stretchType,useGamma:t.useGamma||o.useGamma,gamma:t.gamma||o.useGamma&&o.gamma?.[0]?o.gamma[0]:1}).then((e=>(e.renderer.dynamicRangeAdjustment=o.dynamicRangeAdjustment,e.renderer.colorRamp=o.colorRamp,e.renderer.customStatistics=o.customStatistics,v(e.renderer.numberOfStandardDeviations)&&0!==e.renderer.numberOfStandardDeviations||(e.renderer.numberOfStandardDeviations=pt.STD_DEV),e)))}async function ft(e){const{layer:t,modules:i}=e,n=t,r="imagery"===n.type?n.rasterFunction??void 0:void 0;return await i.RasterUniqueValueCreator.createRenderer({layer:n,rasterFunction:r})}async function yt(e,t){const{layer:i,modules:n}=e,r=i,o=X(e),s="imagery"===r.type?r.rasterFunction??void 0:void 0;return t=t||{},await n.RasterUniqueValueCreator.createRenderer({layer:r,rasterFunction:s,classFieldName:t.field||o.field,colorRamp:t.colorRamp??null})}function gt(e){const{rasterInfo:t,modules:i,strings:n}=e;let r;const o=t?.attributeTable?.fields;return r=o?o.filter((e=>"oid"!==e.type)):[new i.Field({name:"value",alias:n.panels.uniqueValue.value})],r}}}]);