/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-c7e597.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-c7e597"],{88117:(e,t,i)=>{i.r(t),i.d(t,{arcgis_smart_mapping_field_pick_list:()=>B,arcgis_smart_mapping_panels_assist:()=>Q,arcgis_smart_mapping_panels_chart_size:()=>Y,arcgis_smart_mapping_panels_color_size:()=>Z,arcgis_smart_mapping_panels_color_size_univariate:()=>X,arcgis_smart_mapping_panels_compare:()=>ee,arcgis_smart_mapping_panels_dot_density:()=>te,arcgis_smart_mapping_panels_heatmap:()=>ie,arcgis_smart_mapping_panels_predominance_size:()=>ae,arcgis_smart_mapping_panels_relationship_size:()=>se,arcgis_smart_mapping_panels_simple:()=>ne,arcgis_smart_mapping_panels_type_size:()=>re});var a=i(28614),s=i(68180),n=i(99592),r=i(97127),l=i(14471),o=i(33101),c=i(80216),d=i(84521),p=i(58944),h=i(5738),m=i(78567),g=i(63625),u=i(58825),S=i(67751),y=i(372),f=i(79323),b=i(54351),C=i(39304),v=i(58325),w=i(42444);i(71480),i(99818);function M(e,t){const i=e.slice(0);let a,s,n,r,l,o,c,d,p,h,m=0;const g=!t||(null==t.tolerance?2:t.tolerance);let u=t?.indexes;const S=!t||null!=t.strictBounds&&t.strictBounds,y=(e,t)=>e-t;if(u)u.sort(y);else for(u=[],c=0;c<i.length;c++)u.push(c);for(c=0;c<u.length;c++)if(h=u[c],a=i[h],s=0===h?void 0:i[h-1],n=h===i.length-1?void 0:i[h+1],r=k(a),l=r.fractional,l){for(d=0,p=!1;d<=l&&!p;)o=z(a,d),m=S&&0===c?o[1]:o[0],p=P(a,m,s,n,g),d++;p&&(i[h]=m)}return i}function k(e){const t=String(e),i=t.match(/^-?(\d+)(\.(\d+))?$/i);let a={integer:0,fractional:0};if(i?.[1])a.integer=i[1].split("").length,a.fractional=i[3]?i[3].split("").length:0;else if(t.toLowerCase().includes("e")){const e=t.split("e"),i=e[0],s=e[1];let n,r;if(i&&s){const e=Number(i);let t=Number(s);r=t>0,r||(t=Math.abs(t)),n=k(e),r?(n.integer+=t,t>n.fractional?n.fractional=0:n.fractional-=t):(n.fractional+=t,t>n.integer?n.integer=1:n.integer-=t),a=n}}return a}function z(e,t){let i,a;return i=Number(e.toFixed(t)),i<e?a=i+1/10**t:(a=i,i-=-1/10**t),i=Number(i.toFixed(t)),a=Number(a.toFixed(t)),[i,a]}function P(e,t,i,a,s){const n=function(e,t,i,a){const s={prev:null,next:null};let n,r,l;null!=i&&(n=e-i,r=t-i,l=r-n,s.prev=Math.floor(Math.abs(100*l/n)));null!=a&&(n=a-e,r=a-t,l=r-n,s.next=Math.floor(Math.abs(100*l/n)));return s}(e,t,i,a),r=null==n.prev||n.prev<=s,l=null==n.next||n.next<=s;return r&&l||n.prev+n.next<=2*s}const B=class{constructor(e){(0,a.r)(this,e),this.arcgisSmartMappingFieldPickListClose=(0,a.c)(this,"arcgisSmartMappingFieldPickListClose",7),this.arcgisSmartMappingFieldPickListChange=(0,a.c)(this,"arcgisSmartMappingFieldPickListChange",7),this.arcgisSmartMappingFieldPickListSortByChange=(0,a.c)(this,"arcgisSmartMappingFieldPickListSortByChange",7),this.manager=(0,r.u)(this),this.maxNumberFieldCount=10,this.selectedFields=[],this.fields=void 0,this.fieldToReplace=void 0,this.popoverProps=void 0,this.singleEditMode=!1,this.heading=void 0,this.okBtnText=void 0,this.filterPlaceholderText=void 0,this.lastSortBy="default",this.smartMappingState=void 0,this.filterFields=void 0,this.isOpen=!1,this.width=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async reposition(){await(this.popoverNode?.reposition())}async componentWillLoad(){this.isOpen=!0,this.rendererFieldInfosMap=this.smartMappingState.selectedFields?.reduce(((e,t)=>(e[t.field]=t,e)),{})}componentDidLoad(){this.setUpObservers(),this.resizeObserver?.observe(this.popoverProps.refElement);this.checkDisabledListItems().forEach((e=>this.listNode.removeChild(e))),requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())))}disconnectedCallback(){this.mutationObserver?.disconnect(),this.resizeObserver?.unobserve(this.popoverProps.refElement)}render(){const e=this.popoverProps,{isRTL:t,strings:i}=this.smartMappingState;return(0,a.h)(a.H,{key:"022a4b4c36d1018aba6162ba005cc85f18b881b1",class:"js-app-flyout"},(0,a.h)("calcite-popover",{key:"79a1e64e868df71b2e6585970fb9fbde52055eac",dir:t?"rtl":"ltr",class:"smart-mapping-field-pick-list-popover",placement:e.placement||"leading-start",open:this.isOpen,pointerDisabled:!0,referenceElement:e.refElement,offsetDistance:e.offsetDistance??-1*(e.popoverWidth??this.width)+10,offsetSkidding:e.offsetSkidding||0,overlayPositioning:e.overlayPositioning,triggerDisabled:e.triggerDisabled,label:this.heading||(this.singleEditMode?i.replaceField:i.fieldPickList.selectFields),ref:e=>this.popoverNode=e},(0,a.h)("calcite-flow",{key:"e8f44186d27b3ea05db3df01d617d222b02936b4",ref:e=>this.flowNode=e,style:{width:`${this.width||e.popoverWidth}px`}},(0,a.h)("calcite-flow-item",{key:"6ebdde49347869a027bbd7381d7195db8b1e37f4",ref:e=>this.flowItemNode=e,class:"panel",heading:this.heading||(this.singleEditMode?i.replaceField:i.fieldPickList.selectFields),closable:!0,onCalciteFlowItemClose:()=>this.arcgisSmartMappingFieldPickListClose.emit()},!this.singleEditMode&&this.renderAddButton(),this.renderCancelButton(),this.renderList()))))}renderAddButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",appearance:"solid",width:"half",onClick:()=>this.arcgisSmartMappingFieldPickListClose.emit({selectedFields:this.selectedFields})},this.okBtnText||e.add)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",appearance:"outline-fill",width:this.singleEditMode?"full":"half",onClick:()=>this.arcgisSmartMappingFieldPickListClose.emit()},e.cancel)}renderList(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-list",{label:e.fieldPickList.fields,selectionMode:this.singleEditMode?"single-persist":"multiple",ref:e=>this.listNode=e,class:"content",filterEnabled:this.fields.length>=10,filterPlaceholder:this.filterPlaceholderText??e.fieldPickList.searchFields,onCalciteListFilter:()=>{this.filterFields=this.listNode?.filteredItems?.map((e=>e.value))}},this.renderSortDropdown(),this.renderListItems())}renderListItems(){return"type"===this.lastSortBy?this.renderItemsSortedByType():["display","field"].includes(this.lastSortBy)?[...this.getSortedList()].map((e=>this.renderListItem(e))):[...this.fields].map((e=>this.renderListItem(e)))}renderItemsSortedByType(){const e=[...this.getSortedList()];return e.filter((e=>e.simpleFieldType===n.q.NUMBER)).map((e=>this.renderListItem(e))).concat(e.filter((e=>e.simpleFieldType===n.q.STRING)).map((e=>this.renderListItem(e)))).concat(e.filter((e=>e.simpleFieldType===n.q.DATE)).map((e=>this.renderListItem(e)))).concat(e.filter((e=>e.simpleFieldType===n.q.OID)).map((e=>this.renderListItem(e)))).concat(e.filter((e=>e.simpleFieldType===n.q.GUID)).map((e=>this.renderListItem(e)))).concat(e.filter((e=>e.simpleFieldType===n.q.UNKNOWN)).map((e=>this.renderListItem(e))))}renderListItem(e){const{layer:t,useFeatureReduction:i,mapView:s,fullLocale:n,strings:r}=this.smartMappingState,l="featureReduction"in t&&"binning"===t.featureReduction?.type&&i;return(0,a.h)("calcite-list-item",{key:e.layerField.name,label:e.label||e.layerField.name,"data-type":e.simpleFieldType,value:e.layerField.name,selected:this.singleEditMode&&e.layerField.name===this.fieldToReplace.field,metadata:{label:e.label,fieldName:e.layerField.name},onCalciteListItemSelect:()=>{this.selectedFields=this.listNode.selectedItems.map((e=>e.value)),this.singleEditMode?this.selectedFields[0]!==this.fieldToReplace.field&&this.arcgisSmartMappingFieldPickListClose.emit({selectedFields:this.selectedFields}):(this.checkDisabledListItems(),this.arcgisSmartMappingFieldPickListChange.emit({selectedFields:this.selectedFields}))}},!l&&(0,a.h)("calcite-action",{slot:"actions-end",text:r.fieldPickList.info,scale:"s",icon:"information",onClick:i=>{i.stopPropagation();const a=i.target,r=document.createElement("calcite-flow-item");r.heading=e.label??e.layerField.name,r.description=e.layerField.name;const l=document.createElement("arcgis-field-info");l.lang=n,l.fieldName=e.layerField.name,l.layer=t,l.view=s,l.classList.add("content"),r.appendChild(l),r.addEventListener("calciteFlowItemBack",(()=>{requestAnimationFrame((async()=>await a.setFocus())),r.removeChild(l),this.flowNode.removeChild(r),this.flowItemNode.selected=!0})),this.flowNode.appendChild(r),r.selected=!0,this.flowItemNode.selected=!1,requestAnimationFrame((async()=>await r.setFocus()))}}))}renderSortDropdown(){const{strings:e}=this.smartMappingState;return this.fields.length>10?(0,a.h)("calcite-dropdown",{placement:"bottom-end",overlayPositioning:"fixed",slot:"filter-actions-end",ref:e=>this.dropdownNode=e,onCalciteDropdownOpen:()=>{this.mutationObserver?.disconnect(),this.mutationObserver?.observe(this.popoverNode,{attributes:!0})},onCalciteDropdownClose:()=>this.mutationObserver?.disconnect()},(0,a.h)("calcite-action",{slot:"trigger",text:e.fieldPickList.sort,title:e.fieldPickList.sort},(0,a.h)("calcite-icon",{scale:"s",icon:"sortDescending"})),(0,a.h)("calcite-dropdown-group",null,(0,a.h)("calcite-dropdown-item",{label:"default",selected:"default"===this.lastSortBy,onClick:()=>{this.lastSortBy="default",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy)}},e.fieldPickList.default),(0,a.h)("calcite-dropdown-item",{label:"display",selected:"display"===this.lastSortBy,onClick:()=>{this.lastSortBy="display",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy)}},e.fieldPickList.displayName),(0,a.h)("calcite-dropdown-item",{label:"type",selected:"type"===this.lastSortBy,onClick:()=>{this.lastSortBy="type",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy)}},e.fieldPickList.type),(0,a.h)("calcite-dropdown-item",{label:"field",selected:"field"===this.lastSortBy,onClick:()=>{this.lastSortBy="field",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy)}},e.fieldPickList.fieldName))):(0,a.h)(a.F,null)}checkDisabledListItems(){const{smartMappingState:e}=this,{mapImageSublayer:t,supportsArcade:i}=e;if(!this.listNode)return;const a=(0,n.y)(e);this.singleEditMode?a[this.fieldToReplace.simpleFieldType]--:this.selectedFields.forEach((t=>{const i=(0,n.o)(e,t);if(i){switch(i.simpleFieldType){case"number":a.number++;break;case"string":a.string++;break;case"date":a.date++}}}));const s=[];if(this.listNode.querySelectorAll("calcite-list-item").forEach((e=>this.enableListItem(e))),t&&!i&&a.number+a.string+a.date+a.unknown===1)this.listNode.querySelectorAll('[data-type="string"], [data-type="number"], [data-type="date"]').forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),s.push(t))}));else if(t&&a.number+a.string+a.date+a.unknown===1&&1===a.date)this.listNode.querySelectorAll('[data-type="date"]').forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),s.push(t))}));else if(1===a.string)this.listNode.querySelectorAll('[data-type="string"]').forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),s.push(t))})),1!==a.number&&1!==a.date&&1!==a.unknown||this.listNode.querySelectorAll('[data-type="number"], [data-type="date"]').forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),s.push(t))}));else if(a.number+a.date+a.unknown>1)if(a.expression>0&&(1!==a.expression||3!==this.selectedFields.length||!this.rendererFieldInfosMap[this.selectedFields[2]].expression)||a.date>0&&2===a.number&&!this.singleEditMode||2===a.date||t&&a.date>0){let e;e=this.singleEditMode?this.fieldToReplace.simpleFieldType===n.q.NUMBER?'[data-type="date"], [data-type="string"]':n.q.STRING?'[data-type="date"], [data-type="number"]':'[data-type="string"], [data-type="number"]':'[data-type="date"], [data-type="string"], [data-type="number"]',this.listNode.querySelectorAll(e).forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),s.push(t))}))}else this.listNode.querySelectorAll('[data-type="string"]').forEach((e=>{const t=e;this.disableListItem(t),s.push(t),this.selectedFields.includes(t.value)&&(t.selected=!1)})),(a.number>2||t)&&this.listNode.querySelectorAll('[data-type="date"]').forEach((e=>{const t=e;this.disableListItem(t),s.push(t),this.selectedFields.includes(t.value)&&(t.selected=!1)})),1===a.date&&this.listNode.querySelectorAll('[data-type="date"]').forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),s.push(t))})),a.number>=this.maxNumberFieldCount&&this.listNode.querySelectorAll('[data-type="number"], [data-type="date"]').forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),s.push(t))}));return s}disableListItem(e){e.disabled=!0;const t=e.querySelector("calcite-action");t&&(t.disabled=!0)}enableListItem(e){e.disabled=!1;const t=e.querySelector("calcite-action");t&&(t.disabled=!1)}getSortedList(){const e=[...this.fields];return"field"===this.lastSortBy?e.sort(((e,t)=>e.layerField.name.startsWith("_")?1:t.layerField.name.startsWith("_")?-1:e.layerField.name.localeCompare(t.layerField.name))):e.sort(((e,t)=>e.label.startsWith("_")?1:t.label.startsWith("_")?-1:e.label.localeCompare(t.label))),e}setUpObservers(){this.mutationObserver=new MutationObserver((e=>{for(const t of e)"style"===t.attributeName&&"hidden"===this.popoverNode.style.visibility&&(this.dropdownNode.open=!1)})),this.resizeObserver=new ResizeObserver((e=>{const t=e.pop();this.width=1.05*t.contentRect.width}))}get el(){return(0,a.g)(this)}};B.style=".smart-mapping-field-pick-list-popover{--calcite-popover-z-index:100}.panel{min-height:300px}.content{max-height:60vh}.selection-button-div{padding:4px 10px}";const T=["Age (color)","Age (size)","Charts","Charts and Size","Color (age) and Size","Color and Size","Color and Size (age)","Color and Size (univariate)","Compare A to B","Continuous Timeline (color)","Continuous Timeline (size)","Counts and Amounts (color)","Counts and Amounts (size)","Counts and Amounts (opacity)","Counts and Amounts (classed color)","Discrete Time Periods (categories)","Dot Density","Heat Map","Predominant category","Predominant category and Size","Relationship","Relationship and size","Types (unique symbols)","Types and Size","Types and Size (age)"],F=["Counts and Amounts (color)","Counts and Amounts (size)","Counts and Amounts (opacity)","Continuous Timeline (color)","Continuous Timeline (size)","Predominant category and Size"],E={"Counts and Amounts (color)":x,"Counts and Amounts (size)":R,"Counts and Amounts (opacity)":O,"Continuous Timeline (color)":x,"Continuous Timeline (size)":R,"Predominant category and Size":R},N={"Counts and Amounts (color)":$,"Counts and Amounts (size)":U,"Counts and Amounts (opacity)":J,"Continuous Timeline (color)":$,"Continuous Timeline (size)":U,"Predominant category and Size":j},L={"Age (color)":V,"Age (size)":_,Charts:q,"Charts and Size":q,"Color (age) and Size":async function(e,t){const{fields:i,layer:a,view:s,theme:n,colorSchemeTags:r}=e,l=await V({styleName:"Age (color)",fields:[i[0]],theme:n,layer:a,view:s,colorSchemeTags:r},t),o=await U({styleName:"Counts and Amounts (size)",fields:[i[1]],theme:"above",layer:a,view:s},t);return{colorAgeStyleParams:l,sizeStyleParams:o}},"Color and Size":async function(e,t){const{fields:i,layer:a,view:s,theme:n,colorSchemeTags:r}=e,l=await A({styleName:"Counts and Amounts (color)",fields:[i[0]],theme:n,layer:a,view:s,colorSchemeTags:r},t),o=await U({styleName:"Counts and Amounts (size)",fields:[i[1]],theme:"above",layer:a,view:s},t);return{colorStyleParams:l,sizeStyleParams:o}},"Color and Size (age)":async function(e,t){const{fields:i,layer:a,view:s,theme:n,colorSchemeTags:r}=e,l=await A({styleName:"Counts and Amounts (color)",fields:[i[0]],theme:n,layer:a,view:s,colorSchemeTags:r},t),o=await _({styleName:"Age (size)",fields:[i[1]],theme:"above",layer:a,view:s});return{colorStyleParams:l,sizeAgeStyleParams:o}},"Color and Size (univariate)":async function(e,t){const{fields:i,layer:a,view:s,theme:n,colorSchemeTags:r}=e,{modules:l}=t;let o;const c=i[0];r&&(o=l.colorSchemes.getSchemesByTag({geometryType:a.geometryType,includedTags:r,theme:n||"high-to-low"})[0]);return{layer:a,view:s,field:c,normalizationField:undefined,theme:n,colorOptions:{colorScheme:o}}},"Compare A to B":A,"Continuous Timeline (color)":A,"Continuous Timeline (size)":U,"Counts and Amounts (color)":A,"Counts and Amounts (size)":U,"Counts and Amounts (opacity)":J,"Counts and Amounts (classed color)":A,"Discrete Time Periods (categories)":D,"Dot Density":async function(e,t){const{fields:i,layer:a,view:s,colorSchemeTags:n}=e,{modules:r}=t;let l;n&&(l=r.dotDensitySchemes.getSchemesByTag({includedTags:n,numColors:Math.min(i.length,8)})[0]);return{layer:a,view:s,legendOptions:{unit:"units"},attributes:i.map((e=>({field:e,label:a.fields.find((t=>t.name===e))?.alias??""}))).slice(0,8),outlineOptimizationEnabled:!0,dotDensityScheme:l}},"Heat Map":async function(e,t){const{fields:i,layer:a,view:s,colorSchemeTags:n}=e,{modules:r}=t;let l;const o=i[0];n&&(l=r.heatmapSchemes.getSchemesByTag({includedTags:n,basemap:s.map.basemap||"topo"})[0]);return{layer:a,view:s,field:o,heatmapScheme:l}},"Predominant category":j,"Predominant category and Size":j,Relationship:H,"Relationship and size":async function(e,t){const{fields:i,layer:a,view:s,colorSchemeTags:n}=e,r=await H({styleName:"Relationship",layer:a,view:s,fields:[i[0],i[1]],colorSchemeTags:n},t),l=i[2]?await U({styleName:"Counts and Amounts (size)",fields:[i[2]],theme:"above",layer:a,view:s},t):null;return{relationshipStyleParams:r,sizeStyleParams:l}},"Types (unique symbols)":D,"Types and Size":async function(e,t){const{fields:i,layer:a,view:s,colorSchemeTags:n}=e,r=await D({styleName:"Types and Size",layer:a,view:s,fields:[i[0]],colorSchemeTags:n},t),l=await U({styleName:"Counts and Amounts (size)",fields:[i[1]],theme:"above",layer:a,view:s},t);return{typesStyleParams:r,sizeStyleParams:l}},"Types and Size (age)":async function(e,t){const{fields:i,layer:a,view:s,colorSchemeTags:n}=e,r=await D({styleName:"Types and Size",layer:a,view:s,fields:[i[0]],colorSchemeTags:n},t),l=await _({styleName:"Age (size)",fields:[i[1]],theme:"above",layer:a,view:s});return{typesStyleParams:r,sizeAgeStyleParams:l}}};async function I(e,t,i){const a="update"===t?await async function(e,t){const i=await async function(e,t){let{styleName:i}=e;if(!F.includes(i)){const t=F.map((e=>e.toLocaleLowerCase()));if(!t.includes(i.toLocaleLowerCase()))throw new Error(`Unsupported update method: ${i}`);{const a=F[t.indexOf(i.toLocaleLowerCase())];i=a,e.styleName=i}}const a=N[i](e,t);return await a}(t,e),{styleName:a}=t,{renderer:s}=await E[a](e,i);return s}(e,i):await async function(e,t){const i=await async function(e,t){let{styleName:i}=t;if(!T.includes(i)){const e=T.map((e=>e.toLocaleLowerCase()));if(!e.includes(i.toLocaleLowerCase()))throw new Error(`Unrecognized style: ${i}`);{const a=T[e.indexOf(i.toLocaleLowerCase())];i=a,t.styleName=i}}const a=L[i](t,e);return await a}(e,t),{styleName:a,view:s}=t,{renderer:r}=await function(e,t,i){const{modules:a}=e;switch(t){case"Age (color)":return a.ColorCreator.createAgeRenderer(i);case"Age (size)":return a.SizeCreator.createAgeRenderer(i);case"Charts":case"Charts and Size":return a.PieChartCreator.createRenderer(i);case"Color (age) and Size":return async function(e,t){const{colorAgeStyleParams:i,sizeStyleParams:a}=t,{modules:s}=e,{renderer:n,visualVariable:r}=await s.ColorCreator.createAgeRenderer(i),{renderer:l}=await s.SizeCreator.createContinuousRenderer(a),o=l.authoringInfo,c=n.authoringInfo.visualVariables.find((e=>"color"===e.type));return o.visualVariables=[...o.visualVariables,c],l.visualVariables=[...l.visualVariables,r],{renderer:l}}(e,i);case"Color and Size":return async function(e,t){const{colorStyleParams:i,sizeStyleParams:a}=t,{modules:s}=e,{renderer:n,visualVariable:r}=await s.ColorCreator.createContinuousRenderer(i),{renderer:l}=await s.SizeCreator.createContinuousRenderer(a),o=l.authoringInfo,c=n.authoringInfo.visualVariables.find((e=>"color"===e.type));return o.visualVariables=[...o.visualVariables,c],l.visualVariables=[...l.visualVariables,r],{renderer:l}}(e,i);case"Color and Size (age)":return async function(e,t){const{colorStyleParams:i,sizeAgeStyleParams:a}=t,{modules:s}=e,{renderer:n,visualVariable:r}=await s.ColorCreator.createContinuousRenderer(i),{renderer:l}=await s.SizeCreator.createAgeRenderer(a),o=l.authoringInfo,c=n.authoringInfo.visualVariables.find((e=>"color"===e.type));return o.visualVariables=[...o.visualVariables,c],l.visualVariables=[...l.visualVariables,r],{renderer:l}}(e,i);case"Color and Size (univariate)":return a.UnivariateColorSizeCreator.createContinuousRenderer(i);case"Compare A to B":case"Continuous Timeline (color)":case"Counts and Amounts (color)":return a.ColorCreator.createContinuousRenderer(i);case"Continuous Timeline (size)":case"Counts and Amounts (size)":return a.SizeCreator.createContinuousRenderer(i);case"Counts and Amounts (opacity)":return O(e,i);case"Counts and Amounts (classed color)":return a.ColorCreator.createClassBreaksRenderer({...i,numClasses:i.numClasses??void 0});case"Discrete Time Periods (categories)":case"Types (unique symbols)":return a.TypeCreator.createRenderer(i);case"Dot Density":return a.DotDensityCreator.createRenderer(i);case"Heat Map":return a.HeatmapCreator.createRenderer(i);case"Predominant category":case"Predominant category and Size":return a.PredominanceCreator.createRenderer(i);case"Relationship":return a.RelationshipCreator.createRenderer(i);case"Relationship and size":return async function(e,t){const{relationshipStyleParams:i,sizeStyleParams:a}=t,{modules:s}=e,n=i.layer.geometryType,{renderer:r}=await s.RelationshipCreator.createRenderer(i);if(!a)return{renderer:r};const{visualVariables:l,renderer:o}=await s.SizeCreator.createContinuousRenderer(a);if("polygon"===n){const e=o.classBreakInfos[0].symbol;r.uniqueValueInfos.forEach((t=>{const i=e.clone();i.color=t.symbol.color,t.symbol=i}));const t=o.backgroundFillSymbol;r.backgroundFillSymbol=t}r.visualVariables=[...r.visualVariables,...l];const c=r.authoringInfo,d=o.authoringInfo.visualVariables.find((e=>"size"===e.type));return c.visualVariables=[d],{renderer:r}}(e,i);case"Types and Size":return async function(e,t){const{typesStyleParams:i,sizeStyleParams:a}=t,{modules:s}=e,n=i.layer.geometryType,{renderer:r}=await s.TypeCreator.createRenderer(i),{visualVariables:l,renderer:o}=await s.SizeCreator.createContinuousRenderer(a);if("polygon"===n){const e=o.classBreakInfos[0].symbol;r.uniqueValueInfos.forEach((t=>{const i=e.clone();i.color=t.symbol.color,t.symbol=i}));const t=o.backgroundFillSymbol;r.backgroundFillSymbol=t}r.visualVariables=[...r.visualVariables,...l];const c=r.authoringInfo,d=o.authoringInfo.visualVariables.find((e=>"size"===e.type));return c.visualVariables=[d],{renderer:r}}(e,i);case"Types and Size (age)":return async function(e,t){const{typesStyleParams:i,sizeAgeStyleParams:a}=t,{modules:s}=e,n=i.layer.geometryType,{renderer:r}=await s.TypeCreator.createRenderer(i),{visualVariables:l,renderer:o}=await s.SizeCreator.createAgeRenderer(a);if("polygon"===n){const e=o.classBreakInfos[0].symbol;r.uniqueValueInfos.forEach((t=>{const i=e.clone();i.color=t.symbol.color,t.symbol=i}));const t=o.backgroundFillSymbol;r.backgroundFillSymbol=t}r.visualVariables=[...r.visualVariables,...l];const c=r.authoringInfo,d=o.authoringInfo.visualVariables.find((e=>"size"===e.type));return c.visualVariables=[d],{renderer:r}}(e,i);default:return a.LocationCreator.createRenderer(i)}}(e,a,i);if("Compare A to B"===a){((0,n.G)(r,"color")||{}).style="ratio"}"heatmap"===r.type&&(r.referenceScale=s.scale);"pie-chart"===r.type&&(r.size=4);"dot-density"===r.type&&(r.dotSize=2,r.dotShape="circle");return r}(e,i);return a}async function R(e,t){const i=(0,n.a)(e),a=(0,n.f)(e),s=W(e,"size");return{renderer:(await s(e,{fieldInfos:t.field?["color","color-age","type","relationship","predominance"].includes(i)?[...a,{field:t.field,simpleFieldType:(0,n.o)(e,t.field).simpleFieldType}]:void 0:[...a],includeSizeVariable:t.includeSizeVariable})).renderer}}async function x(e,t){const i=(0,n.a)(e),a=(0,n.f)(e),s=W(e,"color");return{renderer:(await s(e,{fieldInfos:["size","size-age"].includes(i)?[{field:t.field,simpleFieldType:(0,n.o)(e,t.field).simpleFieldType},a[0]]:void 0,colorScheme:t.colorScheme,sizeScheme:t.colorScheme,relationshipScheme:t.colorScheme,predominanceScheme:t.colorScheme,pieChartScheme:t.colorScheme,dotDensityScheme:t.colorScheme,heatmapScheme:t.colorScheme,locationScheme:t.colorScheme,typeScheme:t.colorScheme})).renderer}}async function O(e,t){const{modules:i}=e,a=t.layer.renderer.clone();if("dictionary"===a.type)return{renderer:a};const{visualVariable:s}=await i.OpacityVariableCreator.createVisualVariable(t);return a.visualVariables=(0,n.V)(a,"opacity")||[],a.visualVariables.push(s),a.authoringInfo&&(a.authoringInfo.visualVariables=(0,n.W)(a,"opacity")||[]),{renderer:a}}async function D(e,t){const{fields:i,layer:a,view:s,colorSchemeTags:n}=e,{modules:r}=t;let l;const o=i[0],c=i[1],d=i[2];return n&&(l=r.typeSchemes.getSchemesByTag({geometryType:a.geometryType,includedTags:n})[0]),{layer:a,view:s,field:o,field2:c,field3:d,outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,typeScheme:l}}async function A(e,t){const{fields:i,layer:a,view:s,styleName:n,colorSchemeTags:r}=e;let{theme:l}=e;const{modules:o}=t;let c,d;const p=i[0];return c??=i[1],"Compare A to B"===n&&(c??=i[1],l="above-and-below"),r&&(d=o.colorSchemes.getSchemesByTag({geometryType:a.geometryType,includedTags:r,theme:l||"high-to-low"})[0]),{layer:a,view:s,field:p,normalizationField:c,theme:l,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0,colorScheme:d}}async function V(e,t){const{fields:i,layer:a,view:s,theme:n,colorSchemeTags:r}=e,{modules:l}=t,o=i[0];let c;return r&&(c=l.colorSchemes.getSchemesByTag({geometryType:a.geometryType,includedTags:r,theme:n||"high-to-low"})[0]),{layer:a,view:s,startTime:o,endTime:new Date,theme:n,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0,colorScheme:c}}async function U(e,t){const{fields:i,layer:a,view:s,theme:r}=e;let l=i[0];const o=i[1];if(!l){const e=(0,n.f)(t);e.length&&(l=e[0].field)}return{layer:a,view:s,field:l,normalizationField:o,theme:r,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0}}async function _(e){const{fields:t,layer:i,view:a,theme:s}=e;return{layer:i,view:a,startTime:t[0],endTime:new Date,theme:s,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0}}async function j(e,t){const{fields:i,layer:a,view:s,styleName:n,colorSchemeTags:r}=e,{modules:l}=t;let o;return r&&(o=l.predominanceSchemes.getSchemesByTag({geometryType:a.geometryType,includedTags:r,numColors:Math.min(i.length,10)})[0]),{layer:a,view:s,fields:i.map((e=>({name:e}))).slice(0,9),outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,includeSizeVariable:n.includes("Size"),predominanceScheme:o}}async function q(e,t){const{fields:i,layer:a,view:s,styleName:n,colorSchemeTags:r}=e,{modules:l}=t;let o;return o=r?l.pieChartSchemes.getSchemesByTag({basemapTheme:await l.colorUtils.getBackgroundColorTheme(s),geometryType:a.geometryType,includedTags:r,numColors:Math.min(i.length,8)})[0]:l.pieChartSchemes.getSchemes({basemapTheme:await l.colorUtils.getBackgroundColorTheme(s),geometryType:a.geometryType,numColors:Math.min(i.length,8)}).primaryScheme,{layer:a,view:s,attributes:i.map((e=>({field:e,label:a.fields.find((t=>t.name===e))?.alias??""}))).slice(0,8),outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,includeSizeVariable:n.includes("Size"),pieChartScheme:o}}async function H(e,t){const{fields:i,layer:a,view:s,colorSchemeTags:n}=e,{modules:r}=t;let l;const o={field:i[0]},c={field:i[1]};return n&&(l=r.relationshipSchemes.getSchemesByTag({geometryType:a.geometryType,includedTags:n})[0]),{layer:a,view:s,field1:o,field2:c,outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,relationshipScheme:l}}async function $(e,t){const{fields:i,layer:a,view:s,theme:r,colorSchemeTags:l}=e;let o,c=i[0];const d=i[1];if(!c){const e=(0,n.f)(t);e.length&&(c=e[0].field)}if(l){const e=function(e){const{modules:t}=e,i=(0,n.a)(e);switch(i){case"color":case"color-age":case"color-size":case"color-age-size":case"color-size-age":case"compare":return t.colorSchemes.getSchemesByTag;case"type":case"type-size":case"type-size-age":return t.typeSchemes.getSchemesByTag;case"dot-density":return t.dotDensitySchemes.getSchemesByTag;case"heatmap":return t.heatmapSchemes.getSchemesByTag;case"relationship":case"relationship-size":return t.relationshipSchemes.getSchemesByTag;case"predominance":case"predominance-size":return t.predominanceSchemes.getSchemesByTag;case"chart":case"chart-size":return t.pieChartSchemes.getSchemesByTag;default:return console.error("unknown renderer type",i),t.colorSchemes.getSchemesByTag}}(t);o=e({geometryType:a.geometryType,includedTags:l,theme:r||(0,n.H)(t,"color")})[0]}return{layer:a,view:s,field:c,normalizationField:d,theme:r,colorScheme:o}}async function J(e,t){const{fields:i,layer:a,view:s}=e;let r=i[0];const l=i[1];if(!r){const e=(0,n.f)(t);e.length&&(r=e[0].field)}return{layer:a,view:s,field:r,normalizationField:l}}function W(e,t){const{layer:i}=e;if(!(0,n.n)(i))return;const a=i.renderer.authoringInfo,s=(0,n.a)(e);switch(s){case"simple":return c.a;case"color":return"size"===t?p.b:"class-breaks-color"===a?.type?d.e:d.b;case"size":return"color"===t?p.b:"type"===t?f.c:"relationship"===t?h.b:"class-breaks-size"===a?.type?p.k:p.f;case"type":return"size"===t?f.c:S.a;case"color-age":return"size"===t?p.d:d.d;case"size-age":return"color"===t?p.e:"type"===t?f.a:p.h;case"color-size":return"univariate-color-size"===a?.type?g.b:p.g;case"color-age-size":return p.j;case"color-size-age":return p.i;case"type-size":return f.b;case"type-size-age":return f.d;case"dot-density":return h.f;case"heatmap":return h.e;case"relationship":return"size"===t?h.b:y.a;case"relationship-size":return h.d;case"predominance":case"predominance-size":return m.a;case"chart":case"chart-size":return g.d;case"compare":return u.a;default:return void console.error("unknown renderer type:",s)}}const G=({portal:e})=>{const t=window.customElements?.get("arcgis-user-avatar");return t&&e?.user?(0,a.h)("arcgis-user-avatar",{class:"avatar-user",user:e.user,portal:e}):e?(0,a.h)("div",{class:"avatar avatar-portal"},(0,a.h)("calcite-icon",{class:"avatar-icon",icon:"user",scale:"s"})):(0,a.h)("div",{class:"avatar avatar-bot"},(0,a.h)("calcite-icon",{class:"avatar-icon",icon:"effects",scale:"s"}))},K=()=>(0,a.h)("div",{class:"message-loader"},(0,a.h)("svg",{version:"1.1",id:"message-loader",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 100 100","enable-background":"new 0 0 0 0"},(0,a.h)("circle",{fill:"#000",stroke:"none",cx:"6",cy:"50",r:"6"},(0,a.h)("animate",{attributeName:"opacity",dur:"1s",values:"0;1;0",repeatCount:"indefinite",begin:"0.1"})),(0,a.h)("circle",{fill:"#000",stroke:"none",cx:"26",cy:"50",r:"6"},(0,a.h)("animate",{attributeName:"opacity",dur:"1s",values:"0;1;0",repeatCount:"indefinite",begin:"0.2"})),(0,a.h)("circle",{fill:"#000",stroke:"none",cx:"46",cy:"50",r:"6"},(0,a.h)("animate",{attributeName:"opacity",dur:"1s",values:"0;1;0",repeatCount:"indefinite",begin:"0.3"})))),Q=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsAssistClose=(0,a.c)(this,"arcgisSmartMappingPanelsAssistClose",7),this.arcgisSmartMappingPanelsAssistBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsAssistBackClick",7),this.arcgisSmartMappingPanelsAssistError=(0,a.c)(this,"arcgisSmartMappingPanelsAssistError",7),this.arcgisSmartMappingPanelsAssistClusterRequiresUpdate=(0,a.c)(this,"arcgisSmartMappingPanelsAssistClusterRequiresUpdate",7),this.manager=(0,r.u)(this),this.chat=[],this.tileNodes=[],this.smartMappingState=(0,o.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsAssistClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,n.h)(i,e,t),this.arcgisSmartMappingPanelsAssistClose.emit("cancel")},this.handleGenerate=async()=>{const{textAreaNode:e,chat:t,activeRendererIdx:i,smartMappingState:a}=this,{layer:s,strings:r}=a;if(!(0,n.n)(s))return;const o=e.value;if(!o)return;this.usingLastStyleTile()||(t.length=i+1),t.push({text:o,type:"question"}),this.loading=!0,this.scrollTo(),e.value="";const c={text:o},d=await(0,l.b)(a,c);if(this.loading){if("valid"!==d.status)return t.push(d),this.loading=!1,void this.scrollTo();await async function(e,t,i){const{text:a}=t,{layer:s,mapView:r}=e;if(!(0,n.n)(s))throw new Error("layer not a FL");if(![200,902].includes(i.dataObject.status_code))return i.message=i.dataObject.botMessage,i.status="error",console.log("*** question/response: ",JSON.stringify({question:a,responseObj:i})),i;const{actionResponse:l}=i.dataObject,{action:o}=l,c=l.style_name;let d;l.theme&&(d=l.theme.trim().toLowerCase().replace(/"/gu,"").replace(/theme/gu,"").replace(/:/gu,"").replace(/;/gu,"").replace(/'/gu,"").trim().replace(/ /gu,"-"),d="none"===l.theme.toLowerCase()?void 0:d);const p=l.field_names,h=[l.color_scheme];console.log("*** question/response: ",JSON.stringify({question:a,actionResponse:l}));try{const t=await I(e,o,{layer:s,view:r,fields:p,styleName:c,theme:d,colorSchemeTags:h});return i.renderer=t,i.rendererFields=p,i.message=`${i.message}. Here's a ${c} map.`,i}catch(e){return i.message=`I'm sorry. There must have been a misunderstanding. I see the following error: ${e.message}`,i.status="error",i}}(a,c,d),t.push(d),d.renderer&&(this.activeRendererIdx=t.length-1,(0,n.u)(a,d.renderer),this.smartMappingState.selectedFields=(0,n.f)(a),this.smartMappingState.selectedFields.forEach((e=>{e.expression&&!e.expressionTitle&&(e.expressionTitle=r.expression)}))),this.loading=!1,this.scrollTo()}},this.handleRestart=()=>{this.chat=[],this.loading=!1;const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,n.h)(i,e,t),(0,a.f)(this.el),setTimeout((()=>{this.textAreaNode.setFocus()}),500)},this.handleChip=e=>{const{textAreaNode:t,smartMappingState:i}=this,{strings:s}=i;switch(e){case 0:t.value="How can I style the data in the layer";break;case 1:t.value=`${s.panels.assist.mainSuggestion1} `;break;case 2:t.value=`${s.panels.assist.mainSuggestion2} `;break;case 3:t.value=`${s.panels.assist.mainSuggestion3} `;break;default:t.value=`${s.panels.assist.mainSuggestion4} `}(0,a.f)(this.el),setTimeout((async()=>await t.setFocus()),300)},this.handleSecondaryChip=e=>{const{textAreaNode:t,smartMappingState:i}=this,{strings:s}=i;switch(e){case 1:t.value=`${s.panels.assist.secondSuggestion1} `;break;case 2:t.value=`${s.panels.assist.secondSuggestion2} `;break;default:t.value=`${s.panels.assist.secondSuggestion3} `}(0,a.f)(this.el),setTimeout((async()=>await t.setFocus()),300)},this.handleStyleTileClick=e=>{const{chat:t,smartMappingState:i}=this,a=t[e];this.activeRendererIdx=e,(0,n.u)(i,a.renderer)},this.handleStyleTileCustomize=e=>{const{chat:t,panelsParentNode:i,smartMappingState:s}=this,r=t[e],l=(0,n.ae)(s,r.renderer),{selectedFields:o}=s;switch(l){case"simple":{const e=document.createElement("arcgis-smart-mapping-panels-simple");e.addEventListener("arcgisSmartMappingPanelsSimpleClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsSimpleBackClick",(()=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone("save",r)})),e.addEventListener("arcgisSmartMappingPanelsSimpleError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"color":case"color-age":{const e=document.createElement("arcgis-smart-mapping-panels-color");e.addEventListener("arcgisSmartMappingPanelsColorClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsColorBackClick",(()=>{(0,a.f)(this.el),this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone("save",r)})),e.addEventListener("arcgisSmartMappingPanelsColorError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"size":case"size-age":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.addEventListener("arcgisSmartMappingPanelsSizeClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>{(0,a.f)(this.el),this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone("save",r)})),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"type":{const e=document.createElement("arcgis-smart-mapping-panels-type");e.addEventListener("arcgisSmartMappingPanelsTypeClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsTypeBackClick",(()=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone("save",r)})),e.addEventListener("arcgisSmartMappingPanelsTypeClusterRequiresUpdate",(()=>{this.arcgisSmartMappingPanelsAssistClusterRequiresUpdate.emit()})),e.addEventListener("arcgisSmartMappingPanelsTypeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"compare":{const e=document.createElement("arcgis-smart-mapping-panels-compare");e.addEventListener("arcgisSmartMappingPanelsCompareClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsCompareBackClick",(()=>{this.cleanUpFlowItem(i,e),i.removeChild(e)})),e.addEventListener("arcgisSmartMappingPanelsCompareError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"heatmap":{const e=document.createElement("arcgis-smart-mapping-panels-heatmap");e.addEventListener("arcgisSmartMappingPanelsHeatmapClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsHeatmapBackClick",(()=>{this.cleanUpFlowItem(i,e),i.removeChild(e)})),e.addEventListener("arcgisSmartMappingPanelsHeatmapError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"predominance":{const e=document.createElement("arcgis-smart-mapping-panels-predominance");e.addEventListener("arcgisSmartMappingPanelsPredominanceClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsPredominanceBackClick",(()=>{this.cleanUpFlowItem(i,e),i.removeChild(e)})),e.addEventListener("arcgisSmartMappingPanelsPredominanceError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"chart":{const e=document.createElement("arcgis-smart-mapping-panels-chart");e.addEventListener("arcgisSmartMappingPanelsChartClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsChartBackClick",(()=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone("save",r)})),e.addEventListener("arcgisSmartMappingPanelsChartError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"relationship":{const e=document.createElement("arcgis-smart-mapping-panels-relationship");e.addEventListener("arcgisSmartMappingPanelsRelationshipClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsRelationshipBackClick",(()=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone("save",r)})),e.addEventListener("arcgisSmartMappingPanelsRelationshipError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"dot-density":{const e=document.createElement("arcgis-smart-mapping-panels-dot-density");e.addEventListener("arcgisSmartMappingPanelsDotDensityClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsDotDensityBackClick",(()=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone("save",r)})),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"color-size":case"color-age-size":case"color-size-age":if(o.length>1){const e=document.createElement("arcgis-smart-mapping-panels-color-size");e.addEventListener("arcgisSmartMappingPanelsColorSizeClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeBackClick",(()=>{(0,a.f)(this.el),this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone("save",r)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1}else{const e=document.createElement("arcgis-smart-mapping-panels-color-size-univariate");e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateBackClick",(()=>{(0,a.f)(this.el),this.cleanUpFlowItem(i,e),i.removeChild(e)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1}break;case"type-size":case"type-size-age":{const e=document.createElement("arcgis-smart-mapping-panels-type-size");e.addEventListener("arcgisSmartMappingPanelsTypeSizeClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsTypeSizeBackClick",(()=>{(0,a.f)(this.el),this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone("save",r)})),e.addEventListener("arcgisSmartMappingPanelsTypeSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"predominance-size":{const e=document.createElement("arcgis-smart-mapping-panels-predominance-size");e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeBackClick",(()=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone("save",r)})),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"chart-size":{const e=document.createElement("arcgis-smart-mapping-panels-chart-size");e.addEventListener("arcgisSmartMappingPanelsChartSizeClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsChartSizeBackClick",(()=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone("save",r)})),e.addEventListener("arcgisSmartMappingPanelsChartSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"relationship-size":{const e=document.createElement("arcgis-smart-mapping-panels-relationship-size");e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeClose",(t=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone(t.detail,r)})),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeBackClick",(()=>{this.cleanUpFlowItem(i,e),this.handleStyleOptionsDone("save",r)})),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),i.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.loading=!1,this.activeRendererIdx=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,i=(0,n.j)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,n.af)(this.smartMappingState,this.el)}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())))}disconnectedCallback(){}render(){const{layer:e,hideLayerTitle:t,strings:i}=this.smartMappingState;return console.log("chat",this.chat),(0,a.h)(a.H,{key:"e8f989c28f650bc83a12f0f55e679b86103c6f44",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"bdf2a0187b57fa8f4df9544f776ba16d260ab283",heading:i.panels.assist.heading,description:t?void 0:e.title??void 0,class:"flow-item",closable:!1,showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsAssistBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderContent(),this.renderDisclaimer()))}renderDoneButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,a.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):(0,a.h)(a.F,null)}renderCancelButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,a.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):(0,a.h)(a.F,null)}renderContent(){const{chat:e,loading:t}=this;return e.length||t?this.renderGeneratedContent():this.renderInitialContent()}renderInitialContent(){const{strings:e}=this.smartMappingState;return(0,a.h)("div",{class:"content content-initial"},(0,a.h)("calcite-icon",{icon:"effects"}),(0,a.h)("div",{class:"title"},e.panels.assist.title),(0,a.h)("div",{class:"sub-title"},e.panels.assist.subTitle),this.renderInput(),this.renderSuggestions())}renderGeneratedContent(){const{chat:e,loading:t}=this;return(0,a.h)("div",{class:"content content-generated"},(0,a.h)("div",{class:"messages",ref:e=>this.messagesNode=e},e.map(((e,t)=>this.renderChatMessage(e,t))),t&&(0,a.h)(K,null)),(0,a.h)("div",{class:"bottom-input"},this.renderSecondarySuggestions(),this.renderInput()))}renderChatMessage(e,t){return(0,a.h)("div",{class:"message","data-value":t},"question"===e.type?this.rendererQuestion(e):this.renderResponse(e,t))}rendererQuestion(e){const{portal:t}=this.smartMappingState;return(0,a.h)("div",{class:"chat-question"},(0,a.h)(G,{portal:t}),(0,a.h)("div",{class:"question"},e.text))}renderResponse(e,t){return e.renderer?this.renderStyleTile(e,t):(0,a.h)("div",{class:"chat-response"},(0,a.h)(G,null),(0,a.h)("div",{class:"response"},e.message))}renderStyleTile(e,t){const{activeRendererIdx:i,smartMappingState:s}=this,r=(0,n.ae)(s,e.renderer),l=(0,n.f)(s,e.renderer)?.map((e=>(0,n.o)(s,e.field)?.label||e.field));return(0,a.h)("div",{class:"chat-response"},(0,a.h)(G,null),(0,a.h)("arcgis-smart-mapping-tile",{key:t,class:"tile",tileType:"assist",type:r,selected:i===t,fields:l,ref:e=>{e&&(this.tileNodes[t]=e)},onArcgisSmartMappingTileSelect:()=>this.handleStyleTileClick(t),onArcgisSmartMappingTileOptions:()=>this.handleStyleTileCustomize(t)}))}renderInput(){const{chat:e,smartMappingState:t}=this,{strings:i}=t;return(0,a.h)(a.F,null,(0,a.h)("calcite-text-area",{disabled:this.loading,class:"text-input",placeholder:i.panels.assist.placeholder,value:"",scale:"s",resize:"vertical",rows:3,onCalciteTextAreaInput:()=>this.generateButtonNode.disabled=!this.textAreaNode.value,onKeyUp:e=>{"Enter"===e.key&&this.textAreaNode.value&&(e.preventDefault(),this.handleGenerate())},ref:e=>this.textAreaNode=e}),(0,a.h)("div",{class:"generate-buttons"},!!e.length&&(0,a.h)(a.F,null,(0,a.h)("calcite-button",{class:"restart-button",slot:"footer",iconStart:"refresh",label:i.panels.assist.restart,onClick:this.handleRestart,appearance:"transparent",width:"auto"},i.panels.assist.restart),(0,a.h)("span",null,"\xa0\xa0")),(0,a.h)("calcite-button",{disabled:this.loading||!this.textAreaNode?.value,class:"generate-button",slot:"footer",iconStart:"effects",label:i.panels.assist.generate,onClick:()=>{this.loading||this.handleGenerate()},appearance:"solid",width:"auto",ref:e=>this.generateButtonNode=e},i.panels.assist.generate)))}renderSuggestions(){const{strings:e}=this.smartMappingState;return(0,a.h)("div",{class:"suggestions"},(0,a.h)("div",{class:"suggestions-title"},e.panels.assist.suggestedPrompts),(0,a.h)("calcite-chip",{class:"chip",scale:"s",value:"0",appearance:"outline-fill",label:"How can I style the data in the layer",onClick:()=>this.handleChip(0)},"How can I style the data in the layer"),(0,a.h)("br",null),(0,a.h)("calcite-chip",{class:"chip",scale:"s",value:"1",appearance:"outline-fill",label:e.panels.assist.mainSuggestion1,onClick:()=>this.handleChip(1)},`${e.panels.assist.mainSuggestion1}...`),(0,a.h)("br",null),(0,a.h)("calcite-chip",{class:"chip",scale:"s",value:"2",appearance:"outline-fill",label:e.panels.assist.mainSuggestion2,onClick:()=>this.handleChip(2)},`${e.panels.assist.mainSuggestion2}...`),(0,a.h)("br",null),(0,a.h)("calcite-chip",{class:"chip",scale:"s",value:"3",appearance:"outline-fill",label:e.panels.assist.mainSuggestion3,onClick:()=>this.handleChip(3)},`${e.panels.assist.mainSuggestion3}...`),(0,a.h)("br",null),(0,a.h)("calcite-chip",{class:"chip",scale:"s",value:"4",appearance:"outline-fill",label:e.panels.assist.mainSuggestion4,onClick:()=>this.handleChip(4)},`${e.panels.assist.mainSuggestion4}...`))}renderSecondarySuggestions(){const{strings:e}=this.smartMappingState;return(0,a.h)("div",{class:"secondary-suggestions"},(0,a.h)("calcite-chip",{disabled:this.loading,class:"chip",scale:"s",value:"1",appearance:"solid",label:e.panels.assist.secondSuggestion1,onClick:()=>!this.loading&&this.handleSecondaryChip(1)},e.panels.assist.secondSuggestion1),(0,a.h)("calcite-chip",{disabled:this.loading,class:"chip",scale:"s",value:"2",appearance:"solid",label:e.panels.assist.secondSuggestion2,onClick:()=>!this.loading&&this.handleSecondaryChip(2)},e.panels.assist.secondSuggestion2))}renderDisclaimer(){return(0,a.h)("div",{class:"disclaimer"},(0,a.h)("div",{class:"disclaimer-icon"},(0,a.h)("calcite-icon",{class:"disclaimer-icon",icon:"information",scale:"s"})),(0,a.h)("div",null,"\xa0\xa0"),(0,a.h)("div",{class:"disclaimer-text"},(0,a.h)("span",null,'"AI generated content may be inaccurate or misleading."')))}handleStyleOptionsDone(e,t){const{layer:i,modules:a}=this.smartMappingState;"save"===e&&(t.renderer=a.esriLang.clone(i.renderer))}cleanUpFlowItem(e,t){e.removeChild(t),this.focusSelectedTile(),this.selected=!0}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((async()=>await(this.tileNodes[0]?.setFocus())))),300)}usingLastStyleTile(){const{chat:e,activeRendererIdx:t}=this;if(e.length>1&&(0,s.i)(t)){let i=e.length;return e.forEach(((e,t)=>{"renderer"in e&&e.renderer&&(i=t)})),t===i}return!0}scrollTo(){const{textAreaNode:e,messagesNode:t}=this;setTimeout((()=>{t?.scrollTo(0,t.scrollHeight)}),300),setTimeout((()=>{e?.setFocus(),t?.scrollTo(0,t.scrollHeight)}),500)}get el(){return(0,a.g)(this)}};Q.style=":host {\n  width: 100%;\n  display: none;\n}\n:host([selected]) {\n  display: flex;\n}\n.flow-item {\n  height: 100%;\n}\n.content {\n  height: 100%;\n  background-color: #ffffff;\n}\n.content-initial {\n  padding: 12px 9px;\n}\n.content-generated {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  overflow-y: hidden;\n}\n.title {\n  font-weight: bold;\n  font-size: 16px;\n}\n.sub-title {\n  font-size: var(--calcite-font-size--1);\n  padding-bottom: 10px;\n}\n.text-input {\n  padding: 10px 0 20px 0;\n  width: 100%;\n}\n.generate-buttons {\n  display: flex;\n  justify-content: right;\n  margin-bottom: 20px;\n}\n:dir(rtl) {\n  .generate-buttons {\n    justify-content: left;\n  }\n}\n.generate-button {\n}\n.suggestions {\n  background-color: var(--calcite-color-foreground-2);\n  padding: 8px;\n  margin: 20px 0;\n}\n.suggestions-title {\n  font-size: var(--calcite-font-size--1);\n  padding-bottom: 5px;\n}\n.chip {\n  max-width: 100%;\n  margin-top: 5px;\n}\n.disclaimer {\n  font-size: var(--calcite-font-size--2);\n  background-color: #ffffff;\n  padding: 8px;\n  display: flex;\n  justify-content: space-between;\n}\n.disclaimer-icon {\n  height: 100%;\n  vertical-align: middle;\n}\n.disclaimer-text {\n  line-height: 16px;\n}\n.avatar {\n  border-radius: 50%;\n  width: 30px;\n  min-width: 30px;\n  height: 30px;\n  display: flex;\n  justify-content: center;\n}\n.avatar-user {\n  min-width: 30px;\n}\n.avatar-portal {\n  background-color: var(--calcite-color-foreground-2);\n}\n.avatar-bot {\n  background-color: #dcf2f4;\n}\n.avatar-icon {\n  vertical-align: middle;\n  height: 100%;\n}\n.bottom-input {\n  border-top: 1px solid var(--calcite-color-foreground-2);\n  padding: 0 9px;\n}\n.messages {\n  height: 100%;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 12px 9px;\n}\n.message-loader {\n  display: flex;\n  height: 40px;\n  margin: 0 10px;\n}\n.message {\n  margin-bottom: 14px;\n}\n.chat-question {\n  display: flex;\n  column-gap: 5px;\n}\n.chat-response {\n  display: flex;\n  margin: 3px 0;\n  column-gap: 5px;\n}\n.question,\n.response {\n  background-color: var(--calcite-color-foreground-2);\n  padding: 8px 10px;\n  border-radius: 8px;\n  font-size: var(--calcite-font-size--2);\n  line-height: 19.25px;\n  white-space: pre-wrap;\n}\n.tile {\n  width: 100%;\n}\n";const Y=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsChartSizeBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsChartSizeBackClick",7),this.arcgisSmartMappingPanelsChartSizeClose=(0,a.c)(this,"arcgisSmartMappingPanelsChartSizeClose",7),this.arcgisSmartMappingPanelsChartSizeError=(0,a.c)(this,"arcgisSmartMappingPanelsChartSizeError",7),this.manager=(0,r.u)(this),this.tileNodes={},this.smartMappingState=(0,o.u)(),this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsChartSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"chart":{const e=document.createElement("arcgis-smart-mapping-panels-chart");e.addEventListener("arcgisSmartMappingPanelsChartClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsChartBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsChartError",(({detail:e})=>this.arcgisSmartMappingPanelsChartSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,i=(0,n.j)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,n.af)(this.smartMappingState,this.el)}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,g.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{hideLayerTitle:e,mapImageSublayer:t,layer:i,strings:s}=this.smartMappingState,r=e?void 0:t?.title??i.title;return(0,a.h)(a.H,{key:"245ad903caa4f354b8bf16f8a23c525de1616f03",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"7eec391a6cd3134f0af1d1e0cb408a7b59ba8028",class:"flow-item",closable:(0,n.C)(this.el),heading:s.panels.styleOptions,description:r??void 0,showBackButton:this.showBackButton,selected:this.selected,ref:e=>this.flowItemNode=e,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsChartSizeBackClick.emit()},onCalciteFlowItemClose:()=>this.arcgisSmartMappingPanelsChartSizeClose.emit()},this.renderChartTile(),this.renderSizeTile(),this.renderDoneButton(),this.renderCancelButton()))}renderChartTile(){return(0,a.h)("arcgis-smart-mapping-tile",{type:"chart",selected:"chart"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="chart",this.handleOptionsClick("chart")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("chart"),ref:e=>{e&&(this.tileNodes.chart=e)}})}renderSizeTile(){return(0,a.h)("arcgis-smart-mapping-tile",{type:"size",selected:"size"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="size",this.handleOptionsClick("size")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),ref:e=>{e&&(this.tileNodes.size=e)}})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.arcgisSmartMappingPanelsChartSizeClose.emit(),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,a.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{(0,n.h)(e,this.originalRendererJSON,this.originalFeatureReduction),this.arcgisSmartMappingPanelsChartSizeClose.emit()},appearance:"outline-fill",width:"half"},t.cancel)}cleanUpFlowItem(e,t){e.removeChild(t),this.focusSelectedTile(),this.selected=!0}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((async()=>await(this.tileNodes[this.lastClick]?.setFocus())))),300)}get el(){return(0,a.g)(this)}};Y.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}";const Z=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsColorSizeClose=(0,a.c)(this,"arcgisSmartMappingPanelsColorSizeClose",7),this.arcgisSmartMappingPanelsColorSizeBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsColorSizeBackClick",7),this.arcgisSmartMappingPanelsColorSizeError=(0,a.c)(this,"arcgisSmartMappingPanelsColorSizeError",7),this.manager=(0,r.u)(this),this.tileNodes={},this.smartMappingState=(0,o.u)(),this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsColorSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"color":{const e=document.createElement("arcgis-smart-mapping-panels-color");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsColorClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsColorBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsColorError",(({detail:e})=>this.arcgisSmartMappingPanelsColorSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.handleDone=()=>{this.arcgisSmartMappingPanelsColorSizeClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,n.h)(i,e,t),this.arcgisSmartMappingPanelsColorSizeClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,i=(0,n.j)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,n.af)(this.smartMappingState,this.el)}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,g.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,hideLayerTitle:t,strings:i}=this.smartMappingState;return(0,a.h)(a.H,{key:"8f6f5514ee787fadc67eb261e68b99a871dc5c89",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"2b6f72f643bfb89ba083f12baee4ee3eb2959ccc",heading:i.panels.styleOptions,description:t?void 0:e.title,class:"flow-item",closable:(0,n.C)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsColorSizeBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderColorTile(),this.renderSizeTile(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},e.cancel)}renderColorTile(){const{lastClick:e,smartMappingState:t}=this,i="color-age-size"===(0,n.a)(t)?"color-age":"color",s=(0,n.H)(t,"color");return(0,a.h)("arcgis-smart-mapping-tile",{key:`tile-${i}-${s}`,type:i,selected:"color"===e,onArcgisSmartMappingTileSelect:()=>{this.lastClick=i,this.handleOptionsClick("color")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("color"),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsColorSizeError.emit(e.detail),ref:e=>{e&&(this.tileNodes[i]=e)}})}renderSizeTile(){const{lastClick:e,smartMappingState:t}=this,i="color-size-age"===(0,n.a)(t)?"size-age":"size",s=(0,n.H)(t,"size");return(0,a.h)("arcgis-smart-mapping-tile",{key:`tile-${i}-${s}`,type:i,selected:"size"===e,onArcgisSmartMappingTileSelect:()=>{this.lastClick=i,this.handleOptionsClick("size")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsColorSizeError.emit(e.detail),ref:e=>{e&&(this.tileNodes[i]=e)}})}renderTransparency(){const{smartMappingState:e}=this,t=(0,n.j)(e),i=(0,n.b)(t,"opacity");return(0,a.h)("arcgis-smart-mapping-transparency",{open:!!i,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsColorSizeError.emit(e)})}renderRotation(){const{smartMappingState:e}=this,t=(0,n.j)(e),i=(0,n.b)(t,"opacity"),s=(0,n.b)(t,"rotation");return(0,a.h)("arcgis-smart-mapping-rotation",{open:!i&&!!s,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsColorSizeError.emit(e)})}cleanUpFlowItem(e,t){e.removeChild(t),this.focusSelectedTile(),this.selected=!0}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((()=>this.tileNodes[this.lastClick]?.setFocus()))),300)}get el(){return(0,a.g)(this)}};Z.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}";const X=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsColorSizeUnivariateClose=(0,a.c)(this,"arcgisSmartMappingPanelsColorSizeUnivariateClose",7),this.arcgisSmartMappingPanelsColorSizeUnivariateBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsColorSizeUnivariateBackClick",7),this.arcgisSmartMappingPanelsColorSizeUnivariateError=(0,a.c)(this,"arcgisSmartMappingPanelsColorSizeUnivariateError",7),this.manager=(0,r.u)(this),this.smartMappingState=(0,o.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsColorSizeUnivariateClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,n.h)(i,e,t),this.arcgisSmartMappingPanelsColorSizeUnivariateClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=this.smartMappingState,i=(0,n.j)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,g.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,hideLayerTitle:t,strings:i}=this.smartMappingState;return(0,a.h)(a.H,{key:"130fa4f14049c1a36db2d724c4445dbf11c94f19",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"f0c655ed883ab8c909dd450cc1395f060982e107",heading:i.panels.styleOptions,description:t?void 0:e.title,class:"flow-item",closable:(0,n.C)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsColorSizeUnivariateBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,a.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):(0,a.h)(a.F,null)}renderCancelButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,a.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):(0,a.h)(a.F,null)}renderVisualization(){const{visualizationOpen:e,smartMappingState:t}=this,{strings:i}=t,s=(0,n.j)(t),r=(0,n.b)(s,"color"),l=r?r.field?(0,n.o)(t,r.field)?.label:r.valueExpressionTitle||i.expression:s.field?(0,n.o)(t,s.field)?.label:s.valueExpressionTitle||i.expression;return(0,a.h)("calcite-block",{class:"color-size-univariate-block",heading:i.panels.colorSizeUnivariate.colorSizeStyle,collapsible:!0,open:e,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},(0,a.h)("calcite-label",{class:"attribute-name"},l),this.renderTheme(),this.renderDividedBy(),this.renderSymbolPairButton(),this.renderAboveAndBelowSymbols(),this.renderColorScheme(),this.renderSymbol(),this.renderColorSizeSlider(),this.renderSizeRange(),this.renderBackgroundStyle(),this.renderDefaultSymbol(),this.renderShowInLegend())}renderTheme(){const{smartMappingState:e}=this;return(0,a.h)("arcgis-smart-mapping-theme-button",{ref:e=>this.themeButtonNode=e,rendererSubtype:"colorSize",onArcgisSmartMappingThemeButtonBeforeOpen:()=>(0,n.B)(),onArcgisSmartMappingThemeButtonChange:t=>{const i="above-and-below"===(0,n.j)(e).authoringInfo.univariateTheme,s="above-and-below"===t.detail;let r=g.b;!i&&s&&(r=g.a),(0,b.r)(r(e,{theme:t.detail,fieldInfos:(0,n.f)(e),discardMinMax:!0}),this.flowItemNode).then((t=>{(0,n.u)(e,t.renderer),(0,a.f)(this.el),this.themeButtonNode&&(0,a.f)(this.themeButtonNode),this.rotationNode&&(0,a.f)(this.rotationNode),(0,a.f)(this.sizeRangeSliderNode),this.sliderNode&&((0,a.f)(this.sliderNode),this.sliderNode.updateStatistics())}),(e=>{(0,a.f)(this.themeButtonNode),this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e)}))}})}renderDividedBy(){const{smartMappingState:e}=this,{fields:t}=e,i=(0,n.j)(e),s=(0,n.a)(e);if(["color-age","color-age-size"].includes(s))return(0,a.h)(a.F,null);const r=(0,n.f)(e)[0];if(r.expression||r.simpleFieldType!==n.q.NUMBER)return(0,a.h)(a.F,null);if((0,n.F)(e,t).number<2)return(0,a.h)(a.F,null);const l=(0,n.b)(i,"color");return(0,a.h)("arcgis-smart-mapping-divided-by",{rendererSubtype:"color",normalizationField:l?.normalizationField??i.normalizationField??void 0,onArcgisSmartMappingDividedByChange:()=>{(0,a.f)(this.el),this.sliderNode.updateStatistics()},onArcgisSmartMappingDividedByError:e=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e.detail)})}renderSymbolPairButton(){const{smartMappingState:e}=this;if((0,n.x)(e))return(0,a.h)(a.F,null);return"above-and-below"===(0,n.j)(e).authoringInfo.univariateTheme?(0,a.h)("arcgis-smart-mapping-symbol-pair-button",{symbolType:"above-and-below",onArcgisSmartMappingSymbolPairButtonBeforeOpen:()=>(0,n.B)(),onArcgisSmartMappingSymbolPairButtonChange:()=>{(0,a.f)(this.el),this.sliderNode&&(0,a.f)(this.sliderNode),this.rotationNode&&(0,a.f)(this.rotationNode),this.symbolButtonNode&&(0,a.f)(this.symbolButtonNode),this.symbolPairButtonNode&&(0,a.f)(this.symbolPairButtonNode)},onArcgisSmartMappingSymbolPairButtonError:e=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e.detail),ref:e=>{e&&(this.symbolPairButtonNode=e)}}):(0,a.h)(a.F,null)}renderAboveAndBelowSymbols(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.j)(e),s=i.authoringInfo;if(!("above-and-below"===s.univariateTheme))return(0,a.h)(a.F,null);if(!s.univariateSymbolStyle||2!==i.classBreakInfos?.length)return(0,a.h)(a.F,null);const r=(0,n.b)(i,"color"),l=(0,n.o)(e,r?.field||i.field),o=l?.simpleFieldType===n.q.DATE,c=i.classBreakInfos[1].symbol,d=i.classBreakInfos[0].symbol;return(0,a.h)("div",{class:"symbol-above-and-below"},(0,a.h)("arcgis-smart-mapping-symbol-button",{class:"above-below-symbol-button",popoverReferenceElement:this.flowItemNode,symbol:d,type:"below",label:o?t.panels.colorSizeUnivariate.before:t.panels.colorSizeUnivariate.below,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,a.f)(this.el),this.symbolPairButtonNode&&(0,a.f)(this.symbolPairButtonNode),this.sliderNode&&(0,a.f)(this.sliderNode),this.rotationNode&&(0,a.f)(this.rotationNode)}}),(0,a.h)("arcgis-smart-mapping-symbol-button",{class:"above-below-symbol-button",popoverReferenceElement:this.flowItemNode,symbol:c,type:"above",label:o?t.panels.colorSizeUnivariate.after:t.panels.colorSizeUnivariate.above,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,a.f)(this.el),this.symbolPairButtonNode&&(0,a.f)(this.symbolPairButtonNode),this.sliderNode&&(0,a.f)(this.sliderNode),this.rotationNode&&(0,a.f)(this.rotationNode)}}))}renderColorScheme(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.j)(e);if(!("above-and-below"===i.authoringInfo.univariateTheme))return(0,a.h)(a.F,null);const s=(0,n.b)(i,"color");return(0,a.h)("calcite-label",null,t.panels.colorSizeUnivariate.colorScheme,(0,a.h)("calcite-segmented-control",{scale:"s",width:"full",onCalciteSegmentedControlChange:e=>{e.stopPropagation(),this.handleColorSchemeChange(e.target.selectedItem.value)}},(0,a.h)("calcite-segmented-control-item",{checked:!!s,value:"continuous",ref:e=>this.continuousNode=e},t.panels.colorSizeUnivariate.continuous),(0,a.h)("calcite-segmented-control-item",{checked:!s,value:"binary",ref:e=>this.binaryNode=e},t.panels.colorSizeUnivariate.binary)))}renderSymbol(){const{smartMappingState:e}=this,t=(0,n.j)(e),i=(0,n.b)(t,"color"),s=t.classBreakInfos;let r;return i?r=i.stops.map((e=>{const t=e.color.clone();return t.a=1,t})):s?.length&&(r=s.map((t=>(0,n.Z)(e,t.symbol)))),(0,a.h)("arcgis-smart-mapping-symbol-button",{colors:r,type:"color-ramp",rampType:i?"continuous":"discrete",ref:e=>this.symbolButtonNode=e,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,a.f)(this.el),(0,a.f)(this.sliderNode),this.rotationNode&&(0,a.f)(this.rotationNode)}})}renderColorSizeSlider(){return(0,a.h)("arcgis-smart-mapping-color-size-slider",{ref:e=>{e&&(this.sliderNode=e)},onArcgisSmartMappingColorSizeSliderChange:()=>{(0,a.f)(this.el),this.sliderNode&&(0,a.f)(this.sliderNode)},onArcgisSmartMappingColorSizeSliderError:e=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e.detail)})}renderSizeRange(){return(0,a.h)("arcgis-smart-mapping-size-range-slider",{onArcgisSmartMappingSizeRangeSliderError:e=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e.detail),ref:e=>this.sizeRangeSliderNode=e})}renderBackgroundStyle(){const{smartMappingState:e}=this,t=(0,n.a)(e);return(0,n.z)(e)&&["color-size"].includes(t)?(0,a.h)("arcgis-smart-mapping-background-symbol",null):(0,a.h)(a.F,null)}renderDefaultSymbol(){return(0,a.h)("arcgis-smart-mapping-default-symbol",{onArcgisSmartMappingDefaultSymbolBeforeToggle:()=>(0,n.B)(),onArcgisSmartMappingDefaultSymbolChange:()=>(0,a.f)(this.symbolButtonNode)})}renderShowInLegend(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.j)(e),s=(0,n.b)(i,"color"),r=s?.legendOptions,l=!r||!1!==r.showLegend;return(0,a.h)("calcite-label",{class:"legend-toggle-padding",layout:"inline-space-between"},t.panels.colorSizeUnivariate.includeInLegend,(0,a.h)("calcite-switch",{scale:"s",checked:l,onCalciteSwitchChange:()=>this.handleIncludeInLegendToggle()}))}renderTransparency(){const{smartMappingState:e}=this,t=(0,n.j)(e),i=(0,n.b)(t,"opacity");return(0,a.h)("arcgis-smart-mapping-transparency",{open:!!i,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e)})}renderRotation(){const{smartMappingState:e}=this,t=(0,n.j)(e),i=(0,n.b)(t,"opacity"),s=(0,n.b)(t,"rotation");return(0,a.h)("arcgis-smart-mapping-rotation",{open:!i&&!!s,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e)})}handleColorSchemeChange(e){const{smartMappingState:t}=this;(0,b.r)((0,g.b)(t,{isContinuous:"continuous"===e}),this.flowItemNode).then((e=>{(0,n.u)(t,e.renderer),(0,a.f)(this.el),this.sliderNode&&(0,a.f)(this.sliderNode),(0,n.B)()}),(e=>{this.continuousNode.checked?(this.continuousNode.checked=!1,this.binaryNode.checked=!0):(this.binaryNode.checked=!1,this.continuousNode.checked=!0),this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e)}))}handleIncludeInLegendToggle(){const{smartMappingState:e}=this,t=(0,n.j)(e),i=(0,n.b)(t,"color"),a=(0,n.b)(t,"size"),s=a.legendOptions;s&&!1===s.showLegend?(s.title?s.showLegend=!0:a.legendOptions=void 0,i?.legendOptions?.title?i.legendOptions.showLegend=!0:i&&(i.legendOptions=void 0)):(a.legendOptions=s||{},a.legendOptions.showLegend=!1,i&&(i.legendOptions=s||{},i.legendOptions.showLegend=!1)),(0,n.u)(e)}get el(){return(0,a.g)(this)}};X.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.color-size-univariate-block{overflow-x:hidden}.attribute-name{word-break:break-all}.symbol-above-and-below{display:flex;justify-content:space-between}.above-below-symbol-button{width:49%}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";const ee=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsCompareClose=(0,a.c)(this,"arcgisSmartMappingPanelsCompareClose",7),this.arcgisSmartMappingPanelsCompareBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsCompareBackClick",7),this.arcgisSmartMappingPanelsCompareError=(0,a.c)(this,"arcgisSmartMappingPanelsCompareError",7),this.manager=(0,r.u)(this),this.smartMappingState=(0,o.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsCompareClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,n.h)(i,e,t),this.arcgisSmartMappingPanelsCompareClose.emit("cancel")},this.hideRotation=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.visualizationOpen=!1,this.statisticsStatus=n.s.MISSING}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=this.smartMappingState,i=(0,n.j)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.getStatistics()}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,g.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,hideLayerTitle:t,strings:i}=this.smartMappingState;return(0,a.h)(a.H,{key:"cd4ea7e490a9f81d6c02a29c0d33e91f9236148f",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"0eac45c5db3e63414f46d1d46d5ca14cef79a54b",heading:i.panels.styleOptions,description:t?void 0:e.title,class:"flow-item",closable:(0,n.C)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsCompareBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderRotation()))}renderDoneButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,a.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):(0,a.h)(a.F,null)}renderCancelButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,a.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):(0,a.h)(a.F,null)}renderVisualization(){const{smartMappingState:e}=this,{strings:t}=e,{visualizationOpen:i,hideRotation:s}=this,r=(0,n.w)(e)&&!s,l=(0,n.j)(e),o=(0,n.b)(l,"color"),c=(0,n.G)(l,"color"),d=(0,n.o)(e,o.field),p=(0,n.o)(e,o.normalizationField),h=("ratio"===c.style?t.panels.compare.ratioTitle:"percent"===c.style?t.panels.compare.percentTitle:t.panels.compare.percentTotalTitle).replace(/\$\{field1\}/gu,d.label).replace("${field2}",p.label);return(0,a.h)("calcite-block",{class:"compare-block",heading:t.panels.compare.compareStyle,collapsible:r,open:i,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},(0,a.h)("calcite-label",null,h),this.renderSymbol(),this.renderColorSlider(),this.renderLabels(),this.renderCenterAt(),this.renderDefaultSymbol(),this.renderShowInLegend())}renderSymbol(){const{smartMappingState:e}=this,t=(0,n.j)(e),i=(0,n.b)(t,"color"),s=t.classBreakInfos[0].symbol,r=i.stops.map((e=>{const t=e.color.clone();return t.a=1,t}));return(0,a.h)("arcgis-smart-mapping-symbol-button",{symbol:s,colors:r,type:"color-ramp",rampType:"continuous",ref:e=>{e&&(this.symbolButtonNode=e)},onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,a.f)(this.el),this.sliderNode&&(0,a.f)(this.sliderNode),this.rotationNode&&(0,a.f)(this.rotationNode)}})}renderColorSlider(){const{smartMappingState:e}=this;return(0,a.h)("arcgis-smart-mapping-color-slider",{ref:e=>{e&&(this.sliderNode=e)},onArcgisSmartMappingColorSliderChange:()=>{const t=(0,n.j)(e),i=(0,n.b)(t,"color"),s=(0,n.G)(t,"color"),r=!!s&&"percent"===s.style,l=!!s&&"percent-of-total"===s.style;i.stops[0].label=`< ${(0,u.g)(i.stops[0].value,r,l)}`,i.stops[2].label=(0,u.g)(i.stops[2].value,r,l),i.stops[4].label=`> ${(0,u.g)(i.stops[4].value,r,l)}`,this.segmentedControlNode&&(1===i.stops[2].value?(this.equalNode.checked=!0,this.averageNode.checked=!1):(this.equalNode.checked=!1,this.averageNode.checked=!0)),(0,a.f)(this.el),this.sliderNode&&(0,a.f)(this.sliderNode)},onArcgisSmartMappingColorSliderError:e=>this.arcgisSmartMappingPanelsCompareError.emit(e.detail)})}renderLabels(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.j)(e),s=(0,n.G)(i,"color"),r=s?s.style:void 0;return(0,a.h)("calcite-label",null,t.panels.compare.labels,(0,a.h)("calcite-select",{width:"full",role:"button",label:t.panels.compare.labels,onCalciteSelectChange:e=>this.handleLabelChange(e)},(0,a.h)("calcite-option",{value:t.panels.compare.ratioLabel,label:t.panels.compare.ratioLabel,selected:"ratio"===r}),(0,a.h)("calcite-option",{value:t.panels.compare.percentTotalLabel,label:t.panels.compare.percentTotalLabel,selected:"percent-of-total"===r}),(0,a.h)("calcite-option",{value:t.panels.compare.percentLabel,label:t.panels.compare.percentLabel,selected:"percent"===r})))}renderCenterAt(){const{statistics:e,statisticsStatus:t,smartMappingState:i}=this,{strings:s}=i;if(t!==n.s.SUCCESS)return(0,a.h)(a.F,null);const r=(0,n.j)(i),l=(0,n.b)(r,"color");if(!(0,n.M)(e.min)||!(0,n.M)(e.max)||e.min>=1||e.max<=1)return(0,a.h)(a.F,null);const o=1===l.stops[2].value?"equal":"average";return(0,a.h)(a.F,null,(0,a.h)("calcite-label",null,s.panels.compare.centerAt),(0,a.h)("calcite-segmented-control",{scale:"s",width:"full",onCalciteSegmentedControlChange:e=>{e.stopPropagation(),this.handleCenterAtChange(e.target.selectedItem.value)},ref:e=>{e&&(this.segmentedControlNode=e)}},(0,a.h)("calcite-segmented-control-item",{checked:"equal"===o,value:"equal",ref:e=>{e&&(this.equalNode=e)}},s.panels.compare.centerEqualValues),(0,a.h)("calcite-segmented-control-item",{checked:"average"===o,value:"average",ref:e=>{e&&(this.averageNode=e)}},s.panels.compare.centerAverageValue)))}renderDefaultSymbol(){return(0,a.h)("arcgis-smart-mapping-default-symbol",{onArcgisSmartMappingDefaultSymbolBeforeToggle:()=>(0,n.B)(),onArcgisSmartMappingDefaultSymbolChange:()=>(0,a.f)(this.symbolButtonNode)})}renderShowInLegend(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.j)(e),s=(0,n.b)(i,"color").legendOptions,r=!s||!1!==s.showLegend;return(0,a.h)("calcite-label",{class:"legend-toggle-padding",layout:"inline-space-between"},t.panels.compare.includeInLegend,(0,a.h)("calcite-switch",{scale:"s",checked:r,onCalciteSwitchChange:()=>this.handleIncludeInLegendToggle()}))}renderRotation(){const{smartMappingState:e}=this,t=(0,n.j)(e),i=(0,n.b)(t,"opacity"),s=(0,n.b)(t,"rotation");return(0,a.h)("arcgis-smart-mapping-rotation",{open:!i&&!!s,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsCompareError.emit(e)})}handleLabelChange(e){const{smartMappingState:t}=this,i=e.currentTarget.value,{strings:s}=t,r=i===s.panels.compare.ratioLabel?"ratio":i===s.panels.compare.percentTotalLabel?"percent-of-total":"percent",l=(0,n.j)(t),o=(0,n.b)(l,"color");(0,n.G)(l,"color").style=r,"percent"===r?(o.stops[0].label=`< ${(0,u.g)(o.stops[0].value,!0,!1)}`,o.stops[2].label=(0,u.g)(o.stops[2].value,!0,!1),o.stops[4].label=`> ${(0,u.g)(o.stops[4].value,!0,!1)}`):"percent-of-total"===r?(o.stops[0].label=`< ${(0,u.g)(o.stops[0].value,!1,!0)}`,o.stops[2].label=(0,u.g)(o.stops[2].value,!1,!0),o.stops[4].label=`> ${(0,u.g)(o.stops[4].value,!1,!0)}`):(o.stops[0].label=`< ${(0,u.g)(o.stops[0].value,!1,!1)}`,o.stops[2].label=(0,u.g)(o.stops[2].value,!1,!1),o.stops[4].label=`> ${(0,u.g)(o.stops[4].value,!1,!1)}`),(0,n.u)(t),(0,a.f)(this.el)}getStatistics(){const{smartMappingState:e}=this,{layer:t,useFeatureReduction:i,mapView:a,modules:s}=e,r=t,l=(0,n.j)(e),o=this.getFieldInfo(),c=(0,n.b)(l,"color"),d=c?c.normalizationField:l.normalizationField,p=(0,n.G)(l,"color")||{};this.statisticsStatus=n.s.IN_PROGRESS,this.statistics||s.summaryStatistics({layer:r,view:a,field:o.field??void 0,valueExpression:o.expression??void 0,normalizationField:d??void 0,forBinning:"featureReduction"in r&&"binning"===r.featureReduction?.type&&i,outStatisticTypes:{exclude:["median"]}}).then((e=>{if(0===e.count){const[t,i]=this.getDefaultDataRange(o),a=p.minSliderValue||t,s=p.maxSliderValue||i;e.min=a,e.max=s,e.avg=(s+a)/2,(0,n.M)(p.minSliderValue)||(p.minSliderValue=a,p.maxSliderValue=s)}else if(!(0,n.M)(e.avg)||!(0,n.M)(e.min)||!(0,n.M)(e.max))return void(this.statisticsStatus=n.s.FAILED);e=(0,n.ag)(e),this.statistics=e,this.statisticsStatus=n.s.SUCCESS}),(e=>{console.log(e),this.statisticsStatus=n.s.FAILED}))}getDefaultDataRange(e){if(e.simpleFieldType===n.q.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}getFieldInfo(){const{smartMappingState:e}=this,t=(0,n.j)(e),i=(0,n.b)(t,"color"),a=(0,n.o)(e,i?i.field:t.field);return{field:i?.field||t.field,expression:i?.valueExpression||t.valueExpression,expressionTitle:i?.valueExpressionTitle||t.valueExpressionTitle,simpleFieldType:a?a.simpleFieldType:n.q.NUMBER}}handleCenterAtChange(e){const{statisticsStatus:t,smartMappingState:i}=this,s=this.statistics;if(t!==n.s.SUCCESS)return;const r=(0,n.j)(i),l=(0,n.b)(r,"color"),o=(0,n.G)(r,"color"),c=!!o&&"percent"===o.style,d=!!o&&"percent-of-total"===o.style;let p;if("average"===e){const e=s.avg;let t=Math.max(e-s.stddev,s.min),i=Math.min(e+s.stddev,s.max);0===s.count&&(t=s.min,i=s.max),p=M([t,i]),t=p[0],i=p[1],p=[Math.max(t,s.min),Math.max(t+(e-t)/2,s.min),e,Math.min(e+(i-e)/2,s.max),Math.min(i,s.max)],p=M(p)}else{let e=Math.max(1-s.stddev,s.min),t=Math.min(1+s.stddev,s.max);p=M([e,t]),e=p[0],t=p[1],p=[Math.max(e,s.min),Math.max(e+(1-e)/2,s.min),1,Math.min(1+(t-1)/2,s.max),Math.min(t,s.max)],p=M(p)}l.stops[0].value=p[0],l.stops[0].label=`< ${(0,u.g)(p[0],c,d)}`,l.stops[1].value=p[1],l.stops[1].label="",l.stops[2].value=p[2],l.stops[2].label=(0,u.g)(p[2],c,d),l.stops[3].value=p[3],l.stops[3].label="",l.stops[4].value=p[4],l.stops[4].label=`> ${(0,u.g)(p[4],c,d)}`,(0,n.u)(i),(0,a.f)(this.symbolButtonNode),this.sliderNode&&(0,a.f)(this.sliderNode)}handleIncludeInLegendToggle(){const{smartMappingState:e}=this,t=(0,n.j)(e),i=(0,n.b)(t,"color"),a=i.legendOptions;a&&!1===a.showLegend?a.title?a.showLegend=!0:i.legendOptions=void 0:(i.legendOptions=a||{},i.legendOptions.showLegend=!1),(0,n.u)(e)}get el(){return(0,a.g)(this)}};ee.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.compare-block{overflow-x:hidden}.attribute-name{word-break:break-all}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";const te=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsDotDensityBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsDotDensityBackClick",7),this.arcgisSmartMappingPanelsDotDensityClose=(0,a.c)(this,"arcgisSmartMappingPanelsDotDensityClose",7),this.manager=(0,r.u)(this),this.labelNodes={},this.inputNodes={},this.legendSwatchNodes={},this.popoverSettings={},this.labelChanged=!1,this.smartMappingState=(0,o.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsDotDensityClose.emit("save")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{layer:e,mapView:t,modules:i}=this.smartMappingState,a=(0,n.j)(this.smartMappingState);this.dotValue=a.dotValue,(0,n.M)(a.referenceScale)&&(this.dotValue=Math.round(a.calculateDotValue(t.scale)),this.tickDotValue=this.dotValue),this.originalRendererJSON=a.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?i.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())));const{mapView:e,modules:t}=this.smartMappingState;this.mapViewWatchHandle=t.reactiveUtils.watch((()=>e.scale),(0,v.d)((e=>{const t=(0,n.j)(this.smartMappingState);if((0,n.M)(t.referenceScale)){const i=Math.round(t.calculateDotValue(e));this.handleDotValueChange(i)}}),300)),(0,w.i)(this.el.shadowRoot,this.smartMappingState.modules.esriConfig),this.scaleHandle=(0,g.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.dotWatchHandle?.remove(),this.mapViewWatchHandle?.remove(),this.scaleHandle?.remove()}render(){const{hideLayerTitle:e,layer:t,mapImageSublayer:i,strings:s}=this.smartMappingState,r=e?void 0:i?.title??t.title;return(0,a.h)(a.H,{key:"9130120c9b1425213dbf0e4749b161bbf120c50e",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"85a0cf61fa6eaafc185848f652b051450f9e9e78",class:"flow-item",heading:s.panels.dotDensity.styleOptions,description:r,closable:(0,n.C)(this.el),showBackButton:this.showBackButton,selected:this.selected,ref:e=>this.flowItemNode=e,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsDotDensityBackClick.emit()}},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization()))}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,a.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{const{originalRendererJSON:t,originalFeatureReduction:i}=this;(0,n.B)(),(0,n.h)(e,t,i),this.arcgisSmartMappingPanelsDotDensityClose.emit("cancel")},appearance:"outline-fill",width:"half"},t.cancel)}renderVisualization(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-block",{class:"dot-density-block",heading:e.panels.dotDensity.dotDensityStyle,open:!0},this.renderDotStyle(),this.renderLegend(),this.renderUnits(),this.renderDotValue(),this.renderDotSize(),this.renderBackgroundStyle(),this.renderOptions())}renderDotStyle(){const{smartMappingState:e}=this,t=(0,n.j)(e).attributes.map((e=>e.color));return(0,a.h)("arcgis-smart-mapping-symbol-button",{type:"dot-density-ramp",rampType:"discrete",colors:t,onArcgisSmartMappingSymbolButtonSymbolChange:()=>(0,a.f)(this.el)})}renderLegend(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.j)(e);return(0,a.h)("calcite-label",null,t.panels.dotDensity.legend,(0,a.h)("calcite-list",{label:t.panels.dotDensity.values,class:"top-grey-border",dragEnabled:!0,onCalciteListOrderChange:e=>{const t=Array.from(e.target.children);this.handleSortLegend(t)}},i.attributes.map(((e,t)=>this.renderLegendItem(e,t)))))}renderLegendItem(e,t){const{smartMappingState:i}=this,{modules:s,selectedAttribute:r,strings:l}=i,o=(0,n.j)(i);return(0,a.h)("calcite-list-item",{value:e.field,key:`item-${e.field}`},(0,a.h)("div",{class:"symbol",slot:"content-start",tabIndex:0,role:"button","aria-label":l.panels.dotDensity.editSymbolFor.replace("${fieldName}",e.label),"aria-haspopup":"true","aria-expanded":r===t,onClick:()=>{this.popoverSettings?.popoverNode?(this.legendSwatchNodes[t].classList.remove("selected"),this.popoverSettings.index===t?((0,n.B)(),this.popoverSettings.popoverNode=void 0,this.popoverSettings.index=void 0):(this.popoverSettings.index=t,this.openSymbolStylerForLegendSwatch(t))):(this.popoverSettings.index=t,this.openSymbolStylerForLegendSwatch(t))},onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.openSymbolStylerForLegendSwatch(t))},ref:e=>this.legendSwatchNodes[t]=e},(0,a.h)("img",{src:s.symbolUtils.renderDotDensityPreviewHTML(o,new s.EsriColor([e.color.r,e.color.g,e.color.b]),{swatchSize:16}).src,"aria-hidden":"true"})),this.renderTextNode(e,t))}renderTextNode(e,t){const{strings:i}=this.smartMappingState;return(0,a.h)(a.F,null,(0,a.h)("div",{"aria-label":i.panels.dotDensity.editLabelFor.replace("${fieldName}",e.label),class:"label text-wrap",slot:"content",tabIndex:0,onClick:e=>{e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus()},onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus())},ref:e=>this.labelNodes[t]=e},e.label),(0,a.h)("calcite-input",{class:"hidden",slot:"content",value:e.label,placeholder:e.label,onFocusout:e=>{const i=e.target;this.handleLegendItemTextChange(t,i.value)},onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key||"Enter"===e.key){e.preventDefault();const i=e.currentTarget;this.handleLegendItemTextChange(t,i.value)}},ref:e=>this.inputNodes[t]=e}))}renderUnits(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.j)(e);return(0,a.h)("calcite-label",null,t.panels.dotDensity.dotsRepresent,(0,a.h)("calcite-input",{value:i.legendOptions?.unit||"",onCalciteInputInput:t=>{const i=(0,n.j)(e),a=t.target;i.legendOptions=i.legendOptions??{unit:void 0},i.legendOptions.unit=a.value||"",this.updateDotValueEquation(),(0,n.u)(e)}}))}renderDotValue(){const{smartMappingState:e}=this,{modules:t,strings:i}=e,s=(0,n.j)(e),r=s.authoringInfo,{tickDotValue:l}=this;if(!r)return(0,a.h)(a.F,null);const o=this.initSliderSteps(),c=[{mode:"position",visibleElements:{labels:!0},labelsVisible:!0,values:[this.getSliderStepsPos(l)],tickCreatedFunction:(e,t,i)=>{t.onclick=()=>{this.handleDotValueChange(l)},i.onclick=()=>{this.handleDotValueChange(l)}}}];if(this.dotValueSlider){let e={values:[this.getSliderStepsPos(this.dotValue)]};(o||this.dotValueSlider.tickConfigs[0].values[0]!==c[0].values[0])&&(e={min:0,max:this.sliderSteps.length-1,values:[this.getSliderStepsPos(this.dotValue)],labelFormatFunction:e=>this.sliderSteps[e],tickConfigs:c}),this.dotValueSlider.set(e)}else{const e={min:0,max:this.sliderSteps.length-1,values:[this.getSliderStepsPos(this.dotValue)],visibleElements:{labels:!0,rangeLabels:!0},rangeLabelInputsEnabled:!1,precision:0,labelInputsEnabled:!0,labelFormatFunction:e=>this.sliderSteps[e],inputFormatFunction:e=>this.sliderSteps[e],inputParseFunction:e=>{this.labelChanged=!0;let t=Number.parseInt(e);return Number.isNaN(t)?this.dotValueSlider.values[0]:(t<=0&&(t=1),this.sliderSteps.includes(t)||(this.sliderSteps?.push(t),this.sliderSteps?.sort(((e,t)=>e-t)),this.dotValueSlider?.set({max:this.sliderSteps.length-1,values:[this.getSliderStepsPos(t)]})),this.handleDotValueChange(t),this.getSliderStepsPos(t))},tickConfigs:c};this.dotValueSlider=new t.Slider(e),this.dotValueSlider?.on("thumb-change",(e=>{this.labelChanged||this.handleDotValueChange(this.sliderSteps[e.value])})),this.dotValueSlider?.on("thumb-drag",(e=>{this.labelChanged||this.handleDotValueChange(this.sliderSteps[e.value])}))}const d=r.minSliderValue!==r.maxSliderValue,p=r.minSliderValue.toString().length>5||r.maxSliderValue.toString().length>5;return d?(0,a.h)("calcite-label",null,i.panels.dotDensity.dotValue,(0,a.h)("div",{class:"dot-value-content"},(0,a.h)("div",{class:"slider dot-value-slider "+(p?"slider-bottom-label":""),ref:e=>{setTimeout((()=>{this.dotValueSlider&&e&&(this.dotValueSlider.container=e)}),1)}}),(0,a.h)("calcite-label",{alignment:"center",ref:e=>this.dotValueEquationNode=e},i.panels.dotDensity.dotValueEquation.replace("${value}",this.dotValue.toString()).replace("${units}",s.legendOptions?.unit||"")))):(0,a.h)(a.F,null)}renderDotSize(){const{smartMappingState:e}=this,{layer:t,mapImageSublayer:i,strings:s}=e;if(i&&t.version<11.1)return(0,a.h)(a.F,null);const r=(0,n.j)(e),l=Math.round(r.dotSize/.75*10)/10;return(0,a.h)(a.F,null,(0,a.h)("calcite-label",null,s.panels.dotDensity.dotSize),(0,a.h)("arcgis-smart-mapping-slider-input",{min:.5,max:4,values:[l],precision:1,suffixText:s.panels.dotDensity.px,onArcgisSmartMappingSliderInputChange:t=>{const i=(0,n.j)(e),a=Math.round(.75*t.detail*10)/10;a!==i.dotSize&&(i.dotSize=a,(0,n.u)(e))}}))}renderBackgroundStyle(){return(0,a.h)("arcgis-smart-mapping-background-symbol",{onArcgisSmartMappingBackgroundSymbolChange:()=>(0,a.f)(this.el)})}renderOptions(){const{smartMappingState:e}=this,{mapImageSublayer:t,mapView:i,strings:s}=e,r=(0,n.j)(e);return(0,a.h)(a.F,null,(0,a.h)("calcite-label",{layout:"inline-space-between",class:"top-margin"},s.panels.dotDensity.varyDotByScale,(0,a.h)("calcite-switch",{scale:"s",checked:r.referenceScale===i.scale,onCalciteSwitchChange:t=>{const a=t.target;(0,n.j)(e).referenceScale=a.checked?i.scale:void 0,(0,n.u)(e)}})),!t&&(0,a.h)("calcite-label",{layout:"inline-space-between"},s.panels.dotDensity.blendOverlappingColors,(0,a.h)("calcite-switch",{scale:"s",checked:r.dotBlendingEnabled,onCalciteSwitchChange:t=>{const i=t.target;(0,n.j)(e).dotBlendingEnabled=i.checked,(0,n.u)(e)}})))}getSliderStepsPos(e){let t=0;return this.sliderSteps.forEach(((i,a)=>{(e>=i||e-this.sliderSteps[t]>i-e)&&(t=a)})),t}handleLegendItemTextChange(e,t){const{smartMappingState:i}=this,a=(0,n.j)(i);if(!t.length){t=this.originalRendererJSON.attributes.find((t=>t.field===a.attributes[e].field)).label}a.attributes[e].label=t,this.inputNodes[e].classList.add("hidden"),this.labelNodes[e].classList.remove("hidden"),this.labelNodes[e].innerHTML=t,setTimeout((()=>this.labelNodes[e].focus()),300),(0,n.u)(i)}handleDotValueChange(e){const{smartMappingState:t}=this,{mapView:i}=t;this.dotValue=e,this.labelChanged=!1;const s=(0,n.j)(t);s.dotValue=Math.round(this.dotValue),s.referenceScale=(0,n.M)(s.referenceScale)?i.scale:void 0,this.updateDotValueEquation(),(0,n.u)(t),(0,a.f)(this.el)}handleSortLegend(e){const{smartMappingState:t}=this,i=(0,n.j)(t),s=i.attributes.map((e=>e.clone())),r=e.map((e=>e.value));s.sort(((e,t)=>r.indexOf(e.field)-r.indexOf(t.field))),i.attributes=s,(0,n.u)(t),(0,a.f)(this.el)}initSliderSteps(){const{smartMappingState:e}=this,t=(0,n.j)(e).authoringInfo,i=this.dotValue,a=t.minSliderValue,s=Math.max(t.maxSliderValue,i);if(this.sliderSteps?.includes(i))return!1;let r=(s-a)/2**19;r=Math.max(r,1);const l=[a];for(let e=0;e<79;e++){let t=Math.round(a+2**(e/4)*r);if(t<a+(e+1)&&(t=a+(e+1)),i<t&&i>l[l.length-1]&&l.push(i),t>=s){l.push(s);break}l.push(t)}return this.sliderSteps=l,!0}openSymbolStylerForLegendSwatch(e){const{smartMappingState:t}=this,{strings:i}=t;(0,n.B)();const s=this.legendSwatchNodes[e];document.createElement("div").className="symbol-styler-div",this.popoverSettings.popoverNode=(0,C.c)(t,{referenceElement:this.flowItemNode,heading:i.styler.symbolStyle}),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,C.r)(this.popoverSettings.popoverNode),setTimeout((()=>s?.focus()),300),s.classList.remove("selected")})),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{(0,C.r)(this.popoverSettings.popoverNode),s.classList.remove("selected"),this.popoverSettings.popoverNode=void 0})),(0,C.b)(t,{selectedAttribute:e,popoverNode:this.popoverSettings.popoverNode,onChange:()=>{(0,n.u)(t),(0,a.f)(this.el)}}),s.classList.add("selected")}updateDotValueEquation(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.j)(e);this.dotValueEquationNode.innerHTML=t.panels.dotDensity.dotValueEquation.replace("${value}",this.dotValue.toString()).replace("${units}",this.htmlEncode(i.legendOptions?.unit||""))}htmlEncode(e){const t=document.createElement("textarea");return t.innerText=e,t.innerHTML.split("<br>").join("\n")}get el(){return(0,a.g)(this)}};te.style=":host {\n  width: 100%;\n  display: none;\n}\n:host([selected]) {\n  display: flex;\n}\n\n.flow-item {\n  height: 100%;\n}\n\n.dot-density-block {\n  overflow-x: hidden;\n}\n\n.hidden {\n  display: none;\n}\n\nimg {\n  width: 16px;\n  height: 16px;\n}\n\n.label {\n  font-size: var(--calcite-font-size--1);\n  padding-top: 5px;\n  padding-bottom: 5px;\n}\n\n.label:focus,\n.symbol:focus {\n  outline: 2px solid var(--calcite-color-brand);\n}\n\n.selected {\n  outline: 1px solid var(--calcite-color-brand);\n}\n\n.symbol {\n  width: 16px;\n  height: 16px;\n  margin: 2px;\n}\n\n.top-margin {\n  margin-block-start: var(--calcite-label-margin-bottom, 0.75rem);\n}\n\n.top-grey-border {\n  border-top: 1px solid #e0e0e0;\n}\n\n.text-wrap {\n  overflow-wrap: anywhere;\n}\n\n.dot-value-content {\n  display: flex;\n  flex-direction: column;\n}\n\n.dot-value-slider {\n  width: 100%;\n  height: 70px;\n  position: relative;\n  margin: 0 auto 10px auto;\n\n  &.esri-slider--horizontal .esri-slider__tick-label {\n    cursor: pointer;\n  }\n  &.slider-bottom-label .esri-slider__max,\n  &.slider-bottom-label .esri-slider__min {\n    width: fit-content;\n    position: absolute;\n    bottom: 11px;\n  }\n  &.slider-bottom-label .esri-slider__max {\n    right: 0;\n    text-align: right;\n  }\n  &.slider-bottom-label .esri-slider__min {\n    left: 0;\n    text-align: left;\n  }\n  &.esri-slider--horizontal .esri-slider__label {\n    text-decoration: underline;\n  }\n  &.esri-slider--horizontal .esri-slider__label:hover {\n    border: 1px solid #bbb;\n    background-color: #f3f3f3;\n    text-decoration: none;\n    z-index: 1;\n  }\n}\n";const ie=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsHeatmapClose=(0,a.c)(this,"arcgisSmartMappingPanelsHeatmapClose",7),this.arcgisSmartMappingPanelsHeatmapBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsHeatmapBackClick",7),this.arcgisSmartMappingPanelsHeatmapError=(0,a.c)(this,"arcgisSmartMappingPanelsHeatmapError",7),this.manager=(0,r.u)(this),this.smartMappingState=(0,o.u)(),this.handleDone=()=>{(0,n.B)(),this.arcgisSmartMappingPanelsHeatmapClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,n.h)(i,e,t),this.arcgisSmartMappingPanelsHeatmapClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,i=(0,n.j)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,g.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){(0,n.ah)(),this.scaleHandle?.remove()}render(){const{hideLayerTitle:e,layer:t,mapImageSublayer:i,strings:s}=this.smartMappingState,r=e?void 0:i?.title??t.title;return(0,a.h)(a.H,{key:"d473790f213c379ca429843822a2659349a74359",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"9ccf0ba541185aad8fd9c1eede0c445e89171bcd",class:"flow-item",heading:s.panels.heatmap.styleOptions,description:r,closable:(0,n.C)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsHeatmapBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderDoneButton(),this.renderCancelButton()))}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},e.cancel)}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderVisualization(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.j)(e),s=i.field?(0,n.o)(e,i.field)?.label:void 0;return(0,a.h)("calcite-block",{class:"heatmap-block",heading:t.panels.heatmap.heatmapStyle,open:!0},s?(0,a.h)("calcite-label",{class:"attribute-name"},s):null,this.renderSymbol(),this.renderHeatmapSlider(),this.renderSoftEdges(),this.renderInfluenceValue(),this.renderLock(),this.renderRegenerate())}renderSymbol(){const{smartMappingState:e}=this,t=(0,n.j)(e).colorStops.map((e=>{const t=e.color.clone();return t.a=1,t}));return(0,a.h)("arcgis-smart-mapping-symbol-button",{type:"heatmap-ramp",rampType:"continuous",colors:t,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,a.f)(this.el),this.sliderNode&&(0,a.f)(this.sliderNode)}})}renderHeatmapSlider(){return(0,a.h)("arcgis-smart-mapping-heatmap-slider",{ref:e=>{e&&(this.sliderNode=e)}})}renderSoftEdges(){const{smartMappingState:e}=this,{strings:t,modules:i}=e,s=i.rendererJsonUtils.fromJSON(this.originalRendererJSON);return(0,a.h)("div",null,(0,a.h)("calcite-label",null," ",t.panels.heatmap.softenEdges," "),(0,a.h)("calcite-slider",{min:0,max:1,minLabel:t.panels.heatmap.less,maxLabel:t.panels.heatmap.more,step:.01,value:s.authoringInfo?.fadeRatio||0,onCalciteSliderInput:t=>{const i=t.target.value,s=(0,n.j)(e);if(s.authoringInfo?.fadeRatio===i)return;const r=(0,h.u)(e,i);(0,n.u)(e,r),this.sliderNode&&(0,a.f)(this.sliderNode)}}),(0,a.h)("div",{class:"slider-labels","aria-hidden":"true"},(0,a.h)("calcite-label",null,t.panels.heatmap.less),(0,a.h)("calcite-label",null,t.panels.heatmap.more)))}renderInfluenceValue(){const{smartMappingState:e}=this,{strings:t,modules:i}=e,s=i.rendererJsonUtils.fromJSON(this.originalRendererJSON);return(0,a.h)("div",{class:"top-bottom-margin-small"},(0,a.h)("calcite-label",null,t.panels.heatmap.areaOfInfluence),(0,a.h)("calcite-slider",{min:1,max:60,minLabel:t.panels.heatmap.smaller,maxLabel:t.panels.heatmap.larger,value:s.radius||0,onCalciteSliderInput:t=>{const i=t.target;(0,n.j)(e).radius=i.value||10,(0,n.u)(e)}}),(0,a.h)("div",{class:"slider-labels","aria-hidden":"true"},(0,a.h)("calcite-label",null,t.panels.heatmap.smaller),(0,a.h)("calcite-label",null,t.panels.heatmap.larger)))}renderLock(){const{smartMappingState:e}=this,{mapImageSublayer:t,strings:i}=e;if(t)return(0,a.h)(a.F,null);const s=(0,n.j)(e),{referenceScale:r}=s;return(0,a.h)("div",{class:"top-margin-medium"},(0,a.h)("calcite-label",{layout:"inline-space-between"},i.panels.heatmap.lock,(0,a.h)("calcite-switch",{scale:"s",checked:!!r,onCalciteSwitchChange:()=>{const{mapView:t}=this.smartMappingState,i=(0,n.j)(e);i.referenceScale=i.referenceScale?0:t.scale,(0,n.u)(e)},ref:e=>this.calciteSwitchNode=e,onMouseOver:()=>(0,n.ai)(this.calciteSwitchNode,i.panels.heatmap.lockHelp),onMouseOut:()=>(0,n.ah)(),onFocus:()=>(0,n.ai)(this.calciteSwitchNode,i.panels.heatmap.lockHelp),onFocusout:()=>(0,n.ah)()})))}renderRegenerate(){const{smartMappingState:e}=this,{mapImageSublayer:t,strings:i}=e;return t?(0,a.h)(a.F,null):(0,a.h)("div",{class:"top-bottom-margin-small"},(0,a.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",onClick:()=>{(0,b.r)((0,h.g)(e),this.flowItemNode).then((()=>{(0,n.u)(e)}),(e=>this.arcgisSmartMappingPanelsHeatmapError.emit(e)))},label:i.panels.heatmap.regenerate},i.panels.heatmap.regenerate))}get el(){return(0,a.g)(this)}};ie.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.heatmap-block{overflow-x:hidden}.attribute-name{word-break:break-all}.slider-labels{display:flex;justify-content:space-between}.top-bottom-margin-small{margin:10px 0}.top-margin-medium{margin-top:18px}";const ae=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsPredominanceSizeBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsPredominanceSizeBackClick",7),this.arcgisSmartMappingPanelsPredominanceSizeClose=(0,a.c)(this,"arcgisSmartMappingPanelsPredominanceSizeClose",7),this.arcgisSmartMappingPanelsPredominanceSizeError=(0,a.c)(this,"arcgisSmartMappingPanelsPredominanceSizeError",7),this.manager=(0,r.u)(this),this.tileNodes={},this.smartMappingState=(0,o.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsPredominanceSizeClose.emit("save")},this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsPredominanceSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"predominance":{const e=document.createElement("arcgis-smart-mapping-panels-predominance");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsPredominanceClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsPredominanceBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsPredominanceError",(({detail:e})=>this.arcgisSmartMappingPanelsPredominanceSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,i=(0,n.j)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,n.af)(this.smartMappingState,this.el)}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,g.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,hideLayerTitle:t,mapImageSublayer:i,strings:s}=this.smartMappingState,r=t?void 0:i?.title??e.title;return(0,a.h)(a.H,{key:"e5f6e6b1a44f6fe803b13aecf172ffd53882f71f",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"7e8509b871ed9bcf4776b3cf20fe3fe0cf409195",class:"flow-item",heading:s.panels.styleOptions,description:r,closable:(0,n.C)(this.el),showBackButton:this.showBackButton,selected:this.selected,ref:e=>this.flowItemNode=e,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsPredominanceSizeBackClick.emit()}},this.renderPredominanceTile(),this.renderSizeTile(),this.renderTransparency(),this.renderRotation(),this.renderDoneButton(),this.renderCancelButton()))}renderPredominanceTile(){return(0,a.h)("arcgis-smart-mapping-tile",{type:"predominance",selected:!1,onArcgisSmartMappingTileSelect:()=>{this.lastClick="predominance",this.handleOptionsClick("predominance")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("predominance"),ref:e=>{e&&(this.tileNodes.predominance=e)}})}renderSizeTile(){return(0,a.h)("arcgis-smart-mapping-tile",{type:"size",selected:"size"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="size",this.handleOptionsClick("size")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),ref:e=>{e&&(this.tileNodes.size=e)}})}renderTransparency(){const{smartMappingState:e}=this,t=(0,n.b)((0,n.j)(e),"opacity");return(0,a.h)("arcgis-smart-mapping-transparency",{open:!!t,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsPredominanceSizeError.emit(e)})}renderRotation(){const{smartMappingState:e}=this,t=(0,n.b)((0,n.j)(e),"opacity"),i=(0,n.b)((0,n.j)(e),"rotation");return(0,a.h)("arcgis-smart-mapping-rotation",{open:!t&&!!i,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsPredominanceSizeError.emit(e)})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,a.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{(0,n.h)(e,this.originalRendererJSON,this.originalFeatureReduction),this.arcgisSmartMappingPanelsPredominanceSizeClose.emit("cancel")},appearance:"outline-fill",width:"half"},t.cancel)}cleanUpFlowItem(e,t){e.removeChild(t),this.focusSelectedTile(),this.selected=!0}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((async()=>await(this.tileNodes[this.lastClick]?.setFocus())))),300)}get el(){return(0,a.g)(this)}};ae.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}";const se=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsRelationshipSizeClose=(0,a.c)(this,"arcgisSmartMappingPanelsRelationshipSizeClose",7),this.arcgisSmartMappingPanelsRelationshipSizeBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsRelationshipSizeBackClick",7),this.arcgisSmartMappingPanelsRelationshipSizeError=(0,a.c)(this,"arcgisSmartMappingPanelsRelationshipSizeError",7),this.manager=(0,r.u)(this),this.tileNodes={},this.smartMappingState=(0,o.u)(),this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"relationship":{const e=document.createElement("arcgis-smart-mapping-panels-relationship");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsRelationshipClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsRelationshipBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsRelationshipError",(({detail:e})=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,i=(0,n.j)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,n.af)(this.smartMappingState,this.el)}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,g.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,mapImageSublayer:t,hideLayerTitle:i,strings:s}=this.smartMappingState,r=i?void 0:t?.title??e.title;return(0,a.h)(a.H,{key:"3e797ff5c9a51e744a3e395314806d843b6c8bcf",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"a63cf2fb53ec507dfeae8ac9c4bb894ad6801371",heading:s.panels.styleOptions,description:r,class:"flow-item",closable:(0,n.C)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:()=>this.arcgisSmartMappingPanelsRelationshipSizeClose.emit("save"),onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsRelationshipSizeBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderRelationshipTile(),this.renderSizeTile(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.arcgisSmartMappingPanelsRelationshipSizeClose.emit("save"),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,a.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{(0,n.h)(e,this.originalRendererJSON,this.originalFeatureReduction),this.arcgisSmartMappingPanelsRelationshipSizeClose.emit("cancel")},appearance:"outline-fill",width:"half"},t.cancel)}renderRelationshipTile(){return(0,a.h)("arcgis-smart-mapping-tile",{type:"relationship",selected:"relationship"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="relationship",this.handleOptionsClick("relationship")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("relationship"),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e.detail),ref:e=>{e&&(this.tileNodes.relationship=e)}})}renderSizeTile(){const{smartMappingState:e}=this,t=(0,n.H)(e,"size");return(0,a.h)("arcgis-smart-mapping-tile",{key:`tile-${t}`,type:"size",selected:"size"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="size",this.handleOptionsClick("size")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e.detail),ref:e=>{e&&(this.tileNodes.size=e)}})}renderTransparency(){const{smartMappingState:e}=this,t=(0,n.j)(e),i=(0,n.b)(t,"opacity");return(0,a.h)("arcgis-smart-mapping-transparency",{open:!!i,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e)})}renderRotation(){const{smartMappingState:e}=this,t=(0,n.j)(e),i=(0,n.b)(t,"opacity"),s=(0,n.b)(t,"rotation");return(0,a.h)("arcgis-smart-mapping-rotation",{open:!i&&!!s,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e)})}cleanUpFlowItem(e,t){e.removeChild(t),this.focusSelectedTile(),this.selected=!0}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((async()=>await(this.tileNodes[this.lastClick]?.setFocus())))),300)}get el(){return(0,a.g)(this)}};se.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}";const ne=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsSimpleClose=(0,a.c)(this,"arcgisSmartMappingPanelsSimpleClose",7),this.arcgisSmartMappingPanelsSimpleBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsSimpleBackClick",7),this.arcgisSmartMappingPanelsSimpleError=(0,a.c)(this,"arcgisSmartMappingPanelsSimpleError",7),this.manager=(0,r.u)(this),this.smartMappingState=(0,o.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsSimpleClose.emit("save")},this.handleCancel=()=>{const{originalRenderer:e,originalFeatureReduction:t,smartMappingState:i}=this,{layer:a}=i;if(a&&"geo-rss"===a.type){const t=e;a.pointSymbol=t[0],a.lineSymbol=t[1],a.polygonSymbol=t[2]}else(0,n.h)(i,e,t);this.arcgisSmartMappingPanelsSimpleClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=this.smartMappingState;if(e&&"geo-rss"===e.type){const t=e;this.originalRenderer=[t.pointSymbol.clone(),t.lineSymbol.clone(),t.polygonSymbol.clone()]}else{const i=(0,n.j)(this.smartMappingState);this.originalRenderer=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,await(0,n.e)(this.smartMappingState)}}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,g.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,useFeatureReduction:t,hideLayerTitle:i,strings:s}=this.smartMappingState,r=t?s.panels.gallery.binStyles:s.panels.gallery.styles;return(0,a.h)(a.H,{key:"5d3a5f9967de1e97a21e9278b1f61732f7bafd86",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"c4fb765bb10aea0b1ccb6254414d3892d67f503f",heading:r,description:i?void 0:e.title,class:"flow-item",closable:(0,n.C)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsSimpleBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,a.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):(0,a.h)(a.F,null)}renderCancelButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,a.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):(0,a.h)(a.F,null)}renderVisualization(){const{visualizationOpen:e,smartMappingState:t}=this,{layer:i,strings:s}=this.smartMappingState;return(0,a.h)("calcite-block",{class:"simple-block",heading:s.panels.simple.simpleStyle,collapsible:"geo-rss"!==i.type&&(0,n.aj)(t),open:e,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},"geo-rss"===i.type?this.renderGeoRssSymbols():this.renderSymbol())}renderSymbol(){const{smartMappingState:e}=this,t=(0,n.j)(e).symbol;return(0,a.h)("arcgis-smart-mapping-symbol-button",{symbol:t,type:"simple",onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,a.f)(this.el),this.rotationNode&&(0,a.f)(this.rotationNode)}})}renderGeoRssSymbols(){return(0,a.h)("div",null,this.renderGeoRssSymbol("point"),this.renderGeoRssSymbol("line"),this.renderGeoRssSymbol("polygon"))}renderGeoRssSymbol(e){const{layer:t,strings:i}=this.smartMappingState,s=t,n="point"===e?s.pointSymbol:"line"===e?s.lineSymbol:s.polygonSymbol,r="point"===e?i.panels.simple.pointSymbolStyle:"line"===e?i.panels.simple.lineSymbolStyle:i.panels.simple.polygonSymbolStyle;return(0,a.h)("arcgis-smart-mapping-symbol-button",{symbol:n??void 0,type:"point"===e?"geo-rss-point":"line"===e?"geo-rss-line":"geo-rss-polygon",label:r,onArcgisSmartMappingSymbolButtonSymbolChange:()=>(0,a.f)(this.el)})}renderTransparency(){const{smartMappingState:e}=this,t=(0,n.j)(e),i=(0,n.b)(t,"opacity");return(0,a.h)("arcgis-smart-mapping-transparency",{open:!!i,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsSimpleError.emit(e)})}renderRotation(){const{smartMappingState:e}=this,t=(0,n.j)(e),i=(0,n.b)(t,"opacity"),s=(0,n.b)(t,"rotation");return(0,a.h)("arcgis-smart-mapping-rotation",{open:!i&&!!s,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsSimpleError.emit(e)})}get el(){return(0,a.g)(this)}};ne.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.simple-block{overflow-x:hidden}";const re=class{constructor(e){(0,a.r)(this,e),this.smartMappingCompleteClose=(0,a.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsTypeSizeBackClick=(0,a.c)(this,"arcgisSmartMappingPanelsTypeSizeBackClick",7),this.arcgisSmartMappingPanelsTypeSizeClose=(0,a.c)(this,"arcgisSmartMappingPanelsTypeSizeClose",7),this.arcgisSmartMappingPanelsTypeSizeError=(0,a.c)(this,"arcgisSmartMappingPanelsTypeSizeError",7),this.manager=(0,r.u)(this),this.tileNodes={},this.smartMappingState=(0,o.u)(),this.handleDone=()=>{(0,n.B)(),this.arcgisSmartMappingPanelsTypeSizeClose.emit("save")},this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideRotation=!0,e.hideTransparency=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"type":{const e=document.createElement("arcgis-smart-mapping-panels-type");e.hideRotation=!0,e.hideTransparency=!0,e.addEventListener("arcgisSmartMappingPanelsTypeClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsTypeBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsTypeError",(({detail:e})=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){this.flowItemNode?.setFocus()}componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,i=(0,n.j)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,n.af)(this.smartMappingState,this.el)}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,g.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{hideLayerTitle:e,layer:t,mapImageSublayer:i,strings:s}=this.smartMappingState,r=e?void 0:i?.title??t.title;return(0,a.h)(a.H,{key:"1ec7f7dd1f3434adee331a4bd0c23b88819ec646",class:"calcite-match-height"},(0,a.h)("calcite-flow-item",{key:"848a09fc4c7956b34d3161643efb16ca660a5053",class:"flow-item",closable:(0,n.C)(this.el),heading:s.panels.styleOptions,description:r,showBackButton:this.showBackButton,selected:this.selected,ref:e=>this.flowItemNode=e,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsTypeSizeBackClick.emit()},onCalciteFlowItemClose:this.handleDone},this.renderTypeTile(),this.renderSizeTile(),this.renderTransparency(),this.renderRotation(),this.renderDoneButton(),this.renderCancelButton()))}renderTypeTile(){return(0,a.h)("arcgis-smart-mapping-tile",{type:"type",selected:"type"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="type",this.handleOptionsClick("type")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("type"),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e.detail),ref:e=>{e&&(this.tileNodes.type=e)}})}renderSizeTile(){const{smartMappingState:e}=this,t="type-size-age"===(0,n.a)(e)?"size-age":"size",i=(0,n.H)(e,"size");return(0,a.h)("arcgis-smart-mapping-tile",{key:`tile-${t}-${i}`,type:t,selected:"size"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="size",this.handleOptionsClick("size")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e.detail),ref:e=>{e&&(this.tileNodes.size=e)}})}renderTransparency(){const{smartMappingState:e}=this,t=(0,n.b)((0,n.j)(e),"opacity");return(0,a.h)("arcgis-smart-mapping-transparency",{open:!!t,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e)})}renderRotation(){const{smartMappingState:e}=this,t=(0,n.b)((0,n.j)(e),"opacity"),i=(0,n.b)((0,n.j)(e),"rotation");return(0,a.h)("arcgis-smart-mapping-rotation",{open:!t&&!!i,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e)})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,a.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,a.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{(0,n.h)(e,this.originalRendererJSON,this.originalFeatureReduction),this.arcgisSmartMappingPanelsTypeSizeClose.emit("cancel")},appearance:"outline-fill",width:"half"},t.cancel)}cleanUpFlowItem(e,t){e.removeChild(t),this.focusSelectedTile(),this.selected=!0}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((async()=>await(this.tileNodes[this.lastClick]?.setFocus())))),300)}get el(){return(0,a.g)(this)}};re.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}"},58325:(e,t,i)=>{i.d(t,{a:()=>s,d:()=>a,t:()=>n});const a=(e,t)=>{let i,a="idle";const s=async(...s)=>await new Promise((n=>{switch(a){case"flushed":a="idle",i?(clearTimeout(i),n(e(...s))):n(null);break;case"invoked":clearTimeout(i),a="idle",n(e(...s));break;case"cancelled":clearTimeout(i),a="idle",n(null);break;default:i&&clearTimeout(i),a="pending",i=setTimeout((()=>{a="idle",n(e(...s))}),t)}}));return s.flush=async function(...e){return a="flushed",await s(...e)},s.invoke=async function(...e){return a="invoked",await s(...e)},s.cancel=async function(...e){return a="cancelled",await s(...e)},s.getStatus=function(){return a},s},s=(e,t)=>{let i;return async(...a)=>await new Promise((s=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,s(e(...a))}),t))}))};function n(e){return new Promise((t=>setTimeout(t,e)))}},42444:(e,t,i)=>{function a(e,t){if(!e||!t)return;let i=t.assetsPath;i.endsWith("/")||(i+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${i}esri/themes/light/main.css" />`)}i.d(t,{i:()=>a})}}]);