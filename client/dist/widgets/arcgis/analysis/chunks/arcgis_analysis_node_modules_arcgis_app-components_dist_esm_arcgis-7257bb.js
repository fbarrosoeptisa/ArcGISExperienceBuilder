/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-7257bb.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-7257bb"],{22737:(e,i,t)=>{t.r(i),t.d(i,{arcgis_smart_mapping_panels_gallery:()=>x});var s=t(19564),a=t(11139),l=t(52437),n=t(27909),r=t(38838),o=t(95875),c=(t(98034),t(12350)),d=t(89261),p=t(9421),m=t(59551),h=t(67115),g=t(80763),u=t(32772),f=t(94340),y=t(4780),z=t(65634),v=t(93364),S=t(25251),E=t(11994),b=t(54811);t(66507),t(91102),t(73807),t(18991),t(99004),t(95597);let F;function T(e){F&&clearTimeout(F),F=setTimeout((()=>{F=null,I(e)}),1e3)}function I(e){var i,t;const{selectedFields:s,layer:a,mapImageSublayer:n}=l.s,r="ogc-feature"===a.type,o="wfs"===a.type,c=null===(t=null===(i=a.capabilities)||void 0===i?void 0:i.query)||void 0===t?void 0:t.supportsSqlExpression,d=r||o||c,F=s.map((e=>(0,l.r)(e.field))),T=(0,l.l)(),I=(0,l.a)();if(!(0,l.t)(s,T))if(0===s.length)e("heatmap"===I?(0,f.c)():(0,m.c)());else if(1===s.length){const i=F[0];if("heatmap"!==I||!d||s[0].expression||s[0].featureReductionExpression||s[0].simpleFieldType!==l.v.NUMBER)if("color-size"===I&&(0,l.w)(s[0],T[0]))e((0,h.c)({fieldInfos:s}));else if("type-size"===I&&(0,l.w)(s[0],T[0]))e((0,S.c)({fieldInfos:s}));else if(["color-size","type-size"].indexOf(I)>-1&&(0,l.w)(s[0],T[T.length>1?1:0]))e((0,g.c)({fieldInfos:s}));else if(s[0].expression||s[0].featureReductionExpression)s[0].simpleFieldType===l.v.NUMBER||s[0].simpleFieldType===l.v.DATE?e((0,h.c)({fieldInfos:s})):e((0,S.c)({fieldInfos:s}));else if(i.simpleFieldType===l.v.STRING||"string"===(0,l.x)(i)||"domain"in i.layerField&&i.layerField.domain)e((0,S.c)({fieldInfos:s}));else if(["integer","double","single","small-integer","big-integer"].indexOf((0,l.y)(i.layerField))>-1&&"objectIdField"in a&&a.objectIdField!==i.layerField.name)if((0,l.z)())"featureReduction"in a&&a.featureReduction?e((0,h.c)({fieldInfos:s})):e((0,g.c)({fieldInfos:s}));else if((0,l.A)())e((0,g.c)({fieldInfos:s}));else{const t=(0,l.x)(i);["integer","small-integer","big-integer"].indexOf((0,l.y)(i.layerField))>-1||(0,p.i)(t)&&"integer"===t?e((0,g.c)({fieldInfos:s})):e((0,h.c)({fieldInfos:s}))}else"date"===(0,l.y)(i.layerField)&&("color-age-size"===I&&(0,l.w)(s[0],T[0])?e((0,h.a)({fieldInfos:s})):["color-size-age","type-size-age"].indexOf(I)>-1&&(0,l.w)(s[0],T[1])?e((0,g.a)({fieldInfos:s})):e(n?(0,h.a)({fieldInfos:s}):(0,h.c)({fieldInfos:s})));else e((0,f.c)({fieldInfos:s}))}else if(2===s.length){const i=F[0];"type"!==I&&"type-size"!==I||!(0,l.w)(s[0],T[0])?s[0].expression||s[0].featureReductionExpression?s[0].simpleFieldType===l.v.NUMBER&&s[1].simpleFieldType===l.v.NUMBER?e((0,g.b)({fieldInfos:s})):e((0,b.c)({fieldInfos:s})):s[0].simpleFieldType===l.v.STRING||"string"===(0,l.x)(i)||"domain"in i.layerField&&i.layerField.domain?s[1].simpleFieldType===l.v.DATE&&(["color-size-age","type-size-age"].indexOf(I)>-1||n)?e((0,b.a)({fieldInfos:s})):e((0,b.c)({fieldInfos:s})):s[0].simpleFieldType===l.v.DATE||s[1].simpleFieldType===l.v.DATE?s[0].simpleFieldType===l.v.DATE&&(["color-age","color-age-size"].indexOf(I)>-1||n)?e((0,g.d)({fieldInfos:s})):s[1].simpleFieldType===l.v.DATE&&(["color-size-age","type-size-age"].indexOf(I)>-1||n)?e((0,g.e)({fieldInfos:s})):e((0,g.b)({fieldInfos:s})):s[0].expression||s[0].featureReductionExpression||s[1].expression||s[1].featureReductionExpression?e((0,g.b)({fieldInfos:s})):"dot-density"===I?e((0,u.c)({fieldInfos:s})):"predominance"===I?e((0,y.c)({fieldInfos:s})):"predominance-size"===I?e((0,y.c)({fieldInfos:s,includeSizeVariable:!0})):"chart"===I?e((0,z.c)({fieldInfos:s})):"chart-size"===I?e((0,z.c)({fieldInfos:s,includeSizeVariable:!0})):"compare"===I?e((0,v.c)({fieldInfos:s})):["relationship","relationship-size"].indexOf(I)>-1?e((0,E.c)({fieldInfos:s})):e((0,g.b)({fieldInfos:s})):e((0,b.c)({fieldInfos:s}))}else 3===s.length&&(["relationship","relationship-size"].indexOf(I)>-1||s[2].expression||s[2].featureReductionExpression||!d)?e((0,u.a)({fieldInfos:s})):"dot-density"===I&&s.length<=8?e((0,u.c)({fieldInfos:s})):"predominance-size"===I?e((0,y.c)({fieldInfos:s,includeSizeVariable:!0})):"chart"===I?e((0,z.c)({fieldInfos:s,includeSizeVariable:!1})):"chart-size"===I?e((0,z.c)({fieldInfos:s,includeSizeVariable:!0})):n&&!d||s[2].simpleFieldType===l.v.DATE?e((0,u.a)({fieldInfos:s})):e((0,y.c)({fieldInfos:s}))}const x=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsGalleryClose=(0,s.c)(this,"arcgisSmartMappingPanelsGalleryClose",7),this.arcgisSmartMappingPanelsGalleryError=(0,s.c)(this,"arcgisSmartMappingPanelsGalleryError",7),this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate=(0,s.c)(this,"arcgisSmartMappingPanelsGalleryClusterRequiresUpdate",7),this.tileNodes=[],this.lastSortBy=c.L.default,this.handleGenerateClick=()=>{const e=document.createElement("arcgis-smart-mapping-panels-assist");e.addEventListener("arcgisSmartMappingPanelsAssistClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile(),setTimeout((()=>this.focusSelectedTile()),500)})),e.addEventListener("arcgisSmartMappingPanelsAssistBackClick",(()=>{(0,s.f)(this.hostElement),setTimeout((()=>this.focusSelectedTile()),500),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsAssistError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),e.addEventListener("arcgisSmartMappingPanelsAssistClusterRequiresUpdate",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1},this.addExpression=async()=>{const{useFeatureReduction:e}=l.s;this.addExpressionButtonNode.disabled=!0,(0,l.E)();try{const i=await(0,a.u)();this.addExpressionButtonNode.disabled=!1,i.simpleFieldType===l.v.UNKNOWN&&(i.simpleFieldType=l.v.NUMBER);const{selectedFields:t,modules:s,strings:n}=l.s;if(2===t.length&&(null==i?void 0:i.simpleFieldType)===l.v.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:n.panels.gallery.errors.expressionMustBeNumber,type:"warning"});if(1===t.length&&t[0].simpleFieldType===l.v.STRING&&(null==i?void 0:i.simpleFieldType)===l.v.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:n.panels.gallery.errors.expressionMustBeNumber,type:"warning"});const r=e?t.find((e=>"aggregateCount"===e.field)):void 0,o=r?s.esriLang.clone(t).filter((e=>"aggregateCount"!==e.field)):s.esriLang.clone(t);if(o.push(i),3===o.length)for(let e=0;e<3;e++){const i=o[e];if(i.simpleFieldType===l.v.DATE&&2!==e){o.splice(e,1),o.splice(2,0,i);break}}r&&o.push(r),o.length>1&&o[1].simpleFieldType===l.v.STRING&&o.reverse(),l.s.selectedFields=o,T(this.galleryRequestWrapper)}catch(e){this.addExpressionButtonNode.disabled=!1,this.addExpressionButtonNode.setFocus()}},this.handleArcadeEdit=async e=>{(0,l.E)();try{const{selectedFields:i,strings:t}=l.s,n=await(0,a.u)(i[e]);if(n.simpleFieldType===l.v.UNKNOWN&&(n.simpleFieldType=l.v.NUMBER),0!==e&&(null==n?void 0:n.simpleFieldType)===l.v.STRING&&i[0].simpleFieldType===l.v.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:t.panels.gallery.errors.expressionMustBeNumber,type:"warning"});const r=i[e];"string"===n.simpleFieldType?(i.splice(e,1),i.unshift(n),e=0,(0,s.f)(this.hostElement)):i[e]=n,l.s.selectedFields.length!==i.length?(l.s.selectedFields=i,T(this.galleryRequestWrapper)):(l.s.selectedFields=i,function(e,i,t){const{selectedFields:s}=l.s,a=(0,l.b)(),{idx:n,oldFieldInfo:r}=e,o=(0,l.a)();if(!(0,l.w)(s[n],r))if(s[n].expression===r.expression){const e=s[n];if("size"===o||"color-size"===o&&1===n||"type-size"===o&&1===n||"relationship-size"===o&&2===n){const i=a,t=(0,l.d)(a,"size");t?t.valueExpressionTitle=e.expressionTitle:i.valueExpressionTitle&&(i.valueExpressionTitle=e.expressionTitle)}else if("color"===o||"color-size"===o&&0===n){const i=a,t=(0,l.d)(a,"color");t?t.valueExpressionTitle=e.expressionTitle:i.valueExpressionTitle&&(i.valueExpressionTitle=e.expressionTitle)}else("type"===o||"type-size"===o&&0===n)&&(a.valueExpressionTitle=e.expressionTitle);(0,l.u)(),t()}else s[n].simpleFieldType===r.simpleFieldType?"size"===o?i((0,g.f)({fieldInfos:s})):"color"===o?i((0,h.b)({fieldInfos:s})):"type"===o?i((0,S.a)({fieldInfos:s})):"color-size"===o?1===s.length?i((0,z.b)({fieldInfos:s})):i((0,g.g)({fieldInfos:s})):"type-size"===o?i((0,b.b)({fieldInfos:s})):"relationship-size"===o?i((0,u.b)({fieldInfos:s})):I(i):I(i)}({idx:e,oldFieldInfo:r},this.galleryRequestWrapper,(()=>(0,s.f)(this.hostElement))))}catch(e){this.addExpressionButtonNode.setFocus()}},this.handleListOrderChange=e=>{const{selectedFields:i,modules:t}=l.s,s=[];e.target.querySelectorAll("calcite-list-item").forEach((e=>{s.push(t.esriLang.clone(i[parseInt(e.value)]))})),l.s.selectedFields=s,T(this.galleryRequestWrapper)},this.handleListChange=e=>{const{selectedFields:i}=l.s;!!i[e].expression?this.handleArcadeEdit(e):this.openFieldPickList(!0,e)},this.handleRemoveAttribute=e=>{this.modifyFieldPickList=!0;const{selectedFields:i}=l.s;l.s.selectedFields=null==i?void 0:i.filter(((i,t)=>t!==e)),T(this.galleryRequestWrapper)},this.handleSelectClick=e=>{!function(e,i){const{selectedFields:t}=l.s;switch(e){case"simple":l.s.selectedFields=[],i((0,m.c)());break;case"type":i((0,S.c)({fieldInfos:t}));break;case"color":i((0,h.c)({fieldInfos:t}));break;case"size":i((0,g.c)({fieldInfos:t}));break;case"color-age":i((0,h.a)({fieldInfos:t}));break;case"size-age":i((0,g.a)({fieldInfos:t}));break;case"dot-density":i((0,u.c)({fieldInfos:t}));break;case"heatmap":i((0,f.c)({fieldInfos:t}));break;case"compare":i((0,v.c)({fieldInfos:t}));break;case"relationship":i((0,E.c)({fieldInfos:t}));break;case"relationship-size":i((0,u.a)({fieldInfos:t}));break;case"predominance":i((0,y.c)({fieldInfos:t}));break;case"predominance-size":i((0,y.c)({fieldInfos:t,includeSizeVariable:!0}));break;case"chart":i((0,z.c)({fieldInfos:t}));break;case"chart-size":i((0,z.c)({fieldInfos:t,includeSizeVariable:!0}));break;case"type-size":i((0,b.c)({fieldInfos:t}));break;case"type-size-age":i((0,b.a)({fieldInfos:t}));break;case"color-size":1===t.length?i((0,z.a)({fieldInfos:t})):i((0,g.b)({fieldInfos:t}));break;case"color-age-size":i((0,g.d)({fieldInfos:t}));break;case"color-size-age":i((0,g.e)({fieldInfos:t}))}}(e,this.galleryRequestWrapper)},this.handleOptionsClick=e=>{const{selectedFields:i}=l.s;switch(e){case"simple":{const e=document.createElement("arcgis-smart-mapping-panels-simple");e.addEventListener("arcgisSmartMappingPanelsSimpleClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsSimpleBackClick",(()=>{this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsSimpleError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1;break}case"color":case"color-age":{const e=document.createElement("arcgis-smart-mapping-panels-color");e.addEventListener("arcgisSmartMappingPanelsColorClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsColorBackClick",(()=>{(0,s.f)(this.hostElement),this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsColorError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1;break}case"size":case"size-age":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>{(0,s.f)(this.hostElement),this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1;break}case"type":{const e=document.createElement("arcgis-smart-mapping-panels-type");e.addEventListener("arcgisSmartMappingPanelsTypeClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsTypeBackClick",(()=>{this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsTypeClusterRequiresUpdate",(()=>{this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit()})),e.addEventListener("onArcgisSmartMappingPanelsTypeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1;break}case"compare":{const e=document.createElement("arcgis-smart-mapping-panels-compare");e.addEventListener("arcgisSmartMappingPanelsCompareClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsCompareBackClick",(()=>{this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsCompareError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1;break}case"heatmap":{const e=document.createElement("arcgis-smart-mapping-panels-heatmap");e.addEventListener("arcgisSmartMappingPanelsHeatmapClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsHeatmapBackClick",(()=>{this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsHeatmapError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1;break}case"predominance":{const e=document.createElement("arcgis-smart-mapping-panels-predominance");e.addEventListener("arcgisSmartMappingPanelsPredominanceClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsPredominanceBackClick",(()=>{this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsPredominanceError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1;break}case"chart":{const e=document.createElement("arcgis-smart-mapping-panels-chart");e.addEventListener("arcgisSmartMappingPanelsChartClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsChartBackClick",(()=>{this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsChartError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1;break}case"relationship":{const e=document.createElement("arcgis-smart-mapping-panels-relationship");e.addEventListener("arcgisSmartMappingPanelsRelationshipClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsRelationshipBackClick",(()=>{this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsRelationshipError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1;break}case"dot-density":{const e=document.createElement("arcgis-smart-mapping-panels-dot-density");e.addEventListener("arcgisSmartMappingPanelsDotDensityClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsDotDensityBackClick",(()=>{this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsDotDensityError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1;break}case"color-size":case"color-age-size":case"color-size-age":if(i.length>1){const e=document.createElement("arcgis-smart-mapping-panels-color-size");e.addEventListener("arcgisSmartMappingPanelsColorSizeClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsColorSizeBackClick",(()=>{(0,s.f)(this.hostElement),this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsColorSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1}else{const e=document.createElement("arcgis-smart-mapping-panels-color-size-univariate");e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateBackClick",(()=>{(0,s.f)(this.hostElement),this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1}break;case"type-size":case"type-size-age":{const e=document.createElement("arcgis-smart-mapping-panels-type-size");e.addEventListener("arcgisSmartMappingPanelsTypeSizeClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsTypeSizeBackClick",(()=>{(0,s.f)(this.hostElement),this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsTypeSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1;break}case"predominance-size":{const e=document.createElement("arcgis-smart-mapping-panels-predominance-size");e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeBackClick",(()=>{this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1;break}case"chart-size":{const e=document.createElement("arcgis-smart-mapping-panels-chart-size");e.addEventListener("arcgisSmartMappingPanelsChartSizeClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsChartSizeBackClick",(()=>{this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsChartSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1;break}case"relationship-size":{const e=document.createElement("arcgis-smart-mapping-panels-relationship-size");e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeBackClick",(()=>{this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0})),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,this.selected=!1;break}}},this.handleDone=()=>{this.arcgisSmartMappingPanelsGalleryClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:i}=this;(0,l.m)(e,i),this.arcgisSmartMappingPanelsGalleryClose.emit("cancel")},this.galleryRequestWrapper=e=>{const{strings:i}=l.s;(0,o.r)(e,this.flowItemNode).then((e=>{var i;const{layer:t}=l.s;(0,l.u)(e.renderer),(0,s.f)(this.hostElement),"featureReduction"in t&&"cluster"===(null===(i=t.featureReduction)||void 0===i?void 0:i.type)&&(this.checkCluster(),this.checkClusterRenderer()),this.focusSelectedTile()}),(()=>{this.arcgisSmartMappingPanelsGalleryError.emit({message:i.panels.gallery.errors.changeRendererErrorMsg,type:"warning"})}))},this.menuOpen=void 0,this.showBackButton=void 0,this.selected=!1,this.beforeBack=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){const{layer:e,modules:i}=l.s,t=(0,l.b)();this.originalRendererJSON=t.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?i.esriLang.clone(e.featureReduction):void 0,this.flowNode=(0,l.f)(this.hostElement,"calcite-flow");const s=i.urlUtils.urlToObject(document.URL);this.urlObjectQuery=s.query||{}}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.setUpWatchBinScale(!0)}disconnectedCallback(){var e;null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){var e,i,t;const{layer:a,useFeatureReduction:n,hideLayerTitle:r,isRTL:o,strings:c}=l.s,p=n?c.panels.gallery.binStyles:c.panels.gallery.styles;let m=!1;if("featureReduction"in a&&"cluster"===(null===(e=a.featureReduction)||void 0===e?void 0:e.type)){const e=a.featureReduction;"pie-chart"!==(null===(i=e.renderer)||void 0===i?void 0:i.type)||(null===(t=e.renderer.authoringInfo)||void 0===t?void 0:t.isAutoGenerated)||(m=!0)}return(0,s.h)(s.H,{key:"da5f60b46354ab631c6f915cfb70745eb356d5cc",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"652ab2014c2f8c4d74a3f5433042250254c6c813",heading:p,description:r?void 0:a.title,class:{"flow-item":!0,[d.C.rtl]:o},closable:(0,l.F)(this.hostElement),selected:this.selected,showBackButton:this.showBackButton,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:this.handleDone,ref:e=>this.flowItemNode=e},m?this.renderClusteringWarning():this.renderGalleryContent()))}renderGalleryContent(){return(0,s.h)(s.F,null,this.renderDoneButton(),this.renderCancelButton(),this.renderGenerate(),this.renderStepOne(),this.renderStepTwo())}renderClusteringWarning(){const{strings:e}=l.s;return(0,s.h)(s.F,null,(0,s.h)("div",null,(0,s.h)("calcite-tip",{closeDisabled:!0},(0,s.h)("div",null,e.panels.gallery.chartClusterMsg))),(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleCancel,appearance:"outline-fill",width:"full"},e.done))}renderDoneButton(){const{layer:e,strings:i}=l.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:i.done,onClick:this.handleDone,appearance:"solid",width:"half"},i.done):null}renderCancelButton(){const{layer:e,strings:i}=l.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:i.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},i.cancel):null}renderGenerate(){const{urlObjectQuery:e}=this,{layer:i,portal:t,strings:a}=l.s,n=Object.keys(r.a).includes(e.assist);if(!e.assist||!(0,l.q)(i)||!(n&&"devext.arcgis.com"===t.portalHostname||n&&"qaext.arcgis.com"===t.portalHostname||n&&"www.arcgis.com"===t.portalHostname&&t.user&&"jsapi"===t.urlKey))return null;const o="rtl"===(0,d.g)(this.hostElement);return(0,s.h)("calcite-list",{label:"",class:"generate"},(0,s.h)("calcite-list-item",{label:a.panels.gallery.generateStyle,onClick:this.handleGenerateClick},(0,s.h)("calcite-icon",{class:"generate-icon",slot:"content-start",icon:"effects",scale:"s"}),(0,s.h)("calcite-icon",{class:"generate-icon",slot:"content-end",icon:o?"chevron-left":"chevron-right",scale:"s"})))}renderStepOne(){const{layer:e,selectedFields:i,strings:t,useFeatureReduction:a}=l.s,n=i.length,r=(0,l.B)().string>0,o=3===n&&(i[2].expression||i[2].featureReductionExpression),c=a&&2===n&&i[0].simpleFieldType===l.v.DATE,d=3===n&&i[2].simpleFieldType===l.v.DATE;let p=i.map(((e,i)=>this.renderAttribute(i)));const m=n>1&&!r&&!o&&!d&&!c;return(0,s.h)("div",{class:"attributes gallery-block"},(0,s.h)("div",null,(0,s.h)("div",{class:"center"},(0,s.h)("calcite-icon",{class:"number-icon",icon:"number-circle-1"})),(0,s.h)("div",{class:"attributes-header-text center"},t.panels.gallery.chooseAttributes)),!n&&(0,s.h)("div",{class:"attributes-msg center"},t.panels.gallery.chooseAttributesMsg),(0,s.h)("calcite-list",{label:"",class:p.length>0?"attribute-list":"",key:`gallery-attributes-selects-${i}`,dragEnabled:m,onCalciteListOrderChange:this.handleListOrderChange},p),e&&this.renderAddButtons(),e&&this.renderTip())}renderAttribute(e){const{selectedFields:i,strings:t,useFeatureReduction:a}=l.s,n=i[e].field||i[e].expressionTitle||i[e].featureReductionExpressionTitle,r=!!i[e].expression,o=(0,l.r)(i[e].field),c=o?o.label:i[e].expressionTitle||i[e].featureReductionExpressionTitle,d=i[e].simpleFieldType,p=!r&&(d===l.v.NUMBER?"number":a&&["date","timestamp-offset"].includes((0,l.y)(null==o?void 0:o.layerField))?"date-time":d===l.v.STRING?"date-only"===(0,l.y)(null==o?void 0:o.layerField)?"calendar":"string":d===l.v.DATE?"date-time":null);return(0,s.h)("calcite-list-item",{key:`gallery-attribute-${e}-${n}`,label:c,value:e,onClick:i=>i.target&&this.handleListChange(e),onKeyDown:i=>{" "===i.key&&(i.preventDefault(),this.handleListChange(e))}},p&&(0,s.h)("div",{slot:"actions-end"},(0,s.h)("calcite-icon",{scale:"s",icon:p,class:"field-type"})),(0,s.h)("calcite-action",{key:`gallery-attribute-${e}-${n}-remove`,slot:"actions-end",text:r?t.panels.gallery.removeExpression:t.panels.gallery.removeField,label:r?t.panels.gallery.removeExpression:t.panels.gallery.removeField,onClick:i=>{i.stopPropagation(),this.handleRemoveAttribute(e)},onKeyDown:i=>{"Enter"!==i.key&&" "!==i.key||(i.stopPropagation(),this.handleRemoveAttribute(e))}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))}renderTip(){var e;const{selectedFields:i,portal:t,strings:a}=l.s;if(i.length>1)return;if(!i.length&&(0,l.G)(l.O.ARCGIS_COMPONENT_NOTIFICATIONS,l.N.SMART_MAPPING_TIP1_DISMISSED)||1===i.length&&(0,l.G)(l.O.ARCGIS_COMPONENT_NOTIFICATIONS,l.N.SMART_MAPPING_TIP2_DISMISSED))return null;const n=a.panels.gallery.tip1.indexOf("${smartMappingLink}"),r=(null===(e=t.helpMap)||void 0===e?void 0:e.m)||t.helpMap;return(0,s.h)("div",{key:"gallery-tip",class:"tip"},(0,s.h)("calcite-input-message",{key:"gallery-tip-message",icon:"lightbulb",class:"tip-message"},0===i.length&&t.helpBase&&r?(0,s.h)("div",{key:"gallery-tip-text"},(0,s.h)("span",{class:"tip-text"},a.panels.gallery.tip1.substring(0,n)),(0,s.h)("calcite-link",{target:"_blank",href:`${t.helpBase}${r[120003249]}`},a.panels.gallery.tip1Link),(0,s.h)("span",{class:"tip-text"},a.panels.gallery.tip1.substring(n+19))):0===i.length?(0,s.h)("span",{key:"gallery-tip-text",class:"tip-text"},a.panels.gallery.tip1.replace("${smartMappingLink}",a.panels.gallery.tip1Link)," "):(0,s.h)("span",{key:"gallery-tip-text",class:"tip-text"},a.panels.gallery.tip2)),(0,s.h)("calcite-action",{scale:"s",label:a.close,text:a.close,onClick:()=>{const{selectedFields:e}=l.s;e.length?(0,l.H)(l.O.ARCGIS_COMPONENT_NOTIFICATIONS,{key:l.N.SMART_MAPPING_TIP2_DISMISSED,value:"true"}):(0,l.H)(l.O.ARCGIS_COMPONENT_NOTIFICATIONS,{key:l.N.SMART_MAPPING_TIP1_DISMISSED,value:"true"}),(0,s.f)(this.hostElement)}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))}renderAddButtons(){var e,i;const{layer:t,mapImageSublayer:a,selectedFields:n,strings:r,supportsArcade:o}=l.s,c=n.length,d=(0,l.I)(),p=(0,l.B)(),m=p.string>0,h=p.date>0,g=p.expression>0,u=null===(i=null===(e=t.capabilities)||void 0===e?void 0:e.query)||void 0===i?void 0:i.supportsSqlExpression,f="knowledge-graph-sublayer"===t.type,y=(0,l.b)(),z=(0,l.J)(y,"reference-size");let v=!(a&&!o&&1===c||!(c<10)||2===c&&(m||g)||a&&2===c&&h||3===c&&(h||n[2].expression||n[2].featureReductionExpression||!u));v=v&&(1===p.string&&p.number+p.date===0&&d.number+d.date>0||0===p.string&&p.date<2&&p.number+p.date<3&&p.string+p.number+p.date<d.string+d.number+d.date||p.number>=2&&p.number<d.number);const S=!z&&!f&&(!a||o)&&(c<2||2===c&&!g&&n[0].simpleFieldType===l.v.NUMBER&&n[1].simpleFieldType===l.v.NUMBER);return(0,s.h)("div",{class:"add-button-div"},(0,s.h)("div",{class:"add-buttons"},(0,s.h)("calcite-button",{disabled:!v,onClick:()=>{this.addFieldButtonNode.disabled||this.openFieldPickList()},appearance:"outline-fill",kind:"neutral",width:"full",label:r.panels.gallery.addField,iconStart:"plus",class:"attributes-add-new",ref:e=>this.addFieldButtonNode=e},r.panels.gallery.field),(0,s.h)("span",null,"\xa0\xa0"),(0,s.h)("calcite-button",{disabled:!S,onClick:this.addExpression,appearance:"outline-fill",kind:"neutral",width:"full",label:r.panels.gallery.addExpression,iconStart:"plus",class:"attributes-add-new",ref:e=>this.addExpressionButtonNode=e},r.expression)))}renderStepTwo(){const{selectedFields:e,strings:i}=l.s,t=function(){var e,i;const{layer:t,useFeatureReduction:s,mapImageSublayer:a,selectedFields:n,supportsArcade:r}=l.s,o="ogc-feature"===t.type,c="wfs"===t.type,d="stream"===t.type,p="featureReduction"in t&&t.featureReduction,m=n.length,h=(0,l.B)(),g=h.string>0,u=h.date>0,f=h.expression>0,y=null===(i=null===(e=t.capabilities)||void 0===e?void 0:e.query)||void 0===i?void 0:i.supportsSqlExpression,z=o||c||d||y,v=[];return v.push("simple"),1!==m||g||a&&u||v.push("color"),1!==m||g||a&&u||v.push("size"),a&&!r||1!==m||!u||f||!z||v.push("color-age"),a&&!r||1!==m||!u||f||!z||v.push("size-age"),a&&!r||1!==m&&2!==m||g||a&&u||v.push("color-size"),a&&!r||2!==m||g||!u||n[0].simpleFieldType!==l.v.DATE||n[0].expression||n[0].featureReductionExpression||!z||a&&h.date>1||v.push("color-age-size"),a&&!r||2!==m||g||!u||n[1].simpleFieldType!==l.v.DATE||n[1].expression||n[1].featureReductionExpression||!z||a&&h.date>1||v.push("color-size-age"),(!a||r)&&m>0&&m<=8&&!f&&(0,l.C)()&&!g&&!u&&z&&v.push("dot-density"),(!a||r)&&m>1&&m<=10&&!f&&!g&&!u&&z&&v.push("predominance"),a&&!r||!(m>1)||f||g||u||!z||v.push("predominance-size"),!a&&(!p||"binning"===p.type)&&m>1&&m<=10&&!f&&["polygon","point","multipoint"].indexOf((0,l.D)())>-1&&!g&&!u&&z&&v.push("chart"),!a&&(!p||"binning"===p.type)&&m>1&&!f&&["polygon","point","multipoint"].indexOf((0,l.D)())>-1&&!g&&!u&&z&&v.push("chart-size"),a&&!r||2!==m||f||g||u||v.push("relationship"),a&&!r||3!==m||f&&(1!==h.expression||!n[2].expression&&!n[2].featureReductionExpression)||a&&u||v.push("relationship-size"),a&&!r||2!==m||f||g||u||v.push("compare"),1!==m||a&&u||v.push("type"),a&&!r||2!==m||!(h.date<2)||a&&u||v.push("type-size"),(!a||r)&&2===m&&u&&h.date<2&&n[1].simpleFieldType===l.v.DATE&&n[1].field&&z&&v.push("type-size-age"),a&&!r||!(["point","multipoint"].indexOf((0,l.D)())>-1)||p&&("binning"!==(null==p?void 0:p.type)||s)||!(z&&m<=1||!z&&0===m)||g||u||0!==h.expression||v.push("heatmap"),v}(),a=function(){const e=(0,l.a)(),i=(0,l.l)(),t=i.length>0?i[0].simpleFieldType:null;let s=[];switch(e){case"simple":s=["simple","color","size","color-age","size-age","color-size","type","heatmap","dot-density","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"];break;case"type":s=["type","color","size","color-age","size-age","color-size","dot-density","heatmap","simple","type-size","type-size-age","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","compare","relationship","relationship-size"];break;case"color":s=["color","size","color-age","size-age","color-size","dot-density"],s="string"===t||"date"===t?s.concat(["type","heatmap","simple"]):s.concat(["heatmap","simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"color-age":s=["color-age","color","size","size-age","color-size","dot-density"],s="string"===t||"date"===t?s.concat(["type","heatmap","simple"]):s.concat(["heatmap","simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"size":s=["size","size-age","color","color-age","color-size","dot-density"],s="string"===t||"date"===t?s.concat(["type","heatmap","simple"]):s.concat(["heatmap","simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"size-age":s=["size-age","size","color-age","color","color-size","dot-density"],s="string"===t||"date"===t?s.concat(["type","heatmap","simple"]):s.concat(["heatmap","simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"heatmap":s=["heatmap","color","size","color-age","size-age","color-size","dot-density"],s="string"===t?s.concat(["type","simple"]):s.concat(["simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"predominance":s=["predominance","predominance-size","chart","chart-size","color-size","color-age-size","color-size-age","dot-density","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===t?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"chart":s=["chart","chart-size","predominance","predominance-size","color-size","color-age-size","color-size-age","dot-density","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===t?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"dot-density":s=["dot-density","color-size","color-age-size","color-size-age","predominance","predominance-size","chart","chart-size","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===t?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"compare":s=["compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===t&&(s=s.concat(["type"])),s=s.concat(["simple"]),t&&"string"===t||(s=s.concat(["type"]));break;case"relationship":s=["relationship","relationship-size","compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===t&&(s=s.concat(["type"])),s=s.concat(["simple"]),t&&"string"===t||(s=s.concat(["type"]));break;case"color-size":s=["color-size","color-age-size","color-size-age","color","size","color-age","size-age","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","type","heatmap","simple"];break;case"color-age-size":s=["color-age-size","color-size-age","color-size","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","color","color-age","size","size-age","simple","type","heatmap"];break;case"color-size-age":s=["color-size-age","color-age-size","color-size","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","color","color-age","size","size-age","simple","type","heatmap"];break;case"type-size":s=["type-size","type-size-age","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type","size","simple","color","color-age","size-age","heatmap","compare","relationship","relationship-size"];break;case"type-size-age":s=["type-size-age","type-size","color-age-size","color-size-age","color-size","dot-density","predominance","predominance-size","chart","chart-size","type","size","size-age","simple","color","color-age","heatmap","compare","relationship","relationship-size"];break;case"predominance-size":s=["predominance-size","predominance","chart-size","chart","dot-density","color-size","color-age-size","color-size-age","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===t?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"chart-size":s=["chart-size","chart","predominance-size","predominance","dot-density","color-size","color-age-size","color-size-age","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===t?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"relationship-size":s=["relationship-size","relationship","compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===t&&(s=s.concat(["type"])),s=s.concat(["simple"]),"string"!==t&&(s=s.concat(["type"]));break;default:s=["color","size","color-age","size-age","color-size"],"string"===t&&(s=s.concat(["type"])),s=s.concat(["heatmap","simple"]),"string"!==t&&(s=s.concat(["type"])),s=s.concat(["dot-density","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"])}return s}(),n=(null==e?void 0:e.length)?1===e.length&&e[0].field&&e[0].simpleFieldType===l.v.NUMBER?i.panels.gallery.styleMsg.oneNumber:2===e.length&&e[0].field&&e[1].field&&e[0].simpleFieldType===l.v.NUMBER&&e[1].simpleFieldType===l.v.NUMBER?i.panels.gallery.styleMsg.multipleNumber:i.panels.gallery.styleMsg.any:i.panels.gallery.styleMsg.empty;t.sort(((e,i)=>a.indexOf(e)-a.indexOf(i)));const r=t.map(((e,i)=>this.renderStyleTile(e,i)));return(0,s.h)("div",{class:"gallery-block"},(0,s.h)("div",{class:"style-tiles"},(0,s.h)("div",{class:"attributes-header"},(0,s.h)("div",{class:"center"},(0,s.h)("calcite-icon",{class:"number-icon",icon:"number-circle-2"})),(0,s.h)("div",{class:"styles-msg-title center"},i.panels.gallery.pickStyle),(0,s.h)("div",{class:"styles-msg center"},n)),r))}renderStyleTile(e,i){var t,a;const n=(0,l.b)(),{selectedFields:r}=l.s,o=(0,l.a)(),c=(0,l.K)(),d=`${(null===(t=null==r?void 0:r[0])||void 0===t?void 0:t.simpleFieldType)===l.v.DATE}\n        ${(null===(a=null==r?void 0:r[1])||void 0===a?void 0:a.simpleFieldType)===l.v.DATE}`,p=(0,l.J)(n,"reference-size"),m=(0,l.P)(p);return(0,s.h)("arcgis-smart-mapping-tile",{key:`tile-${e}-${c}-${m}-${d}`,tileType:"gallery",type:e,selected:e===o,ref:e=>{e&&(this.tileNodes[i]=e)},onArcgisSmartMappingTileSelect:()=>this.handleSelectClick(e),onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick(e),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsGalleryError.emit(e.detail),onArcgisSmartMappingTileThemeChange:()=>(0,s.f)(this.hostElement)})}addField(e){const{layer:i,selectedFields:t,modules:s,useFeatureReduction:a}=l.s;(0,l.L)(e);const n=a?t.find((e=>"aggregateCount"===e.field)):void 0,r=n?s.esriLang.clone(t).filter((e=>"aggregateCount"!==e.field)):s.esriLang.clone(t);if(e.forEach((e=>{const t=(0,l.r)(e);let s;if("featureReduction"in i&&a){s=i.featureReduction.fields.find((e=>e.name===t.layerField.name&&e.onStatisticExpression))}t.simpleFieldType===l.v.STRING||a&&t.simpleFieldType===l.v.DATE?s?r.unshift({field:e,simpleFieldType:t.simpleFieldType,featureReductionExpression:s.onStatisticExpression.expression,featureReductionExpressionTitle:s.onStatisticExpression.title}):r.unshift({field:e,simpleFieldType:a&&t.simpleFieldType===l.v.DATE?l.v.DATE:l.v.STRING}):s?r.push({field:e,simpleFieldType:t.simpleFieldType,featureReductionExpression:s.onStatisticExpression.expression,featureReductionExpressionTitle:s.onStatisticExpression.title}):r.push({field:e,simpleFieldType:t.simpleFieldType})})),3===r.length)for(let e=0;e<3;e++){const i=r[e];if(i.simpleFieldType===l.v.DATE&&2!==e){r.splice(e,1),r.splice(2,0,i);break}}n&&r.push(n),(0,l.t)(t,r)||(l.s.selectedFields=r,T(this.galleryRequestWrapper))}editAttribute(e,i){const{layer:t,selectedFields:s,modules:a,useFeatureReduction:n}=l.s;(0,l.L)(e);const r=a.esriLang.clone(s);e.forEach((e=>{const a=(0,l.r)(e);let r;if("featureReduction"in t&&n){r=t.featureReduction.fields.find((e=>e.name===a.layerField.name&&e.onStatisticExpression))}a.simpleFieldType===l.v.STRING||n&&a.simpleFieldType===l.v.DATE?(s.splice(i,1),r?s.unshift({field:e,simpleFieldType:a.simpleFieldType,featureReductionExpression:r.onStatisticExpression.expression,featureReductionExpressionTitle:r.onStatisticExpression.title}):s.unshift({field:e,simpleFieldType:n&&a.simpleFieldType===l.v.DATE?l.v.DATE:l.v.STRING})):s[i]=r?{field:e,simpleFieldType:a.simpleFieldType,featureReductionExpression:r.onStatisticExpression.expression,featureReductionExpressionTitle:r.onStatisticExpression.title}:{field:e,simpleFieldType:a.simpleFieldType}})),(0,l.t)(s,r)||(l.s.selectedFields=s,T(this.galleryRequestWrapper))}appendFlowItem(e){const{flowNode:i}=this,t=(0,l.f)(this.hostElement,"arcgis-smart-mapping");(0,l.F)(this.hostElement)?i.appendChild(e):t.appendChild(e),this.setUpWatchBinScale(!1)}removeFlowItem(e){const{flowNode:i}=this,t=(0,l.f)(this.hostElement,"arcgis-smart-mapping");(0,l.F)(this.hostElement)?i.removeChild(e):t.removeChild(e),this.setUpWatchBinScale(!0)}checkCluster(){const{layer:e}=l.s;"featureReduction"in e&&e.featureReduction&&this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit()}checkClusterRenderer(){var e;const{layer:i}=l.s;if("featureReduction"in i&&"cluster"===(null===(e=i.featureReduction)||void 0===e?void 0:e.type)){const e=i.featureReduction;e.renderer=null,i.featureReduction=e.clone()}}openFieldPickList(e=!1,i=null){(0,l.E)();const{fields:t,selectedFields:s}=l.s;let a,n=s.map((e=>e.field));a=t.filter((t=>{let s=!n.includes(t.layerField.name);return e&&(s=s||t.layerField.name===n[i]),s}));const r=document.createElement("arcgis-smart-mapping-field-pick-list");r.fields=a,r.popoverProps={refElement:this.flowItemNode,placement:"leading",offsetDistance:0,popoverWidth:1.05*this.flowItemNode.getBoundingClientRect().width,overlayPositioning:"absolute",flipDisabled:!1,triggerDisabled:!0},r.singleEditMode=e,r.fieldToReplace=e?s[i]:null,r.lastSortBy=this.lastSortBy,document.body.appendChild(r),(0,l.M)(this.flowItemNode,!0),r.addEventListener("arcgisSmartMappingFieldPickListClose",(t=>{var s;this.modifyFieldPickList=!0,document.body.removeChild(r),(0,l.M)(this.flowItemNode,!1),(null===(s=t.detail)||void 0===s?void 0:s.selectedFields)&&(e?this.editAttribute(t.detail.selectedFields,i):this.addField(t.detail.selectedFields)),this.addFieldButtonNode.setFocus()})),r.addEventListener("arcgisSmartMappingFieldPickListSortByChange",(e=>{this.lastSortBy=e.detail}))}focusSelectedTile(){this.setUpWatchBinScale(!0),setTimeout((()=>requestAnimationFrame((()=>{var e;return null===(e=this.tileNodes[0])||void 0===e?void 0:e.setFocus()}))),300)}setUpWatchBinScale(e){var i;e?this.scaleHandle=(0,n.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel"))):null===(i=this.scaleHandle)||void 0===i||i.remove()}get hostElement(){return(0,s.d)(this)}};x.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.generate{margin-bottom:12px;--calcite-font-weight-normal:500;--calcite-font-family:unset;--calcite-font-size--2:16px}.generate-icon{color:var(--calcite-color-text-2);cursor:pointer}.add-button-div{margin:0 3px}.add-buttons{display:flex;flex-direction:row;justify-content:space-between;background-color:#ffffff}.attributes{padding:6px 6px 0 6px;background-color:#ffffff}.attributes-header-text{font-weight:bold;font-size:16px;padding:10px 0}.attributes-msg{font-size:var(--calcite-font-size--2)}.attributes-add-new{margin-top:10px}.tip{margin-top:15px;display:flex;justify-content:space-between}.tip-message{justify-content:center}.tip-text{color:#3d5f1d}.tip-close{margin-top:4px}.field-type{display:flex;align-items:center;height:100%;color:var(--calcite-color-text-1)}.attribute-list{border-bottom:1px solid #e0e0e0}.gallery-block{padding:12px 3px;margin-bottom:12px;background-color:#ffffff;box-shadow:0 1px 10px 2px rgba(0, 0, 0, 0.05), 0 0 0 1px #e0e0e0}.style-tiles{overflow-x:hidden}.center{display:flex;align-items:center;justify-content:center;text-align:center}.number-icon{color:var(--calcite-color-brand)}.styles-msg-title{padding:6px;font-weight:bold;font-size:16px;display:flex;justify-content:center}.styles-msg{font-size:var(--calcite-font-size--2)}"},27909:(e,i,t)=>{t.d(i,{w:()=>a});t(12350),t(98034);var s=t(52437);function a(e,i){const{layer:t,mapView:a,useFeatureReduction:n}=s.s;if(!n||!("featureReduction"in t)||"binning"!==t.featureReduction.type)return;const r=s.s.modules.reactiveUtils.watch((()=>a.scale),(()=>{const n=t.featureReduction;a.scale<=n.maxScale&&!e.disabled?((0,s.E)(),function(e,i){const t=document.createElement("arcgis-smart-mapping-scale-alert-popover");t.refElement=e,t.addEventListener("arcgisSmartMappingScaleAlertPopoverBack",(()=>{l(),i()})),document.body.append(t)}(e,i),(0,s.M)(e,!0)):a.scale>n.maxScale&&e.disabled&&(l(),(0,s.M)(e,!1),e.setFocus())}));return r}function l(){document.querySelectorAll("arcgis-smart-mapping-scale-alert-popover").forEach((e=>{var i;null===(i=e.parentElement)||void 0===i||i.removeChild(e),e=null}))}},11139:(e,i,t)=>{t.d(i,{u:()=>l});var s=t(9421),a=t(52437);t(12350),t(98034);async function l(e){const{layer:i,strings:t,modules:l}=a.s,r=i,o=document.createElement("arcgis-modal-arcade");return o.arcadeScript=(null==e?void 0:e.expression)||"",o.arcadeProfile=function(){const{layer:e,useFeatureReduction:i}=a.s;return{id:"visualization",definitions:{$feature:i?{fields:(0,s.l)(e.featureReduction.popupTemplate,!1)}:e}}}(),o.testData=await async function(){const{layer:e,mapView:i,useFeatureReduction:t}=a.s;return{profileVariableInstances:{$feature:t?await(0,s.m)(i,e,e.featureReduction.popupTemplate):await n(),$view:{scale:i.scale,timeProperties:i.timeExtent?{currentStart:i.timeExtent.start,currentEnd:i.timeExtent.end,startIncluded:!0,endIncluded:!0}:void 0}},spatialReference:i.spatialReference}}(),o.addExistingExpressions=!0,o.layer=r,o.arcadeTitle=(null==e?void 0:e.expressionTitle)||t.arcade.newExpression,o.arcadeTitleEditable=!0,o.arcadeTitleEditingEnabled=!(null==e?void 0:e.expressionTitle),document.body.appendChild(o),new Promise(((e,i)=>{o.addEventListener("arcgisModalArcadeClose",(t=>{if(document.body.removeChild(o),!t.detail)return void i();const{script:s,title:n,predictOutputType:c}=t.detail;if(null==s?void 0:s.trim().length)return l.fieldUtils.getExpressionFields(r,[s]).then((i=>{(0,a.Q)(i),e({expression:s,expressionTitle:n,simpleFieldType:"number"===c?a.v.NUMBER:"string"===c?a.v.STRING:"date"===c?a.v.NUMBER:a.v.UNKNOWN})}));i()}))}))}async function n(){var e;const{layer:i,mapView:t,modules:s}=a.s;let l;if(!("fields"in i))return null;{await async function(){const{oneFeatureResponse:e,oneFeatureResponseStatus:i}=a.s;if(e&&i!==a.j.MISSING)return a.s.oneFeatureResponse;{const e=await function(){const{mapView:e,layer:i,mapImageSublayer:t}=a.s;if(!("fields"in i))return Promise.reject("getOneFeature: wrong layer type");if(t)return r();return e.whenLayerView(i).then((e=>{if("feature"===i.type&&!i.url||"wfs"===i.type){const e=i.createQuery();return e.start=0,e.num=5,e.outFields=["*"],i.queryFeatures(e).then((e=>e.features&&e.features.length?Promise.resolve(e):Promise.resolve(o())))}{const t="hasM"in i&&i.hasM,s="hasZ"in i&&i.hasZ,a=e.availableFields.length===i.fields.length&&!t&&!s;if("createQuery"in i&&a){const t=i.createQuery();return t.start=0,t.num=5,t.outFields=["*"],e.queryFeatures(t).then((e=>e.features&&e.features.length?Promise.resolve(e):r()))}return r()}}))}();return a.s.oneFeatureResponse=(null==e?void 0:e.features.length)&&e,a.s.oneFeatureResponseStatus=(null==e?void 0:e.features.length)?a.j.SUCCESS:a.j.FAILED,e}}();const{oneFeatureResponse:n}=a.s;if(null===(e=null==n?void 0:n.features)||void 0===e?void 0:e.length)l=s.esriLang.clone(n.features[0]);else{const e={};i.fields.forEach((i=>{["small-integer","big-integer","integer","single","double","string","date","date-only","oid","guid"].indexOf(i.type)>-1&&!1===i.nullable?i.defaultValue?e[i.name]=i.defaultValue:"string"===i.type?e[i.name]="":e[i.name]=0:e[i.name]=null}));const n=t.extent;let r,o;(0,a.C)()?(r=new s.Polygon({spatialReference:new s.SpatialReference(t.spatialReference.toJSON())}),r.addRing([[n.xmin,n.ymin],[n.xmax,n.ymin],[n.xmax,n.ymax],[n.xmin,n.ymax],[n.xmin,n.ymin]]),o=new s.SimpleLineSymbol):(0,a.z)()?(r=new s.Point(n.center.toJSON()),o=new s.SimpleMarkerSymbol):(0,a.A)()&&(r=new s.Polyline({spatialReference:new s.SpatialReference(t.spatialReference.toJSON())}),r.addPath([[n.xmin,n.ymin],[n.xmax,n.ymax]]),o=new s.SimpleFillSymbol),l=new s.Graphic({geometry:r,symbol:o,attributes:e})}}return l}function r(){var e,i;const{layer:t,mapView:s,modules:l}=a.s;if(!("queryFeatures"in t))return Promise.resolve(o());const n=new l.Query({outFields:["*"],where:"1=1",outSpatialReference:s.spatialReference,returnGeometry:!0,returnM:"hasM"in t&&t.hasM,returnZ:"hasZ"in t&&t.hasZ});return"sourceJSON"in t&&(null===(i=null===(e=t.sourceJSON)||void 0===e?void 0:e.advancedQueryCapabilities)||void 0===i?void 0:i.supportsPagination)&&(n.num=1),t.queryFeatures(n).then((e=>Promise.resolve(e)),(()=>Promise.resolve(o())))}function o(){const{layer:e,modules:i}=a.s,t={};"fields"in e&&e.fields.forEach((e=>{e.defaultValue?t[e.name]=e.defaultValue:["small-integer","big-integer","integer","single","double","long","date","oid"].indexOf(e.type)>-1?t[e.name]=0:"date-only"===e.type?t[e.name]=null:t[e.name]=""}));const s=new i.Graphic({geometry:void 0,symbol:void 0,attributes:t});return new i.FeatureSet({features:[s],fields:[],geometryType:(0,a.D)(),spatialReference:"spatialReference"in e&&e.spatialReference.clone()})}},95875:(e,i,t)=>{let s,a;function l(e){e.loading=!1}function n(e,i){return function(e){e.loading=!0,a=!1,s&&clearTimeout(s),s=setTimeout((()=>{l(e),a=!0}),6e4)}(i),e.then((e=>(l(i),a?Promise.reject(new Error("timeout")):Promise.resolve(e)))).catch((e=>(l(i),Promise.reject(e))))}t.d(i,{r:()=>n})}}]);