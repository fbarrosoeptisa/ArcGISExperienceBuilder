/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_delete-5f5523.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_delete-5f5523"],{31171:(e,t,r)=>{r.d(t,{a:()=>u,b:()=>h,c:()=>T,d:()=>c,e:()=>b,f:()=>D,g:()=>v,i:()=>S,s:()=>I});var i=r(26408),o=(r(98034),r(4948),r(68616)),n=r(5011),s=r(67336),a=r(44508),l=r(57159);const c=async(e,t,r=!1)=>{const i=`${(0,s.e)(e.owner,t)}/items/${e.id}/delete`;return(0,l.r)(i,{permanentDelete:r},{},"post")},u=async(e,t,r=!1)=>{const o=(0,s.q)(e),n=[];for(const e in o){const a=`${(0,s.e)(e,t)}/deleteItems`,c=o[e];(0,i.h)(c,100).forEach((e=>{const t={items:e.join(","),permanentDelete:r};n.push((0,l.r)(a,t,{},"post"))}))}return{results:(await Promise.all(n)).flatMap((e=>e.results))}},d=async(e,t)=>{var r,i;const{type:o,typeKeywords:s}=e,a=["Scene Service","Map Service","WFS","OGCFeatureServer","Vector Tile Service","3DTiles Service"].includes(o),l=["Map Service","Vector Tile Service"].includes(o);try{const c=a?[{relationshipType:"Service2Service",direction:"reverse"},{relationshipType:"Service2Data",direction:"forward"}]:s.indexOf("Bulk Published Service")>-1?{relationshipType:"DataStore2BPService",direction:"reverse"}:"Geoprocessing Service"===o&&s.includes("Notebook Web Tool")?{relationshipType:"Notebook2WebTool",direction:"reverse"}:s.includes("Route Layer")?{relationshipType:"Service2Route",direction:"reverse"}:"Mobile Application"===o?{relationshipType:"MobileApp2Code",direction:"reverse"}:"Map Package"===o?{relationshipType:"Area2Package",direction:"reverse"}:"Route Layer"===o?{relationshipType:"Service2Route",direction:"reverse"}:"Feature Service"===o?{relationshipType:"Service2Layer",direction:"reverse"}:s.includes("Document")?{relationshipType:"Item2Attachment",direction:"reverse"}:"Application Configuration"===o?{relationshipType:"Map2AppConfig",direction:"reverse"}:{relationshipType:"Service2Data",direction:"forward"};if(!c)return null;if(!Array.isArray(c)){return null!==(i={sourceData:null===(r=(await(0,n.b)(e.id,t,c)).relatedItems)||void 0===r?void 0:r[0],relationship:c})&&void 0!==i?i:null}if(a){let r={relationshipType:"Service2Service",direction:"reverse"};const i=await(0,n.b)(e.id,t,r),o=(null==i?void 0:i.total)?i.relatedItems.shift():null;if(l&&!(e=>(null==e?void 0:e.typeKeywords.includes("View Service"))||!1)(o)||!o){r={relationshipType:"Service2Data",direction:"forward"};const i=await(0,n.b)(e.id,t,r);return{sourceData:(null==i?void 0:i.total)?i.relatedItems.shift():o,relationship:r}}return{sourceData:o,relationship:r}}}catch(e){return console.error(e),{sourceData:null,relationship:{relationshipType:null}}}},p=async(e,t)=>{try{const{type:r,typeKeywords:i}=e,s=(()=>"Notebook"===r?{relationshipType:"Notebook2WebTool",direction:"forward"}:i.includes("Has Related Route Layers")?{relationshipType:"Service2Route",direction:"forward"}:(0,o.i)(i,r)?{relationshipType:"Service2Service",direction:"Feed"===r?"reverse":"forward"}:{relationshipType:"Service2Data",direction:"reverse"})(),a=await(0,n.b)(e.id,t,s);return{resultData:{items:a.total>0?a.relatedItems:null,count:a.aggregations.total.count},relationship:s}}catch(e){return console.error(e),{resultData:null,relationship:{relationshipType:null}}}};async function v(e,t){const r=await(0,l.r)(`${(0,a.c)(e)}portals/helpmap?culture=${t}`);return null==r?void 0:r.helpMap.m}const m=["Area2Package","Item2Attachment","Listed2Provisioned","Map2AppConfig","Map2Area","Map2IndoorsConfig","MobileApp2Code","Notebook2WebTool","Service2Layer","Service2Route","WMA2Code"],y=["ArcgisWorkflowManager","ArcGISWorkflowJobLocation","Workflow Manager"],h=async(e,t,r=!1)=>{const i=[],n=[],a=[],c=[],u=(t,i,n)=>{const s=((e,t,r)=>{const{typeKeywords:i,type:n}=e;return!t&&(null==r?void 0:r.length)&&!(0,o.i)(i,n)})(t,i,n);return{preventSourceDelete:!s&&(null==n?void 0:n.filter((e=>!e.inRecycleBin)).length)>0&&!E(t,n)&&!C(t,n),discourageSourceDelete:s,discouragedAllowedSourceItem:r&&1===e.length&&s?{item:t,error:{message:"Delete discouraged"}}:null}},v=async(r,i)=>{var o;const{sourceData:n,relationship:a}=await d(r,t),{resultData:c,relationship:h}=await p(r,t),T=m.includes(a.relationshipType),b=m.includes(h.relationshipType);try{const{preventSourceDelete:o,discourageSourceDelete:a,discouragedAllowedSourceItem:d}=u(r,n,null==c?void 0:c.items),p=await(async e=>{var t,r;const{item:i,portal:o,permanentlyDelete:n}=e,a=(null!==(r=null===(t=o.sourceJSON)||void 0===t?void 0:t.recycleBinEnabled)&&void 0!==r?r:o.recycleBinEnabled)&&!n?"/canRecycle":"/canDelete",c=`${(0,s.e)(i.owner,o)}/items/${i.id}${a}`;return await(0,l.r)(c)})({item:r,portal:t,permanentlyDelete:i});return p.success?b?{bucket:"UNPROTECTED",bucketItem:{item:r,relatedItems:{resultData:c,isComposite:!0}}}:d?{bucket:"UNPROTECTED",bucketItem:d}:await f({selectedItems:e,resultData:null==c?void 0:c.items,portal:t})||!a&&!o?{bucket:i?"UNRECYCLABLE":"UNPROTECTED",bucketItem:{item:r,relatedItems:{resultData:c}}}:{bucket:"PROTECTED",bucketItem:{item:r,error:a?{message:"Delete discouraged",offendingItems:c.items}:{messageCode:"CONT_00481",offendingItems:c.items}}}:r.protected?{bucket:"PROTECTED",bucketItem:{item:r,error:{messageCode:"CONT_0048"}}}:{bucket:"UNRECYCLABLE",bucketItem:{item:r}}}catch(s){const a=(null===(o=null==s?void 0:s.details)||void 0===o?void 0:o.raw)||Object.assign({},s);switch(s.messageCode||a.messageCode){case"CONT_00481":{a.offendingItems=c.items;const i=!y.some((e=>r.typeKeywords.includes(e)));return await f({selectedItems:e,resultData:c.items,portal:t})?{bucket:i?"UNPROTECTED":"UNRECYCLABLE",bucketItem:{item:r,relatedItems:{resultData:c}}}:{bucket:"PROTECTED",bucketItem:{item:r,error:a}}}case"CONT_0048":return{bucket:"PROTECTED",bucketItem:{item:r,error:a}};case"CONT_0298":return T&&g({items:e,sourceData:n})?{bucket:"COMPOSITE",bucketItem:{item:r,relatedItems:{sourceData:n}}}:i?{bucket:"UNRECYCLABLE",bucketItem:{item:r,relatedItems:{sourceData:n}}}:v(r,!0);default:return console.error(s),{bucket:"PROTECTED",bucketItem:{item:r,error:a}}}}};return await Promise.all(e.map((async e=>{const{bucket:t,bucketItem:r}=await v(e);switch(t){case"UNPROTECTED":n.push(r);break;case"PROTECTED":i.push(r);break;case"UNRECYCLABLE":a.push(r);break;case"COMPOSITE":c.push(r)}}))),Promise.resolve({protectedItems:i,unprotectedItems:n,unrecyclableItems:a,selectedCompositeItems:c})},T=e=>{const{protectedItems:t,unrecyclableItems:r,unprotectedItems:i}=e,o=[];return t.length>0&&o.push("PROTECTED"),r.length>0&&o.push("UNRECYCLABLE"),i.length>0&&o.push("UNPROTECTED"),o.join("_")},b=e=>{let t="DELETE";switch(e){case"PROTECTED":t="NONE";break;case"UNRECYCLABLE":case"PROTECTED_UNRECYCLABLE":t="PERMANENTLY_DELETE"}return t},f=async e=>{var t,r;const{selectedItems:o,offendingItems:n,resultData:s,portal:a}=e,l=null!==(t=await w({items:s,portal:a}))&&void 0!==t?t:[],c=null!==(r=null==n?void 0:n.map((e=>e.itemId)))&&void 0!==r?r:[],u=(0,i.b)([...l,...c]),d=o.filter((e=>u.includes(e.id))),p=u.every((e=>o.some((t=>t.id===e)))),v=d.every((e=>!e.protected));return p&&v},w=async e=>{var t,r;null!==(t=e.accumulatedIds)&&void 0!==t||(e.accumulatedIds=[]);const{items:i,portal:o,accumulatedIds:n}=e;if(!i)return n;const s=i.filter((e=>!e.inRecycleBin));n.push(...s.map((e=>e.id)));for(const e of null!=s?s:[]){const{resultData:t}=await p(e,o);return w({items:null!==(r=null==t?void 0:t.items)&&void 0!==r?r:[],accumulatedIds:n,portal:o})}return n},g=e=>{const{items:t,sourceData:r}=e;return!!r&&t.find((e=>e.id===r.id))},E=(e,t)=>{const{typeKeywords:r,type:i}=e;return"Feed"===e.type&&(0,o.i)(r,i)&&1===(null==t?void 0:t.length)&&"Feature Service"===t[0].type&&t[0].typeKeywords.includes("Hosted Service")},C=(e,t)=>{const{typeKeywords:r,type:i}=e;return"Feature Service"===e.type&&(0,o.i)(r,i)&&1===(null==t?void 0:t.length)&&"Feed"===t[0].type&&t[0].typeKeywords.includes("Hosted Service")},D=({item:e})=>{var t,r;const{typeKeywords:i,type:n}=e;return(0,o.i)(i,n)&&"Feature Service"===e.type&&!!(null!==(r=null===(t=e.sourceJSON)||void 0===t?void 0:t.origin)&&void 0!==r?r:null==e?void 0:e.origin)},I=e=>{const{deletedItems:t,permanentlyDeletedItems:r}=e,i={successes:[],errors:[]};for(const e of t)e.success?i.successes.push(Object.assign(Object.assign({},e),{permanentDelete:!1})):i.errors.push(Object.assign(Object.assign({},e),{permanentDelete:!1}));for(const e of r)e.success?i.successes.push(Object.assign(Object.assign({},e),{permanentDelete:!0})):i.errors.push(Object.assign(Object.assign({},e),{permanentDelete:!0}));return i},S=e=>{var t;return 1===e.length&&(null===(t=e[0].relatedItems)||void 0===t?void 0:t.isComposite)}},67336:(e,t,r)=>{r.d(t,{a:()=>a,b:()=>s,c:()=>u,d:()=>d,e:()=>p,f:()=>y,g:()=>C,h:()=>h,i:()=>l,j:()=>f,k:()=>w,l:()=>T,m:()=>E,n:()=>g,o:()=>m,p:()=>b,q:()=>v,u:()=>c});var i=r(98034),o=r(44508);function n(e){var t;return!!(null===(t=e.owner)||void 0===t?void 0:t.toLowerCase().includes("esri"))}function s(e){var t;return n(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Credits"))}function a(e){var t;return n(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Subscription"))}function l(e,t){return e.owner===t.username}function c(e,t){return l(e,t)||function(e,t){var r;if(null!=e.isAdmin)return!!e.isAdmin;const i=e.owner,o="admin"===e.itemControl,n=["esri_livingatlas","esri_demographics","esri_boundaries"];if((null===(r=e.portal)||void 0===r?void 0:r.isPortal)&&!l(e,t)&&o&&i.includes("esri_")&&!n.includes(i))return!1;return o}(e,t)}const u=(e,t)=>!!t.orgId&&e.every((e=>e.isOrgItem)),d=(e,t)=>`${(0,o.a)(t)}item.html?id=${e}`,p=(e,t)=>`${(0,o.g)(t)}/content/users/${e}`,v=e=>e.reduce(((e,t)=>(e[t.owner]=e[t.owner]?[...e[t.owner],t.id]:[t.id],e)),{});function m(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Spatiotemporal")}function y(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("View Service")}function h(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Hosted Service")}function T(e){var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Multi Services View")}function b(e){return(null==e?void 0:e.hasViews)&&!e.sourceSchemaChangesAllowed}async function f(e){var t;const r=null==e?void 0:e.portalItem;if(!r)return Promise.resolve(null);const n=r.portal,[s]=await(0,i.l)(["esri/request"]);if(null==n?void 0:n.user){return s(`${(0,o.g)(n)}community/users/${n.user.username}`,{query:{f:"json",token:null===(t=r.portal.credential)||void 0===t?void 0:t.token},responseType:"json"}).then((e=>{var t,r;const i=null!==(r=null===(t=e.data)||void 0===t?void 0:t.groups)&&void 0!==r?r:[];return Promise.resolve(i)}),(()=>Promise.reject()))}return Promise.resolve(null)}async function w(e){var t;const r=null==e?void 0:e.portalItem;if(!r)return Promise.resolve(null);const n=r.portal,[s]=await(0,i.l)(["esri/request"]);return s(`${(0,o.g)(n)}content/items/${r.id}/groups`,{query:{f:"json",token:null===(t=r.portal.credential)||void 0===t?void 0:t.token},responseType:"json"}).then((e=>{var t,r,i,o,n,s;const a=[...null!==(r=null===(t=e.data)||void 0===t?void 0:t.admin)&&void 0!==r?r:[],...null!==(o=null===(i=e.data)||void 0===i?void 0:i.member)&&void 0!==o?o:[],...null!==(s=null===(n=e.data)||void 0===n?void 0:n.other)&&void 0!==s?s:[]];return Promise.resolve(a)}),(()=>Promise.reject()))}async function g(e,t,{relationshipType:r,direction:n}){const s=`${(0,o.g)(t)}content/items/${e}/relatedItems`,[a]=await(0,i.l)(["esri/request"]);return await a(s,{query:{f:"json",relationshipType:r,direction:n},method:"get",responseType:"json"})}function E(e,t){return null==e?void 0:e.some((e=>null==t?void 0:t.some((t=>e.id===t.id&&e.capabilities.includes("updateitemcontrol")))))}const C=(e,t)=>`${(0,o.a)(t)}content/items/${e}`}}]);