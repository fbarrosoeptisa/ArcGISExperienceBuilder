/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-38bd0e.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-38bd0e"],{99004:(e,t,i)=>{i.d(t,{c:()=>a,g:()=>r});var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}},86308:(e,t,i)=>{i.r(t),i.d(t,{arcgis_field_calculate_editor:()=>o,arcgis_field_calculate_table:()=>d});var a=i(19564),r=i(26408),l=i(56759);i(98034),i(73807),i(18991),i(9421),i(12350),i(91102),i(99004);function s(){const{layer:e}=l.f;return{id:"field-calculation",definitions:{$layer:e}}}async function n(e){const{layer:t}=l.f;return{profileVariableInstances:{$feature:await c(e),$layer:t,$datastore:t.url},spatialReference:t.spatialReference}}async function c(e){var t;const{layer:i}=l.f;let a=null;if("fields"in i){const i=await(0,l.a)(e);(null===(t=null==i?void 0:i.features)||void 0===t?void 0:t.length)&&(a=i.features[0].clone())}return a}const o=class{constructor(e){(0,a.r)(this,e),this.arcgisFieldCalculateEditorScriptChange=(0,a.c)(this,"arcgisFieldCalculateEditorScriptChange",7),this.arcgisFieldCalculateEditorFilterChange=(0,a.c)(this,"arcgisFieldCalculateEditorFilterChange",7),this.arcgisFieldCalculateEditorOpenScrim=(0,a.c)(this,"arcgisFieldCalculateEditorOpenScrim",7),this.arcgisFieldCalculateEditorLanguageSelected=(0,a.c)(this,"arcgisFieldCalculateEditorLanguageSelected",7),this.script=l.f.currentScript||"",this.resizeObserver=new ResizeObserver((e=>{const t=e.pop();this.hideSideBar=t.contentRect.width<=600})),this.debouncedScriptChange=(0,r.d)((()=>{this.arcgisFieldCalculateEditorScriptChange.emit()}),500),this.editorOpen=!1,this.filterPanelWhere=void 0,this.filterPanelOpen=!1,this.hideSideBar=void 0}async watchPropHandler(e,t){this.arcadeEditorNode&&e!==t&&(this.arcadeEditorNode.testData=await n(e))}disconnectedCallback(){this.resizeObserver.disconnect()}async closeEditor(){this.editorOpen=!1}async openEditor(){this.editorOpen=!0}async openFilterPanel(){this.filterPanelOpen=!0}async closeFilterPanel(){this.filterPanelOpen=!1}async isTestResultValid(){try{let e=await this.arcadeEditorNode.getTestResult();if("error"===e.type)return!1;return(0,l.v)(e.value).isFieldValid}catch(e){return!1}}render(){return(0,a.h)(a.H,{key:"381a9135c0162c5cb8b6ab3580dd9af878be420e"},this.renderLanguageSelect(),this.renderFilterPanel(),this.renderEditor())}renderFilterPanel(){var e,t;if(!this.filterPanelOpen)return;const{isTable:i,layer:r,mapView:s,strings:n}=l.f;return(0,a.h)("arcgis-filter",{class:"filter",layer:r,mode:"layer-view",viewFilter:(null===(t=null===(e=r.featureEffect)||void 0===e?void 0:e.filter)||void 0===t?void 0:t.where)||null,view:i?null:s,dismissible:!1,hideButtons:!0,hideLayerTitle:!0,panelHeading:n.defineFilter,tipMsg:n.emptyFilterText,leadingText:n.filterPanelDescription,clearText:n.clearAll,withinModal:!0,onArcgisFilterWhereChange:e=>{this.arcgisFieldCalculateEditorFilterChange.emit(e.detail)}})}renderEditor(){const{selectedLanguage:e,strings:t}=l.f;if(!this.editorOpen)return null;const i="Arcade"===e?this.renderArcadeEditor():this.renderSQLEditor();return(0,a.h)("calcite-panel",{heading:"Arcade"===e?t.arcadeExpression:t.sqlExpression},i)}renderArcadeEditor(){return(0,a.h)("arcgis-arcade-editor",{class:"editor",script:this.script,hideSideBar:this.hideSideBar,onArcgisScriptChange:e=>{l.f.currentScript=e.detail,this.script=e.detail,this.debouncedScriptChange()},ref:async e=>{e&&(this.arcadeEditorNode=e,e.profile=function(){const{layer:e}=l.f;return{id:"field-calculation",definitions:{$feature:e,$datastore:e}}}(),e.testData=await n(this.filterPanelWhere),this.resizeObserver.observe(e))}})}renderSQLEditor(){return(0,a.h)("arcgis-sql-expression-editor",{class:"editor",script:this.script,profile:s(),hideSideBar:this.hideSideBar,onArcgisScriptChange:e=>{l.f.currentScript=e.detail,this.script=e.detail,this.debouncedScriptChange()},ref:e=>{e&&this.resizeObserver.observe(e)}})}renderLanguageSelect(){if(this.editorOpen||this.filterPanelOpen)return;const{arcadeSupported:e,layer:t,originalField:i,strings:r}=l.f;return(0,a.h)("calcite-panel",null,(0,a.h)("div",{class:"panel-title",slot:"header-content"},r.editorPanelHeading),(0,a.h)("calcite-label",{class:"language-select-text"},r.languageSelect),(0,a.h)("calcite-tile-group",{label:r.languageSelect,layout:"vertical",class:"language-select",selectionMode:"single-persist"},(0,a.h)("calcite-tile",{class:"language-select-tile",disabled:!e,selected:"Arcade"===l.f.selectedLanguage,onClick:()=>this.handleLanguageSelect("Arcade"),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleLanguageSelect("Arcade")}},(0,a.h)("div",{slot:"content-bottom",class:"language-select-description"},(0,a.h)("calcite-label",{class:(e?"":"disabled")+" language-select-description-header"},r.arcade),(0,a.h)("calcite-label",{class:""+(e?"":"disabled")},r.idealFor,(0,a.h)("ul",{class:` ${e?"":"disabled"} language-select-description-text`},(0,a.h)("li",null,r.arcadeDescription1),(0,a.h)("li",null,r.arcadeDescription2))),(0,a.h)("calcite-notice",{kind:"danger",open:!e},(0,a.h)("div",{slot:"title"},r.languageNotSupported),(0,a.h)("div",{slot:"message"},t.portalItem.portal.isPortal?r.arcadeNotSupportedEN:r.arcadeNotSupported)))),(0,a.h)("calcite-tile",{class:"language-select-tile",selected:"SQL"===l.f.selectedLanguage,onClick:()=>this.handleLanguageSelect("SQL"),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleLanguageSelect("SQL")}},(0,a.h)("div",{slot:"content-bottom",class:"language-select-description"},(0,a.h)("calcite-label",{class:"language-select-description-header"},r.sql),(0,a.h)("calcite-label",null,r.idealFor,(0,a.h)("ul",{class:"language-select-description-text"},(0,a.h)("li",null,r.sqlDescription1),(0,a.h)("li",null,r.sqlDescription2),(0,a.h)("li",null,r.sqlDescription3)))))))}handleLanguageSelect(e){l.f.selectedLanguage!==e&&this.handleLanguageReset(e),this.arcgisFieldCalculateEditorLanguageSelected.emit()}handleLanguageReset(e){var t;const{features:i,mapView:a}=l.f;l.f.selectedLanguage=e,l.f.currentScript="",this.script="",l.f.arcadeExecutor=void 0,l.f.sqlEngine=void 0,l.f.invalidScript=!1,(null===(t=null==a?void 0:a.popup)||void 0===t?void 0:t.visible)&&a.popup.close();for(const e in i)i[e].calculatedValue=void 0,i[e].error=void 0,i[e].passed=void 0}get hostElement(){return(0,a.d)(this)}static get watchers(){return{filterPanelWhere:["watchPropHandler"]}}};o.style=".sc-arcgis-field-calculate-editor-h{height:100%;position:relative}arcgis-arcade-editor.sc-arcgis-field-calculate-editor,arcgis-sql-expression-editor.sc-arcgis-field-calculate-editor{z-index:var(--calcite-z-index-header)1}arcgis-arcade-editor.sc-arcgis-field-calculate-editor>calcite-tooltip.sc-arcgis-field-calculate-editor,arcgis-sql-expression-editor.sc-arcgis-field-calculate-editor>calcite-tooltip.sc-arcgis-field-calculate-editor{z-index:var(--calcite-z-index-tooltip)}.calculate-button.sc-arcgis-field-calculate-editor{display:inline-flex}.calculate-card.sc-arcgis-field-calculate-editor{cursor:pointer}.disabled.sc-arcgis-field-calculate-editor{opacity:var(--calcite-opacity-disabled)}.editor.sc-arcgis-field-calculate-editor{width:100%;height:100%}.hidden.sc-arcgis-field-calculate-editor{display:none}.language-select-description.sc-arcgis-field-calculate-editor{display:flex;flex-direction:column;width:100%}.language-select-description-header.sc-arcgis-field-calculate-editor{font-weight:500}.language-select-tile.sc-arcgis-field-calculate-editor{opacity:1;min-inline-size:100%}.language-select-description-text.sc-arcgis-field-calculate-editor{color:var(--calcite-color-text-3);font-size:var(--calcite-font-size-sm)}.language-select-text.sc-arcgis-field-calculate-editor{margin:20px 10px 0}.language-select.sc-arcgis-field-calculate-editor{margin:10px}.panel-border.sc-arcgis-field-calculate-editor{border:1px solid #e0e0e0}.panel-title.sc-arcgis-field-calculate-editor{font-size:var(--calcite-font-size-0);line-height:2rem;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-color-text-1)}.sql-editor-temp.sc-arcgis-field-calculate-editor{margin:20px 10px 0}.editor-wrapper.sc-arcgis-field-calculate-editor{display:flex;flex-direction:column;align-items:center;margin:4rem 2rem;height:70vh;min-height:400px}.filter.sc-arcgis-field-calculate-editor{height:100%}";const d=class{constructor(e){(0,a.r)(this,e),this.arcgisFieldCalculateTableRecordCountUpdate=(0,a.c)(this,"arcgisFieldCalculateTableRecordCountUpdate",7),this.objectIds=[],this.testButtons={}}async enableGeometry(){this.table&&!this.table.returnGeometryEnabled&&(this.table.returnGeometryEnabled=!0,this.table.returnMEnabled=!0,this.table.returnZEnabled=!0,this.table.refresh())}async getMode(){return this.mode}async getLayer(){return this.layer}async calculateValues(){const{features:e}=l.f;for(const t in e)e[t].calculatedValue=void 0,e[t].error=void 0,e[t].passed=!1,l.f.autoPreviewEnabled&&this.calculateCellValues(e[t].feature);this.table.refreshCellContent(),(0,l.u)()}async noRowsVisible(){return 0===this.numVisibleRows}async refresh(e){var t;e?this.table.refreshCellContent():await(null===(t=this.table)||void 0===t?void 0:t.refresh()),this.populateTestFeaturesFromTable()}async resetTableTemplates(){if("preview"===this.mode){const e=this.getPreviewValuesTemplates();this.table.tableTemplate={columnTemplates:e}}else{const e=this.getTestFeaturesTemplates();this.table.tableTemplate={columnTemplates:e}}}async setMode(e){this.mode!==e&&(this.mode=e,this.resetTableTemplates())}async updateTableFilter(e,t,i=!1){var a;const r=this.getCombinedWhere(e,t);this.objectIds=await this.queryForObjectIds(r),this.numVisibleRows=(null===(a=this.objectIds)||void 0===a?void 0:a.length)||0,this.layer.definitionExpression=e,i||(this.table.objectIds.removeAll(),this.table.maxSize=this.objectIds.length,this.objectIds.length&&this.table.objectIds.addMany(this.objectIds),this.populateTestFeaturesFromTable())}async componentWillLoad(){const{layer:e}=l.f;this.layer=e.clone(),await this.layer.load(),this.objectIds=await this.queryForObjectIds(),this.numVisibleRows=this.objectIds.length}async componentDidLoad(){const{config:e}=l.f;this.hostElement.shadowRoot.firstElementChild.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${e.jsapiUrl}/themes/light/main.css"/>`)}render(){const{modules:e}=l.f;let t=[];switch(this.mode){case"features":t=this.getTestFeaturesTemplates();break;case"preview":t=this.getPreviewValuesTemplates()}return this.table=new e.FeatureTable({layer:this.layer,tableTemplate:{columnTemplates:t},objectIds:this.objectIds,visibleElements:{columnMenus:!1,header:!1,menu:!1,selectionColumn:!1,columnDescriptions:!1},container:null,maxSize:l.f.numRecords}),e.reactiveUtils.watch((()=>this.table.viewModel.store.pageCache.size),(e=>{e>0&&(this.populateTestFeaturesFromTable(),this.calculateValues())})),(0,a.h)(a.H,{key:"a1c63f62e4c271f504ac2650d027f94c789b2a41"},(0,a.h)("div",{key:t.toString(),ref:e=>{e&&(this.table.container=e)}}))}getTestFeaturesTemplates(){const{originalField:e}=l.f;let t=[];return this.layer.fields.forEach((i=>{i.name!==e.name&&t.push({type:"field",fieldName:i.name,label:i.alias})})),t.push(this.getOriginalFieldColumnTemplate()),t}getCombinedWhere(e,t){return e&&t?`(${e}) AND (${t})`:e||t}getPreviewValuesTemplates(){const{layer:e,originalField:t,strings:i}=l.f;let a=[];return a.push({type:"field",fieldName:e.objectIdField,label:e.fields.find((t=>t.name===e.objectIdField)).alias}),a.push(this.getOriginalFieldColumnTemplate()),a.push({type:"column",label:i.calculated,fieldName:`${t.name}Calculated`,sortable:!1,invalid:!1,textWrap:!0,formatFunction:({feature:e})=>{const{arcadeExecutor:t,autoPreviewEnabled:a,features:r,invalidScript:s,sqlEngine:n}=l.f,c=e.attributes[this.layer.objectIdField];if(t||n){if(s&&a)return"";if((0,l.b)(r[c].calculatedValue))return r[c].error&&!(0,l.i)(r[c].calculatedValue)?r[c].calculatedValue:this.getCellDisplayValue(r[c].calculatedValue);if(r[c].error)return"";if(a||!t&&!n){const t=(0,l.e)(e);return r[c].error?t:this.getCellDisplayValue(t)}if(!this.testButtons[c]){const a=document.createElement("calcite-button");a.appearance="transparent",a.innerHTML=i.testCalculation,a.iconEnd="play",a.onclick=async()=>{a.loading=!0,(null==t?void 0:t.isAsync)?await(0,l.d)(e):(0,l.e)(e),this.table.refreshCellContent()},this.testButtons[c]=a}return this.testButtons[c].loading=!1,this.testButtons[c]}return""}}),a.push(this.getErrorsTemplate()),a}getErrorsTemplate(){const{originalField:e,strings:t}=l.f;return{type:"column",label:t.errors,fieldName:`${e.name}Errors`,sortable:!1,textWrap:!0,formatFunction:({feature:e})=>{const{features:i,invalidScript:a}=l.f,s=e.attributes[this.layer.objectIdField],n=(0,r.e)(i[s].error);if(!(0,l.b)(i[s].calculatedValue)&&!n&&!a)return null;const c=document.createElement("div"),o=document.createElement("calcite-icon");o.scale="s",o.icon=n||a?"exclamation-mark-triangle-f":"check-circle",o.classList.add(n||a?"warning-icon":"success-icon");const d=document.createElement("div");return d.innerHTML=n?i[s].error:a?t.popupError:t.noErrors,c.append(o),c.append(d),c.classList.add("cell-with-icon"),c}}}getOriginalFieldColumnTemplate(){const{originalField:e,strings:t}=l.f;return{type:"column",label:"features"===this.mode?e.alias:t.original,fieldName:e.name,frozenToEnd:"features"===this.mode,sortable:!1,textWrap:!0,invalid:"features"===this.mode,formatFunction:({feature:t})=>{const i=t.attributes[e.name];if((0,l.b)(i))return this.getCellDisplayValue(i)}}}async queryForObjectIds(e){const{numRecords:t}=l.f,i=this.layer.createQuery();i.returnGeometry=!1,i.num=t,i.where=e;const a=await this.layer.queryObjectIds(i);return this.arcgisFieldCalculateTableRecordCountUpdate.emit(a.length),a}calculateCellValues(e){const{arcadeExecutor:t,features:i,sqlEngine:a}=l.f;if(t||a){const a=e.attributes[this.layer.objectIdField];if(!(0,l.b)(i[a].calculatedValue)){if(null==t?void 0:t.isAsync)return;(0,l.e)(e)}}}getCellDisplayValue(e){e=(0,l.h)(e);if([/^\s*(https?:\/\/([^\s]+))\s*$/i,/^\s*(tel:([^\s]+))\s*$/i,/^\s*(mailto:([^\s]+))\s*$/i,/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,/^\s*(iform:\/\/([^\s]+))\s*$/i,/^\s*(flow:\/\/([^\s]+))\s*$/i,/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,/^\s*(mspbi:\/\/([^\s]+))\s*$/i].find((t=>t.test(e)))){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t}if(/<\/?[a-z][\s\S]*>/i.test(e)){const t=document.createElement("span");return t.textContent=e,t}return e}populateTestFeaturesFromTable(){const{features:e}=l.f;(this.table.viewModel.store.pageCache.get(0)||[]).forEach((t=>{const i=t.feature,a=t.objectId;e[a]||(e[a]={}),e[a].feature=i}));for(const t in e)e[t].tableFeature=this.table.objectIds.includes(parseInt(t))}get hostElement(){return(0,a.d)(this)}};d.style=":host{height:100%}.cell-with-icon{display:flex;align-items:center;-moz-column-gap:10px;column-gap:10px}.warning-icon{--calcite-ui-icon-color:var(--calcite-color-status-warning)}.success-icon{--calcite-ui-icon-color:var(--calcite-color-status-success)}"},91102:(e,t,i)=>{i.d(t,{a:()=>c,c:()=>r,d:()=>o,g:()=>l,i:()=>s,s:()=>n});var a=i(73807);function r(e,t){return function e(i){return i?i.closest(t)||e(function(e){return e.getRootNode()}(i).host||null):null}(e)}function l(e){const t=r(e,".calcite-mode-dark, .calcite-mode-light");return(null==t?void 0:t.classList.contains("calcite-mode-dark"))?"dark":"light"}function s(e){let t=e;for(;null==t?void 0:t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1}function n(e){return(new a.S).sanitize(e)}function c(e){const t=n(e),i=document.createElement("div");return i.innerHTML=t,i.textContent||i.innerText||""}function o(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}},98034:(e,t,i)=>{i.d(t,{e:()=>l,l:()=>s});var a,r=i(99004),l={exports:{}};a=l.exports,r.c,function(e){var t={Promise:"undefined"!=typeof window?window.Promise:void 0},i="4.24",a="next";function r(e){if(e.toLowerCase()===a)return a;var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}function l(e){return void 0===e&&(e=i),"https://js.arcgis.com/".concat(e,"/")}function s(e){void 0===e&&(e=i);var t=l(e),s=r(e);if(s!==a&&3===s.major){var n=s.minor<=10?"js/":"";return"".concat(t).concat(n,"esri/css/esri.css")}return"".concat(t,"esri/themes/light/main.css")}function n(e){var t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}function c(e,t){if(t){var i=document.querySelector(t);i.parentNode.insertBefore(e,i)}else document.head.appendChild(e)}function o(e){return document.querySelector('link[href*="'.concat(e,'"]'))}function d(e){return!e||r(e)?s(e):e}function u(e,t){var i=d(e),a=o(i);return a||c(a=n(i),t),a}var h={};function f(e){var t=document.createElement("script");return t.type="text/javascript",t.src=e,t.setAttribute("data-esri-loader","loading"),t}function g(e,t,i){var a;i&&(a=p(e,i));var r=function(){t(e),e.removeEventListener("load",r,!1),a&&e.removeEventListener("error",a,!1)};e.addEventListener("load",r,!1)}function p(e,t){var i=function(a){t(a.error||new Error("There was an error attempting to load ".concat(e.src))),e.removeEventListener("error",i,!1)};return e.addEventListener("error",i,!1),i}function m(e){void 0===e&&(e={}),h=e}function b(){return document.querySelector("script[data-esri-loader]")}function v(){var e=window.require;return e&&e.on}function y(e){void 0===e&&(e={});var i={};[h,e].forEach((function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t])}));var a=i.version,r=i.url||l(a);return new t.Promise((function(e,t){var l=b();if(l){var s=l.getAttribute("src");s!==r?t(new Error("The ArcGIS API for JavaScript is already loaded (".concat(s,")."))):v()?e(l):g(l,e,t)}else if(v())t(new Error("The ArcGIS API for JavaScript is already loaded."));else{var n=i.css;n&&u(!0===n?a:n,i.insertCssBefore),g(l=f(r),(function(){l.setAttribute("data-esri-loader","loaded"),e(l)}),t),document.body.appendChild(l)}}))}function w(e){return new t.Promise((function(t,i){var a=window.require.on("error",i);window.require(e,(function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];a.remove(),t(e)}))}))}function E(e,t){if(void 0===t&&(t={}),v())return w(e);var i=b(),a=i&&i.getAttribute("src");return!t.url&&a&&(t.url=a),y(t).then((function(){return w(e)}))}e.utils=t,e.loadModules=E,e.getScript=b,e.isLoaded=v,e.loadScript=y,e.setDefaultOptions=m,e.loadCss=u,Object.defineProperty(e,"__esModule",{value:!0})}(a);const s=async(e,t)=>(await l.exports.loadModules(e,t)).map((e=>e.__esModule&&e.default?e.default:e))}}]);