System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/widgets/Directions","esri/layers/RouteLayer","esri/rest/locator","jimu-core/react","jimu-theme"],(function(e,t){var o={},n={},i={},r={},a={},l={},s={},u={};return{setters:[function(e){o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.MutableStoreManager=e.MutableStoreManager,o.React=e.React,o.ReactRedux=e.ReactRedux,o.ServiceManager=e.ServiceManager,o.UtilityManager=e.UtilityManager,o.css=e.css,o.dataSourceUtils=e.dataSourceUtils,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.jsx=e.jsx},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.Alert=e.Alert,i.WidgetPlaceholder=e.WidgetPlaceholder,i.defaultMessages=e.defaultMessages},function(e){r.default=e.default},function(e){a.default=e.default},function(e){l.locationToAddress=e.locationToAddress},function(e){s.useEffect=e.useEffect},function(e){u.styled=e.styled}],execute:function(){e((()=>{var e={70326:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M1.414 10 10 1.414 18.586 10 10 18.586zm-.707.707a1 1 0 0 1 0-1.414L9.293.707a1 1 0 0 1 1.414 0l8.586 8.586a1 1 0 0 1 0 1.414l-8.586 8.586a1 1 0 0 1-1.414 0zm14.19-2.041-3.314 3.352a9 9 0 0 0-.398-1.126l2.918-2.832zM7.71 8H10V7H6v4h1V8.706l1.33 1.325C9.483 11.3 10 11.987 10 14.5v.5h1v-.5c.16-2.227-.537-3.43-1.948-5.16z" clip-rule="evenodd"></path></svg>'},41556:e=>{"use strict";e.exports=a},20320:e=>{"use strict";e.exports=l},92491:e=>{"use strict";e.exports=r},62686:e=>{"use strict";e.exports=n},79244:e=>{"use strict";e.exports=o},68972:e=>{"use strict";e.exports=s},1888:e=>{"use strict";e.exports=u},14321:e=>{"use strict";e.exports=i}},t={};function c(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,c),i.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var o in t)c.o(t,o)&&!c.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var d={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(d),c.d(d,{__set_webpack_public_path__:()=>O,default:()=>R});var e=c(79244),t=c(62686),o=c(14321),n=c(92491),i=c(41556),r=c(20320);const a={includeDefaultSources:!1,locationEnabled:!1,maxSuggestions:6};var l;function s(e){return`${e}_output_stop`}function u(e){return`${e}_output_direction_point`}function v(e){return`${e}_output_direction_line`}function g(e){return`${e}_output_route`}function f(){var t;return"english"===(null===(t=(0,e.getAppStore)().getState().user)||void 0===t?void 0:t.units)?l.Imperial:l.Metric}!function(e){e.Imperial="imperial",e.Metric="metric"}(l||(l={}));const p={_widgetLabel:"Directions",_action_DirectionsFrom_label:"Directions from",_action_DirectionsTo_label:"Directions to",_action_PlanRoute_label:"Plan route",outOfCredit:"Cannot load route service. This may be due to the service not being accessible.",namedInvalidUtilMsg:"{label} not available.",namedNeedLoginUtilMsg:"Sorry, you don't have permission to access {label}."};var m=c(70326),y=c.n(m),h=c(68972),S=c(1888),b=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{s(n.next(e))}catch(e){r(e)}}function l(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,l)}s((n=n.apply(e,t||[])).next())}))};const M=e.UtilityManager.getInstance(),w=S.styled.div`
  display: flex;
  .jimu-alert-panel {
    flex: 1;
    margin: 2px;
  }
`;function x(t){const{useUtilities:n}=t,[i,r]=e.React.useState(null),[a,l]=e.React.useState(null),s=e.hooks.useTranslation(p,o.defaultMessages),[u,c]=e.React.useState(!0),[d,v]=e.React.useState(!0),g=e.ReactRedux.useSelector((e=>e.resourceSessions));return(0,h.useEffect)((()=>{!function(){b(this,void 0,void 0,(function*(){const e=[],t=[];if(n)for(let o=0;o<n.length;o++){const i=M.getLabelOfUseUtility(n[o]),r=M.getUtilityJson(n[o].utilityId),{success:a,isSignInError:l}=yield M.checkUtilityStatus(r);a||(l?t.push(i):e.push(i))}const o=t.length>0?s("namedNeedLoginUtilMsg",{label:t.join(", ")}):null;o!==a&&l(o);const u=e.length>0?s("namedInvalidUtilMsg",{label:e.join(", ")}):null;u!==i&&r(u)}))}()}),[i,a,s,n,g,null==t?void 0:t.useUtilities]),e.React.createElement("div",{className:"util-alert-wrapper d-flex flex-column position-absolute w-100",style:{bottom:0}},i&&e.React.createElement(w,null,e.React.createElement(o.Alert,{closable:!0,form:"basic",onClose:()=>{v(!1)},open:d,text:i,withIcon:!0})),a&&e.React.createElement(w,null,e.React.createElement(o.Alert,{closable:!0,form:"basic",onClose:()=>{c(!1)},open:u,text:a,withIcon:!0})))}var _=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{s(n.next(e))}catch(e){r(e)}}function l(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,l)}s((n=n.apply(e,t||[])).next())}))};const{useEffect:I,useState:U,useRef:C,useCallback:D,useMemo:P}=e.React,R=l=>{var c,d;const{config:m,id:h}=l,{searchConfig:S,routeConfig:b}=m,M="dark"===(null===(c=l.theme)||void 0===c?void 0:c.sys.color.mode),w=null===(d=l.useMapWidgetIds)||void 0===d?void 0:d[0],[R,L]=U(null),O=C(null),[V,N]=U(Math.random()),$=C(null),H=C(null),J=C(null),z=e.hooks.useTranslation(p,o.defaultMessages),W=P((()=>z("findAddressOrPlace")),[z]),[B,G]=U(!1),q=e.ReactRedux.useSelector((e=>e.resourceSessions)),K=D((e=>{L(e)}),[]),Q=D((e=>_(void 0,void 0,void 0,(function*(){const t=S.dataConfig.map((e=>A(e.useUtility))).asMutable().map((t=>_(void 0,void 0,void 0,(function*(){return r.locationToAddress(t,{location:e})}))));let o=null;for(const e of t)try{const{address:t}=yield e;if(t){o=t;break}}catch(e){console.error(e)}if(!o){const{address:t}=yield r.locationToAddress("https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",{location:e});o=t}return o}))),[null==S?void 0:S.dataConfig]),X=D((()=>_(void 0,void 0,void 0,(function*(){if(B&&H.current&&l.mutableStateProps){const{directionsFromPoint:t,directionsToPoint:o,routeStops:n}=l.mutableStateProps;if(t){const o=yield Q(t);return H.current.layer.stops.at(0).geometry=t,H.current.layer.stops.at(0).name=o,void e.MutableStoreManager.getInstance().updateStateValue(l.widgetId,"directionsFromPoint",null)}if(o){const t=yield Q(o),n=H.current.layer.stops.length;return H.current.layer.stops.at(n-1).geometry=o,H.current.layer.stops.at(n-1).name=t,void e.MutableStoreManager.getInstance().updateStateValue(l.widgetId,"directionsToPoint",null)}if(n){const t=n,o=yield Promise.all(t.map((e=>_(void 0,void 0,void 0,(function*(){const t=yield Q(e);return{geometry:e,name:t}})))));return H.current.layer.stops.removeAll(),H.current.layer.stops.addMany(o),void e.MutableStoreManager.getInstance().updateStateValue(l.widgetId,"routeStops",null)}yield H.current.viewModel.load(),H.current.viewModel.layer.stops.filter((e=>null!==e.geometry)).length>=2&&(yield H.current.viewModel.getDirections())}}))),[Q,B,l.mutableStateProps,l.widgetId]);return I((()=>{!function(){var t,o;if(w&&(null==b?void 0:b.useUtility)&&(null===(t=null==S?void 0:S.dataConfig)||void 0===t?void 0:t.length)>0){const t=null===(o=(0,e.getAppStore)().getState().appConfig)||void 0===o?void 0:o.utilities,n=S.dataConfig.some((e=>!!e.useDataSource||t[e.useUtility.utilityId])),i=!!(t&&t[b.useUtility.utilityId]&&n);G(!(!b||!i))}else G(!1)}()}),[w,null==b?void 0:b.useUtility,null==S?void 0:S.dataConfig,b,null==l?void 0:l.useUtilities]),I((()=>{X()})),I((()=>{!function(){_(this,void 0,void 0,(function*(){var t;if(O.current===q||!(null==l?void 0:l.useUtilities))return;const o=O.current;O.current=q;const n=null===(t=null==l?void 0:l.useUtilities)||void 0===t?void 0:t.map((t=>{var o;return null===(o=e.UtilityManager.getInstance().getUtilityJson(t.utilityId))||void 0===o?void 0:o.url})),i=yield Promise.all(n.map((t=>e.ServiceManager.getInstance().fetchArcGISServerInfo(t)))),r=new Set;for(let e=0;e<n.length;e++)r.add(i[e].owningSystemUrl||n[e]);const a=[...r],s=Object.keys(q||{});for(const e of a){if(q[e]&&q[e]!==(null==o?void 0:o[e]))return void N(Math.random());for(const t of s)if(e.includes(t)&&q[t]!==(null==o?void 0:o[t]))return void N(Math.random())}}))}()}),[null==l?void 0:l.useUtilities,q]),I((()=>{function t(){var e,t,o;if(null===(t=null===(e=H.current)||void 0===e?void 0:e.view)||void 0===t?void 0:t.map){const e=H.current.view.map.findLayerById(h);e&&R.view.map.remove(e),H.current.destroy()}$.current&&($.current.innerHTML="");try{const e=null===(o=document.querySelector("calcite-panel.esri-save-layer"))||void 0===o?void 0:o.parentElement;e&&"CALCITE-POPOVER"===e.tagName.toUpperCase()&&document.body.removeChild(e)}catch(e){}}return B&&(null==R?void 0:R.view)&&$.current?function(){_(this,void 0,void 0,(function*(){var o,r,c;t();const d=A(null==b?void 0:b.useUtility),p=yield function(t,o){return _(this,void 0,void 0,(function*(){var n,i,r;const l=Object.assign({},a),s=(null===(n=null==t?void 0:t.generalConfig)||void 0===n?void 0:n.hint)||o;if(s&&(l.allPlaceholder=s),"number"==typeof(null===(i=null==t?void 0:t.suggestionConfig)||void 0===i?void 0:i.maxSuggestions)&&(l.maxSuggestions=t.suggestionConfig.maxSuggestions),"boolean"==typeof(null===(r=null==t?void 0:t.suggestionConfig)||void 0===r?void 0:r.isUseCurrentLoation)&&(l.locationEnabled=t.suggestionConfig.isUseCurrentLoation),Array.isArray(null==t?void 0:t.dataConfig)){const n=null==t?void 0:t.dataConfig.asMutable({deep:!0}).map((t=>_(this,void 0,void 0,(function*(){var n,i;if(t.useUtility){const e={url:A(t.useUtility),name:t.label,placeholder:t.hint||o,withinViewEnabled:null!==(n=t.searchInCurrentMapExtent)&&void 0!==n&&n};return t.enableCountryCode&&(e.countryCode=t.countryCode),Promise.resolve(e)}if(t.useDataSource){const n=yield e.DataSourceManager.getInstance().createDataSourceByUseDataSource(t.useDataSource),r=e.dataSourceUtils.getJSAPILayer(n);if(!r)return null;const a={layer:r,searchFields:t.searchFields.map((e=>e.name)),outFields:t.displayFields.map((e=>e.name)),suggestionTemplate:t.displayFields.map((e=>`{${e.name}}`)).join(", "),searchTemplate:t.displayFields.map((e=>`{${e.name}}`)).join(", "),name:t.label,placeholder:t.hint||o,withinViewEnabled:null!==(i=t.searchInCurrentMapExtent)&&void 0!==i&&i};return Promise.resolve(a)}}))));yield Promise.all(n).then((e=>{l.sources=e.filter((e=>!!e))}))}return Promise.resolve(l)}))}(S,W),y=document.createElement("div");y.className="directions-container",M&&(y.className+=" dark-theme"),$.current.innerHTML="",$.current.appendChild(y);const w=`${l.label} - ${z("route")}`,x=new i.default({id:h,url:d,title:w});"boolean"!=typeof m.showRuntimeLayers||m.showRuntimeLayers||(x.listMode="hide"),null===(r=null===(o=null==R?void 0:R.view)||void 0===o?void 0:o.map)||void 0===r||r.add(x),H.current=new n.default({id:h,layer:x,container:y,view:null==R?void 0:R.view,searchProperties:p,unit:null!==(c=null==m?void 0:m.unit)&&void 0!==c?c:f()}),H.current.viewModel.routeParameters.returnRoutes=!0,H.current.viewModel.routeParameters.returnDirections=!0,H.current.viewModel.routeParameters.returnStops=!0,X(),E(h),J.current=H.current.watch("lastRoute",(()=>{l.autoHeight&&($.current.style.maxHeight="750px"),H.current.lastRoute?function(t,o){_(this,void 0,void 0,(function*(){var n,i,r;try{const a=yield e.DataSourceManager.getInstance().createDataSource(s(t)),l=yield e.DataSourceManager.getInstance().createDataSource(g(t)),c=yield e.DataSourceManager.getInstance().createDataSource(u(t)),d=yield e.DataSourceManager.getInstance().createDataSource(v(t));yield k(a,"point",F(null===(n=o.stops)||void 0===n?void 0:n.toArray())),yield k(l,"polyline",F(o.routeInfo?[o.routeInfo]:[])),yield k(c,"point",F(null===(i=o.directionPoints)||void 0===i?void 0:i.toArray())),yield k(d,"polyline",F(null===(r=o.directionLines)||void 0===r?void 0:r.toArray())),T(a),T(l),T(c),T(d)}catch(e){console.log("Failed to create directions output data sources. ",e)}}))}(h,H.current.lastRoute):E(h)}))}))}():t(),()=>{var e;null===(e=J.current)||void 0===e||e.remove(),t()}}),[h,null==R?void 0:R.view,S,null==b?void 0:b.useUtility,W,B,M,l.autoHeight,X,V,l.label,z,null==m?void 0:m.showRuntimeLayers,null==m?void 0:m.unit]),(0,e.jsx)("div",{className:"widget-directions jimu-widget"},B?(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:w,onActiveViewChange:K}):(0,e.jsx)(o.WidgetPlaceholder,{widgetId:h,icon:y(),message:z("_widgetLabel")}),(0,e.jsx)("div",{ref:$,css:j}),(0,e.jsx)(x,{useUtilities:l.useUtilities}))},j=e.css`
  width: 100% !important;
  height: 100% !important;
  .directions-container{
    width: 100% !important;
    height: 100% !important;
    overflow: scroll;
    .esri-search{
      .esri-search__container{
        .esri-search__sources-button{
          z-index: 0;
          border-top: none;
          border-right: solid 1px var(--ref-palette-neutral-400);
          border-bottom: none;
          border-left: none;
          margin-right: 1px;
          margin-bottom: 2px;
        }
        .esri-search__input-container{
          margin: auto;
          .esri-search__clear-button{
            z-index: 0;
            right: 1px;
          }
        }
      }
      .esri-search--multiple-sources {
        .esri-search__sources-button {
          border-right: inherit;
        }
        .esri-search__input {
          border: 1px solid #959595;
        }
      }
    }
    .esri-directions__panel-content{
      padding: 0 0 20px 0;
      div[role='button'] {
        cursor: unset;
      }
    }
    .esri-directions__add-stop-button{
      --calcite-ui-text-1: var(--ref-palette-neutral-1200);
    }
    &.dark-theme img.esri-directions__maneuver-icon{
      filter: invert(100%);
    }
  }
`;function A(t){var o;return t?null===(o=e.UtilityManager.getInstance().getUtilityJson(t.utilityId))||void 0===o?void 0:o.url:null}function E(t){return _(this,void 0,void 0,(function*(){try{const o=yield e.DataSourceManager.getInstance().createDataSource(s(t)),n=yield e.DataSourceManager.getInstance().createDataSource(g(t)),i=yield e.DataSourceManager.getInstance().createDataSource(u(t)),r=yield e.DataSourceManager.getInstance().createDataSource(v(t));L(o),L(n),L(i),L(r)}catch(e){console.log("Failed to create directions output data sources. ",e)}}))}function L(t){t&&(t.setStatus(e.DataSourceStatus.NotReady),t.setCountStatus(e.DataSourceStatus.NotReady))}function T(t){t&&(t.setStatus(e.DataSourceStatus.Unloaded),t.setCountStatus(e.DataSourceStatus.Unloaded))}function k(e,t,o){return _(this,void 0,void 0,(function*(){e&&(yield e.setSourceFeatures(o,{id:e.id,geometryType:t}))}))}function F(e){return e?e.map((e=>null==e?void 0:e.toGraphic())).filter((e=>!!e)):[]}function O(e){c.p=e}})(),d})())}}}));