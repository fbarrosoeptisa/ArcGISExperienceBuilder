System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/utility-selector"],(function(e,t){var i={},n={},o={},r={};return{setters:[function(e){i.AllDataSourceTypes=e.AllDataSourceTypes,i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.React=e.React,i.SupportedUtilityType=e.SupportedUtilityType,i.UtilityManager=e.UtilityManager,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.getAppStore=e.getAppStore,i.hooks=e.hooks,i.jsx=e.jsx,i.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,i.lodash=e.lodash,i.polished=e.polished},function(e){n.Option=e.Option,n.Select=e.Select,n.Switch=e.Switch,n.defaultMessages=e.defaultMessages},function(e){o.MapWidgetSelector=e.MapWidgetSelector,o.SearchDataSetting=e.SearchDataSetting,o.SearchDataType=e.SearchDataType,o.SearchGeneralSetting=e.SearchGeneralSetting,o.SearchSuggestionSetting=e.SearchSuggestionSetting,o.SettingRow=e.SettingRow,o.SettingSection=e.SettingSection},function(e){r.UtilitySelector=e.UtilitySelector,r.addNewUtility=e.addNewUtility,r.extractService=e.extractService}],execute:function(){e((()=>{var e={31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=n},79298:e=>{"use strict";e.exports=o},71371:e=>{"use strict";e.exports=r}},t={};function l(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,l),o.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var i in t)l.o(t,i)&&!l.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var s={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(s),l.d(s,{__set_webpack_public_path__:()=>C,default:()=>I});var e=l(79244),t=l(14321),i=l(79298),n=l(71371),o=l(31027),r=l.n(o),a=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const u=t=>{const i=window.SVG,{className:n}=t,o=a(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return i?e.React.createElement(i,Object.assign({className:l,src:r()},o)):e.React.createElement("svg",Object.assign({className:l},o))},c={routeSettings:"Route Settings",searchSettings:"Search settings",generalSettings:"General settings",routeUrl:"Route URL",outputStops:"Stops",outputRoute:"Route",outputDirectionPoints:"Direction points",outputDirectionLines:"Direction lines",unitSystem:"Unit system"};var d;!function(e){e.Imperial="imperial",e.Metric="metric"}(d||(d={}));function g(e){return`${e}_output_stop`}function p(e){return`${e}_output_direction_point`}function f(e){return`${e}_output_direction_line`}function v(e){return`${e}_output_route`}function S(t){if(!t)return null;const i={};return t.forEach((t=>{i[t.name]=e.dataSourceUtils.convertFieldToJimuField(t,null)})),i}function y(){var t;return"english"===(null===(t=(0,e.getAppStore)().getState().user)||void 0===t?void 0:t.units)?d.Imperial:d.Metric}var m=function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function l(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,s)}a((n=n.apply(e,t||[])).next())}))};const{useMemo:h,useEffect:x,useState:b}=e.React,j={maxSuggestions:6},w=[e.SupportedUtilityType.Routing],I=o=>{var r,l,s,a,I;const{onSettingChange:C,id:O,config:M,useMapWidgetIds:T,useUtilities:_,portalUrl:R}=o,N=e.hooks.useTranslation(c,t.defaultMessages),P=null==M?void 0:M.routeConfig,F=null===(r=M.searchConfig)||void 0===r?void 0:r.dataConfig,A=null===(l=M.searchConfig)||void 0===l?void 0:l.generalConfig,G=h((()=>{var t;return(0,e.Immutable)(j).merge((null===(t=M.searchConfig)||void 0===t?void 0:t.suggestionConfig)||{})}),[null===(s=M.searchConfig)||void 0===s?void 0:s.suggestionConfig]),[E,L]=b(null),[W,$]=b(!1),k=h((()=>(null==T?void 0:T.length)>0),[T]),J=`${O}-desc`;return x((()=>{var t;const i=F&&function(e,t){return e.filter((e=>!!e.useDataSource||t.some((t=>{var i;return t.utilityId===(null===(i=null==e?void 0:e.useUtility)||void 0===i?void 0:i.utilityId)}))))}(F,_),n=P&&function(e,t){if(e&&e.useUtility&&t.some((t=>t.utilityId===e.useUtility.utilityId)))return e;return null}(P,_);e.lodash.isDeepEqual(i,F)&&e.lodash.isDeepEqual(n,P)||C({id:O,config:M.setIn(["searchConfig","dataConfig"],i).setIn(["routeConfig"],n),useUtilities:D(null==n?void 0:n.useUtility,null===(t=null==i?void 0:i.map((e=>e.useUtility)))||void 0===t?void 0:t.asMutable())})}),[M,O,C,P,F,_]),x((()=>{if(E)return;const t=function(t){var i;const o=null===(i=(0,e.getAppStore)().getState().portalSelf)||void 0===i?void 0:i.helperServices;return(0,n.extractService)(o,e.SupportedUtilityType.Routing,null,null,t)}(N);if(!t||0===t.length)return;const i=t[0];(0,n.addNewUtility)(i);const o=e.UtilityManager.getInstance().getIdOfOrgUtility(i.name,i.url,i.index,i.label);!E&&o&&L(o)}),[E,N]),x((()=>{var e,t,i;if(E&&!(null==M?void 0:M.routeConfig)&&!W){const n={utilityId:E};C({id:O,config:M.setIn(["routeConfig","useUtility"],n),useUtilities:D(n,null===(i=null===(t=null===(e=M.searchConfig)||void 0===e?void 0:e.dataConfig)||void 0===t?void 0:t.map((e=>e.useUtility)))||void 0===i?void 0:i.asMutable())}),$(!0)}}),[M,W,E,O,C,N]),(0,e.jsx)("div",{className:"widget-setting-directions jimu-widget-setting",css:U},(0,e.jsx)(i.SettingSection,{title:N("selectMapWidget"),className:(0,e.classNames)({"border-0":!k})},(0,e.jsx)(i.SettingRow,null,(0,e.jsx)(i.MapWidgetSelector,{onSelect:t=>m(void 0,void 0,void 0,(function*(){const i=yield function(t,i,n){return m(this,void 0,void 0,(function*(){var o,r,l,s;if(!i||0===i.length)return Promise.resolve([]);try{const[i,a,u,c]=yield(0,e.loadArcGISJSAPIModules)(["esri/rest/support/Stop","esri/rest/support/DirectionPoint","esri/rest/support/DirectionLine","esri/rest/support/RouteInfo"]);return[{id:g(t),label:n("outputStops"),type:e.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPoint",schema:{idField:(null===(o=i.fields.find((e=>"esriFieldTypeOID"===e.type)))||void 0===o?void 0:o.name)||"__OBJECTID",fields:Object.assign({},S(i.fields))}},{id:p(t),label:n("outputDirectionPoints"),type:e.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPoint",schema:{idField:(null===(r=a.fields.find((e=>"esriFieldTypeOID"===e.type)))||void 0===r?void 0:r.name)||"__OBJECTID",fields:Object.assign({},S(a.fields))}},{id:f(t),label:n("outputDirectionLines"),type:e.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPolyline",schema:{idField:(null===(l=u.fields.find((e=>"esriFieldTypeOID"===e.type)))||void 0===l?void 0:l.name)||"__OBJECTID",fields:Object.assign({},S(u.fields))}},{id:v(t),label:n("outputRoute"),type:e.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPolyline",schema:{idField:(null===(s=c.fields.find((e=>"esriFieldTypeOID"===e.type)))||void 0===s?void 0:s.name)||"__OBJECTID",fields:Object.assign({},S(c.fields))}}]}catch(e){return console.warn("Failed to create output data source in directions widget. ",e),Promise.resolve([])}}))}(O,t,N);C({id:O,useMapWidgetIds:t},i)})),useMapWidgetIds:T}))),k?(0,e.jsx)("div",null,(0,e.jsx)(i.SettingSection,{role:"group","aria-label":N("routeSettings"),title:N("routeSettings")},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:N("routeUrl")},(0,e.jsx)(n.UtilitySelector,{useUtilities:(0,e.Immutable)((null==P?void 0:P.useUtility)&&(null==_?void 0:_.some((e=>P.useUtility.utilityId===e.utilityId)))?[P.useUtility]:[]),onChange:e=>{var t,i,n,o,r;(null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.utilityId)!==(null===(i=null==P?void 0:P.useUtility)||void 0===i?void 0:i.utilityId)&&C({id:O,config:M.setIn(["routeConfig","useUtility"],null==e?void 0:e[0]),useUtilities:D(null==e?void 0:e[0],null===(r=null===(o=null===(n=M.searchConfig)||void 0===n?void 0:n.dataConfig)||void 0===o?void 0:o.map((e=>e.useUtility)))||void 0===r?void 0:r.asMutable())})},showRemove:!0,closePopupOnSelect:!0,types:w,"aria-describedby":J})),(0,e.jsx)(i.SettingRow,{className:"mt-0"},(0,e.jsx)("i",{className:"text-break example-url",id:J},N("exampleUrl",{url:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World"})))),(0,e.jsx)(i.SettingSection,{role:"group","aria-label":N("searchSettings"),title:N("searchSettings"),className:"search-settings"},(0,e.jsx)(i.SearchDataSetting,{id:O,datasourceConfig:F,createOutputDs:!1,portalUrl:R,searchDataSettingType:i.SearchDataType.Both,onSettingChange:t=>{var i;e.lodash.isDeepEqual(t,F)||C({id:O,config:M.setIn(["searchConfig","dataConfig"],t),useUtilities:D(null==P?void 0:P.useUtility,null===(i=null==t?void 0:t.filter((e=>!!e.useUtility)).map((e=>e.useUtility)))||void 0===i?void 0:i.asMutable())})},autoSelectAllOrgGeocodeService:!0,hideIconSetting:!0,hideEnableFiltering:!0,showSearchInCurrentMapExtentSetting:!0,supportedDsTypes:[e.AllDataSourceTypes.FeatureLayer],hideDs:t=>"esriGeometryPoint"!==e.DataSourceManager.getInstance().getDataSource(t.id).getGeometryType()}),(0,e.jsx)(i.SearchGeneralSetting,{id:O,hint:null==A?void 0:A.hint,onGeneralSettingChange:(t,i)=>{var n;if("string"==typeof i&&i!==(null==A?void 0:A.hint)){const o=((null===(n=M.searchConfig)||void 0===n?void 0:n.generalConfig)||(0,e.Immutable)({})).setIn(t,i);C({id:O,config:M.setIn(["searchConfig","generalConfig"],o)})}}}),(0,e.jsx)(i.SearchSuggestionSetting,{id:O,settingConfig:G,onSettingChange:t=>{e.lodash.isDeepEqual(t,G)||C({id:O,config:M.setIn(["searchConfig","suggestionConfig"],t)})},hideRecentSearchSetting:!0})),(0,e.jsx)(i.SettingSection,{role:"group","aria-label":N("generalSettings"),title:N("generalSettings"),className:"general-settings"},(0,e.jsx)(i.SettingRow,{flow:"wrap",tag:"label",label:N("unitSystem")},(0,e.jsx)(t.Select,{value:null!==(a=null==M?void 0:M.unit)&&void 0!==a?a:y(),onChange:e=>{const t=e.target.value;C({id:O,config:M.set("unit",t)})}},(0,e.jsx)(t.Option,{value:d.Metric},N("unitsLabelMetric")),(0,e.jsx)(t.Option,{value:d.Imperial},N("unitsLabelImperial")))),(0,e.jsx)(i.SettingRow,{tag:"label",label:N("showRuntimeLayers")},(0,e.jsx)(t.Switch,{checked:null===(I=null==M?void 0:M.showRuntimeLayers)||void 0===I||I,onChange:e=>{const t=e.target.checked;C({id:O,config:M.set("showRuntimeLayers",t)})}})))):(0,e.jsx)("div",{className:"d-flex justify-content-center align-items-center placeholder-container"},(0,e.jsx)("div",{className:"text-center"},(0,e.jsx)(u,{size:48,className:"d-inline-block placeholder-icon mb-2"}),(0,e.jsx)("p",{className:"placeholder-hint"},N("selectMapHint")))))},U=e.css`
.route-url-input{
  min-height: ${e.polished.rem(100)}
}
.example-url{
  font-size: ${e.polished.rem(12)};
  color: var(--ref-palette-neutral-1000);
}
.warning-icon{
  color: var(--sys-color-error-main);
}
.warning-hint{
  width: calc(100% - 20px);
  margin: 0 4px;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--sys-color-error-main);
}
.placeholder-container{
  height: calc(100% - 100px);
  .placeholder-hint{
    font-size: ${e.polished.rem(14)};
    font-weight: 500;
    color: var(--ref-palette-neutral-1000);
    max-width: ${e.polished.rem(160)};
  }
  .placeholder-icon{
    color: var(--ref-palette-neutral-800);
  }
}
.search-settings{
  >div>div {
    padding-left: 0 !important;
    padding-right: 0 !important;
    padding-top: 0 !important;
    border: 0 !important;
  }
}
`;function D(e,t){return[e].concat(t).filter((e=>!!e))}function C(e){l.p=e}})(),s})())}}}));