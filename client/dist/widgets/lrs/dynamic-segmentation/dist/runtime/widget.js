/*! For license information please see widget.js.LICENSE.txt */
System.register(["jimu-core","jimu-ui","jimu-arcgis","esri/layers/GraphicsLayer","widgets/shared-code/lrs","calcite-components","jimu-theme","esri/Graphic","jimu-core/react","esri/widgets/FeatureForm","esri/form/FormTemplate","esri/form/elements/FieldElement","esri/form/elements/inputs/DateTimePickerInput","esri/layers/FeatureLayer"],(function(e,t){var n={},a={},i={},r={},o={},s={},l={},c={},u={},d={},f={},p={},m={},g={};return{setters:[function(e){n.DataActionManager=e.DataActionManager,n.DataLevel=e.DataLevel,n.DataSourceManager=e.DataSourceManager,n.DataSourceStatus=e.DataSourceStatus,n.DataSourceTypes=e.DataSourceTypes,n.Immutable=e.Immutable,n.JimuFieldType=e.JimuFieldType,n.React=e.React,n.SessionManager=e.SessionManager,n.WidgetState=e.WidgetState,n.classNames=e.classNames,n.css=e.css,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.jsx=e.jsx,n.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,n.polished=e.polished,n.utils=e.utils},function(e){a.AdvancedSelect=e.AdvancedSelect,a.Button=e.Button,a.Dropdown=e.Dropdown,a.DropdownButton=e.DropdownButton,a.DropdownItem=e.DropdownItem,a.DropdownMenu=e.DropdownMenu,a.Icon=e.Icon,a.Label=e.Label,a.Loading=e.Loading,a.Modal=e.Modal,a.ModalBody=e.ModalBody,a.ModalHeader=e.ModalHeader,a.NumericInput=e.NumericInput,a.Select=e.Select,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.WidgetPlaceholder=e.WidgetPlaceholder,a.defaultMessages=e.defaultMessages},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent,i.MapViewManager=e.MapViewManager,i.geometryUtils=e.geometryUtils},function(e){r.default=e.default},function(e){o.GetUnits=e.GetUnits,o.LockAcquireStatus=e.LockAcquireStatus,o.LockAction=e.LockAction,o.LrsApplyEdits=e.LrsApplyEdits,o.QueryLock=e.QueryLock,o.acquireLock=e.acquireLock,o.atOrBetween=e.atOrBetween,o.createFeatureLayer=e.createFeatureLayer,o.createField=e.createField,o.fetchEnterpriseContingentValues=e.fetchEnterpriseContingentValues,o.fetchEnterpriseFieldGroup=e.fetchEnterpriseFieldGroup,o.fieldsWithContingentValues=e.fieldsWithContingentValues,o.findFieldByName=e.findFieldByName,o.findFieldByType=e.findFieldByType,o.formatMessage=e.formatMessage,o.getCalciteBasicTheme=e.getCalciteBasicTheme,o.getCalciteNoticeTheme=e.getCalciteNoticeTheme,o.getContingentOptions=e.getContingentOptions,o.getExistingFieldNames=e.getExistingFieldNames,o.getGDBVersion=e.getGDBVersion,o.getGeometryGraphic=e.getGeometryGraphic,o.getLayer=e.getLayer,o.getMapAllLayers=e.getMapAllLayers,o.isCodedDomain=e.isCodedDomain,o.isConflictPreventionEnabled=e.isConflictPreventionEnabled,o.isDate=e.isDate,o.isDefined=e.isDefined,o.isInWidgetController=e.isInWidgetController,o.isNumber=e.isNumber,o.isRangeDomain=e.isRangeDomain,o.isWithinTolerance=e.isWithinTolerance,o.normalizeFieldName=e.normalizeFieldName,o.queryRouteIdOrName=e.queryRouteIdOrName,o.requestService=e.requestService,o.resolveFieldName=e.resolveFieldName,o.setContingentValues=e.setContingentValues,o.shouldTryAcquireLock=e.shouldTryAcquireLock,o.tryAutoReconcile=e.tryAutoReconcile,o.validateContingencyConstraints=e.validateContingencyConstraints,o.validateField=e.validateField,o.validateRangeDomain=e.validateRangeDomain},function(e){s.CalciteAction=e.CalciteAction,s.CalciteActionBar=e.CalciteActionBar,s.CalciteActionGroup=e.CalciteActionGroup,s.CalciteButton=e.CalciteButton,s.CalciteIcon=e.CalciteIcon,s.CalciteInputDatePicker=e.CalciteInputDatePicker,s.CalciteNotice=e.CalciteNotice,s.CalciteOption=e.CalciteOption,s.CalcitePanel=e.CalcitePanel,s.CalcitePopover=e.CalcitePopover,s.CalciteSelect=e.CalciteSelect,s.CalciteTable=e.CalciteTable,s.CalciteTableCell=e.CalciteTableCell,s.CalciteTableHeader=e.CalciteTableHeader,s.CalciteTableRow=e.CalciteTableRow},function(e){l.getTheme=e.getTheme,l.useTheme=e.useTheme},function(e){c.default=e.default},function(e){u.default=e.default},function(e){d.default=e.default},function(e){f.default=e.default},function(e){p.default=e.default},function(e){m.default=e.default},function(e){g.default=e.default}],execute:function(){e((()=>{var e={38252:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M2 1h16a1 1 0 0 1 1 1v5H1V2a1 1 0 0 1 1-1m11 7H7v3h6zm0 4H7v3h6zm1 3v-3h5v3zm-1 1H7v3h6zm1 3h4a1 1 0 0 0 1-1v-2h-5zm0-8V8h5v3zM1 8h5v3H1zm0 4h5v3H1zm0 4h5v3H2a1 1 0 0 1-1-1zM0 2a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2z" clip-rule="evenodd"></path></svg>'},46420:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.973 11.484c0 .285.236.516.527.516a.52.52 0 0 0 .527-.516V1.976L10.6 4.473c.206.202.54.202.746 0a.51.51 0 0 0 0-.73L7.5 0 3.654 3.743a.51.51 0 0 0 0 .73c.206.202.54.202.746 0l2.573-2.497zM1 8v7h13V8h1v8H0V8z" clip-rule="evenodd"></path></svg>'},49419:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M16 0H0v1h16z"></path><path fill="#000" fill-rule="evenodd" d="M5 11a3 3 0 1 0 6 0 3 3 0 0 0-6 0m3 2a2 2 0 1 0 0-4 2 2 0 0 0 0 4" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M8 6q3.874 0 7.75 4.349a.97.97 0 0 1 0 1.302Q11.874 16.001 8 16T.25 11.651a.97.97 0 0 1 0-1.302Q4.126 5.999 8 6m0 1c-2.237 0-4.558 1.303-6.961 4 2.403 2.698 4.724 4 6.96 4 2.238 0 4.559-1.303 6.962-4C12.558 8.303 10.237 7 8 7" clip-rule="evenodd"></path><path fill="#000" d="M0 3h13v1H0zM3 6H0v1h3z"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},99037:e=>{"use strict";e.exports=s},22089:e=>{"use strict";e.exports=c},38410:e=>{"use strict";e.exports=f},82228:e=>{"use strict";e.exports=p},44927:e=>{"use strict";e.exports=m},85633:e=>{"use strict";e.exports=g},59620:e=>{"use strict";e.exports=r},73387:e=>{"use strict";e.exports=d},62686:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=n},68972:e=>{"use strict";e.exports=u},1888:e=>{"use strict";e.exports=l},14321:e=>{"use strict";e.exports=a},47626:e=>{"use strict";e.exports=o},46942:(e,t)=>{var n;!function(){"use strict";var a={}.hasOwnProperty;function i(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=o(e,r(n)))}return e}function r(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return i.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)a.call(e,n)&&e[n]&&(t=o(t,n));return t}function o(e,t){return t?e?e+" "+t:e+t:e}e.exports?(i.default=i,e.exports=i):void 0===(n=function(){return i}.apply(t,[]))||(e.exports=n)}()}},t={};function h(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,h),i.exports}h.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return h.d(t,{a:t}),t},h.d=(e,t)=>{for(var n in t)h.o(t,n)&&!h.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},h.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),h.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},h.p="";var y={};return h.p=window.jimuConfig.baseUrl,(()=>{"use strict";h.r(y),h.d(y,{__set_webpack_public_path__:()=>ta,default:()=>ea});var e=h(79244);const t={_widgetLabel:"Dynamic Segmentation",_action_dynSeg_label:"Dynamic Segmentation",measureRange:"Measure Range",routeIdLabel:"Route ID: {routeId}",routeNameLabel:"Route Name: {routeName}",dateLabel:"View Date: {date} ",measureRangeNoValue:"Measure Range:",measureRangeValue:"Measure Range: {fromM} - {toM} {units} ",measuresRange:"{fromM}   -   {toM}",saveSuccess:"Success",saveError:"Error",saveSuccessMessage:"Successfully edited {editCount} event records",saveEdits:"Save",navStart:"Navigate to start",navEnd:"Navigate to end",navBack:"Navigate back",navForward:"Navigate forward",diagramLabel:"Diagram",tableLabel:"Table",editableFields:"Editable Fields",nonEditableFields:"Non-Editable Fields",applyLabel:"Apply",exportLabel:"Export",exportGeoJson:"Export to GeoJSON",exportJson:"Export to JSON",exportCsv:"Export to CSV",selectLayers:"Select Layers",selectFields:"Select Fields",fieldCalculatorLabel:"Field Calculator",updateField:"Update Field",fieldValue:"Field Value",update:"Update",eventLayer:"Event Layer",discardEdits:"Discard Edits",showFields:"Show Fields",dynamicSeg:"Dynamic Segmentation",historicalFirstLabel:"Historical First",historicalLastLabel:"Historical Last",historicalMinimumLabel:"Minimum",historicalMaximumLabel:"Maximum",meanLabel:"Mean",medianLabel:"Median",tableLabelDisabled:"Table: Save/Discard edits to switch",diagramLabelDisabled:"Diagram: Save/Discard edits to switch",applyEditTitle:"Apply Edits",applyEditMessage:"Edits made have not been applied. Would you like to discard or apply these changes?",sldEditSuccessful:"Changes applied successfully.",editFieldSuccess:"Field updated successfully",dataActionMessage:"Use data actions to generate dynamic segmentation",routeDoesNotExist:"Route does not exist in selected view date",errorLoadingRecords:"Error loading records",noResults:"No results for selected route",queryAttributeSetError:"Error performing dynamic segmentation"};var n,a,i,r=h(14321),o=h(38252),s=h.n(o),l=h(62686),c=h(59620),u=h(47626);!function(e){e.Table="Table",e.Diagram="Diagram"}(n||(n={})),function(e){e.LineOnly="LineOnly",e.LineAndPoint="LineAndPoint"}(a||(a={})),function(e){e.Point="Point",e.Line="Line",e.Undefined="Undefined"}(i||(i={}));const d={pendingEdits:new Map,records:[],originalRecords:[],selectedRecordIds:[],fieldInfo:[],errorCount:0,isLoading:!1,display:n.Table,routeInfo:{networkInfo:void 0,fromMeasure:0,toMeasure:0},jimuMapView:void 0,highlightLayer:null,highlightColor:"#65adff",selectedSldId:"",outputDataSources:[]},f=(e,t)=>{switch(t.type){case"SET_EDITS":return Object.assign(Object.assign({},e),{pendingEdits:t.value});case"SET_RECORDS":return Object.assign(Object.assign({},e),{records:t.value});case"SET_ORIGINAL_RECORDS":return Object.assign(Object.assign({},e),{originalRecords:t.value});case"SET_SELECTED_RECORD_IDS":return Object.assign(Object.assign({},e),{selectedRecordIds:t.value});case"SET_FIELD_INFO":return Object.assign(Object.assign({},e),{fieldInfo:t.value});case"SET_ERROR_COUNT":return Object.assign(Object.assign({},e),{errorCount:t.value});case"SET_IS_LOADING":return Object.assign(Object.assign({},e),{isLoading:t.value});case"SET_DISPLAY":return Object.assign(Object.assign({},e),{display:t.value});case"SET_ROUTE_INFO":return Object.assign(Object.assign({},e),{routeInfo:t.value});case"SET_JIMU_MAP_VIEW":return Object.assign(Object.assign({},e),{jimuMapView:t.value});case"SET_HIGHLIGHT_LAYER":return Object.assign(Object.assign({},e),{highlightLayer:t.value});case"SET_HIGHLIGHT_COLOR":return Object.assign(Object.assign({},e),{highlightColor:t.value});case"SET_SELECTED_SLD_ID":return Object.assign(Object.assign({},e),{selectedSldId:t.value});case"SET_OUTPUT_DATA_SOURCES":return Object.assign(Object.assign({},e),{outputDataSources:t.value});case"RESET_STATE":return Object.assign(Object.assign({},d),{isLoading:!0,display:e.display,jimuMapView:e.jimuMapView,highlightLayer:e.highlightLayer,highlightColor:e.highlightColor,outputDataSources:e.outputDataSources});default:return e}},p=e.React.createContext(void 0),m=e.React.createContext(void 0),g=t=>{const{defaultState:n,children:a}=t,[i,r]=e.React.useReducer(f,n||d);return e.React.createElement(p.Provider,{value:i},e.React.createElement(m.Provider,{value:r},a))},v=()=>e.React.useContext(p),b=()=>e.React.useContext(m);function x(t){const{isLoading:n}=t;return(0,e.jsx)("div",null,n&&(0,e.jsx)("div",{className:"d-flex h-100 w-100",style:{position:"absolute"}},(0,e.jsx)("div",{style:{height:"80px",position:"relative",width:"200px",margin:"auto"}},(0,e.jsx)(r.Loading,null))))}const S={routeIdName:"route_id",routeIdAlias:"Route ID",fromDateName:"from_date",fromDateAlias:"From Date",toDateName:"to_date",toDateAlias:"To Date",fromMeasureName:"from_measure",fromMeasureAlias:"From Measure",toMeasureName:"to_measure",toMeasureAlias:"To Measure",objectId:"OBJECTID",typeName:"type",typeAlias:"Type"},w=45,I=25,D=24;var N=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function k(e,t,n,a){return N(this,void 0,void 0,(function*(){if(!(0,u.isDefined)(e)||!(0,u.isDefined)(t)||!(0,u.isDefined)(a))return null;const i=yield function(e,t,n){return N(this,void 0,void 0,(function*(){const a=[],i=(0,u.getExistingFieldNames)(),r=t.find((t=>(0,u.isDefined)(t.networkInfo)&&t.networkInfo.datasetName===e.datasetName));return yield(0,u.getLayer)(r.useDataSource).then((e=>N(this,void 0,void 0,(function*(){const r=(0,u.findFieldByType)(e.fields,"oid");(0,u.isDefined)(r)&&(i.push(r.name.toUpperCase()),a.push(r));const o=(0,u.findFieldByType)(e.fields,"geometry");(0,u.isDefined)(o)&&(i.push(o.name.toUpperCase()),a.push(o));const s=yield(0,u.createField)(S.routeIdName,S.routeIdAlias,"string",!0);i.push(s.name.toUpperCase()),a.push(s);const l=yield(0,u.createField)(S.fromDateName,S.fromDateAlias,"date",!0);i.push(l.name.toUpperCase()),a.push(l);const c=yield(0,u.createField)(S.toDateName,S.toDateAlias,"date",!0);i.push(c.name.toUpperCase()),a.push(c);const d=yield(0,u.createField)(S.fromMeasureName,S.fromMeasureAlias,"double",!0);i.push(d.name.toUpperCase()),a.push(d);const f=yield(0,u.createField)(S.toMeasureName,S.toMeasureAlias,"double",!0);i.push(f.name.toUpperCase()),a.push(f);const p=yield(0,u.createField)(S.typeName,S.typeAlias,"string",!0);return i.push(p.name.toUpperCase()),a.push(p),n.forEach((e=>N(this,void 0,void 0,(function*(){const n=t.find((t=>t.serviceId.toString()===e.layerId));yield(0,u.getLayer)(n.useDataSource).then((t=>N(this,void 0,void 0,(function*(){e.fields.forEach((e=>{const r=(0,u.findFieldByName)(t.fields,e);if((0,u.isDefined)(r)){const t=(0,u.resolveFieldName)(i,r.name);r.name=t,r.alias=n.eventInfo.datasetName+"."+e,r.nullable=!0,r.defaultValue=null,"oid"===r.type&&(r.type="integer",r.editable=!0),i.push(t.toUpperCase()),a.push(r)}}))}))))})))),a})))).catch((()=>[]))}))}(e,t,n);return yield(0,u.createFeatureLayer)(i,"polyline","hide",a,"dynamic-segmentation")}))}function E(e,t){return N(this,void 0,void 0,(function*(){const n=[];return yield Promise.all(t.map((t=>N(this,void 0,void 0,(function*(){const a=e.find((e=>e.serviceId.toString()===t.layerId));(0,u.isDefined)(a)&&(yield(0,u.getLayer)(a.useDataSource).then((e=>N(this,void 0,void 0,(function*(){(0,u.isDefined)(e.subtypes)&&n.push({id:a.serviceId.toString(),subtypes:e.subtypes,subtypeField:e.subtypeField})})))))}))))),n}))}const L=(e,t,n)=>N(void 0,void 0,void 0,(function*(){const a=n.message,i=a.substring(a.indexOf("field: "),a.length),r=i.substring(0,i.indexOf(",")),o=r.substring(7,r.length);return t.attributes[o]=null,yield e.applyEdits({addFeatures:[t.clone()]}).then((e=>e.addFeatureResults.length>0?e.addFeatureResults[0].error:null)).catch((e=>(console.error("Failed to add feature",e),null)))})),R=(e,t)=>{const n=e.view.map.layers.length-1;e.view.map.layers.findIndex((e=>e===t))!==n&&e.view.map.reorder(t,e.view.map.layers.length-1)};var j=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function M(t,n,a){const i=[],r=e.DataSourceManager.getInstance(),o=t.networkInfo.lrsNetworkId;return a&&a.layers.forEach((e=>{var t;const a=n.find((t=>t.serviceId===e.layerId));if((0,u.isDefined)(a)){const n=null===(t=null==a?void 0:a.eventInfo)||void 0===t?void 0:t.parentNetworkId;if(o===n){const t={layerId:e.layerId.toString(),fields:[]};e.fields.forEach((e=>{t.fields.push(e.name)})),t.fields.push(a.eventInfo.eventIdFieldName);const n=r.getDataSource(a.useDataSource.dataSourceId);t.fields.push(n.getIdField()),i.push(t)}}})),i}function T(t,n,a,i){return j(this,void 0,void 0,(function*(){if(!n.routeId.length)return null;const r=n.networkInfo.networkUrl,o=`${r}/queryAttributeSet`,s=yield e.SessionManager.getInstance().getSessionByUrl(r).getToken(r),l=function(e){const t=[];if(e.routeId){const n={routeId:e.routeId};(0,u.isDefined)(e.fromMeasure)&&!isNaN(e.fromMeasure)&&(n.fromMeasure=e.fromMeasure),(0,u.isDefined)(e.toMeasure)&&!isNaN(e.toMeasure)&&(n.toMeasure=e.toMeasure),t.push(n)}return t}(n);let c=t.getGDBVersion();c||(c="");const d=[a.getTime(),a.getTime()],f={f:"json",token:s,locations:l,attributeSet:i,temporalViewDate:JSON.stringify(d),gdbVersion:c};return(0,u.requestService)({method:"POST",url:o,params:f}).then((e=>j(this,void 0,void 0,(function*(){return e||null}))))}))}var F=h(99037),C=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function A(n){const{allowMerge:a,lrsLayers:i,networkDS:o,networkInfo:s,onSave:l}=n,{pendingEdits:c,errorCount:d}=v(),f=e.hooks.useTranslation(t),p=b(),m=e.React.useMemo((()=>c.size>0&&0===d),[d,c]),g=(t,n,a)=>(0,u.getLayer)(t.useDataSource).then((i=>C(this,void 0,void 0,(function*(){const r={},o=t.eventInfo;if(n.attributes.forEach(((t,n)=>{switch(n){case S.routeIdName:r[o.routeIdFieldName]=t;break;case S.fromDateName:r[o.fromDateFieldName]=t;break;case S.toDateName:r[o.toDateFieldName]=t;break;case S.fromMeasureName:r[o.fromMeasureFieldName]=t;break;case S.toMeasureName:o.isPointEvent||(r[o.toMeasureFieldName]=t);break;case o.eventIdFieldName:(0,u.isDefined)(t)?r[n]=t:r[n]="{"+e.utils.getUUID()+"}";break;default:r[n]=t}})),o.fromReferentMethodFieldName){const e=i.fields.find((e=>e.name===o.fromReferentMethodFieldName));if((0,u.isDefined)(e)&&(0,u.isDefined)(e.domain)&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.name===a));t&&(r[o.fromReferentMethodFieldName]=t.code)}}if(o.fromReferentLocationFieldName&&(r[o.fromReferentLocationFieldName]=r[o.routeIdFieldName]),o.fromReferentOffsetFieldName){const e=r[o.fromMeasureFieldName];r[o.fromReferentOffsetFieldName]=(0,u.isDefined)(e)?e.toString():null}if(o.toReferentMethodFieldName){const e=i.fields.find((e=>e.name===o.toReferentMethodFieldName));if((0,u.isDefined)(e)&&(0,u.isDefined)(e.domain)&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.name===a));t&&(r[o.toReferentMethodFieldName]=t.code)}}if(o.toReferentLocationFieldName&&(r[o.toReferentLocationFieldName]=r[o.routeIdFieldName]),o.toReferentOffsetFieldName){const e=r[o.toMeasureFieldName];r[o.toReferentOffsetFieldName]=(0,u.isDefined)(e)?e.toString():null}return r}))));return(0,e.jsx)(r.Tooltip,{placement:"auto",title:f("saveEdits"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)(F.CalciteAction,{text:f("saveEdits"),icon:"save",scale:"m",disabled:!m||void 0,onClick:()=>C(this,void 0,void 0,(function*(){const e={edits:[]};let t=o.getGDBVersion();t||(t="");const n=[];c.forEach((e=>{n.push(e)}));let r="";Promise.all(n.map(((t,n)=>C(this,void 0,void 0,(function*(){const n=i.find((e=>e.serviceId.toString()===t.layerId));""===r&&(r=n.lrsUrl);const o=[],l={attributes:yield g(n,t,s.datasetName)};o.push(l);const c={id:n.serviceId,adds:o,allowMerge:a,retireMeasureOverlap:!0,retireByEventId:!1};e.edits.push(c)}))))).then((()=>C(this,void 0,void 0,(function*(){yield(0,u.LrsApplyEdits)(r,e,t).then((e=>C(this,void 0,void 0,(function*(){if(e.success){const e=c.size;p({type:"SET_EDITS",value:new Map});const t={title:f("saveSuccess"),body:f("saveSuccessMessage",{editCount:e}),type:"success"};l(t)}else{const t={title:f("saveError"),body:e.message,details:e.details,type:"danger"};l(t)}}))))}))))}))}))}var O=h(1888);function P(){const a=e.hooks.useTranslation(t),i=(0,O.getTheme)(),{display:o,records:s,pendingEdits:l}=v(),c=b(),d=e=>{if((0,u.isDefined)(l)&&l.size>0){if(o===n.Diagram&&e===n.Table)return!0;if(o===n.Table&&e===n.Diagram)return!0}return!1};return(0,e.jsx)(F.CalciteActionGroup,{scale:"m"},(0,e.jsx)(r.Tooltip,{placement:"auto",title:d(n.Table)?a("tableLabelDisabled"):a("tableLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)(F.CalciteAction,{text:a("tableLabel"),icon:"table",scale:"m",indicator:o===n.Table||void 0,disabled:!!d(n.Table)||void 0,css:e.css`--calcite-action-indicator-color: ${i.sys.color.primary.main};`,onClick:()=>{o!==n.Table&&(c({type:"SET_DISPLAY",value:n.Table}),s.length>0&&c({type:"SET_IS_LOADING",value:!0}))}})),(0,e.jsx)(r.Tooltip,{placement:"auto",title:d(n.Diagram)?a("diagramLabelDisabled"):a("diagramLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)(F.CalciteAction,{text:a("diagramLabel"),icon:"graph-bar",scale:"m",indicator:o===n.Diagram||void 0,disabled:!!d(n.Diagram)||void 0,css:e.css`--calcite-action-indicator-color: ${i.sys.color.primary.main};`,onClick:()=>{o!==n.Diagram&&(c({type:"SET_DISPLAY",value:n.Diagram}),s.length>0&&c({type:"SET_IS_LOADING",value:!0}))}})))}var _=h(22089),V=h(68972),$=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function B(n){const a=e.hooks.useTranslation(t),{records:i,selectedRecordIds:o,display:s}=v(),{jimuMapView:c,networkDS:u}=n,[d,f]=V.default.useState(!1);V.default.useEffect((()=>{0===o.length?f(!1):f(!0)}),[o,s]);return(0,e.jsx)(r.Tooltip,{placement:"auto",title:a("ZoomLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)(F.CalciteAction,{text:a("ZoomLabel"),icon:"zoom-to-object",scale:"m",onClick:()=>$(this,void 0,void 0,(function*(){const t=yield(0,e.loadArcGISJSAPIModule)("esri/geometry/operators/unionOperator"),n=[],a=u.layerDefinition.objectIdField;o&&o.length>0&&i.forEach((e=>{const t=null==e?void 0:e.attributes[a];o.includes(t)&&n.push(e.geometry)}));const r=t.executeMany(n);l.geometryUtils.projectToSpatialReference([r],c.view.spatialReference).then((e=>{var t;const n=new _.default({geometry:e[0]});if("point"===(null===(t=null==n?void 0:n.geometry)||void 0===t?void 0:t.type))null==c||c.view.goTo({target:e,zoom:100});else{const e=n.geometry.extent.expand(1.25);null==c||c.view.goTo({center:e})}}))})),disabled:!d||void 0}))}var G=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const z=["long","big-integer","integer","single","double","small-integer"],H=["global-id","guid","string"];function W(n){const{dynSegFeatureLayer:a,widgetId:i,routeId:o,jimuMapView:s}=n,l=e.hooks.useTranslation(t),{records:c,display:d}=v(),[f,p]=e.React.useState(!1);e.React.useEffect((()=>{0===(null==c?void 0:c.length)?p(!1):p(!0)}),[c,d]);const m=t=>{let n;return z.includes(t.type)?n=e.JimuFieldType.Number:"date"===t.type?n=e.JimuFieldType.Date:H.includes(t.type)&&(n=e.JimuFieldType.String),n?{jimuName:t.name,name:t.name,type:n,esriType:t.type,alias:t.alias,format:"oid"===t.type?{digitSeparator:!1,places:0}:null}:null},g=e=>{if(!e)return null;const t={};return e.forEach((e=>{const n=m(e);n&&n.name&&(t[e.name]=n)})),t},h=()=>{const e=g(a.fields);return Object.keys(e)},y=()=>{const e=(e=>{if(!e)return null;const t={};return e.forEach((e=>{const n=m(e);n&&n.name&&(t[e.alias]=n)})),t})(a.fields);return Object.keys(e)};return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(r.Dropdown,{className:"float-right",direction:"down",size:"sm",useKeyUpEvent:!0},(0,e.jsx)(r.DropdownButton,{icon:!0,arrow:!1,size:"sm",type:"link"},(0,e.jsx)(r.Tooltip,{placement:"auto",title:l("exportLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)(F.CalciteAction,{text:l("exportLabel"),icon:"export",scale:"m",disabled:!f||void 0}))),(0,e.jsx)(r.DropdownMenu,null,(0,e.jsx)(r.DropdownItem,{onClick:()=>{e.DataSourceManager.getInstance().createDataSource((0,e.Immutable)({id:"downloadCsv_layer"+(new Date).getTime(),type:e.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,sourceLabel:o+"_dynseg_export",schema:{idField:(0,u.findFieldByType)(a.fields,"oid"),fields:Object.assign({},g(a.fields))},geometryType:"esriGeometryPolyline"})).then((t=>{const n=[];c.forEach((e=>{const a=t.buildRecord(e);n.push(a)}));const a={records:n,dataSource:t,name:l("dynamicSeg"),fields:h()};e.DataActionManager.getInstance().getSupportedActions(i,[a],e.DataLevel.Records).then((t=>G(this,void 0,void 0,(function*(){const n=t.export;if((null==n?void 0:n.length)>0){const t=n.filter((e=>"export-csv"===e.id));yield e.DataActionManager.getInstance().executeDataAction(t[0],[a],e.DataLevel.Records,i)}})))).catch((e=>{console.error(e)}))}))}},l("exportCsv")),(0,e.jsx)(r.DropdownItem,{onClick:()=>{e.DataSourceManager.getInstance().createDataSource((0,e.Immutable)({id:"downloadJson_layer"+(new Date).getTime(),type:e.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,sourceLabel:o+"_dynseg_export",schema:{idField:(0,u.findFieldByType)(a.fields,"oid"),fields:Object.assign({},g(a.fields))},geometryType:"esriGeometryPolyline"})).then((t=>{const n=[],r=(()=>{const e=a.fields,t={};return e.forEach((e=>{t[e.name]=e.alias})),t})();c.forEach((e=>{const a=e.clone(),i=a.attributes;Object.keys(i).forEach((e=>{const t=r[e];i[t]=i[e],delete i.key}));const o=t.buildRecord(a);n.push(o)}));const o={records:n,dataSource:t,name:l("dynamicSeg"),fields:y()};e.DataActionManager.getInstance().getSupportedActions(i,[o],e.DataLevel.Records).then((t=>G(this,void 0,void 0,(function*(){const n=t.export;if((null==n?void 0:n.length)>0){const t=n.filter((e=>"export-json"===e.id));yield e.DataActionManager.getInstance().executeDataAction(t[0],[o],e.DataLevel.Records,i)}})))).catch((e=>{console.error(e)}))}))}},l("exportJson")),(0,e.jsx)(r.DropdownItem,{onClick:()=>{e.DataSourceManager.getInstance().createDataSource((0,e.Immutable)({id:"downloadGeoJson_layer"+(new Date).getTime(),type:e.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,sourceLabel:o+"_dynseg_export",schema:{idField:(0,u.findFieldByType)(a.fields,"oid"),fields:Object.assign({},g(a.fields))},geometryType:"esriGeometryPolyline"})).then((t=>G(this,void 0,void 0,(function*(){const n=[],a=c,r=s.view.spatialReference,o=yield(0,e.loadArcGISJSAPIModule)("esri/geometry/projection");o.load().then((()=>{a.forEach((e=>{"Point"===e.attributes[S.typeName]&&(e.geometry=null)})),a.forEach((e=>{e.geometry&&(e.geometry=o.project(e.geometry,r))})),a.forEach((e=>{const a=t.buildRecord(e);n.push(a)}));const s={records:n,dataSource:t,name:l("dynamicSeg"),fields:h()};e.DataActionManager.getInstance().getSupportedActions(i,[s],e.DataLevel.Records).then((t=>G(this,void 0,void 0,(function*(){const n=t.export;if((null==n?void 0:n.length)>0){const t=n.filter((e=>"export-geojson"===e.id));yield e.DataActionManager.getInstance().executeDataAction(t[0],[s],e.DataLevel.Records,i)}})))).catch((e=>{console.error(e)}))}))}))))}},l("exportGeoJson")))))}function U(n){const a=e.hooks.useTranslation(t),{fieldInfo:i,display:o}=v(),{handleFieldCalculator:s}=n,[l,c]=e.React.useState(!0);e.React.useEffect((()=>{i&&0!==i.length?c(void 0):c(!0)}),[i,o]);return(0,e.jsx)(r.Tooltip,{placement:"auto",title:a("fieldCalculatorLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)(F.CalciteAction,{disabled:l,text:a("fieldCalculatorLabel"),icon:"calculator",scale:"m",id:"field-calculator",onClick:()=>{const e={id:"field-calculator",heading:a("fieldCalculatorLabel")};s(e)}}))}function q(n){const a=e.hooks.useTranslation(t),{dynSegFeatureLayer:i}=n,{pendingEdits:o,originalRecords:s}=v(),l=b();return(0,e.jsx)(r.Tooltip,{placement:"auto",title:a("discardEdits"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)(F.CalciteAction,{text:a("discardEdits"),icon:"read-only-non-editable",scale:"m",onClick:()=>{if(o){l({type:"SET_RECORDS",value:s}),l({type:"SET_EDITS",value:new Map}),l({type:"SET_ERROR_COUNT",value:0});const e={updateFeatures:s};i.applyEdits(e)}},disabled:!(o.size>0)||void 0}))}var J=h(49419),Y=h.n(J),Q=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(n[a[i]]=e[a[i]])}return n};const X=t=>{const n=window.SVG,{className:a}=t,i=Q(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",a);return n?e.React.createElement(n,Object.assign({className:r,src:Y()},i)):e.React.createElement("svg",Object.assign({className:r},i))};function K(n){const a=e.hooks.useTranslation(t),{fieldInfo:i,display:o}=v(),{networkDS:s}=n,l=b(),[c,u]=e.React.useState(),[d,f]=e.React.useState([]),[p,m]=e.React.useState([]),[g,h]=e.React.useState(!0);e.React.useEffect((()=>{const e=y();u(e),f(e),m(i),i&&0!==i.length?h(!1):h(!0)}),[i,o]);const y=()=>{const e=[];return i&&0!==i.length?(i.forEach((t=>{if(t.isEventIdField||t.isOidField||t.exclude);else{const n={label:t.featureFieldAlias,value:t.featureFieldAlias};e.push(n)}})),e):[]},x=e=>{p.forEach((e=>{e.visible=!0})),m(p);const t=e,n=d.filter((e=>!t.some((t=>t.value===e.value)))),a=p;n.forEach((e=>{const t=e.value;a.find((e=>e.featureFieldAlias===t)).visible=!1})),l({type:"SET_FIELD_INFO",value:a})},S=e.css`
    .advance-select-lrs,
    .advance-select-lrs .jimu-dropdown,
    .advance-select-lrs .jimu-dropdown button {
      padding: 0;
      margin: 0;
      border: none;
    }

    .advance-select-lrs,
    .advance-select-lrs .jimu-dropdown {
      padding: 0;
      margin: 0;
      border: none;
      height: 100%;
    }

    .advance-select-lrs .jimu-dropdown button  {
      padding-inline: 1rem;
    }

    .advance-select-lrs .jimu-dropdown button: disabled{
      background-color: transparent;
      color: #6a6a6a;
      opacity: 0.5;
    }

  `,w={icon:!0,arrow:!1,disabled:g};return(0,e.jsx)("span",{css:S},s&&(0,e.jsx)(r.AdvancedSelect,{className:"advance-select-lrs",size:"sm",title:a("showFields"),fluid:!0,dataSource:s,sortValuesByLabel:!1,selectedValues:c,isMultiple:!0,buttonProps:w,strategy:"absolute",customDropdownButtonContent:()=>(0,e.jsx)(X,null),onChange:e=>{e&&0!==e.length?(u(e),x(e)):(p.forEach((e=>{e.visible=!1})),m(p),l({type:"SET_FIELD_INFO",value:p}),u([]))},staticValues:y()}))}var Z=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function ee(t){const{intl:a,routeId:i,allowMerge:r,widgetId:o,jimuMapView:s,highlightColor:l,lrsLayers:c,networkDS:d,networkInfo:f,dynSegFeatureLayer:p,onSave:m,handleFieldCalculator:g,attributeSet:h}=t,{records:y,selectedRecordIds:b,selectedSldId:x,display:w,highlightLayer:I}=v();return e.React.useEffect((()=>{(()=>{Z(this,void 0,void 0,(function*(){yield function(e){return Z(this,void 0,void 0,(function*(){(0,u.isDefined)(I)&&(I.removeAll(),(0,u.isDefined)(y)&&(0,u.isDefined)(e)&&e.forEach((e=>Z(this,void 0,void 0,(function*(){const t=y.find((t=>t.getObjectId()===e));if((0,u.isDefined)(t)){R(s,I);const e="Point"===t.attributes[S.typeName],n=yield(0,u.getGeometryGraphic)(t,l,4,!e);I.add(n)}})))))}))}(b)}))})()}),[b]),e.React.useEffect((()=>{""===x&&(0,u.isDefined)(I)&&I.removeAll(),0===b.length&&(0,u.isDefined)(I)&&I.removeAll()}),[x,b]),(0,e.jsx)(F.CalciteActionBar,{slot:"header-actions-end",layout:"horizontal",scale:"m",className:"header-actions",expandDisabled:!0},(0,e.jsx)(P,null),(0,e.jsx)(F.CalciteActionGroup,{scale:"m"},(0,e.jsx)(A,{lrsLayers:c,networkDS:d,networkInfo:f,onSave:m,allowMerge:r}),w===n.Table&&(0,e.jsx)(q,{dynSegFeatureLayer:p}),w===n.Table&&(0,e.jsx)(B,{jimuMapView:s,networkDS:d}),w===n.Table&&(0,e.jsx)(K,{networkDS:d}),w===n.Table&&(0,e.jsx)(U,{intl:a,attributeSet:h,lrsLayers:c,dynSegFeatureLayer:p,handleFieldCalculator:g}),w===n.Table&&(0,e.jsx)(W,{dynSegFeatureLayer:p,widgetId:o,routeId:i,jimuMapView:s})))}function te(t){const{open:n,messageProp:a,onClose:i}=t;e.React.useEffect((()=>{let e=null==a?void 0:a.time;e||(e=5e3),n&&setTimeout((()=>{i()}),e)}),[n,i,null==a?void 0:a.time]);return(0,e.jsx)("div",{className:"toast-container h-100 w-100 d-flex"},(0,e.jsx)("div",{className:"toast m-auto"},(0,e.jsx)(F.CalciteNotice,{className:"toast-notice",kind:a.type,closable:!0,icon:(e=>{switch(e){case"brand":default:return"information";case"success":return"checkCircle";case"error":case"danger":case"warning":return"exclamationMarkTriangle"}})(a.type),open:!0,scale:"m",onCalciteNoticeClose:()=>{i()}},(0,e.jsx)("div",{slot:"title"},a.title),(0,e.jsx)("div",{slot:"message"},(0,e.jsx)("span",null,a.body),a.details&&(0,e.jsx)("div",null,(0,e.jsx)("span",null,a.details))))))}function ne(n){const{fieldInfo:a}=n,i=e.hooks.useTranslation(t);return(0,e.jsx)(F.CalciteTableRow,{slot:"table-header",className:"dyn-seg-table-header"},(0,e.jsx)(F.CalciteTableHeader,{heading:i("measureRange"),className:"dyn-seg-column-header"}),a.map(((t,n)=>t.visible&&!t.exclude?(0,e.jsx)(F.CalciteTableHeader,{key:n,heading:t.originalFieldAlias,description:t.eventAlias,className:"dyn-seg-column-header"}):null)))}var ae=h(28996),ie=h.n(ae),re=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function oe(t,n,a){if(!(0,u.isDefined)(t))return[];const r=e.DataSourceManager.getInstance(),o=new Set,s=new Map;n.forEach((e=>{if(e.eventInfo){o.add(e.eventInfo.eventIdFieldName);const t=r.getDataSource(e.useDataSource.dataSourceId);s.set(e.eventInfo.datasetName,t.getIdField())}}));const l=[],c=t.fields;let d=0;return c.forEach((e=>{var t,r,c,f,p,m,g,h,y;if(e.alias.includes(".")){if(e.alias.includes(".")){const v=e.alias.split(".")[0],b=e.alias.split(".")[1],x=n.find((e=>(0,u.isDefined)(e.eventInfo)&&e.eventInfo.datasetName===v)),S=null===(r=null===(t=x.eventInfo)||void 0===t?void 0:t.attributeFields)||void 0===r?void 0:r.find((e=>e.field.name===b)),w=null===(f=null===(c=x.eventInfo)||void 0===c?void 0:c.lrsFields)||void 0===f?void 0:f.find((e=>e.name===b)),I=o.has(b),D=s.get(null===(p=null==x?void 0:x.eventInfo)||void 0===p?void 0:p.datasetName)===b,N={index:d,featureFieldName:e.name,featureFieldAlias:e.alias,eventName:v,eventAlias:null===(m=x.eventInfo)||void 0===m?void 0:m.datasetName,originalFieldName:b,originalFieldAlias:(0,u.isDefined)(S)?null===(g=null==S?void 0:S.field)||void 0===g?void 0:g.alias:null==w?void 0:w.alias,eventLayerId:x.serviceId.toString(),visible:!0,exclude:I||D,editable:!I&&!D,EventType:(null===(h=x.eventInfo)||void 0===h?void 0:h.isPointEvent)?i.Point:i.Line,isSubtypeField:se(x.serviceId.toString(),e.name,a),isEventIdField:(null===(y=x.eventInfo)||void 0===y?void 0:y.eventIdFieldName)===b,isOidField:D,displayField:x.displayField};l.push(N)}}else if(e.alias===S.typeAlias){const t={index:d,featureFieldName:e.name,featureFieldAlias:e.alias,eventName:"",originalFieldName:e.alias,eventLayerId:"",visible:!0,exclude:!1,editable:!1,EventType:i.Undefined,isSubtypeField:!1,isEventIdField:!1,isOidField:!1,displayField:"",originalFieldAlias:e.alias,eventAlias:""};l.push(t)}else{const t={index:d,featureFieldName:e.name,featureFieldAlias:e.alias,eventName:"",originalFieldName:e.alias,eventLayerId:"",visible:!1,exclude:!0,editable:!1,EventType:i.Undefined,isSubtypeField:!1,isEventIdField:!1,isOidField:!1,displayField:"",originalFieldAlias:"",eventAlias:""};l.push(t)}d++})),l}function se(e,t,n){if(!(0,u.isDefined)(n))return!1;const a=n.find((t=>t.id===e));return!!(0,u.isDefined)(a)&&(!!(0,u.isDefined)(a.subtypeField)&&a.subtypeField.toUpperCase()===t.toUpperCase())}function le(e,t,n,a){const i=new Map;return e.forEach((e=>{e.eventName===n&&(e.isOidField?a&&i.set(e.featureFieldName,t.attributes[e.featureFieldName]):i.set(e.originalFieldName,t.attributes[e.featureFieldName]))})),i.set(S.routeIdName,t.attributes[S.routeIdName]),i.set(S.fromDateName,t.attributes[S.fromDateName]),i.set(S.toDateName,t.attributes[S.toDateName]),i.set(S.fromMeasureName,t.attributes[S.fromMeasureName]),i.set(S.toMeasureName,t.attributes[S.toMeasureName]),i}function ce(e,t,n,a){const i=new Map;if(t.isSubtypeField){const r=a.find((e=>e.id===t.eventLayerId));if((0,u.isDefined)(r)&&(0,u.isDefined)(r.subtypes)){const t=r.subtypes.find((t=>t.code===e)).defaultValues;if((0,u.isDefined)(t))return Object.keys(t).forEach((e=>{if(e in n.attributes){n.attributes[e]!==t[e]&&i.set(e,t[e])}})),i}}return i}function ue(e,t){return`${e.attributes[S.objectId]}.${t}`}var de=h(46942),fe=h.n(de),pe=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function me(n){const{intl:a,featureLayer:o,record:s,fieldInfo:l,subTypeInfo:c,layerMap:d,fieldGroups:f,contingentValues:p,updateRecord:m}=n,[g,h]=e.React.useState(s.attributes[l.featureFieldName]),[y,x]=e.React.useState(s.attributes[l.featureFieldName]),[w,I]=e.React.useState(s.attributes[l.featureFieldName]),[D,N]=e.React.useState(!1),[k,E]=e.React.useState(""),[L,R]=e.React.useState(!1),[j,M]=e.React.useState(!1),T=e.React.useRef(null),[C,A]=e.React.useState([]),[O,P]=e.React.useState([]),{errorCount:_,pendingEdits:V}=v(),$=b();e.React.useEffect((()=>{0===_&&re("")}),[_]);const B=e.React.useMemo((()=>{const e=o.fields.find((e=>e.name===l.featureFieldName));return e||null}),[o,l]),G=e.React.useMemo((()=>o.fields.filter((e=>e.alias.includes(".")&&e.alias.split(".")[0]===l.eventName))),[o,l]),z=e.React.useMemo((()=>{const e=c.find((e=>e.id===l.eventLayerId));return(0,u.isDefined)(e)?s.attributes[e.subtypeField]:NaN}),[c,l,s]),H=e.React.useMemo((()=>{const e=d.get(l.eventLayerId),t=f.get(l.eventLayerId),n=p.get(l.eventLayerId);return(0,u.setContingentValues)(n,t,e,z)}),[d,f,p,l,z]),W=e.React.useMemo((()=>{if((0,u.isDefined)(B)&&(0,u.isDefined)(B.domain)&&"coded-value"===B.domain.type){const e=B.domain.codedValues.some((e=>null===e.code&&"null"===e.name));return B.nullable&&!e&&B.domain.codedValues.unshift({code:null,name:"null"}),B.domain}return null}),[B]),U=e.React.useMemo((()=>{const e=c.find((e=>e.id===l.eventLayerId));if((0,u.isDefined)(e)&&(0,u.isDefined)(e.subtypes)){const t=e.subtypes.map((e=>({value:e.code,label:e.name})));if(t)return t}return[]}),[c]),q=e.React.useMemo((()=>l.isSubtypeField?"subtype":(0,u.isDefined)(B.domain)&&(0,u.isCodedDomain)(B.domain.type)?"domain":(0,u.isDefined)(B.domain)&&(0,u.isRangeDomain)(B.domain.type)?"range":(0,u.isDate)(B.type)?"date":(0,u.isNumber)(B.type)?"number":"text"),[l,B]),J=e.React.useMemo((()=>{if(B.editable&&l.editable&&(0,u.isDefined)(s)){const e=s.attributes[S.typeName];return("Point"!==e||l.EventType!==i.Line)&&("Line"!==e||l.EventType!==i.Point)}}),[B,l]),Y=e.React.useMemo((()=>k.length>0),[k]),Q=e.React.useMemo((()=>!(!(0,u.isDefined)(w)&&""===g)&&(g!==w&&0===k.length)),[w,g,k]);e.React.useEffect((()=>{(0,u.isDefined)(s)&&(0,u.isDefined)(l)&&I(s.attributes[l.featureFieldName])}),[]),e.React.useEffect((()=>{const e=new IntersectionObserver((([e])=>{R(e.isIntersecting)}),{root:null,rootMargin:"0px",threshold:0});return T.current&&e.observe(T.current),()=>{T.current&&e.unobserve(T.current)}})),e.React.useEffect((()=>{function e(e){T.current&&!T.current.contains(e.target)&&M(!1)}if(j)return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}}),[j,T]),e.React.useEffect((()=>{(0,u.isDefined)(s)&&(0,u.isDefined)(l)&&h(s.attributes[l.featureFieldName])}),[s,l]),e.React.useEffect((()=>{const e=(0,u.getContingentOptions)(l.originalFieldName,H),t=function(e,t,n,a){const i=[];if(!(0,u.fieldsWithContingentValues)(e).has(a))return[];if(!e||0===e.length)return[];const r=[];if((null==e?void 0:e.length)>0)for(const o of e){const e=null==o?void 0:o.contingencies,s=null==o?void 0:o.fields;if(e&&(null==s?void 0:s.includes(a)))for(const o of e){let e=null,s=!1;const l=Object.keys(o.values);null==l||l.forEach((i=>{const r=o.values[i];if(i===a)"code"===r.objectType&&(e=r.codedValue.code);else if("code"===r.objectType){const e=r.codedValue.code;t.some((t=>{if(t.alias.split(".")[1]===i){const a=n.attributes[t.name];return(a===e||null===a)&&(s=!0),!0}return!1}))}})),null!==e&&(s?i.push(e):r.push(e))}}return i}(H,G,s,l.originalFieldName);A(e),P(t)}),[G,H,l,s]),e.React.useEffect((()=>{if(H.length>0){const e=ue(s,l.eventName),n=V.get(e);if((0,u.isDefined)(n)){const e=(0,u.validateContingencyConstraints)(-1,"",-1,null,H,s,G);if(e.length>0){const n=[];for(let t=0;t<(null==e?void 0:e.length);t++){const a=e[t];n.push(null==a?void 0:a.fieldGroup)}null==n||n.forEach((e=>{const n=null==e?void 0:e.fields;(null==n?void 0:n.find((e=>e===(null==l?void 0:l.originalFieldName))))&&(re((0,u.formatMessage)(a,"contingentValueError",t)),N(!0))}))}else D&&(re(""),N(!1))}}}),[V,s]);const X=(e,t)=>(0,u.isDefined)(t)?`${t} - ${e}`:e,K=()=>{if((0,u.isDefined)(g)){const e=U.find((e=>"string"==typeof e.value&&"string"==typeof g?e.value.toLowerCase()===g.toLowerCase():e.value===g));return(0,u.isDefined)(e)?X(e.label):""}return""},Z=()=>{if((0,u.isDefined)(g)){const e=W.codedValues.find((e=>"string"==typeof e.code&&"string"==typeof g?e.code.toLowerCase()===g.toLowerCase():e.code===g));return(0,u.isDefined)(e)?X(e.name):""}return""},ee=()=>B.name===S.typeName?"75px":"125px",te=j&&(0,u.isDefined)(B.domain)&&"domain"===q,ne=e=>{e.target.value!==g&&(h(e.target.value),se(e.target.value,""))},ae=(e,t)=>pe(this,void 0,void 0,(function*(){const t=s.clone(),n=ce(e,l,t,c);n.size>0?n.forEach(((e,n)=>{t.attributes[n]=e})):t.attributes[l.featureFieldName]=e;const a={updateFeatures:[t]};yield o.applyEdits(a).then((e=>{e.updateFeatureResults.length>0&&(e.updateFeatureResults[0].error?re(e.updateFeatureResults[0].error.message):m(t,l))})).catch((e=>{re(e.message)}))})),re=e=>{const t=k.length>0;let n=_;t&&0===e.length&&n--,!t&&e.length>0&&n++,$({type:"SET_ERROR_COUNT",value:n}),E(e)},oe=e=>{h(e)},se=(e,t)=>{ae(e),x(e),M(!1)};return(0,e.jsx)(F.CalciteTableCell,{className:fe()("dyn-seg-cell",Q?"edited":"",J?"":"non-editable",Y?"error":"")},(0,e.jsx)("div",{ref:T,style:{minWidth:ee(),maxWidth:"224px"}},L&&(0,e.jsx)("div",{className:"dyn-seg-cell-content h-100 d-flex",tabIndex:-1},!j&&(0,e.jsx)("div",{onDoubleClick:()=>{J&&M(!0)},className:"d-flex"},(0,e.jsx)(r.Label,{size:"sm",className:"text-truncate w-100",style:{textOverflow:"ellipse",minWidth:ee(),maxWidth:"200px",textWrap:"nowrap",marginBottom:0,alignItems:"center",textAlign:"left"}},(()=>{switch(q){case"subtype":return K();case"domain":return Z();case"date":return(0,u.isDefined)(g)?new Date(g).toLocaleDateString():"";case"range":case"number":case"text":return(0,u.isDefined)(g)?g.toString():"";default:return""}})()),k.length>0&&(0,e.jsx)(r.Icon,{icon:ie(),size:16,title:k,color:"red",style:{alignSelf:"center",marginLeft:"4px",marginRight:"4px"}})),j&&"text"===q&&(0,e.jsx)(r.TextInput,{size:"sm",style:{minWidth:ee()},className:"w-100",autoFocus:!0,required:!B.nullable,value:g,type:"text",onChange:e=>{oe(e.currentTarget.value)},checkValidityOnAccept:e=>pe(this,void 0,void 0,(function*(){let n=e;if("number"===q&&(n=parseFloat(e)),w===n||y===g)return k.length>0&&re(""),{valid:!0};const i=k.length>0,r=(0,u.validateField)(e,l.featureFieldName,void 0,B);return r.hasError?i?{valid:!1,msg:r.message}:(re((0,u.formatMessage)(a,r.message,t)),se(n,(0,u.formatMessage)(a,r.message,t)),{valid:!1,msg:(0,u.formatMessage)(a,r.message,t)}):(re(""),se(n,""),{valid:!0})}))}),j&&"number"===q&&(0,e.jsx)(r.NumericInput,{size:"sm",style:{minWidth:ee()},className:"w-100",autoFocus:!0,showHandlers:!1,required:!B.nullable,value:g,onAcceptValue:e=>{e!==g&&(h(e),se(e,""))}}),j&&"date"===q&&(0,e.jsx)(F.CalciteInputDatePicker,{scale:"s",style:{minWidth:ee()},valueAsDate:(0,u.isDefined)(g)?new Date(g):null,onCalciteInputDatePickerChange:e=>{var n;const i=null===(n=e.target)||void 0===n?void 0:n.valueAsDate,r=i.valueOf();if(w===r)return k.length>0&&re(""),{valid:!0};const o=k.length>0,s=(0,u.validateField)(i,l.featureFieldName,void 0,B);return s.hasError?o?{valid:!1,msg:s.message}:(re((0,u.formatMessage)(a,s.message,t)),se(r,(0,u.formatMessage)(a,s.message,t)),{valid:!1,msg:(0,u.formatMessage)(a,s.message,t)}):(re(""),se(r,""),{valid:!0})},placement:"top",overlayPositioning:"fixed",focusTrapDisabled:!0}),j&&"domain"===q&&(0,e.jsx)(r.Select,{size:"sm",className:"w-100",style:{minWidth:ee()},value:g,onChange:e=>{ne(e)}},(()=>{var t;if(te)return(null==C?void 0:C.length)>0?C.map(((t,n)=>{var a;const i=(a=t.code,!(!O||!O.includes(a)))?{}:{color:"#a0a0a0",background:"#d5d5d5"};return(0,e.jsx)("option",{key:n,value:t.code,style:i},X(t.name,t.code))})):null===(t=null==W?void 0:W.codedValues)||void 0===t?void 0:t.map(((t,n)=>(0,e.jsx)("option",{key:n,value:t.code},X(t.name,t.code))))})()),j&&"subtype"===q&&(0,e.jsx)(r.Select,{size:"sm",style:{minWidth:ee()},className:"w-100",value:g,onChange:e=>{ne(e)}},U.map(((t,n)=>(0,e.jsx)("option",{key:n,value:t.value},X(t.label,t.value))))),j&&"range"===q&&(0,e.jsx)(r.TextInput,{size:"sm",className:"w-100",style:{minWidth:ee()},autoFocus:!0,required:!B.nullable,value:g,onChange:e=>{oe(e.currentTarget.value)},checkValidityOnAccept:e=>{if(w===e||y===g)return k.length>0&&re(""),{valid:!0};const n=k.length>0,i=(0,u.validateRangeDomain)(e,l.featureFieldName,void 0,B);return i.hasError?n?{valid:!1,msg:i.message}:(re((0,u.formatMessage)(a,i.message,t)),se(e,(0,u.formatMessage)(a,i.message,t)),{valid:!1,msg:(0,u.formatMessage)(a,i.message,t)}):(re(""),se(e,""),{valid:!0})}}))))}var ge=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function he(e,t,n){return ge(this,void 0,void 0,(function*(){const a=yield(0,u.QueryLock)(t,e,!1);let i;if((0,u.shouldTryAcquireLock)(t,a)){if(i=yield(0,u.acquireLock)(t,a),i.acquireStatus===u.LockAcquireStatus.EsriReconcileRequired){if(!(yield(0,u.tryAutoReconcile)(t)))return ye(i,e,t,n);i=yield(0,u.acquireLock)(t,a)}else if(i.acquireStatus!==u.LockAcquireStatus.EsriSuccess)return ye(i,e,t,n)}else if(a.status!==u.LockAcquireStatus.EsriSuccess)return ye(i,e,t,n)}))}function ye(e,t,n,a){var i;let r="",o="info",s="";const l=null===(i=null==t?void 0:t.details[0])||void 0===i?void 0:i.lrsNetworkName,c=(0,u.getGDBVersion)(n);switch(e.acquireStatus){case u.LockAcquireStatus.EsriSuccess:s=""!==(f=t.routeInfo).lineId&&""===f.lineName?f.lineId:""!==f.lineId&&""!==f.lineName?f.lineName:""!==f.routeName?f.routeName:f.routeId,r=""!==t.routeInfo.lineId?(0,u.formatMessage)(a,"YouAcquiredLockOnLine",{nameOrId:s,networkName:l,version:c}):(0,u.formatMessage)(a,"YouAcquiredLockOnRoute",{nameOrId:s,networkName:l,version:c}),o="info";break;case u.LockAcquireStatus.EsriReconcileRequired:r=(0,u.formatMessage)(a,"ReconcileRequired"),o="danger";break;case u.LockAcquireStatus.EsriCouldNotAcquireAllLocks:const n=e.unavailableLocks[0].versionName,i=e.unavailableLocks[0].user;d=e.unavailableLocks[0],s=(0,u.isDefined)(d.routeName)&&""!==d.routeName?d.routeName:(0,u.isDefined)(d.lineName)&&""!==d.lineName?d.lineName:(0,u.isDefined)(d.routeId)&&""!==d.routeId?d.routeId:(0,u.isDefined)(d.lineId)&&""!==d.lineId?d.lineId:void 0,r=""===n?""!==t.routeInfo.lineId?(0,u.formatMessage)(a,"UnavailableLockOnLineWithoutVersion",{nameOrId:s,networkName:l,lockUser:i}):(0,u.formatMessage)(a,"UnavailableLockOnRouteWithoutVersion",{nameOrId:s,networkName:l,lockUser:i}):""!==t.routeInfo.lineId?(0,u.formatMessage)(a,"UnavailableLockOnLine",{nameOrId:s,networkName:l,lockUser:i,version:n}):(0,u.formatMessage)(a,"UnavailableLockOnRoute",{nameOrId:s,networkName:l,lockUser:i,version:n}),o="danger";break;default:r="",o="info"}var d,f;return{toastMsg:r,toastMsgType:o,toastOpen:open}}function ve(e,t,n){return ge(this,void 0,void 0,(function*(){var a;const i=e.routeIdFieldSchema.name,r=e.lineIdFieldSchema.name;let o="";const s=[t];s.length>0&&(o=i+" IN ('"+s.join("','")+"')");const l={where:o,outFields:["*"]},c=yield n.query(l);if(0===(null===(a=null==c?void 0:c.records)||void 0===a?void 0:a.length))return null;return null==c?void 0:c.records[0].feature.attributes[r]}))}function be(e){const t=`TIMESTAMP '${xe(e).toISOString().slice(0,10)}'`;return`(((${S.fromDateName.toUpperCase()} <= ${t}) AND (${S.toDateName.toUpperCase()} IS NULL)) OR ((${S.fromDateName.toUpperCase()} IS NULL) AND (${S.toDateName.toUpperCase()} >= ${t})) OR ((${S.fromDateName.toUpperCase()} < ${t}) AND (${S.toDateName.toUpperCase()} > ${t})))`}function xe(e){if((0,u.isDefined)(e)){const t=e.getCurrentQueryParams().time;let n=new Date(Date.now());return t&&(n=new Date(t[0])),n}return null}var Se=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function we(t){const{networkDS:n,intl:a,conflictPreventionEnabled:i,routeId:o,lrsLayers:s,currentRouteInfo:l,networkInfo:c,rowIndex:d,handleLockToast:f,featureLayer:p,record:m,rangeHeader:g,fieldInfos:h,lastIndex:y,subTypeInfo:x,layerMap:S,fieldGroups:w,contingentValues:I}=t,[D,N]=e.React.useState(!1),[k,E]=e.React.useState(m),[L,R]=e.React.useState(),{pendingEdits:j,selectedRecordIds:M,fieldInfo:T}=v(),C=b();e.React.useEffect((()=>{if(j.size>0){let e=!1;if(h.forEach((t=>{const n=ue(m,t.eventName);j.get(n)&&(e=!0)})),e){const e=p.objectIdField+" = "+m.getObjectId();p.queryFeatures({where:e}).then((e=>{E(e.features[0])}))}}else E(m)}),[j]),e.React.useEffect((()=>{if(M.length>0){const e=M.find((e=>e===m.getObjectId()));N(!!(e&&!D||!e&&D)&&(0,u.isDefined)(e))}}),[M]),e.React.useEffect((()=>{d===y&&C({type:"SET_IS_LOADING",value:!1})}),[]),e.React.useEffect((()=>{(null==c?void 0:c.supportsLines)&&ve(c,o,n).then((e=>{e&&R(e)})).catch((e=>{console.error(e)}))}),[c]);const A=(e,t)=>{const n=ue(t,e.eventName),a=j.get(n),i=le(h,t,e.eventName,!1),r=new Map(j);if((0,u.isDefined)(a))a.attributes=i,r.set(n,a);else{const t={layerId:e.eventLayerId,attributes:i};r.set(n,t)}C({type:"SET_EDITS",value:r})},O=()=>{const e=c.lrsNetworkId,t=[],n=[],a=[],i=l;T.forEach((i=>{const r=i.eventLayerId,l=s.find((e=>e.serviceId.toString()===r.toString()));if(l){l.eventInfo.parentNetworkId===e&&(a.push(r),c.supportsLines&&L?t.push(L):t.push(o),n.push(c.supportsLines))}}));return{networkId:[e],routeOrLineId:t,eventServiceLayerIds:a,isLine:n,status:u.LockAcquireStatus.EsriSuccess,details:[],routeInfo:i,lockAction:u.LockAction.Query}},P=(e,t)=>Se(this,void 0,void 0,(function*(){let r;if(i){const i=O(),o=n;if(r=yield he(i,o,a),r){const n={title:r.toastMsg,body:"",type:r.toastMsgType};f(n),A(t,e),E(e)}else{f({title:"Field updated successfully",body:"",type:"success"}),A(t,e),E(e)}}else A(t,e),E(e)}));return(0,e.jsx)(F.CalciteTableRow,{className:"dyn-seg-row",onClick:e=>{e.stopPropagation();let t=[...M];if(e.shiftKey){const e=t[t.length-1],n=m.getObjectId();if(e<n){Array.from({length:n-e+1},((t,n)=>n+e)).forEach((e=>{const n=t.findIndex((e=>e===m.getObjectId()));-1===n&&t.push(e)}))}else if(e>n){Array.from({length:e-n+1},((e,t)=>t+n)).forEach((e=>{const n=t.findIndex((e=>e===m.getObjectId()));-1===n&&t.push(e)}))}}else if(e.ctrlKey){const e=t.findIndex((e=>e===m.getObjectId()));e>-1?t.splice(e,1):t.push(m.getObjectId())}else{t[t.length-1]===m.getObjectId()?(t=[],N(!1)):t=[m.getObjectId()]}C({type:"SET_SELECTED_RECORD_IDS",value:t})}},(0,e.jsx)(F.CalciteTableCell,{className:fe()("dyn-seg-row-header",D?"selected":"")},(0,e.jsx)("div",{className:"h-100 d-flex"},(0,e.jsx)(r.Label,{size:"sm",className:"w-100",centric:!0,style:{minWidth:"100px",textWrap:"nowrap",marginBottom:0,textAlign:"left",whiteSpace:"pre"}},g))),h.map(((t,n)=>t.visible&&!t.exclude?(0,e.jsx)(me,{intl:a,key:n,rowIndex:n,fieldInfo:t,featureLayer:p,record:k,subTypeInfo:x,layerMap:S,fieldGroups:w,contingentValues:I,updateRecord:P}):null)))}function Ie(t){const{intl:n,conflictPreventionEnabled:a,networkDS:i,routeId:r,lrsLayers:o,currentRouteInfo:s,networkInfo:l,featureLayer:c,records:u,measureHeaders:d,fieldInfo:f,subTypeInfo:p,layerMap:m,fieldGroups:g,contingentValues:h,handleLockToast:y}=t,{isLoading:b}=v(),x=(0,O.useTheme)();return e.React.useEffect((()=>{if(!b){let e=!1,t=0;for(;!e;){let n=!1,a=!1,i=!1,r=!1,o=!1;setTimeout((()=>{const e=document.querySelector(".dyn-seg-table");if(e&&e.shadowRoot){const t=e.shadowRoot.querySelector(".table-container");t&&(t.style.height="100%",n=!0)}const t=document.querySelector(".dyn-seg-table-header");if(t&&t.shadowRoot){const e=t.shadowRoot.querySelector(".interaction-container");if(e){const t=e.firstChild;t&&t&&(t.style.position="sticky",t.style.top="0",t.style.zIndex="10",t.style.backgroundColor=x.sys.color.surface.background,a=!0)}}const s=document.querySelectorAll(".dyn-seg-column-header");s&&s.forEach((e=>{const t=e.shadowRoot.querySelector(".content-cell");t&&"1"===t.ariaColIndex&&(t.style.position="sticky",t.style.left="0",t.style.zIndex="10",t.style.backgroundColor=x.sys.color.surface.background,i=!0)}));const l=document.querySelectorAll(".dyn-seg-row-header");l&&l.forEach((e=>{const t=e.shadowRoot.querySelector(".interaction-container");if(t){const e=t.childNodes[0];e&&(e.style.position="sticky",e.style.left="0",e.style.zIndex="5",e.style.userSelect="none")}r=!0}));const c=document.querySelectorAll(".dyn-seg-row"),u=c[c.length-1];if(u){const e=u.shadowRoot.querySelector(".interaction-container");if(e){const t=e.lastChild;t&&(t.className="",t.style.borderBlockEnd=`1px solid ${x.sys.color.surface.background};`)}o=!0}}),1e3),t++,t>10&&(e=!0),n&&a&&i&&r&&o&&(e=!0)}}}),[b]),(0,e.jsx)(F.CalciteTable,{caption:"Dynamic Segmentation Table",className:"dyn-seg-table",bordered:!0,scale:"s",layout:"auto",style:{height:"100%",width:"100%"}},(0,e.jsx)(ne,{fieldInfo:f}),u.map(((t,v)=>(0,e.jsx)(we,{intl:n,conflictPreventionEnabled:a,key:v,rowIndex:v,featureLayer:c,record:t,rangeHeader:d[v],fieldInfos:f,lastIndex:u.length-1,subTypeInfo:p,layerMap:m,fieldGroups:g,contingentValues:h,networkInfo:l,currentRouteInfo:s,lrsLayers:o,routeId:r,networkDS:i,handleLockToast:y}))))}const De="object"==typeof global&&global&&global.Object===Object&&global;var Ne="object"==typeof self&&self&&self.Object===Object&&self;const ke=De||Ne||Function("return this")();var Ee=/\s/;const Le=function(e){for(var t=e.length;t--&&Ee.test(e.charAt(t)););return t};var Re=/^\s+/;const je=function(e){return e?e.slice(0,Le(e)+1).replace(Re,""):e};const Me=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const Te=ke.Symbol;var Fe=Object.prototype,Ce=Fe.hasOwnProperty,Ae=Fe.toString,Oe=Te?Te.toStringTag:void 0;const Pe=function(e){var t=Ce.call(e,Oe),n=e[Oe];try{e[Oe]=void 0;var a=!0}catch(e){}var i=Ae.call(e);return a&&(t?e[Oe]=n:delete e[Oe]),i};var _e=Object.prototype.toString;const Ve=function(e){return _e.call(e)};var $e=Te?Te.toStringTag:void 0;const Be=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":$e&&$e in Object(e)?Pe(e):Ve(e)};const Ge=function(e){return null!=e&&"object"==typeof e};const ze=function(e){return"symbol"==typeof e||Ge(e)&&"[object Symbol]"==Be(e)};var He=/^[-+]0x[0-9a-f]+$/i,We=/^0b[01]+$/i,Ue=/^0o[0-7]+$/i,qe=parseInt;const Je=function(e){if("number"==typeof e)return e;if(ze(e))return NaN;if(Me(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Me(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=je(e);var n=We.test(e);return n||Ue.test(e)?qe(e.slice(2),n?2:8):He.test(e)?NaN:+e};var Ye=1/0;const Qe=function(e){return e?(e=Je(e))===Ye||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const Xe=function(e){var t=Qe(e),n=t%1;return t==t?n?t-n:t:0};const Ke=function(e,t){for(var n=-1,a=null==e?0:e.length,i=Array(a);++n<a;)i[n]=t(e[n],n,e);return i};const Ze=Array.isArray;var et=Te?Te.prototype:void 0,tt=et?et.toString:void 0;const nt=function e(t){if("string"==typeof t)return t;if(Ze(t))return Ke(t,e)+"";if(ze(t))return tt?tt.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const at=function(e){return null==e?"":nt(e)};var it=ke.isFinite,rt=Math.min;const ot=function(e){var t=Math[e];return function(e,n){if(e=Je(e),(n=null==n?0:rt(Xe(n),292))&&it(e)){var a=(at(e)+"e").split("e"),i=t(a[0]+"e"+(+a[1]+n));return+((a=(at(i)+"e").split("e"))[0]+"e"+(+a[1]-n))}return t(e)}}("round");var st=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function lt(n){const{intl:a,conflictPreventionEnabled:i,routeId:r,networkDS:o,featureLayer:s,records:l,lrsLayers:c,attributeSet:d,networkInfo:f,currentRouteInfo:p,handleLockToast:m}=n,g=e.hooks.useTranslation(t),[h,y]=e.React.useState(!1),[x,S]=e.React.useState([]),[w,I]=e.React.useState([]),[D,N]=e.React.useState(new Map),[k,L]=e.React.useState(new Map),[R,j]=e.React.useState(new Map),{fieldInfo:M}=v(),T=b();e.React.useEffect((()=>{const e=e=>st(this,void 0,void 0,(function*(){T({type:"SET_SELECTED_RECORD_IDS",value:[]}),e.length>0?F():C()}));(0,u.isDefined)(l)?e(l):C()}),[l]);const F=()=>st(this,void 0,void 0,(function*(){const e=yield E(c,d),t=oe(s,c,e),n=yield function(e,t){return re(this,void 0,void 0,(function*(){const n=new Map;return yield Promise.all(t.map((t=>re(this,void 0,void 0,(function*(){const a=e.find((e=>e.serviceId.toString()===t.layerId));(0,u.isDefined)(a)&&(yield(0,u.getLayer)(a.useDataSource).then((e=>re(this,void 0,void 0,(function*(){n.set(a.serviceId.toString(),e)})))))}))))),n}))}(c,d),a=A(l,f),i=yield function(e,t,n){return re(this,void 0,void 0,(function*(){const a=new Map;return yield Promise.all(n.map((n=>re(this,void 0,void 0,(function*(){const i=t.find((e=>e.serviceId.toString()===n.layerId)),r=e.get(i.serviceId.toString());(0,u.isDefined)(i)&&(0,u.isDefined)(r)&&(yield(0,u.fetchEnterpriseFieldGroup)(r).then((e=>re(this,void 0,void 0,(function*(){if((null==e?void 0:e.length)>0){const t=e.map((e=>({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fieldNames.names.map((e=>(0,u.normalizeFieldName)(null==e?void 0:e.toLocaleUpperCase())))})));a.set(i.serviceId.toString(),t)}})))))}))))),a}))}(n,c,d),r=yield function(e,t,n){return re(this,void 0,void 0,(function*(){const a=new Map;return yield Promise.all(n.map((n=>re(this,void 0,void 0,(function*(){const i=t.find((e=>e.serviceId.toString()===n.layerId)),r=e.get(i.serviceId.toString());(0,u.isDefined)(i)&&(0,u.isDefined)(r)&&(yield(0,u.fetchEnterpriseContingentValues)(r).then((e=>{a.set(i.serviceId.toString(),e)})))}))))),a}))}(n,c,d);S(a),I(e),N(n),L(i),j(r),y(!0),T({type:"SET_FIELD_INFO",value:t}),T({type:"SET_SELECTED_RECORD_IDS",value:[]})})),C=()=>{y(!1),S([]),I([]),N(new Map),L(new Map),j(new Map),T({type:"SET_SELECTED_RECORD_IDS",value:[]}),T({type:"SET_IS_LOADING",value:!1}),T({type:"SET_FIELD_INFO",value:[]})},A=(e,t)=>{if((0,u.isDefined)(e)&&e.length>0){const n=[];return e.forEach((e=>{const a=ot(e.attributes.from_measure,t.measurePrecision).toFixed(t.measurePrecision),i=ot(e.attributes.to_measure,t.measurePrecision).toFixed(t.measurePrecision);n.push(g("measuresRange",{fromM:a,toM:i}))})),n}return[]};return(0,e.jsx)("div",{className:"dyn-seg-table-container h-100 w-100 d-flex"},h&&(0,e.jsx)(Ie,{intl:a,conflictPreventionEnabled:i,featureLayer:s,records:l,measureHeaders:x,fieldInfo:M,subTypeInfo:w,layerMap:D,fieldGroups:k,contingentValues:R,networkInfo:f,networkDS:o,currentRouteInfo:p,lrsLayers:c,routeId:r,handleLockToast:m}))}var ct=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function ut(t,n,a,i,r,o){return ct(this,void 0,void 0,(function*(){const s=new Map;let l=0;n.forEach((e=>{if(""!==e.eventName){const t={index:l++,layerId:e.eventLayerId,layerName:e.eventName,eventType:e.EventType,records:[],visible:!0,isActive:!0};s.set(e.eventName,t)}}));let c=0;return t.forEach((e=>{s.forEach((t=>{if(function(e,t,n){let a=!1;const i=ft(e,t,n),r=t.attributes[S.typeName];i&&"Line"===r&&(a=!0);i||"Point"!==r||(a=!0);return a}(n,e,t.layerName,o.mTolerance))return;const s=a.find((e=>(0,u.isDefined)(e.eventInfo)&&e.eventInfo.datasetName===t.layerName)),l=n.filter((e=>e.eventName===t.layerName)),d=e.attributes[S.fromMeasureName]<r.from?r.from:e.attributes[S.fromMeasureName],f=e.attributes[S.toMeasureName]>r.to?r.to:e.attributes[S.toMeasureName],p={index:c++,objectId:e.attributes[S.objectIdName],attributes:le(n,e,t.layerName,!0),fromMeasure:d,toMeasure:f,geometry:e.geometry,selected:!1,hasValue:pt(n,e,t.layerName),isPoint:ft(n,e,t.layerName),displayField:dt(s.displayField,t.layerId,i),fieldInfos:l};t.records.push(p)}))})),yield function(t){return ct(this,void 0,void 0,(function*(){const n=yield(0,e.loadArcGISJSAPIModule)("esri/geometry/operators/unionOperator"),a=new Map(t);return a.forEach((e=>{const t=[];let a=null;e.records.sort(((e,t)=>e.fromMeasure-t.fromMeasure)),e.records.forEach((e=>{a?!function(e,t){if(e.isPoint)return!1;let n=!0;return e.attributes.forEach(((e,a)=>{if(a!==S.fromMeasureName&&a!==S.toMeasureName&&t.attributes.has(a)){const i=(0,u.isDefined)(e),r=(0,u.isDefined)(t.attributes.get(a));(!i&&r||i&&!r||e!==t.attributes.get(a))&&(n=!1)}})),n}(a,e)?(t.push(a),a=e):(a.attributes.set(S.toMeasureName,e.toMeasure),a.toMeasure=e.toMeasure,a.geometry=function(e,t,n){return!(0,u.isDefined)(t)&&(0,u.isDefined)(n)?n:(0,u.isDefined)(t)&&!(0,u.isDefined)(n)?t:(0,u.isDefined)(t)||(0,u.isDefined)(n)?e.execute(t,n):null}(n,a.geometry,e.geometry)):a=e})),a&&t.push(a),e.records=t})),a}))}(s)}))}function dt(e,t,n){const a=n.find((e=>e.layerId===t));if((0,u.isDefined)(a)){const t=a.fields.find((t=>t===e));return(0,u.isDefined)(t)?t:a.fields[0]}return""}function ft(e,t,n){let a=!1;return e.forEach((e=>{e.eventName===n&&e.EventType===i.Point&&(a=!0)})),a}function pt(e,t,n){let a=!1;return e.forEach((e=>{if(e.eventName===n&&e.isOidField){const n=t.attributes[e.featureFieldName];(0,u.isDefined)(n)&&""!==n&&!isNaN(n)&&(a=!0)}})),a}function mt(e,t,n){if(isNaN(e))return NaN;const a=t.to-t.from,i=n,r=(e-t.from)/a*i;return Math.floor(r)}function gt(e,t,n){for(let a=0;a<t;++a)if(0!==e.data[n*t*4+4*a+3])return!1;return!0}function ht(e,t,n,a,i){for(let r=a;r<i;++r)if(0!==e.data[r*t*4+4*n+3])return!1;return!0}function yt(e,t){const n=function(e,t){const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const a=n.getContext("2d");return(0,u.isDefined)(t)?a.drawImage(e,0,0,t,t):a.drawImage(e,0,0),n}(e,t),a=function(e,t){const n=e.getContext("2d"),a=(0,u.isDefined)(t)?t:e.width,i=(0,u.isDefined)(t)?t:e.height,r=n.getImageData(0,0,a,i);let o=0,s=r.height,l=0,c=r.width;for(;o<s&&gt(r,a,o);)++o;for(;s-1>o&&gt(r,a,s-1);)--s;for(;l<c&&ht(r,a,l,o,s);)++l;for(;c-1>l&&ht(r,a,c-1,o,s);)--c;const d=c-l==0?1:c-l,f=s-o==0?1:s-o,p=n.getImageData(l,o,d,f),m=e.ownerDocument.createElement("canvas"),g=m.getContext("2d");return m.width=p.width,m.height=p.height,g.putImageData(p,0,0),m}(n,t);return a.toDataURL("image/png")}function vt(e,t,n,a,i){if((0,u.isDefined)(e)){const i=function(e,t,n,a){if((0,u.isDefined)(e)&&(0,u.isDefined)(n)){if((0,u.isDefined)(t)){const e=n.find((e=>e.id===t.eventLayerId));if((0,u.isDefined)(e)&&(0,u.isDefined)(e.subtypes)){const t=e.subtypes.map((e=>({value:e.code,label:e.name})));if(t)return t}return[]}return a.subtypes.map((e=>({value:e.code,label:e.name})))||[]}return[]}(t,n,a),r=i.find((t=>"string"==typeof t.value&&"string"==typeof e?t.value.toLowerCase()===e.toLowerCase():t.value===e));return(0,u.isDefined)(r)?r.label:""}return""}function bt(e,t){if((0,u.isDefined)(e)){const a=(n=t,(0,u.isDefined)(n)&&(0,u.isDefined)(n.domain)&&"coded-value"===n.domain.type?n.domain:null).codedValues.find((t=>"string"==typeof t.code&&"string"==typeof e?t.code.toLowerCase()===e.toLowerCase():t.code===e));return(0,u.isDefined)(a)?a.name:""}var n;return""}function xt(e,t,n,a){const i=function(e,t){return e.find((e=>e.alias.split(".")[1]===t.displayField))}(e,n),r=It(t,n);if((0,u.isDefined)(i)&&(0,u.isDefined)(r)){return St(wt(i,r),i,r,n.attributes.get(n.displayField),a)}return""}function St(e,t,n,a,i,r){switch(e){case"subtype":return vt(a,t,n,i);case"domain":return bt(a,t);case"date":return(0,u.isDefined)(a)?new Date(a).toLocaleDateString():"";case"range":case"number":case"text":return(0,u.isDefined)(a)?a.toString():"";default:return""}}function wt(e,t,n){if((0,u.isDefined)(t)){if(t.isSubtypeField)return"subtype"}else if(n.subtypeField===e.name)return"subtype";return(0,u.isDefined)(e.domain)&&(0,u.isCodedDomain)(e.domain.type)?"domain":(0,u.isDefined)(e.domain)&&(0,u.isRangeDomain)(e.domain.type)?"range":(0,u.isDate)(e.type)?"date":(0,u.isNumber)(e.type)?"number":"text"}function It(e,t){return e.find((e=>e.originalFieldName===t.displayField))}function Dt(e,t){return e.find((e=>e.isEventIdField))}function Nt(t,n,a=!1){return(0,e.loadArcGISJSAPIModules)(["esri/Graphic"]).then((e=>{let i=null;[i]=e;const r=[...t.attributes.keys()],o={};return r.forEach((e=>{o[e]=t.attributes.get(e),!a||(0,u.isDefined)(o[e])&&"null"!==o[e]||(o[e]="<Null>")})),(0,u.isDefined)(n)?new i({geometry:t.geometry,attributes:o,layer:n.layer}):new i({geometry:t.geometry,attributes:o})}))}function kt(e,t,n,a){const i=new Map;return e.forEach((e=>{e.eventName===n&&(e.isOidField?a&&i.set(e.featureFieldName,t.attributes.get(e.featureFieldName)):i.set(e.originalFieldName,t.attributes.get(e.featureFieldName)))})),i.set(S.routeIdName,t.attributes.get(S.routeIdName)),i.set(S.fromDateName,t.attributes.get(S.fromDateName)),i.set(S.toDateName,t.attributes.get(S.toDateName)),i.set(S.fromMeasureName,t.attributes.get(S.fromMeasureName)),i.set(S.toMeasureName,t.attributes.get(S.toMeasureName)),i}function Et(t){const{trackKey:n,track:a,onTrackClicked:i}=t;return(0,e.jsx)("div",{className:(0,e.classNames)("sidebar-item",a.isActive?"active":"inactive"),onClick:()=>{a.isActive=!a.isActive,i(a,n)}},(0,e.jsx)(r.Label,{centric:!0,style:{marginBottom:"0"}},a.layerName))}function Lt(t){const{trackMap:n,width:a,onTrackChanged:i}=t,r=(e,t)=>{const a=new Map(n);a.set(t,e),i(a)};return(0,e.jsx)("div",{className:"sidebar-body h-100",style:{width:a}},[...n.keys()].filter((e=>n.get(e).isActive)).map((t=>(0,e.jsx)(Et,{key:t,trackKey:t,track:n.get(t),onTrackClicked:r}))),[...n.keys()].filter((e=>!n.get(e).isActive)).map((t=>(0,e.jsx)(Et,{key:t,trackKey:t,track:n.get(t),onTrackClicked:r}))))}function Rt(t){const{width:n,height:a,trackMap:i,onTrackChanged:r}=t;return(0,e.jsx)("div",{className:"sidebar d-flex",style:{width:n,height:a}},(0,e.jsx)(Lt,{trackMap:i,width:n,onTrackChanged:r}))}function jt(){return jt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},jt.apply(null,arguments)}function Mt(e,t){return Mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Mt(e,t)}function Tt(e){return Tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Tt(e)}function Ft(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ft=function(){return!!e})()}function Ct(e){var t="function"==typeof Map?new Map:void 0;return Ct=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(Ft())return Reflect.construct.apply(null,arguments);var a=[null];a.push.apply(a,t);var i=new(e.bind.apply(e,a));return n&&Mt(i,n.prototype),i}(e,arguments,Tt(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Mt(n,e)},Ct(e)}var At=function(e){var t,n;function a(t){return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this)}return n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,Mt(t,n),a}(Ct(Error));function Ot(e,t){return e.substr(-t.length)===t}var Pt=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;function _t(e){return"string"!=typeof e?e:e.match(Pt)?parseFloat(e):e}var Vt=function(e){return function(t,n){void 0===n&&(n="16px");var a=t,i=n;if("string"==typeof t){if(!Ot(t,"px"))throw new At(69,e,t);a=_t(t)}if("string"==typeof n){if(!Ot(n,"px"))throw new At(70,e,n);i=_t(n)}if("string"==typeof a)throw new At(71,t,e);if("string"==typeof i)throw new At(72,n,e);return""+a/i+e}};Vt("em");Vt("rem");function $t(e){return Math.round(255*e)}function Bt(e,t,n){return $t(e)+","+$t(t)+","+$t(n)}function Gt(e,t,n,a){if(void 0===a&&(a=Bt),0===t)return a(n,n,n);var i=(e%360+360)%360/60,r=(1-Math.abs(2*n-1))*t,o=r*(1-Math.abs(i%2-1)),s=0,l=0,c=0;i>=0&&i<1?(s=r,l=o):i>=1&&i<2?(s=o,l=r):i>=2&&i<3?(l=r,c=o):i>=3&&i<4?(l=o,c=r):i>=4&&i<5?(s=o,c=r):i>=5&&i<6&&(s=r,c=o);var u=n-r/2;return a(s+u,l+u,c+u)}var zt={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var Ht=/^#[a-fA-F0-9]{6}$/,Wt=/^#[a-fA-F0-9]{8}$/,Ut=/^#[a-fA-F0-9]{3}$/,qt=/^#[a-fA-F0-9]{4}$/,Jt=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,Yt=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,Qt=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,Xt=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function Kt(e){if("string"!=typeof e)throw new At(3);var t=function(e){if("string"!=typeof e)return e;var t=e.toLowerCase();return zt[t]?"#"+zt[t]:e}(e);if(t.match(Ht))return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16)};if(t.match(Wt)){var n=parseFloat((parseInt(""+t[7]+t[8],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16),alpha:n}}if(t.match(Ut))return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16)};if(t.match(qt)){var a=parseFloat((parseInt(""+t[4]+t[4],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16),alpha:a}}var i=Jt.exec(t);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var r=Yt.exec(t.substring(0,50));if(r)return{red:parseInt(""+r[1],10),green:parseInt(""+r[2],10),blue:parseInt(""+r[3],10),alpha:parseFloat(""+r[4])>1?parseFloat(""+r[4])/100:parseFloat(""+r[4])};var o=Qt.exec(t);if(o){var s="rgb("+Gt(parseInt(""+o[1],10),parseInt(""+o[2],10)/100,parseInt(""+o[3],10)/100)+")",l=Jt.exec(s);if(!l)throw new At(4,t,s);return{red:parseInt(""+l[1],10),green:parseInt(""+l[2],10),blue:parseInt(""+l[3],10)}}var c=Xt.exec(t.substring(0,50));if(c){var u="rgb("+Gt(parseInt(""+c[1],10),parseInt(""+c[2],10)/100,parseInt(""+c[3],10)/100)+")",d=Jt.exec(u);if(!d)throw new At(4,t,u);return{red:parseInt(""+d[1],10),green:parseInt(""+d[2],10),blue:parseInt(""+d[3],10),alpha:parseFloat(""+c[4])>1?parseFloat(""+c[4])/100:parseFloat(""+c[4])}}throw new At(5)}function Zt(e){return function(e){var t,n=e.red/255,a=e.green/255,i=e.blue/255,r=Math.max(n,a,i),o=Math.min(n,a,i),s=(r+o)/2;if(r===o)return void 0!==e.alpha?{hue:0,saturation:0,lightness:s,alpha:e.alpha}:{hue:0,saturation:0,lightness:s};var l=r-o,c=s>.5?l/(2-r-o):l/(r+o);switch(r){case n:t=(a-i)/l+(a<i?6:0);break;case a:t=(i-n)/l+2;break;default:t=(n-a)/l+4}return t*=60,void 0!==e.alpha?{hue:t,saturation:c,lightness:s,alpha:e.alpha}:{hue:t,saturation:c,lightness:s}}(Kt(e))}var en=function(e){return 7===e.length&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e};function tn(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function nn(e){return tn(Math.round(255*e))}function an(e,t,n){return en("#"+nn(e)+nn(t)+nn(n))}function rn(e,t,n){return Gt(e,t,n,an)}function on(e,t,n){if("number"==typeof e&&"number"==typeof t&&"number"==typeof n)return rn(e,t,n);if("object"==typeof e&&void 0===t&&void 0===n)return rn(e.hue,e.saturation,e.lightness);throw new At(1)}function sn(e,t,n,a){if("number"==typeof e&&"number"==typeof t&&"number"==typeof n&&"number"==typeof a)return a>=1?rn(e,t,n):"rgba("+Gt(e,t,n)+","+a+")";if("object"==typeof e&&void 0===t&&void 0===n&&void 0===a)return e.alpha>=1?rn(e.hue,e.saturation,e.lightness):"rgba("+Gt(e.hue,e.saturation,e.lightness)+","+e.alpha+")";throw new At(2)}function ln(e,t,n){if("number"==typeof e&&"number"==typeof t&&"number"==typeof n)return en("#"+tn(e)+tn(t)+tn(n));if("object"==typeof e&&void 0===t&&void 0===n)return en("#"+tn(e.red)+tn(e.green)+tn(e.blue));throw new At(6)}function cn(e,t,n,a){if("string"==typeof e&&"number"==typeof t){var i=Kt(e);return"rgba("+i.red+","+i.green+","+i.blue+","+t+")"}if("number"==typeof e&&"number"==typeof t&&"number"==typeof n&&"number"==typeof a)return a>=1?ln(e,t,n):"rgba("+e+","+t+","+n+","+a+")";if("object"==typeof e&&void 0===t&&void 0===n&&void 0===a)return e.alpha>=1?ln(e.red,e.green,e.blue):"rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")";throw new At(7)}function un(e){if("object"!=typeof e)throw new At(8);if(function(e){return"number"==typeof e.red&&"number"==typeof e.green&&"number"==typeof e.blue&&"number"==typeof e.alpha}(e))return cn(e);if(function(e){return"number"==typeof e.red&&"number"==typeof e.green&&"number"==typeof e.blue&&("number"!=typeof e.alpha||void 0===e.alpha)}(e))return ln(e);if(function(e){return"number"==typeof e.hue&&"number"==typeof e.saturation&&"number"==typeof e.lightness&&"number"==typeof e.alpha}(e))return sn(e);if(function(e){return"number"==typeof e.hue&&"number"==typeof e.saturation&&"number"==typeof e.lightness&&("number"!=typeof e.alpha||void 0===e.alpha)}(e))return on(e);throw new At(8)}function dn(e,t,n){return function(){var a=n.concat(Array.prototype.slice.call(arguments));return a.length>=t?e.apply(this,a):dn(e,t,a)}}function fn(e){return dn(e,e.length,[])}fn((function(e,t){if("transparent"===t)return t;var n=Zt(t);return un(jt({},n,{hue:n.hue+parseFloat(e)}))}));function pn(e,t,n){return Math.max(e,Math.min(t,n))}fn((function(e,t){if("transparent"===t)return t;var n=Zt(t);return un(jt({},n,{lightness:pn(0,1,n.lightness-parseFloat(e))}))}));fn((function(e,t){if("transparent"===t)return t;var n=Zt(t);return un(jt({},n,{saturation:pn(0,1,n.saturation-parseFloat(e))}))}));fn((function(e,t){if("transparent"===t)return t;var n=Zt(t);return un(jt({},n,{lightness:pn(0,1,n.lightness+parseFloat(e))}))}));var mn=fn((function(e,t,n){if("transparent"===t)return n;if("transparent"===n)return t;if(0===e)return n;var a=Kt(t),i=jt({},a,{alpha:"number"==typeof a.alpha?a.alpha:1}),r=Kt(n),o=jt({},r,{alpha:"number"==typeof r.alpha?r.alpha:1}),s=i.alpha-o.alpha,l=2*parseFloat(e)-1,c=((l*s==-1?l:l+s)/(1+l*s)+1)/2,u=1-c;return cn({red:Math.floor(i.red*c+o.red*u),green:Math.floor(i.green*c+o.green*u),blue:Math.floor(i.blue*c+o.blue*u),alpha:i.alpha*parseFloat(e)+o.alpha*(1-parseFloat(e))})}));fn((function(e,t){if("transparent"===t)return t;var n=Kt(t);return cn(jt({},n,{alpha:pn(0,1,(100*("number"==typeof n.alpha?n.alpha:1)+100*parseFloat(e))/100)}))}));fn((function(e,t){if("transparent"===t)return t;var n=Zt(t);return un(jt({},n,{saturation:pn(0,1,n.saturation+parseFloat(e))}))}));fn((function(e,t){return"transparent"===t?t:un(jt({},Zt(t),{hue:parseFloat(e)}))}));fn((function(e,t){return"transparent"===t?t:un(jt({},Zt(t),{lightness:parseFloat(e)}))}));fn((function(e,t){return"transparent"===t?t:un(jt({},Zt(t),{saturation:parseFloat(e)}))}));fn((function(e,t){return"transparent"===t?t:mn(parseFloat(e),"rgb(0, 0, 0)",t)}));fn((function(e,t){return"transparent"===t?t:mn(parseFloat(e),"rgb(255, 255, 255)",t)}));fn((function(e,t){if("transparent"===t)return t;var n=Kt(t);return cn(jt({},n,{alpha:pn(0,1,+(100*("number"==typeof n.alpha?n.alpha:1)-100*parseFloat(e)).toFixed(2)/100)}))}));var gn=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function hn(t){const{eventDS:n,record:a,fieldInfos:i,fields:o,isActive:s,contentWidth:l,measureRange:c,trackIndex:d,subtypeLayers:f,onItemClick:p,onItemHover:m,onItemHoverExit:g}=t,h=e.React.useRef(null),y=(0,O.getTheme)(),[x,S]=e.React.useState(null),[w,I]=e.React.useState(null),[N,k]=e.React.useState(null),[E,L]=e.React.useState(!1),[R,j]=e.React.useState(!1),[M,T]=e.React.useState(null),C=.75,[A,P]=e.React.useState(!1),{selectedSldId:_,pendingEdits:V}=v(),$=b(),B=e=>{e.stopPropagation(),$({type:"SET_SELECTED_SLD_ID",value:ie()}),p(a,i,ie(),!1)},G=e=>{e.stopPropagation(),$({type:"SET_SELECTED_SLD_ID",value:ie()}),p(a,i,ie(),!0)},z=e=>{e.stopPropagation();const t=W();m(t,ie())},H=e=>{e.stopPropagation(),g()},W=()=>{if((0,u.isDefined)(M)&&!V.has(ie()))return M;const e=new Map,t=It(i,a),n=Dt(i);e.set(t.originalFieldName,xt(o,i,a,f)),e.set(n.originalFieldName,a.attributes.get(n.originalFieldName));const r={attributes:e,fromMeasure:a.fromMeasure,toMeasure:a.toMeasure,index:a.index,isPoint:a.isPoint,hasValue:a.hasValue,selected:a.selected,displayField:a.displayField,geometry:a.geometry,objectId:a.objectId,fieldInfos:i,attributeBackgrounds:U()};return T(r),r},U=()=>{const e=new Map,t=It(i,a),n=Dt(i);return e.set(t.originalFieldName,cn(N.r,N.g,N.b,.5)),e.set(n.originalFieldName,"transparent"),e};e.React.useEffect((()=>{s&&(()=>{gn(this,void 0,void 0,(function*(){a.isPoint&&!E?(yield q(),L(!0)):a.isPoint||(yield J(),L(!0))}))})()}),[s,l]),e.React.useEffect((()=>{const e=()=>gn(this,void 0,void 0,(function*(){a.isPoint?yield q(!0):a.isPoint||(yield J(!0))}));V.has(ie())&&(e(),P(!0))}),[V]);const q=e=>gn(this,void 0,void 0,(function*(){if(!a.hasValue)return;const[t,i,r]=yield Promise.all([Z(),ee(),Nt(a,null,!0)]);S(t),I(i);const o=n;yield t.getDisplayedSymbol(r,{renderer:o.layer.renderer}).then((n=>gn(this,void 0,void 0,(function*(){var a,s;if(Y(r,o,t,e),!(0,u.isDefined)(n))return;const l=n.toJSON(),c=null!==(s=null===(a=null==l?void 0:l.symbol)||void 0===a?void 0:a.symbolLayers)&&void 0!==s?s:null;if((0,u.isDefined)(c)){l.symbolLayers=X(c,!1),n=i.fromJSON(l);const e=document.getElementById(ie()),a=e.getElementsByTagName("img");a.length>0&&e.removeChild(a[0]);const r=yield t.renderPreviewHTML(n,{node:e,size:18});r.style.width="24px",r.style.height="24px";const o=e.getElementsByTagName("img")[0],s=yt(o,D);o.src=s,e.style.backgroundImage=`url(${s})`,e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center",e.removeChild(o)}else if("picture-marker"===n.type){const e=document.getElementById(ie()),t=document.createElement("img");t.src=null==n?void 0:n.url,e.style.backgroundImage=`url(${t.src})`,e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center",e.style.backgroundSize="contain"}else if((0,u.isDefined)(l)){l.size=D,n=i.fromJSON(l);const e=document.getElementById(ie()),a=e.getElementsByTagName("img");a.length>0&&e.removeChild(a[0]);const r=yield t.renderPreviewHTML(n,{node:e,size:18});r.style.width="24px",r.style.height="24px";const o=e.getElementsByTagName("img")[0],s=yt(o,D);o.src=s,e.style.backgroundImage=`url(${s})`,e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center",e.removeChild(o)}}))))})),J=e=>gn(this,void 0,void 0,(function*(){if(!a.hasValue)return;const t=document.getElementById(ie());if((0,u.isDefined)(t)){const i=n,[r,o,s]=yield Promise.all([Z(),ee(),Nt(a,i,!0)]);S(r),I(o),yield r.getDisplayedSymbol(s,{renderer:i.layer.renderer}).then((n=>gn(this,void 0,void 0,(function*(){var a,l;if(Q(t,s,i,r,e),!(0,u.isDefined)(n))return;const c=n.toJSON(),d=null!==(l=null===(a=null==c?void 0:c.symbol)||void 0===a?void 0:a.symbolLayers)&&void 0!==l?l:null;if((0,u.isDefined)(d)&&d.length>1){c.symbolLayers=X(d,!1),n=o.fromJSON(c);const e=t.getElementsByTagName("img");e.length>0&&t.removeChild(e[0]),yield r.renderPreviewHTML(n,{node:t,size:{width:t.getBoundingClientRect().width*C,height:26.25},symbolConfig:{isSquareFill:!0}});const a=t.getElementsByTagName("img")[0];if(""===a.src||0===a.width)return void t.removeChild(a);const i=yt(a);a.src=i,t.style.backgroundImage=`url(${i})`,t.style.backgroundPosition="center",t.removeChild(a),j(!0)}}))))}})),Y=(e,t,n,a)=>gn(this,void 0,void 0,(function*(){if(!(0,u.isDefined)(N)||a){const a=yield n.getDisplayedColor(e,{renderer:t.layer.renderer});if((0,u.isDefined)(a))k(a);else{k({r:255,g:255,b:255,a:0})}}})),Q=(e,t,n,a,i)=>gn(this,void 0,void 0,(function*(){if(!(0,u.isDefined)(N)||i){const i=yield a.getDisplayedColor(t,{renderer:n.layer.renderer});if((0,u.isDefined)(i))e.style.background=cn(i.r,i.g,i.b,i.a),k(i);else{const t={r:255,g:255,b:255,a:0};e.style.background=cn(t.a,t.g,t.b,t.a),k(t)}}else e.style.background=cn(N.r,N.g,N.b,N.a)})),X=(e,t)=>{if(t)e.forEach((e=>{e.width=D}));else{let t=0;e.forEach((e=>{e.width>t&&(t=e.width)})),e.forEach((e=>{e.width=35-(t-e.width),e.capStyle="Butt",e.joinStyle="Round"}))}return e},K=(e,t,n)=>1-(.299*e+.587*t+.114*n)/255<.5,Z=()=>gn(this,void 0,void 0,(function*(){if(x)return x;{const t=yield(0,e.loadArcGISJSAPIModule)("esri/symbols/support/symbolUtils");return S(t),t}})),ee=()=>gn(this,void 0,void 0,(function*(){if(w)return w;{const t=yield(0,e.loadArcGISJSAPIModule)("esri/symbols/support/jsonUtils");return I(t),t}})),te=()=>{const e=ne(),t=ae();return t-e>0?t-e:1},ne=()=>{const e=a.fromMeasure;if(!isNaN(e)){const t=mt(e,c,l);return a.isPoint?t-12:t}return 0},ae=()=>{const e=a.toMeasure;return isNaN(e)?ne():mt(e,c,l)},ie=()=>d+"-"+a.index;return(0,e.jsx)("div",null,s&&a.hasValue&&a.isPoint&&(0,e.jsx)("div",{id:ie(),className:(0,e.classNames)("sld-item-point-active",_===ie()?"sld-item-selected-point":"",A?"sld-item-edited-point":""),ref:h,style:{left:ne(),background:"transparent"},onMouseEnter:z,onMouseLeave:H,onClick:B,onDoubleClick:G}),s&&a.hasValue&&!a.isPoint&&(0,e.jsx)("div",{id:ie(),ref:h,className:(0,e.classNames)("sld-item-line-active",_===ie()?"sld-item-selected-line":"",A?"sld-item-edited-line":""),onMouseEnter:z,onMouseLeave:H,onClick:B,onDoubleClick:G,style:{width:te(),left:ne()}},(0,e.jsx)("div",{className:"sld-item-label-wrapper"},(0,e.jsx)(r.Label,{className:"sld-item-label",centric:!0,style:{color:(0,u.isDefined)(N)?K(N.r,N.g,N.b)?"#000":"#fff":"#000",background:R&&(0,u.isDefined)(N)?cn(N.r,N.g,N.b,N.a):"transparent",visibility:""!==xt(o,i,a,f)?"visible":"hidden"}},xt(o,i,a,f)))),!s&&a.hasValue&&a.isPoint&&(0,e.jsx)("div",{id:ie(),className:"sld-item-point-inactive",style:{width:"24px",left:ne(),background:"transparent"}},(0,e.jsx)(F.CalciteIcon,{icon:"bullet-point-large",scale:"m",css:e.css`--calcite-ui-icon-color: ${y.sys.color.action.disabled.text};`})),!s&&a.hasValue&&!a.isPoint&&(0,e.jsx)("div",{id:ie(),className:"sld-item-line-inactive",style:{width:te(),left:ne()}}))}function yn(t){const{rowIndex:n,allLayersDS:a,trackMap:i,contentWidth:r,measureRange:o,isActive:s,featureLayer:l,subtypeLayers:c,onItemClick:d,onItemHover:f,onItemHoverExit:p}=t,{fieldInfo:m}=v(),g=()=>{if((0,u.isDefined)(a)&&a.length){const e=a.find((e=>e.layer.layerId.toString()===i.layerId));if((0,u.isDefined)(e))return e}return null},h=(e,t,n,a)=>{d(e,i,t,n,a)},y=(e,t)=>{f(e,i,t)},b=e.React.useMemo((()=>m.filter((e=>e.eventName===i.layerName||""===e.eventName))),[m,i.layerName]),x=e.React.useMemo((()=>(0,u.isDefined)(l)?l.fields.filter((e=>e.alias.includes(".")&&(e.alias.split(".")[0]===i.layerName||""===e.alias.split(".")[0]))):null),[l,i.layerName]);return(0,e.jsx)("div",{"data-row-id":"sld-row-"+n,key:"sld-row-"+n,className:(0,e.classNames)("sld-row d-flex",s?"active":"inactive"),style:{width:r,flexDirection:"row",position:"relative"}},i.records.map((t=>(0,e.jsx)(hn,{key:t.index,eventDS:g(),record:t,fieldInfos:b,fields:x,featureLayer:l,isActive:s,contentWidth:r,measureRange:o,trackIndex:i.index,subtypeLayers:c,onItemClick:h,onItemHover:y,onItemHoverExit:p}))))}const vn=function(){return ke.Date.now()};var bn=Math.max,xn=Math.min;const Sn=function(e,t,n){var a,i,r,o,s,l,c=0,u=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=a,r=i;return a=i=void 0,c=t,o=e.apply(r,n)}function m(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=r}function g(){var e=vn();if(m(e))return h(e);s=setTimeout(g,function(e){var n=t-(e-l);return d?xn(n,r-(e-c)):n}(e))}function h(e){return s=void 0,f&&a?p(e):(a=i=void 0,o)}function y(){var e=vn(),n=m(e);if(a=arguments,i=this,l=e,n){if(void 0===s)return function(e){return c=e,s=setTimeout(g,t),u?p(e):o}(l);if(d)return clearTimeout(s),s=setTimeout(g,t),p(l)}return void 0===s&&(s=setTimeout(g,t)),o}return t=Je(t)||0,Me(n)&&(u=!!n.leading,r=(d="maxWait"in n)?bn(Je(n.maxWait)||0,t):r,f="trailing"in n?!!n.trailing:f),y.cancel=function(){void 0!==s&&clearTimeout(s),c=0,a=l=i=s=void 0},y.flush=function(){return void 0===s?o:h(vn())},y};var wn=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function In(t){const{allLayersDS:n,trackMap:a,contentWidth:i,measureRange:o,featureLayer:s,subtypeLayers:l,onItemClick:c}=t,[d,f]=e.React.useState(""),[p,m]=e.React.useState(new Map),[g,h]=e.React.useState(!1),[y,x]=e.React.useState(new Map),{highlightColor:S,highlightLayer:w,selectedSldId:I,jimuMapView:D}=v(),[N,k]=e.React.useState(null),[E,L]=e.React.useState(null),[j,M]=e.React.useState(null),T=(0,O.getTheme)(),C=b(),A=()=>{""!==I&&I!==j||(M(null),m(new Map),x(new Map),L(null),h(!1))},P=(e,t,n)=>{""!==I&&I!==n||(k(e),L(t),M(n),V())},_=(e,t,n,a,i)=>wn(this,void 0,void 0,(function*(){h(!1),i||I!==a?i?(yield $(e),c(e,t,n)):(yield $(e),c(null,null,null)):C({type:"SET_SELECTED_SLD_ID",value:""})}));e.React.useEffect((()=>{""===I&&w.removeAll()}),[I]);const V=(t=>{const n=e.React.useRef();return e.React.useEffect((()=>{n.current=t}),[t]),e.React.useMemo((()=>Sn((()=>{var e;null===(e=n.current)||void 0===e||e.call(n)}),1e3)),[])})((()=>{(0,u.isDefined)(N)&&(0,u.isDefined)(E)&&(0,u.isDefined)(j)&&(""!==I&&I!==j||(h(!0),f(j),m(N.attributes),x(N.attributeBackgrounds),L(E)))})),$=e=>wn(this,void 0,void 0,(function*(){if((0,u.isDefined)(e)&&(0,u.isDefined)(w)){R(D,w),w.removeAll();const t=yield Nt(e),n=yield(0,u.getGeometryGraphic)(t,S,4,!e.isPoint);w.add(n)}})),B=()=>(0,u.isDefined)(E)?E.layerName:"";return(0,e.jsx)("div",{className:"sld-body h-100",style:{width:i}},[...a.keys()].filter((e=>a.get(e).isActive)).map(((t,r)=>(0,e.jsx)(yn,{key:a.get(t).index,rowIndex:r,allLayersDS:n,featureLayer:s,trackMap:a.get(t),contentWidth:i,measureRange:o,isActive:!0,subtypeLayers:l,onItemClick:_,onItemHover:P,onItemHoverExit:A}))),[...a.keys()].filter((e=>!a.get(e).isActive)).map(((t,r)=>(0,e.jsx)(yn,{key:a.get(t).index,rowIndex:r,allLayersDS:n,featureLayer:s,trackMap:a.get(t),contentWidth:i,measureRange:o,isActive:!1,subtypeLayers:l,onItemClick:c,onItemHover:P,onItemHoverExit:A}))),(0,e.jsx)(F.CalcitePopover,{autoClose:void 0,closable:void 0,open:!!g||void 0,overlayPositioning:"absolute",placement:"auto",scale:"s",label:B(),heading:B(),referenceElement:d,style:{borderRadius:"5px",boxShadow:"4px 4px 8px 2px rgba(0, 0, 0, 0.3)",border:`1px solid ${e.polished.rgba(T.sys.color.surface.overlayHint,.5)}`}},(0,e.jsx)("div",{style:{margin:"10px"}},[...p.keys()].map((t=>(0,e.jsx)("span",{key:t},(0,e.jsx)("div",{style:{background:y.get(t),marginBottom:"3px"}},(0,e.jsx)(r.Label,{centric:!0,style:{margin:"2px 5px"}},`${(e=>{if(!(0,u.isDefined)(N))return"";const t=N.fieldInfos.find((t=>t.originalFieldName===e));return(0,u.isDefined)(t)?t.originalFieldAlias:e})(t)}: ${p.get(t)}`))))))))}function Dn(t){const{trackMap:n,height:a,containerWidth:i,contentWidth:r,measureRange:o,featureLayer:s,subtypeLayers:l,onItemClick:c}=t,{jimuMapView:d}=v(),f=e.React.useMemo((()=>{if(d)return(0,u.getMapAllLayers)(d.mapWidgetId)}),[d]);return(0,e.jsx)("div",{className:"sld",style:{width:i,height:a}},(0,e.jsx)(In,{allLayersDS:f,trackMap:n,contentWidth:r,measureRange:o,featureLayer:s,subtypeLayers:l,onItemClick:c}))}function Nn(n){const{sidebarWidth:a,zoom:i,measureRange:o,scrollPosition:s,onZoomChange:l,onNavForwardOrBack:c,onNavStartOrEnd:u}=n,d=e.hooks.useTranslation(t);return(0,e.jsx)("div",{className:"sidebar-header d-flex",style:{width:a}},(0,e.jsx)(r.Tooltip,{placement:"auto",title:d("navStart"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)("div",{className:"sidebar-icon"},(0,e.jsx)(F.CalciteIcon,{icon:"chevron-start",scale:"m",textLabel:d("navStart"),onClick:()=>{u(!1)}}))),(0,e.jsx)(r.Tooltip,{placement:"auto",title:d("navBack"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)("div",{className:"sidebar-icon"},(0,e.jsx)(F.CalciteIcon,{icon:"chevron-left",scale:"m",textLabel:d("navBack"),onClick:()=>{c(!1)}}))),(0,e.jsx)(r.Tooltip,{placement:"auto",title:d("zoomOut"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)("div",{className:"sidebar-icon"},(0,e.jsx)(F.CalciteIcon,{icon:"minus-circle",scale:"m",textLabel:d("zoomOut"),onClick:()=>{l(i/2<1?1:i/2)}}))),(0,e.jsx)(r.Tooltip,{placement:"auto",title:d("zoomIn"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)("div",{className:"sidebar-icon"},(0,e.jsx)(F.CalciteIcon,{icon:"plus-circle",scale:"m",textLabel:d("zoomIn"),onClick:()=>{const e=o.to-o.from,t=i*(a/e),n=s/i;l((n*i+a)/t-n*i/t<1?i:2*i)}}))),(0,e.jsx)(r.Tooltip,{placement:"auto",title:d("navForward"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)("div",{className:"sidebar-icon"},(0,e.jsx)(F.CalciteIcon,{icon:"chevron-right",scale:"m",textLabel:d("navForward"),onClick:()=>{c(!0)}}))),(0,e.jsx)(r.Tooltip,{placement:"auto",title:d("navEnd"),showArrow:!0,enterDelay:300,enterNextDelay:1e3},(0,e.jsx)("div",{className:"sidebar-icon"},(0,e.jsx)(F.CalciteIcon,{icon:"chevron-end",scale:"m",textLabel:d("navEnd"),onClick:()=>{u(!0)}}))))}function kn(t){const n=(0,O.getTheme)(),{width:a=0,zoom:i=1,range:r=[-1/0,1/0],scrollPosition:o=0,onClickOrHover:s}=t,l=V.default.useRef(null),[c,u]=V.default.useState(""),[d,f]=V.default.useState(""),[p,m]=V.default.useState(!1),[g,h]=V.default.useState(!1);V.default.useEffect((()=>{function e(e){l.current&&!l.current.contains(e.target)&&(m(!1),h(!1),s(null,!1,!1))}return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}}),[l,s]),V.default.useEffect((()=>{x(o,i)}),[o,i,a]);const y=e=>{const t=document.createElement("div");return t.style.display="none",t.style.color=e,document.body.appendChild(t),window.getComputedStyle(t,null).getPropertyValue("color")},v=e=>{if(0===c.length){const t=y(e);return u(t),t}return c},b=e=>{if(0===d.length){const t=y(e);return f(t),t}return d},x=(e,t)=>{const i=l.current.getContext("2d"),o=r[0]<0,s=w,c=v(n.sys.color.surface.background),u=b(n.sys.color.surface.backgroundHint),d=b(n.sys.color.surface.backgroundHint),f="transparent";i.rect(0,0,a,w),i.fillStyle=c,i.fill(),i.save(),i.scale(1,1),i.strokeStyle=u,i.lineWidth=1,i.font="12px sans-serif",i.fillStyle=d,i.textAlign="left",i.textBaseline="bottom",i.translate(.5,0),i.beginPath();const p=r[1]-r[0],m=t*(a/p),g=e/t==0?Number.MIN_VALUE:e/t,h=g*t/m,y=(g*t+a)/m;let x=Math.floor(h),S=ot(y-h,0);const I=Math.ceil(S/10);if(x%I!=0){const e=x%I;x-=e,S+=e}const D=Math.max(["left","center","right"].indexOf("left")-1,-1),N=[];let k=1;k=S>=6?8:S>=4?16:S>=2?32:64;for(let e=0;e<=S;++e){if(e%I!=0)continue;const t=(e+x)*(a/p),n=`${ot(p/a*t+r[0],1)}`,o=i.measureText(n).width;N.push({color:d,backgroundColor:f,value:t,text:n,textSize:o,isLast:!1})}0===N.length&&(N.push({color:d,backgroundColor:f,value:0,text:r[0].toString(),textSize:i.measureText(r[0].toString()).width,isLast:!1}),N.push({color:d,backgroundColor:f,value:a,text:r[1].toString(),textSize:i.measureText(r[1].toString()).width,isLast:!0}));for(let e=0;e<=S;++e){const n=e+x;if(!o&&n<0)continue;const r=(n*(a/p)-g)*t;if(S>=10){const t=I/k;if(e%I!=0)continue;for(let e=0;e<k;++e){const n=r+e*t*m;if(n<0||n>=a)continue;let o=s;o=0===e?s:e%4==0?22.5:e%2==0?15:11.25;const l=45-o,[c,u]=[n,l],[d,f]=[c,u+o];i.moveTo(c,u),i.lineTo(d,f)}}else for(let t=0;t<k;++t){const n=r+t/k*m;if(n<0||n>=a)continue;let o=s;o=0===t&&e%I==0?s:t%4==0?22.5:t%2==0?15:11.25;const l=45-o,[c,u]=[n,l],[d,f]=[c,u+o];i.moveTo(c,u),i.lineTo(d,f)}}i.stroke(),i.beginPath(),N.forEach((({value:e,backgroundColor:n,color:r,text:l,textSize:c,isLast:u})=>{if(!o&&e<0)return;const d=(e-g)*t;if(d<-m||d>=a+a/p*t)return;let f=0;f=u?17:20;let h=D;u&&(h=c/2);const[y,v]=[d+-3*h,f];if(n){let e=0;e=u?-c:0,i.save(),i.fillStyle=n,i.fillRect(y+e,0,c,s),i.restore()}i.save(),i.fillStyle=r,i.fillText(l,y,v),i.restore()})),i.restore()};return(0,e.jsx)("div",{className:"dyn-seg-ruler",style:{width:a},onMouseDown:e=>{g&&(m(!p),s(e,!p,g))},onMouseMove:e=>{g&&s(e,p,g)},onMouseEnter:e=>{h(!0)},onMouseLeave:e=>{h(!1),s(e,p,!1)}},(0,e.jsx)("canvas",{ref:l,width:a,height:w}))}function En(t){const{sidebarWidth:n,bodyWidth:a,contentWidth:i,measureRange:r,zoom:o,scrollPosition:s,onZoomChange:l,onNavForwardOrBack:c,onNavStartOrEnd:u,onClickOrHover:d}=t,[f,p]=e.React.useState(o);e.React.useEffect((()=>{p(o)}),[o]);const m=e.React.useCallback((e=>{p(e),l(e)}),[l]);return(0,e.jsx)("div",{className:"header w-100 d-flex"},(0,e.jsx)(Nn,{sidebarWidth:n,bodyWidth:a,contentWidth:i,zoom:f,measureRange:r,scrollPosition:s,onZoomChange:m,onNavForwardOrBack:c,onNavStartOrEnd:u}),(0,e.jsx)(kn,{width:a,range:[r.from,r.to],zoom:f,scrollPosition:s,onClickOrHover:d}))}var Ln=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function Rn(t){const{x:n,m:a,snapTolerance:i,isPopupActive:o,isHoverActive:s,trackMap:l,featureLayer:c,subtypeLayers:d,maxHeight:f,networkInfo:p,measureRange:m,contentWidth:g,sidebarWidth:h,scrollPos:y}=t,[b,x]=e.React.useState(new Map),{fieldInfo:S}=v(),[w,I]=e.React.useState(null),{jimuMapView:D}=v(),[N,k]=e.React.useState(n),[E,L]=e.React.useState(a),R=e.React.useRef(null),j=(0,O.getTheme)();e.React.useEffect((()=>{const e=()=>Ln(this,void 0,void 0,(function*(){const e=new Map;if(!isNaN(a)){const t=V();k(t[0]),L(t[1]),yield Promise.all([...l.keys()].map((n=>Ln(this,void 0,void 0,(function*(){return l.get(n).isActive&&(yield Promise.all(l.get(n).records.map((a=>Ln(this,void 0,void 0,(function*(){if(a.hasValue&&B(a,t[1])){const t=A(l.get(n).layerName),i=C(l.get(n).layerName),r=l.get(n).index.toString()+"-"+a.index.toString(),o=yield P(l.get(n),a),s={displayField:It(i,a).originalFieldAlias,displayValue:xt(t,S,a,d),background:o,order:l.get(n).index};e.set(r,s)}})))))),n}))))).then((()=>{x(e)}))}}));isNaN(a)||e()}),[a]);const M=e.React.useMemo((()=>{if(D)return(0,u.getMapAllLayers)(D.mapWidgetId)}),[D]),T=()=>Ln(this,void 0,void 0,(function*(){if(w)return w;{const t=yield(0,e.loadArcGISJSAPIModule)("esri/symbols/support/symbolUtils");return I(t),t}})),C=e=>S.filter((t=>t.eventName===e)),A=e=>(0,u.isDefined)(c)?c.fields.filter((t=>t.alias.includes(".")&&t.alias.split(".")[0]===e)):null,P=(e,t)=>Ln(this,void 0,void 0,(function*(){const[n,a]=yield Promise.all([T(),Nt(t,null,!0)]),i=_(e),r=yield n.getDisplayedColor(a,{renderer:i.layer.renderer});return(0,u.isDefined)(r)?cn(r.r,r.g,r.b,.5):cn(255,255,255,0)})),_=e=>{if((0,u.isDefined)(M)&&M.length){const t=M.find((t=>t.layer.layerId.toString()===e.layerId));if((0,u.isDefined)(t))return t}return null},V=()=>{const e=null==p?void 0:p.mTolerance,t=[...l.keys()];for(let n=0;n<t.length;n++){const r=l.get(t[n]);if(r.isActive)for(let t=0;t<r.records.length;t++){const n=r.records[t];if(n.isPoint&&n.hasValue&&(0,u.atOrBetween)([a-i,a+i],n.fromMeasure,e))return[$(n.fromMeasure),n.fromMeasure]}}return[n,a]},$=e=>{if(isNaN(e))return NaN;const t=mt(e,m,g)+h-y;return Math.floor(t)},B=(e,t)=>{const n=null==p?void 0:p.mTolerance;return!(!(0,u.isWithinTolerance)(t,e.fromMeasure,n)&&!(0,u.isWithinTolerance)(t,e.toMeasure,n))||!e.isPoint&&t>e.fromMeasure&&t<e.toMeasure},G=()=>(0,u.isDefined)(p)?p.measurePrecision:0,z=()=>o||s;return(0,e.jsx)("div",{ref:R,id:"sld-marker",className:`sld-marker sld-marker--pointer ${z()?"sld-is-visible":""} `,style:{left:isNaN(N)?0:N}},(0,e.jsx)(F.CalcitePopover,{id:"sld-marker-popover",style:{minWidth:14*(isNaN(E)?0:E.toFixed(G()).toString().length)+"px",borderRadius:"5px",boxShadow:"4px 4px 8px 2px rgba(0, 0, 0, 0.3)",border:`1px solid ${e.polished.rgba(j.sys.color.surface.overlayHint,.5)}`},autoClose:void 0,closable:void 0,open:!!z()||void 0,overlayPositioning:"absolute",placement:"auto-start",offsetDistance:15,offsetSkidding:10,scale:"s",label:E.toFixed(G()),heading:E.toFixed(G()),referenceElement:"sld-marker"},o&&b.size>0&&(0,e.jsx)("div",{style:{padding:"10px",textWrap:"nowrap",maxHeight:f,overflow:"auto"}},[...new Map([...b.entries()].sort(((e,t)=>e[1].order-t[1].order))).keys()].map((t=>(0,e.jsx)("span",{key:t},(0,e.jsx)("div",{style:{background:b.get(t).background,marginBottom:"3px"}},(0,e.jsx)(r.Label,{centric:!0,style:{margin:"2px 5px"}},`${b.get(t).displayField}: ${b.get(t).displayValue}`))))))))}var jn=h(73387),Mn=h(38410),Tn=h(82228),Fn=h(44927);const Cn=e.React.forwardRef(((n,a)=>{const{trackRecord:i,eventInfo:o,eventRecords:s,featureLayer:l,eventFields:c,currentRecord:d,onApply:f}=n,[p,m]=e.React.useState(!1),[g,h]=e.React.useState(!1),[y,v]=e.React.useState(d),b=e.React.useRef(null),x=(0,O.getTheme)(),S=e.hooks.useTranslation(t);e.React.useImperativeHandle(a,(()=>({isEditPending:()=>!I(),applyEdit:()=>{D()}}))),e.React.useEffect((()=>{v(d)}),[d]);const w=()=>{const e=[];let t=[...i.attributes.keys()];t=t.filter((e=>e!==o.eventIdFieldName));for(let n=0;n<c.length;n++)if(c[n].editable&&t.includes(c[n].name))if("date"===c[n].type){const t=new Tn.default({fieldName:c[n].name,label:c[n].alias,input:new Fn.default({includeTime:!1})});e.push(t)}else{const t=new Tn.default({fieldName:c[n].name,label:c[n].alias,editableExpression:"true"});e.push(t)}return new Mn.default({elements:e})};e.React.useEffect((()=>{if((0,u.isDefined)(l)&&(0,u.isDefined)(y)&&l&&s.length>0){const e=document.getElementById("formDiv");b.current=new jn.default({container:e,layer:l,feature:y,formTemplate:w()}),b.current.on("submit",(e=>{const{invalid:t,values:n}=e;if(t.length)return;Object.keys(n).forEach((e=>{i.attributes.has(e)&&i.attributes.set(e,n[e])})),y.attributes=n,m(!1),v(y),f(i)})),b.current.on("value-change",(e=>{var t,n;const{feature:a,fieldName:i,value:r}=e,o=null===(t=b.current.viewModel)||void 0===t?void 0:t.submittable;h(o),r!==(null===(n=null==a?void 0:a.attributes)||void 0===n?void 0:n[i])?m(!0):m(!1)}))}}),[y]);const I=()=>!p||!g,D=()=>{var e;null===(e=b.current.viewModel)||void 0===e||e.submit()};return(0,e.jsx)("div",{className:"editable-fields d-flex w-100 h-100",style:{flexDirection:"column"}},(0,e.jsx)("div",{style:{background:x.sys.color.surface.paper},css:(0,u.getCalciteBasicTheme)()},(0,e.jsx)(r.Label,{size:"lg",centric:!0,style:{fontWeight:600,paddingLeft:"15px",margin:"0px"}},S("editableFields")),(0,e.jsx)("div",{id:"formDiv",style:{width:"100%",backgroundColor:x.sys.color.surface.paper}}),(0,e.jsx)(F.CalciteButton,{style:{padding:"0px 15px 15px 15px"},appearance:"solid",scale:"m",width:"full",alignment:"center",kind:"brand",disabled:!!I()||void 0,label:S("apply"),onClick:D},S("apply"))))}));function An(n){const{eventInfo:a,eventFields:i,subtypeLayers:o,featureLayer:s,currentRecord:l}=n,c=e.hooks.useTranslation(t),d=(0,O.getTheme)(),f=e=>{if((0,u.isDefined)(l)){const t=l.attributes[e.name];return function(e,t,n,a){return St(wt(e,null,t),e,null,n,a)}(e,s,t,o)}};return(0,e.jsx)("div",{className:"non-editable-fields d-flex w-100 h-100",style:{flexDirection:"column",paddingTop:"15px"}},(0,e.jsx)("div",{style:{background:d.sys.color.surface.paper,padding:"0px 15px 15px 15px"},css:(0,u.getCalciteBasicTheme)()},(0,e.jsx)(r.Label,{size:"lg",centric:!0,style:{fontWeight:600,margin:"0px"}},c("nonEditableFields")),(0,e.jsx)(F.CalciteTable,{caption:c("nonEditableFields"),bordered:!0,className:"table-container",scale:"m",layout:"fixed"},(0,e.jsx)(F.CalciteTableRow,{slot:"table-header"},(0,e.jsx)(F.CalciteTableHeader,{heading:c("attribute")}),(0,e.jsx)(F.CalciteTableHeader,{heading:c("value")})),(()=>{if(!(0,u.isDefined)(l))return[];const e=a.lrsFields.map((e=>e.alias)),t=(0,u.getExistingFieldNames)();let n=i.filter((t=>e.includes(t.alias)));return n=n.filter((e=>!t.includes(e.name.toUpperCase()))),n})().map(((t,n)=>(0,e.jsx)(F.CalciteTableRow,{key:n},(0,e.jsx)(F.CalciteTableCell,{alignment:"center"},(0,e.jsx)("div",{className:"w-100 d-flex"},(0,e.jsx)(r.Label,{title:t.alias,className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"}},t.alias))),(0,e.jsx)(F.CalciteTableCell,{alignment:"center"},(0,e.jsx)("div",{className:"w-100 d-flex"},(0,e.jsx)(r.Label,{title:f(t),className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"}},f(t))))))))))}var On=h(46420),Pn=h.n(On),_n=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(n[a[i]]=e[a[i]])}return n};const Vn=t=>{const n=window.SVG,{className:a}=t,i=_n(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",a);return n?e.React.createElement(n,Object.assign({className:r,src:Pn()},i)):e.React.createElement("svg",Object.assign({className:r},i))};var $n=h(85633);const Bn=e.React.forwardRef(((n,a)=>{const{track:i,trackRecord:o,eventEsriFields:s,eventInfo:l,currentRecord:c,allRecords:d,networkInfo:f,featureLayer:p,refresh:m}=n,[g,h]=e.React.useState(null),[y,v]=e.React.useState([]),[b,x]=e.React.useState([]),S=e.hooks.useTranslation(t),w=(0,O.getTheme)();e.React.useImperativeHandle(a,(()=>({getStats:()=>b}))),e.React.useEffect((()=>{if((0,u.isDefined)(l)&&(0,u.isDefined)(s)){const e=I();N(e)}}),[i,o,l,s,c]),e.React.useEffect((()=>{if(m){const e=I();N(e)}}),[m]);const I=()=>{const e=l.lrsFields.map((e=>e.alias)),t=(0,u.getExistingFieldNames)(),n=s.filter((n=>(0,u.isNumber)(n.type)&&!e.includes(n.alias)&&!t.includes(n.name.toUpperCase())&&!(0,u.isDefined)(n.domain)&&o.attributes.has(n.name)));return v(n),n.length?(h(n[0]),n[0]):null},D=(e,t,n,a,i,r)=>{var o,s,l,c,u,d;const f=[];return f.push([S("historicalFirstLabel"),null!==(o=null==e?void 0:e.toString())&&void 0!==o?o:""]),f.push([S("historicalLastLabel"),null!==(s=null==t?void 0:t.toString())&&void 0!==s?s:""]),f.push([S("historicalMinimumLabel"),null!==(l=null==n?void 0:n.toString())&&void 0!==l?l:""]),f.push([S("historicalMaximumLabel"),null!==(c=null==a?void 0:a.toString())&&void 0!==c?c:""]),f.push([S("meanLabel"),null!==(u=null==i?void 0:i.toString())&&void 0!==u?u:""]),f.push([S("medianLabel"),null!==(d=null==r?void 0:r.toString())&&void 0!==d?d:""]),f},N=e=>{var t,n;let a=D();if((0,u.isDefined)(d)&&(0,u.isDefined)(c)&&(0,u.isDefined)(f)&&(0,u.isDefined)(e)&&d.length){const r=null===(t=null==p?void 0:p.editFieldsInfo)||void 0===t?void 0:t.creationDateField,o=new Map;i.records.forEach((e=>{const t=function(e){var t;const n=e.fieldInfos.find((e=>e.isOidField));return(0,u.isDefined)(n)&&null!==(t=e.attributes.get(n.featureFieldName))&&void 0!==t?t:NaN}(e);isNaN(t)||o.set(t,e)}));let s=null,l=null,c=NaN,f=NaN,m=NaN,g=NaN,h=NaN,y=NaN;const v=[];if(d.forEach((t=>{let n=t.attributes[e.name];const a=t.getObjectId();if(o.has(a)){n=o.get(a).attributes.get(e.name)}if((0,u.isDefined)(n)&&!isNaN(n)){const e=t.attributes[r];if((0,u.isDefined)(e)){const t=new Date(e);(!(0,u.isDefined)(s)||t<s)&&(c=n,s=t),(!(0,u.isDefined)(l)||t>l)&&(f=n,l=t)}v.push(n)}})),v.length>0){const e=k(v);g=ot(Math.min(...v),e),h=ot(Math.max(...v),e),y=ot(v.reduce(((e,t)=>e+t),0)/v.length,e);const t=[...v].sort(((e,t)=>e-t)),i=null!==(n=Math.floor(t.length/2))&&void 0!==n?n:0;m=t.length%2?ot(t[i],e):ot((t[i-1]+t[i])/2,e),a=D(c,f,g,h,y,m)}}x(a)},k=e=>{let t=0;return e.forEach((e=>{const n=E(e);n>t&&(t=n)})),t},E=e=>{if(!isFinite(e))return 0;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,n++;return n},L=y&&y.length;return(0,e.jsx)("div",{className:"statistics d-flex w-100 h-100",style:{flexDirection:"column",paddingTop:"15px"}},L?(0,e.jsx)("div",{style:{margin:"0px",background:w.sys.color.surface.paper,padding:"0px 15px 15px 15px"},css:(0,u.getCalciteBasicTheme)()},(0,e.jsx)(r.Label,{className:"statistic-label text-truncate",size:"lg",centric:!0,style:{fontWeight:600,margin:"0px"}},S("statistics")),(0,e.jsx)(r.Select,{className:"statistics-select",style:{marginBottom:"15px"},value:g.alias,onChange:e=>{(e=>{const t=s.find((t=>t.alias===e));h(t),N(t)})(e.target.value)}},y.map(((t,n)=>(0,e.jsx)("option",{key:t.alias,value:t.alias},t.alias)))),(0,e.jsx)(F.CalciteTable,{caption:S("statistics"),bordered:!0,className:"table-container",scale:"m",layout:"fixed"},(0,e.jsx)(F.CalciteTableRow,{slot:"table-header"},(0,e.jsx)(F.CalciteTableHeader,{heading:S("attribute")}),(0,e.jsx)(F.CalciteTableHeader,{heading:S("value")})),b.map(((t,n)=>(0,e.jsx)(F.CalciteTableRow,{key:n},(0,e.jsx)(F.CalciteTableCell,{alignment:"center"},(0,e.jsx)("div",{className:"w-100 d-flex"},(0,e.jsx)(r.Label,{title:t[0],className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"}},t[0]))),(0,e.jsx)(F.CalciteTableCell,{alignment:"center"},(0,e.jsx)("div",{className:"w-100 d-flex"},(0,e.jsx)(r.Label,{title:t[1],className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"}},t[1])))))))):(0,e.jsx)("div",null))}));var Gn=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function zn(n){const{widgetId:a,track:i,trackRecord:o,trackFieldInfos:s,lrsLayers:l,subtypeLayers:c,networkInfo:d,showEventStatistics:f,onApply:p,onClose:m}=n,[g,h]=e.React.useState(!1),[y,x]=e.React.useState(!1),[w,I]=e.React.useState(!1),[D,N]=e.React.useState(!1),[k,E]=e.React.useState(null),[L,R]=e.React.useState([]),[j,M]=e.React.useState(null),[T,C]=e.React.useState([]),[A,P]=e.React.useState(null),[V,$]=e.React.useState(null),[B,G]=e.React.useState(null),[z,H]=e.React.useState(null),W=e.React.useRef(null),U=e.React.useRef(null),{pendingEdits:q,selectedSldId:J,outputDataSources:Y}=v(),Q=b(),X=e.hooks.useTranslation(t),K=(0,O.getTheme)();e.React.useEffect((()=>{(0,u.isDefined)(i)&&(0,u.isDefined)(o)?(h(!0),Z()):h(!1)}),[i,o]),e.React.useEffect((()=>{(0,u.isDefined)(Y)&&2===Y.length&&(G(Y[0]),H(Y[1]))}),[Y]),e.React.useEffect((()=>{w&&setTimeout((()=>{I(!1)}),1e4)}),[w]);const Z=()=>Gn(this,void 0,void 0,(function*(){const t=l.find((e=>e.serviceId.toString()===i.layerId));if((0,u.isDefined)(t)&&(0,u.isDefined)(t.eventInfo)){E(t.eventInfo);const n=e.DataSourceManager.getInstance().getDataSource(t.useDataSource.dataSourceId);if((0,u.isDefined)(n)){let e=n.getGDBVersion();e||(e="");const a=yield(0,u.getLayer)(t.useDataSource),i=a.createQuery(),r=o.attributes.get(S.routeIdName);i.outFields=["*"],i.where=`LOWER(${t.eventInfo.routeIdFieldName}) = LOWER('${r}')`,i.gdbVersion=e,yield a.queryFeatures(i).then((e=>{P(n),C(a.fields),M(a),R(e.features),ee(e.features,n,t.eventInfo)}))}}})),ee=(e,t,n)=>{0===e.length?$(null):1===L.length?$(te(L[0],o,n)):e.forEach((e=>{e.attributes[n.eventIdFieldName]===o.attributes.get(Dt(s).originalFieldName)&&$(te(e,o,n))}))},te=(e,t,n)=>{const a=e.attributes;return Object.keys(a).forEach((e=>{t.attributes.has(e)&&(a[e]=t.attributes.get(e))})),e.attributes=a,e},ne=(t,n)=>Gn(this,void 0,void 0,(function*(){var a,i,r;const o=k.isPointEvent?B:z;let s=e.DataSourceManager.getInstance().getDataSource(o);if(s||(s=yield e.DataSourceManager.getInstance().createDataSource(o)),!s)return;const l=ae(t);s.setSchema(l);const c=ie(),u=Object.assign(s.getDataSourceJson()),d=t.getLabel()+"_export";e.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(s,(0,e.Immutable)(Object.assign(Object.assign({},u),{label:d,disableExport:!1})));const f=[];null==n||n.forEach(((e,t)=>{const n={},a=e.getFeature();if(a.attributes)for(const e in a.attributes){const t=a.attributes[e];null!=t&&(n[e]=t)}const i=new _.default({attributes:n,geometry:e.geometry});f.push(i)}));const p=[],m=[],g=Object.keys(null==l?void 0:l.fields).filter((e=>c.includes(e))).reduce(((e,t)=>(e[t]=null==l?void 0:l.fields[t],e)),{});for(const t in g){let n="";n=g[t].type===e.JimuFieldType.Number?"double":g[t].type===e.JimuFieldType.Date?"date":"string";const a={alias:g[t].alias,name:g[t].name,type:n},i={fieldName:g[t].name,label:g[t].alias};m.push(a),p.push(i)}const h=new $n.default({id:o+"_layer",title:o,fields:m,geometryType:k.isPointEvent?"point":"polyline",source:f,objectIdField:s.getSchema().idField,popupTemplate:{title:s.getLabel(),fieldInfos:p,content:[{type:"fields",fieldInfos:p}]},visible:!1,listMode:"hide"}),y=e.DataSourceManager.getInstance().getDataSource(o);h&&y&&(y.layer=h);const v=[];return v.push({records:n,dataSource:s,name:s.getLabel(),fields:c}),null===(a=e.DataSourceManager.getInstance().getDataSource(o))||void 0===a||a.setStatus(e.DataSourceStatus.Unloaded),null===(i=e.DataSourceManager.getInstance().getDataSource(o))||void 0===i||i.setCountStatus(e.DataSourceStatus.Unloaded),null===(r=e.DataSourceManager.getInstance().getDataSource(o))||void 0===r||r.addSourceVersion(),[o,v]})),ae=t=>{const n={},a=t,i=null==a?void 0:a.getSchema().fields.asMutable({deep:!0}),r=re(),o=oe(),s=se(),l=[];Object.keys(i).forEach((e=>{r.includes(e)&&l.push(i[e]),o.includes(e)&&l.push(i[e])})),s.forEach((t=>{l.push({alias:t[0],type:e.JimuFieldType.Number,jimuName:t[0],name:t[0]})})),null==l||l.forEach((e=>{n[null==e?void 0:e.jimuName]=e}));return{label:t.getLabel()+"_export",idField:"OBJECTID",fields:n}},ie=()=>{const e=k.lrsFields.map((e=>e.name)),t=se().map((e=>e[0])),n=Object.values(S),a=[...o.attributes.keys()],i=s.filter((e=>e.isOidField)).map((e=>e.featureFieldName));return[...e,...t,...a.filter((e=>!n.includes(e)&&e!==k.eventIdFieldName&&!i.includes(e)))]},re=()=>k.lrsFields.map((e=>e.name)),oe=()=>{const e=[];return Object.keys(V.attributes).forEach((t=>{o.attributes.has(t)&&e.push(t)})),e},se=()=>W.current?W.current.getStats():[],le=(e,t)=>{const n={},a=re(),i=se();return Object.keys(t.attributes).forEach((e=>{a.includes(e)&&(n[e]=t.attributes[e]),o.attributes.has(e)&&(n[e]=o.attributes.get(e))})),i.forEach((e=>{n[e[0]]=e[1]})),e.buildRecord({attributes:n,geometry:t.geometry})},ce=e=>{U.current&&U.current.isEditPending()&&!e?x(!0):(x(!1),I(!1),h(!1),E(null),R([]),M(null),C([]),$(null),Q({type:"SET_SELECTED_SLD_ID",value:""}),m())},ue=e.React.useCallback((e=>{const t=new Map(q),n={layerId:i.layerId,attributes:kt(s,e,null==k?void 0:k.datasetName,!1)};t.set(J,n),Q({type:"SET_EDITS",value:t});const a=i.records.findIndex((e=>e.index===o.index));a>-1&&(i.records[a]=e,I(!0),p(i),de())}),[Q,k,p,q,J,i,s,o]),de=()=>{N(!0),setTimeout((()=>{N(!1)}),200)};return(0,e.jsx)(r.Modal,{size:"sm",isOpen:g,centered:!0,scrollable:!0,toggle:()=>{ce()},backdrop:"static"},(0,e.jsx)(r.ModalHeader,{title:null==i?void 0:i.layerName,toggle:()=>{ce()}},(0,e.jsx)("div",{className:"d-flex w-100"},null==i?void 0:i.layerName,(0,e.jsx)(r.Tooltip,{title:X("dataAction_ExportCSV")},(0,e.jsx)(r.Button,{style:{marginLeft:"auto",border:"none"},icon:!0,size:"sm",onClick:()=>Gn(this,void 0,void 0,(function*(){if((0,u.isDefined)(A)&&(0,u.isDefined)(V)){const t=le(A,V);if(!(0,u.isDefined)(t))return;const n=yield ne(A,[t]);if(!(0,u.isDefined)(n))return;const i=n[0];if(i){const r=n[1],o=e.DataSourceManager.getInstance(),s=null==o?void 0:o.getDataSource(i);o.createDataSource((0,e.Immutable)({id:A.id+"_export",type:e.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,schema:s.getSchema(),disableExport:!1})).then((n=>{n.setSourceRecords([t]);e.DataActionManager.getInstance().getSupportedActions(a,r,e.DataLevel.Records).then((t=>Gn(this,void 0,void 0,(function*(){const n=t.export;if((null==n?void 0:n.length)>0){const t=n.filter((e=>"export-csv"===e.id));yield e.DataActionManager.getInstance().executeDataAction(t[0],r,e.DataLevel.Records,a)}})))).catch((e=>{console.error(e)}))}))}}}))},(0,e.jsx)(Vn,null))))),(0,e.jsx)(r.ModalBody,{style:{maxHeight:"70vh",overflow:"auto",background:K.sys.color.surface.background}},(0,e.jsx)(F.CalciteNotice,{css:(0,u.getCalciteNoticeTheme)(K),style:{position:"sticky",top:0,zIndex:1,marginBottom:w?"15px":"0px",borderTop:w?`1px solid ${e.polished.rgba(K.sys.color.surface.overlayHint,.5)}`:"none",borderRight:w?`1px solid ${e.polished.rgba(K.sys.color.surface.overlayHint,.5)}`:"none",borderBottom:w?`1px solid ${e.polished.rgba(K.sys.color.surface.overlayHint,.5)}`:"none",borderLeft:0},open:!!w||void 0,icon:"check-circle",kind:"success",scale:"s",width:"auto",closable:!0,onCalciteNoticeClose:e=>{I(!1)}},(0,e.jsx)("div",{slot:"title"},X("sldEditSuccessful"))),(0,e.jsx)(F.CalciteNotice,{css:(0,u.getCalciteNoticeTheme)(K),style:{position:"sticky",top:0,zIndex:1,marginBottom:y?"15px":"0px",borderTop:y?`1px solid ${e.polished.rgba(K.sys.color.surface.overlayHint,.5)}`:"none",borderRight:y?`1px solid ${e.polished.rgba(K.sys.color.surface.overlayHint,.5)}`:"none",borderBottom:y?`1px solid ${e.polished.rgba(K.sys.color.surface.overlayHint,.5)}`:"none",borderLeft:0},open:!!y||void 0,icon:"exclamation-mark-triangle",kind:"warning",scale:"s",width:"auto"},(0,e.jsx)("div",{slot:"title"},X("applyEditTitle")),(0,e.jsx)("div",{slot:"message"},X("applyEditMessage")),(0,e.jsx)("div",{slot:"actions-end"},(0,e.jsx)("div",{className:"d-flex",style:{flexDirection:"column",backgroundColor:K.sys.color.primary.main}},(0,e.jsx)(F.CalciteAction,{scale:"m",icon:"read-only-non-editable",text:"Discard","text-enabled":!0,appearance:"transparent",onClick:()=>{ce(!0)},style:{border:`2px solid ${K.sys.color.surface.paper}`}}),(0,e.jsx)(F.CalciteAction,{scale:"m",icon:"save",text:"Apply","text-enabled":!0,appearance:"transparent",onClick:()=>{var e;null===(e=U.current)||void 0===e||e.applyEdit(),setTimeout((()=>{U.current.isEditPending()||(x(!1),ce())}),200)},style:{border:`2px solid ${K.sys.color.surface.paper}`,borderTop:0}})))),(0,e.jsx)(Cn,{ref:U,trackRecord:o,eventInfo:k,eventRecords:L,eventFields:T,featureLayer:j,currentRecord:V,onApply:ue}),(0,e.jsx)(An,{eventInfo:k,eventFields:T,subtypeLayers:c,featureLayer:j,currentRecord:V}),f&&(0,e.jsx)(Bn,{ref:W,track:i,trackRecord:o,eventEsriFields:T,eventInfo:k,currentRecord:V,allRecords:L,networkInfo:d,featureLayer:j,refresh:D})))}function Hn(t){const{widgetId:n,trackMap:a,measureRange:i,defaultRange:r,featureLayer:o,subtypeLayers:s,networkInfo:l,lrsLayers:c,showEventStatistics:d}=t,[f,p]=e.React.useState(200),[m,g]=e.React.useState(!1),[h,y]=e.React.useState(!1),[v,b]=e.React.useState(0),[x,S]=e.React.useState(0),D=e.React.useRef(null),N=e.React.useRef(null),k=e.React.useRef(null),{refWidth:E}=(t=>{const[n,a]=e.React.useState({refWidth:0,refHeight:0});return e.React.useEffect((()=>{const e=e=>({refWidth:e.contentRect.width,refHeight:e.contentRect.offsetHeight});if(t.current){const n=new ResizeObserver((t=>{for(const n of t)a(e(n))}));return n.observe(t.current),()=>{n.disconnect()}}}),[t]),n})(D),L=e.React.useRef({startX:0,startY:0,scrollLeft:0,scrollTop:0}),[R,j]=e.React.useState(a),[M,T]=e.React.useState(0),[F,C]=e.React.useState(NaN),[A,O]=e.React.useState(0),[P,_]=e.React.useState(!1),[V,$]=e.React.useState(!1),[B,G]=e.React.useState(null),[z,H]=e.React.useState(null),[W,U]=e.React.useState([]);e.React.useEffect((()=>{j(a)}),[a]),e.React.useEffect((()=>{const e=(i.to-i.from)/r;b(e<1?1:e)}),[r,i]);const q=e.React.useCallback((e=>{b(e)}),[]),J=e=>{if(g(!1),h){if(y(!1),!N.current)return;document.body.style.cursor="default"}},Y=e=>{if(m&&!h){if(e.pageX<140)return;p(e.pageX)}if(!m&&h&&N.current){e.preventDefault();const t=N.current,n=k.current,a=e.pageX-t.offsetLeft,i=e.pageY-n.offsetTop,r=1.5*(a-L.current.startX),o=1.5*(i-L.current.startY);t.scrollLeft=L.current.scrollLeft-r,n.scrollTop=L.current.scrollTop-o}},Q=(e,t)=>{if(isNaN(e))return NaN;let n=x;(0,u.isDefined)(t)&&(n=t);let a=n+(e-f);return a<0&&(a=0),function(e,t,n){return isNaN(e)?NaN:e/n*(t.to-t.from)+t.from}(a,i,ne)},X=e=>{const t=e.currentTarget.getBoundingClientRect();return e.clientX-t.left+f},K=e.React.useMemo((()=>{const e=document.createElement("div");e.style.cssText="overflow:scroll; visibility:hidden; position:absolute;",document.body.appendChild(e);const t=e.offsetWidth-e.clientWidth;return e.remove(),t}),[]),Z=e.React.useMemo((()=>{let e=0;return R.forEach((t=>{t.isActive?e+=w:e+=I})),e+K}),[K,R]),ee=e.React.useMemo((()=>{let e=0;return R.forEach((t=>{t.isActive?e+=w:e+=I})),e}),[R]),te=e.React.useMemo((()=>E-f-K),[K,E,f]),ne=e.React.useMemo((()=>(E-f-K)*v),[K,E,f,v]);return(0,e.jsx)("div",{ref:D,className:"dyn-seg-diagram-container h-100 w-100 d-flex",style:{flexDirection:"column"},onMouseUp:J,onMouseMove:Y},(0,e.jsx)(zn,{widgetId:n,track:B,trackRecord:z,trackFieldInfos:W,lrsLayers:c,subtypeLayers:s,networkInfo:l,showEventStatistics:d,onApply:e=>{const t=new Map(R);t.set(e.layerName,e),j(t)},onClose:()=>{G(null),H(null),U(null)}}),(0,e.jsx)(Rn,{x:M,m:F,snapTolerance:A,isPopupActive:P,isHoverActive:V,trackMap:R,featureLayer:o,subtypeLayers:s,maxHeight:D.current?D.current.clientHeight-.3*D.current.clientHeight:0,networkInfo:l,measureRange:i,contentWidth:ne,sidebarWidth:f,scrollPos:x}),(0,e.jsx)(En,{sidebarWidth:f,bodyWidth:te,contentWidth:ne,measureRange:i,zoom:v,scrollPosition:x,onZoomChange:q,onNavForwardOrBack:e=>{if(!N.current)return;const t=N.current,n=t.scrollLeft,a=t.clientWidth;t.scrollLeft=e?n+a:n-a},onNavStartOrEnd:e=>{if(!N.current)return;const t=N.current;t.scrollLeft=e?t.scrollWidth:0},onClickOrHover:(e,t,n)=>{(0,u.isDefined)(e)?(T(X(e)),C(Q(X(e))),O(Q(X(e)+10)-Q(X(e)))):(T(NaN),C(NaN)),_(t),$(n)}}),(0,e.jsx)("div",{className:"diagram-container h-100 w-100 d-flex"},(0,e.jsx)("div",{ref:k,className:"sidebar-container h-100 d-flex",onScroll:e=>{N.current&&(N.current.scrollTop=e.target.scrollTop)}},(0,e.jsx)(Rt,{trackMap:R,width:f,height:Z,onTrackChanged:e=>{j(e)}}),(0,e.jsx)("div",{className:"sidebar-resizer d-flex",style:{height:Z},onMouseDown:e=>{g(!0),e.preventDefault()},onMouseUp:J,onMouseMove:Y})),(0,e.jsx)("div",{ref:N,className:"sld-container h-100",onScroll:e=>{S(e.target.scrollLeft),k.current&&(k.current.scrollTop=e.target.scrollTop),N.current&&(N.current.scrollTop=e.target.scrollTop),C(Q(M))},onMouseDown:e=>{if(!N.current)return;const t=N.current,n=k.current,a=e.pageX-t.offsetLeft,i=e.pageY-n.offsetTop,r=t.scrollLeft,o=n.scrollTop;L.current={startX:a,startY:i,scrollLeft:r,scrollTop:o},y(!0),document.body.style.cursor="grabbing"},onMouseUp:J,onMouseMove:Y},(0,e.jsx)(Dn,{trackMap:R,containerWidth:te,height:ee,contentWidth:ne,measureRange:i,featureLayer:o,subtypeLayers:s,onItemClick:(e,t,n)=>{G(t),H(e),U(n),_(!1),$(!1)}}))))}var Wn=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function Un(t){const{widgetId:n,featureLayer:a,records:i,lrsLayers:r,attributeSet:o,measureRange:s,defaultRange:l,networkInfo:c,showEventStatistics:d}=t,[f,p]=e.React.useState(!0),[m,g]=e.React.useState(new Map),[h,y]=e.React.useState([]),v=b();e.React.useEffect((()=>{(0,u.isDefined)(i)?x(i):S()}),[]);const x=e=>Wn(this,void 0,void 0,(function*(){const t=yield E(r,o),n=oe(a,r,t),i=yield ut(e,n,r,o,s,c);v({type:"SET_FIELD_INFO",value:n}),v({type:"SET_IS_LOADING",value:!1}),g(i),p(!0),y(t)})),S=()=>{v({type:"SET_FIELD_INFO",value:[]}),p(!1)};return(0,e.jsx)("div",{className:"dyn-seg-diagram h-100 w-100 d-flex"},f&&(0,e.jsx)(Hn,{widgetId:n,trackMap:m,measureRange:s,defaultRange:l,featureLayer:a,subtypeLayers:h,networkInfo:c,lrsLayers:r,showEventStatistics:d}))}var qn=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function Jn(n){const{dynSegFeatureLayer:a,lrsLayers:i,attributeSet:o,intl:s,networkDS:l,routeId:c,currentRouteInfo:d,networkInfo:f,handleLockToast:p}=n,{fieldInfo:m,pendingEdits:g}=v(),[h,y]=e.React.useState(),[x,S]=e.React.useState(),[w,I]=e.React.useState([]),[D,N]=e.React.useState(),[k,L]=e.React.useState([]),[R,j]=e.React.useState([]),[M,T]=e.React.useState(""),[C,A]=e.React.useState(),[O,P]=e.React.useState(),_=b(),V=e.hooks.useTranslation(t);e.React.useEffect((()=>{Q()}),[]),e.React.useEffect((()=>{E(i,o).then((e=>{j(e)}))}),[o,i]),e.React.useEffect((()=>{(null==f?void 0:f.supportsLines)&&ve(f,c,l).then((e=>{e&&A(e)})).catch((e=>{console.error(e)}))}),[f]);const $=e=>{if(!w)return null;const t=w.find((t=>t.eventLayerId===h&&t.originalFieldName===e)),n=a.fields.find((e=>e.name===t.featureFieldName));return n||null},B=(e,t)=>t.isSubtypeField?"subtype":(0,u.isDefined)(e.domain)&&(0,u.isCodedDomain)(e.domain.type)?"domain":(0,u.isDefined)(e.domain)&&(0,u.isRangeDomain)(e.domain.type)?"range":(0,u.isDate)(e.type)?"date":(0,u.isNumber)(e.type)?"number":"text",G=(e,t)=>(0,u.isDefined)(t)?`${t} - ${e}`:e,z=e=>{P(e)},H=e=>qn(this,void 0,void 0,(function*(){if(!x||!w)return null;const n=w.find((e=>e.eventLayerId===h&&e.originalFieldName===x)),a=$(x),i=B(a,n);let r=e;"number"===i&&(r=parseFloat(e));const o=M.length>0,l=(0,u.validateField)(e,n.featureFieldName,void 0,a);return l.hasError?o?{valid:!1,msg:l.message}:(T((0,u.formatMessage)(s,l.message,t)),z(r),{valid:!1,msg:(0,u.formatMessage)(s,l.message,t)}):(T(""),z(r),{valid:!0})})),W=e=>{const n=x,a=w.find((e=>e.eventLayerId===h&&e.originalFieldName===n)),i=$(n),r=M.length>0,o=(0,u.validateRangeDomain)(e,a.featureFieldName,void 0,i);return o.hasError?r?{valid:!1,msg:o.message}:(T((0,u.formatMessage)(s,o.message,t)),z(e),{valid:!1,msg:(0,u.formatMessage)(s,o.message,t)}):(T(""),z(e),{valid:!0})},U=e=>{var n;const a=null===(n=e.target)||void 0===n?void 0:n.valueAsDate;if(!a||isNaN(a.getTime()))return P(null),T(""),{valid:!0};const i=a.valueOf();if(!i)return P(null),T(""),{valid:!0};const r=x,o=w.find((e=>e.eventLayerId===h&&e.originalFieldName===r)),l=$(r),c=M.length>0,d=(0,u.validateField)(a,o.featureFieldName,void 0,l);return d.hasError?c?{valid:!1,msg:d.message}:(T((0,u.formatMessage)(s,d.message,t)),z(i),{valid:!1,msg:(0,u.formatMessage)(s,d.message,t)}):(T(""),z(i),{valid:!0})},q=e=>{e!==O&&z(e)},J=e=>{z(e.target.value)},Y=(t,n)=>{const a=(()=>{const e=R.find((e=>e.id===h));if((0,u.isDefined)(e)&&(0,u.isDefined)(e.subtypes)){const t=e.subtypes.map((e=>({value:e.code,label:e.name})));if(t)return t}return[]})();if("text"===t)return(0,e.jsx)(r.TextInput,{style:{height:"32px"},autoFocus:!0,type:"text",value:O,onChange:e=>{z(e.currentTarget.value)},checkValidityOnAccept:H});if("number"===t)return(0,e.jsx)(r.NumericInput,{style:{height:"32px"},autoFocus:!0,value:O,showHandlers:!1,onAcceptValue:q});if("date"===t)return(0,e.jsx)(F.CalciteInputDatePicker,{scale:"m",style:{height:"32px"},onCalciteInputDatePickerChange:U,placement:"top",overlayPositioning:"fixed",focusTrapDisabled:!0});if("domain"===t){const t=(i=n.domain,null===(o=null==i?void 0:i.codedValues)||void 0===o?void 0:o.map(((t,n)=>{let a=t.code;return null===a&&(a="<null>"),(0,e.jsx)("option",{key:n,value:a},G(t.name,t.code))})));return(0,e.jsx)(r.Select,{value:O,onChange:e=>{J(e)}},t)}return"subtype"===t?(0,e.jsx)(r.Select,{value:O,onChange:e=>{J(e)}},a.map(((t,n)=>(0,e.jsx)("option",{key:n,value:t.value},G(t.label,t.value))))):"range"===t?(0,e.jsx)(r.TextInput,{style:{height:"32px"},autoFocus:!0,value:O,onChange:e=>{z(e.currentTarget.value)},checkValidityOnAccept:W}):void 0;var i,o},Q=()=>{const e={},t=[];if(!m||0===m.length||!e)return{};m.forEach((n=>{const a=n.isEventIdField,i=n.exclude;!n.eventLayerId||a||i||(e[n.eventLayerId]?e[n.eventLayerId].push(n):(e[n.eventLayerId]=[n],t.push(n.eventLayerId)))})),e&&N(e);const n=e[t[0]];return I(n),L(t),y(t[0]),S(n[0].originalFieldName),e},X=(e,t)=>qn(this,void 0,void 0,(function*(){const n=e.createQuery();return n.outFields=["*"],n.returnGeometry=!0,n.where=be(t),e.queryFeatures(n).then((e=>qn(this,void 0,void 0,(function*(){return e.features})))).catch((e=>[]))})),K=()=>qn(this,void 0,void 0,(function*(){let e=O;"<null>"===e&&(e=null);const t=yield X(a,l),n=[],i=w.find((e=>e.eventLayerId===h&&e.originalFieldName===x));t.forEach((t=>{const a=t.clone();if(a.attributes.type===i.EventType){const t=ce(e,i,a,R);t.size>0?t.forEach(((e,t)=>{a.attributes[t]=e})):a.attributes[i.featureFieldName]=e,n.push(a)}}));const r={updateFeatures:n};yield a.applyEdits(r).then((e=>{if(e.updateFeatureResults.length>0){let e=new Map(g);n.forEach((t=>{t.attributes.type===i.EventType&&(e=function(e,t,n,a){const i=ue(t,e.eventName),r=a.get(i),o=le(n,t,e.eventName,!1),s=new Map(a);if((0,u.isDefined)(r))r.attributes=o,s.set(i,r);else{const t={layerId:e.eventLayerId,attributes:o};s.set(i,t)}return s}(i,t,w,e),_({type:"SET_EDITS",value:e}))}))}})).catch((e=>{T(e.message)}))}));return(0,e.jsx)("div",{style:{margin:"1rem",display:"flex",flexDirection:"column"}},(0,e.jsx)(r.Label,null,V("eventLayer"),(0,e.jsx)(F.CalciteSelect,{label:V("eventLayer"),value:h,onCalciteSelectChange:e=>{y(e.target.value);const t=D[e.target.value];I(t),S(t[0].originalFieldName),P(null)}},(()=>{const t=[];return k&&0!==k.length?(k.forEach((n=>{const a=D[n],i=a[0].eventName,r=a[0].eventLayerId;t.push((0,e.jsx)(F.CalciteOption,{value:r}," ",i||r," "))})),t):[]})())),(0,e.jsx)(r.Label,{style:{marginTop:"0.3rem"}},V("updateField"),(0,e.jsx)(F.CalciteSelect,{label:V("updateField"),value:x,onCalciteSelectChange:e=>{P(null),S(e.target.value)}},(()=>{if(!h)return[];const t=[],n=D[h];return n&&0!==n.length?(n.forEach(((n,a)=>{t.push((0,e.jsx)(F.CalciteOption,{value:n.originalFieldName}," ",n.originalFieldName," "))})),t):[]})())),(0,e.jsx)(r.Label,{style:{marginTop:"0.3rem"}},V("fieldValue"),(()=>{if(!x||!w)return null;const e=w.find((e=>e.eventLayerId===h&&e.originalFieldName===x)),t=$(x),n=B(t,e);return Y(n,t)})()),(0,e.jsx)(F.CalciteButton,{onClick:()=>qn(this,void 0,void 0,(function*(){let e;if(yield(0,u.isConflictPreventionEnabled)(l._url)){const t=(()=>{const e=f.lrsNetworkId,t=[],n=[],a=[],r=d;return k.forEach((t=>{const n=i.find((e=>e.serviceId.toString()===t.toString()));n&&n.eventInfo.parentNetworkId===e&&a.push(t)})),a.forEach((e=>{f.supportsLines&&C?t.push(C):t.push(c),n.push(f.supportsLines)})),{networkId:[e],routeOrLineId:t,eventServiceLayerIds:a,isLine:n,status:u.LockAcquireStatus.EsriSuccess,details:[],routeInfo:r,lockAction:u.LockAction.Query}})(),n=l;if(e=yield he(t,n,s),e){const t={title:e.toastMsg,body:"",type:e.toastMsgType};p(t),yield K()}else{const e={title:V("editFieldSuccess"),body:"",type:"success"};p(e),yield K()}}else yield K()})),disabled:(null==M?void 0:M.length)>0||void 0,style:{alignSelf:"flex-end",width:"50%",marginTop:"0.5rem"}},V("update")))}var Yn=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function Qn(i){const{widgetId:o,allowMerge:c,conflictPreventionEnabled:d,intl:f,networkDS:p,routeInfo:m,lrsLayers:g,attributeSets:h,defaultPointAttributeSet:y,defaultLineAttributeSet:w,attributeInputType:I,mapHighlightColor:D,graphicsLayer:E,defaultDisplayType:R,defaultDiagramScale:j,jimuMapView:C,outputDataSources:A,showEventStatistics:P,useMapWidgetIds:_,onResetDataAction:V}=i,$=e.hooks.useTranslation(t),[B,G]=e.React.useState(null),[z,H]=e.React.useState(null),[W,U]=e.React.useState(null),[q,J]=e.React.useState([]),[Y,Q]=e.React.useState(null),[X,K]=e.React.useState(!1),[Z,ne]=e.React.useState(),[ae,ie]=e.React.useState({title:"",body:"",type:"brand"}),{isLoading:re,pendingEdits:oe,records:se,display:le,selectedRecordIds:ce,selectedSldId:ue}=v(),[de,fe]=e.React.useState(""),pe=b(),me=(0,O.getTheme)();e.React.useEffect((()=>{const e=e=>{if(oe.size>0){const t=e;return t.preventDefault(),t&&(t.returnValue=""),""}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}),[oe]),e.React.useEffect((()=>{pe({type:"SET_DISPLAY",value:R})}),[R]),e.React.useEffect((()=>{pe({type:"SET_OUTPUT_DATA_SOURCES",value:A})}),[A]),e.React.useEffect((()=>{(0,u.isDefined)(p)&&(0,u.isDefined)(m)&&(pe({type:"RESET_STATE",action:""}),ge(p,m))}),[m]),e.React.useEffect((()=>{(0,u.isDefined)(C)&&pe({type:"SET_JIMU_MAP_VIEW",value:C})}),[pe,C]),e.React.useEffect((()=>{(0,u.isDefined)(E)&&pe({type:"SET_HIGHLIGHT_LAYER",value:E}),(0,u.isDefined)(D)&&pe({type:"SET_HIGHLIGHT_COLOR",value:D})}),[pe,E,D]);const ge=(t,n)=>Yn(this,void 0,void 0,(function*(){const a=xe(t),i=we(n);let r=C;(0,u.isDefined)(r)||(r=(()=>{let e=null;if((null==_?void 0:_.length)>0){const t=l.MapViewManager.getInstance().getJimuMapViewGroup(null==_?void 0:_[0]);if(t&&t.jimuMapViews)for(const n in t.jimuMapViews)t.jimuMapViews[n].dataSourceId&&(t.jimuMapViews[n].isActive||void 0===t.jimuMapViews[n].isActive)&&(e=t.jimuMapViews[n])}return e})()),(0,u.isDefined)(r)||pe({type:"SET_IS_LOADING",value:!1}),yield ye(t,n,a).then((o=>Yn(this,void 0,void 0,(function*(){o?yield T(t,n,a,i).then((a=>Yn(this,void 0,void 0,(function*(){const o=yield k(n.networkInfo,g,i,r);yield function(t,n,a){return N(this,void 0,void 0,(function*(){if(!t||!n)return;let i=null,r=null,o=null;yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Polyline","esri/Graphic","esri/geometry/SpatialReference"]).then((e=>{[i,r,o]=e})).then((()=>N(this,void 0,void 0,(function*(){yield Promise.all(t.features.map((e=>N(this,void 0,void 0,(function*(){const s=new o({wkid:t.spatialReference.wkid,wkt:t.spatialReference.wkt}),l=new i(e.geometry);if(l.spatialReference=s,"Point"===e.attributes[S.typeName]&&1===l.paths.length&&2===l.paths[0].length){const e=l.getPoint(0,0),t=l.getPoint(0,1);e.x===t.x&&e.y===t.y&&(t.x+=a.xyTolerance,t.y+=a.xyTolerance,l.setPoint(0,1,t))}const c=Object.keys(e.attributes).filter((t=>(0,u.isDefined)(e.attributes[t]))).reduce(((t,n)=>(t[n]=e.attributes[n],t)),{}),d=new r({geometry:l,attributes:c});yield n.applyEdits({addFeatures:[d.clone()]}).then((e=>N(this,void 0,void 0,(function*(){if(e.addFeatureResults.length>0){let t=e.addFeatureResults[0].error,a=0;for(;(0,u.isDefined)(t)&&(t=yield L(n,d,t),(0,u.isDefined)(t)&&!(a>10));)a++}else console.error("Failed to add feature",e.addFeatureResults)})))).catch((e=>{console.error("Failed to add feature",e)}))})))))}))))}))}(a,o,n.networkInfo).then((()=>Yn(this,void 0,void 0,(function*(){he(o,i,t,n,!0,"")}))))})))).catch((e=>{he(null,[],null,null,!1,$("queryAttributeSetError"))})):he(null,[],null,null,!1,$("routeDoesNotExist"))}))))})),he=(e,t,n,a,i,r)=>{U(e),J(t),G(n),H(a),fe(r),i?(Q({from:a.fromMeasure,to:a.toMeasure}),V(),ve(e,n)):pe({type:"SET_IS_LOADING",value:!1})},ye=(e,t,n)=>new Promise((function(a,i){const r=e;(0,u.isDefined)(r)||a(!1);const o=t.networkInfo.useRouteName?t.routeName:t.routeId;(0,u.queryRouteIdOrName)(o.trim(),t.networkInfo,e,!1,!0,"",n).then((e=>{(0,u.isDefined)(e)&&e.features.length>0&&a(!0),a(!1)})).catch((e=>{a(!1)}))})),ve=(e,t)=>Yn(this,void 0,void 0,(function*(){if(!(0,u.isDefined)(e))return;const n=e.createQuery();n.outFields=["*"],n.returnGeometry=!0,n.where=be(t),n.orderByFields=[S.fromMeasureName],e.queryFeatures(n).then((e=>Yn(this,void 0,void 0,(function*(){pe({type:"SET_RECORDS",value:e.features}),pe({type:"SET_ORIGINAL_RECORDS",value:e.features}),0===e.features.length?(fe($("noResults")),pe({type:"SET_IS_LOADING",value:!1})):fe("")})))).catch((e=>{fe($("errorLoadingRecords")),pe({type:"SET_RECORDS",value:[]}),pe({type:"SET_ORIGINAL_RECORDS",value:[]}),pe({type:"SET_IS_LOADING",value:!1})}))})),Se=()=>Yn(this,void 0,void 0,(function*(){(0,u.isDefined)(W)&&(pe({type:"SET_RECORDS",value:[]}),pe({type:"SET_ORIGINAL_RECORDS",value:[]}),setTimeout((()=>{ve(W,B)}),100))})),we=e=>{const t=h.attributeSet.find((e=>e.title===y)),n=h.attributeSet.find((e=>e.title===w));let i=[];I===a.LineAndPoint&&(i=M(e,g,t));const r=M(e,g,n);return i.concat(r)},Ie=()=>(0,u.isDefined)(z)?z.networkInfo:null,De=e=>{e&&ne(e)},Ne=e=>{"success"===e.type||(e.time=6e4),ie(e),K(!0)};return(0,e.jsx)(F.CalcitePanel,{onClick:e=>{ce.length>0&&pe({type:"SET_SELECTED_RECORD_IDS",value:[]}),""!==ue&&pe({type:"SET_SELECTED_SLD_ID",value:""})}},(0,e.jsx)("div",{slot:"header-content",className:"d-flex",style:{flexDirection:"column",height:"40px"}},(0,e.jsx)(r.Label,{size:"sm",centric:!0,style:{fontWeight:"600",marginBottom:"0px"}},(()=>{const e=(0,u.isDefined)(z)?z.routeId:"",t=(0,u.isDefined)(z)?z.routeName:"";return(0,u.isDefined)(z)&&z.networkInfo.useRouteName?$("routeNameLabel",{routeName:t}):$("routeIdLabel",{routeId:e})})()),(0,e.jsx)("div",{className:"d-flex",style:{flexDirection:"row"}},(0,e.jsx)(r.Label,{size:"sm",centric:!0,style:{marginBottom:"0px"}},(()=>{const e=(0,u.isDefined)(B)?xe(B):null,t=(0,u.isDefined)(e)?e.toLocaleDateString():"";return $("dateLabel",{date:t})})()),(0,e.jsx)(r.Label,{size:"sm",centric:!0,style:{paddingLeft:"10px",marginBottom:"0px"}},(()=>{const e=(0,u.isDefined)(z)?z.fromMeasure:NaN,t=(0,u.isDefined)(z)?z.toMeasure:NaN;if(isNaN(e)||isNaN(t))return $("measureRangeNoValue");const n=(0,u.GetUnits)(z.networkInfo.unitsOfMeasure,f);return $("measureRangeValue",{fromM:e,toM:t,units:n})})()))),Z&&(0,e.jsx)(F.CalcitePopover,{open:!0,autoClose:void 0,closable:!0,overlayPositioning:"absolute",scale:"m",label:Z.heading,heading:Z.heading,style:{width:"300px"},onCalcitePopoverClose:()=>{ne(null)},referenceElement:Z.id},"field-calculator"===Z.id&&(0,e.jsx)(Jn,{dynSegFeatureLayer:W,handleFieldCalculator:De,intl:f,lrsLayers:g,attributeSet:q,networkDS:B,networkInfo:Ie(),currentRouteInfo:z,routeId:(0,u.isDefined)(z)?z.routeId:"",handleLockToast:Ne})),(0,e.jsx)(ee,{attributeSet:q,widgetId:o,highlightColor:D,onSave:e=>{ie(e),K(!0)},lrsLayers:g,networkDS:B,networkInfo:Ie(),jimuMapView:C,dynSegFeatureLayer:W,handleFieldCalculator:De,intl:f,allowMerge:c,routeId:(0,u.isDefined)(z)?z.routeId:""}),(0,e.jsx)("div",{className:"h-100"},(0,e.jsx)(x,{isLoading:re}),X&&(0,e.jsx)(te,{open:X,messageProp:ae,onClose:()=>{K(!1),"success"===ae.type&&(ie({title:"",body:"",type:"brand"}),Se())}}),(0,u.isDefined)(W)&&(0,u.isDefined)(z)&&se.length>0&&(le===n.Table?(0,e.jsx)(lt,{intl:f,featureLayer:W,records:se,lrsLayers:g,attributeSet:q,networkInfo:z.networkInfo,networkDS:p,conflictPreventionEnabled:d,currentRouteInfo:z,routeId:(0,u.isDefined)(z)?z.routeId:"",handleLockToast:Ne}):(0,e.jsx)(Un,{intl:f,widgetId:o,featureLayer:W,records:se,lrsLayers:g,attributeSet:q,measureRange:Y,defaultRange:j,networkInfo:z.networkInfo,showEventStatistics:P})),0===se.length&&!re&&(0,e.jsx)("div",{className:"d-flex",style:{padding:"2.5%",width:"100%",height:"100%",flexDirection:"column"}},!de&&(0,e.jsx)(r.Icon,{icon:s(),color:me.sys.color.secondary.light,className:"w-50 h-50",style:{margin:"auto auto 0px auto"}}),(0,e.jsx)(r.Label,{className:"w-50 ml-auto",style:{color:me.sys.color.secondary.dark,textAlign:"center",margin:"10px auto auto auto"}},!de&&(0,e.jsx)("p",null,$("dataActionMessage")),(0,e.jsx)("p",null,de)))))}function Xn(t,n){return e.css`
    background-color: var(--ref-palette-white);
    .table-indent {
      background-color: ${t.sys.color.surface.paper};
      width: calc(100% - 32px);
      height: calc(100% - 26px);
      margin: 0px 16px 16px;
      display: inline-block;
    }
    .dyn-seg-table-container {
      background-color: ${t.sys.color.surface.paper};
      -webkit-user-select: none; /* Safari */        
      -moz-user-select: none; /* Firefox */
      -ms-user-select: none; /* IE10+/Edge */
      user-select: none; /* Standard */
    }
    .dyn-seg-row {
       --calcite-table-row-border-color: ${t.sys.color.surface.background};
    }
    .dyn-seg-cell.edited {
      --calcite-table-cell-background: ${e.polished.rgba(t.sys.color.warning.light,.4)};
    }
    .dyn-seg-cell.non-editable {
      --calcite-table-cell-background: ${e.polished.rgba(t.sys.color.action.disabled.default,.2)};
    }
    .dyn-seg-cell.error {
      --calcite-table-cell-background: ${e.polished.rgba(t.sys.color.error.main,.2)};
    }
    .dyn-seg-column-header {
       --calcite-table-header-background: ${t.sys.color.surface.background};
    }
    .dyn-seg-row-header {
      --calcite-table-cell-background: ${t.sys.color.surface.background};
    }
    .dyn-seg-row-header.selected {
      --calcite-table-cell-background: ${n};
    }
    .header-divider {
      border-left: 1px solid red;
      height: auto;
    }
    .header-divider::hover {
      border-left: 1px solid ${e.polished.rgba(t.sys.color.secondary.light,.3)};
      height: 100%;
    }
    .toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      top: 0;
      z-index: 5;
    }
    .toast {
      position: relative;
      z-index: 999;
      }
    .toast-notice {
      transform: translateY(100px);
    }
    .sidebar-header {
      background-color: ${t.sys.color.surface.background};
      border: 1px solid ${t.sys.color.divider.primary};
      padding: 0px 16px;
      height: ${w}px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .sidebar-icon {
      width: 24px;
      height: 24px;
    }
    .sidebar-icon:hover {
      cursor: pointer;
      border: 1px solid ${t.sys.color.primary.main};
    }
    .header-actions {
      align-content: center;
    }
    .sidebar-item.active {
      background-color: ${t.sys.color.surface.background};
      border: 1px solid ${t.sys.color.divider.primary};
      padding: 0px 16px;
      height: ${w}px;
      display: flex;
      align-items: center;
      font-weight: 500;
    }
    .sidebar-item.inactive {
      background-color: ${t.sys.color.surface.background};
      border: 1px solid ${t.sys.color.divider.primary};
      padding: 0px 16px;
      height: ${I}px;
      display: flex;
      align-items: center;
      font-weight: 500;
    }
    .sidebar-item:hover {
      cursor: pointer;
      border: 1px solid ${t.sys.color.primary.main};
      background-color: ${t.sys.color.action.hover};
    }
    .sidebar-resizer {
      width: 10px;
      margin: 0px -5px;
      z-index: 1;
    }
    .sidebar-resizer:hover {
      border-left: 5px solid ${e.polished.rgba(t.sys.color.divider.input,.5)};
      border-right: 5px solid ${e.polished.rgba(t.sys.color.divider.input,.5)};
      cursor: col-resize;
      }
    .header {
      height: ${w}px;
    }
    .diagram-container {
      overflow: hidden;
      -webkit-user-select: none; /* Safari */        
      -moz-user-select: none; /* Firefox */
      -ms-user-select: none; /* IE10+/Edge */
      user-select: none; /* Standard */
    }
    .sidebar-container {
      overflow: auto;
      scrollbar-width: none;
      flex-direction: row;
    }
    .sld-container {
      flex-direction: row;
      overflow: auto;
    }
    .sld-row.active {
      border: 1px solid ${t.sys.color.divider.primary};
      background-color: ${t.sys.color.surface.paper};
      height: ${w}px;
    }
    .sld-row.inactive {
      border: 1px solid ${t.sys.color.divider.primary};
      background-color: ${t.sys.color.surface.paper};
      height: ${I}px;
    }
    .sld-body {
      overflow: hidden;
    }
    .sld-item-line-active {
      height: ${35}px;
      position: absolute;
      top: 0;
      bottom: 0;
      margin-top: auto;
      margin-bottom: auto;
      border-radius: 5px;
      border: 1px solid ${t.sys.color.divider.primary};
    }
    .sld-item-point-active {
      height: ${D}px;
      width: ${D}px;
      position: absolute;
      top: 0;
      bottom: 0;
      margin-top: auto;
      margin-bottom: auto;
    }
    .sld-item-line-inactive {
      height: ${15}px;
      position: absolute;
      top: 0;
      bottom: 0;
      margin-top: auto;
      margin-bottom: auto;
      border-radius: 5px;
      border: 1px solid ${t.sys.color.divider.primary};
      background: ${t.sys.color.action.disabled.text};
    }
    .sld-item-point-inactive {
      height: ${I}px;
      width: ${I}px;
      position: absolute;
      top: 0;
      bottom: 0;
      margin-top: auto;
      margin-bottom: auto;
    }
    .sld-item-label-wrapper {
      overflow: hidden;
      height: ${I}px;
      line-height: ${I}px;
      margin: 4px;
      text-align: center;
    }
    .sld-item-selected-line {
      z-index: 1;
      border: 1px solid ${t.sys.color.primary.main};
      box-shadow: 0 0 3px 1px ${t.sys.color.primary.main};
    }
    .sld-item-selected-point {
      z-index: 1;
      filter: drop-shadow(0 0 4px ${t.sys.color.primary.main});
    }
    .sld-item-edited-point {
      border-radius: 2px;
      filter: drop-shadow(0 0 4px ${t.sys.color.warning.main});
    }
    .sld-item-edited-line {
      border: 1px solid ${t.sys.color.warning.main};
      box-shadow: 0 0 3px 1px ${t.sys.color.warning.main};
    }
    .sld-item-label-wrapper::before {
      content: '';
      display: inline-block;
    }
    .sld-item-label {
      display: inline-block;
      height: ${I}px;
      margin: 0px;
      padding: 0px 5px;
      text-align: center;
      align-content: center;
      font-weight: 700;
      border-radius: 5px;
    }
    .sld-item-line-active:hover{
      z-index: 1;
      border: 1px solid ${t.sys.color.primary.main};
      box-shadow: 0 0 3px 1px ${t.sys.color.primary.main};
    }
    .sld-item-point-active:hover {
      z-index: 1;
      filter: drop-shadow(0 0 3px ${t.sys.color.primary.main});
    } 
    .sld-marker {
      position: absolute;
      z-index: 2;
      top: 60px;
      bottom: 0;
      margin-left: 1px;
      border-left: 2px dashed;
      opacity: 0;
      pointer-events: none;
    }
    .sld-marker--pointer {
      color: ${t.sys.color.action.focus};
    }
    .sld-marker.sld-is-visible {
      opacity: 1;
    }
    &.formDiv{
      .esri-feature-form {
        background-color: ${t.sys.color.surface.paper};
      }
    }
  }
  `}var Kn=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};class Zn extends e.React.PureComponent{constructor(n){super(n),this.onActiveViewChange=e=>Kn(this,void 0,void 0,(function*(){e&&e.view&&this.waitForChildDataSourcesReady(e).finally((()=>{this.setState({jimuMapView:e})}))})),this.waitForChildDataSourcesReady=t=>Kn(this,void 0,void 0,(function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const n=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==n?void 0:n.isDataSourceSet())&&!n.areChildDataSourcesCreated()?n.childDataSourcesReady().then((()=>n)).catch((e=>n)):Promise.resolve(n)})),this.getI18nMessage=(e,n)=>{const a=Object.assign({},t,r.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:a[e]},n)},this.state={hideTitle:!1,jimuMapView:void 0,highlightGraphicLayer:null,locationInfoFromDataAction:null,networkDataSourceFromDataAction:null},this.widgetOuterDivId="widget-outer-div-"+this.props.id}componentDidMount(){var e,t;(null===(e=this.props.mutableStatePropsVersion)||void 0===e?void 0:e.selectedDataSource)?this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource}):(null===(t=this.props.mutableStatePropsVersion)||void 0===t?void 0:t.routeLocationParams)&&this.setState({locationInfoFromDataAction:this.props.routeLocationParams});const n=(0,u.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:n})}componentDidUpdate(t,n){var a,i,r,o,s,l,c,u,d,f;n.jimuMapView!==this.state.jimuMapView&&this.state.jimuMapView&&(this.removeGraphicLayer(),this.createGraphicLayer());const p=null===(r=null===(i=null===(a=(0,e.getAppStore)())||void 0===a?void 0:a.getState())||void 0===i?void 0:i.widgetsRuntimeInfo[this.props.id])||void 0===r?void 0:r.state;if((p===e.WidgetState.Opened||!p)&&((null===(o=this.props)||void 0===o?void 0:o.selectedNetworkDataSource)&&(t&&t.mutableStatePropsVersion&&t.mutableStatePropsVersion.selectedNetworkDataSource&&(null===(s=null==t?void 0:t.mutableStatePropsVersion)||void 0===s?void 0:s.selectedNetworkDataSource)===(null===(l=this.props.mutableStatePropsVersion)||void 0===l?void 0:l.selectedNetworkDataSource)||this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource})),null===(c=this.props)||void 0===c?void 0:c.routeLocationParams)){!(null===(u=this.props)||void 0===u?void 0:u.routeLocationParams)||t&&t.mutableStatePropsVersion&&t.mutableStatePropsVersion.routeLocationParams&&(null===(d=null==t?void 0:t.mutableStatePropsVersion)||void 0===d?void 0:d.routeLocationParams)===(null===(f=this.props.mutableStatePropsVersion)||void 0===f?void 0:f.routeLocationParams)||this.setState({locationInfoFromDataAction:this.props.routeLocationParams})}}resetDataAction(){this.setState({networkDataSourceFromDataAction:null}),this.setState({locationInfoFromDataAction:null})}componentWillUnmount(){this.removeGraphicLayer()}removeGraphicLayer(){(0,u.isDefined)(this.state.highlightGraphicLayer)&&(this.state.highlightGraphicLayer.removeAll(),this.state.highlightGraphicLayer.destroy(),this.setState({highlightGraphicLayer:null}))}createGraphicLayer(){var e;if((0,u.isDefined)(this.state.jimuMapView)){this.removeGraphicLayer();const t=new c.default({listMode:"hide"});null===(e=this.state.jimuMapView.view)||void 0===e||e.map.add(t),this.setState({highlightGraphicLayer:t})}}render(){var t,n;const{config:a,id:i,routeLocationParams:o,selectedNetworkDataSource:c,outputDataSources:u}=this.props,{lrsLayers:d,mapHighlightColor:f,attributeSets:p,defaultPointAttributeSet:m,defaultLineAttributeSet:h,attributeInputType:y,defaultDisplayType:v,defaultDiagramScale:b,allowMerge:x,conflictPreventionEnabled:S,showEventStatistics:w}=a,{highlightGraphicLayer:I,jimuMapView:D}=this.state,N=this.props.theme;return(null===(t=a.lrsLayers)||void 0===t?void 0:t.length)?(0,e.jsx)(g,null,(0,e.jsx)("div",{id:this.widgetOuterDivId,className:"jimu-widget runtime-dynamic-segmentation surface-1 border-0 d-flex",css:Xn(N,a.tableHighlightColor)},(0,e.jsx)("div",{className:"table-indent"},(0,e.jsx)(l.JimuMapViewComponent,{useMapWidgetId:null===(n=this.props.useMapWidgetIds)||void 0===n?void 0:n[0],onActiveViewChange:this.onActiveViewChange}),(0,e.jsx)(Qn,{widgetId:i,allowMerge:x,conflictPreventionEnabled:S,intl:this.props.intl,networkDS:c,routeInfo:o,lrsLayers:d,attributeSets:p,defaultPointAttributeSet:m,defaultLineAttributeSet:h,attributeInputType:y,mapHighlightColor:f,graphicsLayer:I,defaultDisplayType:v,defaultDiagramScale:b,jimuMapView:D,outputDataSources:u,showEventStatistics:w,useMapWidgetIds:this.props.useMapWidgetIds,onResetDataAction:this.resetDataAction.bind(this)})))):(0,e.jsx)(r.WidgetPlaceholder,{icon:s(),widgetId:i,message:this.getI18nMessage("_widgetLabel")})}}Zn.mapExtraStateProps=(e,t)=>{var n,a;return{routeLocationParams:null===(n=null==t?void 0:t.mutableStateProps)||void 0===n?void 0:n.routeLocationParams,selectedNetworkDataSource:null===(a=null==t?void 0:t.mutableStateProps)||void 0===a?void 0:a.selectedNetworkDataSource}};const ea=Zn;function ta(e){h.p=e}})(),y})())}}}));