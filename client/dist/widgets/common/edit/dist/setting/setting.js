System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-theme","jimu-ui/basic/list-tree","jimu-ui/advanced/data-source-selector"],(function(e,t){var a={},i={},n={},l={},o={},s={},r={};return{setters:[function(e){a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.JSAPILayerTypes=e.JSAPILayerTypes,a.React=e.React,a.ServiceManager=e.ServiceManager,a.SupportedLayerServiceTypes=e.SupportedLayerServiceTypes,a.SupportedServerTypes=e.SupportedServerTypes,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.defaultMessages=e.defaultMessages,a.hooks=e.hooks,a.jsx=e.jsx,a.polished=e.polished},function(e){i.AdvancedSelect=e.AdvancedSelect,i.Alert=e.Alert,i.Button=e.Button,i.Checkbox=e.Checkbox,i.ConfirmDialog=e.ConfirmDialog,i.Label=e.Label,i.Loading=e.Loading,i.LoadingType=e.LoadingType,i.PanelHeader=e.PanelHeader,i.Popper=e.Popper,i.Radio=e.Radio,i.Select=e.Select,i.Switch=e.Switch,i.TextArea=e.TextArea,i.TextInput=e.TextInput,i.Tooltip=e.Tooltip,i.defaultMessages=e.defaultMessages},function(e){n.JimuLayerViewSelector=e.JimuLayerViewSelector,n.MapWidgetSelector=e.MapWidgetSelector,n.SettingRow=e.SettingRow,n.SettingSection=e.SettingSection,n.SidePopper=e.SidePopper},function(e){l.JimuMapViewComponent=e.JimuMapViewComponent,l.SnappingUtils=e.SnappingUtils},function(e){o.useTheme=e.useTheme},function(e){s.List=e.List,s.Tree=e.Tree,s.TreeAlignmentType=e.TreeAlignmentType,s.TreeCollapseStyle=e.TreeCollapseStyle,s.TreeItemActionType=e.TreeItemActionType},function(e){r.DataSourceSelector=e.DataSourceSelector,r.FieldSelector=e.FieldSelector,r.dataComponentsUtils=e.dataComponentsUtils}],execute:function(){e((()=>{var e={31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},19556:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1 2h4a1 1 0 0 1 1 1v1h8a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1m0 1v11h13V4.913H5V3zm6 3h1v3h3v1H8v3H7v-3H4V9h3z" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},53195:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 3.307V15l5.722-2.117 4.528 1.937L16 12.693V1l-5.722 2.117L5.75 1.18zm1 10.286V3.974l4-1.48v9.619zm5-1.65 4 1.711V4.057L6 2.346zm5 1.563V3.887l4-1.48v9.619z" clip-rule="evenodd"></path></svg>'},72529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.027 0A8 8 0 1 1 0 8a8 8 0 0 1 8.027-8m-2.07 1.303A7 7 0 0 0 2.256 4h1.6a8.3 8.3 0 0 1 2.103-2.697M3.453 5H1.674a7 7 0 0 0-.656 2.5H3.01q.06-1.336.441-2.5m.56 2.5a8.1 8.1 0 0 1 .5-2.5H7.5v2.5zm-1.001 1H1.018c.062.89.291 1.733.656 2.5h1.778a9.3 9.3 0 0 1-.441-2.5M4.512 11a8.1 8.1 0 0 1-.5-2.5H7.5V11zm-.657 1h-1.6a7 7 0 0 0 3.702 2.697A8.3 8.3 0 0 1 3.855 12M7.5 14.61V12H4.985q.869 1.516 2.515 2.61M7.5 4V1.39Q5.854 2.484 4.985 4zm2.543 10.697A7 7 0 0 0 13.745 12h-1.6a8.3 8.3 0 0 1-2.102 2.697M12.548 11h1.778c.365-.767.594-1.61.656-2.5H12.99a9.3 9.3 0 0 1-.441 2.5m-.56-2.5a8.1 8.1 0 0 1-.5 2.5H8.5V8.5zm1.001-1h1.993a7 7 0 0 0-.656-2.5h-1.778q.381 1.164.441 2.5M11.488 5q.434 1.146.5 2.5H8.5V5zm.657-1h1.6a7 7 0 0 0-3.703-2.697Q11.408 2.473 12.145 4M8.5 1.39Q10.146 2.484 11.015 4H8.5zM8.5 12h2.515q-.869 1.516-2.515 2.61z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=l},79244:e=>{"use strict";e.exports=a},1888:e=>{"use strict";e.exports=o},14321:e=>{"use strict";e.exports=i},13089:e=>{"use strict";e.exports=r},79298:e=>{"use strict";e.exports=n},98640:e=>{"use strict";e.exports=s}},t={};function c(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,c),n.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var a in t)c.o(t,a)&&!c.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var d={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(d),c.d(d,{__set_webpack_public_path__:()=>Je,default:()=>He});var e,t,a,i,n=c(79244),l=c(14321),o=c(79298),s=c(62686);!function(e){e.Attribute="ATTRIBUTE",e.Geometry="GEOMETRY"}(e||(e={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(t||(t={})),function(e){e.NoMap="NOMAP",e.NoLayer="NOEDITABLE"}(a||(a={})),function(e){e.Prescriptive="PRESCRIPTIVE",e.Flexible="FLEXIBLE"}(i||(i={}));const r={newEdit:"New editable source",newEditTips:"Support selected features view only",attrMode:"Attribute only",layerConfig:"Layer configuration",capability:"Capability",addRecords:"Add records",deleteRecords:"Delete records",updateRecords:"Update records",snappingSettings:"Snapping settings",selfSnapping:"Geometry guides",featureSnapping:"Feature to feature",configFields:"Configure fields",configFieldsTip:"Select fields to show",addGroup:"Add a group",group:"Group",checkAll:"Check all",uncheckAll:"Uncheck all",noDataMessageDefaultText:"No valid record is selected, select one or add one.",editBlankStatus:'Click the "{EditString}" button to add and configure {ModeString}',editableSource:"editable data sources",changeModeConfirmTitle:"Are you sure you want to switch the mode?",changeModeConfirmTips:"You will lose the settings configured.",editable:"Editable",editFieldDescription:"Please input the description.",editableCount:"{count} Editable",layerHonorSetting:"Use webmap settings",layerCustomize:"Customize",noLayerTips:"The Map does not contain any editable data.",chooseDefault:"Choose default snapping layers",uneditableTips:"The layer is in a read-only state.",templateFilter:"Template filter",relatedRecords:"Related records",runtimeDataEditing:"Runtime data editing",initialReshapeMode:"Display vertices while editing",selectLayers:"Select layers",editGeometryGuides:"Show visual aids to help identify perpendicular and parallel lines when creating or updating a feature.",editFeatureToFeature:"Snap vertices of a feature that is currently being drawn or reshaped to that of an existing feature's vertex, edge, or end point."},u=e=>{const{config:t,onPropertyChange:a}=e,{description:i,noDataMessage:s}=t,c=n.hooks.useTranslation(r,l.defaultMessages);return(0,n.jsx)(o.SettingSection,{role:"group","aria-label":c("iconGroup_general"),title:c("iconGroup_general")},(0,n.jsx)(o.SettingRow,{flow:"wrap",label:c("description")},(0,n.jsx)(l.TextArea,{className:"w-100",height:90,"aria-label":c("description"),placeholder:c("editFieldDescription"),defaultValue:null!=i?i:"",onBlur:e=>{a("description",e.target.value)}})),(0,n.jsx)(o.SettingRow,{flow:"wrap",label:c("noDataMessage")},(0,n.jsx)(l.TextArea,{className:"w-100",height:75,"aria-label":c("noDataMessage"),placeholder:c("noDataMessageDefaultText"),defaultValue:s,onBlur:e=>{a("noDataMessage",e.target.value)}})))};var m=c(1888),p=c(23662),g=c.n(p),f=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const h=e=>{const t=window.SVG,{className:a}=e,i=f(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:g()},i)):n.React.createElement("svg",Object.assign({className:l},i))};var y=c(98640),v=c(62838),b=c.n(v);const S={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:y.TreeItemActionType.RenderOverrideItem,children:[{name:y.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:y.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:y.TreeItemActionType.RenderOverrideItemBody,children:[{name:y.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:y.TreeItemActionType.RenderOverrideItemDragHandle},{name:y.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:y.TreeItemActionType.RenderOverrideItemTitle},{name:y.TreeItemActionType.RenderOverrideItemDetailToggle},{name:y.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})},x=e=>{const{layersConfig:t,activeIndex:a,failedDataSourceIds:i,onRemove:s,onSort:r,onClick:c}=e,d=n.hooks.useTranslation(l.defaultMessages,n.defaultMessages),u=t.length,m=n.React.useMemo((()=>t.asMutable({deep:!0}).map(((e,t)=>({itemStateDetailContent:e,itemKey:e.id,itemStateTitle:e.name,itemStateChecked:t===a,itemStateCommands:[{label:d("remove"),iconProps:()=>({icon:b(),size:12}),action:()=>{s(e.id)}}]})))),[a,t,s,d]),p=n.React.useMemo((()=>(0,n.jsx)(l.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:d("dataSourceCreateError")})),[d]),g=n.React.useCallback(((e,t)=>{var a,n;const{itemJsons:l}=t.props,[o]=l,s=null===(n=null===(a=null==o?void 0:o.itemStateDetailContent)||void 0===a?void 0:a.useDataSource)||void 0===n?void 0:n.dataSourceId;return i.includes(s)?p:null}),[p,i]),f=n.React.useCallback(((e,t)=>{if("handleDidDrop"===e.updateType){const t=e.targetDropItemChildren.map((e=>e.itemKey));r(t)}}),[r]),h=n.React.useCallback(((e,t)=>{const{itemJsons:[a]}=t.props;c(a.itemKey)}),[c]),v=n.React.useMemo((()=>[{itemStateDetailContent:"......",itemKey:`${a}`,itemStateTitle:"......",itemStateChecked:!0,itemStateCommands:[]}]),[a]);return(0,n.jsx)(o.SettingRow,{className:"setting-ui-unit-list",css:n.css`
    display: block !important;
    &.setting-ui-unit-list {
      width: 100%;
      .tree-item {
        justify-content: space-between;
        align-items: center;
        font-size: 13px;
        &.tree-item_level-1 {
        }
        .jimu-checkbox {
          margin-right: 8px;
        }
      }
      .setting-ui-unit-list-new {
        padding-top: 4px;
      }
    }
  `},u>0&&(0,n.jsx)(y.List,Object.assign({className:"w-100",itemsJson:m,dndEnabled:!0,renderOverrideItemDetailToggle:g,onUpdateItem:f,onClickItemBody:h},S)),u===a&&(0,n.jsx)(y.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:v,dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},S)))};var j=c(13089);const w=[n.JSAPILayerTypes.FeatureLayer,n.JSAPILayerTypes.SceneLayer,n.JSAPILayerTypes.BuildingComponentSublayer,n.JSAPILayerTypes.OrientedImageryLayer,n.JSAPILayerTypes.SubtypeSublayer],C=(0,n.Immutable)([n.DataSourceTypes.FeatureLayer,n.DataSourceTypes.SceneLayer,n.DataSourceTypes.BuildingComponentSubLayer,n.DataSourceTypes.OrientedImageryLayer,n.DataSourceTypes.SubtypeSublayer]),R=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),T=e=>{const t=null==e?void 0:e.allowGeometryUpdates,a=null==e?void 0:e.capabilities;return{allowGeometryUpdates:t,create:R(a,"create"),update:R(a,"update"),deletable:R(a,"delete")}};function I(e){if(!e)return[];const t=e.objectIdField,{creationDateField:a,creatorField:i,editDateField:n,editorField:l}=e.editFieldsInfo||{},{shapeAreaFieldName:o,shapeLengthFieldName:s}=e.geometryProperties||{};return[t,a,i,n,l,o,s].filter(Boolean)}const N=(e,a)=>{var i,l,o,s,r;const c=e.getLayerDefinition(),{allowGeometryUpdates:d,create:u,update:m,deletable:p}=T(c),g=(null===(o=null===(l=null===(i=e.getSchema())||void 0===i?void 0:i.fields)||void 0===l?void 0:l.asMutable)||void 0===o?void 0:o.call(l,{deep:!0}))||{};let f=Object.values(g);f=f.filter((e=>!I(c).includes(e.name)));const h=null===(s=a.formTemplate)||void 0===s?void 0:s.elements;if(h){const e=[];h.forEach((t=>{"group"===t.type?t.elements.forEach((t=>{"field"===t.type&&e.push(t.fieldName)})):"field"===t.type&&e.push(t.fieldName)})),f=f.filter((t=>e.includes(t.name)))}(null==f?void 0:f.length)>50&&(f=f.slice(0,50));const y=(null==c?void 0:c.fields)||[],v=f.map((e=>{const t=y.find((t=>t.name===e.jimuName)),a=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:a,subDescription:(null==e?void 0:e.description)||"",editable:a})})),b={dataSourceId:e.id,mainDataSourceId:e.id,dataViewId:e.dataViewId,rootDataSourceId:null===(r=e.getRootDataSource())||void 0===r?void 0:r.id};return{id:e.id,name:e.getLabel(),useDataSource:(0,n.Immutable)(b),addRecords:u,deleteRecords:p,updateRecords:m,updateAttributes:m,updateGeometries:d&&m,showFields:f,groupedFields:v,layerHonorMode:t.Webmap}},O=e=>n.DataSourceManager.getInstance().getDataSource(e),k=e=>{const t=(null==e?void 0:e.type)===n.DataSourceTypes.SceneLayer||(null==e?void 0:e.type)===n.DataSourceTypes.BuildingComponentSubLayer;null==e||e.type,n.DataSourceTypes.OrientedImageryLayer;let a;return a=t?e.getAssociatedDataSource():e,a},M=e=>n.css`
    .disabled-label{
      color: ${e.ref.palette.neutral[700]};
    }
  `,D=e=>{const{layerConfig:t,isGeoMode:a,layerDefinition:i,layerEditingEnabled:s,onChange:c}=e,{addRecords:d,deleteRecords:u,updateRecords:p,updateAttributes:g,updateGeometries:f}=t,h=n.hooks.useTranslation(r,l.defaultMessages),y=(0,m.useTheme)(),v=(null==i?void 0:i.type)===n.SupportedLayerServiceTypes.Table,{allowGeometryUpdates:b,create:S,update:x,deletable:j}=T(i),w=n.React.useCallback(((e,a)=>{const i=e.currentTarget;i&&c(t.set(a,i.checked))}),[t,c]),C=n.React.useCallback(((e,a)=>{const i=e.currentTarget;if(!i)return;const n=i.checked;c(t.set("updateRecords",n).set("updateAttributes",n).set("updateGeometries",b&&n))}),[b,t,c]),R=n.React.useCallback(((e,a)=>{const i=e.currentTarget;if(!i)return;const n=i.checked;c("updateAttributes"===a&&!n&&!f||"updateGeometries"===a&&!n&&!g?t.set("updateRecords",!1).set("updateAttributes",!1).set("updateGeometries",!1):t.set(a,n))}),[t,c,g,f]);return(0,n.jsx)(o.SettingSection,{title:h("capability"),css:M(y)},s?(0,n.jsx)(n.React.Fragment,null,(!a&&v||a)&&(0,n.jsx)(o.SettingRow,{tag:"label",label:h("addRecords")},(0,n.jsx)(l.Switch,{"aria-label":h("addRecords"),className:"can-x-switch",checked:d,onChange:e=>{w(e,"addRecords")},disabled:!S})),(0,n.jsx)(o.SettingRow,{tag:"label",label:h("deleteRecords")},(0,n.jsx)(l.Switch,{"aria-label":h("deleteRecords"),className:"can-x-switch",checked:u,onChange:e=>{w(e,"deleteRecords")},disabled:!j})),(0,n.jsx)(o.SettingRow,{tag:"label",label:h("updateRecords")},(0,n.jsx)(l.Switch,{"aria-label":h("updateRecords"),className:"can-x-switch",checked:p,onChange:C,disabled:!x})),a&&p&&(0,n.jsx)("div",{className:"ml-4 mt-2"},(0,n.jsx)(l.Label,{className:"w-100 d-flex"},(0,n.jsx)(l.Checkbox,{style:{cursor:"pointer",marginTop:"2px"},checked:g,"aria-label":h("attribute"),onChange:e=>{R(e,"updateAttributes")},disabled:!x}),(0,n.jsx)("div",{className:"m-0 ml-2 flex-grow-1 omit-label"},h("attribute"))),(0,n.jsx)(l.Label,{className:"w-100 d-flex"},(0,n.jsx)(l.Checkbox,{style:{cursor:"pointer",marginTop:"2px"},checked:f,"aria-label":h("geometry"),onChange:e=>{R(e,"updateGeometries")},disabled:!b}),(0,n.jsx)("div",{className:`m-0 ml-2 flex-grow-1 omit-label ${!b&&"disabled-label"}`},h("geometry"))))):h("uneditableTips"))};var A=c(19556),E=c.n(A),L=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const P=e=>{const t=window.SVG,{className:a}=e,i=L(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:E()},i)):n.React.createElement("svg",Object.assign({className:l},i))};var F=c(9044),V=c.n(F),z=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const B=e=>{const t=window.SVG,{className:a}=e,i=z(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:V()},i)):n.React.createElement("svg",Object.assign({className:l},i))};var G=c(45508),H=c.n(G),J=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const U=e=>{const t=window.SVG,{className:a}=e,i=J(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:H()},i)):n.React.createElement("svg",Object.assign({className:l},i))},_="root item for tree data entry",W={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:y.TreeItemActionType.RenderOverrideItem,children:[{name:y.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:y.TreeItemActionType.RenderOverrideItemContent,children:[{name:y.TreeItemActionType.RenderOverrideItemBody,children:[{name:y.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:y.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:y.TreeItemActionType.RenderOverrideItemDragHandle},{name:y.TreeItemActionType.RenderOverrideItemChildrenToggle},{name:y.TreeItemActionType.RenderOverrideItemIcon},{name:y.TreeItemActionType.RenderOverrideItemTitle},{name:y.TreeItemActionType.RenderOverrideItemCommands},{name:y.TreeItemActionType.RenderOverrideItemDetailToggle}]}]},{name:y.TreeItemActionType.RenderOverrideItemDetailLine}]}]}]},{name:y.TreeItemActionType.RenderOverrideItemSubitems}]})},$=e=>n.css`
    .fields-list-header {
      background: ${e.ref.palette.neutral[300]};
      border-bottom: 1px solid ${e.ref.palette.neutral[600]};
      height: 34px;
      width: 100%;
      flex-wrap: nowrap;
      .jimu-checkbox {
        margin-top: 2px;
      }
      .fields-list-check {
        margin-left: 18px;
      }
    }
    .selected-fields-con{
      margin-top: 0 !important;
      .selected-fields-list {
        flex: 1;
        max-height: 300px;
        overflow-y: auto;
      }
      .jimu-tree-item{
        background: ${e.ref.palette.neutral[300]};
        border-bottom: 1px solid ${e.ref.palette.neutral[400]};
        .jimu-tree-item__content{
          div:first-of-type{
            padding-left: 2px;
          }
          .jimu-tree-item__body{
            background: ${e.ref.palette.neutral[300]};
            .jimu-tree-item__title{
              .jimu-input{
                width: 125px;
              }
            }
            .item-remove-button {
              padding: 0 2px; /** consistent with detail icon from tree. */
            }
            &:hover {
              background: none !important;
            }
          }
        }
      }
    }
  `,q=(e,t)=>{let a=!1;for(const i of e)if(i.jimuName===t.jimuName){a=!0;break}return a},K=e=>{const t=[];return e.forEach((e=>{(null==e?void 0:e.groupKey)&&t.push(null==e?void 0:e.groupKey)})),t.length>0?Math.max.apply(null,t):0},Q=e=>{const{layerConfig:a,layerDefinition:i,layerEditingEnabled:s,isFromMap:c,onChange:d}=e,{useDataSource:u,showFields:p,groupedFields:g,layerHonorMode:f}=a,[h,v]=n.React.useState(null),[b,S]=n.React.useState(!1),[x,w]=n.React.useState(null),[C,R]=n.React.useState(!1),T=n.React.useRef(null),N=n.React.useRef(null),k=(0,m.useTheme)(),M=n.hooks.useTranslation(r,l.defaultMessages),D=n.React.useMemo((()=>g.asMutable({deep:!0})),[g]),A=n.React.useMemo((()=>{let e=0;return null==D||D.forEach((t=>{(null==t?void 0:t.children)?t.children.forEach((t=>{t.editAuthority&&e++})):t.editAuthority&&e++})),e}),[D]),E=n.React.useMemo((()=>p.map((e=>e.jimuName))),[p]),L=n.React.useMemo((()=>(0,n.Immutable)(I(i)||[])),[i]),F=n.React.useMemo((()=>!!D&&D.some((e=>!e.editAuthority&&e.editable))),[D]),V=n.React.useMemo((()=>{if(!D)return!1;const e=D.some((e=>e.editAuthority&&e.editable)),t=D.some((e=>!e.editAuthority&&e.editable));return e&&t}),[D]),z=n.React.useCallback((e=>{const t=O(null==u?void 0:u.dataSourceId),a=null==t?void 0:t.getSchema(),i=(null==a?void 0:a.fields)?Object.values(null==a?void 0:a.fields):[],n=e=>e.filter((e=>!L.includes(e.jimuName))).map((e=>Object.assign({itemKey:e.jimuName,itemStateChecked:!!s&&(null==e?void 0:e.editAuthority),itemStateTitle:e.alias||e.jimuName||e.name,itemStateIcon:j.dataComponentsUtils.getIconFromFieldType(e.type,k),itemStateDetailContent:e,itemStateDisabled:!(null==e?void 0:e.groupKey)&&!q(i,e),itemStateCommands:[],isCheckboxDisabled:!s||!e.editable},e.children?{itemChildren:n(e.children)}:{}))),l=n(e);v({itemKey:_,itemStateTitle:_,itemChildren:l})}),[L,s,k,null==u?void 0:u.dataSourceId]),G=n.hooks.useLatest(h),H=n.hooks.usePrevious(a.id);n.React.useEffect((()=>{(!G.current&&D||H!==a.id)&&z(D)}),[z,D,H,a.id,G]);const J=n.React.useCallback(((e,t)=>{d(a.set("layerHonorMode",t))}),[a,d]),Q=n.React.useCallback((e=>{if(!e)return;const t=e.filter((e=>e));let n=D;const l=t.filter((e=>!p.find((t=>t.jimuName===e.jimuName))));for(const e of l){const t=((null==i?void 0:i.fields)||[]).find((t=>t.name===e.jimuName)),a=null==t?void 0:t.editable;n.push(Object.assign(Object.assign({},e.asMutable({deep:!0})),{editAuthority:a,subDescription:(null==e?void 0:e.description)||"",editable:a}))}const o=p.filter((e=>!t.find((t=>t.jimuName===e.jimuName)))).map((e=>e.jimuName));n=n.filter((e=>!o.includes(e.jimuName)));for(let e=0;e<n.length;e++){const t=n[e];t.children&&(t.children=t.children.filter((e=>!o.includes(e.jimuName))))}d(a.set("showFields",t).set("groupedFields",n)),z(n)}),[z,D,a,null==i?void 0:i.fields,d,p]),Y=n.React.useCallback((()=>{const e=D;e.forEach((e=>{e.editable&&(e.editAuthority=F),e.children&&e.children.forEach((e=>{e.editAuthority=F}))})),d(a.set("groupedFields",e)),z(e)}),[z,D,F,a,d]),X=n.React.useCallback((()=>{R((()=>(setTimeout((()=>{R(!1)}),1e3),!0)));const e=K(D)+1,t=[{jimuName:`${M("group")}-${e}`,name:`${M("group")}-${e}`,alias:`${M("group")}-${e}`,subDescription:"",editAuthority:!1,editable:!0,children:[],groupKey:e},...D];d(a.set("groupedFields",t)),z(t)}),[z,D,a,d,M]),Z=n.React.useCallback((e=>{let t=[];for(const a of D)t=a.jimuName===e?t.concat(a.children):t.concat(a);d(a.set("groupedFields",t)),(null==x?void 0:x.jimuName)===e&&S(!1),z(t)}),[z,null==x?void 0:x.jimuName,D,a,d]),ee=n.React.useCallback(((e,t)=>{const{itemJsons:a}=t.props,[i]=a,{groupKey:o,jimuName:s}=(null==i?void 0:i.itemStateDetailContent)||{};return o?(0,n.jsx)(l.Button,{icon:!0,size:"sm",type:"tertiary",disableHoverEffect:!0,disableRipple:!0,className:"item-remove-button",onClick:e=>{null==e||e.stopPropagation(),Z(s)},onKeyUp:e=>{" "!==e.key&&"Enter"!==e.key||Z(s)},title:M("remove"),"aria-label":M("remove")},(0,n.jsx)(B,null)):""}),[Z,M]),te=n.React.useCallback(((e,t)=>{T.current=e.current,w(t),S((e=>!e))}),[]),ae=n.React.useCallback(((e,t)=>{const{itemJsons:a,itemJsons:[{itemStateDetailVisible:i,itemStateDetailContent:o,itemStateDisabled:s}]}=t.props,[r]=a,c=null==r?void 0:r.itemStateDetailContent;return o?(0,n.jsx)(l.Button,{icon:!0,type:"tertiary",size:"sm",title:M("description"),"aria-label":M("description"),disabled:!!s,disableHoverEffect:!0,disableRipple:!0,"aria-expanded":!!i,className:"jimu-tree-item__detail-toggle",onClick:e=>{e.stopPropagation(),te(t.dragRef,c)},onKeyUp:e=>{" "!==e.key&&"Enter"!==e.key||(e.stopPropagation(),te(t.dragRef,c))},css:()=>n.css`
        &.jimu-tree-item__detail-toggle {
          display: flex;
          align-items: center;
          cursor: pointer;

          .icon-btn-sizer {
            margin: 0;
            min-width: 0.5rem;
            min-height: 0.5rem;
          }
        }
      `},(0,n.jsx)(U,{autoFlip:!i})):null}),[te,M]),ie=n.React.useCallback(((e,t)=>{var a,i,n;const{draggingItemJsons:l,targetItemJsons:o,dropType:s}=e,r=null===(a=o[0])||void 0===a?void 0:a.itemChildren,c=null===(i=o[Math.min(1,o.length-2)])||void 0===i?void 0:i.itemChildren,d=null===(n=l[0])||void 0===n?void 0:n.itemChildren;let u=!0;return"to-inside"!==s||r&&!d||(u=!1),"to-inside"!==s&&c&&d&&(u=!1),u}),[]),ne=n.React.useCallback(((e,t)=>{const{targetItemJsons:a}=e,[i]=a,{groupKey:n}=(null==i?void 0:i.itemStateDetailContent)||{};return!!n}),[]),le=n.React.useCallback(((e,t)=>{var i;const{itemJsons:n,updateType:l}=e,o=n[0],s=null==o?void 0:o.itemStateDetailContent;if(!(null==s?void 0:s.groupKey)&&l===y.TreeItemActionType.HandleStartEditing)return;const r=n[n.length-1];v(r);const c=null===(i=r.itemChildren)||void 0===i?void 0:i.map(((e,t)=>{var a;const i=e.itemStateDetailContent;if(e.itemChildren){e.itemStateTitle||(e.itemStateTitle=null===(a=e.itemStateDetailContent)||void 0===a?void 0:a.jimuName),i.name=e.itemStateTitle,i.alias=e.itemStateTitle;const t=e.itemChildren.length>0&&!e.itemChildren.some((e=>!e.isCheckboxDisabled&&!e.itemStateChecked));i.editAuthority=t;const n=e.itemChildren.map((e=>(e.itemStateDetailContent.editAuthority=e.itemStateChecked,e.itemStateDetailContent)));i.children=n}else i.editAuthority=e.itemStateChecked;return i}));d(a.set("groupedFields",c))}),[a,d]),oe=n.React.useCallback((e=>{let t;return D.forEach(((a,i)=>{if(a.jimuName===e)t=[i];else if(null==a?void 0:a.children){const n=a.children.findIndex((t=>t.jimuName===e));n>-1&&(t=[i,n])}})),t}),[D]),se=n.React.useCallback((()=>{var e;const t=D,i=oe(null==x?void 0:x.jimuName),n=(null===(e=N.current)||void 0===e?void 0:e.value)||"";if(2===i.length){const[e,a]=i,l=t[e].children[a];l&&(l.subDescription=n)}else if(1===i.length){const[e]=i;t[e].subDescription=n}d(a.set("groupedFields",t)),S(!1),z(t)}),[z,null==x?void 0:x.jimuName,oe,D,a,d]);return c&&(0,n.jsx)(o.SettingSection,{title:M("configFields"),css:$(k)},(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Select,{size:"sm",className:"w-100",value:f,onChange:J},(0,n.jsx)("option",{value:t.Webmap},M("layerHonorSetting")),(0,n.jsx)("option",{value:t.Custom},M("layerCustomize")))),f===t.Custom&&(0,n.jsx)(n.React.Fragment,null,(0,n.jsx)(o.SettingRow,{flow:"wrap",label:M("configFieldsTip")},(0,n.jsx)(j.FieldSelector,{useDataSources:u?(0,n.Immutable)([u]):(0,n.Immutable)([]),selectedFields:(0,n.Immutable)(E),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,hiddenFields:L,onChange:Q})),(0,n.jsx)(o.SettingRow,{flow:"wrap",label:s&&M("editableCount",{count:A})},(0,n.jsx)("div",{className:"fields-list-header form-inline"},(0,n.jsx)("div",{className:"d-flex w-100 fields-list-check"},s&&(0,n.jsx)(l.Checkbox,{id:"editAll","data-field":"editAll",onClick:Y,checked:!F,indeterminate:V,title:F?`${M("editable")} (${M("checkAll")})`:`${M("editable")} (${M("uncheckAll")})`}),(0,n.jsx)(l.Label,{for:"editAll",style:{cursor:"pointer"},className:"ml-2",title:M("field")},M("field"))),(0,n.jsx)(l.Button,{icon:!0,size:"sm",type:"tertiary",disableHoverEffect:!0,disableRipple:!0,onClick:X,title:M("addGroup"),"aria-label":M("addGroup"),disabled:C},(0,n.jsx)(P,null)))),(0,n.jsx)(o.SettingRow,{className:"selected-fields-con"},(0,n.jsx)(y.Tree,Object.assign({className:"selected-fields-list",rootItemJson:h,treeAlignmentType:y.TreeAlignmentType.Intact,dndEnabled:!0,checkboxLinkage:s,collapseStyle:y.TreeCollapseStyle.Arrow,renderOverrideItemCommands:ee,renderOverrideItemDetailToggle:ae,isItemDroppable:ie,isFolder:ne,onUpdateItem:le},W)),x&&(0,n.jsx)(l.Popper,{placement:"bottom-start",reference:T,offsetOptions:[-27,3],open:b,arrowOptions:!1,toggle:()=>{S(!1)}},(0,n.jsx)("div",{style:{width:228,height:132},className:"p-4"},(0,n.jsx)(l.TextArea,{ref:N,id:null==x?void 0:x.jimuName,className:"w-100",height:60,placeholder:M("editFieldDescription"),defaultValue:(null==x?void 0:x.subDescription)||(null==x?void 0:x.description)}),(0,n.jsx)("div",{className:"mt-4 float-right"},(0,n.jsx)(l.Button,{size:"sm",type:"primary",onClick:se},M("commonModalOk")),(0,n.jsx)(l.Button,{size:"sm",className:"ml-1",onClick:()=>{S(!1)}},M("commonModalCancel"))))))))};var Y=function(e,t,a,i){return new(a||(a=Promise))((function(n,l){function o(e){try{r(i.next(e))}catch(e){l(e)}}function s(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}r((i=i.apply(e,t||[])).next())}))};const X=e=>{const{layerConfig:t,isGeoMode:a,layerDefinition:i,layerEditingEnabled:s,isFromMap:c,filterDs:d,onChange:u,onClose:m}=e,[p,g]=n.React.useState(""),[f,h]=n.React.useState(null);n.React.useEffect((()=>{g((null==t?void 0:t.name)||"")}),[null==t?void 0:t.name]);const y=n.hooks.useTranslation(r,l.defaultMessages),v=(null==t?void 0:t.useDataSource)?(0,n.Immutable)([t.useDataSource]):(0,n.Immutable)([]),b=n.React.useCallback((e=>Y(void 0,void 0,void 0,(function*(){const t=null==e?void 0:e[0];if(t)try{h((0,n.Immutable)(e));const a=yield n.DataSourceManager.getInstance().createDataSourceByUseDataSource(t),i=k(a),l=yield i.createJSAPILayerByDataSource(),o=N(i,l);u((0,n.Immutable)(o))}catch(e){console.error(e)}finally{h(null)}}))),[u]),S=n.React.useCallback((e=>{const t=e.target.value;g(t)}),[]),x=n.React.useCallback((e=>{(e=""===(e=null==e?void 0:e.trim())?null==t?void 0:t.name:e)!==p&&g(e),u(t.set("name",e))}),[p,t,u]);return(0,n.jsx)("div",{className:"w-100 h-100",css:n.css`
    .layer-config-panel {
      .panel-inner {
        .title {
          max-width: 70%;
        }
      }
      .setting-container {
        height: calc(100% - ${n.polished.rem(58)});
        overflow: auto;
      }
    }
  `},f&&(0,n.jsx)(l.Loading,{type:l.LoadingType.Secondary}),(0,n.jsx)("div",{className:"w-100 h-100 layer-config-panel"},(0,n.jsx)("div",{className:"w-100 d-flex px-4 py-0"},(0,n.jsx)(l.PanelHeader,{level:1,className:"px-0 py-4 panel-inner",showClose:!!m,onClose:m,title:y("layerConfig")})),(0,n.jsx)("div",{className:"setting-container"},(0,n.jsx)(o.SettingSection,{title:y("data"),className:"pt-0"},(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(j.DataSourceSelector,{types:C,disableRemove:()=>!0,disableDataSourceList:a,hideDataView:!0,useDataSources:f||v,mustUseDataSource:!0,onChange:b,closeDataSourceListOnChange:!0,hideDs:d,hideTabs:(0,n.Immutable)(["OUTPUT"])}))),t&&(0,n.jsx)(n.React.Fragment,null,!a&&(0,n.jsx)(o.SettingSection,{title:y("label")},(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.TextInput,{size:"sm",type:"text",className:"w-100",value:p,onChange:S,onAcceptValue:x,"aria-label":y("label")}))),(0,n.jsx)(D,{layerConfig:t,isGeoMode:a,layerDefinition:i,layerEditingEnabled:s,onChange:u}),(0,n.jsx)(Q,{layerConfig:t,isFromMap:c,layerDefinition:i,layerEditingEnabled:s,onChange:u})))))};class Z extends n.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{this.props.onDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onCreateDataSourceFailed=e=>{this.props.onDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}render(){return(0,n.jsx)(n.DataSourceComponent,{useDataSource:this.props.useDataSource,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})}}var ee=function(e,t,a,i){return new(a||(a=Promise))((function(n,l){function o(e){try{r(i.next(e))}catch(e){l(e)}}function s(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}r((i=i.apply(e,t||[])).next())}))};const te=e=>n.css`
    .edit-tips{
      font-style: italic;
      font-size: 12px;
      color: ${e.ref.palette.neutral[1e3]};
    }
  `,ae="NEW_LAYER_CONFIG_ID",ie=e=>{const{widgetId:t,config:a,useDataSources:i,onSettingChange:s}=e,{layersConfig:c}=a,[d,u]=n.React.useState(null),[p,g]=n.React.useState(!1),[f,y]=n.React.useState([]),[v,b]=n.React.useState({}),S=(0,m.useTheme)(),j=n.hooks.useTranslation(r,l.defaultMessages),w=j("newEdit"),R=n.React.useRef(null),I=n.React.useRef(null),N=n.React.useMemo((()=>d===ae?c.length:c.findIndex((e=>e.id===d))),[d,c]),M=n.React.useMemo((()=>{const e=c.find((e=>e.id===d));return(0,n.Immutable)(e)}),[d,c]),D=n.React.useMemo((()=>v[d]),[d,v]),A=n.React.useCallback(((e,t)=>{const a=c.findIndex((t=>t.id===e));let i;i=t?R.current.getElementsByClassName("add-edit-btn")[0]:R.current.getElementsByClassName("jimu-tree-item__body")[a],I.current=i,e!==d||t?(g(!0),u(e)):(g(!1),u(null))}),[d,c]),E=n.React.useCallback((()=>ee(void 0,void 0,void 0,(function*(){const e=n.DataSourceManager.getInstance().getDataSourcesAsArray().filter((e=>C.includes(e.type)&&!e.isDataView)),t=n.ServiceManager.getInstance(),a=e.map((e=>t.fetchArcGISServerInfo(e.url)));yield Promise.allSettled(a),A(ae,!0)}))),[A]),L=n.React.useCallback((()=>{g(!1),u(null)}),[]),P=n.React.useCallback((e=>{const n=a.layersConfig.filter((t=>t.id!==e));let l=a.set("layersConfig",n);0===n.length&&(l=l.set("description",""));const o=i?i.asMutable({deep:!0}):[];s({id:t,config:l,useDataSources:o.filter((t=>t.dataSourceId!==e))}),e===d&&L()}),[d,a,L,s,i,t]),F=n.React.useCallback((e=>{const i=e.map((e=>c.find((t=>t.id===e))));s({id:t,config:a.set("layersConfig",i)})}),[a,c,s,t]),V=n.React.useCallback((e=>{if(!(null==e?void 0:e.url)||(null==e?void 0:e.isOutputFromWidget))return!0;const t=c.map((e=>e.id)),a=(n.dataSourceUtils.getFullArcGISServiceUrl(e.url,!1)||"").toLowerCase().endsWith(n.SupportedServerTypes.MapService.toLowerCase()),i=O(e.id),l=null==i?void 0:i.getLayerDefinition(),{create:o,update:s,deletable:r}=T(l),d=n.ServiceManager.getInstance().getServerInfoByServiceUrl(e.url),u=!(!d||d.owningSystemUrl||o||s||r);return t.includes(e.id)||a||u}),[c]),z=n.React.useCallback((e=>{const l=N>-1?N:c.length;let o=i||(0,n.Immutable)([]);(null==M?void 0:M.id)!==e.id&&(o=o.filter((e=>e.dataSourceId!==(null==M?void 0:M.id))),o=o.concat(e.useDataSource)),s({id:t,config:a.setIn(["layersConfig",`${l}`],e),useDataSources:o.asMutable()}),u(e.id)}),[N,null==M?void 0:M.id,a,c.length,s,i,t]),B=n.React.useCallback(((e,t)=>ee(void 0,void 0,void 0,(function*(){var a;const i=c.map((e=>e.id));if(t){const i=k(t),n=yield i.createJSAPILayerByDataSource(),l={id:e,dataSource:i,layer:n,layerDefinition:null==i?void 0:i.getLayerDefinition(),layerEditingEnabled:n.editingEnabled,isFromMap:!!(null===(a=null==i?void 0:i.getRootDataSource())||void 0===a?void 0:a.map)};b((t=>{const a={};for(const i of c)i.id===e?a[i.id]=l:t[i.id]&&(a[i.id]=t[i.id]);return a}))}else y((t=>[...t,e].filter((e=>i.includes(e)))))}))),[c]);return(0,n.jsx)(n.React.Fragment,null,c.map((e=>(0,n.jsx)(Z,{key:e.useDataSource.dataSourceId,useDataSource:e.useDataSource,onDataSourceCreatedOrFailed:B}))),(0,n.jsx)("div",{className:"mt-4",ref:R},(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Button,{className:"w-100 add-edit-btn",type:"primary",onClick:E,title:w,"aria-label":w,"aria-describedby":"edit-blank-msg"},(0,n.jsx)("div",{className:"w-100 px-2 text-truncate"},(0,n.jsx)(h,{className:"mr-1 mb-1"}),w))),(0,n.jsx)(o.SettingRow,{css:te(S)},(0,n.jsx)("div",{className:"text-break edit-tips"},j("newEditTips"))),c.length>0&&(0,n.jsx)(x,{layersConfig:c,activeIndex:N,failedDataSourceIds:f,onRemove:P,onSort:F,onClick:A})),(0,n.jsx)(o.SidePopper,{position:"right",isOpen:p,toggle:L,trigger:null==R?void 0:R.current,backToFocusNode:I.current},(0,n.jsx)(X,{layerConfig:M,isGeoMode:!1,layerDefinition:null==D?void 0:D.layerDefinition,layerEditingEnabled:null==D?void 0:D.layerEditingEnabled,isFromMap:null==D?void 0:D.isFromMap,filterDs:V,onChange:z,onClose:L})))},ne=e=>{const{config:t,onPropertyChange:a,onMultiplePropertyChange:i}=e,{tooltip:s,defaultTooltipEnabled:c,templateFilter:d,relatedRecords:u,liveDataEditing:m,initialReshapeMode:p}=t,g=n.hooks.useTranslation(r,l.defaultMessages);return(0,n.jsx)(o.SettingSection,{role:"group","aria-label":g("iconGroup_general"),title:g("iconGroup_general")},(0,n.jsx)(o.SettingRow,{tag:"label",label:g("tooltip")},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:s,"data-key":"tooltip",onChange:e=>{var t;t=e.target.checked,i([{name:"tooltip",value:t},{name:"defaultTooltipEnabled",value:!1}])}})),s&&(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Checkbox,{checked:c,className:"mr-1",onChange:e=>{a("defaultTooltipEnabled",e.target.checked)}}),g("defaultEnabled"))),(0,n.jsx)(o.SettingRow,{tag:"label",label:g("templateFilter")},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:d,"data-key":"templateFilter",onChange:e=>{a("templateFilter",e.target.checked)}})),(0,n.jsx)(o.SettingRow,{tag:"label",label:g("relatedRecords")},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:u,"data-key":"relatedRecords",onChange:e=>{a("relatedRecords",e.target.checked)}})),(0,n.jsx)(o.SettingRow,{tag:"label",label:g("runtimeDataEditing")},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:m,"data-key":"liveDataEditing",onChange:e=>{a("liveDataEditing",e.target.checked)}})),(0,n.jsx)(o.SettingRow,{tag:"label",label:g("initialReshapeMode")},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:p,"data-key":"initialReshapeMode",onChange:e=>{a("initialReshapeMode",e.target.checked)}})))};var le=c(53195),oe=c.n(le),se=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const re=e=>{const t=window.SVG,{className:a}=e,i=se(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:oe()},i)):n.React.createElement("svg",Object.assign({className:l},i))};var ce=c(72529),de=c.n(ce),ue=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const me=e=>{const t=window.SVG,{className:a}=e,i=ue(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:de()},i)):n.React.createElement("svg",Object.assign({className:l},i))};var pe=c(93303),ge=c.n(pe),fe=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const he=e=>{const t=window.SVG,{className:a}=e,i=fe(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:ge()},i)):n.React.createElement("svg",Object.assign({className:l},i))};var ye=c(30655),ve=c.n(ye),be=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const Se=e=>{const t=window.SVG,{className:a}=e,i=be(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:ve()},i)):n.React.createElement("svg",Object.assign({className:l},i))};var xe=c(94064),je=c.n(xe),we=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const Ce=e=>{const t=window.SVG,{className:a}=e,i=we(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:je()},i)):n.React.createElement("svg",Object.assign({className:l},i))};var Re=c(28996),Te=c.n(Re),Ie=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const Ne=e=>{const t=window.SVG,{className:a}=e,i=Ie(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:Te()},i)):n.React.createElement("svg",Object.assign({className:l},i))},Oe=e=>{var t;const{layersConfig:a,onChange:i}=e,[l,s]=n.React.useState(""),[r,c]=n.React.useState(!1),[d,u]=n.React.useState(null),m=n.React.useRef(null),p=n.React.useMemo((()=>{const e=a.find((e=>e.id===l));return(0,n.Immutable)(e)}),[l,a]),g=n.React.useMemo((()=>{const e=O(l);return k(e)}),[l]),f=null==g?void 0:g.getLayerDefinition(),h=null===(t=null==g?void 0:g.layer)||void 0===t?void 0:t.editingEnabled,v=n.React.useMemo((()=>a.map((e=>({itemStateDetailContent:e,itemKey:e.id,itemStateChecked:e.id===l,itemStateTitle:e.name,itemStateCommands:[]}))).asMutable({deep:!0})),[l,a]),b=n.React.useCallback(((e,t)=>{const{itemJsons:[i]}=t.props,n=i.itemStateDetailContent;if(n.id===l)s(null),c(!1),u(null);else if(s(n.id),c(!0),m.current){const e=a.findIndex((e=>e.id===n.id)),t=m.current.getElementsByClassName("jimu-tree-item__body")[e];u(t)}}),[l,a]),S=()=>{s(null),c(!1)};return(0,n.jsx)(o.SettingRow,null,(0,n.jsx)("div",{className:"w-100",ref:m},(0,n.jsx)(y.List,{className:"py-1",itemsJson:v,dndEnabled:!1,renderOverrideItemDetailToggle:()=>"",onClickItemBody:b})),(0,n.jsx)(o.SidePopper,{position:"right",isOpen:r,toggle:S,trigger:m.current,backToFocusNode:d},(0,n.jsx)(X,{layerConfig:p,isGeoMode:!0,layerDefinition:f,layerEditingEnabled:h,isFromMap:!0,onChange:e=>{const t=a.findIndex((e=>e.id===l));i(n.Immutable.set(a,t,e))},onClose:S})))};var ke=function(e,t,a,i){return new(a||(a=Promise))((function(n,l){function o(e){try{r(i.next(e))}catch(e){l(e)}}function s(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}r((i=i.apply(e,t||[])).next())}))};const Me=()=>n.css`
  .map-title {
    flex-grow: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .map-loading {
    flex-shrink: 0;
    position: relative;
    height: 16px;
    width: 16px;
  }
  .map-icon {
    flex-shrink: 0;
  }
`,De=e=>{const{jimuMapView:t,mapViewConfig:a=(0,n.Immutable)({}),onChange:i}=e,s=(null==a?void 0:a.customizeLayers)||!1,c=(null==a?void 0:a.customJimuLayerViewIds)||(0,n.Immutable)([]),d=(null==a?void 0:a.layersConfig)||(0,n.Immutable)([]),[u,m]=n.React.useState(!1),[p,g]=n.React.useState(!1),[f,h]=n.React.useState([]),[y,v]=n.React.useState(!1),b=n.React.useRef(null),S=n.hooks.useTranslation(l.defaultMessages,r),x="3d"===t.view.type,j=n.React.useMemo((()=>O(t.dataSourceId)),[t.dataSourceId]),C=n.React.useMemo((()=>{var e;return(null===(e=null==j?void 0:j.getLabel)||void 0===e?void 0:e.call(j))||""}),[j]),R=c.asMutable({deep:!0}),I=n.React.useMemo((()=>{const e=[];return f.forEach((t=>{e.push(t.id);t.getAllAncestorJimuLayerViews().forEach((t=>{e.push(t.id)}))})),e}),[f]);n.React.useEffect((()=>{!function(){ke(this,void 0,void 0,(function*(){const e=yield t.whenAllJimuLayerViewLoaded();let a=Object.values(e).filter((e=>!e.fromRuntime&&function(e){var t;if(!e||!e.type)return!1;const a=e.layer.type,i=a!==n.JSAPILayerTypes.BuildingComponentSublayer||e.view,l=w.includes(a),o=!!(null===(t=e.layer)||void 0===t?void 0:t.url);return i&&l&&o}(e)));const i=n.ServiceManager.getInstance(),l=a.map((e=>ke(this,void 0,void 0,(function*(){yield e.createLayerDataSource(),yield i.fetchArcGISServerInfo(e.layer.url)}))));try{yield Promise.all(l)}catch(e){console.log(e)}var o;t.isActive||(yield(o=500,new Promise((e=>{setTimeout((()=>{e()}),o)})))),a=a.filter((e=>{var t;const a=e.getLayerDataSource(),n=null===(t=null==a?void 0:a.getLayerDefinition)||void 0===t?void 0:t.call(a),{create:l,update:o,deletable:s}=T(n),r=i.getServerInfoByServiceUrl(e.layer.url);return!!(!r||r.owningSystemUrl||l||o||s)})),h(a),m(!0)}))}()}),[t]);const k=n.React.useCallback((()=>{g(!0)}),[]),M=n.React.useCallback((()=>{v((e=>!e))}),[]),D=n.React.useCallback((()=>{g(!1)}),[]),A=n.React.useCallback(((e,n)=>ke(void 0,void 0,void 0,(function*(){if(n){const e=f.map((e=>e.id)),n=[];for(const e of f){const t=yield e.getOrCreateLayerDataSource(),a=N(t,e.layer);n.push(a)}i(t.id,a.set("customizeLayers",!0).set("customJimuLayerViewIds",e).set("layersConfig",n))}else i(t.id,a.set("customizeLayers",!1).set("customJimuLayerViewIds",[]).set("layersConfig",[]))}))),[f,t.id,a,i]),E=n.React.useCallback((e=>!I.includes(e.id)),[I]),L=n.React.useCallback((e=>!f.includes(e)),[f]),P=n.React.useCallback((e=>ke(void 0,void 0,void 0,(function*(){var n;const l=e.map((e=>{var a,i;return null===(i=null===(a=t.jimuLayerViews)||void 0===a?void 0:a[e])||void 0===i?void 0:i.layerDataSourceId}));let o=d.filter((e=>l.includes(e.id)));const s=e.filter((e=>{var a,i;const n=null===(i=null===(a=t.jimuLayerViews)||void 0===a?void 0:a[e])||void 0===i?void 0:i.layerDataSourceId;return n&&!d.find((e=>e.id===n))})),r=[];for(const e of s){const a=null===(n=t.jimuLayerViews)||void 0===n?void 0:n[e],i=yield a.getOrCreateLayerDataSource();r.push(N(i,a.layer))}o=o.concat(r),i(t.id,a.set("customJimuLayerViewIds",e).set("layersConfig",o))}))),[t.id,t.jimuLayerViews,d,a,i]),F=n.React.useCallback((e=>{i(t.id,a.set("layersConfig",e))}),[t.id,a,i]);return(0,n.jsx)(n.React.Fragment,null,(0,n.jsx)(o.SettingRow,{flow:"no-wrap",css:Me},x?(0,n.jsx)(me,{className:"map-icon",size:16}):(0,n.jsx)(re,{className:"map-icon",size:16}),(0,n.jsx)("div",{className:"map-title px-2",title:C,"aria-label":C},C),!u&&(0,n.jsx)("div",{className:"map-loading"},(0,n.jsx)(l.Loading,{type:"DONUT",width:16,height:16})),u&&0===f.length&&(0,n.jsx)(l.Tooltip,{title:S("noAvailableLayers"),showArrow:!1,placement:"top"},(0,n.jsx)(l.Button,{className:"map-icon border-0",disableHoverEffect:!0,disableRipple:!0,type:"tertiary",icon:!0,size:"sm"},(0,n.jsx)(Ne,{size:16,color:"var(--sys-color-warning-main)"}))),u&&f.length>0&&(0,n.jsx)(n.React.Fragment,null,(0,n.jsx)(l.Tooltip,{title:S("selectLayers"),showArrow:!1,placement:"top"},(0,n.jsx)(l.Button,{ref:b,className:"map-icon mr-1 p-0 border-0",disabled:!u,type:"tertiary",icon:!0,size:"sm",onClick:k},(0,n.jsx)(he,{size:16}))),s&&d.length>0&&(0,n.jsx)(l.Button,{className:"map-icon p-0 border-0",type:"tertiary",icon:!0,size:"sm",onClick:M},y?(0,n.jsx)(Ce,{size:16}):(0,n.jsx)(Se,{size:16})))),y&&d.length>0&&(0,n.jsx)(Oe,{layersConfig:d,onChange:F}),p&&(0,n.jsx)(o.SidePopper,{isOpen:!0,toggle:D,position:"right",trigger:b.current,title:S("selectLayers")},(0,n.jsx)(o.SettingRow,{className:"w-100 pl-4 pr-4",tag:"label",label:S("customizeLayers")},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:s,"data-key":"customizeLayers",onChange:A})),s&&(0,n.jsx)(n.React.Fragment,null,(0,n.jsx)(o.SettingRow,{className:"w-100 pl-4 pr-4",label:C,"aria-label":C}),(0,n.jsx)("div",{className:"select-jimu-layer-view-selector-container p-4"},(0,n.jsx)(o.JimuLayerViewSelector,{jimuMapViewId:t.id,isMultiSelection:!0,selectedValues:R,hideLayers:E,disableLayers:L,onChange:P})))))};const Ae=e=>{const{widgetId:t,config:a,useMapWidgetIds:i,mapEmpty:s,jimuMapViews:r,onSettingChange:c}=e,{mapViewsConfig:d}=a,u=(null==i?void 0:i.length)>0,m=n.hooks.useTranslation(l.defaultMessages),p=n.React.useCallback(((e,i)=>{c({id:t,config:a.setIn(["mapViewsConfig",e],i)})}),[a,c,t]);return(0,n.jsx)(n.React.Fragment,null,(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(o.MapWidgetSelector,{useMapWidgetIds:i,onSelect:e=>{const i=a.set("mapViewsConfig",{}).set("defaultSnapLayers",[]);c({id:t,config:i,useMapWidgetIds:e})}})),u&&!s&&r.map((e=>(0,n.jsx)(De,{key:e.id,jimuMapView:e,mapViewConfig:null==d?void 0:d[e.id],onChange:p}))),u&&s&&(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Alert,{tabIndex:0,type:"warning",className:"warningMsg",open:!0,text:m("noWebMapWebSceneTip")})))},Ee=e=>{const{config:t,jimuMapViews:a,onPropertyChange:c}=e,{selfSnapping:d,featureSnapping:u,defaultSelfEnabled:m,defaultFeatureEnabled:p,gridSnapping:g,defaultGridEnabled:f,defaultSnapLayers:h,snapSettingMode:y}=t,v=n.hooks.useTranslation(r,l.defaultMessages,n.defaultMessages),b=s.SnappingUtils.getAllSnappingLayerItems(a),S=n.React.useMemo((()=>b.filter((e=>null==h?void 0:h.includes(e.value)))),[b,h]),x=n.React.useMemo((()=>({disabled:0===a.length})),[a.length]),j=(0,n.jsx)(n.React.Fragment,null,(0,n.jsx)("div",{className:"plain-tooltip",style:{maxWidth:260}},(0,n.jsx)("div",{className:"mt-1",style:{fontWeight:700}}," ",v("geometryGuides")," "),(0,n.jsx)("div",{className:"mb-3"}," ",v("editGeometryGuides")),(0,n.jsx)("div",{className:"mt-2",style:{fontWeight:700}}," ",v("featureToFeature")," "),(0,n.jsx)("div",{className:"mb-3"}," ",v("editFeatureToFeature")),(0,n.jsx)("div",{className:"mt-2",style:{fontWeight:700}}," ",v("grid")," "),(0,n.jsx)("div",{className:"mb-3"}," ",v("tipsForGrid")))),w=(0,n.jsx)("div",{className:"d-flex justify-content-between align-items-center"},(0,n.jsx)("span",{className:"text-wrap"},v("snappingSettings")),(0,n.jsx)(l.Tooltip,{showArrow:!0,role:"tooltip",title:j},(0,n.jsx)(l.Button,{icon:!0,disableHoverEffect:!0,disableRipple:!0,variant:"text",size:"sm",className:"flex-shrink-0"},(0,n.jsx)(U,null))));return(0,n.jsx)(o.SettingSection,{role:"group",title:w,"aria-label":v("snappingSettings")},(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Select,{size:"sm",className:"w-100",value:y,onChange:e=>{c("snapSettingMode",e.target.value)}},(0,n.jsx)("option",{value:i.Prescriptive},v("prescriptiveMode")),(0,n.jsx)("option",{value:i.Flexible},v("flexibleMode")))),y===i.Prescriptive?(0,n.jsx)(n.React.Fragment,null,(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Checkbox,{checked:m,className:"mr-1",onChange:e=>{c("defaultSelfEnabled",e.target.checked)}}),v("selfSnapping"))),(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Checkbox,{checked:p,className:"mr-1",onChange:e=>{c("defaultFeatureEnabled",e.target.checked)}}),v("featureSnapping")))):(0,n.jsx)(n.React.Fragment,null,(0,n.jsx)(o.SettingRow,{tag:"label",label:v("selfSnapping")},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:d,"data-key":"selfSnapping",onChange:e=>{c("selfSnapping",e.target.checked)}})),d&&(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Checkbox,{checked:m,className:"mr-1",onChange:e=>{c("defaultSelfEnabled",e.target.checked)}}),v("defaultEnabled"))),(0,n.jsx)(o.SettingRow,{tag:"label",label:v("featureSnapping")},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:u,"data-key":"featureSnapping",onChange:e=>{c("featureSnapping",e.target.checked)}})),u&&(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Checkbox,{checked:p,className:"mr-1",onChange:e=>{c("defaultFeatureEnabled",e.target.checked)}}),v("defaultEnabled"))),(0,n.jsx)(o.SettingRow,{tag:"label",label:v("grid")},(0,n.jsx)(l.Switch,{className:"can-x-switch",checked:g,"data-key":"gridSnapping",onChange:e=>{c("gridSnapping",e.target.checked)}})),g&&(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Checkbox,{checked:f,className:"mr-1",onChange:e=>{c("defaultGridEnabled",e.target.checked)}}),v("defaultEnabled")))),(0,n.jsx)(o.SettingRow,{flow:"wrap",label:v("chooseDefault"),className:"select-option"},(0,n.jsx)(l.AdvancedSelect,{size:"sm",title:v("chooseDefault"),fluid:!0,hideCheckAll:!1,hideBottomTools:!0,hideSearchInput:!0,staticValues:b,sortValuesByLabel:!1,isMultiple:!0,selectedValues:S,buttonProps:x,onChange:e=>{const t=(e||[]).map((e=>e.value));c("defaultSnapLayers",t)},"aria-label":v("chooseDefault")})))};var Le=c(31027),Pe=c.n(Le),Fe=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const Ve=e=>{const t=window.SVG,{className:a}=e,i=Fe(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:Pe()},i)):n.React.createElement("svg",Object.assign({className:l},i))},ze=e=>n.css`
    &.empty-placeholder {
      display: flex;
      flex-flow: column;
      justify-content: center;
      height: calc(100% - 260px);
      overflow: hidden;
      .empty-placeholder-inner {
        padding: 0px 20px;
        flex-direction: column;
        align-items: center;
        display: flex;

        .empty-placeholder-text {
          color: ${e.ref.palette.neutral[1e3]};
          font-size: 14px;
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon {
          color: ${e.ref.palette.neutral[800]};
        }
      }
    }
  `,Be=e=>{const{isGeoMode:t}=e,a=n.hooks.useTranslation(r,l.defaultMessages),i=(0,m.useTheme)(),o=a("newEdit"),s=a("editableSource"),c=t?a("selectMapHint"):a("editBlankStatus",{EditString:o,ModeString:s});return(0,n.jsx)("div",{className:"empty-placeholder w-100",css:ze(i)},(0,n.jsx)("div",{className:"empty-placeholder-inner"},(0,n.jsx)("div",{className:"empty-placeholder-icon"},(0,n.jsx)(Ve,{size:48})),(0,n.jsx)("div",{className:"empty-placeholder-text",id:"edit-blank-msg"},c)))};var Ge=function(e,t,a,i){return new(a||(a=Promise))((function(n,l){function o(e){try{r(i.next(e))}catch(e){l(e)}}function s(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}r((i=i.apply(e,t||[])).next())}))};const He=t=>{const{id:a,config:i,useDataSources:c,useMapWidgetIds:d,onSettingChange:m}=t,{editMode:p,layersConfig:g=(0,n.Immutable)([]),mapViewsConfig:f=(0,n.Immutable)({})}=i,[h,y]=n.React.useState(!1),[v,b]=n.React.useState(!1),[S,x]=n.React.useState([]),j=n.React.useRef(null),w=p===e.Attribute,C=p===e.Geometry,R=(null==d?void 0:d.length)>0,T=w&&g.length>0||C&&Object.keys(f).length>0,I=n.hooks.useTranslation(r,l.defaultMessages),N=n.React.useCallback(((e,t)=>{if(t===i[e])return;const n=i.set(e,t);m({id:a,config:n})}),[i,m,a]),O=n.React.useCallback((e=>{let t=i;e.forEach((e=>{e.value!==i[e.name]&&(t=t.set(e.name,e.value))})),m({id:a,config:t})}),[i,m,a]),k=n.React.useCallback((()=>{m({id:a,config:i.set("editMode",j.current).set("layersConfig",[]).set("mapViewsConfig",{}),useDataSources:[],useMapWidgetIds:[]}),j.current=null,y(!1)}),[i,m,a]),M=n.React.useCallback((e=>{p!==e&&(j.current=e,T?y(!0):k())}),[p,k,T]),D=n.React.useCallback((e=>{x([]);const t=Object.values(e);1!==Object.keys(t).length||Object.values(t)[0].dataSourceId?b(!1):b(!0);const a=Object.values(e).map((e=>Ge(void 0,void 0,void 0,(function*(){yield e.whenJimuMapViewLoaded(),yield e.whenAllJimuLayerViewLoaded()}))));Promise.allSettled(a).then((()=>{x(t)}))}),[b]);return(0,n.jsx)("div",{className:"h-100"},(0,n.jsx)("div",{className:"jimu-widget-setting widget-setting-edit h-100"},(0,n.jsx)(o.SettingSection,{role:"group",title:I("mode")},(0,n.jsx)("div",{role:"radiogroup",className:"mb-4"},(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Radio,{style:{cursor:"pointer"},name:"editModeType",className:"mr-2",checked:w,onChange:()=>{M(e.Attribute)}}),I("attrMode")),(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Radio,{style:{cursor:"pointer"},name:"editModeType",className:"mr-2",checked:C,onChange:()=>{M(e.Geometry)}}),I("interactWithMap"))),w&&(0,n.jsx)(ie,{widgetId:a,config:i,useDataSources:c,onSettingChange:m}),C&&(0,n.jsx)(Ae,{widgetId:a,config:i,useMapWidgetIds:d,mapEmpty:v,jimuMapViews:S,onSettingChange:m})),w&&T&&(0,n.jsx)(u,{config:i,onPropertyChange:N}),w&&!T&&(0,n.jsx)(Be,{isGeoMode:!1}),C&&R&&(0,n.jsx)(Ee,{config:i,jimuMapViews:S,onPropertyChange:N}),C&&R&&(0,n.jsx)(ne,{config:i,onPropertyChange:N,onMultiplePropertyChange:O}),C&&!R&&(0,n.jsx)(Be,{isGeoMode:!0}),C&&(0,n.jsx)(s.JimuMapViewComponent,{useMapWidgetId:null==d?void 0:d[0],onViewsCreate:D}),h&&(0,n.jsx)(l.ConfirmDialog,{level:"warning",title:I("changeModeConfirmTitle"),hasNotShowAgainOption:!1,content:I("changeModeConfirmTips"),onConfirm:k,onClose:()=>{y(!1)}})))};function Je(e){c.p=e}})(),d})())}}}));