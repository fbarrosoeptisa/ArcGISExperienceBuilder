System.register(["jimu-core","jimu-ui"],(function(e,t){var o={},i={};return{setters:[function(e){o.Immutable=e.Immutable,o.dataSourceUtils=e.dataSourceUtils},function(e){i.utils=e.utils}],execute:function(){e((()=>{var e={79244:e=>{"use strict";e.exports=o},14321:e=>{"use strict";e.exports=i}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="";var a={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(a),n.d(a,{default:()=>d});var e=n(79244);var t,o,i,u,r,s;!function(e){e.GeocodeService="GeocodeService",e.FeatureService="FeatureService"}(t||(t={})),function(e){e.ResultPanel="Result_Panel",e.OtherWidgets="Other_Widgets"}(o||(o={})),function(e){e.Style1="Style1",e.Style2="Style2",e.Style3="Style3"}(i||(i={})),function(e){e.Classic="Classic",e.Compact="Compact"}(u||(u={})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(r||(r={})),function(e){e.CustomSearchSources="CustomSearchSources",e.MapCentric="MapCentric"}(s||(s={}));var c=n(14321);class d{constructor(){this.id="search-app-config-operation"}afterWidgetCopied(i,n,a,u,r){let d=function(t,o,i,n){var a,u,r,c;const d=o.widgets[t],S=n.widgets[i],g=(null===(a=null==d?void 0:d.outputDataSources)||void 0===a?void 0:a.asMutable({deep:!0}))||[],p=(null===(u=null==S?void 0:S.outputDataSources)||void 0===u?void 0:u.asMutable({deep:!0}))||[];if(0===(null==g?void 0:g.length))return n;let m=n;const C=n.widgets[i].config;if(C.sourceType===s.MapCentric){const t=function(t,o,i,n,a){var u;const r=null===(u=null==t?void 0:t.dataSourceConfigWithMapCentric)||void 0===u?void 0:u.asMutable({deep:!0});return Object.keys(r).forEach((t=>{const u=r[t],s=null==u?void 0:u.dataSourceConfig,c=l((0,e.Immutable)(s),n,a);let d=t;d.startsWith(o)&&(d=d.replace(o,i)),delete r[t],u.dataSourceConfig=c,r[d]=u})),r}(C,null===(r=null==d?void 0:d.useMapWidgetIds)||void 0===r?void 0:r[0],null===(c=null==S?void 0:S.useMapWidgetIds)||void 0===c?void 0:c[0],g,p);m=m.setIn(["widgets",i,"config","dataSourceConfigWithMapCentric"],t)}else{const e=l(null==C?void 0:C.datasourceConfig,g,p);m=m.setIn(["widgets",i,"config","datasourceConfig"],e)}const I=null==n?void 0:n.messageConfigs;if(I){const e={};Object.keys(I).forEach((t=>{const o=I[t];if((null==o?void 0:o.widgetId)===i&&(null==o?void 0:o.actions)){const i=o.actions.map((e=>{var t,o,i,n,a,u;if(null==e?void 0:e.useDataSources){const t=e.useDataSources,o=v(g,p,t);e=e.set("useDataSources",o)}const r=null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.messageUseDataSource;if(r&&g.includes(null==r?void 0:r.dataSourceId)){const t=f(g,p,r);e=e.setIn(["config","messageUseDataSource"],t)}if((null===(o=null==e?void 0:e.config)||void 0===o?void 0:o.useDataSource)&&g.includes(null===(n=null===(i=null==e?void 0:e.config)||void 0===i?void 0:i.useDataSource)||void 0===n?void 0:n.dataSourceId)){const t=null===(a=null==e?void 0:e.config)||void 0===a?void 0:a.useDataSource,o=f(g,p,t);e=e.setIn(["config","useDataSource"],o)}if(null===(u=null==e?void 0:e.config)||void 0===u?void 0:u.useDataSources){const t=v(g,p,null==e?void 0:e.config.useDataSources);e=e.setIn(["config","useDataSources"],t)}return e}));e[t]=o.set("actions",i)}else e[t]=o})),m=m.set("messageConfigs",e)}return m}(i,n,a,u);return d=function(o,i,n,a,u){var r;if(!u)return a;const c=(0,e.Immutable)([]),d=null!==(r=i.widgets[o].useDataSources)&&void 0!==r?r:c,l=!!d.find((e=>u[e.mainDataSourceId]));let v=a;const f=v.widgets[n].config;if(!l||f.sourceType!==s.CustomSearchSources)return a;const S=f.datasourceConfig.map((o=>{var i,n;if(o.searchServiceType===t.FeatureService){const t=e.dataSourceUtils.mapUseDataSources(u,(0,e.Immutable)([null===(i=o.useDataSource)||void 0===i?void 0:i.asMutable({deep:!0})]));return t.isChanged?o.set("useDataSource",null===(n=t.useDataSources)||void 0===n?void 0:n[0]):o}return o}));return v=v.setIn(["widgets",n,"config","datasourceConfig"],S),v}(i,n,a,d,r),d=function(e,t,i,n,a){let u=n;const r=u.widgets[i].config;if(!a||r.searchResultView===o.ResultPanel||!(null==r?void 0:r.linkParam))return n;const{linkParam:s,isChanged:d}=c.utils.mapLinkParam(a,null==r?void 0:r.linkParam);d&&s&&(u=u.setIn(["widgets",i,"config","linkParam"],s));return u}(0,0,a,d,r),d}useDataSourceWillChange(e,t){var o;if(!t)return e;let i=e.widgets[this.widgetId],n=i.config;const a=null===(o=i.useDataSources.filter((e=>e.dataSourceId===t||e.rootDataSourceId===t)))||void 0===o?void 0:o.map((e=>e.dataSourceId)),u=i.useDataSources.filter((e=>e.dataSourceId!==t||e.rootDataSourceId!==t));if(a&&(null==a?void 0:a.length)>0){if(n.sourceType===s.MapCentric){const e=n.dataSourceConfigWithMapCentric||{},o={};Object.keys(e).forEach((i=>{var n;const u=null===(n=e[i])||void 0===n?void 0:n.asMutable({deep:!0});if(!1===(null==u?void 0:u.synchronizeSettings)&&(null==u?void 0:u.dataSourceConfig)){const e=null==u?void 0:u.dataSourceConfig.filter((e=>{var t;return!a.includes(null===(t=null==e?void 0:e.useDataSource)||void 0===t?void 0:t.dataSourceId)}));u.dataSourceConfig=e}i.split("-")[1]!==t&&(o[i]=u)})),n=n.set("dataSourceConfigWithMapCentric",o)}else{const e=n.datasourceConfig.filter((e=>{var t;return!a.includes(null===(t=null==e?void 0:e.useDataSource)||void 0===t?void 0:t.dataSourceId)}));n=n.set("datasourceConfig",e)}i=i.set("useDataSources",u).set("config",n),e=e.setIn(["widgets",this.widgetId],i)}return e}}function l(e,o,i){return e.map((e=>{if(e.searchServiceType===t.FeatureService)return null==e?void 0:e.asMutable({deep:!0});{const t=e.outputDataSourceId,n=S(o,i,t),a=e.set("outputDataSourceId",n);return null==a?void 0:a.asMutable({deep:!0})}}))}function v(e,t,o){return o.map((o=>f(e,t,o)))}function f(e,t,o){if(e.includes(null==o?void 0:o.dataSourceId)){const i=S(e,t,o.dataSourceId);return o.set("dataSourceId",i).set("mainDataSourceId",i)}return o}function S(e,t,o){const i=e.indexOf(o);return i>-1?t[i]:o}})(),a})())}}}));