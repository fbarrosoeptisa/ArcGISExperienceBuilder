System.register(["jimu-core","jimu-layouts/layout-runtime","jimu-ui","jimu-arcgis","jimu-theme"],(function(e,t){var o={},n={},l={},r={},i={};return{setters:[function(e){o.AppMode=e.AppMode,o.BaseVersionManager=e.BaseVersionManager,o.ClauseLogic=e.ClauseLogic,o.ClauseOperator=e.ClauseOperator,o.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,o.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,o.DataSourceComponent=e.DataSourceComponent,o.DataSourceFilterChangeMessage=e.DataSourceFilterChangeMessage,o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.Immutable=e.Immutable,o.JSAPILayerTypes=e.JSAPILayerTypes,o.JimuFieldType=e.JimuFieldType,o.MessageManager=e.MessageManager,o.React=e.React,o.ReactRedux=e.ReactRedux,o.RecordSetChangeType=e.RecordSetChangeType,o.UrlManager=e.UrlManager,o.UtilityManager=e.UtilityManager,o.WidgetState=e.WidgetState,o.classNames=e.classNames,o.css=e.css,o.dataSourceUtils=e.dataSourceUtils,o.defaultMessages=e.defaultMessages,o.esri=e.esri,o.focusElementInKeyboardMode=e.focusElementInKeyboardMode,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.i18n=e.i18n,o.jsx=e.jsx,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.lodash=e.lodash,o.moduleLoader=e.moduleLoader,o.polished=e.polished,o.urlUtils=e.urlUtils,o.utils=e.utils},function(e){n.PageVisibilityContext=e.PageVisibilityContext,n.ViewVisibilityContext=e.ViewVisibilityContext},function(e){l.Alert=e.Alert,l.Button=e.Button,l.Checkbox=e.Checkbox,l.Dropdown=e.Dropdown,l.DropdownButton=e.DropdownButton,l.DropdownItem=e.DropdownItem,l.DropdownMenu=e.DropdownMenu,l.Icon=e.Icon,l.Link=e.Link,l.Loading=e.Loading,l.Popper=e.Popper,l.TextInput=e.TextInput,l.defaultMessages=e.defaultMessages},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent,r.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.useTheme=e.useTheme}],execute:function(){e((()=>{var e={21210:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13 6.133c0 .598-.28 1.46-.825 2.51-.53 1.02-1.247 2.102-1.981 3.102A46 46 0 0 1 8 14.492a48 48 0 0 1-2.194-2.747c-.734-1-1.451-2.081-1.98-3.102C3.28 7.593 3 6.731 3 6.133 3 3.277 5.26 1 8 1s5 2.277 5 5.133m1 0c0 2.685-3.768 7.311-5.332 9.115C8.258 15.722 8 16 8 16s-.258-.279-.668-.751C5.768 13.444 2 8.817 2 6.133 2 2.746 4.686 0 8 0s6 2.746 6 6.133M10 5.5a2 2 0 1 1-4 0 2 2 0 0 1 4 0m1 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=r},79244:e=>{"use strict";e.exports=o},41496:e=>{"use strict";e.exports=n},1888:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=l}},t={};function s(o){var n=t[o];if(void 0!==n)return n.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,s),l.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var a={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(a),s.d(a,{__set_webpack_public_path__:()=>Ut,default:()=>At});var e=s(79244),t=s(41496);const o=[0,3],n={wkid:4326};var l,r,i,u,c,d;!function(e){e.GeocodeService="GeocodeService",e.FeatureService="FeatureService"}(l||(l={})),function(e){e.ResultPanel="Result_Panel",e.OtherWidgets="Other_Widgets"}(r||(r={})),function(e){e.Style1="Style1",e.Style2="Style2",e.Style3="Style3"}(i||(i={})),function(e){e.Classic="Classic",e.Compact="Compact"}(u||(u={})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(c||(c={})),function(e){e.CustomSearchSources="CustomSearchSources",e.MapCentric="MapCentric"}(d||(d={}));var v=s(14321);const g={_widgetLabel:"Search",showResult:"Show search results for {searchText}",hideResult:"Hide search results for {searchText}",allSearchSources:"All search sources",noResult:'No results found for "{searchText}"',couldNotRetrieve:"Could not retrieve current location.",showMoreResult:"Show more results",clearAllHistories:"Clear all histories",clearHistory:"Clear history",clearThisHistories:"Remove this history",clearRecentSearches:"Recent searches",searchIn:"Search in {value}",searchResults:"Search result"};var m=s(30655),p=s.n(m),h=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const f=t=>{const o=window.SVG,{className:n}=t,l=h(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:p()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var y=s(94064),S=s.n(y),b=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const I=t=>{const o=window.SVG,{className:n}=t,l=b(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:S()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var x=s(62686);const w="address";var j=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const C=e=>j(void 0,void 0,void 0,(function*(){const t=R(e),o={shouldConvertSR:!1,searchText:e};if(!t)return Promise.resolve(o);const n=yield M(e),l=yield function(e){return j(this,void 0,void 0,(function*(){return(0,x.loadArcGISJSAPIModules)(["esri/geometry/coordinateFormatter","esri/geometry/SpatialReference"]).then((t=>{const[o,n]=t;if(o.load(),o.isSupported()){if(o.isLoaded()){const t=o.fromUtm(e,new n({wkid:4326}),"latitude-band-indicators");return t&&(null==t?void 0:t.x)&&(null==t?void 0:t.y)?Promise.resolve(!0):Promise.resolve(!1)}return Promise.resolve(!1)}return Promise.resolve(!0)}))}))}(e);return n?function(e){return j(this,void 0,void 0,(function*(){let t=e;return(0,x.loadArcGISJSAPIModules)(["esri/geometry/SpatialReference","esri/rest/support/ProjectParameters","esri/geometry/support/webMercatorUtils","esri/rest/geometryService"]).then((o=>{const[n,l,r,i]=o,s=new n({wkid:4326});if(s&&e){if(s.equals(e.spatialReference))return Promise.resolve(t);if(s.isWebMercator&&e.spatialReference.equals(s))return t=r.geographicToWebMercator(e),t.isSinglePoint=e.isSinglePoint,Promise.resolve(t);if(s.equals(s)&&e.spatialReference.isWebMercator)return t=r.webMercatorToGeographic(e),t.isSinglePoint=e.isSinglePoint,Promise.resolve(t);{const o=T();if(o){const n=new l;return n.geometries=[e],n.outSpatialReference=s,n.f="json",i.project(o,n).then((o=>(t=o&&o.length>0&&o[0],t?(t.isSinglePoint=e.isSinglePoint,Promise.resolve(t)):Promise.resolve(t))),(e=>Promise.reject(new Error(e))))}return Promise.resolve(t)}}return Promise.resolve(null)}))}))}(n).then((t=>{const o=N(t);return Promise.resolve({shouldConvertSR:!!o,searchText:o||e,locationPoint:t})}),(e=>Promise.resolve(o))):l?function(e){return j(this,void 0,void 0,(function*(){const t=T();return(0,x.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/request"]).then((o=>{const[n,l,r]=o;let i=null;const s={query:{sr:4326,conversionType:"UTM",conversionMode:"utmDefault",strings:[e],f:"json"},responseType:"json"};if(!t)return Promise.resolve(i);r(`${t}/fromGeoCoordinateString`,s).then((e=>{const t=Number(e[0][0]),o=Number(e[0][1]);return isNaN(t)||isNaN(o)||(i=new n(t,o,new l({wkid:4326}))),Promise.resolve(i)}))}))}))}(e).then((t=>{const o=N(t);return Promise.resolve({shouldConvertSR:!!o,searchText:o||e,locationPoint:t})})):Promise.resolve(o)}));function R(e){return e&&P(e)}const M=t=>j(void 0,void 0,void 0,(function*(){return(0,x.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((o=>{const[n,l]=o;return e.moduleLoader.loadModule("jimu-core/wkid").then((e=>{const{isValidWkid:o}=e;let r=null;if(!t)return r;const i=t.split(":"),s=i[0],a=Number(i[1]);if(a&&o(a)&&s){const e=s.split(","),t=Number(e[0]),o=Number(e[1]);isNaN(t)||isNaN(o)||(r=new n(t,o,new l({wkid:a})))}return Promise.resolve(r)}))}))}));function N(e){let t=null;return!e||isNaN(e.x)||isNaN(e.y)||(t="Y:"+e.y+",X:"+e.x),t}function T(){var t,o;const n=(0,e.getAppStore)().getState();return(null===(o=((null===(t=null==n?void 0:n.portalSelf)||void 0===t?void 0:t.helperServices)||{}).geometry)||void 0===o?void 0:o.url)||null}const P=e=>null==e?void 0:e.includes(",");var L=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const D={alias:"ADDRESS",type:"string",name:w},O=(Object.assign(Object.assign({},D),{jimuName:w}),(e,t,o,n)=>ue(null==t?void 0:t.outputDataSourceId)&&(null==t?void 0:t.isSupportSuggest)?k(t,e,o,n):Promise.resolve({})),k=(e,t,o,n)=>{var l;const r={geocodeURL:null==e?void 0:e.geocodeURL,address:t,maxSuggestion:null==e?void 0:e.maxSuggestions,utilityId:null===(l=null==e?void 0:e.useUtility)||void 0===l?void 0:l.utilityId,countryCode:null==e?void 0:e.countryCode,extent:o,enableLocalSearch:null==e?void 0:e.enableLocalSearch,minScale:null==e?void 0:e.minScale,jimuMapView:n};return U(r).then((o=>{if(!Array.isArray(o))return Promise.resolve({suggestionItem:[],layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon,err:o});let n=[];o.forEach(((o,l)=>{const r=o.text;if(r&&!function(e,t){return e.filter((e=>t===(null==e?void 0:e.suggestion))).length>0}(n,r)){const l={suggestionHtml:se(r,t),suggestion:r,configId:null==e?void 0:e.configId,magicKey:null==o?void 0:o.magicKey};n.push(l)}})),n=oe(n,"suggestion");const l={suggestionItem:n.splice(0,e.maxSuggestions),layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon};return Promise.resolve(l)})).catch((e=>Promise.reject(new Error(e))))},E=t=>{const{address:o,maxResultNumber:n,geocodeItem:l,searchResultView:r,extent:i,jimuMapView:s,id:a}=t;if(!ue(null==l?void 0:l.outputDataSourceId))return;return ae(te(l.outputDataSourceId),e.DataSourceStatus.NotReady),F({address:o,maxResultNumber:n,searchResultView:r,geocodeItem:l,extent:i,jimuMapView:s,id:a})},F=t=>{const{address:o,maxResultNumber:n,geocodeItem:l,extent:r,jimuMapView:i,id:s}=t,{outputDataSourceId:a,singleLineFieldName:u,defaultAddressFieldName:c,enableLocalSearch:d}=l,v=te(a),g={geocodeItem:l,address:o,maxResultNumber:n,singleLineFieldName:u,addressFields:(null==l?void 0:l.addressFields)||[],countryCode:null==l?void 0:l.countryCode,extent:r,enableLocalSearch:d,jimuMapView:i};return A(g).then((t=>L(void 0,void 0,void 0,(function*(){if(!Array.isArray(t))return Promise.resolve(!1);const n=null==t?void 0:t.filter((e=>null==e?void 0:e.address)),{extent:r,graphics:i}=function(e,t){let o;const n=(null==e?void 0:e.map(((e,n)=>{var l,r;const i=e.attributes;i.address=e.address,t&&(i[t]=e.address),i.objectid=n;const s=o?null==o?void 0:o.clone():o;o=s?null==s?void 0:s.union(null===(l=e.extent)||void 0===l?void 0:l.clone()):null===(r=e.extent)||void 0===r?void 0:r.clone();return{attributes:i,geometry:e.location}})))||[];return{graphics:n,extent:o}}(n,c),u=v,d=(null==l?void 0:l.label)||u.getLabel(),g=function(e,t){var o;if(!e||0===(null==e?void 0:e.length))return;const n={content:[{type:"fields",fieldInfos:e.map((e=>({fieldName:e.name,isEditable:!1,label:e.name,visible:!0})))},{type:"attachments",displayType:"auto"}],title:`${t}: {${null===(o=e[0])||void 0===o?void 0:o.name}}`};return n}(null==l?void 0:l.displayFields,d),m={id:`${a}_layer`,geometryType:"point",fullExtent:r};g&&(m.popupTemplate=g),yield u.setSourceFeatures(i,m);const p=o?e.DataSourceStatus.Unloaded:e.DataSourceStatus.NotReady;ae(v,p);const h={where:"2=2",sqlExpression:null,pageSize:null==n?void 0:n.length,outFields:["*"],page:1,returnGeometry:!0};return u.load(h,{widgetId:s}).then((t=>{const o=u.getRecords();return o.forEach(((e,t)=>{o[t].__extent=n[t].extent})),Promise.resolve(e.DataSourceStatus.Unloaded)}))})))).catch((e=>Promise.reject(new Error(e))))};const A=t=>L(void 0,void 0,void 0,(function*(){const{geocodeItem:o,address:l,maxResultNumber:r,singleLineFieldName:i,addressFields:s,countryCode:a,extent:u,jimuMapView:c}=t,{geocodeURL:d,magicKey:v,useUtility:g,enableLocalSearch:m,minScale:p}=o,h=(null==o?void 0:o.spatialReference)||n,f=R(l);let y;return f&&(y=yield C(l)),(0,x.loadArcGISJSAPIModules)(["esri/rest/locator","esri/geometry/SpatialReference"]).then((t=>{var o;const[n,S]=t,b=new S(h),I=i||"SingleLine";let x=(0,e.Immutable)({maxSuggestions:r});const w=null===(o=null==s?void 0:s.map((e=>null==e?void 0:e.jimuName)))||void 0===o?void 0:o.join(",");w&&(x=x.set("outFields",w));const j=f&&y.searchText?y.searchText:l;x=x.setIn([I],j),v&&(x=x.set("magicKey",v));const C={address:null==x?void 0:x.asMutable({deep:!0}),outSpatialReference:b};if(f&&y.locationPoint)C.location=y.locationPoint;else if(m){const e=$(m,p,c);e&&(C.location=e)}return a&&(C.countryCode=a),u&&(C.searchExtent=u.toJSON()),n.addressToLocations(d,C,{query:{}}).then((e=>(e=(e=e.sort(((e,t)=>t.score-e.score))).filter((e=>!!(null==e?void 0:e.location))),V(null==g?void 0:g.utilityId),e)),(e=>{console.error(e.message);const t=G(null==g?void 0:g.utilityId,e);return J(null==g?void 0:g.utilityId,e),t?e:[]}))}))})),U=e=>{const{geocodeURL:t,address:o,maxSuggestion:n,utilityId:l,countryCode:r,extent:i,enableLocalSearch:s,jimuMapView:a,minScale:u}=e;return(0,x.loadArcGISJSAPIModules)(["esri/rest/locator"]).then((e=>{const[c]=e,d={text:o,maxSuggestions:n};r&&(d.countryCode=r),i&&(d.searchExtent=i.toJSON());const v=$(s,u,a);return v&&(d.location=v),c.suggestLocations(t,d).then((e=>(V(l),e||[])),(e=>{console.error(e.message);const t=G(l,e);return J(l,e),t?e:[]}))}))};function $(e,t,o){var n,l;if(!e||!o||!t)return;let r;const i=null===(n=o.view)||void 0===n?void 0:n.scale,s=null===(l=o.view)||void 0===l?void 0:l.center;return i<t&&s&&(r=s),r}function V(t){t&&e.UtilityManager.getInstance().reportUtilityState(t,!0)}function J(t,o){if(!t)return;const n=G(t,o),l=e.UtilityManager.getInstance().utilityHasSignInError(t);n?e.UtilityManager.getInstance().reportUtilityState(t,!1,l):e.UtilityManager.getInstance().reportUtilityState(t,!1)}function G(t,o){var n,l,r,i;const s=e.UtilityManager.getInstance().utilityHasSignInError(t);let a=404===(null===(n=null==o?void 0:o.details)||void 0===n?void 0:n.httpStatus);return 400===(null===(l=null==o?void 0:o.details)||void 0===l?void 0:l.httpStatus)&&(null===(i=null===(r=null==o?void 0:o.details)||void 0===r?void 0:r.message)||void 0===i?void 0:i.includes("Item does not exist"))&&(a=!0),s||a}const B=(e,t,o,n=!1)=>{const l=null==e?void 0:e.outputDataSourceId,r=te(null==e?void 0:e.outputDataSourceId),i=null==r?void 0:r.getRecordsByPage(1,t);return Promise.resolve({records:i,configId:e.configId,dsId:l,isGeocodeRecords:!0,displayFields:null==e?void 0:e.displayFields})},_=(e,...t)=>L(void 0,[e,...t],void 0,(function*(e,t=n){const o=e&&e.coords;return o?(0,x.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{const[n,l]=e,r=new l(t);return new n({longitude:o.longitude,latitude:o.latitude,z:o.altitude||null,spatialReference:r})})):Promise.resolve(null)}));var K=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};function W(t,o,n,l,r){return K(this,void 0,void 0,(function*(){var i,s;if(!ue(null===(i=null==n?void 0:n.useDataSource)||void 0===i?void 0:i.dataSourceId))return Promise.resolve({});const a=(null==n?void 0:n.searchFields)||[],u=null===(s=null==l?void 0:l.filter((e=>(null==e?void 0:e.configId)===n.configId)))||void 0===s?void 0:s[0];return function(t,o,n,l,r,i){return K(this,void 0,void 0,(function*(){var s;const{label:a,icon:u,configId:c}=n,d=null===(s=null==o?void 0:o.useDataSource)||void 0===s?void 0:s.dataSourceId,v=te(d),g={searchText:t,searchFields:l.map((e=>e.name)),dataSource:v,maxSuggestions:r,extent:i};return e.dataSourceUtils.querySuggestions(g).then((e=>{const t={suggestionItem:null==e?void 0:e.map((e=>Object.assign(Object.assign({},e),{configId:c,isFromSuggestion:!0}))),layer:a,icon:u};return Promise.resolve(t)})).catch((e=>Promise.resolve({suggestionItem:[],layer:null,icon:null})))}))}(t,n,u,a,null==o?void 0:o.maxSuggestions,r)}))}function z(t,o,n,l){if(o){const r=[];return o.forEach((o=>{let i=t;const s=null==n?void 0:n.getFieldCodedValueList(null==o?void 0:o.name);if(s&&(null==s||s.forEach((e=>{i===(null==e?void 0:e.label)&&(i=null==e?void 0:e.value)}))),o.type===e.JimuFieldType.Number){const t=e.dataSourceUtils.convertStringToNumber(i);t&&(i=t)}const a=(null==t?void 0:t.length)>0&&!isNaN(Number(i))&&isFinite(Number(i));if(o.type===e.JimuFieldType.Number&&!a)return!1;const u=function(t,o){let n;t===e.JimuFieldType.Number?n=e.ClauseOperator.NumberOperatorIs:t===e.JimuFieldType.String&&(n=o?e.ClauseOperator.StringOperatorIs:e.ClauseOperator.StringOperatorContains);return n}(o.type,l),c=o.type===e.JimuFieldType.Number?Number(i):i,d=e.dataSourceUtils.createSQLClause(null==o?void 0:o.name,u,[{value:c,label:c+""}],l);r.push(d)})),e.dataSourceUtils.createSQLExpression(e.ClauseLogic.Or,r,n)}}function q(e,t,o){const n=(null==e?void 0:e.map((e=>e.jimuName)))||[],l=(null==t?void 0:t.map((e=>e.jimuName)))||[],r=te(o),i=(null==r?void 0:r.getAllUsedFields())||[];return"*"===i?"*":Array.from(new Set(n.concat(l).concat(i)))}const H=(t,o,n)=>{var l;const r=null===(l=null==t?void 0:t.useDataSource)||void 0===l?void 0:l.dataSourceId,i=ce(t.configId,n);if(!ue(r,i))return Promise.resolve({});const s=te(r,i),a=e.DataSourceManager.getInstance().getLocalDataSourceId(r,i),u=(null==s?void 0:s.getRecordsByPage)&&(null==s?void 0:s.getRecordsByPage(1,o));return Promise.resolve({records:u,configId:t.configId,dsId:r,localDsId:a,isGeocodeRecords:!1})};var Q=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const X=(e,t,o)=>{var n;let l;return e===d.MapCentric&&t&&o&&(l=null===(n=o.view)||void 0===n?void 0:n.extent),l};function Y(t){var o,n;const{serviceList:r,searchText:i,id:s}=t,a={};for(const e in r){const t=r[e],{searchServiceType:i,useDataSource:s}=t;if(i===l.FeatureService&&(null==s?void 0:s.dataSourceId)){const e=null==s?void 0:s.dataSourceId;let l=(null===(o=null==a?void 0:a[e])||void 0===o?void 0:o.sqlExpression)||null,r=(null===(n=a[e])||void 0===n?void 0:n.outFields)||[];const i=q(t.searchFields,t.displayFields,e)||[];a[e]?((null==t?void 0:t.SQL)&&l.push(null==t?void 0:t.SQL),r=Array.from(new Set(r.concat(i)))):(l=(null==t?void 0:t.SQL)?[null==t?void 0:t.SQL]:null,r=i,a[e]={}),a[e].sqlExpression=l,a[e].outFields=r}}!function(t,o,n){var l,r;for(const i in null==t?void 0:t.asMutable({deep:!0})){const s=null===(l=null==t?void 0:t[i])||void 0===l?void 0:l.sqlExpression,a=null===(r=null==t?void 0:t[i])||void 0===r?void 0:r.outFields,u=te(i);let c,d;n?s?(d=e.dataSourceUtils.getMergedSQLExpressions(null==s?void 0:s.asMutable({deep:!0}),u,e.ClauseLogic.Or),c=d.sql):(c="1=0",d=null):(c="1=1",d=null);const v=(0,e.Immutable)({outFields:a,where:c,sqlExpression:d,returnGeometry:!0});u&&u.updateQueryParams(v,o)}}((0,e.Immutable)(a),s,i)}const Z=(e,t,o,n)=>{var l;const r=null===(l=null==e?void 0:e.useDataSource)||void 0===l?void 0:l.dataSourceId,i=ce(o,t),s=te(r),a=te(r,i);a&&(null==a?void 0:a.updateQueryParams)&&(a&&a.updateQueryParams({},i),n&&s&&s.updateQueryParams({},t))},ee=(e,t,o,n=!1)=>{const r=[];for(const i in e){const s=e[i];let a;a=s.searchServiceType===l.FeatureService?H(s,t,o):B(s,t,0,n),r.push(a)}return Promise.all(r)},te=(t,o)=>{if(!t)return null;if(o){const n=e.DataSourceManager.getInstance(),l=n.getLocalDataSourceId(t,o);return n.getDataSource(l)}return e.DataSourceManager.getInstance().getDataSource(t)},oe=(e,t)=>{const o=e[0]?[e[0]]:[];for(let n=1;n<e.length;n++){const l=e[n];let r=!1;for(let e=0;e<o.length;e++)if(l[t]===o[e][t]){r=!0;break}r||o.push(l)}return o},ne=t=>{const o=e.urlUtils.getAppIdPageIdFromUrl().appId,n=le(o,t);let l=e.utils.readLocalStorage(n);l&&(l=unescape(l));return l?null==l?void 0:l.split("/@/"):[]},le=(e,t)=>`exb-${e}-${t}_recent_searches`,re=(e,t)=>{var o;return null===(o=null==e?void 0:e.filter((e=>e.configId===t)))||void 0===o?void 0:o[0]},ie=e=>{let t=0;for(const o in e)t++;return t};function se(t,o){if(!o)return t;const n=e.dataSourceUtils.getRegOfSearchText(o);return t.match(n)?t.replace(n,"<strong >$1</strong>"):t}function ae(e,t){null==e||e.setStatus(t),null==e||e.setCountStatus(t)}function ue(e,t){return!!e&&!!te(e,t)}const ce=(e,t)=>`${t}_${e}_useDataSource`,de=(t,o)=>{var n;let r=!0;for(const i in t){const s=t[i];let a;if(s.searchServiceType===l.FeatureService){const e=null===(n=null==s?void 0:s.useDataSource)||void 0===n?void 0:n.dataSourceId,t=ce(s.configId,o);a=te(e,t)}else{const e=null==s?void 0:s.outputDataSourceId;a=te(e)}const u=null==a?void 0:a.getStatus();u!==e.DataSourceStatus.Loading&&u!==e.DataSourceStatus.Unloaded||(r=!1)}return r},ve=t=>{var o,n;if(!t)return;const l=(0,e.getAppStore)().getState();return JSON.parse((null===(n=null===(o=null==l?void 0:l.urlHashObject)||void 0===o?void 0:o[t])||void 0===n?void 0:n.search_status)||"{}")},ge=(t,o)=>{if(!t)return;const n=o?JSON.stringify(o):null;e.UrlManager.getInstance().setWidgetUrlParams(t,{search_status:n})};function me(t,o){return Q(this,void 0,void 0,(function*(){const o=yield e.moduleLoader.loadModule("jimu-ui/advanced/setting-components"),{getOutputDsJson:n}=o;return function(t){return Q(this,void 0,void 0,(function*(){if(!t||0===t.length)return Promise.resolve([]);const o=t.map((t=>({id:t.dataSourceJson.id,dataSourceJson:(0,e.Immutable)(t.dataSourceJson)})));return yield Promise.allSettled(o.filter((e=>e.layer)).map((e=>Q(this,void 0,void 0,(function*(){var t;const o=null===(t=e.layer.sourceJSON)||void 0===t?void 0:t.capabilities;o&&(yield e.layer.load(),e.layer.sourceJSON.capabilities=o)}))))),Promise.allSettled(o.map((t=>e.DataSourceManager.getInstance().createDataSource(t).then((e=>e.isDataSourceSet()&&!e.areChildDataSourcesCreated()?e.childDataSourcesReady().then((()=>e)):e))))).then((e=>e.filter((e=>"fulfilled"===e.status)).map((e=>e.value)))).then((e=>e.length<t.length?Promise.reject(new Error("Failed to create some data source.")):e))}))}(null==(t=null==t?void 0:t.filter((e=>{const t=null==e?void 0:e.outputDataSourceId;return!te(t)})))?void 0:t.map(((e,t)=>({dataSourceJson:n(e,!0),order:t}))))}))}const{useRef:pe,useState:he,useEffect:fe}=e.React,ye=e.css`
& {
  box-sizing: border-box;
  width: ${e.polished.rem(32)};
}
.setting-dropdown-button {
  height: ${e.polished.rem(32)};
  border-radius: 0;
  .dropdown-button-content {
    text-align: center;
  }
  svg {
    margin: 0 !important;
  }
}
&.ds-setting-Style1 {
  .setting-dropdown-button {
    border-radius: ${e.polished.rem(4)} 0 0 ${e.polished.rem(4)};
  }
}
&.ds-setting-Style2 {
  & {
    margin-right: ${e.polished.rem(4)};
  }
  .setting-dropdown-button {
    border-radius: 50%;
  }
}
&.ds-setting-Style3 {
  .setting-dropdown-button {
    background: none;
    border: none;
  }
}
`,Se=t=>{const o=e.hooks.useTranslation(g,v.defaultMessages),[n,r]=he(!0),[i,s]=he(!1),[a,u]=e.React.useState(!1),{className:c,datasourceConfig:m,dsStatus:p,config:h,id:y,useDataSources:S,synchronizeSettings:b,showLoading:x,onDatasourceConfigChange:w}=t,j=pe(null),C=pe(null),R=pe(null),M=t=>{const o=[];null==t||t.forEach((e=>{e.enable&&o.push(e.configId)})),((t,o,n)=>{if(!o||!t)return;const l=ve(t)||{};l[o]=n,e.UrlManager.getInstance().setWidgetUrlParams(t,{search_status:JSON.stringify(l)})})(y,"serviceEnabledList",o)};fe((()=>{const e=null==m?void 0:m.filter((e=>!(null==e?void 0:e.enable))),t=0===(null==e?void 0:e.length),o=(null==e?void 0:e.length)>0&&(null==e?void 0:e.length)<(null==m?void 0:m.length);s(o),r(t)}),[m]);return(0,e.jsx)("div",{className:`${c||""} ds-setting-${h.arrangementStyle}`,onKeyDown:t=>{"Escape"===t.key&&(u(!1),(0,e.focusElementInKeyboardMode)(C.current))},css:ye,role:"group","aria-label":o("searchIn",{value:""})},x&&(0,e.jsx)(v.Button,{icon:!0,className:"setting-dropdown-button"},(0,e.jsx)(v.Loading,{width:14,height:14,type:"DONUT"})),!x&&(0,e.jsx)(v.Dropdown,{className:"w-100 h-100",menuItemCheckMode:"multiCheck",toggle:t=>{a||setTimeout((()=>{(0,e.focusElementInKeyboardMode)(R.current,!0)}),200),u(!a)},isOpen:a},(0,e.jsx)(v.DropdownButton,{ref:C,className:"setting-dropdown-button",arrow:!1,icon:!0,title:o("searchIn",{value:""})},!a&&(0,e.jsx)(f,{size:16,className:"mr-1 d-inline-block",autoFlip:!0}),a&&(0,e.jsx)(I,{size:16,className:"mr-1 d-inline-block",autoFlip:!0})),(0,e.jsx)(v.DropdownMenu,{trapFocus:!1,autoFocus:!1,style:{maxHeight:"auto"}},(0,e.jsx)("div",{ref:j},(0,e.jsx)(v.DropdownItem,{toggle:!1,onClick:()=>{const e=!n,t=null==m?void 0:m.map((t=>{var o;return null===(o=t.setIn(["enable"],e))||void 0===o?void 0:o.asMutable({deep:!0})}));M(t),w(t)},title:o("all"),ref:R},(0,e.jsx)(v.Checkbox,{checked:n&&!i,indeterminate:i,className:"mr-2"}),o("all")),(0,e.jsx)(v.DropdownItem,{divider:!0}),null==m?void 0:m.map(((t,n)=>{var r;const i=p[t.configId]===e.DataSourceStatus.LoadError||p[t.configId]===e.DataSourceStatus.CreateError,s=t.searchServiceType===l.GeocodeService,a=((t,o=!1)=>{var n;let l;if(!1!==b&&(null==h?void 0:h.sourceType)===d.MapCentric)return!0;if(o){const o=(0,e.getAppStore)().getState().appConfig,r=null===(n=null==o?void 0:o.widgets)||void 0===n?void 0:n[y],i=(null==r?void 0:r.outputDataSources)||[];l=(null==i?void 0:i.filter((e=>t===e)).length)>0}else l=(null==S?void 0:S.filter((e=>t===e.dataSourceId)).length)>0;return l&&t})(s?t.outputDataSourceId:t.useDataSource.dataSourceId,s),u=1===(null===(r=null==m?void 0:m.filter((e=>null==e?void 0:e.enable)))||void 0===r?void 0:r.length)&&(null==t?void 0:t.enable)&&i;return(0,e.jsx)(v.DropdownItem,{toggle:!1,key:`${null==t?void 0:t.label}${n}`,title:null==t?void 0:t.label,disabled:u,onClick:()=>{((e,t)=>{const o=null==m?void 0:m.setIn([t,"enable"],e);M(o),w(o)})(!(null==t?void 0:t.enable),n)}},(0,e.jsx)("div",{className:"d-flex w-100 h-100 align-items-center"},(0,e.jsx)("div",{className:"flex-grow-1 d-flex align-items-center"},(0,e.jsx)(v.Checkbox,{checked:null==t?void 0:t.enable,disabled:u,className:"mr-2"}),(0,e.jsx)("div",{className:"flex-grow-1"},null==t?void 0:t.label)),(i||!a)&&(0,e.jsx)(v.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:o("dataSourceCreateError")})))}))))))};var be=s(1888);const Ie=(t,o)=>{var n,l,r,i,s,a,u,c,d,v,g,m,p,h,f;return e.css`
    & {
      width: ${e.polished.rem(null===(n=null==o?void 0:o.current)||void 0===n?void 0:n.clientWidth)};
      padding-top: 0;
      padding-bottom: 0;
      /* visibility: unset !important; */
    }
    &.hide-popper {
      border: none;
      outline: none;
      box-shadow: none;
      width: 0;
    }
    button {
      width: 100%;
      border: none;
      text-align: left;
      min-height: ${e.polished.rem(32)};
      border-radius: 0;
    }
    .result-list-content {
      position: relative;
      overflow: auto;
    }
    &.suggestion-list-con, .result-list-content {
      max-height: ${e.polished.rem(300)};
    }
    &.suggestion-list-con {
      overflow: auto;
    }
    &.result-list-con button {
      text-overflow: ellipsis;
      white-space: pre-wrap;
      &:focus-visible {
        background: var(--ref-palette-neutral-200);
      }
    }
    &.result-list-con :disabled, &.result-list-con button:disabled:hover {
      color: ${null===(r=null===(l=null==t?void 0:t.sys.color)||void 0===l?void 0:l.secondary)||void 0===r?void 0:r.dark};
      background-color: ${null===(s=null===(i=null==t?void 0:t.ref.palette)||void 0===i?void 0:i.neutral)||void 0===s?void 0:s[300]};
    }
    &.result-list-con button:hover {
      color: ${null===(a=null==t?void 0:t.ref.palette)||void 0===a?void 0:a.black};
      background-color: ${null===(c=null===(u=null==t?void 0:t.ref.palette)||void 0===u?void 0:u.neutral)||void 0===c?void 0:c[200]};
    }
    &.result-list-con button:focus-visible {
      color: ${null===(d=null==t?void 0:t.ref.palette)||void 0===d?void 0:d.black};
      background-color: ${null===(g=null===(v=null==t?void 0:t.ref.palette)||void 0===v?void 0:v.neutral)||void 0===g?void 0:g[200]};
    }
    &.result-list-con .jimu-dropdown-item-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con button.active {
      background: ${null===(m=null==t?void 0:t.sys.color)||void 0===m?void 0:m.primary.main};
      color: ${null===(p=null==t?void 0:t.ref.palette)||void 0===p?void 0:p.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:hover {
      background-color: ${null===(h=null==t?void 0:t.ref.palette)||void 0===h?void 0:h.white};
    }
    &.result-list-con .show-result-button:focus-visible {
      background-color: ${null===(f=null==t?void 0:t.ref.palette)||void 0===f?void 0:f.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
    .jimu-dropdown-item {
      min-height: ${e.polished.rem(32)};
    }
    .clear-recent-search-con {
      color: var(--sys-color-primary-main) !important;
      height: ${e.polished.rem(40)};
      margin-top: ${e.polished.rem(-4)};
    }
    .jimu-dropdown-item-divider {
      min-height: 0;
    }
    .item-p-l {
      padding-left: ${e.polished.rem(42)} !important;
    }
    .source-label-con {
      color: var(--ref-palette-black) !important;
      font-weight: bold !important;
    }
    .show-result-button-style2 {
      & {
        padding: 0;
        height: ${e.polished.rem(11)};
        min-height: ${e.polished.rem(11)};
        justify-content: center;
        align-items: center;
      }
      svg {
        margin-right: 0;
      }
    }
    &.result-list-con-compact-close {
      & {
        width: ${e.polished.rem(32)};
        border-top: 0;
        justify-content: center;
      }
      .show-result-button {
        & {
          border-radius: 0 0 0.25rem 0.25rem;
          padding: 0;
          height: ${e.polished.rem(8)};
          min-height: ${e.polished.rem(8)};
          justify-content: center;
          align-items: center;
        }
        svg {
          margin-right: 0;
          height: ${e.polished.rem(8)};
        }
      }
    }
    &.result-list-con-compact-open {
      .show-result-button-style2-con {
        position: -webkit-sticky;
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--ref-palette-white);
      }
    }
  `},{useEffect:xe,useRef:we}=e.React,je=t=>{const n=we(null),l=we(null),{children:r,isOpen:i,reference:s,searchInputRef:a,autoFocus:u,className:c,isFocusWithSearchInput:d,id:g,offset:m,toggle:p}=t,h=(0,be.useTheme)(),f=e.ReactRedux.useSelector((e=>{var t;const o=null==e?void 0:e.widgetsRuntimeInfo;return null===(t=null==o?void 0:o[g])||void 0===t?void 0:t.state}));xe((()=>{var e;return(null==a?void 0:a.current)&&d&&(null===(e=a.current)||void 0===e||e.addEventListener("keydown",y,!0)),()=>{var e;d&&(null===(e=a.current)||void 0===e||e.removeEventListener("keydown",y,!0))}}),[]);const y=e.hooks.useEventCallback((t=>{if(!i)return!1;const o=I()||[],n=(null==o?void 0:o.length)-1;"ArrowUp"===t.key?l.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(o[n])})):"ArrowDown"===t.key&&(l.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(o[0])})))})),S=e.hooks.useEventCallback((t=>{if(!i)return;const o="button"===t.target.getAttribute("role")||"option"===t.target.getAttribute("role");if(["Tab","ArrowUp","ArrowDown","Escape"].includes(t.key)&&((t.which>=48&&t.which<=90||"Tab"===t.key)&&t.preventDefault(),i&&o))if(clearTimeout(l.current),"Escape"===t.key)b(t);else if(["ArrowUp","ArrowDown","Tab"].includes(t.key)||["n","p"].includes(t.key)&&t.ctrlKey){const o=I();let r=o.indexOf(t.target),i=!1;"ArrowUp"===t.key||"p"===t.key&&t.ctrlKey||"Tab"===t.key&&(t.shiftKey||1===o.length)?(r=0!==r?r-1:o.length-1,i=!0):("ArrowDown"===t.key||"Tab"===t.key||"n"===t.key&&t.ctrlKey)&&(i=!1,r=r===o.length-1?0:r+1);const s=0===r&&!i,u=r===o.length-1&&i;d&&(s||u)?l.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(a.current,!0)})):((0,e.focusElementInKeyboardMode)(Array.prototype.slice.call(n.current.querySelectorAll(".popper-box"))[0],!0),l.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(o[r],!0)})))}else if("End"===t.key){const t=I();l.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(t[t.length-1],!0)}))}else if("Home"===t.key){const t=I();l.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(t[0],!0)}))}else if(t.which>=48&&t.which<=90){const o=I(),n=String.fromCharCode(t.which).toLowerCase();for(let t=0;t<o.length;t+=1){if((o[t].textContent&&o[t].textContent[0].toLowerCase())===n){l.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(o[t],!0)}));break}}}})),b=t=>{t.preventDefault(),x(t),e.lodash.defer((()=>{(0,e.focusElementInKeyboardMode)(null==a?void 0:a.current,!0)}))},I=()=>n?Array.prototype.slice.call(n.current.querySelectorAll('[role="button"], [role="option"]')).filter((e=>!e.disabled)):[],x=t=>{p(t),"Escape"===(null==t?void 0:t.key)&&e.lodash.defer((()=>{(0,e.focusElementInKeyboardMode)(null==a?void 0:a.current)}))};return(0,e.jsx)("div",null,(0,e.jsx)(v.Popper,{autoFocus:u,placement:"bottom-start",open:i,toggle:x,css:Ie(h,s),reference:s,autoUpdate:!0,className:(0,e.classNames)("result-list-popper",c,{"hide-popper":f===e.WidgetState.Closed}),offsetOptions:m||o,ref:n,forceLatestFocusElements:!0},(0,e.jsx)("div",{onKeyDown:S},r)))},{useState:Ce,useRef:Re,useEffect:Me}=e.React,Ne=e.css`
  & .utility-err-remind-con {
    bottom: 0;
  }
`,Te=t=>{const o=e.hooks.useTranslation(v.defaultMessages,e.defaultMessages),n=Re(null),{serviceList:r,open:i,toggleUtilityErrorRemind:s}=t,[a,u]=Ce(null),c=e.ReactRedux.useSelector((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.utilityStates}));Me((()=>{i&&(clearTimeout(n.current),n.current=setTimeout((()=>{s(!1)}),5e3))}),[i]),Me((()=>{d(c)}),[c]);const d=e=>{var t;if(!r)return;let o=null,n=[],i=[];if(null===(t=Object.keys(r))||void 0===t||t.forEach((t=>{var o;const s=r[t];if(s.searchServiceType===l.GeocodeService){const t=null===(o=null==s?void 0:s.useUtility)||void 0===o?void 0:o.utilityId;if(t){const o=null==e?void 0:e[t];(null==o?void 0:o.isSignInError)?i.push(t):!1===(null==o?void 0:o.success)&&n.push(t)}}})),n=g(n),i=g(i),0===(null==n?void 0:n.length)&&(null==i?void 0:i.length)>0)o=m(i);else if(0===(null==i?void 0:i.length)&&(null==n?void 0:n.length)>0)o=p(n);else if((null==i?void 0:i.length)>0&&(null==n?void 0:n.length)>0){o=`${m(i)} ${p(n)}`}u(o)},g=(t=[])=>(t=Array.from(new Set(t))).map((t=>{const o=e.UtilityManager.getInstance().getUtilityJson(t);return null==o?void 0:o.label})),m=e=>{let t=null;return 1===ie(r)?(null==e?void 0:e.length)>0&&(t=o("signInErrorDefault")):(null==e?void 0:e.length)>0&&(t=o("signInErrorsDefault",{names:e.join(", ")})),t},p=e=>{let t=null;return 1===ie(r)?1===(null==e?void 0:e.length)&&(t=o("utilityInaccessible")):(null==e?void 0:e.length)>0&&(t=o("utilityNotAvailableWidthName",{name:e.join(", ")})),t};return(0,e.jsx)("div",{className:"position-relative w-100",css:Ne},(0,e.jsx)("div",{className:"w-100 utility-err-remind-con"},(0,e.jsx)(v.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,closable:!0,onClose:()=>{s(!1)},text:a,title:a})))},{useRef:Pe}=e.React,Le=new(0,e.esri.Sanitizer),De=t=>{const{className:o,reference:n,searchSuggestion:l,isOpen:r,canUseOutputDsLength:i,id:s,searchInputRef:a,openUtilityErrRemindInSuggestion:u,serviceList:c,searchText:d,toggleSuggestionUtilityError:g,toggle:m,onRecordItemClick:p,setSuggestionFirstItem:h}=t,f=(0,be.useTheme)(),y=Pe(!1),S=()=>{if((null==l?void 0:l.length)<2)return!1;let e=0,t=0;return null==l||l.forEach((o=>{var n;const l=null==o?void 0:o.icon;l&&(e+=1),(null===(n=o.suggestionItem)||void 0===n?void 0:n.length)>0&&l&&(t+=1)})),t>0&&e>0},b=(t,o=!1)=>{const n=null==t?void 0:t.suggestionItem,l=null==t?void 0:t.icon;return null==n?void 0:n.map(((n,r)=>{var s;const a=Le.sanitize(n.suggestionHtml),u={configId:null==n?void 0:n.configId,isFromSuggestion:null==n?void 0:n.isFromSuggestion,magicKey:null==n?void 0:n.magicKey};return(0,e.jsx)(v.Button,{className:(0,e.classNames)("d-flex align-items-center py-2 jimu-outline-inside",{"item-p-l":o}),key:`${null==t?void 0:t.layer}${r}`,title:n.suggestion,"aria-label":n.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:o,isFromSuggestion:n,magicKey:l}=t||{};o&&(n||l)?p(e,t):p(e)})(n.suggestion,u)},ref:e=>{I(r,e)}},l&&1===i&&(0,e.jsx)(v.Icon,{className:"mr-2",color:null===(s=null==f?void 0:f.sys.color)||void 0===s?void 0:s.primary.main,size:16,icon:null==l?void 0:l.svg}),(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:a}}))}))},I=(e,t)=>{0===e&&!y.current&&t&&(h(t),y.current=!0)};return(0,e.jsx)("div",null,(0,e.jsx)(je,{isOpen:r&&!(()=>{let e=[];return l.forEach((t=>{const o=(null==t?void 0:t.suggestionItem)||[];e=e.concat(o)})),d&&0===e.length})()||u,autoFocus:!1,reference:n,searchInputRef:a,isFocusWithSearchInput:!0,toggle:m,id:s,className:(0,e.classNames)("result-list-con suggestion-list-con",o)},!u&&(y.current=null,null==l?void 0:l.map(((t,o)=>{var n,r,i;const s=(null==l?void 0:l.length)>1&&(null===(n=null==t?void 0:t.suggestionItem)||void 0===n?void 0:n.length)>0;return(0,e.jsx)("div",{key:`${null==t?void 0:t.layer}-${o}`,role:"listbox","aria-label":null==t?void 0:t.layer},s&&(0,e.jsx)(v.Button,{"aria-label":null==t?void 0:t.layer,role:"button",className:"source-label-con jimu-outline-inside",disabled:!0,title:null==t?void 0:t.layer},(null==t?void 0:t.icon)&&(0,e.jsx)(v.Icon,{className:"mr-2",color:null===(r=null==f?void 0:f.sys.color)||void 0===r?void 0:r.primary.main,size:16,icon:null===(i=null==t?void 0:t.icon)||void 0===i?void 0:i.svg}),(0,e.jsx)("div",{className:"flex-grow-1"},null==t?void 0:t.layer)),b(t,S()))}))),u&&(0,e.jsx)(Te,{open:u,serviceList:c,toggleUtilityErrorRemind:g})))};var Oe=s(9044),ke=s.n(Oe),Ee=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const Fe=t=>{const o=window.SVG,{className:n}=t,l=Ee(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:ke()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var Ae=s(21210),Ue=s.n(Ae),$e=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const Ve=t=>{const o=window.SVG,{className:n}=t,l=$e(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:Ue()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var Je=s(28996),Ge=s.n(Je),Be=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const _e=t=>{const o=window.SVG,{className:n}=t,l=Be(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:Ge()},l)):e.React.createElement("svg",Object.assign({className:r},l))},Ke=t=>{const o=e.hooks.useTranslation(g,v.defaultMessages),{serviceList:r,locationLoading:i,isGetLocationError:s,onLocationChange:a,handleLocationLoadingChange:u}=t,[c,d]=e.React.useState(null);e.React.useEffect((()=>{m()}),[r]);const m=()=>{var e;for(const t in r){const o=null===(e=r[t])||void 0===e?void 0:e.asMutable({deep:!0});if(o.searchServiceType===l.GeocodeService){d(o);break}}},p=e=>{u(!1);const t=`${e.coords.longitude},${e.coords.latitude}`;if(c){((e,t,o=n)=>t?(0,x.loadArcGISJSAPIModules)(["esri/rest/locator","esri/geometry/SpatialReference"]).then((n=>{const[l,r]=n;return _(t,o).then((t=>{const n=new r(o);return l.locationToAddress(e,{location:t,outSpatialReference:n},{query:{}}).then((e=>Promise.resolve(e.address)),(e=>(console.error(e.message),Promise.reject(new Error(e.message)))))}))})):Promise.resolve(null))(null==c?void 0:c.geocodeURL,e,null==c?void 0:c.spatialReference).then((e=>{a(e)}),(e=>{a(t)}))}else a(t)},h=e=>{u(!1),a(null,null,!0)};return(0,e.jsx)("div",null,!s&&(0,e.jsx)(v.Button,{className:"text-left d-block",role:"button",onClick:()=>{if(i)return!1;u(!0),((e,t)=>{if(navigator.geolocation){const o={enableHighAccuracy:!0,timeout:3e3,maximumAge:1e4};navigator.geolocation.getCurrentPosition(e,t,o)}else t&&t()})(p,h)},"aria-label":o("useCurrentLocation"),title:o("useCurrentLocation")},(0,e.jsx)(Ve,{className:"mr-2"}),o("useCurrentLocation")),s&&(0,e.jsx)(v.Button,{className:"text-left d-block",role:"button","aria-label":o("couldNotRetrieve"),title:o("couldNotRetrieve")},(0,e.jsx)(_e,{className:"mr-2"}),o("couldNotRetrieve")))},{useRef:We}=e.React,ze=new(0,e.esri.Sanitizer),qe=t=>{var o,n,l,r;const i=e.hooks.useTranslation(g,v.defaultMessages),{className:s,reference:a,recentSearchesData:u,isOpen:c,isGetLocationError:d,serviceList:m,config:p,id:h,searchInputRef:f,locationLoading:y,toggle:S,onRecordItemClick:b,clearSearches:I,setSuggestionFirstItem:x,handleLocationLoadingChange:w}=t,j=We(!1),C=t=>{const o=null==t?void 0:t.suggestionItem;return null==o?void 0:o.map(((o,n)=>{const l=ze.sanitize(o.suggestionHtml),r={configId:null==o?void 0:o.configId,isFromSuggestion:null==o?void 0:o.isFromSuggestion,magicKey:null==o?void 0:o.magicKey};return(0,e.jsx)(v.Button,{className:(0,e.classNames)("d-flex align-items-center py-2 jimu-outline-inside"),key:`${null==t?void 0:t.layer}${n}`,title:o.suggestion,"aria-label":o.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:o,isFromSuggestion:n,magicKey:l}=t||{};o&&(n||l)?b(e,t):b(e)})(o.suggestion,r)},ref:e=>{R(n,e)}},(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:l}}))}))},R=(e,t)=>{0!==e||j.current||(x(t),j.current=!0)};return(0,e.jsx)("div",null,(0,e.jsx)(je,{isOpen:c,autoFocus:!1,reference:a,searchInputRef:f,isFocusWithSearchInput:!0,toggle:S,id:h,className:(0,e.classNames)("result-list-con suggestion-list-con",s)},p.isUseCurrentLoation&&(0,e.jsx)(Ke,{serviceList:m,isShowCurrentLocation:!0,onLocationChange:b,locationLoading:y,isGetLocationError:d,handleLocationLoadingChange:w}),(j.current=null,null==u?void 0:u.map(((t,o)=>(0,e.jsx)("div",{key:`${null==t?void 0:t.layer}-${o}`,role:"group","aria-label":null==t?void 0:t.layer},C(t))))),p.isShowRecentSearches&&(null===(n=null===(o=u[0])||void 0===o?void 0:o.suggestionItem)||void 0===n?void 0:n.length)>0&&(0,e.jsx)(v.DropdownItem,{divider:!0}),p.isShowRecentSearches&&(null===(r=null===(l=u[0])||void 0===l?void 0:l.suggestionItem)||void 0===r?void 0:r.length)>0&&(0,e.jsx)(v.Button,{role:"button",className:"clear-recent-search-con jimu-outline-inside","aria-label":i("clearRecentSearches"),title:i("clearRecentSearches"),onClick:I},(0,e.jsx)(Fe,{className:"mr-2"}),i("clearRecentSearches"))))},{useEffect:He,useRef:Qe}=e.React,Xe=t=>{const n=e.hooks.useTranslation(g),{reference:l,searchText:i,id:s,config:a,serviceList:c,isOpenResultListDefault:d,searchInputRef:m,searchResult:p,selectionList:h,openUtilityErrRemindInResult:y,isOpenResultPopper:S,isToOtherWidget:b,datasourceConfig:x,toggleResultUtilityError:w,setResultFirstItem:j,handleDsIdOfSelectedResultItemChange:C}=t,{resultMaxNumber:R}=a,M=Qe([]),N=Qe(!1),T=Qe(null),P=Qe(null),L=Qe(!1),D=Qe((0,e.Immutable)({})),O=Qe({}),k=Qe(null),E=Qe(!1),F=Qe(!1),A=e.ReactRedux.useSelector((e=>e.appContext.isRTL));let U={};const $=(0,be.useTheme)(),[V,J]=e.React.useState((0,e.Immutable)({})),[G,B]=e.React.useState(d),[_,K]=e.React.useState(u.Classic),[W,z]=e.React.useState(!1),[q,H]=e.React.useState(o);He((()=>{N.current=!1;de(null==c?void 0:c.asMutable({deep:!0}),s)&&(b||S)&&Q()}),[p,b,S]),He((()=>{(S||b)&&(B(!0),F.current=!0,E.current=!1,J((0,e.Immutable)({})),O.current={})}),[S,b]),He((()=>{ge(V)}),[V]),He((()=>{(null==a?void 0:a.searchResultStyle)&&(null==a?void 0:a.searchResultStyle)!==_&&K(null==a?void 0:a.searchResultStyle)}),[a]),He((()=>{M.current=[]}),[i]),He((()=>{pe(_,G,W)}),[_,G,W]);const Q=()=>{const t=ee(null==c?void 0:c.asMutable({deep:!0}),R,s);Promise.all([t]).then((t=>{N.current=!0;let o=(0,e.Immutable)({}),n=[];null==t||t.forEach((e=>{n=n.concat(e)}));const l={};n.forEach((e=>{const{records:t,configId:n,dsId:r,isGeocodeRecords:i,localDsId:s}=e;l[n]=t;const a=se(t,n,r,i,s);o=o.setIn([n],a)})),D.current=o,(null==a?void 0:a.searchResultView)!==r.OtherWidgets&&J(o),O.current=l,ce()}))},X=()=>{var e;if(ie(c)<2)return!1;let t=0,o=0;for(const n in V){const l=re(x,n),r=null==l?void 0:l.icon;r&&(t+=1),(null===(e=V[n])||void 0===e?void 0:e.length)>0&&r&&(o+=1)}return o>0&&t>0},Y=e.hooks.useEventCallback(((t,o,n=!1)=>null==t?void 0:t.map(((t,l)=>{var r,i,s,a;const{configId:u,value:d,recordId:g,outputDsId:m}=t,p=ue(u,g),h=null===(i=null===(r=null==o?void 0:o.asMutable({deep:!0}))||void 0===r?void 0:r[u])||void 0===i?void 0:i.includes(g),f=re(x,u),y=null==f?void 0:f.icon,S=h?null===(s=null==$?void 0:$.ref.palette)||void 0===s?void 0:s.white:null===(a=null==$?void 0:$.sys.color)||void 0===a?void 0:a.primary.main,b=ie(c);return(0,e.jsx)(v.Button,{className:(0,e.classNames)("d-flex align-items-center jimu-outline-inside",{"item-p-l":n}),key:p,role:"option","aria-selected":h,active:h,title:d.join(", "),"aria-label":d.join(", "),ref:e=>{Z(l,e)},onClick:()=>{oe({isActive:h,key:p,recordId:g,dsId:m,configId:u})}},y&&1===b&&(0,e.jsx)(v.Icon,{className:"mr-2",color:S,size:16,icon:null==y?void 0:y.svg}),(0,e.jsx)("div",{className:"flex-grow-1"},d.join(", ")))})))),Z=(e,t)=>{0===e&&!L.current&&F.current&&t&&(j(t),L.current=!0)},oe=e.hooks.useEventCallback((t=>{var o,n,l,r,i,a,u;const{isActive:c,recordId:d,dsId:v,configId:g}=t,m=null===(l=null===(n=null===(o=D.current)||void 0===o?void 0:o[g])||void 0===n?void 0:n[0])||void 0===l?void 0:l.localDsId,p=(null===(a=null===(i=null===(r=D.current)||void 0===r?void 0:r[g])||void 0===i?void 0:i[0])||void 0===a?void 0:a.isGeocodeRecords)?v:m,h=te(p),f=c?[]:le(g,d),y=new e.DataRecordsSelectionChangeMessage(s,f,[p]),S=null===(u=f[0])||void 0===u?void 0:u.__extent;S&&(y.extent=S),e.MessageManager.getInstance().publishMessage(y),C(d?v:null),d&&(!c&&ne(g),clearTimeout(k.current),k.current=setTimeout((()=>{c?null==h||h.selectRecordsByIds([]):null==h||h.selectRecordsByIds([d])}),100))})),ne=e=>{var t,o,n,l,r,i;const s=D.current;for(const a in s)if(e!==a){const e=null===(o=null===(t=s[a])||void 0===t?void 0:t[0])||void 0===o?void 0:o.outputDsId,u=null===(l=null===(n=null==s?void 0:s[a])||void 0===n?void 0:n[0])||void 0===l?void 0:l.localDsId,c=null===(i=null===(r=null==s?void 0:s[a])||void 0===r?void 0:r[0])||void 0===i?void 0:i.isGeocodeRecords,d=te(c?e:u);d&&d.selectRecordsByIds([])}},le=(e,t)=>{var o;const n=(null===(o=O.current)||void 0===o?void 0:o[e])||[];return(null==n?void 0:n.filter((e=>(null==e?void 0:e.getId())===t)))||[]},se=(t,o,n,l,r)=>{var i;const s=(null===(i=null==c?void 0:c[o])||void 0===i?void 0:i.displayFields)||[],a=[],u=e.i18n.getIntl();return null==t||t.forEach((e=>{const t=[];s.forEach((o=>{const n=e.getFormattedFieldValue(o.jimuName,u);(n||0===n)&&t.push(n)}));const i={value:t,configId:o,outputDsId:n,recordId:null==e?void 0:e.getId(),isGeocodeRecords:l,localDsId:r};a.push(i),ae(i)})),a},ae=e=>{!(null==U?void 0:U.recordId)&&e.recordId&&(U=e)},ue=(e,t)=>`${e}_${t}`,ce=()=>{const e=de(null==c?void 0:c.asMutable({deep:!0}),s);if(!(null==a?void 0:a.isAutoSelectFirstResult)||!(null==U?void 0:U.recordId)||E.current||!e)return;const{configId:t,recordId:o,outputDsId:n}=U,l=ue(t,o);oe({isActive:!1,key:l,recordId:o,dsId:n,configId:t}),E.current=!0},ve=()=>{pe(_,!G,W),G&&j(P.current),B(!G),F.current=!G},ge=e=>{var t;let o=0;for(const n in e){o+=(null===(t=null==e?void 0:e[n])||void 0===t?void 0:t.length)||0}const n=ie(c);z(0===n||0===o&&N.current)},me=e.hooks.useEventCallback((e=>{G&&(B(!1),F.current=!1,j(P.current))})),pe=(e,t,n)=>{var r;let i=o;if(e===u.Compact)if(t||n)i=o;else{const e=(null===(r=null==l?void 0:l.current)||void 0===r?void 0:r.clientWidth)/2-15||0;i=A?[-e,0]:[e,0]}else i=o;H(i)};return(0,e.jsx)("div",{role:"group","aria-label":n("searchResults")},(0,e.jsx)(je,{isOpen:S,isFocusWithSearchInput:!0,autoFocus:!1,reference:l,searchInputRef:m,toggle:me,id:s,offset:q,className:(0,e.classNames)("result-list-con",_!==u.Compact||W?"":G?"result-list-con-compact-open":"result-list-con-compact-close")},(0,e.jsx)("div",{className:"result-list-content",role:"listbox"},!y&&(0,e.jsx)("div",{ref:T},W&&(0,e.jsx)(v.Button,{role:"button",className:"text-center",disabled:!0,"aria-label":n("noResult",{searchText:i}),title:n("noResult",{searchText:i})},n("noResult",{searchText:i})),!W&&(0,e.jsx)("div",null,_===u.Classic&&(0,e.jsx)("div",null,(0,e.jsx)(v.Button,{role:"button",ref:P,className:"d-flex align-items-center show-result-button jimu-outline-inside",onClick:ve,"aria-label":n("searchResults"),title:n("searchResults")},(0,e.jsx)("div",{className:"flex-grow-1 font-weight-bold"},n("searchResults")),!G&&i?(0,e.jsx)(f,null):(0,e.jsx)(I,null)),G&&(0,e.jsx)(v.DropdownItem,{divider:!0})),G&&(0,e.jsx)("div",null,(()=>{var t,o;const n=[];L.current=null;for(const l in V){const r=null===(t=null==V?void 0:V.asMutable({deep:!0}))||void 0===t?void 0:t[l],i=re(x,l),s=null==i?void 0:i.label,a=null==i?void 0:i.icon,u=ie(c),d=(0,e.jsx)("div",{key:`${l}_${s}_con`,role:"group",title:"label","aria-label":s},r.length>0&&(0,e.jsx)("div",null,u>1&&(0,e.jsx)(v.Button,{role:"button","aria-label":s,className:"source-label-con jimu-outline-inside",disabled:!0,key:`${l}_${s}`,title:s},a&&(0,e.jsx)(v.Icon,{className:"mr-2",color:null===(o=null==$?void 0:$.sys.color)||void 0===o?void 0:o.primary.main,size:16,icon:null==a?void 0:a.svg}),(0,e.jsx)("div",{className:"flex-grow-1"},s)),Y(r,h,X())));n.push(d)}return n})()),_===u.Compact&&(0,e.jsx)("div",{className:"show-result-button-style2-con"},G&&(0,e.jsx)(v.DropdownItem,{divider:!0}),(0,e.jsx)(v.Button,{role:"button",className:"d-flex align-items-center show-result-button show-result-button-style2 jimu-outline-inside",onClick:ve,title:n("searchResults"),"aria-label":n("searchResults")},!G&&i?(0,e.jsx)(f,{size:10}):(0,e.jsx)(I,{size:10}))))),y&&(0,e.jsx)(Te,{open:y,serviceList:c,toggleUtilityErrorRemind:w}))))};var Ye=s(50170),Ze=s.n(Ye),et=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const tt=t=>{const o=window.SVG,{className:n}=t,l=et(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:Ze()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var ot=s(62838),nt=s.n(ot),lt=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const rt=t=>{const o=window.SVG,{className:n}=t,l=lt(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:nt()},l)):e.React.createElement("svg",Object.assign({className:r},l))},{useSelector:it}=e.ReactRedux,{useState:st,useEffect:at,useRef:ut,useMemo:ct}=e.React,dt=t=>{const o=e.hooks.useTranslation(g,v.defaultMessages),n=it((e=>null==e?void 0:e.queryObject)),s=it((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode})),a=ut((e=>{})),u=ut(null),c=ut(null),m=ut([]),p=ut(null),h=ut(null),f=ut(null),y=ut(!1),S=ut(!1),b=ut(!1),I=ut(null),x=ut(null),w=ut(null),j=ut(!1),C=ut(!1),R=ut(null),M=ut(null),N=ut(null),T=ut(!1),P=ut(null),L=ut(!1),D=ut(null),k=ut(null),F=ut(!1),A=ut(!1),U=ut(!1),{config:$,className:V,reference:J,id:G,isShowSearchInput:B,isInCurrentView:_,isWidgetInCurrentPage:K,serviceList:q,searchResult:H,selectionList:Q,datasourceConfig:oe,loadingServiceList:re,showSearchSetting:se,jimuMapView:me,handleServiceListChange:pe,clearSearchResult:he}=t,{isShowRecentSearches:fe,recentSearchesMaxNumber:ye,linkParam:Se,searchResultView:be,resultMaxNumber:Ie}=$,[xe,we]=st(null),[je,Ce]=st(!1),[Re,Me]=st(!1),[Ne,Te]=st(!1),[Pe,Le]=st([]),[Oe,ke]=st({}),[Ee,Fe]=st(!1),[Ae,Ue]=st(!1),[$e,Ve]=st(!1),[Je,Ge]=st(null),[Be,_e]=st(!1),[Ke,We]=st(!1),[ze,He]=st([]),[Qe,Ye]=st(!1),[Ze,et]=st(null),[ot,nt]=st(!1),[lt,dt]=st(!1),vt=e.css`
    .input-wrapper {
      height: 100% !important;
    }
    .loading-con {
      left: 0;
      top: 0;
      right: 0;
      height: 2px;
    }
    .hide-loading {
      opacity: 0;
      visibility: hidden;
    }
    .search-button {
      width: ${e.polished.rem(32)};
      border-radius: 0;
    }
    .search-input-con input{
      width: 100%;
    }
    .search-link-con {
      width: 0;
      height: 0;
      overflow: hidden;
    }
    &.arrangement-Style1 {
      .search-button {
        border-radius: 0 ${e.polished.rem(4)} ${e.polished.rem(4)} 0;
      }
      .input-wrapper {
        border-radius: ${e.polished.rem(4)} 0 0 ${e.polished.rem(4)};
      }
      .no-border-left .input-wrapper{
        border-radius: 0;
        border-left: none;
      }
    }
    &.arrangement-Style2 {
      & {
        padding-right: 1px;
      }
      .input-prefix-icon {
        color: var(--ref-palette-neutral-600);
      }
      .input-wrapper {
        border-radius: ${e.polished.rem(32)} !important;
      }
    }
    &.arrangement-Style3 {
      .input-wrapper {
        background: none;
        border: none;
      }
      .search-button {
        background: none;
      }
    }
  `;at((()=>{L.current&&_&&K?(Ve(!1),e.lodash.defer((()=>{Nt(!0)}))):Ve(!0),_&&K||Tt()}),[_,K]),at((()=>{!Be&&T.current&&mt(!0,!1),T.current=Be}),[Ee,Be]),at((()=>{Ee&&s===e.AppMode.Design&&Tt()}),[s]),at((()=>{a.current=e.lodash.debounce(bt,400),Qt(q,null==$?void 0:$.hint)}),[$]),at((()=>{y.current&&(ht(q),pt(q,S.current),jt(q));const e=Rt(q);m.current=e,S.current=null==$?void 0:$.enableFiltering,b.current=!0}),[q,$.enableFiltering]),at((()=>{f.current=q,q&&(y.current=!0);const e=(null==$?void 0:$.sourceType)!==d.MapCentric||!re;Qt(q,null==$?void 0:$.hint),It(q),!C.current&&q&&e&&(gt(q),C.current=!0)}),[q,re]);const gt=e.hooks.useEventCallback((e=>{var t;const o=ve(G),{searchText:n,status:r}=o;r&&(r.isFromSuggestion=!0),n&&(e&&0!==(null===(t=Object.keys(e))||void 0===t?void 0:t.length)||(Wt(n,r),kt(n)),clearTimeout(P.current),P.current=setTimeout((()=>{((e,t)=>{var o;let n=!0;for(const r in e){const i=e[r];let s;if(i.searchServiceType===l.FeatureService)ue(null===(o=null==i?void 0:i.useDataSource)||void 0===o?void 0:o.dataSourceId,ce(i.configId,t))||(n=!1);else{const e=null==i?void 0:i.outputDataSourceId;s=te(e),s||(n=!1)}}return n})(null==e?void 0:e.asMutable({deep:!0}),G)&&Xt()>0?(Wt(n,r),kt(n)):gt(e)}),300))})),mt=(e=!1,t=!0)=>{t&&Ye(!1),e||(A.current=!1),We(e)},pt=(e,t)=>{if(!b.current)return!1;t!==(null==$?void 0:$.enableFiltering)&&(clearTimeout(c.current),c.current=setTimeout((()=>{var o;xt(!1),he();for(const n in e){(null===(o=e[n])||void 0===o?void 0:o.searchServiceType)===l.FeatureService&&Z(e[n],G,n,t)}})))},ht=e=>{if(!b.current||!R.current)return!1;const t=f.current||{},o=ft(e),n=ft(f.current),r=(null==n?void 0:n.filter((e=>!(null==o?void 0:o.includes(e)))))||[];Object.keys(e||{}).length!==Object.keys(t||{}).length&&(clearTimeout(c.current),c.current=setTimeout((()=>{xt(!1),he(),null==r||r.forEach((e=>{var o,n;(null===(o=t[e])||void 0===o?void 0:o.searchServiceType)===l.FeatureService?Z(t[e],G,e,null==$?void 0:$.enableFiltering):Mt(null===(n=t[e])||void 0===n?void 0:n.outputDataSourceId)}))})))},ft=e=>e?Object.keys(e).map((e=>e)):[],yt=(e=!1)=>{nt(e)},St=(e=!1)=>{dt(e)},bt=e.hooks.useEventCallback((e=>{var t;if(0===(null==$?void 0:$.maxSuggestions))return void Ce(!1);!je&&Ce(!0);const o=(e=>{const{searchText:t,serviceList:o,config:n,datasourceConfig:r,jimuMapView:i}=e,s=[];for(const e in o){const a=o[e];let u;a.maxSuggestions=n.maxSuggestions;const c=X(n.sourceType,null==a?void 0:a.searchInCurrentMapExtent,i);u=a.searchServiceType===l.FeatureService?W(t,n,a,r,c):O(t,a,c,i),s.push(u)}return Promise.all(s)})({searchText:e,serviceList:null===(t=null==I?void 0:I.current)||void 0===t?void 0:t.asMutable({deep:!0}),config:$,datasourceConfig:oe,jimuMapView:me});Promise.all([o]).then((e=>{var t;const o=null==e?void 0:e[0];(null===(t=null==o?void 0:o.filter((e=>null==e?void 0:e.err)))||void 0===t?void 0:t.length)>0&&yt(!0),Ce(!1),o&&Le(o),j.current||R.current&&Me(!0),j.current=!1})).catch((e=>{Ce(!1)}))})),It=e.hooks.useEventCallback((e=>{if(!b.current)return!1;let t=!1;for(const o in e){const n=e[o];((null==n?void 0:n.searchServiceType)===l.FeatureService||(null==n?void 0:n.isSupportSuggest))&&(t=!0)}Te(t)})),xt=(t=!0)=>{Wt(""),Ce(!1),Nt(!1),kt("",!0),clearTimeout(N.current),t&&(0,e.focusElementInKeyboardMode)(M.current)},wt=e.hooks.useEventCallback((()=>{var e,t;for(const o in q)if((null===(e=q[o])||void 0===e?void 0:e.searchServiceType)===l.GeocodeService){const e=null===(t=q[o])||void 0===t?void 0:t.outputDataSourceId;Mt(e)}})),jt=t=>{var o;let n=!1;const l=Rt(t);if(((null==l?void 0:l.length)!==m.current.length||(null===(o=null==l?void 0:l.filter((e=>!m.current.includes(e))))||void 0===o?void 0:o.length)>0)&&(n=!0),n){const t=new e.DataRecordSetChangeMessage(G,e.RecordSetChangeType.Remove,m.current);e.MessageManager.getInstance().publishMessage(t)}},Ct=e.hooks.useEventCallback((()=>{const t=Rt(q),o=new e.DataRecordSetChangeMessage(G,e.RecordSetChangeType.Remove,t);e.MessageManager.getInstance().publishMessage(o)})),Rt=e=>{var t,o;const n=[];for(const r in e)if((null===(t=e[r])||void 0===t?void 0:t.searchServiceType)===l.GeocodeService){const t=null===(o=e[r])||void 0===o?void 0:o.outputDataSourceId;n.push(t)}return n},Mt=t=>{const o=te(t);null==o||o.selectRecordsByIds([]),ae(o,e.DataSourceStatus.NotReady)},Nt=e=>{L.current=e,e||Ve(!0),Fe(e),Ue(e)},Tt=()=>{Fe(!1)},Pt=()=>{let e=!0;if(!h.current)return e;const t=h.current;for(const o in t){const n=t[o];if(e=!((null==n?void 0:n.magicKey)||(null==n?void 0:n.isFromSuggestion)),!e)break}return e},Lt=(t,o,n)=>{if(n)return Ot(),!1;Dt(t,o),Wt(t,o),kt(t),(0,e.focusElementInKeyboardMode)(M.current)},Dt=(e,t)=>{const o=ve(G)||{};if(e){if(o.searchText=e,t){const e={configId:null==t?void 0:t.configId};(null==t?void 0:t.magicKey)&&(e.magicKey=null==t?void 0:t.magicKey),o.status=e}ge(G,o)}else if(null==o?void 0:o.serviceEnabledList){const e={serviceEnabledList:null==o?void 0:o.serviceEnabledList};ge(G,e)}else ge(G,null)},Ot=()=>{(0,e.focusElementInKeyboardMode)(M.current),Ye(!0),mt(!0,!1)},kt=e.hooks.useEventCallback(((e,t=!1)=>{if(Ee&&!t)return;e=null==e?void 0:e.trim(),Gt(e),Me(!1),mt(!1),Et(),pe(I.current),j.current=!0;const o={serviceList:h.current,searchText:e,searchResultView:be,id:G,sourceType:null==$?void 0:$.sourceType,jimuMapView:me};Dt(e),Ce(!0),(e=>{const{serviceList:t,searchText:o,searchResultView:n,sourceType:i,jimuMapView:s,id:a}=e,u=[];for(const e in t){const c=t[e],{searchServiceType:d,resultMaxNumber:v}=c;if(d===l.GeocodeService){const e=n===r.ResultPanel?v:null,t=X(i,null==c?void 0:c.searchInCurrentMapExtent,s),l=E({address:o,maxResultNumber:e,geocodeItem:c,searchResultView:n,extent:t,jimuMapView:s,id:a});u.push(l)}}return Promise.all(u)})(o).then((t=>{var n;Ce(!1),(null===(n=null==t?void 0:t.filter((e=>"boolean"==typeof e)))||void 0===n?void 0:n.length)>0&&St(!0),j.current=!1,(null==$?void 0:$.enableFiltering)&&(Y(o),At()),e&&Ut(e)}),(e=>{Ce(!1)}))})),Et=()=>{var t;const o=[];for(const e in I.current){const n=I.current[e],r=n.searchServiceType===l.FeatureService?null===(t=null==n?void 0:n.useDataSource)||void 0===t?void 0:t.dataSourceId:null==n?void 0:n.outputDataSourceId;o.push(r)}if(e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage(G,[],o)),Ze){const e=te(Ze);null==e||e.selectRecordsByIds([]),Ft(null)}Ct(),wt()},Ft=e=>{et(e)},At=e.hooks.useEventCallback((()=>{var t;const o=[];for(const e in Oe){const n=Oe[e];let r;(null==n?void 0:n.searchServiceType)===l.FeatureService?(r=null===(t=null==n?void 0:n.useDataSource)||void 0===t?void 0:t.dataSourceId,o.push(r)):(null==n?void 0:n.outputDataSourceId)&&o.push(null==n?void 0:n.outputDataSourceId)}e.MessageManager.getInstance().publishMessage(new e.DataSourceFilterChangeMessage(G,o))})),Ut=e=>{be===r.OtherWidgets?e&&(Jt()?Bt():$t()):Vt()},$t=()=>{if(!de(h.current,G))return clearTimeout(x.current),x.current=setTimeout((()=>{$t()}),200),!1;const e=ee(h.current,Ie,G);Promise.all([e]).then((e=>{let t=[],o=[];null==e||e.forEach((e=>{t=t.concat(e)})),t.forEach((e=>{const t=(null==e?void 0:e.records)||[];o=o.concat(t)})),(null==o?void 0:o.length)>0?Bt():Vt()}))},Vt=()=>{_t(),Nt(!0)},Jt=()=>{let e=[];return Pe.forEach((t=>{e=e.concat(null==t?void 0:t.suggestionItem)})),e.length>0},Gt=t=>{(t=>{const{searchText:o,id:n,recentSearchesMaxNumber:l,isShowRecentSearches:r}=t,i=e.urlUtils.getAppIdPageIdFromUrl().appId,s=le(i,n);if(!r||!o)return!1;let a=ne(n);a.includes(o)||(a.unshift(o),a=a.splice(0,l||10),e.utils.setLocalStorage(s,escape(a.join("/@/"))))})({searchText:t,id:G,recentSearchesMaxNumber:ye,isShowRecentSearches:fe})},Bt=()=>{var e;if(!(null==u?void 0:u.current))return!1;_t(),Ue(!0),null===(e=null==u?void 0:u.current)||void 0===e||e.click()},_t=()=>{if(!de(h.current,G))return clearTimeout(w.current),w.current=setTimeout((()=>{_t()}),200),!1;const t=be===r.ResultPanel?Ie:100,o=ee(h.current,t,G,!0);Promise.all([o]).then((t=>{var o;let n=[];null==t||t.forEach((e=>{n=n.concat(e)}));let l,r=[];null==n||n.forEach((e=>{const t=(null==e?void 0:e.records)||[];r=r.concat(t)})),1===(null==r?void 0:r.length)&&(l=null===(o=r[0])||void 0===o?void 0:o.__extent),((t,o,n=e.RecordSetChangeType.CreateUpdate,l)=>{const r=[];null==o||o.forEach((e=>{var t;if(null==e?void 0:e.isGeocodeRecords){const o=te(e.dsId),n=null===(t=null==e?void 0:e.displayFields)||void 0===t?void 0:t.map((e=>e.jimuName)),l=null==o?void 0:o.getDataSourceJson(),i={records:e.records,fields:n,dataSource:o,name:o.id,label:null==l?void 0:l.label};r.push(i)}}));const i=new e.DataRecordSetChangeMessage(t,n,r);l&&(i.extent=l),e.MessageManager.getInstance().publishMessage(i)})(G,n,e.RecordSetChangeType.CreateUpdate,l)}))},Kt=ct((()=>(e=>{let t,o;return(null==e?void 0:e.linkType)&&(t=null==e?void 0:e.openType,o={linkType:null==e?void 0:e.linkType},o.value=null==e?void 0:e.value),{linkTo:o,target:t}})(Se)),[Se]),Wt=(e,t)=>{Le([]),we(e),R.current=e,zt(e,t)},zt=e.hooks.useEventCallback(((t,o)=>{var n,r,i,s;const a=f.current;let u=f.current;t=null==t?void 0:t.trim();const c=$.sourceType===d.MapCentric?null===(n=null==me?void 0:me.view)||void 0===n?void 0:n.extent:null;for(const e in a){const o=null===(i=null===(r=a[e])||void 0===r?void 0:r.useDataSource)||void 0===i?void 0:i.dataSourceId;if(a[e].searchServiceType===l.GeocodeService||!ue(o))continue;const n=te(o),d=(null===(s=a[e].searchFields)||void 0===s?void 0:s.asMutable({deep:!0}))||[],v=z(t,d,n,a[e].searchExact||!1),g=z(t,d,n,!1);if(u=u.setIn([e,"SQL"],v).setIn([e,"SuggestionSQL"],g).setIn([e,"searchText"],t),c){const t=(null==c?void 0:c.toJSON)?null==c?void 0:c.toJSON():{};u=u.setIn([e,"searchExtent"],t)}}I.current=u,((t,o)=>{const{configId:n,magicKey:l,isFromSuggestion:r}=o||{};let i=(0,e.Immutable)(t);const s={};for(const e in i)e===n&&(l||r)&&(l&&(i=i.setIn([n,"magicKey"],l||null)),r&&(i=i.setIn([n,"isFromSuggestion"],r||null)),s[n]=i[n]);(l||r)&&Object.keys(t).includes(n)&&(i=(0,e.Immutable)(s));h.current=null==i?void 0:i.asMutable({deep:!0}),ke(null==i?void 0:i.asMutable({deep:!0}))})(null==u?void 0:u.asMutable({deep:!0}),o)})),qt=e=>{if(!e&&fe){const e=ne(G).map((e=>({suggestionHtml:e,suggestion:e,isRecentSearch:!0})));He([{suggestionItem:e,layer:null,icon:null}]),mt(!0)}},Ht=e=>{!e&&(null==$?void 0:$.isUseCurrentLoation)&&(mt(!0),(null==$?void 0:$.isShowRecentSearches)||He([{suggestionItem:[],layer:null,icon:null}]))},Qt=e.hooks.useEventCallback(((e,t)=>{var n,l;if(!e)return;let r;const i=Xt(e);for(const t in e)r=(null===(n=null==e?void 0:e[t])||void 0===n?void 0:n.hint)&&(null===(l=null==e?void 0:e[t])||void 0===l?void 0:l.hint);const s=t||(null==$?void 0:$.hint)||o("findAddressOrPlace");r=r||o("findAddressOrPlace");Ge(1!==i?s:r)})),Xt=e.hooks.useEventCallback((e=>ie(e=e||q))),Yt=t=>{40===t.keyCode&&D&&(Re?(0,e.focusElementInKeyboardMode)(null==D?void 0:D.current,!0):Ee?(0,e.focusElementInKeyboardMode)(null==p?void 0:p.current,!0):Ke&&((0,e.focusElementInKeyboardMode)(null==k?void 0:k.current,!0),A.current=!0))},Zt=()=>{if(Be)return!0;if(je||Ee)return!1;let e=!1;return(null==$?void 0:$.maxSuggestions)>0&&(e=Re&&Ne),e||(F.current=!1),e},eo=()=>{Me(!1)};return(0,e.jsx)("div",{className:`h-100 align-items-center position-relative d-flex flex-grow-1 ${V||""} arrangement-${$.arrangementStyle}`,css:vt},(0,e.jsx)("div",{className:"h-100 flex-grow-1 search-input-con"},(0,e.jsx)("div",{className:"h-100 w-100",onKeyDown:e=>{if("ArrowUp"===e.key||"ArrowDown"===e.key){const e=Zt();F.current=e,A.current=Ke}Yt(e)}},B&&(0,e.jsx)(v.TextInput,{value:xe||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,n=(null==o?void 0:o.length)>2;if(Wt(o),Ee&&kt("",!0),Nt(!1),!n||!Ne)return Me(!1),0===(null==o?void 0:o.length)&&kt("",!0),!1;a.current(o)},onFocus:e=>{if(F.current||A.current)return A.current=!1,F.current=!1,!1;qt(R.current),Ht(R.current)},onPressEnter:e=>{var t;if(!e||!e.target)return;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;13===e.keyCode&&Pt()&&(Wt(o),kt(o)),Yt(e)},onBlur:e=>{N.current=setTimeout((()=>{F.current||Me(!1),U.current||A.current||mt(!1)}),200)},className:(0,e.classNames)("h-100 w-100",{"no-border-left":se}),suffix:(0,e.jsx)("div",{className:"d-flex align-items-center"},xe&&(null==xe?void 0:xe.length)>0&&(0,e.jsx)(v.Button,{icon:!0,type:"tertiary",size:"sm","aria-label":o("clear"),title:o("clear"),onClick:()=>{xt()}},(0,e.jsx)(rt,null))),prefix:$.arrangementStyle===i.Style2?(0,e.jsx)(tt,{className:"input-prefix-icon"}):null,placeholder:Je,title:xe||Je,ref:M,"aria-label":xe||Je,autoComplete:"off"})),xe&&(0,e.jsx)(De,{canUseOutputDsLength:Xt(),isOpen:Zt(),reference:J,searchText:xe,searchSuggestion:Pe,toggle:eo,onRecordItemClick:Lt,setSuggestionFirstItem:e=>{D.current=e},id:G,config:$,toggleSuggestionUtilityError:yt,openUtilityErrRemindInSuggestion:ot,searchInputRef:M,serviceList:q}),!xe&&((null==$?void 0:$.isUseCurrentLoation)||(null==$?void 0:$.isShowRecentSearches)||!Be)&&(0,e.jsx)(qe,{serviceList:ie(Oe)>0?(0,e.Immutable)(Oe):q,isOpen:Ke||Be,reference:J,isGetLocationError:Qe,recentSearchesData:ze,toggle:eo,onRecordItemClick:Lt,clearSearches:()=>{(t=>{const o=e.urlUtils.getAppIdPageIdFromUrl().appId,n=le(o,t);e.utils.setLocalStorage(n,"")})(G),He([]),We(!1)},setSuggestionFirstItem:e=>{k.current=e},id:G,config:$,searchInputRef:M,locationLoading:Be,handleLocationLoadingChange:e=>{e?(_e(e),U.current=e):setTimeout((()=>{_e(e),U.current=e}),300)}}),(0,e.jsx)(Xe,{isOpenResultPopper:Ee,isToOtherWidget:Ae,serviceList:(0,e.Immutable)(Oe),config:$,reference:J,searchText:xe,id:G,setResultFirstItem:e=>{p.current=e},isOpenResultListDefault:$e,searchInputRef:M,searchResult:H,selectionList:Q,openUtilityErrRemindInResult:lt,handleDsIdOfSelectedResultItemChange:Ft,toggleResultUtilityError:St,datasourceConfig:oe})),((t,o)=>{const n=t||o;return n?(0,e.jsx)("div",{className:(0,e.classNames)("position-absolute loading-con",{"hide-loading":!n})},(0,e.jsx)(v.Loading,{className:"w-100",type:"BAR"})):null})(je,Be),$.arrangementStyle!==i.Style2&&(0,e.jsx)(v.Button,{className:"search-button h-100",type:$.arrangementStyle===i.Style3?"tertiary":"primary",icon:!0,"aria-label":o("SearchLabel"),onClick:()=>{(e=>{Pt()&&kt(e)})(xe)},title:o("SearchLabel")},(0,e.jsx)(tt,null)),be===r.OtherWidgets&&(0,e.jsx)("div",{className:"search-link-con"},(0,e.jsx)(v.Link,{ref:u,to:null==Kt?void 0:Kt.linkTo,target:null==Kt?void 0:Kt.target,queryObject:n})))},{useEffect:vt,useState:gt}=e.React,mt=t=>{const{config:o,id:n,serviceList:r,dsStatus:i,synchronizeSettings:s,jimuMapView:a,handleSearchResultChange:u,handleSelectionListChange:c,handleDsStatusChange:v}=t,[g,m]=gt(!1);vt((()=>{Object.keys(r||{}).forEach((e=>{var t;(null===(t=r[e])||void 0===t?void 0:t.searchText)&&m(!0)}))}),[r]);const p=(t,r,u)=>{if(t.searchServiceType===l.GeocodeService){const l=null==t?void 0:t.outputDataSourceId,i={dataSourceId:l,mainDataSourceId:l},a={where:"2=2",sqlExpression:null,pageSize:o.resultMaxNumber,outFields:["*"],page:1,returnGeometry:!0};if(!1!==s&&(null==o?void 0:o.sourceType)===d.MapCentric){const o=te(l);return(0,e.jsx)("div",{key:`${r}_con`},l&&(0,e.jsx)(e.DataSourceComponent,{dataSource:o,query:a,key:`${r}_outputDataSource`,onDataSourceInfoChange:e=>{f(t,r)},onDataSourceStatusChange:e=>{f(t,r,e)},onSelectionChange:e=>{h(e,r)},widgetId:n}))}return(0,e.jsx)("div",{key:`${r}_con`},l&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:(0,e.Immutable)(i),query:a,key:`${r}_outputDataSource`,onDataSourceInfoChange:e=>{f(t,r)},onDataSourceStatusChange:e=>{f(t,r,e)},onSelectionChange:e=>{h(e,r)},widgetId:n}))}if(t.searchServiceType===l.FeatureService){const l=null==t?void 0:t.useDataSource,s=function(t,o,n,l){const{searchText:r,useDataSource:i}=t,s=null==t?void 0:t.SQL,a=r?(null==s?void 0:s.sql)||"1=0":"1=1",u=r&&(null==s?void 0:s.sql)?s:null,c=q(t.searchFields,t.displayFields,null==i?void 0:i.dataSourceId);let v=(0,e.Immutable)({outFields:c,where:a,sqlExpression:u,returnGeometry:!0});if(n===d.MapCentric&&l){const e=null==o?void 0:o.view.extent,t=e?e.toJSON():{};v=v.set("geometry",t)}return v}(null==t?void 0:t.asMutable({deep:!0}),a,o.sourceType,t.searchInCurrentMapExtent),c=ce(r,n);return(0,e.jsx)("div",{key:`${r}_con`},l&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:(0,e.Immutable)(l),query:u?s:null,key:`${r}_useDataSource`,onDataSourceInfoChange:e=>{f(t,r)},onSelectionChange:e=>{h(e,r)},onDataSourceCreated:e=>{e.setListenSelection(!0)},onDataSourceStatusChange:t=>{v((0,e.Immutable)(i.set(r,t)))},localId:c}))}},h=(e,t)=>{c(e,t)},f=(t,r,s)=>{const{searchServiceType:a}=t;switch(a){case l.GeocodeService:B(null==t?void 0:t.asMutable({deep:!0}),o.resultMaxNumber).then((e=>{const{records:t}=e,o=null==t?void 0:t.map((e=>e.getId()));u(r,o)}));break;case l.FeatureService:H(null==t?void 0:t.asMutable({deep:!0}),o.resultMaxNumber,n).then((e=>{const{records:t}=e,o=null==t?void 0:t.map((e=>e.getId()));u(r,o)}))}s&&v((0,e.Immutable)(i.set(r,s)))};return(0,e.jsx)("div",null,((e,t)=>{const o=[];for(const n in e)o.push(p(e[n],n,t));return o})(r,g))};var pt=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const ht=(e,t=0)=>{let o="Default Address";return null==e||e.forEach((n=>{o=t?`${o}${t}`:o,n.jimuName===o&&(o=ht(e,t+=1))})),o};function ft(t){return pt(this,void 0,void 0,(function*(){yield function(t){return pt(this,void 0,void 0,(function*(){if(!t)return;const o=[];return Object.keys(t).forEach((n=>{const l=t[n],r=yt(l),i=(null==r?void 0:r.layers)||[],s=(null==r?void 0:r.tables)||[],a=[],u=[];if(s.forEach((e=>{a.includes(null==e?void 0:e.id)||a.push(null==e?void 0:e.id)})),i.forEach((e=>{u.includes(null==e?void 0:e.id)||u.push(null==e?void 0:e.id)})),null==r?void 0:r.enabled){const l=t[n],r=l.jimuLayerViews,i=l.jimuTables,s=e.DataSourceManager.getInstance();Object.keys(i).forEach((e=>{const t=i[e],n=l.getDataSourceIdByAPILayer(t),r=s.getDataSource(n),u=l.getMapDataSource();if(!r&&u&&a.includes(null==t?void 0:t.id)){const e=u.createDataSourceByLayer(t);o.push(e)}})),Object.keys(r).forEach((e=>{var t;const n=r[e];if(!n.getLayerDataSource()&&u.includes(null===(t=n.layer)||void 0===t?void 0:t.id)){const e=n.createLayerDataSource();o.push(e)}}))}})),Promise.all(o)}))}(t);const o={},n=yield e.moduleLoader.loadModule("jimu-ui/advanced/setting-components"),{getNewDataSourceConfig:l,getDsJsonOfOriginDs:r}=n,i=Object.keys(t||{}).map((n=>pt(this,void 0,void 0,(function*(){var i,s,a,u,c,d,v,g;const m=t[n],p=It(m),h=wt(m),f=null===(i=h[0])||void 0===i?void 0:i.jimuLayerViewsOrTable,y=null===(s=h[1])||void 0===s?void 0:s.jimuLayerViewsOrTable,S=0===(null===(a=Object.keys(f))||void 0===a?void 0:a.length)&&0===(null===(u=Object.keys(y))||void 0===u?void 0:u.length);let b=null===(c=null==o?void 0:o[n])||void 0===c?void 0:c.dataSourceConfig;if(S||0===(null==p?void 0:p.length))o[n]={dataSourceConfig:(null===(d=null==o?void 0:o[n])||void 0===d?void 0:d.dataSourceConfig)||[]};else{const t=e.DataSourceManager.getInstance();for(let i=0;i<h.length;i++){const{jimuLayerViewsOrTable:s,isTable:a}=h[i];for(const i in s||{}){const u=s[i],c=a?m.getDataSourceIdByAPILayer(u):null,d=a?null==u?void 0:u.id:null===(v=null==u?void 0:u.layer)||void 0===v?void 0:v.id,h=a?t.getDataSource(c):null==u?void 0:u.getLayerDataSource();if(!Ct(n,null==h?void 0:h.id,o)&&p.includes(d)){const t={dataSourceId:h.id,mainDataSourceId:h.id,dataViewId:h.dataViewId,rootDataSourceId:null===(g=h.getRootDataSource())||void 0===g?void 0:g.id,viewId:n},i=yield r(t);jt(m,u,a).forEach((r=>{var s;const a=null==r?void 0:r.field,u=(null===(s=null==r?void 0:r.field)||void 0===s?void 0:s.exactMatch)||!1;let c;if(null==a?void 0:a.name){c=`${null==i?void 0:i.getLabel()}: ${a.name}`}const d={datasourceConfig:(0,e.Immutable)(b),dsJsonOriginDs:i,useDataSource:t,viewId:n,fieldsInMapSearchProperties:a?[a]:null,exactMatch:u,label:c},v=l(d);o[n]||(o[n]={}),o[n].dataSourceConfig=v.datasourceConfig,b=v.datasourceConfig}))}}}}return Promise.resolve(o)}))));return yield Promise.all(i),Promise.resolve(o)}))}const yt=e=>{var t,o,n,l;if(!e)return null;const r=(null===(o=null===(t=e.view)||void 0===t?void 0:t.map)||void 0===o?void 0:o.applicationProperties)||null;return r?null===(l=null===(n=r.toJSON())||void 0===n?void 0:n.viewing)||void 0===l?void 0:l.search:null},St=[e.JSAPILayerTypes.FeatureLayer,e.JSAPILayerTypes.SceneLayer,e.JSAPILayerTypes.BuildingComponentSublayer,e.JSAPILayerTypes.ImageryTileLayer,e.JSAPILayerTypes.OrientedImageryLayer,e.JSAPILayerTypes.ImageryLayer,e.JSAPILayerTypes.SubtypeGroupLayer,e.JSAPILayerTypes.SubtypeSublayer];function bt(t){if(!t||!t.type)return!1;const o=t.type,n=o!==e.JSAPILayerTypes.BuildingComponentSublayer||o===e.JSAPILayerTypes.BuildingComponentSublayer&&t.view;return!!(St.includes(o)&&n)}const It=t=>{const o=yt(t);if(!(null==o?void 0:o.enabled))return[];const n=[],l=e.DataSourceManager.getInstance();return wt(t).forEach((e=>{var r,i;const{jimuLayerViewsOrTable:s,isTable:a}=e;for(const e in s||{}){const u=s[e];if(!bt(u))continue;const c=a?t.getDataSourceIdByAPILayer(u):null,d=a?null==u?void 0:u.id:null===(r=null==u?void 0:u.layer)||void 0===r?void 0:r.id,v=a?l.getDataSource(c):null==u?void 0:u.getLayerDataSource();(null===(i=null==v?void 0:v.getDataSourceJson())||void 0===i?void 0:i.url)&&xt(u,o,a)&&n.push(d)}})),n};function xt(e,t,o){var n,l,r,i;const s=(null==t?void 0:t.layers)||[],a=(null==t?void 0:t.tables)||[],u=s.concat(a),c=o?null==e?void 0:e.id:null===(n=null==e?void 0:e.layer)||void 0===n?void 0:n.id;if("sublayer"===(null===(l=null==e?void 0:e.layer)||void 0===l?void 0:l.type)&&(null===(i=null===(r=null==e?void 0:e.layer)||void 0===r?void 0:r.parent)||void 0===i?void 0:i.id)){const t=e.layer.parent.id;let o=!1;return u.forEach((e=>{e.id===t&&(null==e?void 0:e.subLayer)===c&&(o=!0)})),o}{const e=(null==t?void 0:t.layers)||[],o=(null==t?void 0:t.tables)||[];return e.concat(o).map((e=>null==e?void 0:e.id)).includes(c)}}const wt=e=>[{jimuLayerViewsOrTable:null==e?void 0:e.jimuLayerViews,isTable:!1},{jimuLayerViewsOrTable:null==e?void 0:e.jimuTables,isTable:!0}],jt=(e,t,o)=>{var n,l,r,i;const s=o?null==t?void 0:t.id:null===(n=null==t?void 0:t.layer)||void 0===n?void 0:n.id,a=yt(e),u=(null==a?void 0:a.layers)||[],c=(null==a?void 0:a.tables)||[],d=u.concat(c);let v;return v="sublayer"===(null===(l=null==t?void 0:t.layer)||void 0===l?void 0:l.type)&&(null===(i=null===(r=null==t?void 0:t.layer)||void 0===r?void 0:r.parent)||void 0===i?void 0:i.id)?d.filter((e=>(null==e?void 0:e.id)===t.layer.parent.id&&(null==e?void 0:e.subLayer)===s))||[]:d.filter((e=>(null==e?void 0:e.id)===s))||[],v};function Ct(e,t,o){var n;const l=null==o?void 0:o[e];if(!l)return!1;const r=null===(n=null==l?void 0:l.dataSourceConfig)||void 0===n?void 0:n.filter((e=>{var o;return t===(null===(o=null==e?void 0:e.useDataSource)||void 0===o?void 0:o.dataSourceId)}));return(null==r?void 0:r.length)>0}var Rt=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const Mt={jimuName:w,alias:"ADDRESS",type:e.JimuFieldType.String,name:w},Nt=t=>Rt(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))}));class Tt extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.9.0",description:"For geocode service, use array of Schema to set displayFields",upgrader:e=>{var t,o;const n=null===(o=null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.datasourceConfig)||void 0===o?void 0:o.map((e=>((null==e?void 0:e.searchServiceType)===l.FeatureService||(null==e?void 0:e.displayFields)||(e.displayFields=[Mt],e.addressFields=[Mt],e.defaultAddressFieldName=Mt.jimuName),e)));return e.setIn(["datasourceConfig"],n)}},{version:"1.10.0",description:"For locator service, need to save support for suggest in config",upgrader:t=>Rt(this,void 0,void 0,(function*(){var o,n;const r=null===(n=null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===n?void 0:n.map((t=>(null==t?void 0:t.searchServiceType)===l.FeatureService?Promise.resolve(t):Nt(null==t?void 0:t.useUtility).then((o=>Rt(this,void 0,void 0,(function*(){return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[n]=e;return n(o,{query:{f:"json"},responseType:"json"}).then((e=>{var o;const n=(null==e?void 0:e.data)||{};if(null==n?void 0:n.capabilities){const e=(null===(o=null==n?void 0:n.capabilities)||void 0===o?void 0:o.split(","))||[],l=null==e?void 0:e.includes("Suggest");return t.isSupportSuggest=l,Promise.resolve(t)}return Promise.resolve(t)}),(e=>Promise.resolve(t)))}),(e=>Promise.resolve(t)))})))))),i=r?yield Promise.all(r):[];return t.setIn(["datasourceConfig"],i)}))},{version:"1.12.0",description:'For old search widgets, "enableFiltering" needs to be "true" by default, and the default value of "searchResultStyle" should be "Classic"',upgrader:t=>Rt(this,void 0,void 0,(function*(){const o=yield(()=>Rt(this,void 0,void 0,(function*(){var o,n;const r=null===(n=null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===n?void 0:n.map((t=>Rt(this,void 0,void 0,(function*(){return(null==t?void 0:t.searchServiceType)===l.FeatureService?Promise.resolve(t):Nt(null==t?void 0:t.useUtility).then((o=>(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((n=>{const[l]=n;return l(o,{query:{f:"json"},responseType:"json"}).then((o=>{const n=(null==o?void 0:o.data)||{};if(null==n?void 0:n.capabilities){const o=(null==n?void 0:n.candidateFields)||[],{addressFieldsSchema:l}=((t=[])=>{const o=null==t?void 0:t.map((t=>({jimuName:null==t?void 0:t.alias,alias:null==t?void 0:t.alias,type:e.JimuFieldType.String,name:null==t?void 0:t.alias}))),n=ht(o,0),l={jimuName:n,alias:n,type:e.JimuFieldType.String,name:n};return o.unshift(l),{addressFieldsSchema:o,defaultAddressFieldName:n}})(o),r=((null==t?void 0:t.addressFields)||[]).concat(l);return t.addressFields=r,Promise.resolve(t)}return Promise.resolve(t)}),(e=>Promise.resolve(t)))}))))}))));return r?yield Promise.all(r):[]})))();return t.setIn(["enableFiltering"],!0).setIn(["datasourceConfig"],o).setIn(["searchResultStyle"],u.Classic)}))},{version:"1.15.0",description:"Add spatialReference for locator service",upgrader:t=>Rt(this,void 0,void 0,(function*(){let o=!1;const n=yield(()=>Rt(this,void 0,void 0,(function*(){var n,r;const i=null===(r=null===(n=null==t?void 0:t.asMutable({deep:!0}))||void 0===n?void 0:n.datasourceConfig)||void 0===r?void 0:r.map((t=>Rt(this,void 0,void 0,(function*(){return(null==t?void 0:t.searchServiceType)===l.FeatureService?Promise.resolve(t):Nt(null==t?void 0:t.useUtility).then((n=>(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[l]=e;return l(n,{query:{f:"json"},responseType:"json"}).then((e=>{const n=(null==e?void 0:e.data)||{};return(null==n?void 0:n.spatialReference)?(o=!0,t.spatialReference=n.spatialReference,Promise.resolve(t)):Promise.resolve(t)}),(e=>Promise.resolve(t)))}))))}))));return i?yield Promise.all(i):[]})))(),r=t.setIn(["datasourceConfig"],n);return o?r:t}))},{version:"1.16.0",description:"Update isAutoSelectFirstResult with searchResultView",upgrader:e=>{let t=e;return(null==e?void 0:e.searchResultView)===r.OtherWidgets&&(null==e?void 0:e.isAutoSelectFirstResult)&&(t=t.set("isAutoSelectFirstResult",!1)),t}}]}}const Pt=new Tt;var Lt=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const{useEffect:Dt,useState:Ot,useRef:kt}=e.React,Et=e.css`
  & {
    height: ${e.polished.rem(32)};
    margin-top: 0;
    margin-left: 0;
  }
  &.search-con-in-controller {
    width: 300px !important;
  }
  &.search-con-Style3 {
    border-bottom: 1px solid var(--ref-palette-neutral-500);
  }
`,Ft=o=>{const n=kt(null),r=kt(null),s=kt(null),{config:a,id:u,useDataSources:c,useMapWidgetIds:v}=o,{resultMaxNumber:g}=a,m=kt(null),p=kt((0,e.Immutable)({})),h=e.hooks.useTranslation(e.defaultMessages),[f,y]=Ot((0,e.Immutable)([])),[S,b]=Ot(!1),[I,w]=Ot(null),[j,C]=Ot((0,e.Immutable)({})),[R,M]=Ot((0,e.Immutable)({})),[N,T]=Ot((0,e.Immutable)({})),[P,L]=Ot(null),[D,O]=Ot(null),[k,E]=Ot(!1);Dt((()=>{const t=v&&(null==v?void 0:v.length)>0;(null==a?void 0:a.sourceType)===d.MapCentric&&t&&E(!0),(null==a?void 0:a.sourceType)===d.MapCentric&&P?t?F(a,P):(y((0,e.Immutable)([])),w(null),E(!1)):(!t&&E(!1),U(null==a?void 0:a.datasourceConfig)),n.current=a,r.current=P}),[a,P,v]);const F=(t,o)=>Lt(void 0,void 0,void 0,(function*(){var l,i,a;E(!0);const c=null==o?void 0:o.id,v=(null===(l=r.current)||void 0===l?void 0:l.id)!==c,g=(null==t?void 0:t.dataSourceConfigWithMapCentric)!==(null===(i=n.current)||void 0===i?void 0:i.dataSourceConfigWithMapCentric);let m=[];const p=null===(a=null==t?void 0:t.dataSourceConfigWithMapCentric)||void 0===a?void 0:a[c];!1!==(null==p?void 0:p.synchronizeSettings)&&(m=yield Lt(void 0,void 0,void 0,(function*(){const t=yield e.moduleLoader.loadModule("jimu-ui/advanced/setting-components"),{getDefaultGeocodeConfig:o}=t;return s.current?Promise.resolve(D):o({nls:h,id:u,createOutputDs:!0,viewId:"default_geocode_custom",isSingle:!1,notAddNewUtility:!0}).then((e=>(O(e),s.current=e,Promise.resolve(e))),(e=>Promise.resolve([])))})),yield me(m));const f=yield function(t,o,n){return pt(this,void 0,void 0,(function*(){var l;const r=null==t?void 0:t.id;if((null==o?void 0:o.sourceType)===d.MapCentric){const i=(null==o?void 0:o.dataSourceConfigWithMapCentric)||{},s=Object.keys(i)||[];let a;if(s.includes(r)?a=null==i?void 0:i[r]:(null==s?void 0:s.length)>0&&(a=null==i?void 0:i[s[0]]),!1===(null==a?void 0:a.synchronizeSettings))return Promise.resolve((0,e.Immutable)(null==a?void 0:a.dataSourceConfig));{const o={};o[t.id]=t;const i=yield ft(o);let s=(null===(l=null==i?void 0:i[r])||void 0===l?void 0:l.dataSourceConfig)||[];const a=n||[];return s=s.concat(a),Promise.resolve((0,e.Immutable)(s))}}return Promise.resolve(null==o?void 0:o.datasourceConfig)}))}(o,t,m);(v||g)&&(yield U(f)),E(!1)})),A=e=>{e&&y(e),K(e)},U=t=>Lt(void 0,void 0,void 0,(function*(){const o=(t||(0,e.Immutable)([])).map((e=>Lt(void 0,void 0,void 0,(function*(){const t=!1===(null==a?void 0:a.allowSearchSourceSelection)||V(e);let o=null==e?void 0:e.setIn(["enable"],t);return(null==e?void 0:e.useUtility)&&(yield $(e).then((e=>{o=o.setIn(["geocodeURL"],e)}))),Promise.resolve(null==o?void 0:o.asMutable({deep:!0}))}))));yield Promise.all(o).then((t=>{y((0,e.Immutable)(t)),K((0,e.Immutable)(t))}))})),$=e=>Lt(void 0,void 0,void 0,(function*(){var t;return(null===(t=null==e?void 0:e.useUtility)||void 0===t?void 0:t.utilityId)?J(null==e?void 0:e.useUtility):(null==e?void 0:e.geocodeURL)?Promise.resolve(null==e?void 0:e.geocodeURL):void 0})),V=e=>{if(f&&0!==(null==f?void 0:f.length)){let t=!0;return null==f||f.forEach((o=>{(null==e?void 0:e.configId)===(null==o?void 0:o.configId)&&(t=!!(null==o?void 0:o.enable))})),t}{const t=ve(u),o=null==t?void 0:t.serviceEnabledList;return!o||o.includes(null==e?void 0:e.configId)}},J=t=>Lt(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))})),G=e=>{w(e)},B=()=>(null==a?void 0:a.arrangementStyle)===i.Style1||(null==a?void 0:a.arrangementStyle)===i.Style2||(null==a?void 0:a.arrangementStyle)===i.Style3||S,_=e=>{b(e)},K=t=>{var o;let n=(0,e.Immutable)({});null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o||o.forEach((e=>{if(!(null==e?void 0:e.enable))return!1;const{configId:t}=e;let o;o=(null==e?void 0:e.searchServiceType)===l.GeocodeService?z(e):W(e),n=n.setIn([t],o)})),w(n)},W=e.hooks.useEventCallback((e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===l.GeocodeService)return!1;const{configId:o,useDataSource:n,displayFields:r,searchFields:i,searchExact:s,hint:a,searchServiceType:u,searchInCurrentMapExtent:c}=e,d=(null===(t=null==I?void 0:I[o])||void 0===t?void 0:t.asMutable({deep:!0}))||{},v={useDataSource:n,displayFields:r,searchFields:i,searchExact:s,resultMaxNumber:g,hint:a,searchServiceType:u,configId:o,searchInCurrentMapExtent:c};return Object.assign(d,v)})),z=e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===l.FeatureService)return!1;const{countryCode:o,configId:n,hint:r,geocodeURL:i,outputDataSourceId:s,label:a,searchInCurrentMapExtent:u,enableLocalSearch:c,minScale:d,searchServiceType:v,spatialReference:m,singleLineFieldName:p,displayFields:h,defaultAddressFieldName:f,addressFields:y,isSupportSuggest:S,useUtility:b}=e,x=(null===(t=null==I?void 0:I[n])||void 0===t?void 0:t.asMutable({deep:!0}))||{},w={hint:r,geocodeURL:i,outputDataSourceId:s,icon:null==e?void 0:e.icon,resultMaxNumber:g,label:a,searchServiceType:v,configId:n,singleLineFieldName:p||"",displayFields:h,defaultAddressFieldName:f,addressFields:y||[],isSupportSuggest:S,useUtility:b,spatialReference:m,countryCode:o,searchInCurrentMapExtent:u,enableLocalSearch:c,minScale:d};return Object.assign(x,w)},q=(t,o)=>{const n=j.set(t,o);C((0,e.Immutable)(n))},H=()=>{C((0,e.Immutable)({}))},Q=e.hooks.useEventCallback(((e,t)=>{const o=p.current.setIn([t],e);M(o),p.current=o})),X=e=>{T(e)},Y=e=>{L(e)},Z=e.hooks.useEventCallback(((e,t,o)=>!1!==o&&(e||(null==t?void 0:t.length)>1&&B())));return(0,e.jsx)(t.ViewVisibilityContext.Consumer,null,(({isInView:o,isInCurrentView:n})=>{const l=!o||n;return(0,e.jsx)(t.PageVisibilityContext.Consumer,null,(t=>{var o,n,r,i;return(0,e.jsx)("div",{className:"widget-search jimu-widget"},(0,e.jsx)("div",{className:`d-flex w-100 align-items-center search-con-${a.arrangementStyle}`,css:Et,ref:m},(0,e.jsx)("div",null,Z(k,f,null==a?void 0:a.allowSearchSourceSelection)&&(0,e.jsx)(Se,{showLoading:k,className:"h-100",config:a,dsStatus:N,datasourceConfig:f,id:u,useDataSources:c,onDatasourceConfigChange:A,synchronizeSettings:null===(n=null===(o=null==a?void 0:a.dataSourceConfigWithMapCentric)||void 0===o?void 0:o[null==P?void 0:P.id])||void 0===n?void 0:n.synchronizeSettings})),(0,e.jsx)(dt,{showSearchSetting:Z(k,f,null==a?void 0:a.allowSearchSourceSelection),id:u,className:"flex-grow-1 h-100",reference:m,config:a,isShowSearchInput:B(),onShowSearchInputChange:_,isInCurrentView:l,isWidgetInCurrentPage:t,handleServiceListChange:G,searchResult:j,serviceList:I,clearSearchResult:H,selectionList:R,jimuMapView:P,datasourceConfig:f,loadingServiceList:k}),(0,e.jsx)(mt,{id:u,config:a,serviceList:I,dsStatus:N,jimuMapView:P,handleSearchResultChange:q,handleSelectionListChange:Q,handleDsStatusChange:X,synchronizeSettings:null===(i=null===(r=null==a?void 0:a.dataSourceConfigWithMapCentric)||void 0===r?void 0:r[null==P?void 0:P.id])||void 0===i?void 0:i.synchronizeSettings}),(null==a?void 0:a.sourceType)===d.MapCentric&&(0,e.jsx)(x.JimuMapViewComponent,{useMapWidgetId:null==v?void 0:v[0],onActiveViewChange:Y})))}))}))};Ft.versionManager=Pt;const At=Ft;function Ut(e){s.p=e}})(),a})())}}}));