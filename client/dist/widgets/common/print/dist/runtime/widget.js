System.register(["jimu-core","jimu-ui","jimu-arcgis","jimu-theme"],(function(e,t){var l={},o={},n={},i={};return{setters:[function(e){l.AllDataSourceTypes=e.AllDataSourceTypes,l.BaseVersionManager=e.BaseVersionManager,l.DataSourceComponent=e.DataSourceComponent,l.DataSourceManager=e.DataSourceManager,l.DataSourceStatus=e.DataSourceStatus,l.DataSourceTypes=e.DataSourceTypes,l.Immutable=e.Immutable,l.React=e.React,l.ReactRedux=e.ReactRedux,l.ServiceManager=e.ServiceManager,l.SessionManager=e.SessionManager,l.UtilityManager=e.UtilityManager,l.WidgetState=e.WidgetState,l.appActions=e.appActions,l.appConfigUtils=e.appConfigUtils,l.classNames=e.classNames,l.css=e.css,l.defaultMessages=e.defaultMessages,l.esri=e.esri,l.getAppStore=e.getAppStore,l.hooks=e.hooks,l.jsx=e.jsx,l.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,l.lodash=e.lodash,l.moduleLoader=e.moduleLoader,l.polished=e.polished},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Checkbox=e.Checkbox,o.Icon=e.Icon,o.Loading=e.Loading,o.LoadingType=e.LoadingType,o.Nav=e.Nav,o.NavItem=e.NavItem,o.NavLink=e.NavLink,o.Navbar=e.Navbar,o.NumericInput=e.NumericInput,o.Option=e.Option,o.Popper=e.Popper,o.Radio=e.Radio,o.SVG=e.SVG,o.Select=e.Select,o.TextInput=e.TextInput,o.WidgetPlaceholder=e.WidgetPlaceholder,o.defaultMessages=e.defaultMessages},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent,n.MapViewManager=e.MapViewManager,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.getAppThemeVariables=e.getAppThemeVariables,i.getThemeColorValue=e.getThemeColorValue}],execute:function(){e((()=>{var e={68108:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#C5C5C5" fill-rule="evenodd" d="M2.4.8V4h-.8A1.6 1.6 0 0 0 0 5.6v3.2a1.6 1.6 0 0 0 1.136 1.532c.249.075.464-.143.464-.403 0-.182-.154-.323-.32-.396A.8.8 0 0 1 .8 8.8V5.6a.8.8 0 0 1 .8-.8h12.8a.8.8 0 0 1 .8.8v3.2a.8.8 0 0 1-.48.733c-.166.073-.32.214-.32.396 0 .26.215.478.464.403A1.6 1.6 0 0 0 16 8.8V5.6A1.6 1.6 0 0 0 14.4 4h-.8V.8a.8.8 0 0 0-.8-.8H3.2a.8.8 0 0 0-.8.8m10.4 0H3.2V4h9.6z" clip-rule="evenodd"></path><path fill="#C5C5C5" d="M5.2 10.4a.4.4 0 0 0 0 .8h5.6a.4.4 0 0 0 0-.8zM5.2 12.8a.4.4 0 0 0 0 .8h3.2a.4.4 0 0 0 0-.8z"></path><path fill="#C5C5C5" fill-rule="evenodd" d="M2.4 15.2V8.8H2A.4.4 0 0 1 2 8h12a.4.4 0 0 1 0 .8h-.4v6.4a.8.8 0 0 1-.8.8H3.2a.8.8 0 0 1-.8-.8m10.4-6.4v6.4H3.2V8.8z" clip-rule="evenodd"></path><path fill="#C5C5C5" d="M12 6c0-.22.18-.4.4-.4h.8a.4.4 0 0 1 0 .8h-.8A.4.4 0 0 1 12 6"></path></svg>'},55886:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 12"><path fill="#000" fill-rule="evenodd" d="M10.167 0H1.833A.845.845 0 0 0 1 .857v10.286c0 .473.373.857.833.857h8.334c.46 0 .833-.384.833-.857V.857A.845.845 0 0 0 10.167 0M2 11V1h8v10zm1.6-8h4.8c.331 0 .6.224.6.5s-.269.5-.6.5H3.6c-.331 0-.6-.224-.6-.5s.269-.5.6-.5m4.8 3H3.6c-.331 0-.6.224-.6.5s.269.5.6.5h4.8c.331 0 .6-.224.6-.5S8.731 6 8.4 6" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},29435:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.938 8A7 7 0 0 1 1.01 9H0a8.001 8.001 0 0 0 15.938-1A8 8 0 0 0 1.02 3.98L1 .702a.5.5 0 1 0-1 .006L.031 5.9l5.128-.826a.5.5 0 0 0-.16-.987L1.819 4.6A7 7 0 0 1 14.938 8"></path></svg>'},22167:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M4 4.796 4.796 4 8.02 7.224l3.184-3.184.796.796L8.816 8.02l3.144 3.144-.796.796L8.02 8.816 4.836 12l-.796-.796L7.224 8.02z"></path><path fill="#000" fill-rule="evenodd" d="m0 4 4-4h8l4 4v8l-4 4H4l-4-4zm1 .414L4.414 1h7.172L15 4.414v7.172L11.586 15H4.414L1 11.586z" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=n},79244:e=>{"use strict";e.exports=l},1888:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=o}},t={};function r(l){var o=t[l];if(void 0!==o)return o.exports;var n=t[l]={exports:{}};return e[l](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var l in t)r.o(t,l)&&!r.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var a={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(a),r.d(a,{__set_webpack_public_path__:()=>Gt,default:()=>Wt});var e=r(79244),t=r(14321),l=r(62686);const o="CIMMarkerNorthArrow",n={color:"#000",size:"4px"};var i,s,u;!function(e){e.ExportWebMap="ExportWebMap",e.GetLayoutTemplatesInfo="GetLayoutTemplatesInfo",e.GetReportTemplatesInfo="GetReportTemplatesInfo"}(i||(i={})),function(e){e.CurrentMapExtent="CURRENT MAP EXTENT",e.CurrentMapScale="CURRENT MAP SCALE",e.SetMapScale="SET MAP SCALE"}(s||(s={})),function(e){e.Point="POINT",e.Inch="INCH",e.Centimeter="CENTIMETER",e.Millimeter="MILLIMETER"}(u||(u={}));const d={layoutOptions:{customTextElements:[],hasAuthorText:!0,hasCopyrightText:!0,hasLegend:!0,hasTitleText:!0},mapSurroundInfos:[],pageSize:null,pageUnits:null,webMapFrameSize:null},c={scalePreserved:!1,outScale:36978595.474472,layoutOptions:{titleText:"ArcGIS Web Map"},exportOptions:{dpi:96},printExtentType:s.CurrentMapExtent,attributionVisible:!1,forceFeatureAttributes:!0,wkid:102100,wkidLabel:"WGS_1984_Web_Mercator_Auxiliary_Sphere",enableTitle:!0,legendEnabled:!0,enableMapPrintExtents:!0,enableOutputSpatialReference:!0,enableQuality:!0,enableFeatureAttribution:!0,enableMapSize:!0,overrideCommonSetting:!1,enableAuthor:!0,enableCopyright:!0,enableLegend:!0,enableScalebarUnit:!0,enableCustomTextElements:!0};var p,v,m,y,f,h,g,x,b;!function(e){e.LayoutTemplate="Layout Template",e.ReportTemplate="Report Template"}(p||(p={})),function(e){e.Classic="CLASSIC",e.Compact="COMPACT"}(v||(v={})),function(e){e.OrganizationService="ORGANIZATION SERVICE",e.Customize="CUSTOMIZE"}(m||(m={})),function(e){e.OrganizationTemplate="ORGANIZATION TEMPLATE",e.Customize="CUSTOMIZE"}(y||(y={})),function(e){e.Loading="LOADING",e.Success="SUCCESS",e.Error="ERROR"}(f||(f={})),function(e){e.PrintTemplate="PRINT TEMPLATE",e.PrintResult="PRINT RESULT"}(h||(h={})),function(e){e.ServiceLayout="Service Layout",e.CustomLayout="Custom Layout"}(g||(g={})),function(e){e.RPTT="RPTT",e.RPTX="RPTX"}(x||(x={})),function(e){e.ServiceReport="Service Report",e.CustomReport="Custom Report"}(b||(b={}));var w=r(68108),S=r.n(w);const I={_widgetLabel:"Print",printPlaceholder:"Select or switch to a webmap to enable print.",chooseMapTip:"Please select a map with 2D data.",chooseUseUtility:"Please select utility.",printTemplate:"Print template",printResult:"Print result",previewPrint:"Preview print extents",fileFormat:"File format",mapPrintingExtents:"Map printing extents",outputSpatialReference:"Output spatial reference",printQuality:"Print quality",featureAttribution:"Feature attribution",selectEditableSettings:"Select editable settings",currentMapExtent:"Current map extent",currentMapScale:"Current map scale",setMapScale:"Set map scale",useCurrentScale:"Use current scale",wellKnownId:"Enter a well-known ID ({wkid})",allowEditing:"Select settings that allow editing at runtime",includeAttribution:"Include attribution",includeAttributes:"Include attributes",includeLegend:"Include legend",templateConfiguration:"Template configuration",templateName:"Template name",printLayout:"Layout",MapOnlyOptions:"Map-only options",LayoutOptions:"Layout options",mapSize:"Map size",spatialReference:"Output spatial reference {WKID}",printAuthor:"Author",printCopyright:"Copyright",scaleBarUnit:"Scalebar unit",mapAttribution:"Map attribution",resultEmptyMessage:"Your printed files will appear here.",northArrow:"North arrow",includeNorthArrow:"Include north arrow",resultsNumber:"Results {number}"};var T=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{s(o.next(e))}catch(e){i(e)}}function a(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};const O=t=>T(void 0,void 0,void 0,(function*(){return G(t).then((t=>e.ServiceManager.getInstance().fetchArcGISServerInfo(t).then((e=>Promise.resolve(null==e?void 0:e.owningSystemUrl)),(e=>Promise.reject(new Error(e))))))})),j=(e,t,l)=>T(void 0,void 0,void 0,(function*(){return G(t).then((t=>B(t,l,e)))}));const C=(e,t,l)=>T(void 0,void 0,void 0,(function*(){const o=k(null==t?void 0:t.utilityId);return te(e).then((n=>{let i=l;return B(e,p.LayoutTemplate).then((r=>T(void 0,void 0,void 0,(function*(){let a;if(n.supportCustomReport||n.supportReport){const l=(yield B(e,p.ReportTemplate))||[],o=M(l);i=i.set("reportTemplateChoiceList",o).set("defaultReportTemplate",null==n?void 0:n.defaultReportTemplate).set("defaultCustomReportItem",null==n?void 0:n.defaultCustomReportItem),a=yield N(l,n,t)}const s=yield R(n,t),u={templateTaskInfo:r,templatesInTask:null==n?void 0:n.templates,reportOption:a,defaultLayoutOptionInfo:s,printTemplateType:null==l?void 0:l.printTemplateType,printServiceType:o},d=L(u),c=A(null==n?void 0:n.templates,d);return i=i.set("printCustomTemplate",d).set("useUtility",t).set("formatList",null==n?void 0:n.formatList).set("defaultFormat",null==n?void 0:n.defaultFormat).set("layoutChoiceList",c).set("supportCustomLayout",n.supportCustomLayout||!1).set("supportReport",n.supportReport||!1).set("supportCustomReport",n.supportCustomReport||!1).setIn(["commonSetting","forceFeatureAttributes"],n.supportReport||n.supportCustomReport||!1),Promise.resolve(i)}))))}))})),R=(e,t)=>T(void 0,void 0,void 0,(function*(){var l;const o={layoutTypes:g.ServiceLayout};if((null==e?void 0:e.supportCustomLayout)&&(null==e?void 0:e.defaultCustomLayoutItem)){const n=yield j(null===(l=null==e?void 0:e.defaultCustomLayoutItem)||void 0===l?void 0:l.id,t,p.ReportTemplate),i=null==n?void 0:n[0];o.customLayoutItem=null==e?void 0:e.defaultCustomLayoutItem,o.templateInfo=i}return Promise.resolve(o)})),N=(e,t,l)=>T(void 0,void 0,void 0,(function*(){var o,n,i,r,a;if(!(null==t?void 0:t.supportCustomReport)||!(null==t?void 0:t.supportReport))return null;const s={reportTypes:b.ServiceReport};if((null==t?void 0:t.supportReport)&&(null==t?void 0:t.defaultReportTemplate)){let l;null==e||e.forEach((e=>{(null==e?void 0:e.reportTemplate)===(null==t?void 0:t.defaultReportTemplate)&&(l=null==e?void 0:e.reportOptions)})),s.report=null==t?void 0:t.defaultReportTemplate,s.reportOptions=l}if((null==t?void 0:t.supportCustomReport)&&(null==t?void 0:t.defaultCustomReportItem)){const e=yield j(null===(o=null==t?void 0:t.defaultCustomReportItem)||void 0===o?void 0:o.id,l,p.ReportTemplate),u=null===(n=null==e?void 0:e[0])||void 0===n?void 0:n.reportOptions;s.customReportItem={id:null===(i=null==t?void 0:t.defaultCustomReportItem)||void 0===i?void 0:i.id,title:(null===(r=null==e?void 0:e[0])||void 0===r?void 0:r.reportTemplate)||(null===(a=null==t?void 0:t.defaultCustomReportItem)||void 0===a?void 0:a.id)},s.reportOptions=u,s.reportTypes=b.CustomReport}return Promise.resolve(s)})),M=e=>{if(!e)return[];return e.filter((e=>function(e){if(!e)return null;let t=x.RPTX;const l=(null==e?void 0:e.reportSectionOverrides)||{};return Object.keys(l).forEach((e=>{const o=l[e];((null==o?void 0:o.fieldElements)||(null==o?void 0:o.fieldLabelElements))&&(t=x.RPTT)})),t}(null==e?void 0:e.reportOptions)===x.RPTX))},E=(e,t)=>{var l,o;if(!t)return e;const n=null===(l=null==t?void 0:t.customTextElements)||void 0===l?void 0:l.map((e=>{const t={};for(const l in e)t[l]=!0;return t})),i=P(t);return e.hasAuthorText=null==t?void 0:t.hasAuthorText,e.hasCopyrightText=null==t?void 0:t.hasCopyrightText,e.hasLegend=null==t?void 0:t.hasLegend,e.hasTitleText=null==t?void 0:t.hasTitleText,e.layoutOptions.customTextElements=(null==t?void 0:t.customTextElements)||[],e.layoutOptions.elementOverrides=i,e.customTextElementEnableList=n||[],e.enableNorthArrow=!!J(i),e.enableLegend=e.hasLegend,e.enableAuthor=e.hasAuthorText,e.enableCopyright=e.hasCopyrightText,e.enableScalebarUnit=!0,e.hasLegend&&(null==e?void 0:e.layoutOptions)&&(e.layoutOptions.legendLayers=[]),(null===(o=e.layoutOptions)||void 0===o?void 0:o.scalebarUnit)||(e.layoutOptions.scalebarUnit="Miles"),e},L=e=>{const{templateTaskInfo:t,templatesInTask:l,reportOption:o,defaultLayoutOptionInfo:n,printServiceType:i,printTemplateType:r}=e,a=l?Y(l,i,r):[];return null==a?void 0:a.map((e=>{var l;let i;if(t&&0!==(null==t?void 0:t.length)?t.forEach((t=>{e.label===t.layoutTemplate&&(i=t)})):i=d,(null==e?void 0:e.layout)&&(e.layout=F(null==e?void 0:e.layout)),(null==e?void 0:e.format)&&(e.format=null===(l=null==e?void 0:e.format)||void 0===l?void 0:l.toLowerCase()),(null==i?void 0:i.webMapFrameSize)&&(e.mapFrameSize=null==i?void 0:i.webMapFrameSize,e.mapFrameUnit=null==i?void 0:i.pageUnits),(e=E(e,null==i?void 0:i.layoutOptions)).mapFrameUnit=null==i?void 0:i.pageUnits,e.selectedFormatList=[null==e?void 0:e.format],o&&((null==o?void 0:o.customReportItem)&&(e.customReportItem=null==o?void 0:o.customReportItem),(null==o?void 0:o.report)&&(e.report=null==o?void 0:o.report),(null==o?void 0:o.reportOptions)&&(e.reportOptions=null==o?void 0:o.reportOptions),(null==o?void 0:o.reportTypes)&&(e.reportTypes=null==o?void 0:o.reportTypes)),n){(null==n?void 0:n.layoutTypes)&&(e.layoutTypes=null==n?void 0:n.layoutTypes),(null==n?void 0:n.customLayoutItem)&&(e.customLayoutItem=null==n?void 0:n.customLayoutItem);const t=null==n?void 0:n.templateInfo;t&&((null==t?void 0:t.layoutOptions)&&(e.layoutOptions=null==t?void 0:t.layoutOptions),(null==t?void 0:t.pageUnits)&&(e.mapFrameUnit=null==t?void 0:t.pageUnits),(null==t?void 0:t.webMapFrameSize)&&(e.mapFrameSize=null==t?void 0:t.webMapFrameSize))}return e}))},P=e=>{const t=(null==e?void 0:e.mapSurroundInfos)||[],l={};return null==t||t.forEach((e=>{e.type===o&&(e.visible=!0),l[e.name]=e})),l},A=(e,t)=>(null==e?void 0:e.map((e=>{e.layoutTemplate=F(null==e?void 0:e.layout);const l=$(null==e?void 0:e.layout);return null==t||t.forEach((t=>{(null==e?void 0:e.layout)===(null==t?void 0:t.layout)&&(e.mapFrameSize=null==t?void 0:t.mapFrameSize,e.mapFrameUnit=null==t?void 0:t.mapFrameUnit,e.hasAuthorText=null==t?void 0:t.hasAuthorText,e.hasCopyrightText=null==t?void 0:t.hasCopyrightText,e.hasLegend=null==t?void 0:t.hasLegend,e.hasTitleText=null==t?void 0:t.hasTitleText,!l&&(e.layoutOptions=null==t?void 0:t.layoutOptions),e.customTextElementEnableList=null==t?void 0:t.customTextElementEnableList,e.enableNorthArrow=t.enableNorthArrow,e.enableLegend=t.hasLegend,e.enableAuthor=t.hasAuthorText,e.enableCopyright=t.hasCopyrightText,e.enableScalebarUnit=!0,e.enableNorthArrow=null==t?void 0:t.enableNorthArrow)})),e})))||[],k=t=>{const l=e.UtilityManager.getInstance().getUtilityJson(t);return"org"===(null==l?void 0:l.source)?m.OrganizationService:m.Customize};var D,U=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{s(o.next(e))}catch(e){i(e)}}function a(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};!function(e){e.AsynchronousSubmit="esriExecutionTypeAsynchronous",e.SynchronousExecute="esriExecutionTypeSynchronous"}(D||(D={}));const V=(t,l)=>{let o=l;return(null==t?void 0:t.exportOptions)&&(o=o.set("exportOptions",Object.assign(Object.assign({},t.exportOptions||{}),(null==l?void 0:l.exportOptions)||{}))),(null==t?void 0:t.layoutOptions)&&(null==l?void 0:l.layoutOptions)&&(o=o.set("layoutOptions",Object.assign(Object.assign({},(null==t?void 0:t.layoutOptions)||{}),(null==l?void 0:l.layoutOptions)||{}))),(0,e.Immutable)(Object.assign(Object.assign({},t),o))},z=(e,t)=>{let l;return null==e||e.forEach(((e,o)=>{(null==e?void 0:e.templateId)===t&&(l=o)})),l},F=e=>e,$=e=>"map-only"===(e=>{var t,l;return null===(l=null===(t=null==e?void 0:e.replace(/\_/gi,"-"))||void 0===t?void 0:t.replace(/\s+/gi,"-"))||void 0===l?void 0:l.toLowerCase()})(e),W=(e,t)=>{let l=!1;return null==e||e.forEach((e=>{(null==e?void 0:e.templateId)===t&&(l=!0)})),l},G=t=>U(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))}));function B(t,l,o){return U(this,void 0,void 0,(function*(){const n={query:{"env:outSR":"","env:processSR":"",returnZ:!1,returnM:!1,returnTrueCurves:!1,returnFeatureCollection:!1,context:"",f:"json"},responseType:"json"},r=yield(a=t,T(void 0,void 0,void 0,(function*(){return e.ServiceManager.getInstance().fetchArcGISServerInfo(a).then((e=>Promise.resolve(null==e?void 0:e.owningSystemUrl)),(e=>Promise.reject(new Error(e))))})));var a;const s=r?e.SessionManager.getInstance().getSessionByUrl(r):null;if(o){const e={id:o};s&&(e.token=s.token),l===p.LayoutTemplate&&(s&&(n.query.token=s.token),n.query.Layout_Item_ID=JSON.stringify(e)),l===p.ReportTemplate&&(n.query.Report_Item_ID=JSON.stringify(e))}return function(t){return U(this,void 0,void 0,(function*(){var l;if(!t)return Promise.resolve(null);const o=`${null===(l=t.split("/GPServer"))||void 0===l?void 0:l[0]}/GPServer`,n=function(){var t,l;const o=(null===(t=(0,e.getAppStore)().getState().portalSelf)||void 0===t?void 0:t.helperServices)||{};return(null===(l=null==o?void 0:o.asyncPrintTask)||void 0===l?void 0:l.url)||null}(),r=(yield _(o))||{},{tasks:a,supportedOperations:s,executionType:u}=r;let d=u,c=null,p=null,v=null,m=null;const y=null==a?void 0:a.map((t=>function(t,l){return U(this,void 0,void 0,(function*(){if(!t||!l)return Promise.resolve(null);const o=`${l}/${t}`,n={query:{f:"json"},responseType:"json"};return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[t]=e;return t(o,n).then((e=>{var t;const l=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.name;return Promise.resolve(l)}))}))}))}(t,o).then((e=>{e===i.GetLayoutTemplatesInfo&&(c=`${o}/${t}`,p=`${c}/${s}`),e===i.GetReportTemplatesInfo&&(v=`${o}/${t}`,m=`${o}/${t}/${s}`)}))));if(yield Promise.all(y),n===t){const e=yield function(e){return U(this,void 0,void 0,(function*(){const t=`${null==e?void 0:e.split("/arcgis/")[0]}/arcgis/rest/services/Utilities/PrintingTools/GPServer`,l=(yield _(t))||{},{tasks:o,supportedOperations:n,executionType:i}=l;let r=null,a=null,s=null;return null==o||o.forEach((e=>{((null==e?void 0:e.includes("Layout"))||(null==e?void 0:e.includes("Layout")))&&(s=e)})),r=`${t}/${s}`,a=`${r}/${n}`,{layoutTemplatesInfoTaskUrl:r,layoutTemplatesInfoRequestUrl:a,executionType:i}}))}(o);c=e.layoutTemplatesInfoTaskUrl,p=e.layoutTemplatesInfoRequestUrl,d=e.executionType}return Promise.resolve({url:o,layoutTemplatesInfoTaskUrl:c,layoutTemplatesInfoRequestUrl:p,reportTemplatesInfoTaskUrl:v,reportTemplatesInfoRequestUrl:m,executionType:u,layoutTemplateTaskExecutionType:d})}))}(t).then((t=>{const{layoutTemplatesInfoRequestUrl:o,reportTemplatesInfoRequestUrl:i,reportTemplatesInfoTaskUrl:r,executionType:a,layoutTemplatesInfoTaskUrl:s,layoutTemplateTaskExecutionType:u}=t,d=l===p.ReportTemplate?i:o,c=l===p.LayoutTemplate?u:a;return d?(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[t]=e;return t(d,n).then((e=>U(this,void 0,void 0,(function*(){var o,i,a;if(c===D.AsynchronousSubmit){const i=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.jobId;return function(e,t,l,o){return U(this,void 0,void 0,(function*(){const n=`${e}/jobs/${t}/results/Output_JSON`;return new Promise(((e,t)=>{let i=0;const r=10,a=3e3,s=()=>{o(n,l).then((t=>{var l;(null===(l=null==t?void 0:t.data)||void 0===l?void 0:l.value)?e(t.data.value):(i++,i<r?setTimeout(s,a):e([]))})).catch((e=>{t(new Error(e))}))};s()}))}))}(l===p.ReportTemplate?r:s,i,n,t)}return Promise.resolve((null===(a=null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.results[0])||void 0===a?void 0:a.value)||[])}))),(e=>Promise.reject(new Error(e)))).catch((e=>Promise.reject(new Error(e))))})):Promise.resolve(null)}))}))}function _(t){return U(this,void 0,void 0,(function*(){var l;if(!t)return Promise.resolve(null);const o=`${null===(l=t.split("/GPServer"))||void 0===l?void 0:l[0]}/GPServer`,n={query:{f:"json"},responseType:"json"};return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[t]=e;return t(o,n).then((e=>{var t,l;const o=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.tasks,n=null===(l=null==e?void 0:e.data)||void 0===l?void 0:l.executionType,i=n===D.SynchronousExecute?"execute":"submitJob";return Promise.resolve({tasks:o,supportedOperations:i,executionType:n})}))}))}))}function J(e={}){var t;let l=null;for(const n in e)(null===(t=null==e?void 0:e[n])||void 0===t?void 0:t.type)===o&&(l=n);return l}function q(e,t){const l=H(e,t),{reportsAvailable:o,elementOverridesAvailable:n}=l;return o&&n}function H(e,t){var l;const{defaultCustomReportItem:o,defaultReportTemplate:n,supportCustomReport:i,supportReport:r}=t,a=function(e){const{reportOptions:t,defaultCustomReportItem:l,defaultReportTemplate:o,supportCustomReport:n,supportReport:i,reportTypes:r}=e;if(!n&&!i)return!0;switch(r){case b.CustomReport:return t?Q(t):!l&&!o;case b.ServiceReport:return t?Q(t):!o}}({defaultCustomReportItem:o,defaultReportTemplate:n,supportCustomReport:i,supportReport:r,reportOptions:null==e?void 0:e.reportOptions,reportTypes:null==e?void 0:e.reportTypes});return{reportsAvailable:a,elementOverridesAvailable:function(e){if(!e)return!0;let t=!0;for(const l in e){const o=e[l];if(o.visible&&("CIMTableFrame"===o.type||"CIMGraphicElement"===o.type)){const e=null==o?void 0:o.exbDataSource;e&&0!==(null==e?void 0:e.length)||(t=!1)}}return t}(null===(l=null==e?void 0:e.layoutOptions)||void 0===l?void 0:l.elementOverrides)}}function Q(e){if(!(null==e?void 0:e.reportSectionOverrides))return!1;const t=(null==e?void 0:e.reportSectionOverrides)||{};let l=!0;return Object.keys(t).forEach(((e,o)=>{var n,i;const r=t[e];if((null==r?void 0:r.exbDatasource)&&0!==(null===(n=null==r?void 0:r.exbDatasource)||void 0===n?void 0:n.length)){const e=X()||[],t=null===(i=null==r?void 0:r.exbDatasource)||void 0===i?void 0:i[0],o=(null==t?void 0:t.rootDataSourceId)||(null==t?void 0:t.mainDataSourceId);(null==e?void 0:e.includes(o))||(l=!1)}else l=!1})),l}const X=()=>{var t;const l=(0,e.getAppStore)().getState(),o=(null==l?void 0:l.appStateInBuilder)?null===(t=null==l?void 0:l.appStateInBuilder)||void 0===t?void 0:t.appConfig:null==l?void 0:l.appConfig,n=null==o?void 0:o.dataSources,i=[];return Object.keys(n).forEach((t=>{const l=n[t];(null==l?void 0:l.type)!==e.DataSourceTypes.WebScene&&i.push(l.id)})),i.length>0?(0,e.Immutable)(i):void 0},Z=(e,t)=>{if(e&&0!==(null==e?void 0:e.length)&&t){let l=!0;const o=K(null==t?void 0:t[0])||[],n=null==e?void 0:e[0],i=(null==n?void 0:n.rootDataSourceId)||(null==n?void 0:n.mainDataSourceId);return(null==o?void 0:o.includes(i))||(l=!1),l}return!0},K=t=>{var l,o,n;const i=(0,e.getAppStore)().getState(),r=(null==i?void 0:i.appStateInBuilder)?null===(l=null==i?void 0:i.appStateInBuilder)||void 0===l?void 0:l.appConfig:null==i?void 0:i.appConfig,a=null===(o=null==r?void 0:r.widgets)||void 0===o?void 0:o[t],s=[],u=e.DataSourceManager.getInstance();return null===(n=null==a?void 0:a.useDataSources)||void 0===n||n.forEach((t=>{const l=u.getDataSource(t.dataSourceId);(null==l?void 0:l.type)===e.DataSourceTypes.WebMap&&s.push(t.dataSourceId)})),s.length>0?(0,e.Immutable)(s):void 0},Y=(t,l,o)=>{const n=t.map((t=>{var l;let o=(0,e.Immutable)(t);return o=o.set("layout",F(null==t?void 0:t.layout)),o=o.setIn(["layoutOptions","scalebarUnit"],"Miles").setIn(["layoutOptions","legendLayers"],null),o=o.set("reportTypes",b.ServiceReport).set("layoutTypes",g.ServiceLayout),$(null==o?void 0:o.layout)&&(o=o.set("exportOptions",Object.assign({width:800,height:1100},null==t?void 0:t.exportOptions))),null===(l=V((0,e.Immutable)(c),(0,e.Immutable)(o)))||void 0===l?void 0:l.asMutable({deep:!0})}));return ee(n,l,o)},ee=(e,t,l)=>{const o=((e,t)=>e===m.Customize||t===y.Customize?"custom":"org")(t,l);return e.map(((e,t)=>(e.templateId=`config_${o}_${t}`,e)))};function te(t){const l={query:{f:"json"},responseType:"json"};return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[o]=e;return o(t,l).then((e=>function(e){return U(this,void 0,void 0,(function*(){let t=!1,l=!1;const o=(null==e?void 0:e.parameters)||[],n="web_map_as_json",i="output_file",r="layout_item_id",a="layout_template",s="report_template",u="report_item_id";let d=[],c=[],p="pdf",v=!1,m=!1,y=!1,f="",h="",g="",x="";return null==o||o.forEach((e=>{var t,l;if("Format"===e.name){const o=(null===(t=null==e?void 0:e.choiceList)||void 0===t?void 0:t.map((e=>null==e?void 0:e.toLowerCase())))||[];if(e.defaultValue)p=null===(l=e.defaultValue)||void 0===l?void 0:l.toLowerCase();else if((null==o?void 0:o.length)>0){const e=[];null==o||o.forEach((t=>{(t.include("pdf")||t.include("png"))&&e.push(t)})),p=(null==e?void 0:e[0])||o[0]}c=o}})),null==o||o.forEach((e=>{if("Layout_Template"===e.name){const t=e.choiceList,l=e.defaultValue;t?d=null==t?void 0:t.map((e=>ne(e,c,p))):d.push(ne(l,c,p))}e.name.toLowerCase()===a&&(f=(null==e?void 0:e.defaultValue)||""),e.name.toLowerCase()===r&&(v=!0,h=null==e?void 0:e.defaultValue),e.name.toLowerCase()===s&&(y=!0,g=(null==e?void 0:e.defaultValue)||""),e.name.toLowerCase()===u&&(m=!0,x=null==e?void 0:e.defaultValue),"string"==typeof e.name&&e.name.toLowerCase()===n&&(t=!0),"string"==typeof e.name&&e.name.toLowerCase()===i&&(l=!0)})),Promise.resolve({templates:d,formatList:c,defaultFormat:p,defaultReportTemplate:g,defaultCustomReportItem:x,hasWebmapParam:t,hasOutputParam:l,supportCustomLayout:v,supportReport:y,supportCustomReport:m,defaultLayout:f,defaultCustomLayoutItem:h})}))}(null==e?void 0:e.data)))}))}function le(t,l,o){var n,i,r,a;const s=e.UtilityManager.getInstance().utilityHasSignInError(t);let u=404===(null===(n=null==o?void 0:o.details)||void 0===n?void 0:n.httpStatus);400===(null===(i=null==o?void 0:o.details)||void 0===i?void 0:i.httpStatus)&&(null===(a=null===(r=null==o?void 0:o.details)||void 0===r?void 0:r.message)||void 0===a?void 0:a.includes("Item does not exist"))&&(u=!0),s||u?(l&&l(!0),e.UtilityManager.getInstance().reportUtilityState(t,!1,s)):(l&&l(!1),e.UtilityManager.getInstance().reportUtilityState(t,!0))}function oe(t){const l=e.DataSourceManager.getInstance().getDataSource(t);return l&&l.supportSpatialInfo&&!l.supportSpatialInfo()}function ne(e,t,l){const o=$(e)?{}:{layoutOptions:{legend:!1}},n=l||t[0]||"PNG32";return Object.assign({label:e,layout:e,format:n},o)}var ie=r(30655),re=r.n(ie),ae=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(l[o[n]]=e[o[n]])}return l};const se=t=>{const l=window.SVG,{className:o}=t,n=ae(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:i,src:re()},n)):e.React.createElement("svg",Object.assign({className:i},n))};var ue=r(94064),de=r.n(ue),ce=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(l[o[n]]=e[o[n]])}return l};const pe=t=>{const l=window.SVG,{className:o}=t,n=ce(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:i,src:de()},n)):e.React.createElement("svg",Object.assign({className:i},n))};var ve=r(29435),me=r.n(ve),ye=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(l[o[n]]=e[o[n]])}return l};const fe=t=>{const l=window.SVG,{className:o}=t,n=ye(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:i,src:me()},n)):e.React.createElement("svg",Object.assign({className:i},n))},he=t=>{const{label:l,className:o,children:n,flowWrap:i}=t,r=e.css`
    .title {
      font-size: 14px;
    }
  `;return(0,e.jsx)("div",{className:(0,e.classNames)("mb-2 align-items-center",{className:o,"d-flex":!i}),css:r},(0,e.jsx)("div",{className:(0,e.classNames)("title flex-grow-1",{"mb-2":i})},l),n)};var ge=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{s(o.next(e))}catch(e){i(e)}}function a(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};const xe=(e,t)=>{let l=1,o=e;return t.forEach((n=>{o===(null==n?void 0:n.title)&&(o=`${e} (${l})`,l++,xe(o,t))})),o},be=e=>{const t=(e=>{var t;return e?null===(t=null==e?void 0:e.asMutable())||void 0===t?void 0:t.map((e=>e.resultId)):[]})(e);if(!t||0===(null==t?void 0:t.length))return"result_0";return`config_${we(t)+1}`},we=e=>{var t;if(!e||0===(null==e?void 0:e.length))return 0;const l=null==e?void 0:e.map((e=>{var t;const l=null===(t=null==e?void 0:e.split("_"))||void 0===t?void 0:t.pop();return l?Number(l):0}));return null===(t=null==l?void 0:l.sort(((e,t)=>t-e)))||void 0===t?void 0:t[0]};function Se(e,t){return"print-extents-layer-"+e+"-"+t}function Ie(e,t){return`exb-print-layer-${t}-${e}`}function Te(e){return ge(this,void 0,void 0,(function*(){if(e)return(0,l.loadArcGISJSAPIModules)(["esri/kernel"]).then((([t])=>G(e).then((e=>{const l=t.id.findCredential(e);return Promise.resolve(null==l?void 0:l.token)}))))}))}function Oe(e,t,l,o,n,i){!function(e,t,l,o){var n;if(!(t&&e&&o&&l&&0!==(null===(n=Object.keys(e))||void 0===n?void 0:n.length)))return;Object.keys(e).forEach((n=>{const i=e[n];je(null==i?void 0:i.exbDataSource,t,l,o)}))}(e,l,o,n),i&&function(e,t,l,o){if(!(e&&t&&o&&l))return;const n=(null==t?void 0:t.reportSectionOverrides)||{};Object.keys(n).forEach((t=>ge(this,void 0,void 0,(function*(){const i=n[t];je(null==i?void 0:i.exbDatasource,e,l,o)}))))}(l,t,o,n)}function je(e,t,l,o){return ge(this,void 0,void 0,(function*(){var n;if((null==e?void 0:e.length)>0){const i=Z(e,o),r=null===(n=null==e?void 0:e[0])||void 0===n?void 0:n.dataSourceId;if(!i&&t){if(oe(r)){const e=yield Ne(r,l);t.view.map.tables.remove(e)}else{const e=Ie(r,l);t.view.map.findLayerById(e)&&t.removeLayerFromMap(e)}}}}))}function Ce(t,l,o,n,i){return ge(this,void 0,void 0,(function*(){return yield Promise.all(Object.keys(t).map((r=>ge(this,void 0,void 0,(function*(){const a=function(t){var l,o;const n=null==t?void 0:t.exbDataSource;if((null==n?void 0:n.length)>0){const i=null===(l=null==n?void 0:n[0])||void 0===l?void 0:l.dataSourceId,r=e.DataSourceManager.getInstance().getDataSource(i).getSelectedRecordIds();if((null==r?void 0:r.length)>0)if(null==t?void 0:t.dynamicTextElements){const e=null===(o=t.dynamicTextElements)||void 0===o?void 0:o.map((e=>(e.filterType="selected",e)));t.dynamicTextElements=e}else t.filterType="selected";return t}return t}(t[r]),s=null==a?void 0:a.exbDataSource;if((null==s?void 0:s.length)>0){const e=yield Re(s,l,o,n);if("CIMGraphicElement"===a.type&&(null==a?void 0:a.dynamicTextElements)){const t=null==a?void 0:a.dynamicTextElements,l=null==t?void 0:t.map((t=>(t.sourceLayerId=e,t)));a.dynamicTextElements=l}else t[r].sourceLayerId=e;delete t[r].exbDataSource,delete t[r].isDsOutputDs}"CIMLegend"===a.type&&(t[r].visible=i)}))))),Promise.resolve(t||{})}))}function Re(t,o,n,i){return ge(this,void 0,void 0,(function*(){var r,a;const s=Z(t,n),u=null===(r=null==t?void 0:t[0])||void 0===r?void 0:r.dataSourceId;let d;if(s){d=(null===(a=e.DataSourceManager.getInstance().getDataSource(u).layer)||void 0===a?void 0:a.id)||""}else d=Ie(u,i),o&&!function(e,t){var l,o,n;const i=t.getAllJimuLayerViews().map((e=>{var t;return null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.id}))||[],r=(null===(n=null===(o=null===(l=t.view.map)||void 0===l?void 0:l.tables)||void 0===o?void 0:o.toArray())||void 0===n?void 0:n.map((e=>null==e?void 0:e.id)))||[];return i.concat(r).includes(e)}(d,o)&&(yield function(t,o,n){return ge(this,void 0,void 0,(function*(){const i=Ie(o,n);if(t){const r=t.view.map.findLayerById(i),a=function(t){var l,o;return null===(o=null===(l=e.DataSourceManager.getInstance().getDataSource(t))||void 0===l?void 0:l.getDataSourceJson())||void 0===o?void 0:o.isOutputFromWidget}(o);if(!function(t){var l;const o=null===(l=e.DataSourceManager.getInstance().getDataSource(t))||void 0===l?void 0:l.getStatus();return o!==e.DataSourceStatus.NotCreated&&o!==e.DataSourceStatus.CreateError&&o!==e.DataSourceStatus.LoadError&&o!==e.DataSourceStatus.SaveError&&o!==e.DataSourceStatus.NotReady}(o))return;let s;const u=oe(o);if(r&&a)s=t.getJimuLayerViewByAPILayer(r);else if(u){const e=yield Ne(o,n),l=function(e,t){const l=e.view.map.tables.map((e=>e.id));return l.includes(null==t?void 0:t.id)}(t,e);l||t.view.map.tables.add(e)}else s=yield t.addLayerToMap(o,i);s&&(yield t.whenJimuLayerViewLoaded(s.id),s.layer.opacity=0,yield function(e,t){return ge(this,void 0,void 0,(function*(){var o,n,i,r;if(!(null===(n=null===(o=e.layer)||void 0===o?void 0:o.customParameters)||void 0===n?void 0:n.moveFeaturesToCenterWhenPrinting))return;const a=yield null===(i=null==e?void 0:e.layer)||void 0===i?void 0:i.queryFeatures({returnGeometry:!0}),s=(null==a?void 0:a.features)||[];if(0===s.length)return;const u=null===(r=t.view.extent)||void 0===r?void 0:r.center,d=null==e?void 0:e.layer;if("point"===d.geometryType){const[e]=yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic"]),o={type:"point",x:u.x,y:u.y,spatialReference:t.view.spatialReference},n=s.map((t=>new e({attributes:(null==t?void 0:t.attributes)||{},geometry:o})));yield d.applyEdits({updateFeatures:n})}else if("polyline"===d.geometryType){const[e,o]=yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polyline"]),n=new o({hasZ:!1,hasM:!1,paths:[[[t.view.extent.center.x,t.view.extent.center.y],[t.view.extent.center.x+5,t.view.extent.center.y+5]]],spatialReference:t.view.spatialReference}),i=s.map((t=>new e({attributes:(null==t?void 0:t.attributes)||{},geometry:n})));yield d.applyEdits({updateFeatures:i})}else if("polygon"===d.geometryType){const[e,o]=yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polygon"]),n=new o({hasZ:!1,hasM:!1,rings:[[[t.view.extent.xmin,t.view.extent.ymin],[t.view.extent.xmin,t.view.extent.ymax],[t.view.extent.xmax,t.view.extent.ymax],[t.view.extent.xmin,t.view.extent.ymin]]],spatialReference:t.view.spatialReference}),i=s.map((t=>new e({attributes:(null==t?void 0:t.attributes)||{},geometry:n})));yield d.applyEdits({updateFeatures:i})}}))}(s,t),yield s.whenCurrentLayerViewNotUpdating(),yield function(e,t){return ge(this,void 0,void 0,(function*(){var o,n,i;if(!(null===(o=null==e?void 0:e.view)||void 0===o?void 0:o.queryFeatureCount)||!(null==e?void 0:e.whenCurrentLayerViewNotUpdating))return!1;yield e.whenCurrentLayerViewNotUpdating();const r=null===(n=null==t?void 0:t.view)||void 0===n?void 0:n.extent,a=null==e?void 0:e.layer,s=yield null===(i=null==e?void 0:e.layer)||void 0===i?void 0:i.queryFeatureCount({geometry:r});if(0===s&&"point"===a.geometryType){const e={type:"point",x:t.view.extent.center.x,y:t.view.extent.center.y,spatialReference:t.view.spatialReference},o={},n=new Date;o[a.objectIdField]=n.getTime(),yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic"]).then((([t])=>{const l=new t({geometry:e,attributes:o});return a.applyEdits({addFeatures:[l]}).then((()=>Promise.resolve(!0)))}))}else if(0===s&&"polyline"===a.geometryType){const e={},o=new Date;e[a.objectIdField]=o.getTime(),yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polyline"]).then((([l,o])=>{const n=new l({geometry:new o({hasZ:!1,hasM:!1,paths:[[[t.view.extent.center.x,t.view.extent.center.y],[t.view.extent.center.x+5,t.view.extent.center.y+5]]],spatialReference:t.view.spatialReference}),attributes:e});return a.applyEdits({addFeatures:[n]}).then((()=>Promise.resolve(!0)))}))}else{if(0!==s||"polygon"!==a.geometryType)return Promise.resolve(!0);{const e={},o=new Date;e[a.objectIdField]=o.getTime(),yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polygon"]).then((([l,o])=>{const n=new l({geometry:new o({hasZ:!1,hasM:!1,rings:[[[t.view.extent.xmin,t.view.extent.ymin],[t.view.extent.xmin,t.view.extent.ymax],[t.view.extent.xmax,t.view.extent.ymax],[t.view.extent.xmin,t.view.extent.ymin]]],spatialReference:t.view.spatialReference}),attributes:e});return a.applyEdits({addFeatures:[n]}).then((()=>Promise.resolve(!0)))}))}}}))}(s,t),yield s.whenCurrentLayerViewNotUpdating())}}))}(o,u,i));return Promise.resolve(d)}))}function Ne(t,l){return ge(this,void 0,void 0,(function*(){const o=Ie(t,l),n=e.DataSourceManager.getInstance().getDataSource(t),i=yield n.createJSAPILayerByDataSource();return i.id=o,i.opacity=0,i}))}function Me(e){return ge(this,void 0,void 0,(function*(){var t,o,n,i,r,a,u;const{printTemplateProperties:d,mapView:c,locale:p,utility:v,isSupportReport:m,useMapWidgetIds:y,widgetId:f}=e;try{const e=!1===(null==d?void 0:d.hasTitleText),u=!1===(null==d?void 0:d.hasLegend);let h=d.without("enableTitle","enableAuthor","enableOutputSpatialReference","enableMapPrintExtents","enableQuality","enableMapSize","enableFeatureAttribution","enableCopyright","enableLegend","enableMapAttribution","enableCustomTextElements","hasAuthorText","hasCopyrightText","hasLegend","hasTitleText","selectedFormatList","mapFrameSize","mapFrameUnit","legendEnabled","templateId","printExtentType","customTextElementEnableList");switch(null==d?void 0:d.printExtentType){case s.CurrentMapExtent:h=h.set("scalePreserved",!1);break;case s.CurrentMapScale:h=h.set("outScale",null===(t=null==c?void 0:c.view)||void 0===t?void 0:t.scale).set("scalePreserved",!0);break;case s.SetMapScale:h=h.set("scalePreserved",!0)}let x=null==h?void 0:h.asMutable({deep:!0});e&&(null===(o=null==x?void 0:x.layoutOptions)||void 0===o||delete o.titleText),u&&(null===(n=null==x?void 0:x.layoutOptions)||void 0===n||delete n.legendLayers);const w=null===(i=null==d?void 0:d.layoutOptions)||void 0===i?void 0:i.legendLayers;if(x.layoutOptions.legendLayers=w?null:[],d.layoutTypes!==g.CustomLayout&&d.reportTypes!==b.CustomReport||(x=yield function(e,t){return ge(this,void 0,void 0,(function*(){const o=e;return(0,l.loadArcGISJSAPIModules)(["esri/portal/PortalItem"]).then((l=>{const[n]=l;return O(t).then((t=>{var l,i;if(e.layoutTypes===g.CustomLayout&&(null===(l=e.customLayoutItem)||void 0===l?void 0:l.id)){const l=new n({id:e.customLayoutItem.id,portal:t});o.layoutItem=l}if(e.reportTypes===b.CustomReport&&(null===(i=e.customReportItem)||void 0===i?void 0:i.id)){const l=new n({id:e.customReportItem.id,portal:t});o.reportItem=l}return delete o.customLayoutItem,delete o.customReportItem,delete o.layoutTypes,delete o.reportTypes,Promise.resolve(o)}))}),(e=>Promise.resolve(o))).catch((e=>Promise.resolve(o)))}))}(x,v)),m){const e=yield function(e,t,l,o){return ge(this,void 0,void 0,(function*(){const n=(null==e?void 0:e.reportSectionOverrides)||{};return yield Promise.all(Object.keys(n).map((e=>ge(this,void 0,void 0,(function*(){var i;const r=n[e];if((null===(i=null==r?void 0:r.exbDatasource)||void 0===i?void 0:i.length)>0){const i=yield Re(null==r?void 0:r.exbDatasource,t,l,o);n[e].sourceId=i,delete n[e].exbDatasource}}))))),e&&(e.reportSectionOverrides=n),Promise.resolve(e||{})}))}(null==x?void 0:x.reportOptions,c,y,f);x.reportOptions=e}const S=(null===(r=null==x?void 0:x.layoutOptions)||void 0===r?void 0:r.elementOverrides)||{};if((null===(a=Object.keys(S))||void 0===a?void 0:a.length)>0){const e=yield Ce(S,c,y,f,!!w);x.layoutOptions.elementOverrides=e}return x=function(e,t){var l;const o=(null===(l=e.layoutOptions)||void 0===l?void 0:l.customTextElements)||[];let n=!1;o.forEach((e=>{e.date&&(n=!0)})),n||o.push({Date:(new Date).toLocaleString(t)});return e.layoutOptions.customTextElements=o,e}(x,p),Promise.resolve(x)}catch(e){return console.error(e),Oe(null===(u=null==d?void 0:d.layoutOptions)||void 0===u?void 0:u.elementOverrides,null==d?void 0:d.reportOptions,c,f,y,m),Promise.resolve(null)}}))}function Ee(e,t,l){const o=Le(l);return e/(t?o.XDPI:o.YDPI)*2.54/100}function Le(e){return e?{XDPI:e,YDPI:e}:function(){const e={XDPI:null,YDPI:null},t=window.screen;if(null==t?void 0:t.XDPI)e.XDPI=null==t?void 0:t.deviceXDPI,e.YDPI=null==t?void 0:t.deviceYDPI;else{const t=document.createElement("div");t.style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden",document.body.appendChild(t),e.XDPI=t.offsetWidth,e.YDPI=t.offsetHeight,t.parentNode.removeChild(t)}return e}()}var Pe=r(1888);const{useState:Ae,useEffect:ke,useRef:De}=e.React,Ue=l=>{var o,i,r,a;const{jimuMapView:d,id:c,selectedTemplate:p,className:v,config:m}=l,y=e.hooks.useTranslation(I,t.defaultMessages),f=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.widgetsRuntimeInfo)||void 0===t?void 0:t[c]})),h=De(null),g=De(null),x=De(null),b=De(null===(o=null==d?void 0:d.view)||void 0===o?void 0:o.extent),w=De(null===(i=null==d?void 0:d.view)||void 0===i?void 0:i.scale),S=e.css`
    .checkbox-con {
      color: var(--ref-palette-neutral-1100);
      font-size: ${e.polished.rem(14)};
      line-height: ${e.polished.rem(22)};
      margin: ${e.polished.rem(4)} 0 ${e.polished.rem(8)} 0;
    }
  `,[T,O]=Ae(!1),[j,C]=Ae(null===(r=null==d?void 0:d.view)||void 0===r?void 0:r.extent),[R,N]=Ae(null===(a=null==d?void 0:d.view)||void 0===a?void 0:a.scale);ke((()=>{(null==f?void 0:f.controllerWidgetId)&&T&&((null==f?void 0:f.state)!==e.WidgetState.Opened?W():L())}),[f]),ke((()=>(x.current=e.lodash.debounce(L,400),(0,e.loadArcGISJSAPIModules)(["esri/layers/GraphicsLayer","esri/Graphic","esri/geometry/Polygon","esri/geometry/Extent","esri/geometry/Point","esri/geometry/support/WKIDUnitConversion"]).then((e=>{h.current=e})),W)),[]),ke((()=>{var e,t,l,o,n,i;const r=(null==p?void 0:p.templateId)!==(null===(e=g.current)||void 0===e?void 0:e.templateId),a=(null==p?void 0:p.printExtentType)!==(null===(t=g.current)||void 0===t?void 0:t.printExtentType),s=(null==p?void 0:p.outScale)!==(null===(l=g.current)||void 0===l?void 0:l.outScale),u=(null===(o=null==p?void 0:p.exportOptions)||void 0===o?void 0:o.dpi)!==(null===(i=null===(n=g.current)||void 0===n?void 0:n.exportOptions)||void 0===i?void 0:i.dpi),d=M();g.current=p,T&&(r||a||s||d||u)&&x.current()}),[p]),ke((()=>{T&&j&&x.current()}),[j,R,m.previewBackgroundColor,m.previewOutLine]),ke((()=>{var t,l;d?(E(),C((0,e.Immutable)(JSON.parse(JSON.stringify(null===(l=null===(t=null==d?void 0:d.view)||void 0===t?void 0:t.extent)||void 0===l?void 0:l.toJSON()))))):C(null)}),[d]);const M=()=>{var e,t,l,o,n,i;if(!$(null==p?void 0:p.layout))return!1;const r=(null===(e=null==p?void 0:p.exportOptions)||void 0===e?void 0:e.width)!==(null===(l=null===(t=g.current)||void 0===t?void 0:t.exportOptions)||void 0===l?void 0:l.width),a=(null===(o=null==p?void 0:p.exportOptions)||void 0===o?void 0:o.height)!==(null===(i=null===(n=g.current)||void 0===n?void 0:n.exportOptions)||void 0===i?void 0:i.height);return r||a},E=()=>{var t,l;null===(t=null==d?void 0:d.view)||void 0===t||t.watch("extent",(t=>{const l=JSON.parse(JSON.stringify(t.toJSON()));C((0,e.Immutable)(l)),b.current=t})),null===(l=null==d?void 0:d.view)||void 0===l||l.watch("scale",(e=>{N(e),w.current=e}))},L=e.hooks.useEventCallback((()=>{var e;const t=F(),l=h.current[1],o=(null==m?void 0:m.previewOutLine)||n,i=(null==m?void 0:m.previewBackgroundColor)||"rgba(0,216,237,0.3)",r=new l({geometry:(null===(e=g.current)||void 0===e?void 0:e.printExtentType)===s.CurrentMapExtent?k():A(),symbol:{type:"simple-fill",color:P(i),outline:{color:P(o.color,1),width:o.size}}});t.graphics.removeAll(),t.graphics.add(r)})),P=(t,l=.3)=>{if(!t)return null;let o;if(t.includes("var(")||t.includes("#")){const n=(0,Pe.getThemeColorValue)(t,(0,Pe.getAppThemeVariables)());o=e.polished.rgba(n,l)}if(t.includes("rgba")){const n=t.split("(")[1].split(")")[0].split(","),i=n[n.length-1];o=Number(i)>.6?e.polished.rgba(t,l):t}return o},A=()=>{var e,t,l,o,n;const{mapFrameSize:i,mapFrameUnit:r,layout:a}=null===(e=g.current)||void 0===e?void 0:e.asMutable({deep:!0}),u=z(),d=V(r),c=h.current[2],p=$(a),v=null===(t=null==b?void 0:b.current)||void 0===t?void 0:t.center,m=(null===(l=g.current)||void 0===l?void 0:l.printExtentType)===s.SetMapScale?null===(o=g.current)||void 0===o?void 0:o.outScale:w.current,y=p?U():{width:i[0],height:i[1]},f={x:p?1:d.x/(null==u?void 0:u.x),y:p?1:d.y/(null==u?void 0:u.y)},x={x:y.width,y:y.height},S=(null==v?void 0:v.x)-(null==x?void 0:x.x)/2*m*(null==f?void 0:f.x),I=(null==v?void 0:v.y)-(null==x?void 0:x.y)/2*m*(null==f?void 0:f.y),T=(null==v?void 0:v.x)+(null==x?void 0:x.x)/2*m*(null==f?void 0:f.x),O=(null==v?void 0:v.y)+(null==x?void 0:x.y)/2*m*(null==f?void 0:f.y),j=[[S,I],[S,O],[T,O],[T,I],[S,I]],C=new c({spatialReference:null===(n=null==b?void 0:b.current)||void 0===n?void 0:n.spatialReference});return C.addRing(j),C},k=()=>{var t,l,o,n,i,r;const a=h.current[3],{mapFrameSize:s,layout:u,exportOptions:c}=null===(t=g.current)||void 0===t?void 0:t.asMutable({deep:!0}),p=$(u),v=h.current[2];let m=(0,e.Immutable)(null===(l=b.current)||void 0===l?void 0:l.toJSON());const y=(null===(o=null==d?void 0:d.view)||void 0===o?void 0:o.width)/(null===(n=null==d?void 0:d.view)||void 0===n?void 0:n.height),f=p?(null==c?void 0:c.width)/(null==c?void 0:c.height):s[0]/s[1],x=(null==m?void 0:m.height)||(null===(i=null==d?void 0:d.view)||void 0===i?void 0:i.height),w=(null==m?void 0:m.width)||(null===(r=null==d?void 0:d.view)||void 0===r?void 0:r.width);if(y>f){const e=w/f,t=D(!1,e/x);m=m.set("height",e).set("ymin",null==t?void 0:t.mim).set("ymax",null==t?void 0:t.max)}else if(y<f){const e=x*f,t=D(!0,e/w);m=m.set("width",e).set("xmin",null==t?void 0:t.mim).set("xmax",null==t?void 0:t.max)}const S=new a({xmax:null==m?void 0:m.xmax,xmin:null==m?void 0:m.xmin,ymax:null==m?void 0:m.ymax,ymin:null==m?void 0:m.ymin,zmax:null==m?void 0:m.zmax,zmin:null==m?void 0:m.zmin,spatialReference:null==m?void 0:m.spatialReference});return v.fromExtent(S)},D=(e,t)=>{var l,o;const n=null===(l=b.current)||void 0===l?void 0:l.toJSON(),i=null===(o=null==b?void 0:b.current)||void 0===o?void 0:o.center,r=(e?(null==n?void 0:n.xmax)-(null==n?void 0:n.xmin):(null==n?void 0:n.ymax)-(null==n?void 0:n.ymin))*t;return{max:e?(null==i?void 0:i.x)+r/2:(null==i?void 0:i.y)+r/2,mim:e?(null==i?void 0:i.x)-r/2:(null==i?void 0:i.y)-r/2}},U=()=>{var e;const{exportOptions:t}=null===(e=g.current)||void 0===e?void 0:e.asMutable({deep:!0}),l=z();return{width:Ee(null==t?void 0:t.width,!0,null==t?void 0:t.dpi)*(null==l?void 0:l.x),height:Ee(null==t?void 0:t.height,!1,null==t?void 0:t.dpi)*(null==l?void 0:l.y)}},V=e=>{switch(null==e?void 0:e.toUpperCase()){case u.Centimeter:return{x:.01,y:.01};case u.Inch:return{x:.0254,y:.0254};case u.Millimeter:return{x:.001,y:.001};case u.Point:return{x:.0254/72,y:.0254/72};default:return{x:NaN,y:NaN}}},z=()=>{var e;const t=h.current[5];let l,o;const n=null===(e=null==b?void 0:b.current)||void 0===e?void 0:e.spatialReference;n&&(l=n.wkid,o=n.wkt);let i=null;if(l)i=t.values[t[l]];else if(o&&-1!==o.search(/^PROJCS/i)){const e=/UNIT\[([^\]]+)\]\]$/i.exec(o);e&&e[1]&&(i=parseFloat(e[1].split(",")[1]))}return{x:i,y:i}},F=()=>{var e;let t=null;const l=h.current[0],o=Se(c,d.id);return(null===(e=d.view)||void 0===e?void 0:e.map)&&(t=d.view.map.findLayerById(o),t||(t=new l({id:o,listMode:"hide",title:o}),d.view.map.add(t))),t},W=()=>{var e,t;if(G()&&d.view||!p){const l=Se(c,null==d?void 0:d.id),o=null===(t=null===(e=null==d?void 0:d.view)||void 0===e?void 0:e.map)||void 0===t?void 0:t.findLayerById(l);o&&o.graphics.removeAll()}},G=()=>!!$(null==p?void 0:p.layout)||!!(null==p?void 0:p.mapFrameSize);return(0,e.jsx)("div",{className:v,css:S},G()&&(0,e.jsx)("div",{title:y("showPrintArea"),className:"d-flex w-100 align-items-center checkbox-con",onClick:()=>{O(!T),T?W():L()}},(0,e.jsx)(t.Checkbox,{title:y("showPrintArea"),className:"lock-item-ratio","data-field":"mapSize",checked:T}),(0,e.jsx)("div",{className:"text-left ml-2 text-truncate"},y("showPrintArea"))))},Ve=e.css`
  & .alert-panel {
    background: none !important;
    border: none !important;
    padding: 0 !important;
  }
`,ze=l=>{const o=e.hooks.useTranslation(t.defaultMessages),{supportReport:n,supportCustomReport:i,outputDataSourceWarning:r}=l;return(0,e.jsx)("div",{css:Ve},(n||i)&&!!(null==r?void 0:r.label)&&(0,e.jsx)(he,null,(0,e.jsx)(t.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,text:o("outputDataIsNotGenerated",{outputDsLabel:null==r?void 0:r.label,sourceWidgetName:null==r?void 0:r.widgets})})))};var Fe=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{s(o.next(e))}catch(e){i(e)}}function a(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};const $e=new(0,e.esri.Sanitizer),{useState:We,useEffect:Ge,useRef:Be}=e.React,_e=l=>{var o,n,i,r,a,u,d,c;const p=e.hooks.useTranslation(I,t.defaultMessages,e.defaultMessages),v=Be(null),m=Be(null),y=Be(!1),f=e.css`
    padding-bottom: ${e.polished.rem(16)};
    padding-top: ${e.polished.rem(16)};
    .setting-con {
      overflow-y: auto;
      padding-left: ${e.polished.rem(16)};
      padding-right: ${e.polished.rem(16)};
    }
    .print-button-con {
      padding-left: ${e.polished.rem(16)};
      padding-right: ${e.polished.rem(16)};
    }
    .no-right-padding .jimu-interactive-node{
      padding-right: 0;
    }
    .scalebar-unit {
      width: ${e.polished.rem(160)};
    }
    .map-size-con input {
      width: 100%;
    }
    .wkid-describtion {
      font-size: ${e.polished.rem(12)};
      color: var(--ref-palette-neutral-900);
    }
    .wkid-describtion-invalid {
      color: var(--sys-color-error-dark)
    }
    .outscale-con, .dpi-con {
      input {
        border-right: 0;
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
      }
      button {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
        height: ${e.polished.rem(26)};
        svg {
          margin-right: 0;
        }
      }
    }
    .radio-con, .checkbox-con {
      color: var(--ref-palette-neutral-1100);
      font-size: ${e.polished.rem(14)};
      line-height: ${e.polished.rem(22)};
      margin: ${e.polished.rem(4)} 0 ${e.polished.rem(8)} 0;
    }
  `,{templateList:g,jimuMapView:x,selectedTemplate:b,id:w,config:S,outputDataSourceWarning:T,confirmPrint:O,views:j,handleSelectedTemplateChange:C,setSelectedTemplateByIndex:R}=l,[N,M]=We((null===(o=null==b?void 0:b.layoutOptions)||void 0===o?void 0:o.titleText)||""),[E,L]=We((null==b?void 0:b.wkid)||""),[P,A]=We(null==b?void 0:b.outScale),[k,D]=We((null===(n=null==b?void 0:b.layoutOptions)||void 0===n?void 0:n.authorText)||""),[U,V]=We((null===(i=null==b?void 0:b.layoutOptions)||void 0===i?void 0:i.copyrightText)||""),[F,W]=We(null===(r=null==b?void 0:b.layoutOptions)||void 0===r?void 0:r.customTextElements),[G,B]=e.React.useState(null===(a=null==b?void 0:b.exportOptions)||void 0===a?void 0:a.dpi),[_,q]=e.React.useState(null===(u=null==b?void 0:b.exportOptions)||void 0===u?void 0:u.width),[H,Q]=e.React.useState(null===(d=null==b?void 0:b.exportOptions)||void 0===d?void 0:d.height),[X,Z]=We(!1),[K,Y]=e.React.useState(null),[ee,te]=We(null),[le,oe]=We(!1),[ne,ie]=We(!1);Ge((()=>{var e,t,l,o,n,i,r,a,s,u,d,c;const p=J(null===(e=null==b?void 0:b.layoutOptions)||void 0===e?void 0:e.elementOverrides);M((null===(t=null==b?void 0:b.layoutOptions)||void 0===t?void 0:t.titleText)||""),D((null===(l=null==b?void 0:b.layoutOptions)||void 0===l?void 0:l.authorText)||""),V((null===(o=null==b?void 0:b.layoutOptions)||void 0===o?void 0:o.copyrightText)||""),W(null===(n=null==b?void 0:b.layoutOptions)||void 0===n?void 0:n.customTextElements),L(null==b?void 0:b.wkid),v.current=null==b?void 0:b.wkid,A(null==b?void 0:b.outScale),B(null===(i=null==b?void 0:b.exportOptions)||void 0===i?void 0:i.dpi),q(null===(r=null==b?void 0:b.exportOptions)||void 0===r?void 0:r.width),Q(null===(a=null==b?void 0:b.exportOptions)||void 0===a?void 0:a.height),te(p),Ve(X),oe(!!(null===(s=null==b?void 0:b.layoutOptions)||void 0===s?void 0:s.legendLayers)),ie(!!(null===(c=null===(d=null===(u=null==b?void 0:b.layoutOptions)||void 0===u?void 0:u.elementOverrides)||void 0===d?void 0:d[p])||void 0===c?void 0:c.visible)),(null==b?void 0:b.wkidLabel)?Y(null==b?void 0:b.wkidLabel):m.current&&re(null==b?void 0:b.wkid).then((e=>{Y(e)}))}),[b]);const re=t=>Fe(void 0,void 0,void 0,(function*(){if(y.current){const{getSRLabel:e}=m.current;return Promise.resolve(e(t))}return e.moduleLoader.loadModule("jimu-core/wkid").then((e=>{m.current=e,y.current=!0;const{getSRLabel:l}=m.current;return Promise.resolve(l(t))}))})),ae=t=>Fe(void 0,void 0,void 0,(function*(){if(y.current){const{isValidWkid:e}=m.current;return Promise.resolve(e(t))}return e.moduleLoader.loadModule("jimu-core/wkid").then((e=>{m.current=e,y.current=!0;const{isValidWkid:l}=m.current;return Promise.resolve(l(t))}))})),ue=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,o=z(null==g?void 0:g.asMutable({deep:!0}),l);R(o)},de=(e,t)=>{const l=b.setIn(e,t);C(l)},ce=()=>{de(["forceFeatureAttributes"],!(null==b?void 0:b.forceFeatureAttributes))},ve=()=>{de(["attributionVisible"],!(null==b?void 0:b.attributionVisible))},me=e=>{de(["layoutOptions","legendLayers"],le?null:[]),oe(!le)},ye=()=>{var e,t,l;const o=null===(l=null===(t=null===(e=null==b?void 0:b.layoutOptions)||void 0===e?void 0:e.elementOverrides)||void 0===t?void 0:t[ee])||void 0===l?void 0:l.visible;de(["layoutOptions","elementOverrides",ee,"visible"],!o)},ge=e=>{de(["layoutOptions","titleText"],e)},xe=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;M(l)},be=e=>Fe(void 0,void 0,void 0,(function*(){if(!(yield ae(e))){L(v.current);const e=yield re(v.current);return Y(e),!1}v.current=e;const t=yield re(e),l=b.set("wkid",e).set("wkidLabel",t);C(l)})),we=e=>Fe(void 0,void 0,void 0,(function*(){if(yield ae(e)){const t=yield re(e);Y(t)}else Y(p("invalidWKID"));L(e)})),Se=e=>{de(["outScale"],e)},Ie=()=>{var e;const t=null===(e=null==x?void 0:x.view)||void 0===e?void 0:e.scale;A(t),de(["outScale"],t)},Te=e=>{A(e)},Oe=e=>{de(["layoutOptions","authorText"],e)},je=e=>{if(e<1)return!1;B(parseInt(e))},Ce=e=>{if(e<1)return!1;de(["exportOptions","dpi"],parseInt(e))},Re=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;D(l)},Ne=e=>{de(["layoutOptions","copyrightText"],e)},Me=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;V(l)},Ee=e=>{var t;if(!e||Number(e)<1)return q(null===(t=null==b?void 0:b.exportOptions)||void 0===t?void 0:t.width),!1;de(["exportOptions","width"],e)},Le=e=>{q(e)},Pe=e=>{var t;if(!e||Number(e)<1)return Q(null===(t=null==b?void 0:b.exportOptions)||void 0===t?void 0:t.height),!1;de(["exportOptions","height"],e)},Ae=e=>{Q(e)},ke=e=>{const t=e.target.value;de(["format"],t)},De=e=>{const t=e.target.value;de(["layoutOptions","scalebarUnit"],t)},Ve=e=>{const t=He(),{showOutputSpatialReference:l}=t;e&&l&&!(null==b?void 0:b.wkidLabel)&&Fe(void 0,void 0,void 0,(function*(){const e=yield re(null==b?void 0:b.wkid);Y(e)}))},_e=()=>{Ve(!X),Z(!X)},Je=e=>{var t;if(e===s.SetMapScale){const l=null===(t=null==x?void 0:x.view)||void 0===t?void 0:t.scale;A(l),de(["outScale"],l);const o=b.set("outScale",l).set("printExtentType",e);C(o)}else de(["printExtentType"],e)},qe=e=>{if(m.current){const{isValidWkid:t}=m.current;return t(e)}return!0},He=()=>{const e=$(null==b?void 0:b.layout),t=(null==b?void 0:b.hasAuthorText)&&(null==b?void 0:b.enableAuthor)&&!e,l=(null==b?void 0:b.hasCopyrightText)&&(null==b?void 0:b.enableCopyright)&&!e,o=(null==b?void 0:b.hasLegend)&&(null==b?void 0:b.enableLegend)&&!e,n=Qe()&&!e;return{showLayoutOption:t||l||o||n||(null==b?void 0:b.enableScalebarUnit),showAuthor:t,showCopyright:l,showLegend:o,showCustomTextElements:n,showTitle:null==b?void 0:b.enableTitle,showFeatureAttribution:null==b?void 0:b.enableFeatureAttribution,showMapAttribution:(null==b?void 0:b.enableMapAttribution)&&e,showQuality:null==b?void 0:b.enableQuality,showMapSize:(null==b?void 0:b.enableMapSize)&&e,showMapPrintExtents:null==b?void 0:b.enableMapPrintExtents,showScalebarUnit:(null==b?void 0:b.enableScalebarUnit)&&!e,showOutputSpatialReference:null==b?void 0:b.enableOutputSpatialReference,showNorthArrow:null==b?void 0:b.enableNorthArrow}},Qe=()=>{var e,t;const l=[];return null===(e=null==b?void 0:b.customTextElementEnableList)||void 0===e||e.forEach((e=>{for(const t in e)l.push(e[t])})),(null===(t=null==l?void 0:l.filter((e=>e)))||void 0===t?void 0:t.length)>0},Xe=()=>{var l;const o=He(),{showAuthor:n,showCopyright:i,showLegend:r,showLayoutOption:a,showFeatureAttribution:s,showQuality:u,showScalebarUnit:d,showNorthArrow:c}=o;return(0,e.jsx)("div",{role:"group","aria-label":p("LayoutOptions")},a&&(0,e.jsx)("div",{className:"mb-2"},p("LayoutOptions")),n&&(0,e.jsx)(he,{flowWrap:!0,label:p("printAuthor")},(0,e.jsx)(t.TextInput,{size:"sm",className:"w-100 dpi-input",value:k,onAcceptValue:Oe,onChange:Re,"aria-label":p("printAuthor")})),i&&(0,e.jsx)(he,{flowWrap:!0,label:p("printCopyright")},(0,e.jsx)(t.TextInput,{size:"sm",className:"w-100 dpi-input",value:U,onAcceptValue:Ne,onChange:Me,"aria-label":p("printCopyright")})),Ze(),r&&(0,e.jsx)(he,null,(0,e.jsx)("div",{title:p("includeLegend"),className:"w-100 align-items-center d-flex checkbox-con",onClick:me},(0,e.jsx)(t.Checkbox,{title:p("includeLegend"),className:"lock-item-ratio",checked:le}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},p("includeLegend")))),c&&(0,e.jsx)(he,null,(0,e.jsx)("div",{title:p("includeNorthArrow"),className:"w-100 align-items-center d-flex checkbox-con",onClick:ye},(0,e.jsx)(t.Checkbox,{title:p("includeNorthArrow"),className:"lock-item-ratio",checked:ne}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},p("includeNorthArrow")))),d&&(0,e.jsx)(he,{label:p("scaleBarUnit"),flowWrap:!1},(0,e.jsx)(t.Select,{value:null===(l=null==b?void 0:b.layoutOptions)||void 0===l?void 0:l.scalebarUnit,onChange:De,size:"sm",className:"scalebar-unit","aria-label":p("scaleBarUnit")},function(e){return[{value:"Miles",label:e("unitsLabelMiles")},{value:"Kilometers",label:e("unitsLabelKilometers")},{value:"Meters",label:e("unitsLabelMeters")},{value:"Feet",label:e("unitsLabelFeet")}]}(p).map(((l,o)=>(0,e.jsx)(t.Option,{key:`unit${o}`,value:l.value,title:l.label},l.label))))),u&&(0,e.jsx)(he,{label:p("printQuality"),flowWrap:!0},(0,e.jsx)("div",{className:"d-flex align-items-center w-100 dpi-con"},(0,e.jsx)(t.NumericInput,{size:"sm",className:"flex-grow-1 no-right-padding",value:G,min:1,onAcceptValue:Ce,onChange:je,showHandlers:!1,"aria-label":p("printQuality")}),(0,e.jsx)(t.Button,{disabled:!0,size:"sm",title:"DPI"},"DPI"))),s&&(0,e.jsx)(he,null,(0,e.jsx)("div",{title:p("includeAttributes"),className:"w-100 align-items-center d-flex checkbox-con",onClick:ce},(0,e.jsx)(t.Checkbox,{title:p("includeAttributes"),className:"lock-item-ratio","data-field":"mapSize",checked:null==b?void 0:b.forceFeatureAttributes}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},p("includeAttributes")))))},Ze=()=>{const l=[];return null==F||F.forEach(((o,n)=>{var i,r;for(const a in o){if(!(null===(r=null===(i=null==b?void 0:b.customTextElementEnableList)||void 0===i?void 0:i[n])||void 0===r?void 0:r[a]))continue;const s=(0,e.jsx)(he,{flowWrap:!0,className:"align-item-center",label:a,key:`${a}_${n}`},(0,e.jsx)(t.TextInput,{size:"sm",className:"flex-grow-1",value:o[a]||"",onAcceptValue:e=>{Ke(n,a,e)},onChange:e=>{Ye(n,a,e)},"aria-label":a}));l.push(s)}})),l},Ke=(e,t,l)=>{const o=F[e].set(t,l),n=null==F?void 0:F.asMutable({deep:!0});n.splice(e,1,o),de(["layoutOptions","customTextElements"],n)},Ye=(t,l,o)=>{var n;const i=null===(n=null==o?void 0:o.target)||void 0===n?void 0:n.value,r=F[t].set(l,i),a=null==F?void 0:F.asMutable({deep:!0});a.splice(t,1,r),W((0,e.Immutable)(a))},et=()=>{const l=He(),{showFeatureAttribution:o,showMapAttribution:n,showQuality:i}=l;return(0,e.jsx)("div",null,o&&(0,e.jsx)(he,{className:"mb-1"},(0,e.jsx)("div",{title:p("includeAttributes"),className:"w-100 align-items-center mt-1 d-flex checkbox-con",onClick:ce},(0,e.jsx)(t.Checkbox,{title:p("includeAttributes"),className:"lock-item-ratio","data-field":"mapSize",checked:null==b?void 0:b.forceFeatureAttributes}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},p("includeAttributes")))),n&&(0,e.jsx)(he,null,(0,e.jsx)("div",{title:p("includeAttribution"),className:"w-100 align-items-center d-flex checkbox-con",onClick:ve},(0,e.jsx)(t.Checkbox,{title:p("includeAttribution"),className:"lock-item-ratio","data-field":"mapSize",checked:null==b?void 0:b.attributionVisible}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},p("includeAttribution")))),i&&(0,e.jsx)(he,{label:p("printQuality"),flowWrap:!0},(0,e.jsx)("div",{className:"d-flex align-items-center w-100 dpi-con"},(0,e.jsx)(t.NumericInput,{size:"sm",className:"flex-grow-1 no-right-padding",value:G,onAcceptValue:Ce,onChange:je,showHandlers:!1,min:1,"aria-label":p("printQuality")}),(0,e.jsx)(t.Button,{disabled:!0,size:"sm",title:"DPI"},"DPI"))))},tt=()=>$e.sanitize(p("spatialReference",{WKID:'<a target="_blank" href="https://developers.arcgis.com/rest/services-reference/enterprise/using-spatial-references.htm">WKID</a>'}));return(0,e.jsx)("div",{className:(0,e.classNames)("w-100 h-100",{invisible:j!==h.PrintTemplate}),css:f},(0,e.jsx)("div",{className:"w-100 h-100 d-flex flex-column"},(0,e.jsx)("div",{className:"flex-grow-1 w-100 setting-con"},(0,e.jsx)("div",{className:"w-100"},(()=>{var l,o,n,i,r;const a=He(),{showTitle:s}=a;return(0,e.jsx)("div",{className:"base-setting-con"},(0,e.jsx)(he,{flowWrap:!0,label:p("template")},(0,e.jsx)(t.Select,{value:(null==b?void 0:b.templateId)||"",onChange:ue,size:"sm","aria-label":p("template")},null==g?void 0:g.map(((l,o)=>(0,e.jsx)(t.Option,{key:null==l?void 0:l.templateId,value:null==l?void 0:l.templateId,title:null==l?void 0:l.label},null==l?void 0:l.label))))),(0,e.jsx)(ze,{supportCustomReport:null==S?void 0:S.supportCustomReport,supportReport:null==S?void 0:S.supportReport,outputDataSourceWarning:T}),s&&(0,e.jsx)(he,{flowWrap:!0,label:p("title")},(0,e.jsx)(t.TextInput,{size:"sm",className:"w-100",value:N,"aria-label":p("title"),onAcceptValue:ge,onChange:xe})),(null===(l=null==b?void 0:b.selectedFormatList)||void 0===l?void 0:l.length)>1&&(0,e.jsx)(he,{flowWrap:!0,label:p("fileFormat")},(0,e.jsx)(t.Select,{value:(null===(o=null==b?void 0:b.format)||void 0===o?void 0:o.toLowerCase())||"",onChange:ke,size:"sm","aria-label":p("fileFormat")},!(null===(n=null==b?void 0:b.selectedFormatList)||void 0===n?void 0:n.includes(null==b?void 0:b.format))&&(0,e.jsx)(t.Option,{className:"sr-only",key:`${null==b?void 0:b.format}0`,value:null===(i=null==b?void 0:b.format)||void 0===i?void 0:i.toLowerCase(),title:null==b?void 0:b.format},null==b?void 0:b.format),null===(r=null==b?void 0:b.selectedFormatList)||void 0===r?void 0:r.map(((l,o)=>(0,e.jsx)(t.Option,{key:`format${o}`,value:l,title:l},l))))))})(),(0,e.jsx)("div",null,$(null==b?void 0:b.layout)&&(()=>{const l=He(),{showMapSize:o}=l;return(0,e.jsx)("div",null,o&&(0,e.jsx)("div",{className:"d-flex align-items-center"},(0,e.jsx)("div",{className:"flex-grow-1"},(0,e.jsx)("div",{className:"mb-1"},p("width")),(0,e.jsx)(t.NumericInput,{size:"sm",className:"w-100 map-size-con",value:_,onAcceptValue:Ee,onChange:Le,showHandlers:!1,"aria-label":p("width")})),(0,e.jsx)("div",{className:"flex-grow-1 ml-2"},(0,e.jsx)("div",{className:"mb-1"},p("height")),(0,e.jsx)(t.NumericInput,{size:"sm",className:"w-100 map-size-con",value:H,onAcceptValue:Pe,onChange:Ae,showHandlers:!1,"aria-label":p("height")}))))})(),(()=>{const l=$(null==b?void 0:b.layout),o=He(),{showLayoutOption:n,showFeatureAttribution:i,showMapAttribution:r,showQuality:a,showMapSize:u,showMapPrintExtents:d,showScalebarUnit:c,showOutputSpatialReference:v}=o,m=n||i||r||a||u||d||c||v;return(0,e.jsx)("div",null,m&&(0,e.jsx)("div",{className:"d-flex align-items-center",role:"group","aria-label":p("advance")},(0,e.jsx)("div",{className:"flex-grow-1"},p("advance")),(0,e.jsx)(t.Button,{icon:!0,className:"collapse-button",size:"sm",type:"tertiary",onClick:_e,title:p(X?"collapse":"expand")},X?(0,e.jsx)(pe,null):(0,e.jsx)(se,null))),X&&(0,e.jsx)("div",null,d&&(0,e.jsx)(he,{flowWrap:!0,label:p("mapPrintingExtents")},(0,e.jsx)("div",{role:"group","aria-label":p("mapPrintingExtents")},(0,e.jsx)("div",{title:p("currentMapExtent"),className:"d-flex align-items-center radio-con mt-1 checkbox-con",onClick:()=>{Je(s.CurrentMapExtent)}},(0,e.jsx)(t.Radio,{title:p("currentMapExtent"),checked:(null==b?void 0:b.printExtentType)===s.CurrentMapExtent,className:"mr-2"})," ",p("currentMapExtent")),(0,e.jsx)("div",{title:p("currentMapScale"),className:"d-flex align-items-center radio-con checkbox-con",onClick:()=>{Je(s.CurrentMapScale)}},(0,e.jsx)(t.Radio,{title:p("currentMapScale"),checked:(null==b?void 0:b.printExtentType)===s.CurrentMapScale,className:"mr-2"})," ",p("currentMapScale")),(0,e.jsx)("div",{title:p("setMapScale"),className:"d-flex align-items-center radio-con checkbox-con",onClick:()=>{Je(s.SetMapScale)}},(0,e.jsx)(t.Radio,{title:p("setMapScale"),checked:(null==b?void 0:b.printExtentType)===s.SetMapScale,className:"mr-2"})," ",p("setMapScale")),(null==b?void 0:b.printExtentType)===s.SetMapScale&&(0,e.jsx)("div",{className:"w-100 d-flex align-items-center outscale-con"},(0,e.jsx)(t.NumericInput,{size:"sm",className:"flex-grow-1 dpi-input no-right-padding",value:P,onAcceptValue:Se,onChange:Te,showHandlers:!1,"aria-label":p("setMapScale")}),(0,e.jsx)(t.Button,{size:"sm",onClick:Ie,title:p("useCurrentScale")},(0,e.jsx)(fe,null))))),v&&(0,e.jsx)(he,{flowWrap:!0,label:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:tt()}})},(0,e.jsx)(t.NumericInput,{size:"sm",className:"w-100 dpi-input no-right-padding",value:E,onAcceptValue:be,onChange:we,showHandlers:!1,"aria-label":p("spatialReference",{WKID:""}),"aria-describedby":"print-wkid-describtion"}),(0,e.jsx)("div",{id:"print-wkid-describtion",title:K,"aria-label":K,className:(0,e.classNames)("text-truncate mt-1 wkid-describtion",{"wkid-describtion-invalid":!qe(Number(E))})},K)),!l&&Xe(),l&&et()))})()))),(0,e.jsx)("div",{className:"print-button-con"},(null==S?void 0:S.enablePreview)&&(0,e.jsx)(Ue,{id:w,jimuMapView:x,className:"w-100",scale:P,selectedTemplate:b,scalebarUnit:null===(c=null==b?void 0:b.layoutOptions)||void 0===c?void 0:c.scalebarUnit,printExtentType:null==b?void 0:b.printExtentType,config:S}),(0,e.jsx)(t.Button,{className:"w-100 mt-2",type:"primary",onClick:()=>{O(b)}},p("_widgetLabel")))))};var Je=r(62838),qe=r.n(Je),He=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(l[o[n]]=e[o[n]])}return l};const Qe=t=>{const l=window.SVG,{className:o}=t,n=He(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:i,src:qe()},n)):e.React.createElement("svg",Object.assign({className:i},n))};var Xe=r(55886),Ze=r.n(Xe),Ke=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(l[o[n]]=e[o[n]])}return l};const Ye=t=>{const l=window.SVG,{className:o}=t,n=Ke(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:i,src:Ze()},n)):e.React.createElement("svg",Object.assign({className:i},n))};var et=r(22167),tt=r.n(et),lt=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(l[o[n]]=e[o[n]])}return l};const ot=t=>{const l=window.SVG,{className:o}=t,n=lt(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:i,src:tt()},n)):e.React.createElement("svg",Object.assign({className:i},n))},{useEffect:nt,useState:it}=e.React,rt=l=>{const o=e.hooks.useTranslation(I,t.defaultMessages),n=e.css`
    & {
      overflow: auto;
      padding: ${e.polished.rem(16)} ${e.polished.rem(16)} ${e.polished.rem(16)} ${e.polished.rem(16)};
    }
    .result-button {
      padding-left: 0;
      padding-right: 0;
    }
    a {
      padding: 0;
    }
    .print-loading-con {
      width: 16px;
      height: 16px;
      margin-right: ${e.polished.rem(4)};
    }
    a.result-button{
      &:hover {
        color: var(--sys-color-primary-main);
        background: none;
        text-decoration: underline;
      }
    }
    .error-link, .error-link:hover {
      color: var(--ref-palette-neutral-1200);
      & svg {
        color: var(--sys-color-error-dark);
      }
    }
  `,{printResultList:i,config:r,deleteResultItem:a}=l,[s,u]=it(null);nt((()=>{Te(r.useUtility).then((e=>{u(e)}))}),[r.useUtility]);const d=l=>{switch(l.state){case f.Loading:return(0,e.jsx)("div",{className:"print-loading-con position-relative"},(0,e.jsx)(t.Loading,{width:16,height:16,type:t.LoadingType.Donut}));case f.Success:return(0,e.jsx)(Ye,null);case f.Error:return(0,e.jsx)("span",{title:o("uploadImageError")},(0,e.jsx)(ot,null))}};return(0,e.jsx)("div",{className:"w-100 h-100",css:n},0===(null==i?void 0:i.length)&&(0,e.jsx)("div",null,o("resultEmptyMessage")),i.map(((l,n)=>(0,e.jsx)("div",{className:"d-flex align-items-center mb-2 w-100",key:null==l?void 0:l.resultId},(0,e.jsx)(t.Button,{href:s?`${null==l?void 0:l.url}?token=${s}`:null==l?void 0:l.url,disabled:!(null==l?void 0:l.url),target:"_blank",size:"sm","aria-label":null==l?void 0:l.title,title:(null==l?void 0:l.state)!==f.Error?null==l?void 0:l.title:"",type:"tertiary",className:(0,e.classNames)("flex-grow-1 d-flex align-items-center result-button",{"error-link":(null==l?void 0:l.state)===f.Error})},d(l),(0,e.jsx)("div",{className:"ml-2 flex-grow-1 text-left",title:(null==l?void 0:l.state)===f.Error?null==l?void 0:l.title:""},null==l?void 0:l.title)),(0,e.jsx)(t.Button,{icon:!0,size:"sm",type:"tertiary",onClick:()=>{a(n)},title:o("remove")},(0,e.jsx)(Qe,null))))))};var at=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{s(o.next(e))}catch(e){i(e)}}function a(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};const st=t=>at(void 0,void 0,void 0,(function*(){var o;const{printTemplateProperties:n,useUtility:i,isSupportReport:r,widgetId:a,useMapWidgetIds:s,jimuMapView:u,reportOptions:d,elementOverrides:c,toggleUtilityErrorRemind:p}=t,v=null===(o=t.mapView)||void 0===o?void 0:o.timeExtent,m=function(t,l){const o=null==l?void 0:l.dataSourceId;if(!t||!o)return t;let n=!0;const i=(0,e.getAppStore)().getState().appConfig.widgets;if(Object.keys(i).forEach((t=>{var l,r;const a=i[t];if("widgets/common/timeline/"===a.uri){const t=((null==a?void 0:a.useDataSources)||[]).filter((e=>e.rootDataSourceId===o||e.mainDataSourceId===o));(null==t?void 0:t.length)>0&&(null===(l=a.config)||void 0===l?void 0:l.dataSourceType)!==e.AllDataSourceTypes.Map&&(null===(r=a.config)||void 0===r?void 0:r.dataSourceType)!==e.AllDataSourceTypes.WebMap&&(n=!1)}})),n){let e;return(l.getAllJimuLayerViews().map((e=>e.layer))||[]).forEach((t=>{(null==t?void 0:t.timeExtent)&&(e=null==t?void 0:t.timeExtent)})),e&&(t.timeExtent=e),t}return t}(t.mapView,u),y=yield(f=(0,e.Immutable)(i),T(void 0,void 0,void 0,(function*(){const t=yield O(f);return t?e.SessionManager.getInstance().getSessionByUrl(t):null})));var f;return G(i).then((e=>(0,l.loadArcGISJSAPIModules)(["esri/rest/support/PrintParameters","esri/rest/support/PrintTemplate","esri/rest/print","esri/geometry/SpatialReference"]).then((l=>{var o;const[f,h,g,x]=l;n.includeTables=!0;const b=new h(n),w={view:dt(m),template:b};n.wkid!==(null===(o=null==m?void 0:m.spatialReference)||void 0===o?void 0:o.wkid)&&(w.outSpatialReference=new x({wkid:n.wkid}));const S=new f(w),I={timeout:12e4,token:null==y?void 0:y.token};return(null==y?void 0:y.token)&&(I.token=y.token),g.execute(e,S,I).then((e=>(le(null==i?void 0:i.utilityId,p),Oe(c,d,u,a,s,r),ut(t.mapView,v),dt(m,!0),Promise.resolve(e))),(e=>(Oe(c,d,u,a,s,r),le(null==i?void 0:i.utilityId,p,e),ut(t.mapView,v),dt(m,!0),Promise.reject(new Error(e))))).catch((e=>(Oe(c,d,u,a,s,r),le(null==i?void 0:i.utilityId,p,e),ut(t.mapView,v),dt(m,!0),Promise.reject(new Error(e)))))}))))}));function ut(e,t){e.timeExtent=t}function dt(e,t=!1){return e.map.layers.toArray().forEach((e=>{var l,o,n,i;if(null===(l=null==e?void 0:e.id)||void 0===l?void 0:l.includes("jimu-draw-groupLayer")){(null===(o=null==e?void 0:e.layers)||void 0===o?void 0:o.toArray()).forEach((e=>{var l;null===(l=e.graphics)||void 0===l||l.forEach((e=>{var l;(null===(l=null==e?void 0:e.attributes)||void 0===l?void 0:l.jimuDrawId)&&(e.geometry.hasZ=t)}))}))}(null===(n=null==e?void 0:e.id)||void 0===n?void 0:n.includes("bookmark-layer-"))&&(null===(i=null==e?void 0:e.graphics)||void 0===i||i.forEach((e=>{var l;(null===(l=null==e?void 0:e.attributes)||void 0===l?void 0:l.jimuDrawId)&&(e.geometry.hasZ=t)})))})),e}const ct=e.css`
  & .utility-err-remind-con {
    bottom: 0;
  }
`,pt=l=>{const o=e.hooks.useTranslation(t.defaultMessages,e.defaultMessages),{utilityId:n,toggleUtilityErrorRemind:i}=l,r=e.ReactRedux.useSelector((e=>{var t,l,i;const r=null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.utilityStates;return!0===(null===(l=null==r?void 0:r[n])||void 0===l?void 0:l.isSignInError)?o("signInErrorDefault"):!1===(null===(i=null==r?void 0:r[n])||void 0===i?void 0:i.success)?o("utilityNotAvailable"):void 0}));return(0,e.jsx)("div",{className:"position-relative w-100",css:ct},(0,e.jsx)("div",{className:"position-absolute w-100 utility-err-remind-con"},(0,e.jsx)(t.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,closable:!0,onClose:()=>{i(!1)},text:r})))};var vt=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{s(o.next(e))}catch(e){i(e)}}function a(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};const{useState:mt,useRef:yt,useEffect:ft}=e.React,ht=e.css`
  .classic-setting-con {
    height: 0;
  }
  .nav-bar-con {
    height: ${e.polished.rem(40)};
    border: none !important;
    border-bottom: 1px solid var(--ref-palette-neutral-300) !important;
    padding: 0;
    .navbar-nav button.nav-link:not(.active), .navbar-nav button.nav-link:hover:not(.active) {
      color: var(--ref-palette-neutral-1100);
    }
    .loading-con {
      min-width: 16px;
      height: 16px;
      margin-top: -1px;
    }
    .jimu-nav-link-wrapper .jimu-badge-wrapper {
      & {
        display: block;
      }
      .badge-dot {
        top: ${e.polished.rem(4)};
        right: ${e.polished.rem(4)};
      }
    }
  }
`,gt=o=>{var n;const i=e.hooks.useTranslation(I,t.defaultMessages),r=yt([]),a=yt([]),s=yt(null),{config:u,jimuMapView:d,templateList:c,id:p,locale:v,useMapWidgetIds:m,outputDataSourceWarning:y,showUtilityErrorRemind:g,handleSelectedTemplateIndexChange:x,toggleUtilityErrorRemind:b}=o,[w,S]=mt(h.PrintTemplate),[T,O]=mt((0,e.Immutable)([])),[j,C]=mt(null);ft((()=>{E(0)}),[]),ft((()=>{var t;if(j&&W(c,null==j?void 0:j.templateId)){const l=z(null==c?void 0:c.asMutable({deep:!0}),null==j?void 0:j.templateId),o=null===(t=L(null==c?void 0:c[l]))||void 0===t?void 0:t.asMutable({deep:!0});R(o),s.current=(0,e.Immutable)(o)}j&&W(c,null==j?void 0:j.templateId)||E(0)}),[c,u]);const R=t=>{var l;let o=null==j?void 0:j.asMutable({deep:!0});for(const e in o)e.includes("enable")&&delete o[e];const n=N(t,null===(l=s.current)||void 0===l?void 0:l.asMutable({deep:!0}));n.length>0&&n.forEach((l=>{const n=M(t,l);o=(0,e.Immutable)(o).setIn(l.split("."),n).asMutable({deep:!0})})),o.customTextElementEnableList=null==t?void 0:t.customTextElementEnableList,o.selectedFormatList=null==t?void 0:t.selectedFormatList;const i=(0,e.Immutable)(Object.assign(Object.assign({},t),o));P(i)},N=(e,t)=>{const l=[],o=(e,t,n)=>{for(const i in e){const r=e[i],a=null==t?void 0:t[i],s=n?`${n}.${i}`:i;"object"==typeof r&&"object"==typeof a&&(null!==r&&null!==a)?o(r,a,s):r!==a&&l.push(s)}};return o(e,t,""),l},M=(e,t)=>{const l=t.split(".");let o=e;for(const e of l)o=null==o?void 0:o[e];return o},E=e=>{if(0===(null==c?void 0:c.length))return!1;const t=L(null==c?void 0:c[e]);s.current=t,x(e),P(t)},L=t=>t?t=(null==t?void 0:t.overrideCommonSetting)?V((0,e.Immutable)(null==u?void 0:u.commonSetting),(0,e.Immutable)(t)):V((0,e.Immutable)(t),(0,e.Immutable)(null==u?void 0:u.commonSetting)):null,P=e=>{C(e)},A=t=>{S(t),t===h.PrintResult&&(a.current=(0,e.Immutable)(r.current).asMutable())},k=e=>{const t=Se(p,d.id),l=d.view.map.findLayerById(t);l&&(l.visible=e)},D=(t,l,o)=>{let n;o&&(t.url=o),t.state=l;const i=r.current;i.forEach(((e,l)=>{e.resultId===t.resultId&&(n=l)})),(n||0===n)&&(i.splice(n,1,t),O((0,e.Immutable)(i)),r.current=i)};return(0,e.jsx)("div",{className:"w-100 h-100 d-flex flex-column",css:ht},(()=>{var l;const o=(()=>{var e,t;return(null===(t=null===(e=null==r?void 0:r.current)||void 0===e?void 0:e.filter((e=>e.state===f.Loading)))||void 0===t?void 0:t.length)>0})()&&w===h.PrintTemplate,n=null===(l=null==r?void 0:r.current)||void 0===l?void 0:l.length,a=!o&&n>0?`(${n})`:"";return(0,e.jsx)(t.Navbar,{className:"nav-bar-con w-100",border:!1,light:!0},(0,e.jsx)(t.Nav,{className:"w-100 h-100",underline:!0,navbar:!0,justified:!0,fill:!0},(0,e.jsx)(t.NavItem,{title:i("printTemplate"),onClick:()=>{A(h.PrintTemplate)},className:"link-con"},(0,e.jsx)(t.NavLink,{tag:"button",active:w===h.PrintTemplate},i("printTemplate"))),(0,e.jsx)(t.NavItem,{title:i("printResult"),onClick:()=>{A(h.PrintResult)}},(0,e.jsx)(t.NavLink,{className:"align-middle",tag:"button",active:w===h.PrintResult},(0,e.jsx)("div",{className:"d-inline-block"},i("resultsNumber",{number:a})),o&&(0,e.jsx)("div",{className:"loading-con position-relative ml-1 d-inline-block align-middle"},(0,e.jsx)(t.Loading,{width:16,height:16,type:t.LoadingType.Donut}))))))})(),(0,e.jsx)("div",{className:"flex-grow-1 w-100 classic-setting-con overflow-hidden"},(0,e.jsx)("div",{className:(0,e.classNames)("w-100 h-100",{"sr-only":w!==h.PrintTemplate})},(0,e.jsx)(_e,{id:p,config:u,jimuMapView:d,selectedTemplate:j,templateList:c,outputDataSourceWarning:y,confirmPrint:t=>vt(void 0,void 0,void 0,(function*(){var o,n;const i={resultId:be((0,e.Immutable)(r.current)),url:null,title:xe(null===(o=null==t?void 0:t.layoutOptions)||void 0===o?void 0:o.titleText,(0,e.Immutable)(r.current)),state:f.Loading},a=r.current,s=(null==u?void 0:u.supportCustomReport)||(null==u?void 0:u.supportReport);a.push(i),r.current=a,O((0,e.Immutable)(a)),k(!1);const c={printTemplateProperties:j,mapView:d,locale:v,utility:u.useUtility,useMapWidgetIds:m,widgetId:p,isSupportReport:s},y=yield Me(c);if(!y)return void D(i,f.Error);let h;s&&(h=l.MapViewManager.getInstance().getJimuMapViewById(d.id));const g=h||d;st({useUtility:null==u?void 0:u.useUtility,mapView:null==g?void 0:g.view,printTemplateProperties:y,toggleUtilityErrorRemind:b,jimuMapView:d,useMapWidgetIds:m,widgetId:p,isSupportReport:s,reportOptions:null==j?void 0:j.reportOptions,elementOverrides:null===(n=null==j?void 0:j.layoutOptions)||void 0===n?void 0:n.elementOverrides}).then((e=>{k(!0),D(i,f.Success,null==e?void 0:e.url)}),(e=>{k(!0),D(i,f.Error)}))})),views:w,handleSelectedTemplateChange:P,setSelectedTemplateByIndex:E}),g&&(0,e.jsx)(pt,{utilityId:null===(n=null==u?void 0:u.useUtility)||void 0===n?void 0:n.utilityId,toggleUtilityErrorRemind:b})),w===h.PrintResult&&(0,e.jsx)(rt,{config:u,printResultList:T,deleteResultItem:t=>{var l,o;const n=r.current;n.splice(t,1),O((0,e.Immutable)(n)),r.current=null===(l=(0,e.Immutable)(n))||void 0===l?void 0:l.asMutable({deep:!0}),a.current=null===(o=(0,e.Immutable)(n))||void 0===o?void 0:o.asMutable({deep:!0})}})))};var xt=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(l[o[n]]=e[o[n]])}return l};const bt=t=>{const l=window.SVG,{className:o}=t,n=xt(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:i,src:S()},n)):e.React.createElement("svg",Object.assign({className:i},n))},wt=t=>{const l=e.css`
    &.print-loading-con {
      @keyframes loading {
        0% {transform: rotate(0deg); };
        100% {transform: rotate(360deg)};
      }
      width: ${e.polished.rem(16)};
      height: ${e.polished.rem(16)};
      border: 1px solid var(--ref-palette-neutral-800);
      border-radius: 50%;
      border-top: 1px solid var(--ref-palette-neutral-1100);
      box-sizing: border-box;
      animation:loading 2s infinite linear;
      margin-right: ${e.polished.rem(4)};
    }
  `;return(0,e.jsx)("div",{css:l,className:"print-loading-con"})},{useEffect:St,useState:It}=e.React,Tt=l=>{const o=e.hooks.useTranslation(I,t.defaultMessages),{printResult:n,useUtility:i,restPrint:r}=l,[a,s]=It(null),u=e.css`
    .error-link, .error-link:hover {
      color: var(--ref-palette-neutral-1200);
      & svg {
        color: var(--sys-color-error-dark);
      }
    }
    a.result-button{
      &:hover {
        color: var(--sys-color-primary-main);
        background: none;
        text-decoration: underline;
      }
    }
  `;St((()=>{Te(i).then((e=>{s(e)}))}),[i]);return(0,e.jsx)("div",{className:"d-flex flex-column h-100 w-100 result-con",css:u},(0,e.jsx)(t.Button,{href:a?`${null==n?void 0:n.url}?token=${a}`:null==n?void 0:n.url,disabled:!(null==n?void 0:n.url),target:"_blank",size:"sm","aria-label":null==n?void 0:n.title,title:null==n?void 0:n.title,type:"tertiary",className:(0,e.classNames)("d-flex align-items-center",{"error-link":(null==n?void 0:n.state)===f.Error})},(()=>{switch(null==n?void 0:n.state){case f.Loading:return(0,e.jsx)(wt,null);case f.Success:return(0,e.jsx)(Ye,null);case f.Error:return(0,e.jsx)("span",{title:o("uploadImageError")},(0,e.jsx)(ot,null))}})(),(0,e.jsx)("div",{className:"ml-2 flex-grow-1 text-left"},null==n?void 0:n.title)),(0,e.jsx)("div",{className:"flex-grow-1 d-flex align-items-end"},(0,e.jsx)("div",{className:"flex-grow-1"}),(0,e.jsx)(t.Button,{type:"primary",onClick:r},o("reset"))))};var Ot=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{s(o.next(e))}catch(e){i(e)}}function a(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};const{useState:jt,useRef:Ct,useEffect:Rt}=e.React,{useSelector:Nt}=e.ReactRedux,Mt=o=>{var n,i;const{config:r,templateList:a,jimuMapView:s,errorTip:u,id:d,locale:c,useMapWidgetIds:p,outputDataSourceWarning:v,showPlaceholder:m,showUtilityErrorRemind:y,controllerWidgetId:h,toggleUtilityErrorRemind:g}=o,x=e.hooks.useTranslation(I,t.defaultMessages),b=Ct(null),w=Nt((e=>{var t,l;return null===(l=null===(t=null==e?void 0:e.appConfig)||void 0===t?void 0:t.widgets)||void 0===l?void 0:l[d]})),S=e.css`
    .compact-con {
      padding: 0;
      svg {
        margin: 0 auto;
      }
      .compact-icon {
        color: ${null===(i=null===(n=null==w?void 0:w.icon)||void 0===n?void 0:n.properties)||void 0===i?void 0:i.color};
      }
    }
    .off-panel-con {
      min-height: 32px;
      min-width: 32px;
    }
    .operate-con-width-controller-widget {
      min-width: 295px;
      padding: 12px;
      .close-con button{
        padding: 0;
        svg {
          margin: 0 auto;
        }
      }
    }
  `,T=e.css`
    & {
      padding: ${e.polished.rem(12)};
      width: ${e.polished.rem(320)};
    }
    .select-con {
      min-height: ${e.polished.rem(107)};
    }
    .result-con {
      min-height: ${e.polished.rem(107)};
    }
    .close-con button{
      padding: 0;
      svg {
        margin: 0 auto;
      }
    }
    .result-list-con button {
      padding: 0;
    }
    .compact-preview-con {
      width: 0;
    }
  `,[O,j]=jt(!1),[C,R]=jt(!1),[N,M]=jt(null),[E,L]=jt(null);Rt((()=>{P(0)}),[]),Rt((()=>{if(E&&W(a,null==E?void 0:E.templateId)||P(0),E&&W(a,null==E?void 0:E.templateId)){const e=z(null==a?void 0:a.asMutable({deep:!0}),null==E?void 0:E.templateId);P(e)}}),[a,r]);const P=e=>{if(0===(null==a?void 0:a.length))return!1;let t=null==a?void 0:a[e];t=(null==t?void 0:t.overrideCommonSetting)?V(null==r?void 0:r.commonSetting,t):V(t,null==r?void 0:r.commonSetting),L(t)},A=(e,t)=>{j("clickOutside"!==t&&!O)},k=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,o=z(null==a?void 0:a.asMutable({deep:!0}),l);P(o)},D=()=>{M(null),R(!1)},U=e=>{const t=Se(d,s.id),l=s.view.map.findLayerById(t);l&&(l.visible=e)},F=()=>Ot(void 0,void 0,void 0,(function*(){var t,o;const n={resultId:null==E?void 0:E.templateId,url:null,title:null===(t=null==E?void 0:E.layoutOptions)||void 0===t?void 0:t.titleText,state:f.Loading},i=(null==r?void 0:r.supportCustomReport)||(null==r?void 0:r.supportReport);M((0,e.Immutable)(n)),R(!C),U(!1);const a={printTemplateProperties:E,mapView:s,locale:c,utility:r.useUtility,useMapWidgetIds:p,widgetId:d,isSupportReport:i},u=yield Me(a);if(!u)return n.state=f.Error,void M((0,e.Immutable)(n));let v;i&&(v=l.MapViewManager.getInstance().getJimuMapViewById(s.id));const m=v||s;st({useUtility:null==r?void 0:r.useUtility,mapView:null==m?void 0:m.view,printTemplateProperties:u,toggleUtilityErrorRemind:g,jimuMapView:s,useMapWidgetIds:p,widgetId:d,isSupportReport:i,reportOptions:null==E?void 0:E.reportOptions,elementOverrides:null===(o=null==E?void 0:E.layoutOptions)||void 0===o?void 0:o.elementOverrides}).then((t=>{n.url=null==t?void 0:t.url,n.state=f.Success,U(!0),M((0,e.Immutable)(n))}),(t=>{U(!0),n.state=f.Error,M((0,e.Immutable)(n))}))})),$=()=>{var l;return(0,e.jsx)("div",{className:(0,e.classNames)("w-100 h-100",{"operate-con-width-controller-widget":h})},!m&&(0,e.jsx)("div",{className:"d-flex flex-column w-100 h-100"},!h&&(0,e.jsx)("div",{className:"text-right close-con"},(0,e.jsx)(t.Button,{className:"print-button",type:"tertiary",title:x("closeTour"),onClick:A},(0,e.jsx)(Qe,null))),(0,e.jsx)("div",{className:"flex-grow-1"},(0,e.jsx)("div",{className:(0,e.classNames)("w-100 h-100 select-con",{"sr-only":C})},(()=>{var l;return(0,e.jsx)("div",{className:"d-flex flex-column"},(0,e.jsx)(he,{flowWrap:!0,className:"flex-grow-1",label:x("template")},(0,e.jsx)(t.Select,{value:(null==E?void 0:E.templateId)||"",onChange:k,size:"sm",className:"scalebar-unit","aria-label":x("template")},null==a?void 0:a.map(((l,o)=>(0,e.jsx)(t.Option,{key:l.templateId,value:l.templateId,title:l.label},l.label))))),(0,e.jsx)(ze,{supportCustomReport:null==r?void 0:r.supportCustomReport,supportReport:null==r?void 0:r.supportReport,outputDataSourceWarning:v}),(0,e.jsx)("div",{className:"print-button-con d-flex align-items-center mt-2"},(null==r?void 0:r.enablePreview)&&(0,e.jsx)(Ue,{className:"flex-grow-1 compact-preview-con",id:d,config:r,jimuMapView:s,scale:null==E?void 0:E.outScale,selectedTemplate:E,scalebarUnit:null===(l=null==E?void 0:E.layoutOptions)||void 0===l?void 0:l.scalebarUnit,printExtentType:null==E?void 0:E.printExtentType}),(0,e.jsx)(t.Button,{className:"print-button text-truncate ml-1",type:"primary",onClick:F,title:x("_widgetLabel")},x("_widgetLabel"))))})()),C&&(0,e.jsx)(Tt,{printResult:N,restPrint:D,useUtility:null==r?void 0:r.useUtility}))),m&&(0,e.jsx)("div",null,u),y&&(0,e.jsx)(pt,{utilityId:null===(l=null==r?void 0:r.useUtility)||void 0===l?void 0:l.utilityId,toggleUtilityErrorRemind:g}))};return(0,e.jsx)("div",{className:"w-100 h-100",css:S},h&&(0,e.jsx)("div",{className:"w-100 h-100"},$()),!h&&(0,e.jsx)("div",{className:"w-100 h-100"},(0,e.jsx)(t.Button,{className:(0,e.classNames)("w-100 h-100 compact-con",{"off-panel-con":null==w?void 0:w.offPanel}),type:"tertiary",ref:b,title:x("_widgetLabel"),onClick:A},(()=>{const l=null==w?void 0:w.icon;return l?"string"==typeof l?(0,e.jsx)(t.SVG,{src:l}):(0,e.jsx)(t.Icon,{className:"compact-icon",icon:null==l?void 0:l.svg}):(0,e.jsx)(bt,null)})()),(0,e.jsx)(t.Popper,{open:O,placement:"bottom",reference:b,shiftOptions:{crossAxis:!0},flipOptions:{fallbackPlacements:["left-start","left-end"]},arrowOptions:!0,toggle:A,trapFocus:!1,autoFocus:!1,css:T},$())))};var Et=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{s(o.next(e))}catch(e){i(e)}}function a(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}s((o=o.apply(e,t||[])).next())}))};class Lt extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.10.0",description:"update layoutChoiceList of old print widget",upgrader:t=>Et(this,void 0,void 0,(function*(){const l=null==t?void 0:t.useUtility,o=t=>{var l,o,n,i,r,a;let s=(0,e.Immutable)(t);if(null===(l=null==t?void 0:t.exportOptions)||void 0===l?void 0:l.dpi){const e=Number(null===(o=null==t?void 0:t.exportOptions)||void 0===o?void 0:o.dpi);e<0?s=s.setIn(["exportOptions","dpi"],1):parseInt(e)!==e&&(s=s.setIn(["exportOptions","dpi"],parseInt(e)))}if(null===(n=null==t?void 0:t.exportOptions)||void 0===n?void 0:n.width){Number(null===(i=null==t?void 0:t.exportOptions)||void 0===i?void 0:i.width)<1&&(s=s.setIn(["exportOptions","width"],800))}else(null==t?void 0:t.layout)&&$(null==t?void 0:t.layout)&&(s=s.setIn(["exportOptions","width"],800));if(null===(r=null==t?void 0:t.exportOptions)||void 0===r?void 0:r.height){Number(null===(a=null==t?void 0:t.exportOptions)||void 0===a?void 0:a.height)<1&&(s=s.setIn(["exportOptions","height"],1100))}else(null==t?void 0:t.layout)&&$(null==t?void 0:t.layout)&&(s=s.setIn(["exportOptions","height"],1100));return null==s?void 0:s.asMutable({deep:!0})};t=(e=>{var t,l;return(null===(l=null===(t=null==e?void 0:e.commonSetting)||void 0===t?void 0:t.exportOptions)||void 0===l?void 0:l.dpi)?e.setIn(["commonSetting"],o(e.commonSetting)):e})(t);if(l){const e=yield(n=l,i=t,T(void 0,void 0,void 0,(function*(){return G(n).then((e=>C(e,n,i)))})));if(null==e?void 0:e.layoutChoiceList){const l=((e,t)=>{var l;const n=(null===(l=null==e?void 0:e.printCustomTemplate)||void 0===l?void 0:l.asMutable({deep:!0}))||[];return n?null==n?void 0:n.map((e=>{var l;if(null==e?void 0:e.mapFrameSize)return o(e);{const n=null===(l=null==t?void 0:t.filter((t=>(null==t?void 0:t.layout)===(null==e?void 0:e.layout))))||void 0===l?void 0:l[0],i={mapFrameSize:null==n?void 0:n.mapFrameSize,mapFrameUnit:null==n?void 0:n.mapFrameUnit,hasAuthorText:null==n?void 0:n.hasAuthorText,hasCopyrightText:null==n?void 0:n.hasCopyrightText,hasLegend:null==n?void 0:n.hasLegend,hasTitleText:null==n?void 0:n.hasTitleText};return Object.assign(Object.assign({},o(e)),i)}})):n})(t,null==e?void 0:e.layoutChoiceList);return t.setIn(["layoutChoiceList"],null==e?void 0:e.layoutChoiceList).set("printCustomTemplate",l)}return t}return t;var n,i}))},{version:"1.13.0",description:"Add default print preview style for old print widget",upgrader:e=>{let t=e;return"boolean"!=typeof(null==e?void 0:e.enablePreview)&&(t=t.set("enablePreview",!0).set("previewBackgroundColor","rgba(0,216,237,1)").set("previewOutLine",n)),t}},{version:"1.14.0",description:"Add default layout template or report template for old print widget",upgrader:e=>Et(this,void 0,void 0,(function*(){var t,l,o;let n=e;if(n.useUtility){n=(yield(r=n,Et(void 0,void 0,void 0,(function*(){let e=r;return G(e.useUtility).then((t=>te(t).then((l=>Et(void 0,void 0,void 0,(function*(){var o,n;const{supportCustomLayout:i,defaultCustomLayoutItem:a,supportCustomReport:s,supportReport:u}=l;let d={layoutTypes:g.ServiceLayout},c={reportTypes:b.ServiceReport};if(i&&a&&(d=yield R(l,e.useUtility)),u||s){const o=(yield B(t,p.ReportTemplate))||[],n=M(o);e=e.set("reportTemplateChoiceList",n).set("defaultReportTemplate",null==l?void 0:l.defaultReportTemplate).set("defaultCustomReportItem",null==l?void 0:l.defaultCustomReportItem),c=yield N(o,l,e.useUtility)}const v=((null==e?void 0:e.printTemplateType)===y.Customize?null===(o=e.printCustomTemplate)||void 0===o?void 0:o.asMutable({deep:!0}):null===(n=e.printOrgTemplate)||void 0===n?void 0:n.asMutable({deep:!0})).map((e=>{if((u||s)&&(e.reportTypes=d.reportTypes,(null==c?void 0:c.customReportItem)&&(e.customReportItem=c.customReportItem),(null==c?void 0:c.report)&&(e.report=c.report),(null==c?void 0:c.reportOptions)&&(e.reportOptions=c.reportOptions)),e.layoutTypes=d.layoutTypes,i&&a){(null==d?void 0:d.customLayoutItem)&&(e.customLayoutItem=d.customLayoutItem);const t=null==d?void 0:d.templateInfo;t&&((null==t?void 0:t.layoutOptions)&&(e.layoutOptions=t.layoutOptions),(null==t?void 0:t.pageUnits)&&(e.mapFrameUnit=t.pageUnits),(null==t?void 0:t.webMapFrameSize)&&(e.mapFrameSize=t.webMapFrameSize))}return e}));return e=(null==r?void 0:r.printTemplateType)===y.Customize?e.set("printCustomTemplate",v):e.set("printOrgTemplate",v),Promise.resolve(e)}))),(t=>Promise.resolve(e)))))}))))||n;const e=(null==n?void 0:n.printTemplateType)===y.Customize?null===(t=n.printCustomTemplate)||void 0===t?void 0:t.asMutable({deep:!0}):null===(l=n.printOrgTemplate)||void 0===l?void 0:l.asMutable({deep:!0});if(e&&n.layoutChoiceList){const t=(i=e,(null===(o=n.layoutChoiceList)||void 0===o?void 0:o.asMutable({deep:!0})).map((e=>{const t=(null==i?void 0:i.filter((t=>t.layout===e.layout))[0])||{};return e.customTextElementEnableList=t.customTextElementEnableList||[],e.enableNorthArrow=t.enableNorthArrow,e.enableLegend=t.hasLegend,e.enableAuthor=t.hasAuthorText,e.enableCopyright=t.hasCopyrightText,e.enableScalebarUnit=!0,e})));n=n.set("layoutChoiceList",t)}}var i,r;return n}))}]}}const Pt=new Lt,{useState:At,useEffect:kt,useRef:Dt}=e.React,Ut=t=>{const l=Dt({}),o=Dt(null),{reportOptions:n,id:i,handleWarningLabelChange:r}=t,[a,s]=At(null),[u,d]=At(null);kt((()=>{const e=(null==n?void 0:n.reportSectionOverrides)||{},t=[],i=[],a=[],u=[];Object.keys(e).forEach((l=>{var o;const n=e[l],r=null===(o=null==n?void 0:n.exbDatasource)||void 0===o?void 0:o[0],s=null==n?void 0:n.isDsOutputDs;r&&s&&!(null==i?void 0:i.includes(null==r?void 0:r.dataSourceId))&&(t.push(r),i.push(null==r?void 0:r.dataSourceId)),!r||s||(null==a?void 0:a.includes(null==r?void 0:r.dataSourceId))||(u.push(r),a.push(null==r?void 0:r.dataSourceId))})),function(e,t){if((null==e?void 0:e.length)!==(null==t?void 0:t.length)||!e||!t)return!1;const l=e.sort(),o=t.sort();let n=!0;return null==l||l.forEach(((e,t)=>{l[t]!==o[t]&&(n=!1)})),n}(i,o.current)||(r(null),l.current={}),o.current=i,s(t),d(u)}),[n]);const c=(t,o)=>{var n,i;const a=o.dataSourceId,s=l.current,u=(null===(n=(0,e.getAppStore)().getState().appConfig)||void 0===n?void 0:n.widgets)||{};if((null==s?void 0:s[a])!==t){s[a]=t,l.current=s;const o=[],n={};Object.keys(s).forEach((t=>{var l;if(!s[t]){const i=e.DataSourceManager.getInstance().getDataSource(t),r=null==i?void 0:i.getLabel(),a=p(i),s=null===e.appConfigUtils||void 0===e.appConfigUtils?void 0:e.appConfigUtils.getWidgetIdByOutputDataSource(a),d=null===(l=null==u?void 0:u[s])||void 0===l?void 0:l.label;s&&(o.push(r),n[s]=d)}}));let d=null,c=null;(null===(i=Object.keys(n))||void 0===i?void 0:i.length)>0&&(c=o.join(", "),d=Object.keys(n).map((e=>n[e])).join(", ")),r({label:c,widgets:d})}},p=e=>{var t;return e?{dataSourceId:e.id,mainDataSourceId:e.getMainDataSource().id,dataViewId:e.dataViewId,rootDataSourceId:null===(t=e.getRootDataSource())||void 0===t?void 0:t.id}:null};return(0,e.jsx)("div",null,null==a?void 0:a.map((t=>(0,e.jsx)(e.DataSourceComponent,{key:t.dataSourceId,query:null,useDataSource:t,onDataSourceCreated:()=>{(e=>{c(!0,e)})(t)},onCreateDataSourceFailed:e=>{((e,t)=>{c(!1,t)})(0,t)},widgetId:i,queryCount:!0,onDataSourceInfoChange:l=>{((t,l)=>{const o=null==t?void 0:t.status,n=o!==e.DataSourceStatus.NotCreated&&o!==e.DataSourceStatus.CreateError&&o!==e.DataSourceStatus.LoadError&&o!==e.DataSourceStatus.SaveError&&o!==e.DataSourceStatus.NotReady;c(n,l)})(l,t)}}))),null==u?void 0:u.map((t=>(0,e.jsx)(e.DataSourceComponent,{key:t.dataSourceId,query:null,useDataSource:t,widgetId:i,queryCount:!0}))))},{useState:Vt,useRef:zt,useEffect:Ft}=e.React,$t=o=>{var n;const{id:i,config:r,dispatch:a,useMapWidgetIds:s,layoutId:u,layoutItemId:d,locale:c,controllerWidgetId:p}=o,f=e.hooks.useTranslation(I,t.defaultMessages),h=e.ReactRedux.useSelector((e=>{var t;const l=null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.selection;return!(!l||l.layoutId!==u||l.layoutItemId!==d)})),g=e.ReactRedux.useSelector((e=>{var t,l;return null===(l=null===(t=e.widgetsState)||void 0===t?void 0:t[i])||void 0===l?void 0:l.loadingPrintService})),x=zt(!1),b=zt(null),[w,T]=Vt(null),[O,j]=Vt(f("printPlaceholder")),[C,R]=Vt(null),[N,M]=Vt(0),[E,L]=Vt(null),[P,A]=Vt(!1),[k,D]=Vt(!1),U=e.css`
    .jimu-widget-placeholder {
      border: none;
    }
    &.surface-1 {
      border: none !important;
    }
    .checkbox-con:hover {
      color: var(--ref-palette-neutral-1100);
    }
  `;Ft((()=>{z()}),[h]),Ft((()=>{V()}),[r]),Ft((()=>{B(w,C,r)}),[C,r,w]),Ft((()=>{g&&R(null)}),[g]);const V=()=>{var e,t;let l=(e=null==r?void 0:r.printServiceType,t=null==r?void 0:r.printTemplateType,e===m.Customize||t===y.Customize)?null==r?void 0:r.printCustomTemplate:null==r?void 0:r.printOrgTemplate;((null==r?void 0:r.supportCustomReport)||(null==r?void 0:r.supportReport))&&(l=null==l?void 0:l.filter((e=>q(null==e?void 0:e.asMutable({deep:!0}),r)))),R(l)},z=()=>{u&&i&&d&&!x.current&&h&&(a(e.appActions.widgetStatePropChange(i,"layoutInfo",{layoutId:u,layoutItemId:d})),x.current=!0)},F=e=>null==e||"2d"!==e.view.type?(j(f("chooseMapTip")),void T(null)):(s&&0!==(null==s?void 0:s.length)||j(f("printPlaceholder")),void T(e)),$=e=>{},W=()=>{let e=O;return w&&!(null==r?void 0:r.useUtility)&&(e=""),e},G=(e=!1)=>{D(e),e&&(clearTimeout(b.current),b.current=setTimeout((()=>{D(!1)}),5e3))},B=e.hooks.useEventCallback(((e,t,l)=>{var o;const{supportCustomReport:n,supportReport:i}=l;let r=!1;if(!e||!(null==l?void 0:l.useUtility))return r=!0,void A(r);if(i||n){let e=!0;if(null==t||t.forEach((t=>{q(null==t?void 0:t.asMutable({deep:!0}),l)&&(e=!1)})),e){const e=((e,t,l)=>{const o=H(e,t),{reportsAvailable:n,elementOverridesAvailable:i}=o;let r;return n||(r=l("reportTemplateRemind")),i||(r=r?`${r} ${l("dynamicElementTemplateRemind")}`:l("dynamicElementTemplateRemind")),r})(null===(o=null==t?void 0:t[0])||void 0===o?void 0:o.asMutable({deep:!0}),l,f);O&&j(e),r=!0}}t&&0!==(null==t?void 0:t.length)&&!g||(r=!0,j(null)),A(r)}));return(0,e.jsx)("div",{className:(0,e.classNames)("w-100 h-100",{"surface-1":(null==r?void 0:r.modeType)===v.Classic}),css:U},(0,e.jsx)("div",{className:"map"},(0,e.jsx)("div",null,(0,e.jsx)(l.JimuMapViewComponent,{useMapWidgetId:null==s?void 0:s[0],onActiveViewChange:F,onViewGroupCreate:$}))),(null==r?void 0:r.modeType)===v.Classic&&(0,e.jsx)("div",{className:"w-100 h-100"},!P&&(0,e.jsx)(gt,{outputDataSourceWarning:E,handleSelectedTemplateIndexChange:e=>{M(e)},useMapWidgetIds:s,id:i,locale:c,config:r,jimuMapView:w,templateList:C,showUtilityErrorRemind:k,toggleUtilityErrorRemind:G}),P&&(0,e.jsx)(t.WidgetPlaceholder,{icon:S(),widgetId:i,message:W()})),(null==r?void 0:r.modeType)===v.Compact&&(0,e.jsx)("div",{className:"w-100 h-100"},(0,e.jsx)(Mt,{showPlaceholder:P,outputDataSourceWarning:E,useMapWidgetIds:s,id:i,config:r,locale:c,jimuMapView:w,templateList:C,controllerWidgetId:p,errorTip:W(),showUtilityErrorRemind:k,toggleUtilityErrorRemind:G})),((null==r?void 0:r.supportReport)||(null==r?void 0:r.supportCustomReport))&&(0,e.jsx)(Ut,{id:i,reportOptions:null===(n=null==C?void 0:C[N])||void 0===n?void 0:n.reportOptions,handleWarningLabelChange:e=>{L(e)}}))};$t.versionManager=Pt;const Wt=$t;function Gt(e){r.p=e}})(),a})())}}}));